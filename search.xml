<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[è¾“å…¥ã€Œç¥ç§˜ä»£ç ã€è§£é”ã€Œéšè—ç±»ç›®ã€]]></title>
      <url>/posts/netflix-guide.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/netflix_v2-1024x576.png?imageslim" alt="Netflix"></p><blockquote><p>ç¿»è¯‘: <a href="https://netflix-codes.com/?ref=digitalimmigrant.org" target="_blank" rel="noopener">Netflix-Codes</a></p></blockquote><p>Netflixä½¿ç”¨ä¸€ä¸ªéå¸¸å¥‡æ€ªçš„ç³»ç»Ÿæ¥å¯¹ç”µå½±å’Œç”µè§†èŠ‚ç›®è¿›è¡Œåˆ†ç±»ï¼Œç½‘ç«™ä¸Šå¹¶æ²¡æœ‰åˆ†ç±»çš„å¯¼èˆªtabï¼Œä¸è¿‡ä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„åˆ†ç±»CODEç›´è¾¾æ‚¨æƒ³çœ‹çš„å½±ç‰‡ã€‚æ‚¨åªéœ€ç”¨CODEæ›¿æ¢æ‰ä¸‹é¢é“¾æ¥ä¸­<code>xx</code>å³å¯ï¼š</p><blockquote><p><code>https://netflix.com/browse/genre/xx</code></p></blockquote><a id="more"></a><h2 id="å‰ç½®å‡†å¤‡"><a href="#å‰ç½®å‡†å¤‡" class="headerlink" title="å‰ç½®å‡†å¤‡"></a>å‰ç½®å‡†å¤‡</h2><ul><li>æœ‰ä¸€ä¸ªå¯ä»¥è§£é”Netflixçš„VPNï¼Œè¿™é‡Œæ¨èrixcloudï¼ˆ<a href="https://wangwei.one/posts/build-your-own-vpn-by-shadowsocks-or-rixcloud.html">æŒ‡å—</a>ï¼‰</li><li>åŒå¸ï¼ˆå…¨å¸ï¼‰VISAä¿¡ç”¨å¡ğŸ’³</li></ul><h2 id="åŠ¨ä½œå’Œå†’é™©-1365"><a href="#åŠ¨ä½œå’Œå†’é™©-1365" class="headerlink" title="åŠ¨ä½œå’Œå†’é™© 1365"></a>åŠ¨ä½œå’Œå†’é™© <a href="https://netflix.com/browse/genre/1365" target="_blank" rel="noopener"><code>1365</code></a></h2><ul><li>å†›äº‹è¡ŒåŠ¨å’Œå†’é™© Military action &amp; adventure <a href="https://netflix.com/browse/genre/2125" target="_blank" rel="noopener"><code>2125</code></a></li><li>åŠ¨ä½œå–œå‰§ Action comedies <a href="https://netflix.com/browse/genre/43040" target="_blank" rel="noopener"><code>43040</code></a></li><li>é—´è°è¡ŒåŠ¨å’Œå†’é™© Spy action &amp; adventure <a href="https://netflix.com/browse/genre/10702" target="_blank" rel="noopener"><code>10702</code></a></li><li>çŠ¯ç½ªè¡ŒåŠ¨å’Œå†’é™© Crime action &amp; adventure <a href="https://netflix.com/browse/genre/9584" target="_blank" rel="noopener"><code>9584</code></a></li><li>åŠ¨ä½œç±»ç§‘å¹»å’Œå¥‡å¹» Action Sci-Fi &amp; fantasy <a href="https://netflix.com/browse/genre/1568" target="_blank" rel="noopener"><code>1568</code></a></li><li>åŠ¨ä½œæƒŠæ‚šç‰‡ Action thrillers <a href="https://netflix.com/browse/genre/43048" target="_blank" rel="noopener"><code>43048</code></a></li><li>äºšæ´²åŠ¨ä½œç‰‡ Asian action movies <a href="https://netflix.com/browse/genre/77232" target="_blank" rel="noopener"><code>77232</code></a></li><li>å†’é™©ç‰‡ Adventures <a href="https://netflix.com/browse/genre/7442" target="_blank" rel="noopener"><code>7442</code></a></li><li>æ¼«ç”»ä¹¦å’Œè¶…çº§è‹±é›„ç”µå½± Comic book and superhero movies <a href="https://netflix.com/browse/genre/10118" target="_blank" rel="noopener"><code>10118</code></a></li><li>æ­¦ä¾ ç”µå½± Martial arts movies <a href="https://netflix.com/browse/genre/8985" target="_blank" rel="noopener"><code>8985</code></a></li><li>å¤–å›½åŠ¨ä½œå’Œå†’é™© Foreign action &amp; adventure <a href="https://netflix.com/browse/genre/11828" target="_blank" rel="noopener"><code>11828</code></a></li><li>è¥¿éƒ¨ç‰‡ Westerns <a href="https://netflix.com/browse/genre/7700" target="_blank" rel="noopener"><code>7700</code></a></li><li>åŠ«æŒç”µå½± Hijacking Movies <a href="https://netflix.com/browse/genre/20541" target="_blank" rel="noopener"><code>20541</code></a></li></ul><h2 id="ç»å…¸ç”µå½±-31574"><a href="#ç»å…¸ç”µå½±-31574" class="headerlink" title="ç»å…¸ç”µå½± 31574"></a>ç»å…¸ç”µå½± <a href="https://netflix.com/browse/genre/31574" target="_blank" rel="noopener"><code>31574</code></a></h2><ul><li>ç»å…¸åŠ¨ä½œå’Œå†’é™© Classic action &amp; adventure <a href="https://netflix.com/browse/genre/46576" target="_blank" rel="noopener"><code>46576</code></a></li><li>ç»å…¸å–œå‰§ Classic comedies <a href="https://netflix.com/browse/genre/31694" target="_blank" rel="noopener"><code>31694</code></a></li><li>ç»å…¸å‰§é›† Classic dramas <a href="https://netflix.com/browse/genre/29809" target="_blank" rel="noopener"><code>29809</code></a></li><li>ç»å…¸éŸ³ä¹å–œå‰§ Classic musical comedy <a href="https://netflix.com/browse/genre/32392" target="_blank" rel="noopener"><code>32392</code></a></li><li>ç»å…¸æµªæ¼«ç”µå½± Classic romantic movies <a href="https://netflix.com/browse/genre/31273" target="_blank" rel="noopener"><code>31273</code></a></li><li>ç»å…¸ç§‘å¹»å’Œå¥‡å¹»ç”µå½± Classic SF &amp; fantasy <a href="https://netflix.com/browse/genre/47147" target="_blank" rel="noopener"><code>47147</code></a></li><li>ç»å…¸æƒŠæ‚šç‰‡ Classic thrillers <a href="https://netflix.com/browse/genre/46588" target="_blank" rel="noopener"><code>46588</code></a></li><li>ç»å…¸æˆ˜äº‰é¢˜æç”µå½± Classic war movies <a href="https://netflix.com/browse/genre/48744" target="_blank" rel="noopener"><code>48744</code></a></li><li>ç»å…¸ç”µè§†èŠ‚ç›® Classic TV shows <a href="https://netflix.com/browse/genre/46553" target="_blank" rel="noopener"><code>46553</code></a></li><li>ç»å…¸è¥¿éƒ¨ç‰‡ Classic westerns <a href="https://netflix.com/browse/genre/47465" target="_blank" rel="noopener"><code>47465</code></a></li></ul><h2 id="å–œå‰§-6548"><a href="#å–œå‰§-6548" class="headerlink" title="å–œå‰§ 6548"></a>å–œå‰§ <a href="https://netflix.com/browse/genre/6548" target="_blank" rel="noopener"><code>6548</code></a></h2><ul><li>åŠ¨æ¼«å–œå‰§ Animes comedies <a href="https://netflix.com/browse/genre/9302" target="_blank" rel="noopener"><code>9302</code></a></li><li>æ¶æå–œå‰§ Slapstick comedies <a href="https://netflix.com/browse/genre/10256" target="_blank" rel="noopener"><code>10256</code></a></li><li>ææ€–å–œå‰§ Horror comedies <a href="https://netflix.com/browse/genre/89585" target="_blank" rel="noopener"><code>89585</code></a></li><li>é»‘è‰²å¹½é»˜ Dark comedies <a href="https://netflix.com/browse/genre/869" target="_blank" rel="noopener"><code>869</code></a></li><li>éŸ³ä¹å‰§å–œå‰§ Musicals comedies <a href="https://netflix.com/browse/genre/13335" target="_blank" rel="noopener"><code>13335</code></a></li><li>æ”¿æ²»é¢˜æå–œå‰§ Political comedies <a href="https://netflix.com/browse/genre/2700" target="_blank" rel="noopener"><code>2700</code></a></li><li>ä½“è‚²é¢˜æå–œå‰§ Sports comedies <a href="https://netflix.com/browse/genre/5286" target="_blank" rel="noopener"><code>5286</code></a></li></ul><h2 id="æˆå‰§-5763"><a href="#æˆå‰§-5763" class="headerlink" title="æˆå‰§ 5763"></a>æˆå‰§ <a href="https://netflix.com/browse/genre/5763" target="_blank" rel="noopener"><code>5763</code></a></h2><ul><li>ä¼ è®°å‰§æƒ…ç‰‡ Biographical dramas <a href="https://netflix.com/browse/genre/3179" target="_blank" rel="noopener"><code>3179</code></a></li><li>åŸè‘—æ”¹ç¼–çš„å‰§æƒ…ç‰‡ Dramas based on books <a href="https://netflix.com/browse/genre/4961" target="_blank" rel="noopener"><code>4961</code></a></li><li>çœŸå®æ•…äº‹æ”¹ç¼–çš„å‰§æƒ…ç‰‡ Dramas based on real life <a href="https://netflix.com/browse/genre/3653" target="_blank" rel="noopener"><code>3653</code></a></li><li><a href="https://www.wikiwand.com/zh-hk/LGBT%E6%96%87%E5%8C%96" target="_blank" rel="noopener">åŒæ€§æ‹</a> é¢˜æå‰§æƒ…ç‰‡ LGBT Dramas <a href="https://netflix.com/browse/genre/500" target="_blank" rel="noopener"><code>500</code></a></li><li>çŠ¯ç½ªé¢˜æå‰§æƒ…ç‰‡ Crime dramas <a href="https://netflix.com/browse/genre/6889" target="_blank" rel="noopener"><code>6889</code></a></li><li>æ”¿æ²»é¢˜æå‰§æƒ…ç‰‡ Political Dramas <a href="https://netflix.com/browse/genre/6616" target="_blank" rel="noopener"><code>6616</code></a></li><li>æµªæ¼«çˆ±æƒ…å‰§æƒ…ç‰‡ Romantical dramas <a href="https://netflix.com/browse/genre/1255" target="_blank" rel="noopener"><code>1255</code></a></li><li>æ¶‰åŠç¤¾ä¼šé—®é¢˜çš„å‰§æƒ…ç‰‡ Social issues dramas <a href="https://netflix.com/browse/genre/3947" target="_blank" rel="noopener"><code>3947</code></a></li><li>å†›äº‹é¢˜æå‰§æƒ…ç‰‡ Army dramas <a href="https://netflix.com/browse/genre/11" target="_blank" rel="noopener"><code>11</code></a></li><li>ä½“è‚²ç±»å‰§æƒ…ç‰‡ Sports drama <a href="https://netflix.com/browse/genre/7243" target="_blank" rel="noopener"><code>7243</code></a></li><li>æ¼”è‰ºç•Œç”µè§†å‰§ Showbiz dramas <a href="https://netflix.com/browse/genre/5012" target="_blank" rel="noopener"><code>5012</code></a></li></ul><h2 id="ææ€–ç”µå½±-8711"><a href="#ææ€–ç”µå½±-8711" class="headerlink" title="ææ€–ç”µå½± 8711"></a>ææ€–ç”µå½± <a href="https://netflix.com/browse/genre/8711" target="_blank" rel="noopener"><code>8711</code></a></h2><ul><li>æ·±æµ·ææ€–ç‰‡ Deep sea horror movies <a href="https://netflix.com/browse/genre/45028" target="_blank" rel="noopener"><code>45028</code></a></li><li>å¸è¡€é¬¼ææ€–ç‰‡ Vampire horror movies <a href="https://netflix.com/browse/genre/75804" target="_blank" rel="noopener"><code>75804</code></a></li><li>ç‹¼äººææ€–ç‰‡ Werewolf horror movies <a href="https://netflix.com/browse/genre/75930" target="_blank" rel="noopener"><code>75930</code></a></li><li>åƒµå°¸ææ€–ç‰‡ Zombie horror movies <a href="https://netflix.com/browse/genre/75405" target="_blank" rel="noopener"><code>75405</code></a></li><li>æ’’æ—¦çš„æ•…äº‹ Satanic stories <a href="https://netflix.com/browse/genre/6998" target="_blank" rel="noopener"><code>6998</code></a></li><li>é’å°‘å¹´ææ€–ç‰‡ Teen screams <a href="https://netflix.com/browse/genre/52147" target="_blank" rel="noopener"><code>52147</code></a></li><li>è¶…è‡ªç„¶ææ€–é¢˜æææ€–ç‰‡ Supernatural horror movies <a href="https://netflix.com/browse/genre/42023" target="_blank" rel="noopener"><code>42023</code></a></li><li>è¡€è…¥æš´åŠ›å’Œè¿ç¯æ€æ‰‹é¢˜æææ€–ç‰‡ Slasher and serial killer movies <a href="https://netflix.com/browse/genre/8646" target="_blank" rel="noopener"><code>8646</code></a></li><li>æ€ªå…½é¢˜æææ€–ç‰‡ Monster movies <a href="https://netflix.com/browse/genre/947" target="_blank" rel="noopener"><code>947</code></a></li><li>ææ€–ç±»å–œå‰§ç‰‡ Horror comedy <a href="https://netflix.com/browse/genre/89585" target="_blank" rel="noopener"><code>89585</code></a></li><li>å¤–å›½ææ€–ç‰‡ Foreign horror movies <a href="https://netflix.com/browse/genre/8654" target="_blank" rel="noopener"><code>8654</code></a></li><li>å°ä¼—ææ€–ç”µå½± Cult horror movies <a href="https://netflix.com/browse/genre/10944" target="_blank" rel="noopener"><code>10944</code></a></li></ul><h2 id="æµªæ¼«çˆ±æƒ…ç”µå½±-8883"><a href="#æµªæ¼«çˆ±æƒ…ç”µå½±-8883" class="headerlink" title="æµªæ¼«çˆ±æƒ…ç”µå½± 8883"></a>æµªæ¼«çˆ±æƒ…ç”µå½± <a href="https://netflix.com/browse/genre/8883" target="_blank" rel="noopener"><code>8883</code></a></h2><ul><li>æµªæ¼«çˆ±æƒ…å–œå‰§ Romantic Comedies <a href="https://netflix.com/browse/genre/5475" target="_blank" rel="noopener"><code>5475</code></a></li><li>æœ€å—å–œçˆ±çš„çˆ±æƒ…ç‰‡ Romantic favorites <a href="https://netflix.com/browse/genre/502675" target="_blank" rel="noopener"><code>502675</code></a></li><li>å›½å¤–çˆ±æƒ…ç”µå½± Romantic foreign movies <a href="https://netflix.com/browse/genre/7153" target="_blank" rel="noopener"><code>7153</code></a></li><li>çƒ­è¾£çˆ±æƒ…ç”µå½± Steamy romantic movies <a href="https://netflix.com/browse/genre/35800" target="_blank" rel="noopener"><code>35800</code></a></li><li>æ–°å¥‡çš„çˆ±æƒ…ç‰‡ Quirky romance <a href="https://netflix.com/browse/genre/36103" target="_blank" rel="noopener"><code>36103</code></a></li><li>çˆ±æƒ…é¢˜æç‹¬ç«‹ç”µå½± Romantic independent movies <a href="https://netflix.com/browse/genre/9916" target="_blank" rel="noopener"><code>9916</code></a></li><li>æµªæ¼«çˆ±æƒ…å‰§æƒ…ç‰‡ Romantic dramas <a href="https://netflix.com/browse/genre/1255" target="_blank" rel="noopener"><code>1255</code></a></li><li>ç»å…¸çˆ±æƒ…ç”µå½± Classic romantic movies <a href="https://netflix.com/browse/genre/31273" target="_blank" rel="noopener"><code>31273</code></a></li></ul><h2 id="ç§‘å¹»å¥‡å¹»ç‰‡-1492"><a href="#ç§‘å¹»å¥‡å¹»ç‰‡-1492" class="headerlink" title="ç§‘å¹»å¥‡å¹»ç‰‡ 1492"></a>ç§‘å¹»å¥‡å¹»ç‰‡ <a href="https://netflix.com/browse/genre/1492" target="_blank" rel="noopener"><code>1492</code></a></h2><ul><li>å¤–æ˜Ÿäººç§‘å¹» Alien Sci-Fi <a href="https://netflix.com/browse/genre/3327" target="_blank" rel="noopener"><code>3327</code></a></li><li>ç§‘å¹»å†’é™©ç‰‡ Sci-Fi adventure <a href="https://netflix.com/browse/genre/6926" target="_blank" rel="noopener"><code>6926</code></a></li><li>ç§‘å¹»å‰§æƒ…ç±» Sci-Fi dramas <a href="https://netflix.com/browse/genre/3916" target="_blank" rel="noopener"><code>3916</code></a></li><li>ç§‘å¹»æƒŠæ‚šç‰‡ Sci-Fi thrillers <a href="https://netflix.com/browse/genre/11014" target="_blank" rel="noopener"><code>11014</code></a></li><li>è¡ŒåŠ¨ç§‘å¹»ä¸å¥‡å¹»ç‰‡ Action Sci-Fi &amp; fantasy <a href="https://netflix.com/browse/genre/1568" target="_blank" rel="noopener"><code>1568</code></a></li><li>ç»å…¸ç§‘å¹»ä¸å¥‡å¹»ç‰‡ Classic Sci-Fi &amp; fantasy <a href="https://netflix.com/browse/genre/47147" target="_blank" rel="noopener"><code>47147</code></a></li><li>å°ä¼—ç§‘å¹»ä¸å¥‡å¹»ç‰‡ Cult Sci-Fi &amp; fantasy <a href="https://netflix.com/browse/genre/4734" target="_blank" rel="noopener"><code>4734</code></a></li><li>å¥‡å¹»ç±»ç”µå½± Fantasy movies <a href="https://netflix.com/browse/genre/9744" target="_blank" rel="noopener"><code>9744</code></a></li><li>ç§‘å¹»ææ€–ç”µå½± Sci-Fi horror movies <a href="https://netflix.com/browse/genre/1694" target="_blank" rel="noopener"><code>1694</code></a></li><li>å¤–å›½ç§‘å¹»å¥‡å¹»ç‰‡ Foreign Sci-Fi &amp; fantasy <a href="https://netflix.com/browse/genre/6485" target="_blank" rel="noopener"><code>6485</code></a></li></ul><h2 id="ä½“è‚²é¢˜æç”µå½±-4370"><a href="#ä½“è‚²é¢˜æç”µå½±-4370" class="headerlink" title="ä½“è‚²é¢˜æç”µå½± 4370"></a>ä½“è‚²é¢˜æç”µå½± <a href="https://netflix.com/browse/genre/4370" target="_blank" rel="noopener"><code>4370</code></a></h2><ul><li>æ­¦ä¾ ç”µå½± Martial Arts Movies <a href="https://netflix.com/browse/genre/8985" target="_blank" rel="noopener"><code>8985</code></a></li><li>æ£’çƒé¢˜æç”µå½± Baseball movies <a href="https://netflix.com/browse/genre/12339" target="_blank" rel="noopener"><code>12339</code></a></li><li>ç¯®çƒé¢˜æç”µå½± Basketball movies <a href="https://netflix.com/browse/genre/12762" target="_blank" rel="noopener"><code>12762</code></a></li><li>æ­¦æ‰“ã€æ‹³å‡»ä¸æ ¼æ–— Martial arts, boxing &amp; wrestling <a href="https://netflix.com/browse/genre/6695" target="_blank" rel="noopener"><code>6695</code></a></li><li>è¶³çƒé¢˜æç”µå½± Soccer movies <a href="https://netflix.com/browse/genre/12549" target="_blank" rel="noopener"><code>12549</code></a></li><li>æ©„æ¦„çƒé¢˜æç”µå½± Football movies <a href="https://netflix.com/browse/genre/12803" target="_blank" rel="noopener"><code>12803</code></a></li><li>ä½“è‚²é¢˜æå–œå‰§ Sports comedies <a href="https://netflix.com/browse/genre/5286" target="_blank" rel="noopener"><code>5286</code></a></li><li>ä½“è‚²é¢˜æçºªå½•ç‰‡ Sports documentaries <a href="https://netflix.com/browse/genre/180" target="_blank" rel="noopener"><code>180</code></a></li><li>ä½“è‚²é¢˜æå‰§æƒ…ç‰‡ Sports dramas <a href="https://netflix.com/browse/genre/7243" target="_blank" rel="noopener"><code>7243</code></a></li><li>æ‹³å‡»é¢˜æç”µå½± Boxing movies <a href="https://netflix.com/browse/genre/12443" target="_blank" rel="noopener"><code>12443</code></a></li><li>è¿åŠ¨ä¸å¥èº«é¢˜æ Sports &amp; Fitness <a href="https://netflix.com/browse/genre/9327" target="_blank" rel="noopener"><code>9327</code></a></li></ul><h2 id="æƒŠæ‚šç‰‡-8933"><a href="#æƒŠæ‚šç‰‡-8933" class="headerlink" title="æƒŠæ‚šç‰‡ 8933"></a>æƒŠæ‚šç‰‡ <a href="https://netflix.com/browse/genre/8933" target="_blank" rel="noopener"><code>8933</code></a></h2><ul><li>é—´è°æƒŠæ‚šç‰‡ Spy thrillers <a href="https://netflix.com/browse/genre/9147" target="_blank" rel="noopener"><code>9147</code></a></li><li>çŠ¯ç½ªæƒŠæ‚šç‰‡ Crime thrillers <a href="https://netflix.com/browse/genre/10499" target="_blank" rel="noopener"><code>10499</code></a></li><li>æ”¿æ²»æƒŠæ‚šç‰‡ Political thrillers <a href="https://netflix.com/browse/genre/10504" target="_blank" rel="noopener"><code>10504</code></a></li><li>å¿ƒç†æƒŠæ‚šç‰‡ Psychological thrillers <a href="https://netflix.com/browse/genre/5505" target="_blank" rel="noopener"><code>5505</code></a></li><li>ç§‘å¹»æƒŠæ‚šç‰‡ Sci-Fi thrillers <a href="https://netflix.com/browse/genre/11014" target="_blank" rel="noopener"><code>11014</code></a></li><li>çƒ­è¾£æƒŠæ‚šç‰‡ Steamy thrillers <a href="https://netflix.com/browse/genre/972" target="_blank" rel="noopener"><code>972</code></a></li><li>åŠ¨ä½œæƒŠæ‚šç‰‡ Action thrillers <a href="https://netflix.com/browse/genre/43048" target="_blank" rel="noopener"><code>43048</code></a></li><li>ç»å…¸æƒŠæ‚šç‰‡ Classic thrillers <a href="https://netflix.com/browse/genre/46588" target="_blank" rel="noopener"><code>46588</code></a></li><li>å¤–å›½æƒŠæ‚šç‰‡ Foreign thrillers <a href="https://netflix.com/browse/genre/10306" target="_blank" rel="noopener"><code>10306</code></a></li><li>æƒŠæ‚šé¢˜æç‹¬ç«‹ç”µå½± Independent thrillers <a href="https://netflix.com/browse/genre/3269" target="_blank" rel="noopener"><code>3269</code></a></li><li>é»‘å¸®ç”µå½± Gangster movies <a href="https://netflix.com/browse/genre/31851" target="_blank" rel="noopener"><code>31851</code></a></li><li>ç¥ç§˜æƒŠæ‚šç‰‡ Mysteries <a href="https://netflix.com/browse/genre/9994" target="_blank" rel="noopener"><code>9994</code></a></li><li>è¶…è‡ªç„¶é¢˜ææƒŠæ‚šç‰‡ Supernatural thrillers <a href="https://netflix.com/browse/genre/11140" target="_blank" rel="noopener"><code>11140</code></a></li></ul><h2 id="çºªå½•ç‰‡-6839"><a href="#çºªå½•ç‰‡-6839" class="headerlink" title="çºªå½•ç‰‡ 6839"></a>çºªå½•ç‰‡ <a href="https://netflix.com/browse/genre/6839" target="_blank" rel="noopener"><code>6839</code></a></h2><ul><li>ä¼ è®°çºªå½•ç‰‡ Biographical documentaries <a href="https://netflix.com/browse/genre/3652" target="_blank" rel="noopener"><code>3652</code></a></li><li>å†å²é¢˜æçºªå½•ç‰‡ Historical documentaries <a href="https://netflix.com/browse/genre/5349" target="_blank" rel="noopener"><code>5349</code></a></li><li>éŸ³ä¹å’ŒéŸ³ä¹ä¼šçºªå½•ç‰‡ Music &amp; concert documentaries <a href="https://netflix.com/browse/genre/90361" target="_blank" rel="noopener"><code>90361</code></a></li><li>çŠ¯ç½ªé¢˜æçºªå½•ç‰‡ Crime documentaries <a href="https://netflix.com/browse/genre/9875" target="_blank" rel="noopener"><code>9875</code></a></li><li>æ”¿æ²»é¢˜æçºªå½•ç‰‡ Political documentaries <a href="https://netflix.com/browse/genre/7018" target="_blank" rel="noopener"><code>7018</code></a></li><li>ç§‘å­¦èˆªæµ·é¢˜æçºªå½•ç‰‡ Science &amp; navature documentaries <a href="https://netflix.com/browse/genre/2595" target="_blank" rel="noopener"><code>2595</code></a></li><li>ç¤¾ä¼šæ–‡åŒ–é¢˜æçºªå½•ç‰‡ Social &amp; cultural documentaries <a href="https://netflix.com/browse/genre/3675" target="_blank" rel="noopener"><code>3675</code></a></li><li>ä¿¡ä»°ä¸ç²¾ç¥é¢˜æçºªå½•ç‰‡ Documentaires spirituels <a href="https://netflix.com/browse/genre/2760" target="_blank" rel="noopener"><code>2760</code></a></li><li>å†›äº‹é¢˜æçºªå½•ç‰‡ Military documentaries <a href="https://netflix.com/browse/genre/4006" target="_blank" rel="noopener"><code>4006</code></a></li><li>ä½“è‚²é¢˜æçºªå½•ç‰‡ Sports documentaries <a href="https://netflix.com/browse/genre/180" target="_blank" rel="noopener"><code>180</code></a></li><li>æ—…æ¸¸å†’é™©é¢˜æçºªå½•ç‰‡ Travel &amp; adventure documentaries <a href="https://netflix.com/browse/genre/1159" target="_blank" rel="noopener"><code>1159</code></a></li><li>å¤–å›½çºªå½•ç‰‡ Foreign documentaries <a href="https://netflix.com/browse/genre/5161" target="_blank" rel="noopener"><code>5161</code></a></li><li>å®—æ•™é¢˜æçºªå½•ç‰‡ Religious documentaries <a href="https://netflix.com/browse/genre/10005" target="_blank" rel="noopener"><code>10005</code></a></li></ul><h2 id="ç”µè§†èŠ‚ç›®-å‰§é›†-83"><a href="#ç”µè§†èŠ‚ç›®-å‰§é›†-83" class="headerlink" title="ç”µè§†èŠ‚ç›®/å‰§é›† 83"></a>ç”µè§†èŠ‚ç›®/å‰§é›† <a href="https://netflix.com/browse/genre/83" target="_blank" rel="noopener"><code>83</code></a></h2><ul><li>ç¾é£Ÿå’Œæ—…è¡Œç±»ç”µè§†èŠ‚ç›® Food &amp; travel TV <a href="https://netflix.com/browse/genre/72436" target="_blank" rel="noopener"><code>72436</code></a></li><li>ç§‘å­¦ä¸è‡ªç„¶ç±»ç”µè§†èŠ‚ç›® Science &amp; nature TV <a href="https://netflix.com/browse/genre/52780" target="_blank" rel="noopener"><code>52780</code></a></li><li>è‹±å‰§ British TV shows <a href="https://netflix.com/browse/genre/52117" target="_blank" rel="noopener"><code>52117</code></a></li><li>ç»å…¸ç”µè§†èŠ‚ç›® Classic TV shows <a href="https://netflix.com/browse/genre/46553" target="_blank" rel="noopener"><code>46553</code></a></li><li>çŠ¯ç½ªç”µè§†èŠ‚ç›® Crime TV shows <a href="https://netflix.com/browse/genre/26146" target="_blank" rel="noopener"><code>26146</code></a></li><li>å°ä¼—ç”µè§†èŠ‚ç›® Cult TV shows <a href="https://netflix.com/browse/genre/74652" target="_blank" rel="noopener"><code>74652</code></a></li><li>å°‘å„¿ç”µè§†èŠ‚ç›® Kidsâ€™ TV <a href="https://netflix.com/browse/genre/27346" target="_blank" rel="noopener"><code>27346</code></a></li><li>éŸ©å‰§ Korean TV shows <a href="https://netflix.com/browse/genre/67879" target="_blank" rel="noopener"><code>67879</code></a></li><li>è¿·ä½ å‰§ Miniseries <a href="https://netflix.com/browse/genre/4814" target="_blank" rel="noopener"><code>4814</code></a></li><li>å†›äº‹é¢˜æç”µè§†èŠ‚ç›® Military TV shows <a href="https://netflix.com/browse/genre/25804" target="_blank" rel="noopener"><code>25804</code></a></li><li>åŠ¨ä½œå†’é™©ç±»ç”µè§†èŠ‚ç›® TV action &amp; adventure <a href="https://netflix.com/browse/genre/10673" target="_blank" rel="noopener"><code>10673</code></a></li><li>å–œå‰§ç±»ç”µè§†èŠ‚ç›® TV comedies <a href="https://netflix.com/browse/genre/10375" target="_blank" rel="noopener"><code>10375</code></a></li><li>ç³»åˆ—çºªå½•ç‰‡ TV documentaries <a href="https://netflix.com/browse/genre/10105" target="_blank" rel="noopener"><code>10105</code></a></li><li>ç”µè§†å‰§ TV dramas <a href="https://netflix.com/browse/genre/11714" target="_blank" rel="noopener"><code>11714</code></a></li><li>ææ€–ç”µè§†èŠ‚ç›® TV horror <a href="https://netflix.com/browse/genre/83059" target="_blank" rel="noopener"><code>83059</code></a></li><li>æ‚¬ç–‘ç”µè§†èŠ‚ç›® TV mysteries <a href="https://netflix.com/browse/genre/4366" target="_blank" rel="noopener"><code>4366</code></a></li><li>ç§‘å¹»å¥‡å¹»é¢˜æç”µè§†å‰§ TV Sci-Fi &amp; fantasy <a href="https://netflix.com/browse/genre/1372" target="_blank" rel="noopener"><code>1372</code></a></li><li>çœŸäººç§€ç”µè§†èŠ‚ç›® Reality TV <a href="https://netflix.com/browse/genre/9833" target="_blank" rel="noopener"><code>9833</code></a></li></ul><h2 id="é’å°‘å¹´ç”µè§†å‰§-60951"><a href="#é’å°‘å¹´ç”µè§†å‰§-60951" class="headerlink" title="é’å°‘å¹´ç”µè§†å‰§ 60951"></a>é’å°‘å¹´ç”µè§†å‰§ <a href="https://netflix.com/browse/genre/60951" target="_blank" rel="noopener"><code>60951</code></a></h2><ul><li>é’å°‘å¹´å–œå‰§ Teen comedies <a href="https://netflix.com/browse/genre/3519" target="_blank" rel="noopener"><code>3519</code></a></li><li>é’å°‘å¹´å‰§æƒ…ç‰‡ Teen dramas <a href="https://netflix.com/browse/genre/9299" target="_blank" rel="noopener"><code>9299</code></a></li><li>é’å°‘å¹´ææ€–ç‰‡ Teen screams <a href="https://netflix.com/browse/genre/52147" target="_blank" rel="noopener"><code>52147</code></a></li></ul><h2 id="å„¿ç«¥-å®¶åº­ç”µå½±-783"><a href="#å„¿ç«¥-å®¶åº­ç”µå½±-783" class="headerlink" title="å„¿ç«¥ å®¶åº­ç”µå½± 783"></a>å„¿ç«¥ å®¶åº­ç”µå½± <a href="https://netflix.com/browse/genre/783" target="_blank" rel="noopener"><code>783</code></a></h2><ul><li>è¿ªå£«å°¼ Disney <a href="https://netflix.com/browse/genre/67673" target="_blank" rel="noopener"><code>67673</code></a></li><li>å„¿ç«¥æ•™è‚² Education for kids <a href="https://netflix.com/browse/genre/10659" target="_blank" rel="noopener"><code>10659</code></a></li><li>ç”µå½±çµæ„Ÿæ¥è‡ªé’å¹´ä¹¦ç± Films inspirÃ©s de livres jeunesse <a href="https://netflix.com/browse/genre/10056" target="_blank" rel="noopener"><code>10056</code></a></li><li>0~2å²ç”µå½± Movies for ages 0 to 2 <a href="https://netflix.com/browse/genre/6796" target="_blank" rel="noopener"><code>6796</code></a></li><li>2~4å²ç”µå½± Movies for ages 2 to 4 <a href="https://netflix.com/browse/genre/6218" target="_blank" rel="noopener"><code>6218</code></a></li><li>5~7å²ç”µå½± Movies for ages 5 to 7 <a href="https://netflix.com/browse/genre/5455" target="_blank" rel="noopener"><code>5455</code></a></li><li>8~10å²ç”µå½± Movies for ages 8 to 10 <a href="https://netflix.com/browse/genre/561" target="_blank" rel="noopener"><code>561</code></a></li><li>11~12å²ç”µå½± Movies for ages 11 to 12 <a href="https://netflix.com/browse/genre/6962" target="_blank" rel="noopener"><code>6962</code></a></li><li>å„¿ç«¥ä¹¦ç±ç”µå½± Movies based on childrenâ€™s books <a href="https://netflix.com/browse/genre/10056" target="_blank" rel="noopener"><code>10056</code></a></li><li>å®¶åº­ç‰¹è‰² Family Features <a href="https://netflix.com/browse/genre/51056" target="_blank" rel="noopener"><code>51056</code></a></li><li>ç”µè§†å¡é€šç‰‡ TV Cartoons <a href="https://netflix.com/browse/genre/11177" target="_blank" rel="noopener"><code>11177</code></a></li><li>å„¿ç«¥ç”µè§† Kidsâ€™ TV <a href="https://netflix.com/browse/genre/27346" target="_blank" rel="noopener"><code>27346</code></a></li><li>å„¿ç«¥éŸ³ä¹ Kids Music <a href="https://netflix.com/browse/genre/52843" target="_blank" rel="noopener"><code>52843</code></a></li><li>åŠ¨ç‰©æ•…äº‹ Animal tales <a href="https://netflix.com/browse/genre/5507" target="_blank" rel="noopener"><code>5507</code></a></li></ul><h2 id="åŠ¨æ¼«-7424"><a href="#åŠ¨æ¼«-7424" class="headerlink" title="åŠ¨æ¼« 7424"></a>åŠ¨æ¼« <a href="https://netflix.com/browse/genre/7424" target="_blank" rel="noopener"><code>7424</code></a></h2><ul><li>åŠ¨æ¼«åŠ¨ä½œ Anime action <a href="https://netflix.com/browse/genre/2653" target="_blank" rel="noopener"><code>2653</code></a></li><li>åŠ¨æ¼«å‰§ Anime dramas <a href="https://netflix.com/browse/genre/452" target="_blank" rel="noopener"><code>452</code></a></li><li>æˆäººåŠ¨ç”» Adult animation <a href="https://netflix.com/browse/genre/11881" target="_blank" rel="noopener"><code>11881</code></a></li><li>åŠ¨ç‰©æ•…äº‹ Animal tales <a href="https://netflix.com/browse/genre/5507" target="_blank" rel="noopener"><code>5507</code></a></li><li>å¹»æƒ³åŠ¨æ¼« Anime fantasy <a href="https://netflix.com/browse/genre/11146" target="_blank" rel="noopener"><code>11146</code></a></li><li>åŠ¨æ¼«ç‰¹è‰² Anime features <a href="https://netflix.com/browse/genre/3063" target="_blank" rel="noopener"><code>3063</code></a></li><li>åŠ¨æ¼«ææ€– Anime horror <a href="https://netflix.com/browse/genre/10695" target="_blank" rel="noopener"><code>10695</code></a></li><li>åŠ¨æ¼«ç§‘å¹» Anime Sci-Fi <a href="https://netflix.com/browse/genre/2729" target="_blank" rel="noopener"><code>2729</code></a></li><li>åŠ¨æ¼«ç³»åˆ— Anime series <a href="https://netflix.com/browse/genre/6721" target="_blank" rel="noopener"><code>6721</code></a></li><li>åŠ¨æ¼«å–œå‰§ Anime comedies <a href="https://netflix.com/browse/genre/9302" target="_blank" rel="noopener"><code>9302</code></a></li></ul><h2 id="ç‹¬ç«‹ç”µå½±-7077"><a href="#ç‹¬ç«‹ç”µå½±-7077" class="headerlink" title="ç‹¬ç«‹ç”µå½± 7077"></a>ç‹¬ç«‹ç”µå½± <a href="https://netflix.com/browse/genre/7077" target="_blank" rel="noopener"><code>7077</code></a></h2><ul><li>ç‹¬ç«‹è¡ŒåŠ¨å’Œå†’é™© Independent action &amp; adventure <a href="https://netflix.com/browse/genre/11804" target="_blank" rel="noopener"><code>11804</code></a></li><li>ç‹¬ç«‹å–œå‰§ Independent comedies <a href="https://netflix.com/browse/genre/4195" target="_blank" rel="noopener"><code>4195</code></a></li><li>ç‹¬ç«‹æˆå‰§ Independent dramas <a href="https://netflix.com/browse/genre/384" target="_blank" rel="noopener"><code>384</code></a></li><li>æµªæ¼«çš„ç‹¬ç«‹ç”µå½± Romantic independent movies <a href="https://netflix.com/browse/genre/9916" target="_blank" rel="noopener"><code>9916</code></a></li><li>ç‹¬ç«‹æƒŠæ‚šç‰‡ Independent thrillers <a href="https://netflix.com/browse/genre/3269" target="_blank" rel="noopener"><code>3269</code></a></li><li>å‰å«ç”µå½± Experimental movies <a href="https://netflix.com/browse/genre/11079" target="_blank" rel="noopener"><code>11079</code></a></li></ul><h2 id="å¤–å›½ç”µå½±-7462"><a href="#å¤–å›½ç”µå½±-7462" class="headerlink" title="å¤–å›½ç”µå½± 7462"></a>å¤–å›½ç”µå½± <a href="https://netflix.com/browse/genre/7462" target="_blank" rel="noopener"><code>7462</code></a></h2><ul><li>å¤–å›½ç‹¬ç«‹å†’é™©ç‰‡ Foreign action &amp; adventure <a href="https://netflix.com/browse/genre/11828" target="_blank" rel="noopener"><code>11828</code></a></li><li>ç»å…¸å¤–å›½ç”µå½± Classic Foreign Movies <a href="https://netflix.com/browse/genre/32473" target="_blank" rel="noopener"><code>32473</code></a></li><li>å¤–å›½å–œå‰§ Foreign comedies <a href="https://netflix.com/browse/genre/4426" target="_blank" rel="noopener"><code>4426</code></a></li><li>å¤–å›½çºªå½•ç‰‡ Foreign documentaries <a href="https://netflix.com/browse/genre/5161" target="_blank" rel="noopener"><code>5161</code></a></li><li>å¤–å›½ç”µè§†å‰§ Foreign dramas <a href="https://netflix.com/browse/genre/2150" target="_blank" rel="noopener"><code>2150</code></a></li><li>å¤–å›½åŒæ€§æ‹ç”µå½± Foreign gay &amp; lesbian movies <a href="https://netflix.com/browse/genre/8243" target="_blank" rel="noopener"><code>8243</code></a></li><li>å¤–å›½ææ€–ç”µå½± Foreign horror movies <a href="https://netflix.com/browse/genre/8654" target="_blank" rel="noopener"><code>8654</code></a></li><li>å¤–å›½ç§‘å¹»å¥‡å¹»ç”µå½± Foreign Sci-Fi &amp; fantasy <a href="https://netflix.com/browse/genre/6485" target="_blank" rel="noopener"><code>6485</code></a></li><li>å¤–å›½æƒŠæ‚šç‰‡ Foreign thrillers <a href="https://netflix.com/browse/genre/10306" target="_blank" rel="noopener"><code>10306</code></a></li><li>å¤–å›½æµªæ¼«çˆ±æƒ…ç”µå½± Romantic foreign movies <a href="https://netflix.com/browse/genre/7153" target="_blank" rel="noopener"><code>7153</code></a></li><li>äºšæ´²åŠ¨ä½œç‰‡ Asian action movies <a href="https://netflix.com/browse/genre/77232" target="_blank" rel="noopener"><code>77232</code></a></li><li>å¾·å›½ç”µå½± German movies <a href="https://netflix.com/browse/genre/58886" target="_blank" rel="noopener"><code>58886</code></a></li><li>æ‹‰ä¸ç¾æ´²ç”µå½± Latin american movies <a href="https://netflix.com/browse/genre/1613" target="_blank" rel="noopener"><code>1613</code></a></li><li>éæ´²ç”µå½± African Movies <a href="https://netflix.com/browse/genre/3761" target="_blank" rel="noopener"><code>3761</code></a></li><li>è‹±å›½ç”µå½± British movies <a href="https://netflix.com/browse/genre/10757" target="_blank" rel="noopener"><code>10757</code></a></li><li>æ¾³å¤§åˆ©äºšç”µå½± Australian movies <a href="https://netflix.com/browse/genre/5230" target="_blank" rel="noopener"><code>5230</code></a></li><li>æ¯”åˆ©æ—¶ç”µå½± Belgian movies <a href="https://netflix.com/browse/genre/262" target="_blank" rel="noopener"><code>262</code></a></li><li>åè¯­ç”µå½± Chinese movies <a href="https://netflix.com/browse/genre/3960" target="_blank" rel="noopener"><code>3960</code></a></li><li>éŸ©å›½ç”µå½± Korean movies <a href="https://netflix.com/browse/genre/5685" target="_blank" rel="noopener"><code>5685</code></a></li><li>è¥¿ç­ç‰™ç”µå½± Spanish movies <a href="https://netflix.com/browse/genre/58741" target="_blank" rel="noopener"><code>58741</code></a></li><li>æ³•å›½ç”µå½± French movies <a href="https://netflix.com/browse/genre/58807" target="_blank" rel="noopener"><code>58807</code></a></li><li>å¸Œè…Šç”µå½± Greek movies <a href="https://netflix.com/browse/genre/61115" target="_blank" rel="noopener"><code>61115</code></a></li><li>å°åº¦ç”µå½± Indian movies <a href="https://netflix.com/browse/genre/10463" target="_blank" rel="noopener"><code>10463</code></a></li><li>çˆ±å°”å…°ç”µå½± Irish movies <a href="https://netflix.com/browse/genre/58750" target="_blank" rel="noopener"><code>58750</code></a></li><li>æ„å¤§åˆ©ç”µå½± Italian Movies <a href="https://netflix.com/browse/genre/8221" target="_blank" rel="noopener"><code>8221</code></a></li><li>æ—¥æœ¬ç”µå½± Japanese movies <a href="https://netflix.com/browse/genre/10398" target="_blank" rel="noopener"><code>10398</code></a></li><li>è·å…°ç”µå½± Dutch movies <a href="https://netflix.com/browse/genre/10606" target="_blank" rel="noopener"><code>10606</code></a></li><li>æ–°è¥¿å…°ç”µå½± New Zealand movies <a href="https://netflix.com/browse/genre/63782" target="_blank" rel="noopener"><code>63782</code></a></li><li>ä¿„ç½—æ–¯ç”µå½± Russian movies <a href="https://netflix.com/browse/genre/11567" target="_blank" rel="noopener"><code>11567</code></a></li><li>æ–¯å ªçš„çº³ç»´äºšç”µå½± Scandinavian movies <a href="https://netflix.com/browse/genre/9292" target="_blank" rel="noopener"><code>9292</code></a></li><li>ä¸­ä¸œç”µå½± Middle Eastern movies <a href="https://netflix.com/browse/genre/5875" target="_blank" rel="noopener"><code>5875</code></a></li><li>ä¸œå—äºšç”µå½± Southeast Asian Movies <a href="https://netflix.com/browse/genre/9196" target="_blank" rel="noopener"><code>9196</code></a></li><li>ä¸œæ¬§ç”µå½± Eastern European movies <a href="https://netflix.com/browse/genre/5254" target="_blank" rel="noopener"><code>5254</code></a></li><li>åœŸè€³å…¶ç”µå½± Turkish movies <a href="https://netflix.com/browse/genre/1133133" target="_blank" rel="noopener"><code>1133133</code></a></li></ul><h2 id="éŸ³ä¹-1701"><a href="#éŸ³ä¹-1701" class="headerlink" title="éŸ³ä¹ 1701"></a>éŸ³ä¹ <a href="https://netflix.com/browse/genre/1701" target="_blank" rel="noopener"><code>1701</code></a></h2><ul><li>ä¸–ç•ŒéŸ³ä¹ä¼š World music concerts <a href="https://netflix.com/browse/genre/2856" target="_blank" rel="noopener"><code>2856</code></a></li><li>æ‘‡æ»šä¸æµè¡ŒéŸ³ä¹ä¸»é¢˜ Rock &amp; pop concerts <a href="https://netflix.com/browse/genre/3278" target="_blank" rel="noopener"><code>3278</code></a></li><li>éƒ½å¸‚ä¸èˆè¹ˆéŸ³ä¹ä¸»é¢˜ Urban &amp; dance concerts <a href="https://netflix.com/browse/genre/9472" target="_blank" rel="noopener"><code>9472</code></a></li><li>å°‘å„¿éŸ³ä¹ä¸»é¢˜ Kids music <a href="https://netflix.com/browse/genre/52843" target="_blank" rel="noopener"><code>52843</code></a></li><li>ä¹¡æ‘ã€è¥¿éƒ¨/æ°‘è°£éŸ³ä¹ä¼š Country &amp; western/folk <a href="https://netflix.com/browse/genre/1105" target="_blank" rel="noopener"><code>1105</code></a></li><li>è½»æ¾çˆµå£«ä¹ Jazz &amp; easy listening <a href="https://netflix.com/browse/genre/10271" target="_blank" rel="noopener"><code>10271</code></a></li><li>æ‹‰ä¸ç¾æ´²éŸ³ä¹ Latin music <a href="https://netflix.com/browse/genre/10741" target="_blank" rel="noopener"><code>10741</code></a></li><li>éŸ³ä¹å‰§ Musicals <a href="https://netflix.com/browse/genre/13335" target="_blank" rel="noopener"><code>13335</code></a></li><li>ç»å…¸éŸ³ä¹å‰§ Classic musicals <a href="https://netflix.com/browse/genre/32392" target="_blank" rel="noopener"><code>32392</code></a></li><li>è¿ªæ–¯å°¼éŸ³ä¹å‰§ Disney musicals <a href="https://netflix.com/browse/genre/59433" target="_blank" rel="noopener"><code>59433</code></a></li><li>å¨±ä¹ä¸šé¢˜æéŸ³ä¹å‰§ Showbiz musicals <a href="https://netflix.com/browse/genre/13573" target="_blank" rel="noopener"><code>13573</code></a></li><li>èˆå°éŸ³ä¹å‰§ Stage musicals <a href="https://netflix.com/browse/genre/55774" target="_blank" rel="noopener"><code>55774</code></a></li></ul><h2 id="åœ£è¯èŠ‚ğŸ…"><a href="#åœ£è¯èŠ‚ğŸ…" class="headerlink" title="åœ£è¯èŠ‚ğŸ…"></a>åœ£è¯èŠ‚ğŸ…</h2><ul><li>é€‚åˆå…¨å®¶è§‚çœ‹çš„åœ£è¯ç”µå½± Family-friendly christmas films <a href="https://netflix.com/browse/genre/1394522" target="_blank" rel="noopener"><code>1394522</code></a></li><li>ç§¯æå‘ä¸Šçš„åœ£è¯é¢˜æå„¿ç«¥å®¶åº­ç”µå½± Feel-good christmas children &amp; family films <a href="https://netflix.com/browse/genre/1475066" target="_blank" rel="noopener"><code>1475066</code></a></li><li>æµªæ¼«çš„åœ£è¯ç”µå½± Romantic christmas films <a href="https://netflix.com/browse/genre/1394527" target="_blank" rel="noopener"><code>1394527</code></a></li><li>åœ£è¯é¢˜æå„¿ç«¥å®¶åº­ç”µå½± Christmas children &amp; family films <a href="https://netflix.com/browse/genre/1474017" target="_blank" rel="noopener"><code>1474017</code></a></li><li>é€‚åˆ5-7å²çš„åœ£è¯èŠ‚å°‘å„¿å®¶åº­ç”µå½± Christmas children &amp; family films for ages 5 to 7 <a href="https://netflix.com/browse/genre/1477201" target="_blank" rel="noopener"><code>1477201</code></a></li><li>é€‚åˆ8-10å²çš„åœ£è¯èŠ‚å°‘å„¿å®¶åº­ç”µå½± Christmas children &amp; family films for ages 8 to 10 <a href="https://netflix.com/browse/genre/1477204" target="_blank" rel="noopener"><code>1477204</code></a></li><li>é€‚åˆ10-12å²çš„åœ£è¯èŠ‚å°‘å„¿å®¶åº­ç”µå½± Christmas children &amp; family films for ages 11 to 12 <a href="https://netflix.com/browse/genre/1477206" target="_blank" rel="noopener"><code>1477206</code></a></li><li>æ»‘ç¨½çš„åœ£è¯èŠ‚å°‘å„¿å®¶åº­ç”µå½± Goofy christmas children &amp; family films <a href="https://netflix.com/browse/genre/1475071" target="_blank" rel="noopener"><code>1475071</code></a></li><li>1990å¹´ä»£åœ£è¯èŠ‚å°‘å„¿å®¶åº­ç”µå½± Christmas children &amp; family films from the 1990s <a href="https://netflix.com/browse/genre/1476024" target="_blank" rel="noopener"><code>1476024</code></a></li><li>è‹±å›½åœ£è¯èŠ‚å°‘å„¿å®¶åº­ç”µå½± British christmas children &amp; family Ffilms <a href="https://netflix.com/browse/genre/1527064" target="_blank" rel="noopener"><code>1527064</code></a></li><li>æ¬§æ´²åœ£è¯èŠ‚å°‘å„¿å®¶åº­ç”µå½± European christmas children &amp; family films <a href="https://netflix.com/browse/genre/1527063" target="_blank" rel="noopener"><code>1527063</code></a></li><li>åŠ æ‹¿å¤§åœ£è¯èŠ‚å°‘å„¿å®¶åº­ç”µå½± Canadian christmas children &amp; family films <a href="https://netflix.com/browse/genre/1721544" target="_blank" rel="noopener"><code>1721544</code></a></li></ul><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><ul><li>è‰ºæœ¯ç”µå½± Art House Movies <a href="https://netflix.com/browse/genre/29764" target="_blank" rel="noopener"><code>29764</code></a></li><li>å²è¯—é¢˜æç”µå½± Epics <a href="https://netflix.com/browse/genre/52858" target="_blank" rel="noopener"><code>52858</code></a></li><li>å¸®æ´¾ç”µå½± Gangster movies <a href="https://netflix.com/browse/genre/31851" target="_blank" rel="noopener"><code>31851</code></a></li><li>å¥‡å¹»é¢˜æç”µå½± Fantasy movies <a href="https://netflix.com/browse/genre/9744" target="_blank" rel="noopener"><code>9744</code></a></li><li>é»‘è‰²ç”µå½± Film noir <a href="https://netflix.com/browse/genre/7687" target="_blank" rel="noopener"><code>7687</code></a></li><li>å‰å«ç”µå½± Experimental movies <a href="https://netflix.com/browse/genre/11079" target="_blank" rel="noopener"><code>11079</code></a></li><li>ä¿¡ä»°ä¸ç²¾ç¥é¢˜æç”µå½± Faith &amp; spirituality movies <a href="https://netflix.com/browse/genre/52804" target="_blank" rel="noopener"><code>52804</code></a></li><li>é­”é¬¼æ’’æ—¦é¢˜æææ€–ç‰‡ Satanic stories <a href="https://netflix.com/browse/genre/6998" target="_blank" rel="noopener"><code>6998</code></a></li><li>è®½åˆºæ»‘ç¨½ Satires <a href="https://netflix.com/browse/genre/4922" target="_blank" rel="noopener"><code>4922</code></a></li><li>å•å£å–œå‰§ Stand-up comedies <a href="https://netflix.com/browse/genre/11559" target="_blank" rel="noopener"><code>11559</code></a></li></ul><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://digitalimmigrant.org/16" target="_blank" rel="noopener">https://digitalimmigrant.org/16</a></li></ul>]]></content>
      
        <categories>
            
            <category> tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Netflix </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æ•°æ®ç§»æ°‘æ¼‚æµè®°â€”â€”å¦‚ä½•è¿›è¡ŒiCloudè½¬åŒºæ“ä½œ]]></title>
      <url>/posts/How-to-change-icloud-region.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/china-eye.jpg?imageslim" alt="china-eye"></p><a id="more"></a><h2 id="ä¸ºä»€ä¹ˆè¦è½¬åŒº"><a href="#ä¸ºä»€ä¹ˆè¦è½¬åŒº" class="headerlink" title="ä¸ºä»€ä¹ˆè¦è½¬åŒº"></a>ä¸ºä»€ä¹ˆè¦è½¬åŒº</h2><p><img src="https://img.i7years.com/blog/change-region-107.jpg" alt="change-region-107"></p><p>å…·ä½“åŸå› å¤§å®¶éƒ½å¿ƒçŸ¥è‚šæ˜ï¼Œåœ¨å¤©æœï¼Œä½ æ‡‚çš„ï¼Œä¸ªäººæ•°æ®éšç§å®‰å…¨ä¸€ä¸ç‚¹çš„ä¿éšœéƒ½æ²¡æœ‰ã€‚é€šè¿‡iCloudç›‘æ§ä¸€ä¸ªäººå®åœ¨å¤ªå½»åº•äº†ï¼Œä½ çš„å®æ—¶åœ°ç†ä½ç½®ã€ä½ çš„é€šè®¯å½•è”ç³»äººã€ä½ æœ€æ–°æ‹çš„ç…§ç‰‡ã€ä½ çš„å¤‡å¿˜å½•ã€ä½ çš„åº”ç”¨ç¨‹åºé‡Œè®°å½•çš„æ•°æ®ã€ä½ çš„é‚®ä»¶ç­‰ç­‰ï¼Œå…¨éƒ½å¯ä»¥å®æ—¶ç›‘æ§ã€‚</p><p>è‡ªä»äº‘ä¸Šè´µå·æ‰˜ç®¡iCloudä¹‹åï¼Œå°±æš´éœ²å‡ºäº†Apple IDè¢«ç›—ï¼Œå¤§é‡åƒåœ¾å¹¿å‘ŠçŸ­ä¿¡ç­‰ç­‰é—®é¢˜ï¼Œå¤§å®¶å¯è‡ªè¡ŒGoogleä¸€ä¸‹ç›¸å…³æ–°é—»ã€‚</p><p>æ‹¿ç€æˆ‘ä»¬çš„æ•°æ®åœ¨èƒŒåè¿˜å¹²äº†å“ªäº›ä¸ä¸ºäººçŸ¥çš„äº‹æƒ…ï¼Œå¯èƒ½è¦è¿‡å¾ˆå¤šå¹´ä¹‹åæ‰èƒ½æ­æ™“ã€‚</p><h2 id="å‰ç½®å‡†å¤‡"><a href="#å‰ç½®å‡†å¤‡" class="headerlink" title="å‰ç½®å‡†å¤‡"></a>å‰ç½®å‡†å¤‡</h2><ul><li><a href="https://wangwei.one/posts/How-to-register-and-use-the-US-Apple-ID.html">ç¾åŒºAppleID</a></li><li><a href="https://wangwei.one/posts/How-to-register-for-the-US-PayPal-and-bind-the-US-Apple-ID.html">ç¾åŒºPayPal</a> ï¼ˆéå¿…é¡»ï¼Œå¯ä»¥è´­ä¹° <a href="https://www.apple.com/us/shop/gift-cards" target="_blank" rel="noopener">Gift Card</a> ä»£æ›¿å……å€¼ï¼‰</li><li><a href="https://wangwei.one/posts/build-your-own-vpn-by-shadowsocks-or-rixcloud.html">ç¾åŒºVPN</a> ï¼Œå¼€å¯å…¨å±€ä»£ç†ã€‚</li><li>ç¾åŒºAppleIDçš„iCloudå­˜å‚¨ç©ºé—´å‡çº§ä¸º50GBï¼ˆ$0.99/monthï¼‰ã€‚æ”¯ä»˜æ–¹å¼å¯ä»¥ç”¨ç¾åŒºPayPalæˆ–Gift Cardï¼Œçœ‹ä½ å“ªä¸ªæ–¹ä¾¿ã€‚ï¼ˆç¾åŒºPayPalé£æ§è¾ƒä¸¥ï¼Œè´¦æˆ·è¢«é™åˆ¶çš„å‡ ç‡å¾ˆå¤§ï¼Œå»ºè®®ä½¿ç”¨Gift Cardæ¥å……å€¼ã€‚ï¼‰</li></ul><blockquote><p>æ³¨æ„ï¼šä¸å»ºè®®ç›´æ¥æ›´æ¢å›½åŒºApple IDçš„åœ°åŸŸæ”¹ä¸ºç¾åŒºï¼Œå»ºè®®è¿ç§»åˆ°æ–°å»ºçš„ç¾åŒºAppleIDä¸Š</p></blockquote><h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>åœç”¨ iCloud è½¬å…¥æ–° ID çš„è¿‡ç¨‹æ˜¯ç—›è‹¦çš„ï¼Œåœ¨å¼€å¯æ–° ID ä½¿ç”¨å‰ä½ éœ€è¦å°†è€ ID é‡Œçš„ç…§ç‰‡ã€é‚®ä»¶ã€é€šè®¯å½•ã€æ—¥å†ã€iCloud äº‘ç›˜ã€å¤‡å¿˜å½•ã€æé†’äº‹é¡¹ç­‰ç­‰å„ç§æ•°æ®è½¬ç§»è¿‡æ¥ï¼Œæœ‰äº›ä¸èƒ½è½¬ç§»ï¼Œéœ€è¦å…ˆå¯¼å‡ºå¤‡ä»½åˆ°æœ¬åœ°ï¼Œç„¶ååŒæ­¥åˆ°æ–° ID ä¸Šæ‰è¡Œã€‚</p><p>åœ¨ macOS ä¸Šã€Œç³»ç»Ÿåå¥½è®¾ç½® - iCloud - å­˜å‚¨ç®¡ç†ã€å¯ä»¥æŸ¥çœ‹ç›®å‰iCloudä¸­å­˜å‚¨äº†ä½¿ç”¨æƒ…å†µï¼Œä¾‹å¦‚ï¼š</p><p><img src="https://img.i7years.com/blog/change-region-101.png" alt="change-region-101"></p><p>åœ¨è¿›è¡Œæ•°æ®è½¬ç§»ã€å¤‡ä»½ç­‰å„ç§å·¥ä½œå‰ï¼Œå…ˆå°†å›½åŒº ID çš„ iCloud ä»˜è´¹æ–¹æ¡ˆå–æ¶ˆï¼Œ<a href="https://support.apple.com/zh-cn/HT207594" target="_blank" rel="noopener">é™çº§ä¼šå…è´¹çš„ 5GB æ–¹æ¡ˆ</a> ï¼Œè¿™ä¸­é—´è¿˜æœ‰ä¸€ä¸ªå……åˆ†çš„æ•°æ®è½¬ç§»æ—¶é—´ï¼Œè¿‡äº†æˆªå›¾ä¸­æç¤ºçš„ä»˜è´¹æ–¹æ¡ˆç»“æŸæ—¶é—´ï¼Œå¤šä½™çš„æ•°æ®ä¼šè¢«åˆ é™¤ï¼Œåœ¨ iPhone ä¸Šç›´æ¥é€‰æ‹©é€€å‡ºå½“å‰ iCloud è´¦æˆ·åï¼Œç³»ç»Ÿä¼šæç¤ºæ˜¯å¦ä¿ç•™ã€Œæé†’äº‹é¡¹ã€ã€ã€Œé€šè®¯å½•ã€ã€ã€ŒSafari æµè§ˆå™¨ã€çš„æ•°æ®å‰¯æœ¬åœ¨ iPhoneï¼Œå¯ä»¥é€‰æ‹©ä¿ç•™ï¼Œè¿™æ ·ç™»å½•æ–° ID æ—¶å¯è‡ªåŠ¨åˆå¹¶è¿›å»ã€‚</p><p><img src="https://img.i7years.com/blog/change-region-106.png" alt="change-region-106"></p><h2 id="ç…§ç‰‡"><a href="#ç…§ç‰‡" class="headerlink" title="ç…§ç‰‡"></a>ç…§ç‰‡</h2><h4 id="å¤‡ä»½"><a href="#å¤‡ä»½" class="headerlink" title="å¤‡ä»½"></a>å¤‡ä»½</h4><p>åœ¨macOSä¸Šå¯¼å‡ºç…§ç‰‡æœ€ä¸ºæ–¹ä¾¿ï¼Œåœ¨ã€Œç…§ç‰‡ã€åº”ç”¨ä¸Šå…¨é€‰æ‰€æœ‰ç…§ç‰‡ï¼Œç„¶åé€‰æ‹©ã€Œæ–‡ä»¶ â€“ å¯¼å‡º â€“ å¯¼å‡ºç…§ç‰‡ã€ï¼Œé€‰æ‹©ä¸€ä¸ªæœ¬åœ°ä¿å­˜ç›®å½•åè¿›è¡Œå¯¼å‡ºå³å¯ã€‚</p><p>æŒ‰åŸæ–‡ä»¶æ ¼å¼å¯¼å‡º</p><p><img src="https://img.i7years.com/blog/change-region-102.png" alt="change-region-102"></p><p><img src="https://img.i7years.com/blog/change-region-103.png" alt="change-region-103"></p><h4 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h4><p>å°†å›½åŒºApple IDä¸­çš„ç…§ç‰‡å…¨éƒ¨æ¸…ç©ºã€‚</p><h5 id="åˆ é™¤iCloudä¸­çš„ç…§ç‰‡æ•°æ®"><a href="#åˆ é™¤iCloudä¸­çš„ç…§ç‰‡æ•°æ®" class="headerlink" title="åˆ é™¤iCloudä¸­çš„ç…§ç‰‡æ•°æ®"></a>åˆ é™¤iCloudä¸­çš„ç…§ç‰‡æ•°æ®</h5><p>åœ¨ macOS ä¸Šã€Œç³»ç»Ÿåå¥½è®¾ç½® - iCloud - å­˜å‚¨ç®¡ç†ã€ï¼Œé€‰æ‹©ã€ŒiCloud Photosã€ï¼Œæ‰§è¡Œã€ŒDisable and Deleteã€ã€‚ä½ æœ‰30 å¤©çš„æ—¶é—´æ¥ä¸‹è½½ä½ çš„ç…§ç‰‡ä»¥åŠè§†é¢‘ã€‚</p><p><img src="https://img.i7years.com/blog/change-region-105.png" alt="change-region-105"></p><p>ä½ ä¼šæ”¶åˆ°å¦‚ä¸‹é‚®ä»¶é€šçŸ¥</p><blockquote><p>åŸæ ¼å¼ï¼Œå…¨åˆ†è¾¨ç‡çš„ç…§ç‰‡å’Œè§†é¢‘å¹¶æœªå­˜å‚¨åœ¨ä½ çš„è®¾å¤‡ä¸Šã€‚ä½ éœ€è¦åœ¨30å¤©ä¹‹å†…ä¸‹è½½å®ƒä»¬åˆ°ä½ æœ¬åœ°çš„è®¾å¤‡ä¸Šã€‚</p></blockquote><p><img src="https://img.i7years.com/blog/change-region-110.png" alt="change-region-110"></p><h5 id="åˆ é™¤æœ¬åœ°ç…§ç‰‡åº“"><a href="#åˆ é™¤æœ¬åœ°ç…§ç‰‡åº“" class="headerlink" title="åˆ é™¤æœ¬åœ°ç…§ç‰‡åº“"></a>åˆ é™¤æœ¬åœ°ç…§ç‰‡åº“</h5><p>å°†æœ¬åœ°çš„ç…§ç‰‡åº“ã€ŒPhotos Library.photoslibraryã€åˆ é™¤æ‰ã€‚</p><p><img src="https://img.i7years.com/blog/change-region-104.png" alt="change-region-104"></p><p>é‡æ–°æ‰“å¼€ã€ŒPhotos ã€ï¼Œä¼šæç¤ºä½ é‡æ–°åˆ›å»ºä¸€ä¸ªç…§ç‰‡åº“ï¼ŒæŒ‰ç…§å®ƒçš„æŒ‡å¼•é»˜è®¤åˆ›å»ºä¸€ä¸ªå³å¯ã€‚ç„¶åã€ŒPhotos - Preferences - Generalã€å°†æ–°åˆ›å»ºçš„ç…§ç‰‡åº“è®¾ç½®ä¸ºç³»ç»Ÿé»˜è®¤ç…§ç‰‡åº“ã€ŒUse as System Photo Libraryã€ã€‚</p><p><img src="https://img.i7years.com/blog/change-region-113.png" alt="change-region-113"></p><h4 id="å¯¼å…¥"><a href="#å¯¼å…¥" class="headerlink" title="å¯¼å…¥"></a>å¯¼å…¥</h4><p>è¿›å…¥ã€ŒSystem Preferences - iCloudã€ï¼Œç™»å½•ç¾åŒºApple IDã€‚</p><p>å¯¼å…¥æ–° ID çš„ iCloud ç…§ç‰‡å›¾åº“æ—¶ç›´æ¥é€‰æ‹©ã€Œå¯¼å…¥ã€ï¼Œæˆ–æ˜¯ç›´æ¥ä»æœ¬åœ°ç›®å½•å…¨é€‰å¯¼å‡ºçš„å›¾ç‰‡æ•°æ®ç›´æ¥æ‹–å…¥ã€Œç…§ç‰‡ã€åº”ç”¨ï¼Œæ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯éå¸¸æµç•…çš„ã€‚</p><p><img src="https://img.i7years.com/blog/change-region-111.png" alt="change-region-111"></p><p>åœ¨ iPhoneã€iPad ä¸Šæ“ä½œè¿™äº›æ­¥éª¤ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨ iCloud é‡Œæ‰“å¼€ã€Œç…§ç‰‡ã€ç›®å½•ï¼Œåœ¨å…³é—­ã€ŒiCloud ç…§ç‰‡å›¾åº“ã€å‰é€‰æ‹©ã€Œä¸‹è½½å¹¶ä¿ç•™åŸä»¶ã€ï¼Œè¿™æ ·æ‰€æœ‰å›¾ç‰‡ä¼šè¢«ä¸‹è½½åˆ° iPhone æœ¬åœ°ï¼ˆå‰ææ˜¯ä½ çš„è®¾å¤‡å®¹é‡è¶³å¤Ÿï¼Œ16GBå›°éš¾äº›â€¦ï¼‰ï¼Œç„¶ååˆ° iCloud å­˜å‚¨ç©ºé—´é‡Œè¿›å…¥ã€Œç…§ç‰‡ã€ä¸€é¡¹ï¼Œé€‰æ‹©ã€Œåœç”¨å¹¶åˆ é™¤ã€ã€‚</p><p><img src="https://img.i7years.com/blog/change-region-04.jpg" alt="img"></p><p>æ“ä½œåä½ æœ‰ 30 å¤©çš„æ—¶é—´åœ¨éšæ—¶ä¸‹è½½ç…§ç‰‡ï¼Œè¿‡åè‡ªåŠ¨åˆ é™¤ã€‚æœ€åä½¿ç”¨æ–° ID ç™»å½•è®¾å¤‡å³å¯ï¼Œè‡ªåŠ¨ä¼šä¸Šä¼ æœ¬åœ°ç…§ç‰‡åˆ°æ–° IDï¼ˆåˆ«å¿˜äº†æ‰“å¼€ iCloud ç…§ç‰‡å›¾åº“åŒæ­¥å¼€å…³ï¼‰</p><h2 id="iBooks"><a href="#iBooks" class="headerlink" title="iBooks"></a>iBooks</h2><h4 id="å¤‡ä»½-1"><a href="#å¤‡ä»½-1" class="headerlink" title="å¤‡ä»½"></a>å¤‡ä»½</h4><p>iBooksä¸Šæ²¡æœ‰ç±»ä¼¼äºã€Œç…§ç‰‡ã€çš„å¯¼å‡ºæ“ä½œï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯æ‰‹åŠ¨çš„æ–¹å¼ï¼Œå°†iBooksä¸­çš„epubå…¨éƒ¨æ‹–æ‹½åˆ°æœ¬åœ°è¿›è¡Œå¤‡ä»½ã€‚</p><h4 id="åˆ é™¤-1"><a href="#åˆ é™¤-1" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h4><p>åˆ é™¤iCloudä¸­çš„iBooksæ•°æ®</p><p><img src="https://img.i7years.com/blog/change-region-108.png" alt="change-region-108"></p><h4 id="å¯¼å…¥-1"><a href="#å¯¼å…¥-1" class="headerlink" title="å¯¼å…¥"></a>å¯¼å…¥</h4><p>ç™»å½•ç¾åŒºApple IDï¼Œå°†å¤‡ä»½çš„epubé‡æ–°æ‹–æ‹½åˆ°iBooksä¸­å»ã€‚</p><h2 id="é‚®ä»¶"><a href="#é‚®ä»¶" class="headerlink" title="é‚®ä»¶"></a>é‚®ä»¶</h2><p>å…¶å®ã€Œç…§ç‰‡ã€æ•°æ®çš„æ¬å®¶å¹¶ä¸ç®—æœ€éº»çƒ¦çš„ï¼Œæœ€è´¹æ—¶é—´è´¹ç²¾åŠ›çš„æ˜¯ã€Œé‚®ä»¶ã€ï¼Œå›½åŒº iCloud è¢«æ¥ç®¡åï¼Œä½ çš„ iCloud é‚®ç®±æ²¡æœ‰ä»»ä½•éšç§ï¼Œç”¨å®˜ç½‘çš„è¯è¯´å°±æ˜¯è¢«ã€Œçº¦æŸã€ï¼Œæ‰€ä»¥è¿™ä¸ªé‚®ç®±ä¹Ÿä¸èƒ½ç”¨äº†ï¼Œå¿…é¡»å°†é‚®ä»¶å¯¼å‡ºåå…¨éƒ¨åˆ é™¤ï¼Œåªæ˜¯åç»­ä½ éœ€è¦åˆ°ç›¸å…³çš„ç½‘ç«™ã€APPé‡Œå°†è®¢é˜…é‚®ç®±æ¢ä¸€ä¸‹ã€‚</p><p>ç§»åŠ¨ã€å¤‡ä»½ iCloud é‚®ä»¶éœ€è¦åœ¨ macOS ä¸Šæ“ä½œï¼Œéœ€è¦åœ¨ OS X v10.7.5 æˆ–æ›´é«˜ç‰ˆæœ¬é‡Œæ‰“å¼€â€œé‚®ä»¶â€åº”ç”¨æ“ä½œï¼Œä¸¤ç§æ–¹å¼å¯é€‰ï¼š</p><h3 id="å°†ç”µå­é‚®ä»¶ä»-iCloud-ç§»åŠ¨æˆ–æ‹·è´åˆ°-Mac-æœ¬åœ°ï¼ˆä»¥ä¸‹æ­¥éª¤æ‘˜è‡ªå®˜ç½‘æ•™ç¨‹ï¼‰"><a href="#å°†ç”µå­é‚®ä»¶ä»-iCloud-ç§»åŠ¨æˆ–æ‹·è´åˆ°-Mac-æœ¬åœ°ï¼ˆä»¥ä¸‹æ­¥éª¤æ‘˜è‡ªå®˜ç½‘æ•™ç¨‹ï¼‰" class="headerlink" title="å°†ç”µå­é‚®ä»¶ä» iCloud ç§»åŠ¨æˆ–æ‹·è´åˆ° Mac æœ¬åœ°ï¼ˆä»¥ä¸‹æ­¥éª¤æ‘˜è‡ªå®˜ç½‘æ•™ç¨‹ï¼‰"></a>å°†ç”µå­é‚®ä»¶ä» iCloud ç§»åŠ¨æˆ–æ‹·è´åˆ° Mac æœ¬åœ°ï¼ˆä»¥ä¸‹æ­¥éª¤æ‘˜è‡ªå®˜ç½‘æ•™ç¨‹ï¼‰</h3><ul><li>1 åœ¨â€œé‚®ä»¶â€ä¸­ï¼Œé€‰å–â€œé‚®ç®±â€&gt;â€œæ–°é‚®ç®±â€ã€‚</li><li>2 æ­¤æ—¶å°†æ‰“å¼€â€œæ–°é‚®ç®±â€å¯¹è¯æ¡†ã€‚ä»â€œä½ç½®â€å¼¹å‡ºå¼èœå•ä¸­é€‰å–â€œæˆ‘çš„ Mac ä¸Šâ€ï¼Œç„¶åè¾“å…¥æ–°é‚®ç®±çš„åç§°ã€‚ç‚¹æŒ‰â€œå¥½â€ã€‚</li><li>3 åœ¨è¾¹æ çš„é‚®ç®±åˆ—è¡¨ä¸­é€‰æ‹©æ‚¨çš„ iCloud æ”¶ä»¶ç®±ï¼Œç„¶åé€‰æ‹©è¦ç§»åŠ¨çš„é‚®ä»¶ã€‚</li><li>4 è¦ç§»åŠ¨é‚®ä»¶ï¼Œè¯·å°†æ‰€é€‰ï¼ˆå…¨é€‰ï¼‰é‚®ä»¶æ‹–ç§»åˆ°æ–°é‚®ç®±ã€‚æˆ–é€‰å–â€œé‚®ä»¶â€&gt;â€œç§»åˆ°â€&gt; æ‚¨çš„æ–°é‚®ç®±ã€‚</li><li>5 è¦æ‹·è´é‚®ä»¶ï¼Œè¯·åœ¨å°†æ‰€é€‰é‚®ä»¶æ‹–ç§»åˆ°æ–°é‚®ç®±çš„åŒæ—¶æŒ‰ä½ Option é”®ã€‚æˆ–é€‰å–â€œé‚®ä»¶â€&gt;â€œæ‹·è´åˆ°â€&gt; æ‚¨çš„æ–°é‚®ç®±ã€‚</li></ul><h3 id="ç›´æ¥å°†æ•´ä¸ª-iCloud-é‚®ç®±å¤‡ä»½åï¼ˆåŒ…æ‹¬é‚®ç®±ä¸­çš„æ‰€æœ‰é‚®ä»¶å’Œæ–‡ä»¶å¤¹ï¼‰ï¼Œç„¶åå¯¼å‡ºåˆ°æœ¬åœ°ï¼Œå½¢æˆä¸€ä¸ªä»¥ã€ŒINBOX-partial-mboxã€å‘½åçš„å¤‡ä»½æ–‡ä»¶ã€‚ï¼ˆä»¥ä¸‹æ­¥éª¤æ‘˜è‡ªå®˜ç½‘æ•™ç¨‹ï¼‰"><a href="#ç›´æ¥å°†æ•´ä¸ª-iCloud-é‚®ç®±å¤‡ä»½åï¼ˆåŒ…æ‹¬é‚®ç®±ä¸­çš„æ‰€æœ‰é‚®ä»¶å’Œæ–‡ä»¶å¤¹ï¼‰ï¼Œç„¶åå¯¼å‡ºåˆ°æœ¬åœ°ï¼Œå½¢æˆä¸€ä¸ªä»¥ã€ŒINBOX-partial-mboxã€å‘½åçš„å¤‡ä»½æ–‡ä»¶ã€‚ï¼ˆä»¥ä¸‹æ­¥éª¤æ‘˜è‡ªå®˜ç½‘æ•™ç¨‹ï¼‰" class="headerlink" title="ç›´æ¥å°†æ•´ä¸ª iCloud é‚®ç®±å¤‡ä»½åï¼ˆåŒ…æ‹¬é‚®ç®±ä¸­çš„æ‰€æœ‰é‚®ä»¶å’Œæ–‡ä»¶å¤¹ï¼‰ï¼Œç„¶åå¯¼å‡ºåˆ°æœ¬åœ°ï¼Œå½¢æˆä¸€ä¸ªä»¥ã€ŒINBOX.partial.mboxã€å‘½åçš„å¤‡ä»½æ–‡ä»¶ã€‚ï¼ˆä»¥ä¸‹æ­¥éª¤æ‘˜è‡ªå®˜ç½‘æ•™ç¨‹ï¼‰"></a>ç›´æ¥å°†æ•´ä¸ª iCloud é‚®ç®±å¤‡ä»½åï¼ˆåŒ…æ‹¬é‚®ç®±ä¸­çš„æ‰€æœ‰é‚®ä»¶å’Œæ–‡ä»¶å¤¹ï¼‰ï¼Œç„¶åå¯¼å‡ºåˆ°æœ¬åœ°ï¼Œå½¢æˆä¸€ä¸ªä»¥ã€ŒINBOX.partial.mboxã€å‘½åçš„å¤‡ä»½æ–‡ä»¶ã€‚ï¼ˆä»¥ä¸‹æ­¥éª¤æ‘˜è‡ªå®˜ç½‘æ•™ç¨‹ï¼‰</h3><ul><li>1 åœ¨è¾¹æ çš„é‚®ç®±åˆ—è¡¨ä¸­é€‰æ‹©æ‚¨çš„ iCloud æ”¶ä»¶ç®±ã€‚</li><li>2 é€‰å–â€œé‚®ç®±â€&gt;â€œå¯¼å‡ºé‚®ç®±â€ã€‚</li><li>3 é€‰å–è¯¥ mbox å½’æ¡£çš„ç›®æ ‡æ–‡ä»¶å¤¹ï¼Œç„¶åç‚¹æŒ‰â€œé€‰å–â€ä»¥è¿›è¡Œå­˜å‚¨ã€‚</li></ul><p><img src="https://img.i7years.com/blog/change-region-05.jpg" alt="img"></p><h2 id="iTunes-è´­ä¹°é¡¹ç›®"><a href="#iTunes-è´­ä¹°é¡¹ç›®" class="headerlink" title="iTunes è´­ä¹°é¡¹ç›®"></a>iTunes è´­ä¹°é¡¹ç›®</h2><p>å…¶å®å®˜ç½‘è¿˜æä¾›äº† iTunes è´­ä¹°é¡¹ç›®çš„å¤‡ä»½å’Œæ¢å¤ï¼Œä½†æˆ‘è¿˜æ˜¯è®¡åˆ’ä¾ç„¶ç•™åœ¨å›½åŒº Apple Musicï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†å°±ä¸æŠ˜è…¾äº†ã€‚æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥çœ‹çœ‹<a href="https://support.apple.com/zh-cn/HT201625" target="_blank" rel="noopener">å®˜ç½‘çš„æ•™ç¨‹</a>ã€‚</p><h2 id="æ—¥å†"><a href="#æ—¥å†" class="headerlink" title="æ—¥å†"></a>æ—¥å†</h2><p>Apple çš„æ—¥å†æˆ‘å¾ˆå°‘ä½¿ç”¨ï¼Œæ—¥å†çš„æ•°æ®å¯¼å‡ºå¯ä»¥ä» Mac æˆ– iCloud.com é‡Œå®Œæˆï¼š</p><h3 id="åœ¨-Mac-ä¸Šå¯¼å‡ºæ—¥å†"><a href="#åœ¨-Mac-ä¸Šå¯¼å‡ºæ—¥å†" class="headerlink" title="åœ¨ Mac ä¸Šå¯¼å‡ºæ—¥å†"></a>åœ¨ Mac ä¸Šå¯¼å‡ºæ—¥å†</h3><ul><li>1 åœ¨â€œæ—¥å†â€ä¸­ï¼Œç‚¹æŒ‰æ—¥å†çš„åç§°ã€‚å¦‚æœæ‚¨æ²¡æœ‰çœ‹åˆ°æ—¥å†ï¼Œè¯·ç‚¹æŒ‰â€œæ—¥å†â€ã€‚</li><li>2 é€‰å–â€œæ–‡ä»¶â€&gt;â€œå¯¼å‡ºâ€&gt;â€œå¯¼å‡ºâ€ã€‚</li><li>3 ä¸ºæ–‡ä»¶é€‰å–ä¸€ä¸ªä½ç½®ï¼Œç„¶åç‚¹æŒ‰â€œå¯¼å‡ºâ€ã€‚</li></ul><h3 id="ä»-iCloud-com-ä¸‹è½½æ—¥å†"><a href="#ä»-iCloud-com-ä¸‹è½½æ—¥å†" class="headerlink" title="ä» iCloud.com ä¸‹è½½æ—¥å†"></a>ä» iCloud.com ä¸‹è½½æ—¥å†</h3><ul><li>1 ä½¿ç”¨ Apple ID ç™»å½• iCloud.comï¼Œæ‰“å¼€â€œæ—¥å†â€ã€‚</li><li>2 å…¬å¼€å…±äº«æ—¥å†ã€‚</li><li>3 æ‹·è´å…±äº«æ—¥å†çš„ URLï¼Œç„¶åå°†å®ƒç²˜è´´åˆ°æµè§ˆå™¨çš„åœ°å€æ ä¸­ã€‚è¯·å‹¿æŒ‰ä¸‹ Enter æˆ– Return é”®ã€‚</li><li>4 å°†â€œwebcalâ€æ›´æ”¹ä¸ºâ€œhttpâ€ï¼Œç„¶åæŒ‰ä¸‹ Enter æˆ– Return é”®ã€‚ICS æ–‡ä»¶å°†ä¸‹è½½åˆ°æ‚¨çš„é»˜è®¤ä¸‹è½½ä½ç½®ã€‚</li><li>5 å°†æ—¥å†æ·»åŠ åˆ°æ—¥å†å®¢æˆ·ç«¯ï¼Œå¦‚ Mac ä¸Šçš„â€œæ—¥å†â€æˆ– Windows ç”µè„‘ä¸Šçš„ Outlookã€‚</li><li>6 åœæ­¢å…±äº«æ—¥å†ã€‚</li></ul><h2 id="å¤‡å¿˜å½•"><a href="#å¤‡å¿˜å½•" class="headerlink" title="å¤‡å¿˜å½•"></a>å¤‡å¿˜å½•</h2><p>å¤‡å¿˜å½•çš„æƒ…å†µæ¯”è¾ƒç‰¹æ®Šï¼Œä¸ä¼šå’Œ Safari æµè§ˆå™¨ï¼Œé€šè®¯å½•é‚£æ ·è‡ªåŠ¨ä¿å­˜ä¸ºå‰¯æœ¬ç•™åœ¨è®¾å¤‡ä¸Šï¼Œéœ€è¦ä» iCloud ç›®å½•é‡Œå°†æ‰€æœ‰çš„å¤‡å¿˜å½•å…¨é€‰åç§»åŠ¨åˆ°ã€Œæˆ‘çš„ iPhone ã€ä¸‹å±æ–‡ä»¶å¤¹æ‰è¡Œï¼Œç­‰ç™»å½•æ–° ID åå†å°†å…¶ç§»å› iCloud ç›®å½•å³å¯ã€‚</p><p><img src="https://img.i7years.com/blog/change-region-06.jpg" alt="img"></p><h2 id="å…¶ä»–é¡¹ç›®"><a href="#å…¶ä»–é¡¹ç›®" class="headerlink" title="å…¶ä»–é¡¹ç›®"></a>å…¶ä»–é¡¹ç›®</h2><p>æ–‡ç« å¼€å¤´æ›¾æåˆ°äº†åƒã€Œæé†’äº‹é¡¹ã€ã€ã€Œé€šè®¯å½•ã€ã€ã€ŒSafari æµè§ˆå™¨ã€è¿™ç§æ•°æ®æ˜¯å¯ä»¥å¹³æ»‘è¿‡åº¦åˆ°æ–° iCloud ID ä¸Šçš„ï¼Œä½†æ˜¯å¦‚æœä½ æƒ³å°†ä»–ä»¬å¯¼å‡ºåˆ°æœ¬åœ°è®¾å¤‡å½’æ¡£ï¼Œå¯ä»¥ç”¨ Mac è¯•è¯•ï¼š</p><h3 id="æé†’äº‹é¡¹"><a href="#æé†’äº‹é¡¹" class="headerlink" title="æé†’äº‹é¡¹"></a>æé†’äº‹é¡¹</h3><p>åœ¨ Mac ä¸Šå¯¼å‡ºâ€œæé†’äº‹é¡¹â€çš„å‰¯æœ¬ï¼š</p><ul><li>1 æ‰“å¼€â€œæé†’äº‹é¡¹â€ã€‚</li><li>2 å‰å¾€è¦å¯¼å‡ºçš„æé†’äº‹é¡¹åˆ—è¡¨ã€‚</li><li>3 é€‰å–â€œæ–‡ä»¶â€&gt;â€œå¯¼å‡ºâ€ã€‚</li><li>4 è¾“å…¥åç§°ï¼Œé€‰å–ä¸€ä¸ªä½ç½®ï¼Œç„¶åç‚¹æŒ‰â€œå¯¼å‡ºâ€ã€‚</li></ul><h3 id="é€šè®¯å½•"><a href="#é€šè®¯å½•" class="headerlink" title="é€šè®¯å½•"></a>é€šè®¯å½•</h3><p>é€šè®¯å½•å¯¼å‡ºæœ‰ä¸¤ä¸ªæ–¹å¼ï¼Œä¸€ä¸ªæ˜¯åœ¨ Mac ä¸Šçš„ ã€Œé€šè®¯å½•ã€åº”ç”¨ä¸Šæ“ä½œï¼š</p><h4 id="åœ¨-Mac-ä¸Šå¯¼å‡ºè”ç³»äºº"><a href="#åœ¨-Mac-ä¸Šå¯¼å‡ºè”ç³»äºº" class="headerlink" title="åœ¨ Mac ä¸Šå¯¼å‡ºè”ç³»äºº"></a>åœ¨ Mac ä¸Šå¯¼å‡ºè”ç³»äºº</h4><ul><li>1 æ‰“å¼€â€œé€šè®¯å½•â€ã€‚</li><li>2 é€‰å–â€œæ˜¾ç¤ºâ€&gt;â€œæ˜¾ç¤ºç¾¤ç»„â€ã€‚</li><li>3 åœ¨â€œç¾¤ç»„â€åˆ—è¡¨ä¸­é€‰æ‹©â€œæ‰€æœ‰è”ç³»äººâ€ã€‚</li><li>4 ç‚¹æŒ‰â€œé€šè®¯å½•â€åˆ—è¡¨ä¸­çš„æŸä¸ªè”ç³»äººã€‚</li><li>5 é€‰å–â€œç¼–è¾‘â€&gt;â€œå…¨é€‰â€ä»¥é€‰æ‹©è¦å¯¼å‡ºçš„æ‰€æœ‰åç‰‡ã€‚</li><li>6 é€‰å–â€œæ–‡ä»¶â€&gt;â€œå¯¼å‡ºâ€&gt;â€œå¯¼å‡º vCardâ€ã€‚</li><li>7 é€‰å–æ‚¨è¦å­˜å‚¨æ–‡ä»¶çš„ä½ç½®ï¼Œç„¶åç‚¹æŒ‰â€œå­˜å‚¨â€ã€‚</li></ul><h4 id="å¦ä¸€ä¸ªæ˜¯åœ¨-iCloud-com-ä¸Šçš„â€œé€šè®¯å½•â€å¯¼å‡ºè™šæ‹Ÿåç‰‡ï¼Œå³-vCardï¼š"><a href="#å¦ä¸€ä¸ªæ˜¯åœ¨-iCloud-com-ä¸Šçš„â€œé€šè®¯å½•â€å¯¼å‡ºè™šæ‹Ÿåç‰‡ï¼Œå³-vCardï¼š" class="headerlink" title="å¦ä¸€ä¸ªæ˜¯åœ¨ iCloud.com ä¸Šçš„â€œé€šè®¯å½•â€å¯¼å‡ºè™šæ‹Ÿåç‰‡ï¼Œå³ vCardï¼š"></a>å¦ä¸€ä¸ªæ˜¯åœ¨ iCloud.com ä¸Šçš„â€œé€šè®¯å½•â€å¯¼å‡ºè™šæ‹Ÿåç‰‡ï¼Œå³ vCardï¼š</h4><ul><li>1 ä»è”ç³»äººåˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªè”ç³»äººã€‚</li><li>2 ç‚¹æŒ‰è¾¹æ ä¸­çš„â€œæ“ä½œâ€å¼¹å‡ºå¼èœå• ï¿¼ï¼Œç„¶åé€‰å–â€œå¯¼å‡º vCardâ€ï¼›å¦‚æœæ‚¨é€‰æ‹©å¤šä¸ªè”ç³»äººï¼Œâ€œé€šè®¯å½•â€ä¼šå¯¼å‡ºä¸€ä¸ªåŒ…å«æ‰€æœ‰è”ç³»äººçš„ vCardã€‚</li></ul><h2 id="Safari"><a href="#Safari" class="headerlink" title="Safari"></a>Safari</h2><h3 id="åœ¨-Mac-ä¸Šå¯¼å‡ºâ€œSafari-æµè§ˆå™¨â€ä¹¦ç­¾çš„å‰¯æœ¬ï¼š"><a href="#åœ¨-Mac-ä¸Šå¯¼å‡ºâ€œSafari-æµè§ˆå™¨â€ä¹¦ç­¾çš„å‰¯æœ¬ï¼š" class="headerlink" title="åœ¨ Mac ä¸Šå¯¼å‡ºâ€œSafari æµè§ˆå™¨â€ä¹¦ç­¾çš„å‰¯æœ¬ï¼š"></a>åœ¨ Mac ä¸Šå¯¼å‡ºâ€œSafari æµè§ˆå™¨â€ä¹¦ç­¾çš„å‰¯æœ¬ï¼š</h3><ul><li>1 é€‰å–â€œæ–‡ä»¶â€&gt;â€œå¯¼å‡ºä¹¦ç­¾â€ã€‚</li><li>2 é€‰å–æ‚¨è¦å¯¼å‡ºæ–‡ä»¶çš„ä½ç½®ï¼Œç„¶åç‚¹æŒ‰â€œå­˜å‚¨â€ã€‚é™¤éæ‚¨è¿›è¡Œæ›´æ”¹ï¼Œå¦åˆ™æ–‡ä»¶åå°†ä¸ºâ€œSafari æµè§ˆå™¨â€Bookmarks.htmlâ€ã€‚</li></ul><h3 id="Safari-å¯†é’¥"><a href="#Safari-å¯†é’¥" class="headerlink" title="Safari å¯†é’¥"></a>Safari å¯†é’¥</h3><p>åœ¨ iCloud é‡Œå°†é’¥åŒ™ä¸²å…³é—­ï¼Œå¹¶é€‰æ‹©å°†æ•°æ®ä¿ç•™åœ¨æœ¬æœºã€‚</p><h2 id="iCloud-äº‘ç›˜"><a href="#iCloud-äº‘ç›˜" class="headerlink" title="iCloud äº‘ç›˜"></a>iCloud äº‘ç›˜</h2><p>iCloud äº‘ç›˜ä¸‹å­˜å‚¨äº†è®¸å¤šç¬¬ä¸‰æ–¹åº”ç”¨æ¥é€šäº‘ç›˜åä¿å­˜åœ¨å…¶ä¸­çš„æ•°æ®ï¼Œåœ¨ Mac ä¸Šé€€å‡ºå›½åŒº iCloud è´¦æˆ·æ—¶å¯å°†å…¶äº‘ç›˜æ•°æ®å½’æ¡£åˆ° Mac æœ¬åœ°ç¡¬ç›˜ï¼Œç™»å½•æ–° ID åå†å°†å…¶ç§»åŠ¨ï¼ˆæˆ–å¤åˆ¶ï¼‰åˆ°æ–° ID çš„äº‘ç›˜é‡Œå³å¯ã€‚</p><h2 id="Apple-Pay-å¡ç‰‡ä¿¡æ¯"><a href="#Apple-Pay-å¡ç‰‡ä¿¡æ¯" class="headerlink" title="Apple Pay å¡ç‰‡ä¿¡æ¯"></a>Apple Pay å¡ç‰‡ä¿¡æ¯</h2><p>åœ¨åœç”¨å›½åŒº iCloud æ—¶åˆ«å¿˜äº†å°†ã€Œé’±åŒ…ã€é‡Œçš„ Apple Pay æ”¯ä»˜å¡ç‰‡ä¿¡æ¯ï¼Œç¾åŒº ID é‡Œä¹Ÿå¯ä»¥æ·»åŠ å¤§é™†çš„å„ç§å¡å“¦ã€‚</p><h2 id="æ‰«å°¾å·¥ä½œ"><a href="#æ‰«å°¾å·¥ä½œ" class="headerlink" title="æ‰«å°¾å·¥ä½œ"></a>æ‰«å°¾å·¥ä½œ</h2><p>ä»¥ä¸Šç…§ç‰‡ã€é‚®ä»¶ã€é€šè®¯å½•ã€æ—¥å†ã€iCloud äº‘ç›˜ã€å¤‡å¿˜å½•ã€æé†’äº‹é¡¹å„ç§æ•°æ®è½¬ç§»ä¹Ÿå¥½ï¼Œå¤‡ä»½å¯¼å‡ºä¹Ÿå¥½åï¼Œè¿˜æ²¡æœ‰å®Œäº‹ï¼Œä»”ç»†æƒ³æƒ³ï¼Œçœ‹çœ‹ iPhone ä¸Šçš„ iCloud æ•°æ®è¿˜å‘ç°é‡Œé¢çš„ã€ŒiCloud å‚¨å­˜ç©ºé—´ â€“ å¤‡ä»½ã€ä¸€é¡¹é‡Œè¿˜æœ‰å„ç§è®¤è¯ iDevice è®¾å¤‡çš„å¤‡ä»½æ•°æ®ä»¥åŠå„ç§ç¬¬ä¸‰æ–¹åº”ç”¨è¿æ¥ iCloud ä¿å­˜çš„æ•°æ®éƒ½éœ€è¦ä¸€ä¸€åˆ é™¤æ‰è¡Œã€‚</p><p><img src="https://pix.waerfa.com/ajg8a.jpg" alt="img"></p><p>å…¨éƒ¨å®Œæˆåç”¨æ–°çš„ Apple ID ç™»å½•è®¾å¤‡ï¼Œå°†ç•™åœ¨ iPhone ä¸Šçš„å›½åŒº ID å„ç§å‰¯æœ¬æ•°æ®åˆå¹¶è‡³æ–° ID ä¸Šå³å¯ã€‚è¯´å®è¯ï¼Œæ•´ä¸ªè½¬åŒºçš„å·¥ä½œéå¸¸è€—è´¹ç²¾åŠ›ï¼Œå…ˆæ˜¯æ•°æ®çš„å¤‡ä»½å’Œè½¬ç§»ï¼Œè€Œä¸”åŸæ¥å›½åŒº App Storeã€Apple Music åˆç”¨äº†è¿™ä¹ˆé•¿çš„æ—¶é—´ï¼Œè®¸å¤šåº”ç”¨æ¸¸æˆä»¥åŠä¸“è¾‘éƒ½èˆä¸å¾—ä¸¢ä¸‹ï¼Œç¾åŒº Apple ID ä¸‹ App Store ç”¨å›½åŒº Apple ID ç™»å½•ä¸ç¾åŒº iCloud å¹¶è¡Œè¿è¡Œä¸çŸ¥é“ä¼šä¸ä¼šè¢«è‹¹æœå«åœï¼Œå¦‚æœå¿…é¡»å¾—ä¸€è‡´ï¼Œåˆ°æ—¶å€™è¿˜å¾—å°† Store è¿å…¥ç¾åŒºï¼ŒçœŸçš„æ˜¯æ„Ÿè§‰è‡ªå·±åƒä¸€ä¸ªéš¾æ°‘ï¼Œä¸€ä¸ªæ•°å­—æ—¶ä»£çš„éš¾æ°‘ï¼Œä¸ºäº†å®‰å…¨å’Œç”Ÿå­˜ä¸å¾—ä¸è¿›è¡Œè¿å¾™ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://www.waerfa.com/refugee-migration-of-digital-times" target="_blank" rel="noopener">https://www.waerfa.com/refugee-migration-of-digital-times</a></li><li><a href="https://support.apple.com/zh-cn/HT204055" target="_blank" rel="noopener">https://support.apple.com/zh-cn/HT204055</a></li><li><a href="https://www.douban.com/note/653557027/" target="_blank" rel="noopener">https://www.douban.com/note/653557027/</a></li></ul>]]></content>
      
        <categories>
            
            <category> tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> freedom </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æ•°æ®ç§»æ°‘æ¼‚æµè®°â€”â€”å¦‚ä½•æ³¨å†Œå¹¶ä½¿ç”¨Google Voice]]></title>
      <url>/posts/How-to-register-and-use-the-Google-Voice.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/sunset-sky-afterglow-dawn-sunrise-red-sky-at-morning-1437371-pxhere.com.jpg?imageslim" alt=""></p><p>è·å¾—ä¸€ä¸ªé•¿æœŸå¯ç”¨ã€å®Œå…¨å±äºè‡ªå·±çš„ç¾åŒºæ‰‹æœºå·ååˆ†æœ‰å¿…è¦ã€‚<a href="https://wangwei.one/posts/How-to-register-for-the-US-PayPal-and-bind-the-US-Apple-ID.html">æ³¨å†Œç¾åŒºPayPal</a> , <a href="https://wangwei.one/posts/How-to-register-and-use-the-US-Apple-ID.html">æ³¨å†Œç¾åŒºAppleId</a> , æ³¨å†ŒGoogleè´¦å·ç­‰äº’è”ç½‘æœåŠ¡ï¼Œéœ€è¦æå‡è´¦æˆ·å®‰å…¨æ€§ï¼ˆè´¦æˆ·å¼‚å¸¸éœ€ç»‘å®šæ‰‹æœºå·å¢åŠ å®‰å…¨æ€§ï¼‰ï¼Œä¸¤æ­¥éªŒè¯ä¹Ÿéœ€è¦æ‰‹æœºå·ã€‚æä¾›ç¾å›½è™šæ‹Ÿå·ç çš„æœåŠ¡æœ‰å¾ˆå¤šï¼Œä½†æ˜¯ç¨³å®šä¸”æ–¹ä¾¿å®æƒ çš„åªæœ‰ Google Voice ä¸€ä¸ªã€‚æœ¬æ–‡ä»‹ç» Google Voice çš„è·å–ï¼Œç»‘å®šï¼Œå……å€¼ï¼Œä¿ç•™ç­‰æ–¹æ¡ˆã€‚</p><a id="more"></a><h2 id="å‰ç½®æ¡ä»¶"><a href="#å‰ç½®æ¡ä»¶" class="headerlink" title="å‰ç½®æ¡ä»¶"></a>å‰ç½®æ¡ä»¶</h2><ul><li>Googleè´¦å·</li><li>å¯ä»¥ä»£ç†åˆ°ç¾å›½çš„VPNï¼ˆ <a href="https://wangwei.one/posts/build-your-own-vpn-by-shadowsocks-or-rixcloud.html">æŒ‡å—</a> ï¼‰ï¼Œåœ¨æ³¨å†ŒGoogle Voiceæ—¶ï¼Œè¯·ä¿è¯VPNä¸º<strong>å…¨å±€ä»£ç†</strong>æ¨¡å¼ã€‚</li></ul><h2 id="Google-Voice-ç®€ä»‹"><a href="#Google-Voice-ç®€ä»‹" class="headerlink" title="Google Voice ç®€ä»‹"></a>Google Voice ç®€ä»‹</h2><p><a href="https://voice.google.com/" target="_blank" rel="noopener">Google Voice</a> å³è°·æ­Œä¹‹éŸ³ï¼Œæ˜¯ç”±Googleæ¨å‡ºçš„ä¸€ç§ç”µè¯æœåŠ¡ï¼Œèƒ½å¤Ÿå°†ä¸ªäººæ‰€ç”¨çš„ä¼—å¤šç”µè¯å·ç é›†ä¸­æˆä¸€ä¸ªç¾å›½å·ç ï¼ŒåŒæ—¶è°·æ­Œæä¾›è®¸å¤šå¢å€¼æœåŠ¡ã€‚</p><p>Google Voiceçš„æœåŠ¡å°±æ˜¯ä»¥ä¸€ä¸ªè°·æ­Œæä¾›ç»™ä½ çš„å…è´¹ç¾å›½ç”µè¯å·ç ï¼Œæˆ–æ˜¯è‡ªå·±ä»˜è´¹æŒ‡å®šçš„å·ç ï¼Œæ¥æ•´åˆä½ ç”Ÿæ´»å½“ä¸­æ‰€æœ‰ä¼šæ¥è§¦åˆ°çš„ç”µè¯ï¼Œå¦‚å®¶é‡Œã€åŠå…¬å®¤ã€æ‰‹æœºç­‰ã€‚</p><p>è°·æ­Œåœ¨å®˜æ–¹ç½‘ç«™ä¸Šæä¾›äº†çŸ­ç‰‡è¯´æ˜ï¼šâ€œå½“æœ‰äººæ‰“ç”µè¯ç»™ä½ ï¼Œè€Œä¸”ä»–ä»¬ä¸å¿…è€ƒè™‘è¯¥æ‰“å®¶é‡Œçš„å·ç ã€åŠå…¬å®¤çš„å·ç ï¼Œè¿˜æ˜¯æ‰‹æœºã€‚è€Œæ‹¥æœ‰è°·æ­Œå·ç çš„ä½ ï¼Œå¯ä»¥å†³å®šå“ªæ”¯ç”µè¯è¯¥å“ã€‚â€</p><h3 id="æœ‰å“ªäº›åŠŸèƒ½"><a href="#æœ‰å“ªäº›åŠŸèƒ½" class="headerlink" title="æœ‰å“ªäº›åŠŸèƒ½"></a>æœ‰å“ªäº›åŠŸèƒ½</h3><ol><li>Google Voiceè¯­éŸ³ä¿¡ç®±ä½¿ç”¨èµ·æ¥å°±è±¡ç”µå­é‚®ä»¶ä¸€æ ·ï¼ŒæŠŠè¯­éŸ³ä¿¡ç®±çš„å†…å®¹ä¼ è¯‘æˆæ–‡å­—ï¼Œä½¿ä½ å¯ä»¥é˜…è¯»ï¼Œå¹¶èƒ½å®šåˆ¶é—®å€™ã€‚</li><li><strong>ç¾åŠ ç”µè¯çŸ­ä¿¡å‡å…è´¹</strong>ï¼Œå¹¶æä¾›éå¸¸ä¾¿å®œåœ°æ‰“å›½é™…é•¿é€”ç”µè¯ã€‚</li><li>æ”¶åˆ°ç•™è¨€åä¼šå‘ç”µå­é‚®ä»¶æˆ–çŸ­ä¿¡é€šçŸ¥ä½ ï¼Œå¯ä»¥ä¸‹è½½åˆ†äº«ç•™è¨€ã€‚</li><li>ä½¿ç”¨ä¸€ä¸ªå·ç ç®¡ç†ä½ æ‰€æœ‰çš„ç”µè¯å·ç ã€‚</li><li>æ‹¦æˆªä½ ä¸æƒ³æ¥å¬çš„ç”µè¯ï¼Œè®©å®ƒç›´æ¥è¿›è¯­éŸ³ä¿¡ç®±ã€‚</li><li>å¯ä»¥åœ¨çº¿å½•éŸ³åŠä¿å­˜é€šè¯ã€‚</li></ol><h3 id="æ”¶è´¹å—"><a href="#æ”¶è´¹å—" class="headerlink" title="æ”¶è´¹å—"></a>æ”¶è´¹å—</h3><p>Google Voiceæ­£å¸¸ä½¿ç”¨æ˜¯å…è´¹çš„ï¼Œä¸å……å€¼çš„æƒ…å†µä¸‹æ”¶çŸ­ä¿¡å®Œå…¨å…è´¹ï¼Œå‘ç¾åŠ æ‰“ç”µè¯å’Œå‘çŸ­ä¿¡å…è´¹ã€‚æ‰“ç”µè¯åˆ°å›½é™…å…¶å®ƒåŒºæ”¶è´¹ï¼Œä½†è´¹ç”¨éå¸¸ä½ï¼Œå¤§å®¶å¯ä»¥åˆ° <a href="https://www.google.com/voice/b/0/rates?hl=zh-CN" target="_blank" rel="noopener">è°·æ­Œå®˜ç½‘</a> æŸ¥è¯¢ã€‚</p><h2 id="Google-Voice-è·å–"><a href="#Google-Voice-è·å–" class="headerlink" title="Google Voice è·å–"></a>Google Voice è·å–</h2><p>æ‹¥æœ‰ç¾å›½å®ä½“å·ç çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç›´æ¥éªŒè¯è·å–ä¸€ä¸ª Google voice è™šæ‹Ÿå·ç ã€‚ç°åœ¨æµè¡Œä½¿ç”¨ <a href="https://www.lycamobile.us/en/" target="_blank" rel="noopener">lycamobile</a> å®ä½“å¡æ³¨å†ŒGoogle voiceã€‚</p><p><strong>æ¨è</strong>ä¸Šæ·˜å®è´­ä¹°ä¸€ä¸ª lycamobileå®ä½“å¡(ç¾å›½)ï¼Œç„¶åç”¨å®ƒå»ç»‘å®šä¸€ä¸ªGoogle voiceã€‚ä¸€ä¸ªlycamobileåªèƒ½ç»‘å®šä¸€ä¸ªGoogle voiceï¼ŒæˆåŠŸç‡é«˜ï¼Œå°å·é£é™©æä½ã€‚</p><blockquote><p>æˆ‘è´­ä¹°çš„ <a href="https://shop136675829.taobao.com/shop/view_shop.htm?shop_id=136675829" target="_blank" rel="noopener">æ·˜å®åº—é“º</a></p></blockquote><p><strong>ä¸æ¨è</strong> æ–¹å¼ï¼š</p><blockquote><p>ç½‘ä¸Šçš„å¾ˆå¤šæ•™ç¨‹éƒ½æ˜¯å‘Šè¯‰ä½ ç›´æ¥å»æ·˜å®è´­ä¹°ã€‚è´­ä¹°ä¼šè·å¾—ä¸€ä¸ª Google è´¦å· å’Œå…¶ä¸­å«æœ‰çš„ Google voice æ‰‹æœºå·ï¼Œæ¨èè´­ä¹°åè½¬ç§»åˆ°è‡ªå·±çš„ Google è´¦å·ä¸‹ã€‚è¿™ç§æƒ…å†µå¾ˆå®¹æ˜“å¯¼è‡´è‡ªå·±çš„Googleè´¦å·è¢«å°ã€‚</p><p><a href="https://www.googlevoice.cn/transfer-gv-or-questions/" target="_blank" rel="noopener">https://www.googlevoice.cn/transfer-gv-or-questions/</a></p><p>ä½¿ç”¨ä¸€äº›è™šæ‹Ÿå·ç æœåŠ¡å•†æ¥ç”ŸæˆGoogle Voiceï¼Œç°åœ¨å·²ç»åŸºæœ¬è¡Œä¸é€šäº†ã€‚ä¾‹å¦‚ï¼š<a href="https://www.textnow.com/" target="_blank" rel="noopener">https://www.textnow.com</a></p></blockquote><h3 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h3><p><img src="https://img.i7years.com/blog/reg-google-voice-01.png" alt="reg-google-voice-01"></p><h3 id="é€‰æ‹©å·ç "><a href="#é€‰æ‹©å·ç " class="headerlink" title="é€‰æ‹©å·ç "></a>é€‰æ‹©å·ç </h3><p>ç‚¹å‡» Choose numberï¼š</p><p><img src="https://img.i7years.com/blog/reg-google-voice-02.png" alt="reg-google-voice-02"></p><p>è¾“å…¥ <a href="https://simple.wikipedia.org/wiki/List_of_U.S._states" target="_blank" rel="noopener">å·åŠåŸå¸‚</a> ï¼Œä¾‹å¦‚ <code>New York,NY</code>ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªä½ å–œæ¬¢çš„å·ç </p><blockquote><p>å…³äºåŸå¸‚çš„é€‰æ‹©ï¼Œè¯´æ˜ä¸€ä¸‹ï¼š</p><ul><li>æœ€å¥½é€‰æ‹©ç¾å›½å…ç¨å·çš„åŸå¸‚ï¼ˆ <a href="https://www.thebalance.com/states-without-a-sales-tax-3193305" target="_blank" rel="noopener">å…ç¨å·</a> ï¼‰ã€‚</li><li>ä¸ <a href="https://www.fakeaddressgenerator.com/World/us_address_generator" target="_blank" rel="noopener">ç”Ÿæˆç¾å›½è™šå‡èº«ä»½è¯æ˜</a> çš„åŸå¸‚ä¿¡æ¯ä¿æŒä¸€è‡´ã€‚è¿™ä¸ªèº«ä»½ä¼šåœ¨ <a href="https://wangwei.one/posts/How-to-register-for-the-US-PayPal-and-bind-the-US-Apple-ID.html">æ³¨å†Œç¾åŒº PayPal</a> , <a href="https://wangwei.one/posts/How-to-register-and-use-the-US-Apple-ID.html">æ³¨å†Œç¾åŒºAppleId</a> æ—¶ç”¨åˆ°ã€‚</li></ul><p>æ‰€è°“ï¼Œé€ å‡ä¹Ÿè¦é€ çš„çœŸä¸€ç‚¹ã€‚</p></blockquote><p><img src="https://img.i7years.com/blog/reg-google-voice-03.png" alt="reg-google-voice-03"></p><h3 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h3><p><img src="https://img.i7years.com/blog/reg-google-voice-04.png" alt="reg-google-voice-04"></p><p>è¾“å…¥ä½ æ‰€è´­ä¹°çš„ lycamobile å·ç </p><p><img src="https://img.i7years.com/blog/reg-google-voice-05.png" alt="reg-google-voice-05"></p><p>è¾“å…¥æ¥æ”¶åˆ°çš„éªŒè¯ç </p><p><img src="https://img.i7years.com/blog/reg-google-voice-06.png" alt="reg-google-voice-06"></p><p>ç‚¹å‡» Finishï¼Œå¤§åŠŸå‘Šæˆã€‚</p><h2 id="Google-voice-çš„ç”¨å¤„"><a href="#Google-voice-çš„ç”¨å¤„" class="headerlink" title="Google voice çš„ç”¨å¤„"></a>Google voice çš„ç”¨å¤„</h2><ul><li><a href="https://digitalimmigrant.org/171" target="_blank" rel="noopener">æ³¨å†Œç¾åŒº PayPal </a>å¯ç”¨äºéªŒè¯ç¾å›½æ‰‹æœºå·ã€‚</li><li>ä½¿ç”¨ç¾å›½æ‰‹æœºå·æ³¨å†Œ Telegramï¼Œå¯ä»¥å‡å°‘è´¦å·è¢«é™åˆ¶çš„é£é™©ã€‚</li><li>ç»‘å®š Facebook å’Œ Twitterï¼Œå¼€å¯ä¸¤æ­¥éªŒè¯ï¼Œé¿å…å› ä½¿ç”¨ VPN è´¦å·å¯¼è‡´è¢«å°ã€‚ ï¼ˆä½¿ç”¨éƒ¨åˆ†ä»£ç†æœåŠ¡å¯èƒ½å¯¼è‡´ç¤¾äº¤è´¦å·è¡Œä¸º ä¸ æœºæ„å…»å·çš„è¡Œä¸ºå¾ˆæ¥è¿‘ï¼‰</li><li>ä¸å»ºè®®ä½¿ç”¨ Google voice å·ç æ¥æ‹¨æ‰“ç¾å›½å„ç§æœåŠ¡çš„å®¢æœç”µè¯ï¼Œè¿æ¥æ•ˆæœè¾ƒå·®ï¼Œä¸”æœ‰å¯èƒ½è¢«ç³»ç»Ÿè¯†åˆ«é˜»æ‹¦ç­‰ã€‚</li></ul><h2 id="Google-Voice-å……å€¼"><a href="#Google-Voice-å……å€¼" class="headerlink" title="Google Voice å……å€¼"></a>Google Voice å……å€¼</h2><p>Google voice æ— æ³•åœ¨ iOS åº”ç”¨ä¸­å……å€¼ã€‚æ¨èæ‰“å¼€ Google voiceç½‘é¡µç‰ˆæœ¬ï¼ˆæ¡Œé¢ç«¯ç§»åŠ¨ç«¯å‡å¯ï¼‰ï¼Œç›´æ¥åœ¨è®¾ç½®ä¸­æ‰¾åˆ°<a href="https://voice.google.com/u/0/settings#payments" target="_blank" rel="noopener">å……å€¼é¡µé¢</a>ï¼Œå•æ¬¡å……å€¼å¯å……10/25/50ç¾å…ƒï¼Œæ€»ä½™é¢ä¸èƒ½è¶…è¿‡70ç¾å…ƒã€‚</p><p>å› ä¸ºå……å€¼ä½¿ç”¨çš„æ˜¯ Google Payï¼Œéœ€è¦ç»‘å®š Visa/Mastercard ç­‰å¤–å¸ä¿¡ç”¨å¡æ‰èƒ½ä½¿ç”¨ï¼Œä¸æ”¯æŒé“¶è”ä¿¡ç”¨å¡ã€‚Google Play ç¤¼å“å¡å†²çš„ä½™é¢ä¼¼ä¹æ²¡æ³•ç”¨æ¥å……å€¼ Google voice ï¼ˆå¾…ç¡®è®¤ï¼‰ã€‚</p><h2 id="Google-voice-ä¿å·"><a href="#Google-voice-ä¿å·" class="headerlink" title="Google voice ä¿å·"></a>Google voice ä¿å·</h2><p>Google voice ä½œä¸ºä¸€é¡¹å…¬å…±èµ„æºï¼ŒGoogle ä¼šä¸å®šæœŸæ”¶å›ä¸æ´»è·ƒçš„æ‰‹æœºå·ï¼Œå›æ”¶å‰ä¼šæå‰ä¸€ä¸ªæœˆè¿›è¡Œé‚®ä»¶é€šçŸ¥ã€‚æ¨èä½¿ç”¨ <a href="https://ifttt.com/applets/131839p-keep-google-voice-active" target="_blank" rel="noopener">IFTTT </a>æœåŠ¡ï¼Œå®šæ—¶ä½¿ç”¨ Google voice æ‹¨æ‰“ç”µè¯ä»¥ä¿æŒæ´»è·ƒåº¦ã€‚</p><p>å³ä½¿å……å€¼äº†ï¼Œè‹¥é•¿æœŸåªæ”¶çŸ­ä¿¡è€Œä¸æ˜¯ä½¿ç”¨ä¹Ÿä¼šæœ‰è¢«é”€å·çš„å¯èƒ½ã€‚å»ºè®®æ·»åŠ æé†’ï¼Œæ¯éš”ä¸€ä¸¤ä¸ªæœˆæ‰“ä¸ªç”µè¯ï¼Œæˆ–è€…å‘ä¸ªçŸ­ä¿¡ä¿æŒæ´»è·ƒåº¦ã€‚</p><h4 id="ç™»å½•æ³¨å†ŒIFTTT"><a href="#ç™»å½•æ³¨å†ŒIFTTT" class="headerlink" title="ç™»å½•æ³¨å†ŒIFTTT"></a>ç™»å½•æ³¨å†ŒIFTTT</h4><p>å®˜ç½‘ï¼š<a href="https://ifttt.com/" target="_blank" rel="noopener">IFTTT</a></p><p><img src="/Users/wangwei/Desktop/reg-google-voice-07.png" alt="image-20190415170307686"></p><h4 id="é…ç½®-Keep-Gooogle-Voice-Active"><a href="#é…ç½®-Keep-Gooogle-Voice-Active" class="headerlink" title="é…ç½® Keep Gooogle Voice Active"></a>é…ç½® Keep Gooogle Voice Active</h4><p>æœç´¢ Keep Gooogle Voice Activeï¼Œæˆ–è€…ç›´æ¥ç‚¹å‡» <a href="https://ifttt.com/applets/131839p-keep-google-voice-active" target="_blank" rel="noopener"><strong>è¿™é‡Œ</strong></a> è¿›å…¥ç›¸åº”é¡µé¢ã€‚</p><p><img src="https://img.i7years.com/blog/reg-google-voice-08.png" alt="3334975-f533c062e0b185b7"></p><p><img src="https://img.i7years.com/blog/reg-google-voice-09.png" alt="3334975-142b06b3a99bcde8"></p><p>åˆ†åˆ«ç‚¹å‡»è®¾ç½® â€œDate &amp; Timeâ€ å’Œ â€œPhone Callâ€ã€‚</p><p><img src="https://img.i7years.com/blog/reg-google-voice-10.png" alt="3334975-b2561883744214c2"></p><p><strong>è®¾ç½®æ—¶åŒº</strong>ï¼ŒåŒ—äº¬æ—¶é—´ã€‚</p><p><img src="https://img.i7years.com/blog/reg-google-voice-11.png" alt="3334975-6750a6719a357b3c"></p><p><strong>æ·»åŠ å·ç </strong>ï¼Œéœ€è¦æ¥æ”¶è¾“å…¥éªŒè¯ç ã€‚ï¼ˆä¸ç”¨è¾“å…¥åŒºå·ï¼‰</p><p>ç‚¹å‡» â€œSend PINâ€ï¼Œæˆ‘ä»¬çš„ GV(Google Voice) ä¼šæ”¶åˆ°ä¸€å°è¯­éŸ³é‚®ä»¶ï¼Œå°†æ”¶åˆ°çš„å››ä½éªŒè¯ç å¡«å…¥å³å¯ã€‚</p><p><img src="https://img.i7years.com/blog/reg-google-voice-12.png" alt="3334975-6bf529ebfaa8e26d"></p><p><img src="https://img.i7years.com/blog/reg-google-voice-13.png" alt="3334975-14f19e756bfd44b6"></p><h4 id="å¯åŠ¨æˆåŠŸ"><a href="#å¯åŠ¨æˆåŠŸ" class="headerlink" title="å¯åŠ¨æˆåŠŸ"></a>å¯åŠ¨æˆåŠŸ</h4><p><img src="https://img.i7years.com/blog/reg-google-voice-14.png" alt="3334975-b079299bd62c31b2-1"></p><p>ä»¥åæ¯ä¸ªæœˆéƒ½ä¼šæ”¶åˆ° IFTTT çš„ç”µè¯æˆ–è¯­éŸ³é‚®ä»¶ã€‚å½“ç„¶ï¼ŒIFTTT ä¹Ÿæ˜¯å¾ˆå¼ºå¤§çš„ä¸€ä¸ªå·¥å…·ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ç ”ç©¶ä¸‹ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://digitalimmigrant.org/348" target="_blank" rel="noopener">https://digitalimmigrant.org/348</a></li><li><a href="https://www.googlevoice.cn/" target="_blank" rel="noopener">https://www.googlevoice.cn/</a></li><li><a href="https://go2think.com/keep-google-voice-active/" target="_blank" rel="noopener">https://go2think.com/keep-google-voice-active/</a></li></ul>]]></content>
      
        <categories>
            
            <category> tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> freedom </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æ•°æ®ç§»æ°‘æ¼‚æµè®°â€”â€”å¦‚ä½•æ³¨å†Œç¾åŒº PayPal å¹¶ç»‘å®šç¾åŒº Apple ID]]></title>
      <url>/posts/How-to-register-for-the-US-PayPal-and-bind-the-US-Apple-ID.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/aeroplane-aircraft-airplane-8394.jpg?imageslim" alt=""></p><blockquote><p>è½¬è½½ï¼š<a href="http://jolson.xyz/2018/11/22/reg-us-pp/" target="_blank" rel="noopener">http://jolson.xyz/2018/11/22/reg-us-pp/</a></p></blockquote><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬æ•™ç¨‹ä»…ä¸ºå¯¹ä¹‹å‰ <a href="https://wangwei.one/posts/How-to-register-and-use-the-US-Apple-ID.html">æ³¨å†Œç¾åŒº Apple ID æ•™ç¨‹</a> çš„å»¶ä¼¸ï¼Œæ˜¯ä¸ºäº†å‘Šè¯‰å¤§å®¶å¦‚ä½•æ­£ç¡®çš„å°†ç¾åŒº Apple ID ç»‘å®šç¾åŒº PayPal ä»˜æ¬¾æ–¹å¼å¹¶æˆåŠŸä½¿ç”¨ï¼Œä»¥å‡å°‘ PayPal å¯¹è´¦æˆ·çš„é£æ§ï¼ˆå¹¶ä¸èƒ½100%ä¿è¯ä¸€å®šä¼šæ²¡æœ‰é£æ§æˆ–è€…è§£é™¤é£æ§ï¼‰ï¼Œè®©å¤§å®¶åœ¨ç¾åŒºç•…é€šæ— é˜»çš„è¿›è¡Œä»˜æ¬¾ã€‚ï¼ˆå¦‚æœæ˜¯ç»‘å®šæ¸¯åŒºæˆ–è€…æ—¥åŒºçš„ Apple ID çš„ä»˜æ¬¾æ–¹å¼ï¼Œè¯·å‚è€ƒæ•™ç¨‹ï¼šå¦‚ä½•æ³¨å†Œå¹¶ä½¿ç”¨ç¾åŒº Apple ID çš„å‰è¨€éƒ¨åˆ†ï¼Œé‡Œé¢æœ‰ç®€å•çš„è¯´æ˜ä»‹ç»ï¼‰</p><p>åœ¨æ³¨å†Œä¹‹å‰ï¼Œè¦åšå¥½æ‰€æœ‰çš„å‡†å¤‡å·¥ä½œï¼š</p><ol><li>å‡†å¤‡å¥½ä¸€ä¸ª <a href="https://wangwei.one/posts/How-to-register-and-use-the-Google-Voice.html">Google Voiceç¾å›½è™šæ‹Ÿå·ç </a> ï¼Œä»¥åŠä¸€ä¸ªç¾å›½å…ç¨å·åœ°å€ï¼ˆç¾å›½åœ°å€å¯åœ¨ <a href="https://www.fakeaddressgenerator.com/World/us_address_generator" target="_blank" rel="noopener">è¿™ä¸ªç½‘ç«™</a> ç›´æ¥ç”Ÿæˆï¼Œå¦‚æœæœ‰é—®é¢˜è¯·è‡ªè¡Œè°·æ­Œï¼‰ã€‚</li><li>æ‰“å¼€ç¾å›½å…¨å±€ä»£ç†æ¨¡å¼ã€‚ï¼ˆæœ¬æ•™ç¨‹å…¨ç¨‹ä¸ºç¾å›½å…¨å±€ä»£ç†æ¨¡å¼ï¼‰</li><li>å» <a href="https://www.ipip.net/ip.html" target="_blank" rel="noopener">ipip.net</a> ç½‘ç«™æŸ¥çœ‹ä½ çš„IPåœ°å€æ˜¯å¦ä¸ºç¾å›½ã€‚</li><li>æ¥¼ä¸»ç”¨çš„æ˜¯ Chrome æµè§ˆå™¨ï¼Œå¹¶ä¸”æ¸…é™¤äº† Chrome æµè§ˆå™¨çš„æ‰€æœ‰æµè§ˆæ•°æ®å’Œå…¶ä»–ä¸ç›¸å…³çš„ä¿¡æ¯ï¼ˆé™¤äº†ä¿å­˜çš„å¯†ç å’Œä¿¡ç”¨å¡ä¿¡æ¯ï¼‰ã€‚</li></ol><p>è¯·æœ€å¥½æŒ‰ä»¥ä¸Šé¡ºåºè¿›è¡Œæ¥ä¸‹æ¥çš„æ­¥éª¤ï¼Œä»…ä»…åªæ˜¯ä¸ºäº†é˜²æ­¢ä¸€äº›ç„å­¦äº‹æƒ…å‘ç”Ÿã€‚</p><blockquote><p>ä½†æ˜¯ç»¼ä¸Šæ‰€è¿°ï¼Œæ¥¼ä¸»æŒ‰ç…§è¿™äº›æ­¥éª¤åšå®Œè¿˜æ˜¯è¢« PayPal é£æ§ï¼ˆè¿ Apple éƒ½æŠŠæˆ‘é£æ§äº†ï¼‰ï¼Œä½†æ˜¯åæ¥å…¨éƒ¨è§£å†³äº†ã€‚æ¥ä¸‹æ¥æ‰€æœ‰çš„æ­¥éª¤ä»¥åŠè§£å†³æ–¹æ¡ˆéƒ½ä¼šåœ¨æœ¬æ•™ç¨‹è¯¦ç»†è¯´æ˜ã€‚</p></blockquote><h2 id="æ³¨å†Œç¾åŒº-PayPal-è´¦æˆ·"><a href="#æ³¨å†Œç¾åŒº-PayPal-è´¦æˆ·" class="headerlink" title="æ³¨å†Œç¾åŒº PayPal è´¦æˆ·"></a>æ³¨å†Œç¾åŒº PayPal è´¦æˆ·</h2><h3 id="ç™»é™†ç¾å›½PayPalå®˜ç½‘"><a href="#ç™»é™†ç¾å›½PayPalå®˜ç½‘" class="headerlink" title="ç™»é™†ç¾å›½PayPalå®˜ç½‘"></a>ç™»é™†ç¾å›½PayPalå®˜ç½‘</h3><p>é¦–å…ˆæ‰“å¼€<a href="http://jolson.xyz/2018/11/22/reg-us-pp/www.paypal.com/us" target="_blank" rel="noopener">ç¾å›½ Paypal å®˜ç½‘</a>ï¼Œç‚¹å‡»å³ä¸Šè§’ <code>Sign Up</code> è¿›å…¥æ³¨å†Œè´¦æˆ·ç•Œé¢ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-01.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-01.jpg" alt="20181122-reg-us-pp-02"></a></p><p>é€‰æ‹©ç¬¬ä¸€ä¸ª <code>Personal Account</code> ï¼Œå¹¶ç‚¹å‡» <code>Next</code>ï¼Œ ç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-02.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-02.jpg" alt="20181122-reg-us-pp-03"></a></p><p>è¿™æ—¶ä¼šè®©ä½ å¡«å†™ PayPal è´¦æˆ·ç›¸å…³ä¿¡æ¯ï¼ˆæ¨èä½¿ç”¨ä¸ç¾åŒº Apple ID è´¦æˆ·ç›¸åŒçš„ Gmail é‚®ç®±ï¼Œå‚è€ƒä¹‹å‰çš„<a href="http://jolson.xyz/2018/11/15/reg-appleid/" target="_blank" rel="noopener">ç¾åŒº Apple ID æ³¨å†Œæ•™ç¨‹</a>ï¼‰ï¼Œå¹¶ä¸”è¯·ç¡®å®šå³ä¸‹è§’ä¸º<code>ç¾å›½</code>ï¼Œç„¶åç‚¹å‡» Next ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-03.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-03.jpg" alt="20181122-reg-us-pp-04"></a></p><p>æ¥ä¸‹æ¥è¾“å…¥ä¹‹å‰å‡†å¤‡å¥½çš„<code>ç¾å›½å…ç¨å·åœ°å€</code>å’Œ GVï¼ˆæ¨èä½¿ç”¨ä¸ç¾åŒº Apple ID è´¦æˆ·ç›¸åŒçš„å…ç¨å·åœ°å€ï¼‰ï¼Œç„¶åç‚¹å‡» <code>Agree and Create Account</code>ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-04.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-04.jpg" alt="20181122-reg-us-pp-05"></a></p><p>è‡³æ­¤ï¼ŒPayPal å·²ç»æ³¨å†ŒæˆåŠŸï¼Œç„¶åç‚¹å‡»æœ€ä¸‹é¢æŒ‰é’® <code>Not Sure? Add card to use later</code>ï¼Œå¹¶æ·»åŠ ä¿¡ç”¨å¡ï¼ˆæ¨èä½¿ç”¨<code>å…¨å¸å¡</code>ï¼Œä¸æ¨èåŒå¸å¡ï¼Œå› ä¸ºåŒå¸å¡çš„å¤–å¸æ¶ˆè´¹ä¼šå¤šæ‰£ 1% çš„é¢å¤–æ‰‹ç»­è´¹ï¼Œå…·ä½“çœ‹é“¶è¡Œã€‚å¦‚æœåªæœ‰åŒå¸å¡ä¹Ÿæ²¡å…³ç³»ï¼Œå…ˆæ·»åŠ äº†å†è¯´ï¼‰ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-05.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-05.jpg" alt="20181122-reg-us-pp-05"></a></p><p>å¡«å†™å…¨å¸å¡çš„ç›¸å…³ä¿¡æ¯ï¼Œå¹¶ç‚¹å‡» <code>Link Card</code>ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-06.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-06.jpg" alt="20181122-reg-us-pp-06"></a></p><p>è¿™æ—¶ PayPal æç¤ºä½ è´¦æˆ·å·²ç»å…¨éƒ¨å‡†å¤‡å¥½å¯è¿›è¡Œåç»­ä½¿ç”¨ï¼Œç‚¹å‡»ä¸‹æ–¹ <code>Go to your account</code>ï¼Œè¿›è¡Œè´¦æˆ·çš„æœ€åéªŒè¯ï¼ˆè¿™ç‚¹å¾ˆé‡è¦ï¼Œå¦‚æœæ²¡æœ‰éªŒè¯ï¼Œå°†100%è¢«é£æ§ï¼ï¼‰ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-07.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-07.jpg" alt="20181122-reg-us-pp-07"></a></p><p>è¿›å…¥ PayPal é¦–é¡µåï¼Œä¼šæœ‰2ä¸ªå¤§ç¯®æ¡†ï¼Œè¯·ä¸€å®šè¦éªŒè¯ä½  PayPal çš„ç”µè¯å’Œé‚®ç®±ï¼Œä¸ç„¶100%é£æ§ï¼ï¼ï¼éªŒè¯å…¨éƒ¨ç»“æŸåï¼Œç‚¹å‡»å³ä¸Šè§’é½¿è½®ï¼Œå›åˆ°è´¦æˆ·çš„é¦–é¡µï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-08.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-08.jpg" alt="20181122-reg-us-pp-08"></a></p><p>åœ¨è´¦æˆ·é¡µé¢è¯·ç¡®å®šä½ çš„å›½å®¶ä¸º <code>United States</code>ï¼Œä¹Ÿå°±æ˜¯ç¾å›½ã€‚è¯­è¨€å¯é€‰æ‹©<code>ç®€ä½“ä¸­æ–‡</code>ï¼ŒSSN å’Œ Passport ä¸ç®¡ã€‚ç„¶åç‚¹å‡»é¡µé¢ä¸Šæ–¹çš„ <code>PAYMENTS</code> ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-09.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-09.jpg" alt="20181122-reg-us-pp-09"></a></p><p>åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°ä½ çš„ä»˜æ¬¾ä¿¡æ¯ï¼Œè¯·è‡ªè¡Œç¡®è®¤ï¼Œè‡³æ­¤å…³äºç¾åŒº PayPal è´¦æˆ·æ³¨å†Œå®Œå…¨ç»“æŸã€‚<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-10.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-10.jpg" alt="20181122-reg-us-pp-10"></a></p><h3 id="ç¾åŒº-Apple-ID-ç»‘å®šç¾åŒº-PayPal-è´¦æˆ·"><a href="#ç¾åŒº-Apple-ID-ç»‘å®šç¾åŒº-PayPal-è´¦æˆ·" class="headerlink" title="ç¾åŒº Apple ID ç»‘å®šç¾åŒº PayPal è´¦æˆ·"></a>ç¾åŒº Apple ID ç»‘å®šç¾åŒº PayPal è´¦æˆ·</h3><p>æ‰“å¼€ App Storeï¼Œå¹¶ç‚¹å‡»å³ä¸Šè§’å¤´åƒï¼ˆæœ¬æ•™ç¨‹ä½¿ç”¨çš„è®¾å¤‡ç³»ç»Ÿä¸º iOS 12ï¼Œæ¯”è¾ƒè€çš„ç³»ç»Ÿå¦‚æœå³ä¸Šè§’æ²¡æœ‰å¤´åƒï¼Œè¯·ç›´æ¥æ‹‰åˆ° App Store é¦–é¡µæœ€ä¸‹é¢ï¼Œç‚¹å‡»ä½ çš„è´¦æˆ·å¹¶é€€å‡ºï¼‰ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-11.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-11.jpg" alt="20181122-reg-us-pp-11"></a></p><p>é€€å‡ºç°æœ‰è´¦æˆ·ï¼Œè¾“å…¥æ–°æ³¨å†Œçš„ç¾åŒº Apple ID è´¦æˆ·åŠå¯†ç ï¼Œå¹¶ç‚¹å‡» Sign In ç™»é™†ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-12.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-12.jpg" alt="20181122-reg-us-pp-12"></a></p><p>ç™»é™†æˆåŠŸåï¼Œç‚¹å‡»å¤´åƒæ ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-13.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-13.jpg" alt="20181122-reg-us-pp-13"></a></p><p>ç‚¹å‡» <code>Payment Information</code>ï¼Œè¿›å…¥ä»˜æ¬¾æ–¹å¼é¡µé¢ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-14.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-14.jpg" alt="20181122-reg-us-pp-14"></a></p><p>é€‰æ‹© <code>PayPal</code>ï¼Œå¹¶ç‚¹å‡» <code>Log In to PayPal</code>ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-15.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-15.jpg" alt="20181122-reg-us-pp-15"></a></p><p>æ¥ä¸‹æ¥ä¼šè®©ä½ è¾“å…¥è´¦å·å¯†ç ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-16.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-16.jpg" alt="20181122-reg-us-pp-16"></a><br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-17.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-17.jpg" alt="20181122-reg-us-pp-17"></a></p><p>ç‚¹å‡» <code>Log In</code>ï¼Œä¼šè¿›å…¥å®‰å…¨æ£€æŸ¥é¡µé¢ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-18.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-18.jpg" alt="20181122-reg-us-pp-18"></a></p><p>è‡³æ­¤ï¼Œç»‘å®šç¾åŒº PayPal è´¦æˆ·ä¼šæ­£å¼è¿›è¡Œå®‰å…¨æ£€æŸ¥ï¼Œå¹¶å¯¹ä¸€äº›æœ‰é£é™©çš„è´¦æˆ·è¿›è¡Œé£é™©æ§åˆ¶ã€‚ä¸€èˆ¬æ¥è¯´å¦‚æœæ²¡é—®é¢˜çš„è¯ï¼Œå°±ä¼šç›´æ¥æ˜¾ç¤ºä½ çš„ä¿¡ç”¨å¡ä¿¡æ¯ï¼Œå¹¶å®Œæˆä½ çš„ç¾åŒºPayPalè´¦æˆ·çš„ç»‘å®šã€‚<br>æˆ–è€…è®©ä½ éªŒè¯ GV å·ï¼ˆæœ‰äººè¯´å¦‚æœé‡åˆ°éªŒè¯ GV å·å°±ä»£è¡¨ä½ å·²ç»è¢«é£æ§äº†ï¼Œå…¶å®å¹¶ä¸æ˜¯ï¼Œæˆ‘å¤§å·ä¹Ÿæ˜¯éªŒè¯ GV å·ï¼Œä½†æ˜¯éªŒè¯å®Œæˆåç»‘å®šç›´æ¥ä¸€æ¬¡é€šè¿‡ã€‚<br>æˆ‘åˆ›å»ºå°å·åšæ•™ç¨‹ï¼Œä¹Ÿé‡åˆ°éªŒè¯ GV å·2æ¬¡ï¼ˆåŒè´¦æˆ·æ³¨é”€é‡åˆ›ä¸€æ¬¡ï¼Œè™½ç„¶2æ¬¡è¢«é£æ§äº†ï¼Œä½†æœ€åéƒ½è§£å†³äº†ï¼‰ã€‚æ‰€ä»¥é‡åˆ°éªŒè¯ GV å·ä¹Ÿä¸ç”¨æ€•ï¼Œç›´æ¥éªŒè¯ï¼Œä¹Ÿæœ‰å¯èƒ½ç›´æ¥é€šè¿‡çš„ï¼ŒéªŒè¯æ—¶é€‰æ‹©å‘é€çŸ­ä¿¡å³å¯ã€‚ç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-19.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-19.jpg" alt="20181122-reg-us-pp-19"></a></p><p>ä¸€èˆ¬éªŒè¯GVå·çš„é¡µé¢å‡ºç°åï¼Œä¹Ÿæ˜¯æœ‰å‡ ç‡ç›´æ¥é€šè¿‡å®‰å…¨æ£€æŸ¥å¹¶æˆåŠŸç»‘å®šçš„ï¼ˆä¾‹å¦‚æˆ‘çš„å¤§å·ï¼‰ã€‚ç»‘å®šæˆåŠŸé€šè¿‡çš„è¿‡ç¨‹æˆ‘å°±ä¸å¤šèµ˜è¿°ï¼Œæ¥ä¸‹æ¥ä¸»è¦è®²è§£è¢«é£æ§ä¹‹åçš„è§£å†³åŠæ³•ï¼ˆä¸èƒ½ä¿è¯100%è§£é™¤ï¼Œä½†è‡³å°‘æˆ‘æ‰¾åˆ°3ä¸ªäººæµ‹è¯•ï¼Œ3ä¸ªäººå‡æˆåŠŸè§£é™¤é£æ§ï¼Œæœ‰1ä¸ªæ˜¯æˆ‘å°å·ï¼‰ï¼Œè¢«é£æ§çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-20.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-20.jpg" alt="20181122-reg-us-pp-20"></a></p><h3 id="ç¾åŒºPayPalè¢«é£æ§çš„è§£å†³åŠæ³•"><a href="#ç¾åŒºPayPalè¢«é£æ§çš„è§£å†³åŠæ³•" class="headerlink" title="ç¾åŒºPayPalè¢«é£æ§çš„è§£å†³åŠæ³•"></a>ç¾åŒºPayPalè¢«é£æ§çš„è§£å†³åŠæ³•</h3><p>åˆšæ³¨å†Œçš„Paypal è´¦å·å¾ˆå¯èƒ½ä¼šè¢«é£æ§ï¼Œå³ç»‘å®š Apple ID å‡ºé”™ï¼Œå‡ºç°å¦‚ä¸‹æç¤ºï¼š</p><blockquote><p>Sorry, we weren â€™ t able to set up preapproved payments at this time.</p></blockquote><p>å‡ºç°è¿™ç§æƒ…å†µçš„è¯ï¼Œå¯ä»¥ç›´æ¥åœ¨ Paypal ç½‘ç«™ä¸Šæ‰¾å®¢æœã€‚</p><p>ç™»é™† PayPal é¦–é¡µï¼Œç‚¹å‡»ä¸‹æ–¹ <code>CONTACT US</code>ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-21.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-21.jpg" alt="20181122-reg-us-pp-21"></a></p><p>ç‚¹å‡» <code>Payments</code>ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-22.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-22.jpg" alt="20181122-reg-us-pp-22"></a></p><p>ç‚¹å‡» <code>Payment declined</code>ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-23.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-23.jpg" alt="20181122-reg-us-pp-23"></a></p><h4 id="é‚®ä»¶è”ç³»"><a href="#é‚®ä»¶è”ç³»" class="headerlink" title="é‚®ä»¶è”ç³»"></a>é‚®ä»¶è”ç³»</h4><p>å¤§è‡´å†…å®¹å¦‚ä¸‹ï¼š</p><blockquote><p>Hi, there. I just signed up my PayPal account. when I bind it with iTunes. it shows â€œSorry, we weren â€™ t able to set up preapproved payments at this time.â€<br>Can you help me to figure out, thanks!</p></blockquote><p>ç­‰å¾…å®¢æœå›å¤é‚®ä»¶åï¼Œå¯èƒ½åˆ°æ­¤å°±å·²ç»è§£å†³äº†ã€‚ä¹Ÿæœ‰å¯èƒ½å®¢æœè®©ä½ ç»™ä»–æ‰“ç”µè¯æ¥è¿›è¡Œç¡®è®¤ã€‚æ­¤æ—¶ä½ æœ‰ä¸‰ä¸ªé€‰æ‹©ã€‚</p><ul><li>æ‰“ç”µè¯è¿‡å»ï¼Œè‹¥ä½¿ç”¨å·²ç»‘å®šçš„ Google Voice æ‹¨æ‰“ï¼ŒPayPalå¯ä»¥è‡ªåŠ¨è¾¨åˆ«ä½ çš„è´¦æˆ·ï¼Œè·Ÿäººå·¥å®¢æœè§£é‡Šä¸€ä¸‹ï¼Œè¯´ä¸çŸ¥é“ä¸ºä»€ä¹ˆä¸èƒ½è´­ä¹°ï¼Œä»–ä»¬åå°æ“ä½œä¸€ä¸‹å³å¯ã€‚</li><li>å¦‚æœè§‰å¾—è‡ªå·±è‹±è¯­ä¸è¡Œï¼Œæä¸å®šç”µè¯ï¼Œå¯ä»¥æ‰¾ä¸‡èƒ½çš„æ·˜å®ã€‚</li><li>ä½ ä¹Ÿå¯ä»¥é€‰æ‹©æ³¨é”€è¿™ä¸ªè´¦å·ï¼Œé‡å¤ä»¥ä¸Šæ­¥éª¤ï¼Œå¯èƒ½ä¼šé¿å¼€é£æ§ã€‚</li></ul><h4 id="åœ¨çº¿å®¢æœ"><a href="#åœ¨çº¿å®¢æœ" class="headerlink" title="åœ¨çº¿å®¢æœ"></a>åœ¨çº¿å®¢æœ</h4><p>ç‚¹å‡» <code>Chat with us</code>ï¼Œå¹¶æ¥å…¥ç¾åŒº PayPal åœ¨çº¿å®¢æœï¼ˆå¼¹çª—åœ¨ç‚¹å‡»åä¼šå‡ºç°åœ¨é¡µé¢å³ä¸‹è§’ï¼‰ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-24.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-24.jpg" alt="20181122-reg-us-pp-24"></a></p><p>ä¸åœ¨çº¿å®¢æœèŠå¤©ä¸»è¦æ˜¯å’Œä»–è¯´æ˜è‡ªå·±ç¾åŒº PayPal é£æ§çš„æƒ…å†µï¼Œç„¶åä»–ä¼šå¸®ä½ æŸ¥çœ‹ï¼Œå¹¶å‘ŠçŸ¥é£æ§çš„åŸå› ï¼Œä½†æ˜¯ä»–å¹¶æ²¡æœ‰ç»™å‡ºå…·ä½“çš„è§£å†³æ–¹æ¡ˆã€‚å¯æ˜¯åœ¨èŠå¤©ç»“æŸåçš„ 5-10 åˆ†é’Ÿåé‡æ–°è¿›è¡Œä¸€æ¬¡ç¾åŒº PayPal çš„ç»‘å®šï¼Œå°±å¯ä»¥éå¸¸é¡ºåˆ©çš„å°†ç¾åŒº PayPal ç»‘å®šåˆ°ç¾åŒº Apple ID ä¸Šäº†ï¼ˆçœŸçš„æ˜¯å¾ˆç„å­¦ï¼‰ï¼Œæ„Ÿè°¢TGä¸Š @Ada_wx @ritafishyyyy è¿™2ä½çš„æµ‹è¯•ï¼Œè¿™2ä½ä¸æˆ‘çš„å°å·å‡è¢«é£æ§ï¼Œä½†åŒæ ·çš„ï¼Œæ¯æ¬¡ä¸åœ¨çº¿å®¢æœèŠå®Œå¤©åï¼ŒæˆåŠŸè§£é™¤äº†é£æ§ï¼Œæ³¨å†Œå‘¨æœŸåˆ†åˆ«æ˜¯ @Ada_wx 7å¤©å‰æ³¨å†Œçš„ï¼Œ @ritafishyyyy 3å¤©å‰æ³¨å†Œçš„å’Œæˆ‘å°å·çš„12å°æ—¶å‰æ³¨å†Œçš„ã€‚</p><p>å› ä¸ºæ˜¯ç¾åŒºçš„å®¢æœï¼Œéƒ½æ˜¯ç”¨è‹±æ–‡äº¤æµï¼Œæˆ‘æ²¡æœ‰å°è¯•è¿‡æ˜¯ä¸æ˜¯æœ‰ä¸­æ–‡æœåŠ¡ã€‚å¦‚æœæ²¡æœ‰çš„è¯å¯ä»¥ç›´æ¥ç”¨è°·æ­Œç¿»è¯‘ï¼Œå¤§è‡´æ„æ€å°±æ˜¯ä½ çš„ PayPal è¢«é£æ§äº†ï¼Œæœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥è§£å†³ï¼Œæ˜¯å¦å¸®æˆ‘åå°æŸ¥çœ‹æˆ–è€…è°ƒæ•´ä¸€ä¸‹ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€å®šè¦å£°æ˜ä½ æ˜¯åœ¨ç»‘å®š Apple ID çš„ä»˜æ¬¾æ–¹å¼è¢«é£æ§çš„ã€‚</p><p>ä¾‹å¦‚ï¼š</p><ul><li>Sorry, we werenâ€™t able to set up preapproved payments at this time.</li><li>Why canâ€™t I use paypal on itunes?</li></ul><p>å› ä¸ºæˆ‘æ˜¯åœ¨ç½‘é¡µç‰ˆä¸å®¢æœèŠå¤©çš„ï¼Œæ‰€ä»¥èŠå®Œä¹‹åæˆ‘å°±ç›´æ¥ç™»é™†è‹¹æœ Apple ID è´¦æˆ·å®˜ç½‘è¿›è¡Œä»˜æ¬¾æ–¹å¼çš„ç»‘å®šï¼ˆå¦å¤–2ä½æµ‹è¯•çš„æœ‹å‹ä¹Ÿæ˜¯æœ€åç½‘é¡µç‰ˆçš„ Apple ID è´¦æˆ·å®˜ç½‘ç»‘å®šçš„ï¼‰ï¼Œæ‰“å¼€ <a href="http://jolson.xyz/2018/11/22/reg-us-pp/appleid.apple.com" target="_blank" rel="noopener">appleid.apple.com</a> è¾“å…¥è´¦å·å¯†ç åï¼Œè¿›å…¥ç¾åŒº Apple ID è´¦æˆ·ä¿¡æ¯é¦–é¡µï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-25.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-25.jpg" alt="20181122-reg-us-pp-25"></a></p><p>å¾€ä¸‹æ‹‰ï¼Œæ‰¾åˆ° <code>PAYMENT METHOD</code>ï¼Œé€‰æ‹© PayPal ä»˜æ¬¾æ–¹å¼ï¼Œå¹¶ç‚¹å‡» <code>Sign In to PayPal</code>ï¼Œï¼ˆå¦‚æœä¸‹æ–¹ <code>SHIPPING ADDRESS</code> ä¸ºç©ºï¼Œè¯·å¤åˆ¶ä¸ <code>BILLING ADDRESS</code> ç›¸åŒçš„åœ°å€å¡«å†™ï¼Œå¯é€‰éƒ¨åˆ†å¯ä¸å†™ï¼‰ã€‚ç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-26.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-26.jpg" alt="20181122-reg-us-pp-26"></a></p><p>å› ä¸ºæˆ‘åœ¨ç½‘é¡µç‰ˆä¸Šç™»é™†è¿‡ PayPalï¼Œæ‰€ä»¥è·³è¿‡äº†è¾“å…¥è´¦å·å¯†ç çš„è¿‡ç¨‹ï¼Œå¹¶ç›´æ¥è¿›è¡Œå®‰å…¨æ£€æŸ¥ã€‚å®‰å…¨æ£€æŸ¥ç»“æŸåæˆåŠŸæ˜¾ç¤ºä»˜æ¬¾ä¿¡æ¯é¡µé¢ï¼ˆå¦‚æœåœ¨è¿™é‡Œè¿˜æ˜¯è¢«é£æ§äº†ï¼Œé‚£ä¹ˆè¯´æ˜ä¸åœ¨çº¿å®¢æœèŠå¤©å¹¶è§£é™¤é£æ§çš„åŠæ³•å·²å¤±æ•ˆï¼Œè¯·å¤§å®¶é‡æ–°å¯»æ‰¾è§£é™¤é£æ§çš„æ–¹æ³•ï¼‰ï¼Œç‚¹å‡» <code>Agree &amp; Continue</code>ï¼ˆåœ¨æœ¬æ•™ç¨‹ç¬¬äºŒç‚¹ä¸­åœ¨ App Store è¿›è¡Œç¾åŒº PayPal ç»‘å®šï¼Œå¦‚æœæ²¡æœ‰è¢«é£æ§ç›´æ¥æˆåŠŸä¹Ÿä¼šå‡ºç°è¿™ä¸ªç•Œé¢ï¼‰ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-27.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-27.jpg" alt="20181122-reg-us-pp-27"></a></p><p>æœ€åç‚¹å‡» <code>Save</code>ï¼ˆApp Storeé‡Œæ˜¯Doneï¼‰æˆåŠŸå®Œæˆç»‘å®šï¼Œå®Œç¾è§£å†³äº†ç¾åŒº PayPal çš„é£æ§ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-28.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-28.jpg" alt="20181122-reg-us-pp-28"></a></p><p>è‡³æ­¤æ‰€æœ‰ PayPal çš„æ³¨å†Œã€ç»‘å®šä»¥åŠé£æ§çš„è§£å†³åŠæ³•ï¼ˆä¸ä¿è¯ä¹‹åçš„æ‰€æœ‰äºº100%å¯ä»¥è§£é™¤é£æ§ï¼‰éƒ½å·²ç»ç»“æŸã€‚ä½†æ˜¯è¿™å¹¶ä¸æ„å‘³ç€æ‰€æœ‰çš„é—®é¢˜éƒ½å·²è§£å†³ï¼Œæ¥ä¸‹æ¥è¿˜è¦è¿‡è‹¹æœè¿™æœ€åä¸€å…³ï¼Œä¹Ÿå°±æ˜¯è‹¹æœçš„é£æ§ï¼Œä½†è‹¹æœçš„é£æ§å¾ˆå¥½è§£å†³ã€‚</p><h3 id="æµ‹è¯•ä»˜æ¬¾æ–¹å¼ï¼ˆApp-Purchase-ä»¥åŠ-In-App-Purchasesï¼‰ï¼ŒæŸ¥çœ‹æ˜¯å¦æˆåŠŸä»˜æ¬¾ï¼Œæˆ–è€…æ˜¯å¦è¢«-Apple-é£æ§åŠè§£å†³åŠæ³•"><a href="#æµ‹è¯•ä»˜æ¬¾æ–¹å¼ï¼ˆApp-Purchase-ä»¥åŠ-In-App-Purchasesï¼‰ï¼ŒæŸ¥çœ‹æ˜¯å¦æˆåŠŸä»˜æ¬¾ï¼Œæˆ–è€…æ˜¯å¦è¢«-Apple-é£æ§åŠè§£å†³åŠæ³•" class="headerlink" title="æµ‹è¯•ä»˜æ¬¾æ–¹å¼ï¼ˆApp Purchase ä»¥åŠ In-App Purchasesï¼‰ï¼ŒæŸ¥çœ‹æ˜¯å¦æˆåŠŸä»˜æ¬¾ï¼Œæˆ–è€…æ˜¯å¦è¢« Apple é£æ§åŠè§£å†³åŠæ³•"></a>æµ‹è¯•ä»˜æ¬¾æ–¹å¼ï¼ˆApp Purchase ä»¥åŠ In-App Purchasesï¼‰ï¼ŒæŸ¥çœ‹æ˜¯å¦æˆåŠŸä»˜æ¬¾ï¼Œæˆ–è€…æ˜¯å¦è¢« Apple é£æ§åŠè§£å†³åŠæ³•</h3><p>æ‰“å¼€ App Storeï¼Œå¹¶ç™»é™†å·²ç»æˆåŠŸç»‘å®šç¾åŒº PayPal çš„ Apple ID è´¦æˆ·ï¼Œå¹¶éšä¾¿æœç´¢ä¸€ä¸ªä»˜è´¹çš„ Appï¼Œå¹¶è¿›è¡Œ APï¼ˆApp Purchaseï¼‰æµ‹è¯•ï¼Œå¹¶ç‚¹å‡»è´­ä¹°ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-29.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-29.jpg" alt="20181122-reg-us-pp-29"></a></p><p>æŒ‡çº¹æ”¯ä»˜åï¼Œä¼šæ˜¾ç¤º PayPal å·ç çš„éªŒè¯ï¼ˆéªŒè¯ä¹Ÿå¯èƒ½ä¸ä¼šå‡ºç°ï¼‰ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-30.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-30.jpg" alt="20181122-reg-us-pp-30"></a></p><p>å¦‚æœä¸å‡ºç°éªŒè¯ï¼ŒåŸºæœ¬å°±ç›´æ¥è´­ä¹°æˆåŠŸäº†ï¼Œå¦‚æœå‡ºç°äº†éªŒè¯ï¼Œè¾“å…¥éªŒè¯ç å³å¯ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-31.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-31.jpg" alt="20181122-reg-us-pp-31"></a></p><p>ç‚¹å‡» Doneï¼Œä¼šå†è·³å‡ºä¸€æ¬¡æŒ‡çº¹æ”¯ä»˜ï¼Œæ”¯ä»˜å®Œæˆåï¼Œä¼šç›´æ¥æ”¶åˆ° PayPal å’Œ iTunes çš„æ”¶æ®ï¼ˆä¹Ÿå¯èƒ½ä¼šå»¶è¿Ÿæ”¶åˆ°ï¼‰ã€‚ä¸‹è½½å®‰è£…å®Œæˆåä¼šæ˜¾ç¤º OPEN æŒ‰é’®ï¼Œè¿™è¡¨ç¤º App Purchaseï¼ˆAPåŸºæœ¬éƒ½æ˜¯é€šè¿‡çš„ï¼‰æˆåŠŸé€šè¿‡æµ‹è¯•ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-32.jpg" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-32.jpg" alt="20181122-reg-us-pp-32"></a></p><p>åœ¨è¿™ä¹‹åéšæ„æ‰“å¼€ä¸€ä¸ªå¯ä»¥è¿›è¡Œ <code>IAP</code>ï¼ˆIn-App Purchasesï¼‰ä»˜æ¬¾çš„Appï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-33.png" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-33.png" alt="20181122-reg-us-pp-33"></a></p><p>ç‚¹å‡»ç§»é™¤å¹¿å‘Šï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°ä¸€ä¸‹2ä¸ªæç¤ºå¼¹çª—ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-34.png" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-34.png" alt="20181122-reg-us-pp-34"></a></p><p>å¦‚æœæ˜¾ç¤º <code>You&#39;re all set</code>. åˆ™è¯´æ˜ä½ æˆåŠŸè¿›è¡Œäº† <code>IAP</code> çš„ä»˜æ¬¾ï¼Œæ²¡æœ‰è¢« Apple é£æ§ï¼Œè‡³æ­¤æ‰€æœ‰çš„ç¾åŒº Apple ID è´¦æˆ·éƒ½å·²å®Œå…¨å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚å¦‚æœæ˜¾ç¤º <code>Your Purchase Could Not Be Completed</code> åˆ™è¯´æ˜ä½ è¢«è‹¹æœé£æ§äº†ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="https://img.i7years.com/blog/20181122-reg-us-pp-35.png" target="_blank" rel="noopener"><img src="https://img.i7years.com/blog/20181122-reg-us-pp-35.png" alt="20181122-reg-us-pp-35"></a></p><p>å‡ºç°è¿™ä¸ªæç¤ºï¼Œåªæœ‰ä¸€ä¸ªåŠæ³•å¯ä»¥è§£å†³ï¼Œå°±æ˜¯è‡´ç”µä¸­å›½è‹¹æœå®¢æœï¼ˆä¸­å›½å®¢æœå³å¯ï¼Œå› ä¸ºæ˜¯å…¨çƒæœåŠ¡ï¼Œä¸ä¸€å®šéœ€è¦ç¾å›½å®¢æœï¼‰ã€‚ä½†æ˜¯è¦æ³¨æ„ï¼Œè¿™ä¸ªæƒ…å†µæ˜¯éš¶å±äºè´¦å•éƒ¨é—¨ï¼Œå¦‚æœé€‰é”™éƒ¨é—¨ä¹Ÿæ²¡å…³ç³»ï¼Œå¯ä»¥è¿›è¡Œè½¬æ¥ã€‚</p><p>å¦å¤–2ä¸ªæµ‹è¯•çš„æœ‹å‹ï¼Œ1ä¸ª IAP è¢«é£æ§ï¼Œï¼Œå¦å¤–1ä¸ªæ²¡æœ‰è¢«é£æ§ï¼Œæˆ‘çš„å°å·ä¹Ÿè¢« IAP é£æ§ï¼Œä½†åŒæ ·éƒ½æ˜¯é€šè¿‡å®¢æœè§£å†³çš„ï¼Œéå¸¸æ–¹ä¾¿ã€‚</p><p>è‡´ç”µçš„å¤§è‡´çš„èŠå¤©å†…å®¹åŸºæœ¬å°±æ˜¯ä½ çš„ç¾åŒº Apple ID æˆåŠŸç»‘å®š PayPal åï¼Œå¯ä»¥è¿›è¡Œ AP çš„æ¶ˆè´¹ï¼Œå´ä¸èƒ½è¿›è¡Œ IAP çš„æ¶ˆè´¹ï¼Œè€Œæç¤ºä¸èƒ½è¿›è¡Œ IAP æ¶ˆè´¹çš„é‚£æ®µçš„ä¸­æ–‡æ„æ€æ˜¯ï¼šæ— æ³•å®Œæˆæ­¤æ¬¡ä»˜æ¬¾ï¼Œè¯·è”ç³» iTunes å®¢æœå¯»æ±‚æŠ€æœ¯æ”¯æŒã€‚</p><p>ç„¶åå¤§æ¦‚ä¼šå†ç»å†1-2æ¬¡è½¬æ¥ï¼Œä¹‹åè½¬æ¥çš„äººä¼šå’Œä½ è¯´ä»–ä»¬å°†ä½ çš„è´¦æˆ·è¿›è¡Œäº†è°ƒæ•´ï¼Œè®©ä½ å†ä¸€æ¬¡å°è¯• IAP çš„ä»˜æ¬¾ã€‚åŸºæœ¬åˆ°è¿™é‡Œå°±æˆåŠŸæ¶ˆè´¹äº†ï¼ˆæˆ‘çš„å¦ä¸€ä¸ªè¢«é£æ§çš„æœ‹å‹å°±æ˜¯ï¼Œå¬è¯´å¥½åƒæ˜¯ç¾å›½é‚£è¾¹çš„ä¸­æ–‡å®¢æœå›ç”µç»™ä»–ï¼Œç„¶åå°±æˆåŠŸäº†ï¼‰ã€‚<br>è€Œæ¥¼ä¸»å°å·å°±æ¯”è¾ƒè„¸é»‘äº†ï¼Œè¿ç»­è°ƒæ•´äº†2æ¬¡éƒ½è¿˜æ˜¯æ— æ³• IAP æ¶ˆè´¹ï¼Œæœ€åå®¢æœè¯´ä»–ä»¬ä¼šè”ç³»ç¾å›½é‚£è¾¹çš„å®¢æœå¸®æˆ‘è§£å†³ï¼Œå°†åœ¨1-2å¤©å†…ç»™æˆ‘å›ç”µã€‚ä½†æ˜¯ç»™æˆ‘å›ç”µçš„è¿˜æ˜¯ä¸­å›½çš„å®¢æœï¼Œæœ€åæˆ‘å†æ¬¡å°è¯•åï¼Œæˆ‘ä¹ŸæˆåŠŸçš„è¿›è¡Œäº† IAP çš„æ¶ˆè´¹ï¼Œè‡³æ­¤ï¼Œæˆ‘çš„å°å·è¿˜æœ‰æˆ‘çš„æœ‹å‹éƒ½æˆåŠŸå®Œæˆäº†ç¾åŒº Apple ID æ‰€æœ‰çš„ä¿¡æ¯ç»‘å®šï¼Œå¯ä»¥å®Œç¾ä½¿ç”¨ã€‚</p><blockquote><p>æ¯ä¸ªäººå’Œå®¢æœçš„èŠå¤©å†…å®¹ä¸åŒï¼Œä¹Ÿä¼šæœ‰ä¸ä¸€æ ·çš„å›å¤ã€‚æ¯”å¦‚æˆ‘æœ‹å‹æ˜¯å½“å¤©æ¥åˆ°äº†ç¾å›½çš„ä¸­æ–‡å®¢æœå¸®ä»–è§£å†³ï¼Œè€Œæˆ‘æ˜¯ç­‰åˆ°ç¬¬äºŒå¤©ï¼Œä¸­å›½å®¢æœè”ç³»å¥½äº†ç¾å›½å®¢æœåï¼Œå†ç”±ä¸­å›½çš„å®¢æœè”ç³»æˆ‘å¸®æˆ‘è§£å†³ã€‚</p></blockquote><p>åœ¨æ‰€æœ‰çš„ AP å’Œ IAP ä»˜æ¬¾å…¨éƒ¨è§£é™¤äº†è‹¹æœçš„é£æ§ä¹‹åï¼Œä¸‹ä¸€æ¬¡å¯ä»¥ä¸ç”¨å†é€šè¿‡ä½¿ç”¨ä»£ç†è¿›è¡Œæ¶ˆè´¹ï¼ˆå› ä¸ºè€å¤–ä¹Ÿä¼šæ¥ä¸­å›½æˆ–è€…å»å…¶ä»–å›½å®¶/åœ°åŒºï¼‰ã€‚</p><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><blockquote><p>æ¥è‡ªï¼š<a href="https://twitter.com/waylybaye/status/957448362193666048" target="_blank" rel="noopener">https://twitter.com/waylybaye/status/957448362193666048</a></p></blockquote><p>å¦‚æœä½ ç”¨å¤–åŒº Paypal æ¥ä½œä¸º App Storeã€å¥—è·¯äº‘ç­‰å…¶å®ƒå•†å®¶çš„ä»˜æ¬¾æ–¹å¼ï¼Œè€Œä¸”å‘ç°æ‰£æ¬¾æ—¶æ±‡ç‡å¾ˆé«˜ï¼ŒåŠ¡å¿…æŒ‰ç…§ä¸‹å›¾çš„æ­¥éª¤åˆ‡æ¢ä¸‹ç»“ç®—è´§å¸ï¼Œä¸è¦è®©PPè½¬æ¢è´§å¸ã€‚</p><p><img src="https://img.i7years.com/blog/reg-us-pp-39.jpg" alt="Register-US-PayPal"></p><p><img src="https://img.i7years.com/blog/reg-us-pp-36.png" alt="Register-US-PayPal"></p><p><img src="https://img.i7years.com/blog/reg-us-pp-37.png" alt="Register-US-PayPal"></p><p><img src="https://img.i7years.com/blog/reg-us-pp-38.png" alt="Register-US-PayPal"></p><h2 id="å†™åœ¨æœ€å"><a href="#å†™åœ¨æœ€å" class="headerlink" title="å†™åœ¨æœ€å"></a>å†™åœ¨æœ€å</h2><p>ä» PayPal çš„æ³¨å†Œåˆ°ç¾åŒº Apple ID ä»˜æ¬¾æ–¹å¼ç»‘å®šï¼Œåˆ°æœ€åçš„è§£å†³ PayPal çš„é£æ§è¿˜æœ‰è‹¹æœçš„é£æ§ä¸€å…±ç»å†äº†36å°æ—¶å·¦å³ï¼Œç®—æ˜¯ç‰¹åœ°ä¸ºäº†è¿™ä¸ªæ•™ç¨‹åˆ›å»ºçš„å°å·å¼ºè¡Œè¢«é£æ§ä»¥åŠå¸®å¤§å®¶è¸©å‘ã€‚</p><p>è¿˜æœ‰è¦å£°æ˜çš„ä¸€ç‚¹æ˜¯ï¼Œæ¯æ¬¡ä½¿ç”¨ PayPal è¿›è¡Œ App Store ç›¸å…³çš„æ‰€æœ‰ä»˜æ¬¾ï¼Œéƒ½æœ‰å¯èƒ½ä¼šå»¶è¿Ÿ 1 åˆ° 3 å¤©æ‰ä¼šç»™ä½ å‘é€ä½ çš„è´­ä¹°å‡­è¯å’Œæ”¶æ®ä¿¡æ¯ï¼Œå¹¶ä¸ä¼šåŠæ—¶çš„ç»™ä½ å‘é€æ”¶æ®å‡­è¯çš„é‚®ä»¶æ¶ˆæ¯ï¼Œä½†æ˜¯è¿™ä¸å½±å“ï¼Œä¸ç”¨å¤ªè¿‡æ‹…å¿ƒã€‚ï¼ˆæœ‰äººè¯´æ¯æ¬¡ç‚¹å‡» Apple ID é‡Œçš„ <code>Payment Information</code> å³ä¸Šè§’çš„ Doneï¼Œæ”¶æ®å’Œå‡­è¯ä¼šç«‹é©¬å‘ç»™ä½ ï¼Œæœ‰å…´è¶£çš„å¤§ä¼™å¯ä»¥è¯•è¯•ï¼‰ã€‚</p><p>å½“ç„¶æˆ‘ä¸èƒ½ä¿è¯æ¯ä¸ªäººéƒ½èƒ½æˆåŠŸè§£é™¤ PayPal çš„é£æ§ï¼ˆå½“ç„¶é™¤äº†ä¸€æ¬¡æ€§é€šè¿‡ç»‘å®šçš„äººé™¤å¤–ï¼‰ï¼Œåªæ˜¯ç»™å¤§å®¶ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œè¿™ä¸ªè§£å†³æ–¹æ¡ˆçœ‹ä¼¼æœ‰ç‚¹å¥‡æ€ªï¼Œä½†çš„ç¡®3ä¸ªè¢«é£æ§çš„äººéƒ½å…¨éƒ¨è§£é™¤äº†é£æ§ã€‚</p><p>ä¹Ÿè®¸ç°åœ¨ä¸åœ¨çº¿å®¢æœèŠå¤©åå¯ä»¥å’Œæœ¬æ•™ç¨‹æµ‹è¯•çš„ä¸€æ ·å¾ˆé¡ºåˆ©çš„è§£é™¤ PayPal çš„é£æ§ã€‚ä½†ä¹Ÿè®¸è¿‡åä¸ä¹…ä¼šè¢« PayPal å‘ç°æ¼æ´å¹¶ç¦æ­¢ï¼Œä¹Ÿå¯èƒ½åœ¨æœ¬æ•™ç¨‹ä¸­æˆ‘ä»¬3ä¸ªäººåªæ˜¯å‡‘å·§é€šè¿‡è¿™ä¸ªæ–¹æ³•è§£é™¤äº†é£æ§ï¼Œå…·ä½“åŸå› æˆ‘ä»¬éƒ½ä¸å¾—è€ŒçŸ¥ã€‚ä½†å¦‚æœä¹‹åæœ¬æ•™ç¨‹ä¸­è§£é™¤ PayPal é£æ§çš„è§£å†³æ–¹æ¡ˆå¤±æ•ˆäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯èƒ½ä¸ä¼šå†å¯¹å…¶é£æ§çš„åŸå› å’Œé£æ§çš„è§£å†³æ–¹æ¡ˆè¿›è¡Œæ›´æ·±å…¥çš„ç ”ç©¶ã€‚</p><p>è¿˜æ˜¯æ²¡æœ‰è§£é™¤é£æ§çš„äººï¼Œè¿˜æ˜¯å°½é‡æ‰¾ TG ä¸Šçš„ä»£è´­ï¼Œæˆ–åœ¨æ·˜å®è§£å†³ã€‚ï¼ˆæ­£ç‰ˆ Shadowrocket ä»·æ ¼ä¸º2.99åˆ€ï¼ŒQuantumult æ­£ç‰ˆä»·æ ¼ä¸º4.99åˆ€ï¼Œæ·˜å®é‚£ç§10å—é’±ä½ä»·çš„å‡ä¸ºé»‘å¡ï¼å»ºè®®é€‰æ‹©ä»£è´­ã€‚ï¼‰</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://digitalimmigrant.org/171" target="_blank" rel="noopener">https://digitalimmigrant.org/171</a></li></ul>]]></content>
      
        <categories>
            
            <category> tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> freedom </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æ•°æ®ç§»æ°‘æ¼‚æµè®°â€”â€”å¦‚ä½•æ³¨å†Œå¹¶ä½¿ç”¨ç¾åŒº Apple ID]]></title>
      <url>/posts/How-to-register-and-use-the-US-Apple-ID.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/air-travel-aircraft-aircraft-wing-2007401.jpg?imageslim" alt="air-travel-aircraft-aircraft-wing-2007401"></p><blockquote><p>è½¬è½½ï¼š<a href="http://jolson.xyz/2018/11/15/reg-appleid/" target="_blank" rel="noopener">http://jolson.xyz/2018/11/15/reg-appleid/</a></p></blockquote><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å› ä¸ºæ¯ä¸ªäººçš„ä½¿ç”¨éœ€æ±‚ä¸åŒï¼Œæ¯”å¦‚ SSã€SSRã€V2 ç­‰éƒ½éœ€è¦ç›¸å¯¹åº”çš„ç½‘ç»œä»£ç†å·¥å…· Appã€‚ä½†ç”±äºæŸäº›ç‰¹æ®ŠåŸå› ï¼Œä¸­å›½åŒº App Store åŸºæœ¬ä¸Šä¸‹æ¶äº†å¤§éƒ¨åˆ†çš„ç½‘ç»œä»£ç†å·¥å…· Appï¼ˆä¾‹å¦‚ç”¨çš„æ¯”è¾ƒå¤šçš„å°ç«ç®­ Shadowrocket å’Œåœˆ Quantumult ç­‰ç­‰ï¼‰ã€‚</p><p>å› ä¸ºä¸­å›½åŒºæ— æ³•ä¸‹è½½åˆ°è‡ªå·±æ‰€éœ€è¦ä½¿ç”¨çš„Appï¼Œåˆ™å¤§éƒ¨åˆ†äººéƒ½éœ€è¦æ³¨å†Œéä¸­å›½åŒºï¼ˆå¦‚ç¾åŒºã€æ¸¯åŒºç­‰ï¼‰çš„åº”ç”¨å•†åº—ä»˜è´¹è¿›è¡Œä¸‹è½½ï¼ˆå‡ºäºå°Šé‡ä½œè€…çš„è§’åº¦å‡ºå‘ï¼Œè¯·å°½é‡ä¸è¦ä½¿ç”¨å…±äº« Apple ID è´¦å·ä¸‹è½½è½¯ä»¶ï¼Œæ­£ç‰ˆ App å…¶å®ä¹Ÿå°±å‡ åå—é’±ï¼‰ã€‚</p><p>æœ¬æ–‡ä»¥æ³¨å†Œç¾åŒº Apple ID è´¦å·ä¸ºä¾‹ï¼ˆå…¶ä»–åœ°åŒºè´¦å·åŒç†ï¼‰ï¼Œä½†å…³äºç¾åŒº Apple ID è´¦å·å’Œç»‘å®š PayPal è‡ªè¡Œ Google æœç´¢ç›¸å…³æ•™ç¨‹ï¼Œå¦‚éœ€æ±‚è¾ƒå¤§åç»­æˆ‘å¯ä»¥å†å‡ºç›¸å…³æ•™ç¨‹ã€‚</p><ul><li>ç¾åŒº Apple ID è´¦æˆ·å¯ç»‘å®šç¾åŒºï¼ˆåªèƒ½ç¾åŒºï¼Œå…¶ä»–åœ°åŒºä¸è¡Œï¼‰ Paypal è¿›è¡Œä»˜æ¬¾ã€‚</li><li>æ¸¯åŒº Apple ID è´¦æˆ·å¯æ³¨å†Œ <code>Tap and Go</code> é¦™æ¸¯ MS è™šæ‹Ÿé¢„ä»˜ä¿¡ç”¨å¡å¹¶ç»‘å®šæ¸¯åŒº Apple ID è´¦æˆ·è¿›è¡Œä»˜æ¬¾ï¼ˆå‰æä½ è¦æœ‰æ¸¯æ¾³é€šè¡Œè¯ï¼‰ã€‚å…·ä½“æ“ä½œå¯å‚è€ƒ BIGDONGDONG çš„è§†é¢‘æ•™å­¦ï¼š<a href="https://www.youtube.com/watch?v=97IzYP0zNqk" target="_blank" rel="noopener">5åˆ†é’Ÿè®©ä½ æ‹¥æœ‰ä¸€å¼  Mastercard å¤–å¸ç§å¡</a></li><li>æ—¥åŒº Apple ID è´¦æˆ·å¯ç›´æ¥ç»‘å®š JCB ä¿¡ç”¨å¡è¿›è¡Œä»˜æ¬¾ã€‚</li></ul><h2 id="æ³¨å†Œç¾åŒº-Apple-ID-è´¦æˆ·"><a href="#æ³¨å†Œç¾åŒº-Apple-ID-è´¦æˆ·" class="headerlink" title="æ³¨å†Œç¾åŒº Apple ID è´¦æˆ·"></a>æ³¨å†Œç¾åŒº Apple ID è´¦æˆ·</h2><h3 id="1ã€ç™»é™†è‹¹æœè´¦æˆ·å®˜ç½‘"><a href="#1ã€ç™»é™†è‹¹æœè´¦æˆ·å®˜ç½‘" class="headerlink" title="1ã€ç™»é™†è‹¹æœè´¦æˆ·å®˜ç½‘"></a>1ã€ç™»é™†è‹¹æœè´¦æˆ·å®˜ç½‘</h3><p>é¦–å…ˆæ‰“å¼€ <a href="http://jolson.xyz/2018/11/15/reg-appleid/appleid.apple.com" target="_blank" rel="noopener">appleid.apple.com</a>ï¼Œé¦–æ¬¡æ‰“å¼€æ—¶é¦–é¡µå±•ç¤ºå›¾å¦‚ä¸‹ï¼š</p><p><img src="https://img.i7years.com/blog/5c2b2dd95185d.jpg" alt=""></p><p>ç‚¹å‡»åº•éƒ¨ <code>Create your Apple ID</code> è¿›å…¥æ³¨å†Œè´¦æˆ·ç•Œé¢ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://img.i7years.com/blog/5c2b2dd96cbc4.jpg" alt=""></p><p><code>å›½å®¶/åœ°åŒº</code>ä¸€å®šè¦é€‰æ‹© <code>United States</code>ï¼Œä¹Ÿå°±æ˜¯<code>ç¾å›½</code>ï¼Œè¿™ç‚¹å¾ˆé‡è¦ï¼Œç›´æ¥å†³å®šäº†ä½ çš„è´¦æˆ·æ˜¯å±äºå“ªä¸ª<code>å›½å®¶/åœ°åŒº</code>ï¼ˆå¦‚æœæƒ³æ³¨å†Œé¦™æ¸¯åœ°åŒºçš„è´¦å·ï¼Œè¯·é€‰æ‹© <code>HONG KONG</code>ï¼Œå…¶ä»–å›½å®¶/åœ°åŒºåŒç†ï¼‰ã€‚</p><p>ç¾åŒºApple IDå»ºè®®ä½¿ç”¨<code>è°·æ­Œé‚®ç®±</code>æ³¨å†Œï¼ˆä¸ºäº†å¥½è¿‡ç„å­¦ç¾åŒº PayPal ç»‘å®šï¼‰ã€‚æ³¨å†Œå†…å®¹å…¨éƒ¨å¡«å†™å®Œæ¯•åï¼Œæ‹‰åˆ°æœ€ä¸‹é¢ç‚¹å‡»ç»§ç»­ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://img.i7years.com/blog/5c2b2dd965152.jpg" alt=""></p><p>ç‚¹å‡»ç»§ç»­æŒ‰é’®åï¼Œè‹¹æœä¼šè®©ä½ éªŒè¯ä½ çš„ç”µå­é‚®ä»¶ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://img.i7years.com/blog/5c2b2dd9755a5.jpg" alt=""></p><p>éªŒè¯å®Œæ¯•åï¼Œä¼šè¿›å…¥ä½ çš„<code>è´¦æˆ·ä¿¡æ¯é¡µé¢</code>ï¼Œå¦‚æœ<code>å›½å®¶/åœ°åŒº</code>æ˜¾ç¤ºä¸º<code>ç¾å›½</code>ï¼Œåˆ™æ³¨å†ŒæˆåŠŸï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://img.i7years.com/blog/5c2b2dd98cb07.jpg" alt=""></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ³¨å†Œå¥½æ–°è´¦æˆ·åï¼Œç¾åŒº Apple ID è¿˜æš‚ä¸å¯ç”¨ï¼Œéœ€è¦åœ¨æ‰‹æœºä¸Šç™»é™† App Store æ¥æ¿€æ´»æ–°æ³¨å†Œçš„ç¾åŒºè´¦æˆ·ï¼Œæ‰å¯ä½¿ç”¨ã€‚</p><p>åœ¨ç”¨æ–°ç¾åŒºè´¦æˆ·ç™»é™† App Store ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ çš„æ‰‹æœºæ‰“å¼€äº†ç¾å›½èŠ‚ç‚¹çš„<code>å…¨å±€ç¿»å¢™</code>ï¼è¿™ç‚¹å¾ˆé‡è¦ï¼Œå¦åˆ™æ— æ³•å®Œæˆæ¿€æ´»ï¼ï¼ˆé™¤éä½ æœ‰ä»˜æ¬¾æ–¹å¼ï¼‰</p><blockquote><p>PSï¼šå¦‚æœæ˜¯æ¿€æ´»æ¸¯åŒº Apple IDï¼Œè¯·ä½¿ç”¨é¦™æ¸¯èŠ‚ç‚¹å…¨å±€ç¿»å¢™ï¼Œå…¶ä»–åœ°åŒºåŒç†ã€‚</p></blockquote><h3 id="2ã€æ¿€æ´»ç¾åŒºè´¦æˆ·"><a href="#2ã€æ¿€æ´»ç¾åŒºè´¦æˆ·" class="headerlink" title="2ã€æ¿€æ´»ç¾åŒºè´¦æˆ·"></a>2ã€æ¿€æ´»ç¾åŒºè´¦æˆ·</h3><p>æ‰“å¼€ <code>App Store</code>ï¼Œå¹¶ç‚¹å‡»<code>å³ä¸Šè§’å¤´åƒ</code>ï¼ˆæœ¬æ•™ç¨‹ä½¿ç”¨çš„è®¾å¤‡ç³»ç»Ÿä¸º iOS 12ï¼Œæ¯”è¾ƒè€çš„ç³»ç»Ÿå¦‚æœå³ä¸Šè§’æ²¡æœ‰å¤´åƒï¼Œè¯·ç›´æ¥æ‹‰åˆ° App Store é¦–é¡µæœ€ä¸‹é¢ï¼Œç‚¹å‡»ä½ çš„è´¦æˆ·å¹¶é€€å‡ºï¼‰ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://img.i7years.com/blog/5c2b2dda2653a.png" alt=""></p><p>é€€å‡ºç°æœ‰è´¦æˆ·ï¼Œè¾“å…¥æ–°æ³¨å†Œçš„ç¾åŒº Apple ID è´¦æˆ·åŠå¯†ç ï¼Œå¹¶ç‚¹å‡» <code>Sign In</code> ç™»é™†ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://img.i7years.com/blog/5c2b2dd985df9.jpg" alt=""></p><p>å› ä¸ºæ˜¯ç¬¬ä¸€æ¬¡ç™»é™†ï¼Œä¼šæç¤ºä½ è´¦æˆ·ä»æœªä½¿ç”¨è¿‡ï¼Œéœ€è¦è¿›è¡Œæ£€æŸ¥ï¼ˆå…¶å®ä¹Ÿå°±æ˜¯è®©ä½ å¡«å†™ä»˜æ¬¾ä¿¡æ¯å’Œç¡®è®¤å›½å®¶ï¼‰ï¼Œè¯·ç›´æ¥ç‚¹å‡» <code>Review</code> å¹¶è¿›å…¥ä¸‹ä¸€æ­¥ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://img.i7years.com/blog/5c2b2dd97d197.jpg" alt=""></p><p>è¯·ç¡®è®¤ä½ çš„<code>å›½å®¶/åœ°åŒº</code>æ˜¯åœ¨ <code>United States</code> ï¼Œç„¶åç‚¹å‡»ä¸‹ä¸€è¡ŒæŒ‰é’®ä½¿å…¶å˜æˆç»¿è‰²ï¼Œæœ€åç‚¹å‡»å³ä¸Šè§’ <code>Next</code>ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://img.i7years.com/blog/5c2b2dd993e8f.jpg" alt=""></p><p>è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ æ²¡æœ‰å¼€å¯ç¾å›½èŠ‚ç‚¹çš„å…¨å±€æ¨¡å¼ï¼Œåˆ™ä»˜æ¬¾æ–¹å¼ï¼ˆPAYMENT METHODï¼‰è¿™é‡Œä¸ä¼šå‡ºç° <code>None</code> è¿™ä¸ªé€‰é¡¹ï¼Œå¹¶ä¸”åªæœ‰ <code>Credit/Debit Card</code> ä»¥åŠ <code>PayPal</code> è¿™2ä¸ªä»˜æ¬¾æ–¹å¼é€‰é¡¹ã€‚</p><p>å¦‚æœå‘ç°ä»˜æ¬¾æ–¹å¼ä¸­æ²¡æœ‰ <code>None</code> è¿™ä¸ªé€‰é¡¹ï¼Œè¯·ç¡®è®¤ä½ çš„èŠ‚ç‚¹æ˜¯å¦ä¸ºç¾å›½èŠ‚ç‚¹çš„<code>å…¨å±€æ¨¡å¼</code>ï¼Œå¦‚æœæ˜¯ç¾å›½èŠ‚ç‚¹å¹¶ä¸”å¼€å¯äº†å…¨å±€ï¼Œåˆ™è¯´æ˜æ­¤èŠ‚ç‚¹ä¸å¯ç”¨ï¼Œè¯·åˆ‡æ¢èŠ‚ç‚¹ï¼</p><p>ä¸‹é¢çš„åœ°å€åŠç”µè¯å·ç è¯·ç›´æ¥å»è°·æ­Œåœ°å›¾éšä¾¿ç‚¹å‡»ä¸€ä¸ªç¾å›½çš„åœ°ç†ä½ç½®ç„¶åè¾“å…¥ä¿¡æ¯å³å¯ï¼Œæˆ–ç›´æ¥ <a href="https://www.fakeaddressgenerator.com/World/us_address_generator" target="_blank" rel="noopener">è¿™ä¸ªç½‘ç«™</a> ç”Ÿæˆä¸€ä¸ªåœ°å€ï¼ˆå»ºè®®å¡«å†™<code>ç¾å›½å…ç¨å·åœ°å€</code>ï¼Œå¦‚æœæ˜¯ç”¨ç»™å‡ºçš„ç”Ÿæˆåœ°å€ç½‘ç«™å¯ä»¥è‡ªè¡Œç­›é€‰æŒ‡å®šå…ç¨å·ä¿¡æ¯ï¼Œå…·ä½“é—®é¢˜è¯·è°·æ­Œï¼‰ã€‚</p><p>å…¨éƒ¨ä¿¡æ¯å¡«å†™å®Œæˆåï¼Œç‚¹å‡»å³ä¸Šè§’ <code>Next</code> è¿›å…¥ä¸‹ä¸€æ­¥ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://img.i7years.com/blog/5c2b2dd98993e.jpg" alt=""></p><p>è¿™æ—¶è‹¹æœä¼šæç¤ºä½ ï¼Œè´¦æˆ·å¯ç»§ç»­ä½¿ç”¨ï¼Œè‡³æ­¤ï¼Œç¾åŒº Apple ID æ³¨å†Œæ‰å…¨éƒ¨å®Œæˆï¼Œç‚¹å‡» <code>Continue</code> å®Œæˆï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://img.i7years.com/blog/5c2b2e5202881.jpg" alt=""></p><p>ä¹‹åï¼Œå°±å¯ä»¥åœ¨ App Store é‡Œæœç´¢ <code>ç½‘ç»œä»£ç†å·¥å…·App</code>ï¼Œå¦‚ <code>Quantumult</code>ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://img.i7years.com/blog/5c2b2e52a5fb5.png" alt=""></p><h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><h3 id="å¦‚ä½•ä½¿ç”¨ç¾åŒº-Apple-ID-è´­ç‰©"><a href="#å¦‚ä½•ä½¿ç”¨ç¾åŒº-Apple-ID-è´­ç‰©" class="headerlink" title="å¦‚ä½•ä½¿ç”¨ç¾åŒº Apple ID è´­ç‰©"></a>å¦‚ä½•ä½¿ç”¨ç¾åŒº Apple ID è´­ç‰©</h3><p>ç”±äºç¾åŒº Apple ID <code>ä»…æ”¯æŒç»‘å®šç¾å›½å‘å¡è¡Œçš„ä¿¡ç”¨å¡/å€Ÿè®°å¡</code>ï¼Œæ•…åœ¨æ”¯ä»˜æ–¹å¼ä¸Šç›¸å¯¹è¾ƒå›°éš¾ï¼Œä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§„çš„è§£å†³æ–¹å¼ï¼š</p><p>1ã€ç›´æ¥åœ¨ <code>è‹¹æœç¾å›½å®˜ç½‘</code> è´­ä¹° <code>iTunes Gift Card</code> ç¤¼å“å¡ï¼Œå……å€¼åˆ°è´¦æˆ·ä½™é¢ï¼Œæ­¤æ–¹å¼æ”¯æŒå›½å†…å‘å¡è¡Œçš„åŒå¸ç§å¡æˆ–å…¨å¸ç§å¡ï¼Œè‹¥æ”¯ä»˜å¤±è´¥å¯èƒ½æ˜¯å‘å¡è¡Œçš„é—®é¢˜ï¼Œæ¢å¡é‡è¯•ã€‚è°¨æ…åœ¨æ·˜å®è´­ä¹°ä»»ä½• <code>App å…‘æ¢ç </code> æˆ– <code>iTunes Gift Card</code>ï¼Œå¾ˆå¤§éƒ¨åˆ†æ˜¯é»‘å¡ï¼ˆè¢«ç›—åˆ·çš„ä¿¡ç”¨å¡ï¼‰ï¼Œæœ‰å°å·å±é™©ã€‚</p><p>2ã€ç»‘å®šç¾åŒºæ”¯æŒçš„ä¿¡ç”¨å¡æˆ–Paypalï¼Œæœ‰å¦‚ä¸‹å‡ ç§æ–¹å¼æ¨èï¼š</p><ul><li>å¦‚æœåˆšå¥½è¦å»ç¾å›½å½“åœ°æ—…æ¸¸ï¼Œå¯é¡ºä¾¿åŠç†ç¾å›½çš„ä¿¡ç”¨å¡æˆ–å‚¨è“„å¡ï¼Œè¿™ç§æ–¹æ³•æœ€ç¨³å®šã€‚</li><li>ç»‘å®šç¾åŒº PayPalï¼ˆæ–¹ä¾¿ï¼Œä½†æœ‰ä¸€å®šå‡ ç‡è¢«é£æ§å¯¼è‡´ä¸èƒ½æ”¯ä»˜ï¼‰</li><li>è´­ä¹° <code>Visa Gift Card</code>ï¼Œè¿™æ˜¯ Visa çš„å‚¨å€¼å¡ï¼Œç±»ä¼¼äºé¦™æ¸¯æ‹ä½èµè¿™ç§ï¼Œä½™é¢ç”¨å®Œåæ— æ³•å……å€¼ï¼Œåœ¨ç¾å›½å½“åœ°ï¼ˆæˆ–æ·˜å®ï¼‰å¯è´­ä¹°ï¼Œ<a href="https://www.simon.com/giftcard/card_balance.aspx" target="_blank" rel="noopener">Simon Gift Card</a> æ˜¯å…¶ä¸­ä¸€ç§ï¼Œä¹Ÿå¯è‡ªè¡Œé€‰æ‹©å…¶ä»–çš„ï¼Œä½†å»ºè®®æ¯æ¬¡è´­ä¹°æœ€å°é¢é¢ï¼Œé˜²æ­¢æ„å¤–æŸå¤±ã€‚</li><li>åœ¨æŸäº›å›½å†…é“¶è¡Œåšè§è¯å¼€æˆ·ï¼Œå¦‚ç¾å›½å›½æ³°é“¶è¡Œè´¦æˆ·å¯åœ¨æµ™æ±Ÿæ°‘æ³°é“¶è¡Œå¼€æˆ·ï¼ˆè¿™ç§åªæ˜¯ç½‘ä¼ ï¼Œæœ¬äººå¹¶æ²¡æœ‰äº²æµ‹ï¼‰</li></ul><h3 id="é‡ç‚¹æ³¨æ„çš„"><a href="#é‡ç‚¹æ³¨æ„çš„" class="headerlink" title="é‡ç‚¹æ³¨æ„çš„"></a>é‡ç‚¹æ³¨æ„çš„</h3><p>ä½¿ç”¨ç¾åŒº Apple IDï¼Œæœ¬è´¨ä¸Šå…¶å®æ˜¯è¿åè‹¹æœçš„ç”¨æˆ·åè®®çš„è¡Œä¸ºï¼Œæ‰€ä»¥è¯·å°½é‡å‡å°‘è§¦å‘é£æ§çš„ä¸€äº›æ“ä½œï¼š</p><ul><li>IPé¢‘ç¹å˜åŠ¨</li><li>Apple IDåœ¨å¤šå°è®¾å¤‡ç™»å½•ï¼ˆå¯èƒ½è¢«è¯†åˆ«ä¸ºå…±äº«è½¯ä»¶è¡Œä¸ºï¼Œå³ç›—ç‰ˆï¼‰</li><li>æ¶ˆè´¹é¢‘ç¹ä¸”é‡‘é¢è¿‡é«˜ï¼ŒIPæœ‰å¼‚å¸¸</li></ul><p>ç¾¤é‡Œçœ‹åˆ°éƒ¨åˆ†äººæœ€è¿‘ç»‘å®šæˆ–é€šè¿‡ç¾åŒº PayPal æ”¯ä»˜æ—¶é‡åˆ°â€œå¾ˆæŠ±æ­‰ï¼Œæ— æ³•è®¾ç½®æ‚¨å¯¹ iTunes and App Store çš„é¢„æ ¸å‡†ä»˜æ¬¾â€çš„æç¤ºï¼Œå»ºè®®å…ˆå°†æ”¯ä»˜æ–¹å¼ä¿®æ”¹ä¸º <code>None</code>ï¼Œç„¶åå°† Apple ID å’Œç¾åŒº Paypal çš„ä»˜æ¬¾åœ°å€ä¿®æ”¹ä¸ºç›¸åŒçš„å…ç¨å·åœ°å€ï¼Œæ¥ç€å†æ¬¡å°è¯•ç»‘å®šï¼Œè‹¥ä¾ç„¶æœ‰é—®é¢˜ï¼Œå¤§æ¦‚ç‡æ˜¯è§¦å‘äº†è‹¹æœçš„é£æ§ï¼Œå¦‚æœè‹±æ–‡è¶³å¤Ÿå¥½ï¼Œå¯ç›´æ¥è‡´ç”µç¾åŒºè‹¹æœå®¢æœè¦æ±‚å¸®ä½ å¤„ç†ï¼›è‹¥è‹±æ–‡ä¸å¤Ÿå¥½ï¼Œå»ºè®®ç­‰å¾…ä¸¤ä¸‰å¤©åå°è¯•æ˜¯å¦å¯ä»¥ä½¿ç”¨ï¼›è‹¥è¿˜ä¸è¡Œï¼Œå»ºè®®æ¢ç”¨å…¶å®ƒæ”¯ä»˜æ–¹å¼ã€‚</p><h2 id="å†™åœ¨æœ€å"><a href="#å†™åœ¨æœ€å" class="headerlink" title="å†™åœ¨æœ€å"></a>å†™åœ¨æœ€å</h2><p>æ–°æ‰‹æŒ‰ç…§ä¸Šè¿°æ•™ç¨‹å¯100%å®Œæˆæ‰€æœ‰åœ°åŒºè´¦æˆ·çš„Apple IDæ³¨å†Œã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒApp Store æ˜¯æ ¹æ®ç™»é™†è´¦æˆ·çš„åœ°åŒºæ¥è‡ªåŠ¨é€‚é…è¯­è¨€çš„ã€‚å“ªæ€•ä½ æ‰‹æœºç³»ç»Ÿæ˜¯ä¸­æ–‡ï¼Œä½†å¦‚æœæ˜¯ç¾åŒºè´¦æˆ·ï¼Œåˆ™ App Store å°±æ˜¯è‹±æ–‡ï¼ˆæˆ‘äº†è§£è¿‡æ¥æ˜¯è¿™æ ·ï¼‰ï¼Œå…·ä½“å¯ä»¥è‡ªå·±æ‘¸ç´¢ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://sspai.com/post/25837" target="_blank" rel="noopener">https://sspai.com/post/25837</a></li></ul>]]></content>
      
        <categories>
            
            <category> tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> freedom </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æ•°æ®ç»“æ„ä¸ç®—æ³• | é˜Ÿåˆ—çš„å®ç°åŠå…¶åº”ç”¨]]></title>
      <url>/posts/java-data-structures-and-algorithms-queue.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p align="center"><br><a target="_blank" href="https://wangwei.one/posts/java-data-structures-and-algorithms-queue.html"><img src="https://img.i7years.com/blog/DyeTYiAXcAEYLIk.jpg?imageslim" title="Farming" alt="Farming"></a><br></p><br>å‰é¢ï¼Œæˆ‘ä»¬å­¦ä¹ äº† <a href="https://wangwei.one/posts/java-data-structures-and-algorithms-stack.html">æ ˆçš„å®ç°åŠåº”ç”¨</a> ï¼Œæœ¬ç¯‡æˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹æœ€åä¸€ç§çº¿æ€§è¡¨â€”â€”é˜Ÿåˆ—ã€‚<br><br><a id="more"></a><br><br>é˜Ÿåˆ—æ˜¯æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ç»å¸¸ä¼šç”¨åˆ°çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨é˜Ÿåˆ—è¿›è¡Œå¼‚æ­¥å¤„ç†ã€ç³»ç»Ÿè§£è€¦ã€æ•°æ®åŒæ­¥ã€æµé‡å‰Šå³°ã€ç¼“å†²ã€é™æµç­‰ã€‚ä¾‹å¦‚ï¼Œä¸æ˜¯æ‰€æœ‰çš„ä¸šåŠ¡éƒ½å¿…é¡»å®æ—¶å¤„ç†ã€ä¸æ˜¯æ‰€æœ‰çš„è¯·æ±‚éƒ½å¿…é¡»å®æ—¶åé¦ˆç»“æœç»™ç”¨æˆ·ã€ä¸æ˜¯æ‰€æœ‰çš„è¯·æ±‚éƒ½å¿…é¡»100%å¤„ç†æˆåŠŸã€ä¸çŸ¥é“è°ä¾èµ–â€œæˆ‘â€çš„å¤„ç†ç»“æœã€ä¸å…³å¿ƒå…¶ä»–ç³»ç»Ÿå¦‚ä½•å¤„ç†åç»­ä¸šåŠ¡ã€ä¸éœ€è¦å¼ºä¸€è‡´æ€§ï¼Œåªéœ€ä¿è¯æœ€ç»ˆä¸€è‡´æ€§å³å¯ã€æƒ³è¦ä¿è¯æ•°æ®å¤„ç†çš„æœ‰åºæ€§ç­‰ç­‰ï¼Œè¿™äº›é—®é¢˜éƒ½è€ƒè™‘ä½¿ç”¨é˜Ÿåˆ—æ¥è§£å†³ã€‚<br><br>## é˜Ÿåˆ—<br><br>### å®šä¹‰<br><br>é˜Ÿåˆ—ä¸ <a href="https://wangwei.one/posts/java-data-structures-and-algorithms-stack.html">æ ˆ</a> ä¸€æ ·ï¼Œéƒ½æ˜¯æ“ä½œå—é™çš„çº¿æ€§è¡¨æ•°æ®ç»“æ„ã€‚é˜Ÿåˆ—ä»ä¸€ç«¯æ’å…¥æ•°æ®ï¼Œç„¶åä»å¦ä¸€ç«¯å–å‡ºæ•°æ®ã€‚æ’å…¥æ•°æ®çš„ä¸€ç«¯ç§°ä¸ºâ€<strong>é˜Ÿå°¾</strong>â€œï¼Œå–å‡ºæ•°æ®çš„ä¸€ç«¯ç§°ä¸ºâ€<strong>é˜Ÿå¤´</strong>â€œï¼Œå¦‚å›¾æ‰€ç¤ºï¼š<br><br><p align="center"><br><a target="_blank" href="https://wangwei.one/posts/java-data-structures-and-algorithms-queue.html"><img src="https://img.i7years.com/blog/queue.wangwei.one.gif" title="queue" alt="queue"></a><br></p><h3 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ul><li>FIFOï¼ˆFirst In First Outï¼‰ï¼šå…ˆè¿›å…ˆå‡ºåŸåˆ™</li></ul><h3 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h3><p>ä¸ <a href="https://wangwei.one/posts/java-data-structures-and-algorithms-stack.html">æ ˆ</a> ä¸€æ ·ï¼Œé˜Ÿåˆ—ä¹Ÿåˆ†ä¸º<strong>é¡ºåºé˜Ÿåˆ—</strong>ä¸<strong>é“¾å¼é˜Ÿåˆ—</strong>ï¼Œåˆ†åˆ«ä½¿ç”¨æ•°ç»„ä¸é“¾è¡¨æ¥å®ç°ã€‚</p><h2 id="é“¾å¼é˜Ÿåˆ—"><a href="#é“¾å¼é˜Ÿåˆ—" class="headerlink" title="é“¾å¼é˜Ÿåˆ—"></a>é“¾å¼é˜Ÿåˆ—</h2><p>é“¾å¼é˜Ÿåˆ—å®ç°æ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨å•é“¾è¡¨å³å¯å®ç°ï¼Œå¦‚æœæ‰€ç¤ºï¼š</p><p align="center"><br><a target="_blank" href="https://wangwei.one/posts/java-data-structures-and-algorithms-queue.html"><img src="https://img.i7years.com/blog/LinkedQueue.wangwei.one.png" title="LinkedQueue" alt="LinkedQueue"></a><br></p><br>### ä»£ç å®ç°<br><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.algorithms.datastructures.queue.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> one.wangwei.algorithms.datastructures.queue.IQueue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.NoSuchElementException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é“¾è¡¨é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> https://wangwei.one</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/03/27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedQueue</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">IQueue</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> Node&lt;T&gt; head;</span><br><span class="line">    <span class="keyword">private</span> Node&lt;T&gt; tail;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ å…ƒç´ åˆ°é˜Ÿåˆ—å¤´éƒ¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">offer</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">        Node&lt;T&gt; last = tail;</span><br><span class="line">        Node&lt;T&gt; newNode = <span class="keyword">new</span> Node&lt;&gt;(value, <span class="keyword">null</span>);</span><br><span class="line">        tail = newNode;</span><br><span class="line">        <span class="keyword">if</span> (last == <span class="keyword">null</span>) &#123;</span><br><span class="line">            head = newNode;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            last.next = newNode;</span><br><span class="line">        &#125;</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç§»é™¤é˜Ÿåˆ—å°¾éƒ¨å…ƒç´ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">poll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException(<span class="string">"Queue underflow"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Node&lt;T&gt; tmpHead = head;</span><br><span class="line">        head = head.next;</span><br><span class="line">        tmpHead.next = <span class="keyword">null</span>;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="keyword">null</span>) &#123;</span><br><span class="line">            tail = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> tmpHead.element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥çœ‹é˜Ÿåˆ—å°¾éƒ¨å…ƒç´ å€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">peek</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException(<span class="string">"Queue underflow"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> head.element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¸…é™¤é˜Ÿåˆ—å…ƒç´ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Node&lt;T&gt; x = head; x != <span class="keyword">null</span>; ) &#123;</span><br><span class="line">            Node&lt;T&gt; next = x.next;</span><br><span class="line">            x.element = <span class="keyword">null</span>;</span><br><span class="line">            x.next = <span class="keyword">null</span>;</span><br><span class="line">            x = next;</span><br><span class="line">        &#125;</span><br><span class="line">        head = tail = <span class="keyword">null</span>;</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é˜Ÿåˆ—å¤§å°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Node</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> T element;</span><br><span class="line">        <span class="keyword">private</span> Node&lt;T&gt; next;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">Node</span><span class="params">(T element)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.element = element;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">Node</span><span class="params">(T element, Node&lt;T&gt; next)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.element = element;</span><br><span class="line">            <span class="keyword">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br>&gt; <a href="https://github.com/wangweiX/java-algorithms/blob/master/src/main/java/one/wangwei/algorithms/datastructures/queue/impl/LinkedQueue.java" target="_blank" rel="noopener">æºç </a><br><br>åŸºäºé“¾è¡¨çš„å®ç°æ–¹å¼ï¼Œå¯ä»¥å®ç°ä¸€ä¸ªæ”¯æŒæ— é™æ’é˜Ÿçš„æ— ç•Œé˜Ÿåˆ—ï¼ˆunbounded queueï¼‰ï¼Œä½†æ˜¯å¯èƒ½ä¼šå¯¼è‡´è¿‡å¤šçš„è¯·æ±‚æ’é˜Ÿç­‰å¾…ï¼Œè¯·æ±‚å¤„ç†çš„å“åº”æ—¶é—´è¿‡é•¿ã€‚æ‰€ä»¥ï¼Œé’ˆå¯¹å“åº”æ—¶é—´æ¯”è¾ƒæ•æ„Ÿçš„ç³»ç»Ÿï¼ŒåŸºäºé“¾è¡¨å®ç°çš„æ— é™æ’é˜Ÿçš„çº¿ç¨‹æ± æ˜¯ä¸åˆé€‚çš„ã€‚<br><br><br><br>## é¡ºåºé˜Ÿåˆ—<br><br>é¡ºåºé˜Ÿåˆ—é‡‡ç”¨æ•°ç»„å®ç°ï¼Œæ•°ç»„çš„å®ç°æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯é¡ºåºå¼çš„ï¼Œä¸€ç§æ˜¯å¾ªç¯æ•°ç»„å®ç°ã€‚<br><br>### é¡ºåºé˜Ÿåˆ—<br><br>å½“é˜Ÿåˆ—å°¾éƒ¨æ²¡æœ‰å‰©ä½™ç©ºé—´åï¼Œéœ€è¦é›†ä¸­è¿›è¡Œä¸€æ¬¡æ•°æ®æ¬è¿è…¾å‡ºç©ºé—´ï¼Œæ‰èƒ½ç»§ç»­è¿›è¡Œå…¥é˜Ÿæ“ä½œã€‚å¦‚å›¾æ‰€ç¤ºï¼š<br><br><p align="center"><br><a target="_blank" href="https://wangwei.one/posts/java-data-structures-and-algorithms-queue.html"><img src="https://img.i7years.com/blog/ArrayQueue.wangwei.one.jpg" title="ArrayQueue" alt="ArrayQueue"></a><br></p><br>### å¾ªç¯é˜Ÿåˆ—<br><br>é¡ºåºé˜Ÿåˆ—ä¼šå­˜åœ¨æ•°æ®æ¬è¿çš„é—®é¢˜ï¼Œå¯¹å…¥é˜Ÿæ“ä½œæœ‰æ€§èƒ½æ–¹é¢çš„å½±å“ã€‚æˆ‘ä»¬å¯ä»¥é‡‡ç”¨å¾ªç¯æ•°ç»„çš„æ–¹å¼æ¥è§£å†³è¿™ä¸€é—®é¢˜ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š<br><br><p align="center"><br><a target="_blank" href="https://wangwei.one/posts/java-data-structures-and-algorithms-queue.html"><img src="https://img.i7years.com/blog/CircularQueue.wangwei.one.gif" title="ArrayQueue" alt="ArrayQueue"></a><br></p><p>å½“é˜Ÿå°¾æ— å­˜å‚¨ç©ºé—´ä¸”é˜Ÿåˆ—æœªæ»¡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶å­˜å‚¨åˆ°æ•°ç»„çš„å‰åŠéƒ¨åˆ†å‰©ä½™çš„ç©ºé—´å»ã€‚</p><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><p>å¾ªç¯é˜Ÿåˆ—çš„å®ç°å…³é”®åœ¨äºé˜Ÿåˆ—ä¸ºç©ºå’Œä¸ºæ»¡æ—¶çš„çŠ¶æ€åˆ¤æ–­ï¼š</p><ul><li>å½“é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼š<code>rear == front</code></li><li>å½“é˜Ÿåˆ—ä¸ºæ»¡æ—¶ï¼š<code>front == (rear + 1) % array.length</code>ï¼Œé˜Ÿæ»¡æ—¶ï¼Œä¼šæµªè´¹ä¸€ä¸ªæ•°ç»„çš„å­˜å‚¨ç©ºé—´ã€‚</li></ul><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.algorithms.datastructures.queue.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> one.wangwei.algorithms.datastructures.queue.IQueue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.NoSuchElementException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ•°ç»„é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> https://wangwei.one</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/02/04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayQueue</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">IQueue</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * default array size</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_SIZE = <span class="number">1024</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…ƒç´ æ•°ç»„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> T[] array;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é˜Ÿå¤´æŒ‡é’ˆä¸‹æ ‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> front = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é˜Ÿå°¾æŒ‡é’ˆä¸‹æ ‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> rear = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ArrayQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(DEFAULT_SIZE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ArrayQueue</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">        array = (T[]) <span class="keyword">new</span> Object[capacity];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ é˜Ÿå°¾å…ƒç´ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">offer</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">            grow();</span><br><span class="line">        &#125;</span><br><span class="line">        array[rear % array.length] = value;</span><br><span class="line">        rear++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * grow queue size doubly</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">grow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> growSize = array.length &lt;&lt; <span class="number">1</span>;</span><br><span class="line">        T[] tmpArray = (T[]) <span class="keyword">new</span> Object[growSize];</span><br><span class="line">        <span class="keyword">int</span> adjRear = rear % array.length;</span><br><span class="line">        <span class="keyword">int</span> endIndex = rear &gt; array.length ? array.length : rear;</span><br><span class="line">        <span class="keyword">if</span> (adjRear &lt; front) &#123;</span><br><span class="line">            System.arraycopy(array, <span class="number">0</span>, tmpArray, array.length - adjRear, adjRear + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.arraycopy(array, front, tmpArray, <span class="number">0</span>, endIndex - front);</span><br><span class="line">        array = tmpArray;</span><br><span class="line">        rear = (rear - front);</span><br><span class="line">        front = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç§»é™¤é˜Ÿå¤´å…ƒç´ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">poll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException(<span class="string">"Queue underflow"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        T element = array[front % array.length];</span><br><span class="line">        array[front % array.length] = <span class="keyword">null</span>;</span><br><span class="line">        front++;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="comment">// remove last element</span></span><br><span class="line">            front = rear = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> shrinkSize = array.length &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (shrinkSize &gt;= DEFAULT_SIZE &amp;&amp; size() &lt; shrinkSize) &#123;</span><br><span class="line">            shrink();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‹ç¼©</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">shrink</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> shrinkSize = array.length &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        T[] tmpArray = (T[]) <span class="keyword">new</span> Object[shrinkSize];</span><br><span class="line">        <span class="keyword">int</span> adjRear = rear % array.length;</span><br><span class="line">        <span class="keyword">int</span> endIndex = rear &gt; array.length ? array.length : rear;</span><br><span class="line">        <span class="keyword">if</span> (adjRear &lt;= front) &#123;</span><br><span class="line">            System.arraycopy(array, <span class="number">0</span>, tmpArray, array.length - front, adjRear);</span><br><span class="line">        &#125;</span><br><span class="line">        System.arraycopy(array, front, tmpArray, <span class="number">0</span>, endIndex - front);</span><br><span class="line">        array = <span class="keyword">null</span>;</span><br><span class="line">        array = tmpArray;</span><br><span class="line">        rear = rear - front;</span><br><span class="line">        front = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥çœ‹é˜Ÿå¤´å…ƒç´ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">peek</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException(<span class="string">"Queue underflow"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> array[front % array.length];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¸…é™¤é˜Ÿåˆ—å…ƒç´ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        array = <span class="keyword">null</span>;</span><br><span class="line">        front = rear = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é˜Ÿåˆ—å¤§å°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> rear - front;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦æ»¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isFull</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> !isEmpty() &amp;&amp; (front == (rear + <span class="number">1</span>) % array.length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­é˜Ÿæ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size() &lt;= <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/wangweiX/java-algorithms/blob/master/src/main/java/one/wangwei/algorithms/datastructures/queue/impl/ArrayQueue.java" target="_blank" rel="noopener">æºç </a></p></blockquote><p>åŸºäºæ•°ç»„å®ç°çš„æœ‰ç•Œé˜Ÿåˆ—ï¼ˆbounded queueï¼‰ï¼Œé˜Ÿåˆ—çš„å¤§å°æœ‰é™ï¼Œå½“è¯·æ±‚æ•°é‡è¶…è¿‡é˜Ÿåˆ—å¤§å°æ—¶ï¼Œæ¥ä¸‹æ¥çš„è¯·æ±‚å°±ä¼šè¢«æ‹’ç»ï¼Œè¿™ç§æ–¹å¼å¯¹å“åº”æ—¶é—´æ•æ„Ÿçš„ç³»ç»Ÿæ¥è¯´ï¼Œå°±ç›¸å¯¹æ›´åŠ åˆç†ã€‚ä¸è¿‡ï¼Œè®¾ç½®ä¸€ä¸ªåˆç†çš„é˜Ÿåˆ—å¤§å°ï¼Œä¹Ÿæ˜¯éå¸¸æœ‰è®²ç©¶çš„ã€‚é˜Ÿåˆ—å¤ªå¤§å¯¼è‡´ç­‰å¾…çš„è¯·æ±‚å¤ªå¤šï¼Œé˜Ÿåˆ—å¤ªå°ä¼šå¯¼è‡´æ— æ³•å……åˆ†åˆ©ç”¨ç³»ç»Ÿèµ„æºã€å‘æŒ¥æœ€å¤§æ€§èƒ½ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li>ã€Š<a href="http://gk.link/a/101Nt" target="_blank" rel="noopener">æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾</a>ã€‹</li><li><a href="https://time.geekbang.org/column/article/41330" target="_blank" rel="noopener">https://time.geekbang.org/column/article/41330</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> AlgoDS </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æ•°æ®ç»“æ„ä¸ç®—æ³• | å›æ–‡é“¾è¡¨æ£€æµ‹]]></title>
      <url>/posts/java-algoDS-palindrome-linked-list.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/pexels-photo-747964.jpeg?imageslim" alt="pexels-photo-747964"></p><p>å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå•é“¾è¡¨æ˜¯å¦ä¸ºå›æ–‡é“¾è¡¨ï¼Ÿ</p><a id="more"></a><h2 id="å›æ–‡é“¾è¡¨"><a href="#å›æ–‡é“¾è¡¨" class="headerlink" title="å›æ–‡é“¾è¡¨"></a>å›æ–‡é“¾è¡¨</h2><blockquote><p><a href="https://leetcode.com/problems/palindrome-linked-list/" target="_blank" rel="noopener">LeetCode 234. Palindrome Linked List</a></p></blockquote><p><strong>ä¾‹1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 1-&gt;2</span><br><span class="line">Output: false</span><br></pre></td></tr></table></figure><p><strong>ä¾‹2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 1-&gt;2-&gt;2-&gt;1</span><br><span class="line">Output: true</span><br></pre></td></tr></table></figure><p><strong>æå‡ï¼š</strong><br>æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œç©ºé—´å¤æ‚åº¦ä¸ºO(1).</p><h3 id="è§£æ³•ä¸€"><a href="#è§£æ³•ä¸€" class="headerlink" title="è§£æ³•ä¸€"></a>è§£æ³•ä¸€</h3><p>ç›´æ¥å°†é“¾è¡¨è¿›è¡Œ <a href="https://wangwei.one/posts/java-algoDS-reverse-linked-list.html">åè½¬</a> ï¼Œç„¶åå°†æ–°çš„åè½¬é“¾è¡¨ä¸åŸé“¾è¡¨è¿›è¡Œæ¯”è¾ƒï¼Œè¿™ç§æ€è·¯æœ€ä¸ºç®€å•ç²—æš´ã€‚</p><p>æ­¤ç§è§£æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œç©ºé—´å¤æ‚åº¦ä¸ºO(n).</p><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * public class ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) &#123; val = x; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPalindrome</span><span class="params">(ListNode head)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(head == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ListNode newCurr = <span class="keyword">null</span>;</span><br><span class="line">        ListNode newPrev = <span class="keyword">null</span>;</span><br><span class="line">        ListNode curr = head;</span><br><span class="line">        <span class="keyword">while</span>(curr != <span class="keyword">null</span>)&#123;</span><br><span class="line">            newCurr = <span class="keyword">new</span> ListNode(curr.val);</span><br><span class="line">            newCurr.next = newPrev;</span><br><span class="line">            newPrev = newCurr;</span><br><span class="line">            curr = curr.next;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        ListNode p1 = newCurr;</span><br><span class="line">        ListNode p2 = head;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(p2 != <span class="keyword">null</span> &amp;&amp; p2 != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(p2.val != p1.val)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            p1 = p1.next;</span><br><span class="line">            p2 = p2.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>LeetCodeæ€§èƒ½æµ‹è¯•ï¼š</p><blockquote><p>Runtime: 3 ms, faster than 24.01% of Java online submissions forPalindrome Linked List.</p></blockquote><h3 id="è§£æ³•äºŒ"><a href="#è§£æ³•äºŒ" class="headerlink" title="è§£æ³•äºŒ"></a>è§£æ³•äºŒ</h3><p>ä¸ºäº†é™ä½ç©ºé—´å¤æ‚åº¦åˆ°O(1)ï¼Œæˆ‘ä»¬å¯ä»¥åªå¯¹é“¾è¡¨çš„ååŠéƒ¨åˆ†ç›´æ¥åè½¬ï¼Œç„¶åå°†åè½¬åçš„ååŠéƒ¨åˆ†ä¸å‰åŠéƒ¨åˆ†è¿›è¡Œæ¯”è¾ƒã€‚</p><p>å¦‚ä½•å¯¹ååŠéƒ¨åˆ†è¿›è¡Œåè½¬å‘¢ï¼Ÿè¿™å°±æ¶‰åŠåˆ°æˆ‘ä»¬å‰é¢çš„ <a href="https://wangwei.one/posts/java-algoDS-middle-of-the-linked-list.html">å¦‚ä½•æ‰¾åˆ°ä¸­é—´èŠ‚ç‚¹</a> çš„æ–¹æ³•ï¼Œä½¿ç”¨å¿«æ…¢æŒ‡é’ˆï¼Œå…ˆæ‰¾åˆ°ä¸­é—´èŠ‚ç‚¹ï¼Œç„¶åä»ä¸­é—´èŠ‚ç‚¹å¼€å§‹åè½¬ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œè¦ä»¥ååŠéƒ¨åˆ†ä¸ºåŸºå‡†è¿›è¡Œéå†æ¥æ¯”è¾ƒï¼Œä¾‹å¦‚åœ¨é“¾è¡¨é•¿åº¦ä½å¶æ•°çš„æƒ…å†µä¸‹ï¼š</p><p><code>A -&gt; B -&gt; C -&gt; C -&gt; B -&gt; A</code> åè½¬å¾—åˆ° <code>A -&gt; B -&gt; C -&gt; C &lt;- B &lt;- A</code>ï¼Œä»¥å‰åŠéƒ¨åˆ†ä¸ºåŸºå‡†çš„è¯ï¼Œä¼šå‡ºç° null æŒ‡é’ˆçš„å¼‚å¸¸ã€‚</p><p>æ­¤ç§è§£æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œç©ºé—´å¤æ‚åº¦ä¸ºO(1).</p><h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * public class ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) &#123; val = x; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPalindrome</span><span class="params">(ListNode head)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(head == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å…ˆæ‰¾åˆ°ä¸­é—´èŠ‚ç‚¹ï¼Œslowæœ€åçš„ç»“æœå°±æ˜¯ä¸­é—´èŠ‚ç‚¹</span></span><br><span class="line">        ListNode slow = head;</span><br><span class="line">        ListNode fast = head;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(ListNode curr = slow; slow != <span class="keyword">null</span>; )&#123;               </span><br><span class="line">            <span class="keyword">if</span>(fast == <span class="keyword">null</span> || fast.next == <span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                fast = fast.next.next;</span><br><span class="line">            &#125;</span><br><span class="line">            slow = slow.next;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä»slowå¼€å§‹ï¼Œå¯¹åé“¾è¡¨ååŠéƒ¨åˆ†è¿›è¡Œåè½¬</span></span><br><span class="line">        ListNode prev = <span class="keyword">null</span>;</span><br><span class="line">        ListNode curr = slow;</span><br><span class="line">        ListNode next = <span class="keyword">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(curr != <span class="keyword">null</span>)&#123;</span><br><span class="line">            next = curr.next;</span><br><span class="line">            curr.next = prev;</span><br><span class="line">            prev = curr;</span><br><span class="line">            curr = next;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¯¹å‰åä¸¤ä¸ªéƒ¨åˆ†è¿›è¡Œæ¯”è¾ƒ</span></span><br><span class="line">        ListNode p1 = head;</span><br><span class="line">        ListNode p2 = prev;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(p2 != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(p1.val != p2.val)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            p1 = p1.next;</span><br><span class="line">            p2 = p2.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>LeetCodeæ€§èƒ½æµ‹è¯•ï¼š</p><blockquote><p>Runtime: 1 ms, faster than 93.05% of Java online submissions forPalindrome Linked List.</p></blockquote><h3 id="è§£æ³•ä¸‰"><a href="#è§£æ³•ä¸‰" class="headerlink" title="è§£æ³•ä¸‰"></a>è§£æ³•ä¸‰</h3><p>è§£æ³•ä¸‰æ¯”è¾ƒå·§å¦™ï¼Œä¸å®¹æ˜“æƒ³åˆ°ã€‚æ€è·¯å¦‚ä¸‹ï¼š</p><ul><li>å®šä¹‰å·¦å³ä¸¤ä¸ªæŒ‡é’ˆï¼Œå·¦æŒ‡é’ˆå‘å³ç§»åŠ¨ï¼Œâ€å³æŒ‡é’ˆå‘å·¦ç§»åŠ¨â€ï¼Œå¯¹æ¯”å·¦å³ä¸¤ä¸ªæŒ‡é’ˆæ˜¯å¦é…ç½®ã€‚</li><li>æˆ‘ä»¬è¿™é‡Œæ˜¯å•é“¾è¡¨ï¼Œå³æŒ‡é’ˆæ€ä¹ˆå‘å·¦ç§»åŠ¨å‘¢ï¼Ÿè¿™é‡Œé€šè¿‡é€’å½’çš„æ–¹å¼ï¼Œå½“é€’å½’å‡½æ•°ä¸€å±‚ä¸€å±‚è¿”å›æ—¶ï¼Œå˜ç›¸åœ°å®ç°äº†â€å³æŒ‡é’ˆå·¦ç§»â€çš„æ€è·¯ã€‚</li></ul><h4 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * public class ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) &#123; val = x; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> ListNode head;</span><br><span class="line">    <span class="keyword">private</span> ListNode left;</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPalindrome</span><span class="params">(ListNode head1)</span> </span>&#123;</span><br><span class="line">        head = head1;</span><br><span class="line">        <span class="keyword">return</span> isPalindromeUtil(head1);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isPalindromeUtil</span><span class="params">(ListNode right)</span></span>&#123; </span><br><span class="line">        left = head; </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å½“æŒ‡å‘NULLæ—¶ï¼Œåœæ­¢é€’å½’</span></span><br><span class="line">        <span class="keyword">if</span> (right == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>; </span><br><span class="line">        &#125; </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// å‘å³ç§»åŠ¨æŒ‡é’ˆï¼Œé€’å½’è°ƒç”¨</span></span><br><span class="line">        <span class="keyword">boolean</span> isp = isPalindromeUtil(right.next); </span><br><span class="line">        <span class="keyword">if</span> (isp == <span class="keyword">false</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>; </span><br><span class="line">        &#125; </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// æ¯”è¾ƒå·¦å³æŒ‡é’ˆæ˜¯å¦åŒ¹é…</span></span><br><span class="line">        <span class="keyword">boolean</span> isp1 = (right.val == left.val); </span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç§»åŠ¨å·¦æŒ‡é’ˆ</span></span><br><span class="line">        left = left.next; </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">return</span> isp1; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>LeetCodeæ€§èƒ½æµ‹è¯•ï¼š</p><blockquote><p>Runtime: 3 ms, faster than 22.70% of Java online submissions forPalindrome Linked List.</p></blockquote><h2 id="ç›¸å…³ç»ƒä¹ "><a href="#ç›¸å…³ç»ƒä¹ " class="headerlink" title="ç›¸å…³ç»ƒä¹ "></a>ç›¸å…³ç»ƒä¹ </h2><ul><li><a href="https://wangwei.one/posts/java-algoDS-reverse-linked-list.html">é“¾è¡¨åè½¬</a></li><li><a href="https://wangwei.one/posts/java-algoDS-linked-list-cycle.html">é“¾è¡¨ç¯æ£€æµ‹</a></li><li><a href="https://wangwei.one/posts/java-algoDS-Merge-Two-Sorted-Linked-Lists.html">æœ‰åºé“¾è¡¨åˆå¹¶</a></li><li><a href="https://wangwei.one/posts/java-algoDS-Remove-Nth-Node-From-End-of-List.html">åˆ é™¤å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹</a></li><li><a href="https://wangwei.one/posts/java-algoDS-middle-of-the-linked-list.html">æ±‚é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹</a></li><li><a href="https://wangwei.one/posts/java-algoDS-LRU-implement-by-linkedlist.html">LRUç®—æ³•å®ç°</a></li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li>ã€Š<a href="http://gk.link/a/101Nt" target="_blank" rel="noopener">æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾</a>ã€‹</li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> AlgoDS </tag>
            
            <tag> LeetCode </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æ•°æ®ç»“æ„ä¸ç®—æ³• | å¦‚ä½•å®ç°LRUç¼“å­˜æ·˜æ±°ç®—æ³•]]></title>
      <url>/posts/java-algoDS-LRU-implement-by-linkedlist.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/picography-bicycle-road-bike-old-vintage-retro-1.jpg?imageslim" alt=""></p><p>å‰é¢ï¼Œæˆ‘ä»¬å­¦ä¹ äº† <a href="https://wangwei.one/posts/java-data-structures-and-algorithms-linkedlist.html">é“¾è¡¨</a> çš„å®ç°ï¼Œä»Šå¤©æˆ‘ä»¬æ¥å­¦ä¹ é“¾è¡¨çš„ä¸€ä¸ªç»å…¸çš„åº”ç”¨åœºæ™¯â€”â€”LRUæ·˜æ±°ç®—æ³•ã€‚</p><a id="more"></a><p>ç¼“å­˜æ˜¯ä¸€ç§æé«˜æ•°æ®è¯»å–æ€§èƒ½çš„æŠ€æœ¯ï¼Œåœ¨ç¡¬ä»¶è®¾è®¡ã€è½¯ä»¶å¼€å‘ä¸­éƒ½æœ‰ç€éå¸¸å¹¿æ³›çš„åº”ç”¨ï¼Œæ¯”å¦‚å¸¸è§çš„ CPU ç¼“å­˜ã€æ•°æ®åº“ç¼“å­˜ã€æµè§ˆå™¨ç¼“å­˜ç­‰ç­‰ã€‚</p><p>ç¼“å­˜çš„å¤§å°æœ‰é™ï¼Œå½“ç¼“å­˜è¢«ç”¨æ»¡æ—¶ï¼Œå“ªäº›æ•°æ®åº”è¯¥è¢«æ¸…ç†å‡ºå»ï¼Œå“ªäº›æ•°æ®åº”è¯¥è¢«ä¿ç•™ï¼Ÿè¿™å°±éœ€è¦ç¼“å­˜æ·˜æ±°ç­–ç•¥æ¥å†³å®šã€‚å¸¸è§çš„ç­–ç•¥æœ‰ä¸‰ç§ï¼šå…ˆè¿›å…ˆå‡ºç­–ç•¥ <code>FIFOï¼ˆFirst Inï¼ŒFirst Outï¼‰</code>ã€æœ€å°‘ä½¿ç”¨ç­–ç•¥ <code>LFUï¼ˆLeast Frequently Usedï¼‰</code>ã€æœ€è¿‘æœ€å°‘ä½¿ç”¨ç­–ç•¥ <code>LRUï¼ˆLeast Recently Usedï¼‰</code>ï¼Œæœ¬ç¯‡å°†ä»‹ç»LRUç­–ç•¥ç®—æ³•ã€‚</p><h2 id="LRU-Cache"><a href="#LRU-Cache" class="headerlink" title="LRU Cache"></a>LRU Cache</h2><p>è¿™ä¸€ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œå½“ç¼“å­˜æ•°æ®è¾¾åˆ°é¢„è®¾çš„ä¸Šé™åï¼Œä¼šä¼˜å…ˆæ·˜æ±°æ‰è¿‘æœŸæœ€å°‘ä½¿ç”¨çš„ç¼“å­˜å¯¹è±¡ã€‚</p><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>LRUæ·˜æ±°ç®—æ³•æ¶‰åŠæ•°æ®çš„æ·»åŠ ä¸åˆ é™¤ï¼Œå‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œé‡‡ç”¨é“¾è¡¨æ¥è¿›è¡Œå®ç°ï¼Œæ€è·¯å¦‚ä¸‹ï¼š</p><ul><li>ç»´æŠ¤ä¸€ä¸ªåŒå‘é“¾è¡¨ç”¨äºå­˜æ”¾ç¼“å­˜æ•°æ®ï¼Œè¶Šæ¥è¿‘é“¾è¡¨å°¾éƒ¨çš„æ•°æ®è¡¨ç¤ºè¶Šå°‘è¢«ä½¿ç”¨åˆ°ã€‚</li><li>æ”¾å…¥ä¸€ä¸ªæ•°æ®æ—¶ï¼Œå¦‚æœæ•°æ®å·²å­˜åœ¨åˆ™å°†å…¶ç§»åŠ¨åˆ°é“¾è¡¨å¤´éƒ¨ï¼Œå¹¶æ›´æ–°Keyæ‰€å¯¹åº”çš„Valueå€¼ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ï¼š<ul><li>å¦‚æœç¼“å­˜å®¹é‡å·²è¾¾åˆ°æœ€å¤§å€¼ï¼Œåˆ™å°†é“¾è¡¨å°¾éƒ¨èŠ‚ç‚¹åˆ é™¤æ‰ï¼Œå°†æ–°çš„æ•°æ®æ”¾å…¥é“¾è¡¨å¤´éƒ¨ï¼›</li><li>å¦‚æœç¼“å­˜å®¹é‡æœªè¾¾åˆ°æœ€å¤§å€¼ï¼Œåˆ™ç›´æ¥å°†æ–°çš„æ•°æ®æ”¾å…¥é“¾è¡¨å¤´éƒ¨ï¼›</li></ul></li><li>æŸ¥è¯¢ä¸€ä¸ªæ•°æ®æ—¶ï¼Œéå†æ•´ä¸ªé“¾è¡¨ï¼Œå¦‚æœèƒ½æŸ¥è¯¢åˆ°å¯¹åº”çš„æ•°æ®ï¼Œåˆ™å°†å…¶ç§»åŠ¨åˆ°é“¾è¡¨å¤´éƒ¨ï¼›å¦‚æœæŸ¥è¯¢ä¸åˆ°åˆ™è¿”å›<code>null</code>ï¼›<ul><li>ç”±äºéå†é“¾è¡¨çš„æ—¶é—´å¤æ‚åº¦ä¸º<code>O(n)</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ•£åˆ—è¡¨<code>HashMap</code>æ¥è®°å½•æ¯ä¸ªKeyæ‰€å¯¹åº”çš„NodeèŠ‚ç‚¹ï¼Œå°†æ—¶é—´å¤æ‚åº¦é™ä¸ºO(1)ã€‚</li></ul></li></ul><p><img src="https://img.i7years.com/blog/LRU-Cache-Imp.png" alt="LRU-Cache"></p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.algorithms.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * LRU Cache</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> https://wangwei.one</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/01/29</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LRUCache</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> capacity;</span><br><span class="line">    <span class="keyword">private</span> Node head;</span><br><span class="line">    <span class="keyword">private</span> Node tail;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;K, Node&gt; nodeMap;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LRUCache</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.capacity = capacity;</span><br><span class="line">        <span class="keyword">this</span>.nodeMap = <span class="keyword">new</span> HashMap&lt;&gt;(capacity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get Key</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(K key)</span> </span>&#123;</span><br><span class="line">        Node existNode = nodeMap.get(key);</span><br><span class="line">        <span class="keyword">if</span> (existNode == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        remove(existNode);</span><br><span class="line">        addFirst(existNode);</span><br><span class="line">        <span class="keyword">return</span> existNode.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Add Key-Value</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        Node existNode = nodeMap.get(key);</span><br><span class="line">        <span class="keyword">if</span> (existNode == <span class="keyword">null</span>) &#123;</span><br><span class="line">            Node newNode = <span class="keyword">new</span> Node(key, value);</span><br><span class="line">            <span class="keyword">if</span> (nodeMap.size() &gt;= capacity) &#123;</span><br><span class="line">                removeLast();</span><br><span class="line">            &#125;</span><br><span class="line">            addFirst(newNode);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// update the value</span></span><br><span class="line">            existNode.value = value;</span><br><span class="line">            remove(existNode);</span><br><span class="line">            addFirst(existNode);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * remove node</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        Node prev = node.prev;</span><br><span class="line">        Node next = node.next;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (prev == <span class="keyword">null</span>) &#123;</span><br><span class="line">            head = next;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            prev.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (next == <span class="keyword">null</span>) &#123;</span><br><span class="line">            tail = prev;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            next.prev = prev;</span><br><span class="line">        &#125;</span><br><span class="line">        nodeMap.remove(node.key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * add first node</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addFirst</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// don't forget set node prev pointer to null !</span></span><br><span class="line">        node.prev = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="keyword">null</span>) &#123;</span><br><span class="line">            head = tail = node;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            node.next = head;</span><br><span class="line">            head.prev = node;</span><br><span class="line">            head = node;</span><br><span class="line">        &#125;</span><br><span class="line">        nodeMap.put(node.key, node);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * remove last</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">removeLast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (tail == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// remove key from map</span></span><br><span class="line">        nodeMap.remove(tail.key);</span><br><span class="line">        <span class="comment">// remove node from linked list</span></span><br><span class="line">        Node prev = tail.prev;</span><br><span class="line">        <span class="keyword">if</span> (prev != <span class="keyword">null</span>) &#123;</span><br><span class="line">            prev.next = <span class="keyword">null</span>;</span><br><span class="line">            tail = prev;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            head = tail = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> K key;</span><br><span class="line">        <span class="keyword">private</span> V value;</span><br><span class="line">        <span class="keyword">private</span> Node prev;</span><br><span class="line">        <span class="keyword">private</span> Node next;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">Node</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.key = key;</span><br><span class="line">            <span class="keyword">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/wangweiX/java-algorithms/blob/master/src/main/java/one/wangwei/algorithms/utils/LRUCache.java" target="_blank" rel="noopener">æºç </a></p></blockquote><p>LeetCodeä¸Šç›¸å…³çš„ç»ƒä¹ é¢˜ï¼š<a href="https://leetcode.com/problems/lru-cache/" target="_blank" rel="noopener">Leetcode 146. LRU Cache</a></p><p>æ€§èƒ½æµ‹è¯•ï¼šLeetCodeä¸Šè¿è¡Œæ—¶é—´ä¸º<code>88ms</code>ï¼Œè¶…è¿‡äº† <code>43.42%</code> çš„Javaä»£ç ã€‚</p><h2 id="ç›¸å…³ç»ƒä¹ "><a href="#ç›¸å…³ç»ƒä¹ " class="headerlink" title="ç›¸å…³ç»ƒä¹ "></a>ç›¸å…³ç»ƒä¹ </h2><ul><li><a href="https://wangwei.one/posts/java-algoDS-reverse-linked-list.html">é“¾è¡¨åè½¬</a></li><li><a href="https://wangwei.one/posts/java-algoDS-linked-list-cycle.html">é“¾è¡¨ç¯æ£€æµ‹</a></li><li><a href="https://wangwei.one/posts/java-algoDS-Merge-Two-Sorted-Linked-Lists.html">æœ‰åºé“¾è¡¨åˆå¹¶</a></li><li><a href="https://wangwei.one/posts/java-algoDS-Remove-Nth-Node-From-End-of-List.html">åˆ é™¤å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹</a></li><li><a href="https://wangwei.one/posts/java-algoDS-middle-of-the-linked-list.html">æ±‚é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹</a></li><li><a href="https://wangwei.one/posts/java-algoDS-palindrome-linked-list.html">å›æ–‡é“¾è¡¨æ£€æµ‹</a></li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li>ã€Š<a href="http://gk.link/a/101Nt" target="_blank" rel="noopener">æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾</a>ã€‹</li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> AlgoDS </tag>
            
            <tag> LeetCode </tag>
            
            <tag> LRU </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æ•°æ®ç»“æ„ä¸ç®—æ³• | LeetCode 224. Basic Calculator]]></title>
      <url>/posts/algoDS-java-leetcode-224-basic-calculator.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/62474_3d_space_scene.jpg?imageslim" alt="space_scene"></p><p>å‰é¢ï¼Œæˆ‘ä»¬å­¦ä¹ äº† <a href="https://wangwei.one/posts/java-data-structures-and-algorithms-stack.html">æ ˆçš„å®ç°åŠå…¶åº”ç”¨</a> ï¼Œä»Šå¤©æˆ‘ä»¬åŸºäºæ ˆï¼Œæ¥å®ç°ä¸€ä¸ªç®€å•çš„è®¡ç®—å™¨åŠŸèƒ½ã€‚</p><a id="more"></a><h2 id="ç®€å•è®¡ç®—å™¨å®ç°"><a href="#ç®€å•è®¡ç®—å™¨å®ç°" class="headerlink" title="ç®€å•è®¡ç®—å™¨å®ç°"></a>ç®€å•è®¡ç®—å™¨å®ç°</h2><blockquote><p>Leetcode 224. <a href="https://leetcode.com/problems/basic-calculator/" target="_blank" rel="noopener">Basic Calculator</a></p></blockquote><p>å®ç°ä¸€ä¸ªèƒ½å¤Ÿå¯¹ç®€å•çš„è¡¨è¾¾å¼è¿›è¡Œè®¡ç®—çš„åŸºç¡€è®¡ç®—å™¨ã€‚</p><p>è¡¨è¾¾å¼å­—ç¬¦ä¸²åŒ…å«æ‹¬å· <code>(</code> ã€<code>)</code>ï¼ŒåŠ å·(<code>+</code>)ï¼Œå‡å·(<code>-</code>)ï¼Œéè´Ÿæ•´æ•°ä»¥åŠç©ºæ ¼(â€˜ â€˜)ã€‚</p><p><strong>Example 1:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;1 + 1&quot;</span><br><span class="line">Output: 2</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot; 2-1 + 2 &quot;</span><br><span class="line">Output: 3</span><br></pre></td></tr></table></figure><p><strong>Example 3:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;(1+(4+5+2)-3)+(6+8)&quot;</span><br><span class="line">Output: 23</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨ä¸¤ä¸ªæ ˆæ¥å®ç°"><a href="#ä½¿ç”¨ä¸¤ä¸ªæ ˆæ¥å®ç°" class="headerlink" title="ä½¿ç”¨ä¸¤ä¸ªæ ˆæ¥å®ç°"></a>ä½¿ç”¨ä¸¤ä¸ªæ ˆæ¥å®ç°</h3><p>æ ¹æ® <a href="https://wangwei.one/posts/java-data-structures-and-algorithms-stack.html">æ ˆçš„å®ç°åŠå…¶åº”ç”¨</a> ä¸­å­¦åˆ°çš„è¡¨è¾¾å¼æ±‚å€¼çš„è§£æ³•ï¼š</p><blockquote><p>ç¼–è¯‘å™¨ä¼šä½¿ç”¨ä¸¤ä¸ªæ ˆæ¥å®ç°ï¼Œä¸€ä¸ªæ ˆç”¨æ¥ä¿å­˜æ“ä½œæ•°ï¼Œå¦ä¸€ä¸ªæ ˆç”¨æ¥ä¿å­˜è¿ç®—ç¬¦ã€‚ä»å·¦å‘å³éå†è¡¨è¾¾å¼ï¼Œé‡åˆ°æ•°å­—ç›´æ¥å‹å…¥æ“ä½œæ•°æ ˆï¼Œé‡åˆ°æ“ä½œç¬¦ï¼Œå°±ä¸è¿ç®—ç¬¦æ ˆé¡¶å…ƒç´ è¿›è¡Œæ¯”è¾ƒã€‚</p><p>å¦‚æœæ¯”è¿ç®—ç¬¦æ ˆé¡¶å…ƒç´ çš„ä¼˜å…ˆçº§é«˜ï¼Œå°±å°†å½“å‰è¿ç®—ç¬¦å‹å…¥æ ˆï¼›å¦‚æœæ¯”è¿ç®—ç¬¦æ ˆé¡¶å…ƒç´ çš„ä¼˜å…ˆçº§ä½æˆ–è€…ç›¸åŒï¼Œä»è¿ç®—ç¬¦æ ˆä¸­å–æ ˆé¡¶è¿ç®—ç¬¦ï¼Œä»æ“ä½œæ•°æ ˆçš„æ ˆé¡¶å– 2 ä¸ªæ“ä½œæ•°ï¼Œç„¶åè¿›è¡Œè®¡ç®—ï¼Œå†æŠŠè®¡ç®—å®Œçš„ç»“æœå‹å…¥æ“ä½œæ•°æ ˆï¼Œç»§ç»­æ¯”è¾ƒã€‚</p></blockquote><p>ä¸‹é¢æ˜¯æˆ‘æ ¹æ®ä¸Šé¢æ€è·¯ï¼Œå†™å‡ºæ¥çš„ç¬¬ä¸€ç‰ˆå®ç°ï¼Œç›¸æ¯”äºç½‘ä¸Šå·§å¦™çš„è§£é¢˜æ–¹æ³•ï¼Œç¡®å®å¤æ‚å¾ˆå¤šï¼Œåœ¨LeetCodeçš„è¿è¡Œæ—¶é—´ä¸º <code>195 ms</code> ï¼Œåªè¶…è¿‡äº† <code>8.14%</code> çš„æäº¤è®°å½• ğŸ˜… ã€‚</p><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><ol><li>å…ˆå¯¹è¡¨è¾¾å¼è¿›è¡Œæ ¡éªŒï¼Œå»é™¤ç©ºæ ¼ï¼Œå¹¶è½¬åŒ–ä¸ºArrayListï¼Œå¦‚æœæŒ‰ç…§ä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªå­—ç¬¦å»éå†çš„åˆ°ï¼Œè¦æ˜¯è¡¨è¾¾å¼ä¸­å­˜åœ¨å¤šä½çš„æ•´æ•°ï¼Œå°±è¡Œä¸é€šäº†ã€‚</li><li>å¯¹è½¬åŒ–åçš„ ArrayList è¿›è¡Œéå†ï¼Œé‡åˆ°æ•°å­—ï¼Œç›´æ¥å‹å…¥æ“ä½œæ•°æ ˆã€‚</li><li>é‡åˆ°æ“ä½œç¬¦ï¼Œåˆ™è¿›è¡Œéœ€è¦è¿›è¡Œä¸€ç³»åˆ—çš„åˆ¤æ–­ï¼Œç‰¹åˆ«æ˜¯é‡åˆ°æ‹¬å·çš„å¤„ç†ï¼š<ol><li>æ“ä½œç¬¦æ ˆä¸ºç©ºçš„æƒ…å†µä¸‹ï¼Œç›´æ¥å…¥æ ˆï¼›</li><li>æ¯”è¾ƒ <strong>æ–°çš„æ“ä½œç¬¦</strong> ä¸ <strong>æ“ä½œç¬¦æ ˆé¡¶å…ƒç´ </strong> çš„ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§é«˜ï¼Œåˆ™ç›´æ¥å…¥æ ˆã€‚å¦‚æœå®ƒä»¬æœ‰ä¸€ä¸ªæˆ–éƒ½æ˜¯å·¦æ‹¬å·ï¼Œåˆ™ç›´æ¥å…¥æ ˆï¼›</li><li>å¦‚æœä¼˜å…ˆçº§ä½æˆ–ç›¸åŒï¼Œåˆ™å¯¹å‰é¢çš„è¡¨è¾¾å¼è¿›è¡Œé€’å½’è®¡ç®—ï¼Œå°†æœ€åçš„ç»“æœå‹å…¥æ“ä½œæ•°æ ˆã€‚ä¹‹åï¼Œåœ¨é€’å½’è°ƒç”¨è‡ªèº«ï¼Œå‹å…¥æ–°çš„æ“ä½œç¬¦ã€‚</li></ol></li><li>éå†ç»“æŸåï¼Œåœ¨å¯¹æ“ä½œæ•°ç«™è¿›è¡Œæœ€åä¸€æ¬¡é€’å½’è®¡ç®—ï¼›</li><li>å–å‡ºæ“ä½œæ•°æ ˆçš„æ ˆé¡¶å…ƒç´ ã€‚</li></ol><h4 id="ä»£ç å¦‚ä¸‹"><a href="#ä»£ç å¦‚ä¸‹" class="headerlink" title="ä»£ç å¦‚ä¸‹"></a>ä»£ç å¦‚ä¸‹</h4><p>é‡Œé¢ç”¨åˆ°çš„ <a href="https://wangwei.one/posts/java-data-structures-and-algorithms-stack.html#%E9%93%BE%E8%A1%A8%E6%A0%88">LinkedStack</a> æ˜¯æˆ‘ä»¬å‰é¢è‡ªå·±å®ç°çš„é“¾è¡¨æ ˆï¼Œå½“ç„¶ä½¿ç”¨ <a href="https://wangwei.one/posts/java-data-structures-and-algorithms-stack.html#%E9%A1%BA%E5%BA%8F%E6%A0%88">ArrayStack</a> ä¹Ÿå¯ä»¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.leetcode.stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> one.wangwei.algorithms.datastructures.stack.IStack;</span><br><span class="line"><span class="keyword">import</span> one.wangwei.algorithms.datastructures.stack.impl.LinkedStack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç®€å•è®¡ç®—å™¨å®ç°</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> https://wangwei.one</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/1/18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBasicCalculator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> IStack&lt;Integer&gt; operand;</span><br><span class="line">    <span class="keyword">private</span> IStack&lt;String&gt; operator;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; highOperator;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; lowOperator;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; parentheses;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; operatorSet;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyBasicCalculator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.operand = <span class="keyword">new</span> LinkedStack&lt;&gt;();</span><br><span class="line">        <span class="keyword">this</span>.operator = <span class="keyword">new</span> LinkedStack&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.parentheses = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        <span class="keyword">this</span>.parentheses.add(<span class="string">"("</span>);</span><br><span class="line">        <span class="keyword">this</span>.parentheses.add(<span class="string">")"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.highOperator = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        <span class="keyword">this</span>.highOperator.add(<span class="string">"*"</span>);</span><br><span class="line">        <span class="keyword">this</span>.highOperator.add(<span class="string">"/"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.lowOperator = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        <span class="keyword">this</span>.lowOperator.add(<span class="string">"+"</span>);</span><br><span class="line">        <span class="keyword">this</span>.lowOperator.add(<span class="string">"-"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.operatorSet = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        <span class="keyword">this</span>.operatorSet.addAll(highOperator);</span><br><span class="line">        <span class="keyword">this</span>.operatorSet.addAll(lowOperator);</span><br><span class="line">        <span class="keyword">this</span>.operatorSet.addAll(parentheses);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿ç®—è¡¨è¾¾å¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> s</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">calculate</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (s == <span class="keyword">null</span> || s.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Expression Invalid! expr="</span> + s);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ArrayList&lt;String&gt; express = convertExpr(s);</span><br><span class="line">        <span class="keyword">for</span> (String str : express) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!operatorSet.contains(str)) &#123;</span><br><span class="line">                operand.push(Integer.valueOf(str));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                pushOperator(str);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯¹ä½™ä¸‹çš„æ“ä½œæ•°è¿›è¡Œè®¡ç®—ï¼Œå¾—åˆ°æœ€åçš„ç»“æœ</span></span><br><span class="line">        operandCalcu();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> operand.pop();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è½¬æ¢è¡¨è¾¾å¼</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 1. å»é™¤ç©ºæ ¼</span></span><br><span class="line"><span class="comment">     * 2. æ‹†åˆ†å‡ºæœ‰æ•ˆçš„æ•°å­—</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> expr</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ArrayList&lt;String&gt; <span class="title">convertExpr</span><span class="params">(String expr)</span> </span>&#123;</span><br><span class="line">        ArrayList&lt;String&gt; result = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="comment">// remove empty spaces</span></span><br><span class="line">        String trimExpr = expr.replaceAll(<span class="string">"\\s+"</span>, <span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">        String tmpIntStr = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">for</span> (Character ch : trimExpr.toCharArray()) &#123;</span><br><span class="line">            String str = ch.toString();</span><br><span class="line">            <span class="keyword">if</span> (operatorSet.contains(str)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!tmpIntStr.isEmpty()) &#123;</span><br><span class="line">                    result.add(tmpIntStr);</span><br><span class="line">                    tmpIntStr = <span class="string">""</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                result.add(str);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                tmpIntStr = tmpIntStr + str;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!tmpIntStr.isEmpty()) &#123;</span><br><span class="line">            result.add(tmpIntStr);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿ç®—ç¬¦å…¥æ ˆ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> operatorSign</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">pushOperator</span><span class="params">(String operatorSign)</span> </span>&#123;</span><br><span class="line">        String prevOperator = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (!operator.empty()) &#123;</span><br><span class="line">            prevOperator = operator.peek();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç¬¬ä¸€æ¬¡å…¥æ ˆ</span></span><br><span class="line">        <span class="keyword">if</span> (prevOperator == <span class="keyword">null</span>) &#123;</span><br><span class="line">            operator.push(operatorSign);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">")"</span>.equals(operatorSign) &amp;&amp; <span class="string">"("</span>.equals(prevOperator)) &#123;</span><br><span class="line">                operator.pop();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ç¬¬ä¸€æ¬¡ä»¥åå…¥æ ˆï¼Œå…ˆæ¯”è¾ƒä¼˜å…ˆçº§ï¼Œé«˜ä¼˜å…ˆçº§ï¼Œåˆ™å…¥æ ˆ</span></span><br><span class="line">            <span class="keyword">if</span> (priority(operatorSign, prevOperator)) &#123;</span><br><span class="line">                operator.push(operatorSign);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// å¦åˆ™å…ˆå¯¹å‰é¢çš„è¡¨è¾¾å¼è¿›è¡Œè®¡ç®—</span></span><br><span class="line">                operandCalcu();</span><br><span class="line">                pushOperator(operatorSign);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»æ“ä½œæ•°æ ˆå–å‡ºä¸¤ä¸ªæ“ä½œæ•°è¿›è¡Œè®¡ç®—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">operandCalcu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (operator.empty()) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String sign = operator.peek();</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"("</span>.equals(sign)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        sign = operator.pop();</span><br><span class="line">        <span class="keyword">int</span> after = operand.pop();</span><br><span class="line">        <span class="keyword">int</span> front = operand.pop();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> value = calcIntegers(front, after, sign);</span><br><span class="line">        operand.push(value);</span><br><span class="line">        operandCalcu();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¯”è¾ƒä¼˜å…ˆçº§</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> next</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> prev</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">priority</span><span class="params">(String next, String prev)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (highOperator.contains(next)</span><br><span class="line">                &amp;&amp; lowOperator.contains(prev))</span><br><span class="line">                || <span class="string">"("</span>.equals(prev)</span><br><span class="line">                || <span class="string">"("</span>.equals(next);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯¹ä¸¤ä¸ªæ•°å­—è¿›è¡Œè®¡ç®—</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> front</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> after</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sign</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">calcIntegers</span><span class="params">(<span class="keyword">int</span> front, <span class="keyword">int</span> after, String sign)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (sign) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"+"</span>:</span><br><span class="line">                <span class="keyword">return</span> front + after;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"-"</span>:</span><br><span class="line">                <span class="keyword">return</span> front - after;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"*"</span>:</span><br><span class="line">                <span class="keyword">return</span> front * after;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"/"</span>:</span><br><span class="line">                <span class="keyword">return</span> front / after;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Sign Invalid! sign="</span> + sign);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line">        MyBasicCalculator solution = <span class="keyword">new</span> MyBasicCalculator();</span><br><span class="line">        System.out.println(solution.calculate(<span class="string">"1 + 1 - 3 + 4 - (8 + 2) - 4 + 3 - 1 - 4 + 6 - 9 + 1"</span>));</span><br><span class="line">        System.out.println(solution.calculate(<span class="string">"(1+(4+5+2)-3)+(6+8)"</span>));</span><br><span class="line">        System.out.println(solution.calculate(<span class="string">"1-(5)"</span>));</span><br><span class="line">        System.out.println(solution.calculate(<span class="string">"2-4-(8+2-6+(8+4-(1)+8-10))"</span>));</span><br><span class="line">        System.out.println(System.currentTimeMillis() - startTime);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/wangweiX/java-algorithms/blob/master/src/main/java/one/wangwei/leetcode/stack/MyBasicCalculator.java" target="_blank" rel="noopener">æºç </a></p></blockquote><h3 id="å·§å¦™çš„è§£æ³•"><a href="#å·§å¦™çš„è§£æ³•" class="headerlink" title="å·§å¦™çš„è§£æ³•"></a>å·§å¦™çš„è§£æ³•</h3><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹ç½‘ä¸Šæ¯”è¾ƒå¥½çš„è§£æ³•ï¼Œç›¸æ¯”äºæˆ‘çš„ä»£ç ï¼Œç®€ç›´ä¸è¦çˆ½å¤ªå¤šï¼Œè†œæ‹œâ€¦â€¦ LeetCodeä¸Šè¿è¡Œåªéœ€è¦è€—æ—¶ 27 ms.</p><h4 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><ol><li>è§£æå¤šä½æ•´æ•°ã€‚æ¯”å¦‚è§£æ123ï¼Œç¬¬ä¸€æ¬¡å¾ªç¯ä¸º <code>1 * 10 + 2 = 12</code>ï¼Œç¬¬äºŒæ¬¡å¾ªç¯ä¸º <code>12 * 10 + 3 = 123</code>ï¼›</li><li>å¤„ç†åŠ å‡å·ã€‚ä¸æ˜¯å­˜å‚¨å…¥åˆ°æ“ä½œç¬¦æ ˆï¼Œè€Œæ˜¯è½¬ä¸ºæ­£è´Ÿå·ï¼Œå¾…åˆ°ä¸‹ä¸€æ¬¡å¾ªç¯æ—¶ï¼Œä¸å‰é¢çš„ç´¯è®¡ç»“æœè¿›è¡Œç›¸åŠ ï¼›</li><li>å¤„ç†æ‹¬å·ã€‚å¦‚æœé‡åˆ° <code>å·¦æ‹¬å· (</code>ï¼Œå°±å°†å‰é¢ç´¯è®¡çš„ç»“æœä¸æ­£è´Ÿå­˜å‚¨æ“ä½œæ•°æ ˆï¼Œå¹¶å°†ç´¯è®¡ç»“æœæ¸…ç©ºï¼Œæ­£è´Ÿå·æ ‡è®°ä¸ºæ­£ã€‚ç­‰åˆ°é‡åˆ°<code>å³æ‹¬å· )</code>æ—¶ï¼Œå°±å°†è¿™ä¸€æ¬¡ç´¯è®¡çš„ç»“æœä¸æ“ä½œæ•°æ ˆé¡¶å­˜å‚¨çš„ç´¯è®¡ç»“æœè¿›è¡Œç´¯åŠ ï¼Œå¾—åˆ°ä¸€ä¸ªæœ€ç»ˆç»“æœï¼›</li></ol><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.leetcode.stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç®€å•è®¡ç®—å™¨å®ç°</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> https://wangwei.one</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/1/18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicCalculator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿ç®—è¡¨è¾¾å¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> s</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">calculate</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ“ä½œæ•°æ ˆ</span></span><br><span class="line">        Stack&lt;Integer&gt; stack = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">        <span class="comment">// æ­£è´Ÿå·</span></span><br><span class="line">        <span class="keyword">int</span> sign = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// ç´¯è®¡ç»“æœ</span></span><br><span class="line">        <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Character.isDigit(s.charAt(i))) &#123;</span><br><span class="line">                <span class="comment">// å­—ç¬¦è½¬æ¢</span></span><br><span class="line">                <span class="keyword">int</span> num = s.charAt(i) - <span class="string">'0'</span>;</span><br><span class="line">                <span class="comment">// å¤„ç†å¤šä½æ•´æ•°</span></span><br><span class="line">                <span class="keyword">while</span> (i + <span class="number">1</span> &lt; s.length() &amp;&amp; Character.isDigit(s.charAt(i + <span class="number">1</span>))) &#123;</span><br><span class="line">                    num = num * <span class="number">10</span> + s.charAt(i + <span class="number">1</span>) - <span class="string">'0'</span>;</span><br><span class="line">                    i++;</span><br><span class="line">                &#125;</span><br><span class="line">                result += num * sign;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s.charAt(i) == <span class="string">'+'</span>) &#123;</span><br><span class="line">                sign = <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s.charAt(i) == <span class="string">'-'</span>) &#123;</span><br><span class="line">                sign = -<span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s.charAt(i) == <span class="string">'('</span>) &#123;</span><br><span class="line">                stack.push(result);</span><br><span class="line">                stack.push(sign);</span><br><span class="line">                result = <span class="number">0</span>;</span><br><span class="line">                sign = <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s.charAt(i) == <span class="string">')'</span>) &#123;</span><br><span class="line">                result = result * stack.pop() + stack.pop();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        BasicCalculator calculator = <span class="keyword">new</span> BasicCalculator();</span><br><span class="line">        System.out.println(calculator.calculate(<span class="string">"2-4-(8+2-6 + (8 +4 -(1)+8-10))"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/wangweiX/java-algorithms/blob/master/src/main/java/one/wangwei/leetcode/stack/BasicCalculator.java" target="_blank" rel="noopener">æºç </a></p></blockquote><p>çŸ¥é“åŸç†æ˜¯ä¸€å›äº‹ï¼Œè‡ªå·±åŠ¨æ‰‹å»å®ç°ï¼Œåˆæ˜¯å¦å¤–ä¸€å›äº‹ï¼</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li>ã€Š<a href="http://gk.link/a/101Nt" target="_blank" rel="noopener">æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾</a>ã€‹</li><li><a href="https://time.geekbang.org/column/article/41222" target="_blank" rel="noopener">https://time.geekbang.org/column/article/41222</a></li><li><a href="https://www.youtube.com/watch?v=ijyUwyt5vkU&amp;t=114s" target="_blank" rel="noopener">https://www.youtube.com/watch?v=ijyUwyt5vkU&amp;t=114s</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> AlgoDS </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æ•°æ®ç»“æ„ä¸ç®—æ³• | æ ˆçš„å®ç°åŠåº”ç”¨]]></title>
      <url>/posts/java-data-structures-and-algorithms-stack.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p align="center"><br><a target="_blank" href="https://www.pexels.com/photo/orange-and-blue-abstract-painting-1532704/"><img src="https://img.i7years.com/blog/abstract-expressionism-abstract-painting-acrylic-1532704.jpg?imageslim" title="abstract painting acrylic" alt="abstract painting acrylic"></a><br></p><p>å‰é¢ï¼Œæˆ‘ä»¬å®ç°äº†ä¸¤ç§å¸¸è§çš„çº¿æ€§è¡¨ â€”â€” <a href="https://wangwei.one/posts/java-data-structures-and-algorithms-arraylist.html">é¡ºåºè¡¨</a> å’Œ <a href="https://wangwei.one/posts/java-data-structures-and-algorithms-linkedlist.html">é“¾è¡¨</a> ï¼Œæœ¬ç¯‡æˆ‘ä»¬æ¥ä»‹ç»å¦å¤–ä¸€ç§å¸¸ç”¨çš„çº¿æ€§è¡¨ â€”â€” æ ˆã€‚</p><a id="more"></a><blockquote><p>å£°æ˜ï¼šæœ¬ç¯‡ä¸ºæå®¢æ—¶é—´ã€Š <a href="http://gk.link/a/101Nt" target="_blank" rel="noopener">æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾</a> ã€‹ä¸“æ ã€Š <a href="https://time.geekbang.org/column/article/41222" target="_blank" rel="noopener">æ ˆ</a> ã€‹è¿™ä¸€éƒ¨åˆ†çš„å­¦ä¹ ç¬”è®°ï¼Œéƒ¨åˆ†å†…å®¹æ‘˜æŠ„è‡ªä¸“æ æ–‡ç« ã€‚</p></blockquote><h2 id="æ ˆ"><a href="#æ ˆ" class="headerlink" title="æ ˆ"></a>æ ˆ</h2><h4 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4><p>çº¿æ€§è¡¨ä¸­çš„ä¸€ç§ç‰¹æ®Šæ•°æ®ç»“æ„ï¼Œæ•°æ®åªèƒ½ä»å›ºå®šçš„ä¸€ç«¯æ’å…¥æ•°æ®æˆ–åˆ é™¤æ•°æ®ï¼Œå¦ä¸€ç«¯æ˜¯å°æ­»çš„ã€‚</p><p align="center"><br><a target="_blank" href="https://wangwei.one/posts/java-data-structures-and-algorithms-stack.html"><img src="https://img.i7years.com/blog/wangwei.one.stack.gif" title="stack" alt="stack"></a><br></p><h4 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><ul><li><p>FILOï¼ˆFirst In Last Outï¼‰: å…ˆè¿›åå‡ºï¼›</p></li><li><p>æ ˆæ»¡è¿˜å­˜ä¼šâ€œä¸Šæº¢â€ï¼Œæ ˆç©ºå†å–ä¼šâ€œä¸‹æº¢â€ï¼›</p><blockquote><p>â€œä¸Šæº¢â€ï¼šåœ¨æ ˆå·²ç»å­˜æ»¡æ•°æ®å…ƒç´ çš„æƒ…å†µä¸‹ï¼Œå¦‚æœç»§ç»­å‘æ ˆå†…å­˜å…¥æ•°æ®ï¼Œæ ˆå­˜å‚¨å°±ä¼šå‡ºé”™ã€‚</p><p>â€œä¸‹æº¢â€ï¼šåœ¨æ ˆå†…ä¸ºç©ºçš„çŠ¶æ€ä¸‹ï¼Œå¦‚æœå¯¹æ ˆç»§ç»­è¿›è¡Œå–æ•°æ®çš„æ“ä½œï¼Œå°±ä¼šå‡ºé”™ã€‚</p></blockquote></li></ul><h2 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h2><h3 id="é¡ºåºæ ˆ"><a href="#é¡ºåºæ ˆ" class="headerlink" title="é¡ºåºæ ˆ"></a>é¡ºåºæ ˆ</h3><h4 id="ç‰¹ç‚¹-1"><a href="#ç‰¹ç‚¹-1" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><ul><li>é‡‡ç”¨æ•°ç»„å®ç°ï¼Œæ•°æ®åœ¨ç‰©ç†ç»“æ„ä¸Šä¿æŒè¿ç»­æ€§ã€‚</li></ul><h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.algorithms.datastructures.stack.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> one.wangwei.algorithms.datastructures.stack.IStack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é¡ºåºæ ˆ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/05/04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayStack</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">IStack</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é»˜è®¤å¤§å°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_SIZE = <span class="number">10</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°ç»„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> T[] array = (T[]) <span class="keyword">new</span> Object[DEFAULT_SIZE];</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤§å°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…¥æ ˆ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">push</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (size &gt;= array.length) &#123;</span><br><span class="line">            grow();</span><br><span class="line">        &#125;</span><br><span class="line">        array[size] = value;</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰©å®¹50%</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">grow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> growSize = size + (size &lt;&lt; <span class="number">1</span>);</span><br><span class="line">        array = Arrays.copyOf(array, growSize);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‹ç¼©50%</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">shrink</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> shrinkSize = size &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        array = Arrays.copyOf(array, shrinkSize);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‡ºæ ˆ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (size &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        T element = array[--size];</span><br><span class="line">        array[size] = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> shrinkSize = array.length &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (shrinkSize &gt;= DEFAULT_SIZE &amp;&amp; shrinkSize &gt; size) &#123;</span><br><span class="line">            shrink();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥çœ‹æ ˆé¡¶å€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">peek</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (size &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> array[size - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤å…ƒç´ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (size &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            T t = array[i];</span><br><span class="line">            <span class="keyword">if</span> (value == <span class="keyword">null</span> &amp;&amp; t == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> remove(i);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (value != <span class="keyword">null</span> &amp;&amp; value.equals(t)) &#123;</span><br><span class="line">                <span class="keyword">return</span> remove(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç§»é™¤ index å¤„çš„æ ˆå€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= size) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ArrayIndexOutOfBoundsException(<span class="string">"Index: "</span> + index + <span class="string">", Size: "</span> + size);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (index != --size) &#123;</span><br><span class="line">            System.arraycopy(array, index + <span class="number">1</span>, array, index, size - index);</span><br><span class="line">        &#125;</span><br><span class="line">        array[size] = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> shrinkSize = array.length &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (shrinkSize &gt;= DEFAULT_SIZE &amp;&amp; shrinkSize &gt; size) &#123;</span><br><span class="line">            shrink();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¸…ç©ºæ ˆ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (size &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            array[i] = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">        array = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦åŒ…å«å…ƒç´ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (size &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            T t = array[i];</span><br><span class="line">            <span class="keyword">if</span> (value == <span class="keyword">null</span> &amp;&amp; t == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (value != <span class="keyword">null</span> &amp;&amp; value.equals(t)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ˆå¤§å°</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/wangweiX/java-algorithms/blob/master/src/main/java/one/wangwei/algorithms/datastructures/stack/impl/ArrayStack.java" target="_blank" rel="noopener">æºç </a></p></blockquote><h4 id="å¤æ‚åº¦"><a href="#å¤æ‚åº¦" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4><h5 id="ç©ºé—´å¤æ‚åº¦"><a href="#ç©ºé—´å¤æ‚åº¦" class="headerlink" title="ç©ºé—´å¤æ‚åº¦"></a>ç©ºé—´å¤æ‚åº¦</h5><p>å‡ºæ ˆå’Œå…¥æ ˆçš„æ“ä½œï¼Œåªæ¶‰åŠä¸€ä¸¤ä¸ªä¸´æ—¶å˜é‡çš„å­˜å‚¨ç©ºé—´ï¼Œæ‰€ä»¥å¤æ‚åº¦ä¸ºO(1).</p><h5 id="æ—¶é—´å¤æ‚åº¦"><a href="#æ—¶é—´å¤æ‚åº¦" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h5><p>é¡ºåºæ ˆåœ¨å‡ºæ ˆå’Œå…¥æ ˆçš„æ“ä½œæ—¶ï¼Œæœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œå½“éœ€è¦æ‰©å®¹æˆ–è€…ç¼©å‡æ—¶ï¼Œéœ€è¦è¿ç§»æ•°æ®ï¼Œæ­¤æ—¶æœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦ä¸ºO(n). æ ¹æ®æ‘Šè¿˜åˆ†ææ³•åˆ™ï¼Œå®ƒä»¬çš„å‡æ‘Šæ—¶é—´å¤æ‚åº¦è¿˜æ˜¯ä¸ºO(1).</p><h3 id="é“¾è¡¨æ ˆ"><a href="#é“¾è¡¨æ ˆ" class="headerlink" title="é“¾è¡¨æ ˆ"></a>é“¾è¡¨æ ˆ</h3><h4 id="ç‰¹ç‚¹-2"><a href="#ç‰¹ç‚¹-2" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><ul><li>ç”¨çº¿æ€§è¡¨çš„é“¾å¼ç»“æ„å­˜å‚¨ï¼Œæ•°æ®åœ¨ç‰©ç†ç»“æ„ä¸Šéè¿ç»­</li></ul><h4 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.algorithms.datastructures.stack.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> one.wangwei.algorithms.datastructures.stack.IStack;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é“¾è¡¨æ ˆ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/05/04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedStack</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">IStack</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Node&lt;T&gt; top;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedStack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.top = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">this</span>.size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…¥æ ˆ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">push</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">        Node&lt;T&gt; newTop = <span class="keyword">new</span> Node&lt;&gt;(value);</span><br><span class="line">        <span class="keyword">if</span> (top == <span class="keyword">null</span>) &#123;</span><br><span class="line">            top = newTop;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Node&lt;T&gt; oldTop = top;</span><br><span class="line">            top = newTop;</span><br><span class="line">            oldTop.above = top;</span><br><span class="line">            top.below = oldTop;</span><br><span class="line">        &#125;</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‡ºæ ˆ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (top == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Node&lt;T&gt; needTop = top;</span><br><span class="line">        top = needTop.below;</span><br><span class="line">        <span class="keyword">if</span> (top != <span class="keyword">null</span>) &#123;</span><br><span class="line">            top.above = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        T needValue = needTop.element;</span><br><span class="line">        needTop = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> needValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥çœ‹æ ˆé¡¶å€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">peek</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> top == <span class="keyword">null</span> ? <span class="keyword">null</span> : top.element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤å…ƒç´ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (top == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Node&lt;T&gt; x = top;</span><br><span class="line">        <span class="keyword">if</span> (value == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span> (x != <span class="keyword">null</span> &amp;&amp; x.element != <span class="keyword">null</span>) &#123;</span><br><span class="line">                x = x.below;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (x != <span class="keyword">null</span> &amp;&amp; !value.equals(x.element)) &#123;</span><br><span class="line">                x = x.below;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> remove(x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Node&lt;T&gt; node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Node&lt;T&gt; above = node.above;</span><br><span class="line">        Node&lt;T&gt; below = node.below;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ é™¤ä¸­é—´å…ƒç´ </span></span><br><span class="line">        <span class="keyword">if</span> (above != <span class="keyword">null</span> &amp;&amp; below != <span class="keyword">null</span>) &#123;</span><br><span class="line">            above.below = below;</span><br><span class="line">            below.above = above;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åˆ é™¤topå…ƒç´ </span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (above == <span class="keyword">null</span> &amp;&amp; below != <span class="keyword">null</span>) &#123;</span><br><span class="line">            top = below;</span><br><span class="line">            top.above = <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (above != <span class="keyword">null</span> &amp;&amp; below == <span class="keyword">null</span>) &#123;</span><br><span class="line">            above.below = <span class="keyword">null</span>;</span><br><span class="line">            below = <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            top = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        node = <span class="keyword">null</span>;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¸…ç©ºæ ˆ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (top == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (Node&lt;T&gt; x = top; x != <span class="keyword">null</span>; ) &#123;</span><br><span class="line">            Node&lt;T&gt; below = x.below;</span><br><span class="line">            x.element = <span class="keyword">null</span>;</span><br><span class="line">            x.above = <span class="keyword">null</span>;</span><br><span class="line">            x.below = <span class="keyword">null</span>;</span><br><span class="line">            x = below;</span><br><span class="line">        &#125;</span><br><span class="line">        top = <span class="keyword">null</span>;</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦åŒ…å«å…ƒç´ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (value == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Node&lt;T&gt; x = top; x != <span class="keyword">null</span>; x = x.below) &#123;</span><br><span class="line">                <span class="keyword">if</span> (x.element == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (Node&lt;T&gt; x = top; x != <span class="keyword">null</span>; x = x.below) &#123;</span><br><span class="line">                <span class="keyword">if</span> (x.element.equals(value)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ˆå¤§å°</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> T element;</span><br><span class="line">        <span class="keyword">private</span> Node&lt;T&gt; above;</span><br><span class="line">        <span class="keyword">private</span> Node&lt;T&gt; below;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(T element)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.element = element;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/wangweiX/java-algorithms/blob/master/src/main/java/one/wangwei/algorithms/datastructures/stack/impl/LinkedStack.java" target="_blank" rel="noopener">æºç </a></p></blockquote><h4 id="å¤æ‚åº¦-1"><a href="#å¤æ‚åº¦-1" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h4><h5 id="ç©ºé—´å¤æ‚åº¦-1"><a href="#ç©ºé—´å¤æ‚åº¦-1" class="headerlink" title="ç©ºé—´å¤æ‚åº¦"></a>ç©ºé—´å¤æ‚åº¦</h5><p>å‡ºæ ˆå’Œå…¥æ ˆçš„æ“ä½œï¼Œåªæ¶‰åŠä¸€ä¸¤ä¸ªä¸´æ—¶å˜é‡çš„å­˜å‚¨ç©ºé—´ï¼Œæ‰€ä»¥å¤æ‚åº¦ä¸ºO(1).</p><h5 id="æ—¶é—´å¤æ‚åº¦-1"><a href="#æ—¶é—´å¤æ‚åº¦-1" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h5><p>å‡ºæ ˆå’Œå…¥æ ˆçš„æ“ä½œï¼Œä¸æ¶‰åŠæ•°æ®æ¬è¿ï¼Œåªæ˜¯é¡¶éƒ¨å…ƒç´ æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦å‡ä¸ºO(1).</p><h2 id="æ ˆçš„åº”ç”¨"><a href="#æ ˆçš„åº”ç”¨" class="headerlink" title="æ ˆçš„åº”ç”¨"></a>æ ˆçš„åº”ç”¨</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹æ ˆåœ¨è½¯ä»¶å·¥ç¨‹ä¸­çš„å®é™…åº”ç”¨ã€‚</p><h3 id="å‡½æ•°è°ƒç”¨"><a href="#å‡½æ•°è°ƒç”¨" class="headerlink" title="å‡½æ•°è°ƒç”¨"></a>å‡½æ•°è°ƒç”¨</h3><p>æ“ä½œç³»ç»Ÿç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…äº†ä¸€å—ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œè¿™å—å†…å­˜è¢«ç»„ç»‡æˆâ€œæ ˆâ€è¿™ç§ç»“æ„, ç”¨æ¥å­˜å‚¨å‡½æ•°è°ƒç”¨æ—¶çš„ä¸´æ—¶å˜é‡ã€‚æ¯è¿›å…¥ä¸€ä¸ªå‡½æ•°ï¼Œå°±ä¼šå°†ä¸´æ—¶å˜é‡ä½œä¸ºä¸€ä¸ªæ ˆå¸§å…¥æ ˆï¼Œå½“è¢«è°ƒç”¨å‡½æ•°æ‰§è¡Œå®Œæˆï¼Œè¿”å›ä¹‹åï¼Œå°†è¿™ä¸ªå‡½æ•°å¯¹åº”çš„æ ˆå¸§å‡ºæ ˆã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">int</span> a = <span class="number">1</span>; </span><br><span class="line">   <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">   <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">   ret = add(<span class="number">3</span>, <span class="number">5</span>);</span><br><span class="line">   res = a + ret;</span><br><span class="line">   printf(<span class="string">"%d"</span>, res);</span><br><span class="line">   reuturn <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">   sum = x + y;</span><br><span class="line">   <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>main() å‡½æ•°è°ƒç”¨äº† add() å‡½æ•°ï¼Œè·å–è®¡ç®—ç»“æœï¼Œå¹¶ä¸”ä¸ä¸´æ—¶å˜é‡ a ç›¸åŠ ï¼Œæœ€åæ‰“å° res çš„å€¼ã€‚è¿™ä¸ªè¿‡ç¨‹çš„ä¸­å‡½æ•°æ ˆé‡Œçš„å‡ºæ ˆã€å…¥æ ˆæ“ä½œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://img.i7years.com/blog/17b6c6711e8d60b61d65fb0df5559a1c.jpg" alt="17b6c6711e8d60b61d65fb0df5559a1c"></p><p><strong>æ€è€ƒ</strong>ï¼šä¸ºä»€ä¹ˆå‡½æ•°è¦ç”¨æ ˆæ¥ä¿å­˜ä¸´æ—¶å˜é‡å‘¢ï¼Ÿç”¨å…¶ä»–æ•°æ®ç»“æ„ä¸è¡Œå—ï¼Ÿ</p><p>å‡½æ•°è°ƒç”¨çš„å±€éƒ¨çŠ¶æ€ä¹‹æ‰€ä»¥ç”¨æ ˆæ¥è®°å½•æ˜¯å› ä¸ºè¿™äº›çŠ¶æ€æ•°æ®çš„å­˜æ´»æ—¶é—´æ»¡è¶³â€œåå…¥å…ˆå‡ºâ€ï¼ˆLIFOï¼‰é¡ºåºï¼Œè€Œæ ˆçš„åŸºæœ¬æ“ä½œæ­£å¥½å°±æ˜¯æ”¯æŒè¿™ç§é¡ºåºçš„è®¿é—®ã€‚</p><p>æ ˆæ˜¯ç¨‹åºè®¾è®¡ä¸­çš„ä¸€ç§ç»å…¸æ•°æ®ç»“æ„ï¼Œæ¯ä¸ªç¨‹åºéƒ½æ‹¥æœ‰è‡ªå·±çš„ç¨‹åºæ ˆã€‚æ ˆå¸§ä¹Ÿå«è¿‡ç¨‹æ´»åŠ¨è®°å½•ï¼Œæ˜¯ç¼–è¯‘å™¨ç”¨æ¥å®ç°å‡½æ•°è°ƒç”¨è¿‡ç¨‹çš„ä¸€ç§æ•°æ®ç»“æ„ã€‚Cè¯­è¨€ä¸­ï¼Œæ¯ä¸ªæ ˆå¸§å¯¹åº”ç€ä¸€ä¸ªæœªè¿è¡Œå®Œçš„å‡½æ•°ã€‚ä»é€»è¾‘ä¸Šè®²ï¼Œæ ˆå¸§å°±æ˜¯ä¸€ä¸ªå‡½æ•°æ‰§è¡Œçš„ç¯å¢ƒï¼šå‡½æ•°è°ƒç”¨æ¡†æ¶ã€å‡½æ•°å‚æ•°ã€å‡½æ•°çš„å±€éƒ¨å˜é‡ã€å‡½æ•°æ‰§è¡Œå®Œåè¿”å›åˆ°å“ªé‡Œç­‰ç­‰ã€‚æ ˆæ˜¯ä»é«˜åœ°å€å‘ä½åœ°å€å»¶ä¼¸çš„ã€‚æ¯ä¸ªå‡½æ•°çš„æ¯æ¬¡è°ƒç”¨ï¼Œéƒ½æœ‰å®ƒè‡ªå·±ç‹¬ç«‹çš„ä¸€ä¸ªæ ˆå¸§ï¼Œè¿™ä¸ªæ ˆå¸§ä¸­ç»´æŒç€æ‰€éœ€è¦çš„å„ç§ä¿¡æ¯ã€‚</p><p>å¯„å­˜å™¨ebp(base pointer)æŒ‡å‘å½“å‰çš„æ ˆå¸§çš„åº•éƒ¨ï¼ˆé«˜åœ°å€ï¼‰ï¼Œå¯ç§°ä¸ºâ€œå¸§æŒ‡é’ˆâ€æˆ–â€œåŸºå€æŒ‡é’ˆâ€ï¼›å¯„å­˜å™¨esp(stack pointer)æŒ‡å‘å½“å‰çš„æ ˆå¸§çš„é¡¶éƒ¨ï¼ˆä½åœ°å€ï¼‰ï¼Œå¯ç§°ä¸ºâ€œ æ ˆæŒ‡é’ˆâ€ã€‚</p><p><img src="https://img.i7years.com/blog/4380238-c33d9fdcf86a6730.png" alt="4380238-c33d9fdcf86a6730"></p><p>åœ¨Cå’ŒC++è¯­è¨€ä¸­ï¼Œä¸´æ—¶å˜é‡åˆ†é…åœ¨æ ˆä¸­ï¼Œä¸´æ—¶å˜é‡æ‹¥æœ‰å‡½æ•°çº§çš„ç”Ÿå‘½å‘¨æœŸï¼Œå³â€œåœ¨å½“å‰å‡½æ•°ä¸­æœ‰æ•ˆï¼Œåœ¨å‡½æ•°å¤–æ— æ•ˆâ€ã€‚è¿™ç§ç°è±¡å°±æ˜¯å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­çš„å‚æ•°å‹æ ˆï¼Œå †æ ˆå¹³è¡¡æ‰€å¸¦æ¥çš„ã€‚<strong>å †æ ˆå¹³è¡¡</strong>æ˜¯æŒ‡å‡½æ•°è°ƒå®Œæˆåï¼Œè¦è¿”è¿˜æ‰€æœ‰ä½¿ç”¨è¿‡çš„æ ˆç©ºé—´ã€‚</p><p>å‡½æ•°è°ƒç”¨å…¶å®å¯ä»¥çœ‹åš4ä¸ªè¿‡ç¨‹ï¼š</p><ol><li>å‹æ ˆ: å‡½æ•°å‚æ•°å‹æ ˆï¼Œè¿”å›åœ°å€å‹æ ˆ</li><li>è·³è½¬: è·³è½¬åˆ°å‡½æ•°æ‰€åœ¨ä»£ç å¤„æ‰§è¡Œ</li><li>æ‰§è¡Œ: æ‰§è¡Œå‡½æ•°ä»£ç </li><li>è¿”å›: å¹³è¡¡å †æ ˆï¼Œæ‰¾å‡ºä¹‹å‰çš„è¿”å›åœ°å€ï¼Œè·³è½¬å›ä¹‹å‰çš„è°ƒç”¨ç‚¹ä¹‹åï¼Œå®Œæˆå‡½æ•°è°ƒç”¨</li></ol><h3 id="è¡¨è¾¾å¼æ±‚å€¼"><a href="#è¡¨è¾¾å¼æ±‚å€¼" class="headerlink" title="è¡¨è¾¾å¼æ±‚å€¼"></a>è¡¨è¾¾å¼æ±‚å€¼</h3><p>ä»¥ <code>3 + 5 x 8 - 6</code> ä¸ºè¿™ä¸ªè¡¨è¾¾å¼ä¸ºä¾‹ï¼Œç¼–è¯‘å™¨æ˜¯å¦‚ä½•åˆ©ç”¨æ ˆæ¥å®ç°è¡¨è¾¾å¼æ±‚å€¼çš„å‘¢ï¼Ÿ</p><p>ç¼–è¯‘å™¨ä¼šä½¿ç”¨ä¸¤ä¸ªæ ˆæ¥å®ç°ï¼Œä¸€ä¸ªæ ˆç”¨æ¥ä¿å­˜æ“ä½œæ•°ï¼Œå¦ä¸€ä¸ªæ ˆç”¨æ¥ä¿å­˜è¿ç®—ç¬¦ã€‚ä»å·¦å‘å³éå†è¡¨è¾¾å¼ï¼Œé‡åˆ°æ•°å­—ç›´æ¥å‹å…¥æ“ä½œæ•°æ ˆï¼Œé‡åˆ°æ“ä½œç¬¦ï¼Œå°±ä¸è¿ç®—ç¬¦æ ˆé¡¶å…ƒç´ è¿›è¡Œæ¯”è¾ƒã€‚</p><p>å¦‚æœæ¯”è¿ç®—ç¬¦æ ˆé¡¶å…ƒç´ çš„ä¼˜å…ˆçº§é«˜ï¼Œå°±å°†å½“å‰è¿ç®—ç¬¦å‹å…¥æ ˆï¼›å¦‚æœæ¯”è¿ç®—ç¬¦æ ˆé¡¶å…ƒç´ çš„ä¼˜å…ˆçº§ä½æˆ–è€…ç›¸åŒï¼Œä»è¿ç®—ç¬¦æ ˆä¸­å–æ ˆé¡¶è¿ç®—ç¬¦ï¼Œä»æ“ä½œæ•°æ ˆçš„æ ˆé¡¶å– 2 ä¸ªæ“ä½œæ•°ï¼Œç„¶åè¿›è¡Œè®¡ç®—ï¼Œå†æŠŠè®¡ç®—å®Œçš„ç»“æœå‹å…¥æ“ä½œæ•°æ ˆï¼Œç»§ç»­æ¯”è¾ƒã€‚</p><p>å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://img.i7years.com/blog/bc77c8d33375750f1700eb7778551600.jpg" alt="bc77c8d33375750f1700eb7778551600"></p><p>æ­¤å‰ï¼Œæˆ‘ä»¬åœ¨è®² <a href="https://wangwei.one/posts/build-blockchain-in-java-transaction-script.html">æ¯”ç‰¹å¸è„šæœ¬è¯­è¨€</a> æ—¶ï¼Œæåˆ°è¿‡ <strong>é€†æ³¢å…°è¡¨ç¤ºæ³•</strong> ï¼Œä¹Ÿæ˜¯è¿ç”¨äº†æ ˆè¿™ç§æ•°æ®ç»“æ„ç‰¹å¾ã€‚</p><h4 id="ç»ƒä¹ "><a href="#ç»ƒä¹ " class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h4><blockquote><p>Leetcode 224. <a href="https://leetcode.com/problems/basic-calculator/" target="_blank" rel="noopener">Basic Calculator</a></p></blockquote><p>é¢˜ç›®å…·ä½“çš„åˆ†æï¼Œæˆ‘æ”¾åœ¨äº†å•ç‹¬çš„æ–‡ç« ä¸­ï¼ŒğŸ‘‰ <a href="https://wangwei.one/posts/algoDS-java-leetcode-224-basic-calculator.html">æˆ³æ­¤æŸ¥çœ‹</a> ã€‚</p><h3 id="æ‹¬å·åŒ¹é…"><a href="#æ‹¬å·åŒ¹é…" class="headerlink" title="æ‹¬å·åŒ¹é…"></a>æ‹¬å·åŒ¹é…</h3><p>æ ˆè¿˜å¯ä»¥ç”¨æ¥æ£€æµ‹è¡¨è¾¾å¼ä¸­çš„æ‹¬å·æ˜¯å¦åŒ¹é…ã€‚</p><p>æˆ‘ä»¬å‡è®¾è¡¨è¾¾å¼ä¸­åªåŒ…å«ä¸‰ç§æ‹¬å·ï¼Œåœ†æ‹¬å· ()ã€æ–¹æ‹¬å· [] å’ŒèŠ±æ‹¬å·{}ï¼Œå¹¶ä¸”å®ƒä»¬å¯ä»¥ä»»æ„åµŒå¥—ã€‚æ¯”å¦‚ï¼Œ{[{}]}æˆ– [{()}([])] ç­‰éƒ½ä¸ºåˆæ³•æ ¼å¼ï¼Œè€Œ{[}()] æˆ– [({)] ä¸ºä¸åˆæ³•çš„æ ¼å¼ã€‚é‚£æˆ‘ç°åœ¨ç»™ä½ ä¸€ä¸ªåŒ…å«ä¸‰ç§æ‹¬å·çš„è¡¨è¾¾å¼å­—ç¬¦ä¸²ï¼Œå¦‚ä½•æ£€æŸ¥å®ƒæ˜¯å¦åˆæ³•å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬ç”¨æ ˆæ¥ä¿å­˜æœªåŒ¹é…çš„å·¦æ‹¬å·ï¼Œä»å·¦åˆ°å³ä¾æ¬¡æ‰«æå­—ç¬¦ä¸²ã€‚å½“æ‰«æåˆ°å·¦æ‹¬å·æ—¶ï¼Œåˆ™å°†å…¶å‹å…¥æ ˆä¸­ï¼›å½“æ‰«æåˆ°å³æ‹¬å·æ—¶ï¼Œä»æ ˆé¡¶å–å‡ºä¸€ä¸ªå·¦æ‹¬å·ã€‚å¦‚æœèƒ½å¤ŸåŒ¹é…ï¼Œæ¯”å¦‚â€œ(â€è·Ÿâ€œ)â€åŒ¹é…ï¼Œâ€œ[â€è·Ÿâ€œ]â€åŒ¹é…ï¼Œâ€œ{â€è·Ÿâ€œ}â€åŒ¹é…ï¼Œåˆ™ç»§ç»­æ‰«æå‰©ä¸‹çš„å­—ç¬¦ä¸²ã€‚å¦‚æœæ‰«æçš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°ä¸èƒ½é…å¯¹çš„å³æ‹¬å·ï¼Œæˆ–è€…æ ˆä¸­æ²¡æœ‰æ•°æ®ï¼Œåˆ™è¯´æ˜ä¸ºéæ³•æ ¼å¼ã€‚</p><p>å½“æ‰€æœ‰çš„æ‹¬å·éƒ½æ‰«æå®Œæˆä¹‹åï¼Œå¦‚æœæ ˆä¸ºç©ºï¼Œåˆ™è¯´æ˜å­—ç¬¦ä¸²ä¸ºåˆæ³•æ ¼å¼ï¼›å¦åˆ™ï¼Œè¯´æ˜æœ‰æœªåŒ¹é…çš„å·¦æ‹¬å·ï¼Œä¸ºéæ³•æ ¼å¼ã€‚</p><h4 id="ç»ƒä¹ -1"><a href="#ç»ƒä¹ -1" class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h4><blockquote><p>Leetcode 20. <a href="https://leetcode.com/problems/valid-parentheses/" target="_blank" rel="noopener">Valid Parentheses</a></p></blockquote><p>æˆ‘è‡ªå·±åœ¨åšè¿™é“é¢˜æ—¶ï¼Œè™½è¯´åšå¯¹äº†ï¼Œä½†æ˜¯æ²¡æœ‰åƒä¸‹é¢çš„ä»£ç é‚£æ ·é‡‡ç”¨Mapå­˜å‚¨æ‹¬å·çš„å¯¹åº”å…³ç³»ï¼Œå¯¼è‡´ä»£ç éå¸¸è‡ƒè‚¿éš¾å ªã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Hash table that takes care of the mappings.</span></span><br><span class="line">  <span class="keyword">private</span> HashMap&lt;Character, Character&gt; mappings;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Initialize hash map with mappings. This simply makes the code easier to read.</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Solution</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.mappings = <span class="keyword">new</span> HashMap&lt;Character, Character&gt;();</span><br><span class="line">    <span class="keyword">this</span>.mappings.put(<span class="string">')'</span>, <span class="string">'('</span>);</span><br><span class="line">    <span class="keyword">this</span>.mappings.put(<span class="string">'&#125;'</span>, <span class="string">'&#123;'</span>);</span><br><span class="line">    <span class="keyword">this</span>.mappings.put(<span class="string">']'</span>, <span class="string">'['</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Initialize a stack to be used in the algorithm.</span></span><br><span class="line">    Stack&lt;Character&gt; stack = <span class="keyword">new</span> Stack&lt;Character&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">      <span class="keyword">char</span> c = s.charAt(i);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// If the current character is a closing bracket.</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.mappings.containsKey(c)) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get the top element of the stack. If the stack is empty, set a dummy value of '#'</span></span><br><span class="line">        <span class="keyword">char</span> topElement = stack.empty() ? <span class="string">'#'</span> : stack.pop();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// If the mapping for this bracket doesn't match the stack's top element, return false.</span></span><br><span class="line">        <span class="keyword">if</span> (topElement != <span class="keyword">this</span>.mappings.get(c)) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// If it was an opening bracket, push to the stack.</span></span><br><span class="line">        stack.push(c);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If the stack still contains elements, then it is an invalid expression.</span></span><br><span class="line">    <span class="keyword">return</span> stack.isEmpty();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµè§ˆå™¨çš„å‰è¿›ã€åé€€"><a href="#æµè§ˆå™¨çš„å‰è¿›ã€åé€€" class="headerlink" title="æµè§ˆå™¨çš„å‰è¿›ã€åé€€"></a>æµè§ˆå™¨çš„å‰è¿›ã€åé€€</h3><p>ä½¿ç”¨ä¸¤ä¸ªæ ˆï¼ŒX å’Œ Yï¼ŒæŠŠé¦–æ¬¡æµè§ˆçš„é¡µé¢ä¾æ¬¡å‹å…¥æ ˆ Xï¼Œå½“ç‚¹å‡»åé€€æŒ‰é’®æ—¶ï¼Œå†ä¾æ¬¡ä»æ ˆ X ä¸­å‡ºæ ˆï¼Œå¹¶å°†å‡ºæ ˆçš„æ•°æ®ä¾æ¬¡æ”¾å…¥æ ˆ Yã€‚å½“æˆ‘ä»¬ç‚¹å‡»å‰è¿›æŒ‰é’®æ—¶ï¼Œæˆ‘ä»¬ä¾æ¬¡ä»æ ˆ Y ä¸­å–å‡ºæ•°æ®ï¼Œæ”¾å…¥æ ˆ X ä¸­ã€‚å½“æ ˆ X ä¸­æ²¡æœ‰æ•°æ®æ—¶ï¼Œé‚£å°±è¯´æ˜æ²¡æœ‰é¡µé¢å¯ä»¥ç»§ç»­åé€€æµè§ˆäº†ã€‚å½“æ ˆ Y ä¸­æ²¡æœ‰æ•°æ®ï¼Œé‚£å°±è¯´æ˜æ²¡æœ‰é¡µé¢å¯ä»¥ç‚¹å‡»å‰è¿›æŒ‰é’®æµè§ˆäº†ã€‚</p><p>æ¯”å¦‚ä½ é¡ºåºæŸ¥çœ‹äº† aï¼Œbï¼Œc ä¸‰ä¸ªé¡µé¢ï¼Œæˆ‘ä»¬å°±ä¾æ¬¡æŠŠ aï¼Œbï¼Œc å‹å…¥æ ˆï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä¸¤ä¸ªæ ˆçš„æ•°æ®å°±æ˜¯è¿™ä¸ªæ ·å­ï¼š</p><p><img src="https://img.i7years.com/blog/4b579a76ea7ebfc5abae2ad6ae6a3c3d.jpg" alt="4b579a76ea7ebfc5abae2ad6ae6a3c3d"></p><p>å½“ä½ é€šè¿‡æµè§ˆå™¨çš„åé€€æŒ‰é’®ï¼Œä»é¡µé¢ c åé€€åˆ°é¡µé¢ a ä¹‹åï¼Œæˆ‘ä»¬å°±ä¾æ¬¡æŠŠ c å’Œ b ä»æ ˆ X ä¸­å¼¹å‡ºï¼Œå¹¶ä¸”ä¾æ¬¡æ”¾å…¥åˆ°æ ˆ Yã€‚è¿™ä¸ªæ—¶å€™ï¼Œä¸¤ä¸ªæ ˆçš„æ•°æ®å°±æ˜¯è¿™ä¸ªæ ·å­ï¼š<img src="https://img.i7years.com/blog/b5e496e2e28fe08f0388958a0e12861b.jpg" alt="b5e496e2e28fe08f0388958a0e12861b"></p><p>è¿™ä¸ªæ—¶å€™ä½ åˆæƒ³çœ‹é¡µé¢ bï¼Œäºæ˜¯ä½ åˆç‚¹å‡»å‰è¿›æŒ‰é’®å›åˆ° b é¡µé¢ï¼Œæˆ‘ä»¬å°±æŠŠ b å†ä»æ ˆ Y ä¸­å‡ºæ ˆï¼Œæ”¾å…¥æ ˆ X ä¸­ã€‚æ­¤æ—¶ä¸¤ä¸ªæ ˆçš„æ•°æ®æ˜¯è¿™ä¸ªæ ·å­ï¼š</p><p><img src="https://img.i7years.com/blog/ea804125bea25d25ba467a51fb98c4bc.jpg" alt="ea804125bea25d25ba467a51fb98c4bc"></p><p>è¿™ä¸ªæ—¶å€™ï¼Œä½ é€šè¿‡é¡µé¢ b åˆè·³è½¬åˆ°æ–°çš„é¡µé¢ d äº†ï¼Œé¡µé¢ c å°±æ— æ³•å†é€šè¿‡å‰è¿›ã€åé€€æŒ‰é’®é‡å¤æŸ¥çœ‹äº†ï¼Œæ‰€ä»¥éœ€è¦æ¸…ç©ºæ ˆ Yã€‚æ­¤æ—¶ä¸¤ä¸ªæ ˆçš„æ•°æ®è¿™ä¸ªæ ·å­ï¼š</p><p><img src="https://img.i7years.com/blog/a3c926fe3050d9a741f394f20430692e.jpg" alt="a3c926fe3050d9a741f394f20430692e"></p><p>å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨<strong>åŒå‘é“¾è¡¨</strong>æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚</p><h2 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h2><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒJVM å†…å­˜ç®¡ç†ä¸­æœ‰ä¸ªâ€œå †æ ˆâ€çš„æ¦‚å¿µã€‚æ ˆå†…å­˜ç”¨æ¥å­˜å‚¨å±€éƒ¨å˜é‡å’Œæ–¹æ³•è°ƒç”¨ï¼Œå †å†…å­˜ç”¨æ¥å­˜å‚¨ Java ä¸­çš„å¯¹è±¡ã€‚é‚£ JVM é‡Œé¢çš„â€œæ ˆâ€è·Ÿæœ¬ç¯‡è¯´çš„â€œæ ˆâ€æ˜¯ä¸æ˜¯ä¸€å›äº‹å‘¢ï¼Ÿå¦‚æœä¸æ˜¯ï¼Œé‚£å®ƒä¸ºä»€ä¹ˆåˆå«ä½œâ€œæ ˆâ€å‘¢ï¼Ÿ</p><p>æœ¬ç¯‡ä»‹ç»çš„æ ˆæ˜¯ä¸€ç§æŠ½è±¡çš„æ•°æ®ç»“æ„ï¼Œè€ŒJVMä¸­çš„â€å †æ ˆâ€æ˜¯ä¸€ç§å®é™…å­˜åœ¨çš„ç‰©ç†ç»“æ„ï¼Œæœ‰å…³JVMå †æ ˆçš„äº†è§£ï¼Œå¯ä»¥çœ‹æˆ‘ä¹‹å‰çš„æ–‡ç« ï¼š<a href="https://wangwei.one/posts/java7-jvm-memory-model.html">https://wangwei.one/posts/java7-jvm-memory-model.html</a></p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li>ã€Š<a href="http://gk.link/a/101Nt" target="_blank" rel="noopener">æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾</a>ã€‹</li><li><a href="https://time.geekbang.org/column/article/41222" target="_blank" rel="noopener">https://time.geekbang.org/column/article/41222</a></li><li><a href="http://data.biancheng.net/view/9.html" target="_blank" rel="noopener">http://data.biancheng.net/view/9.html</a></li><li><a href="https://www.jianshu.com/p/594357dff57e" target="_blank" rel="noopener">https://www.jianshu.com/p/594357dff57e</a></li><li><a href="https://www.cnblogs.com/33debug/p/6773059.html" target="_blank" rel="noopener">https://www.cnblogs.com/33debug/p/6773059.html</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> AlgoDS </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æ•°æ®ç»“æ„ä¸ç®—æ³• | Leetcode 876. middle-of-the-linked-list]]></title>
      <url>/posts/java-algoDS-middle-of-the-linked-list.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/pexels-photo-1563356.jpeg?imageslim" alt=""></p><p>å‰é¢ï¼Œæˆ‘ä»¬å®ç°äº† <a href="https://wangwei.one/posts/java-algoDS-Remove-Nth-Node-From-End-of-List.html">åˆ é™¤å•é“¾è¡¨å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹</a> æ“ä½œï¼Œæœ¬ç¯‡æ¥èŠèŠï¼Œå¦‚ä½•æ±‚ä¸€ä¸ªé“¾è¡¨çš„ä¸­é—´èŠ‚ç‚¹ã€‚</p><a id="more"></a><h2 id="æ±‚é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹"><a href="#æ±‚é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹" class="headerlink" title="æ±‚é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹"></a>æ±‚é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹</h2><blockquote><p><a href="https://leetcode.com/problems/middle-of-the-linked-list/" target="_blank" rel="noopener">Leetcode 876. Middle of the Linked List</a></p></blockquote><p>ç»™å®šä¸€ä¸ªéç©ºçš„å•é“¾è¡¨ï¼Œè¦æ±‚è¿”å›å®ƒçš„ä¸­é—´èŠ‚ç‚¹ï¼Œå¦‚æœä¸­é—´èŠ‚ç‚¹æœ‰ä¸¤ä¸ªåˆ™è¿”å›ç¬¬äºŒä¸ªã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: [1,2,3,4,5]</span><br><span class="line">Output: Node 3 from this list</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: [1,2,3,4,5,6]</span><br><span class="line">Output: Node 4 from this list</span><br></pre></td></tr></table></figure><h3 id="è§£æ³•ä¸€"><a href="#è§£æ³•ä¸€" class="headerlink" title="è§£æ³•ä¸€"></a>è§£æ³•ä¸€</h3><p>ç¬¬ä¸€ç§è§£æ³•çš„æ€è·¯æ¯”è¾ƒå®¹æ˜“æƒ³å¾—åˆ°ï¼Œå…ˆè®¡ç®—å‡ºé“¾è¡¨çš„æ€»é•¿åº¦ï¼Œå†è®¡ç®—å‡ºä¸­é—´èŠ‚ç‚¹çš„ä¸‹æ ‡ï¼Œç„¶åå¾—éå†å¾—åˆ°å¯¹åº”çš„èŠ‚ç‚¹å³å¯ã€‚</p><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * public class ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) &#123; val = x; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListNode <span class="title">middleNode</span><span class="params">(ListNode head)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(head == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(ListNode curr = head; curr != <span class="keyword">null</span>; )&#123;</span><br><span class="line">            len++;</span><br><span class="line">            curr = curr.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> targetIndex = <span class="number">0</span>;</span><br><span class="line">        ListNode target = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span>(ListNode curr = head; curr != <span class="keyword">null</span>; )&#123;</span><br><span class="line">            <span class="keyword">if</span>(targetIndex == len / <span class="number">2</span>)&#123;</span><br><span class="line">                target = curr;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            targetIndex++;</span><br><span class="line">            curr = curr.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> target;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è§£æ³•äºŒ"><a href="#è§£æ³•äºŒ" class="headerlink" title="è§£æ³•äºŒ"></a>è§£æ³•äºŒ</h3><p>ç¬¬äºŒç§è§£æ³•ï¼Œä½¿ç”¨å¿«æ…¢æŒ‡é’ˆï¼Œè®©å¿«æŒ‡é’ˆçš„ç§»åŠ¨é€Ÿåº¦æ˜¯æ…¢æŒ‡é’ˆçš„ä¸¤å€ï¼Œç­‰åˆ°å¿«æŒ‡é’ˆåˆ°è¾¾ç»ˆç‚¹æ—¶ï¼Œæ…¢æŒ‡é’ˆæ°å¥½æŠµè¾¾ä¸­é—´èŠ‚ç‚¹ã€‚</p><blockquote><p>ä¸€æ®µå°è·¯ä¸Šï¼ŒAè½¦è¡Œé©¶çš„é€Ÿåº¦æ˜¯Bè½¦çš„ä¸¤å€ï¼Œç­‰åˆ°Aè½¦åˆ°è¾¾ç»ˆç‚¹æ—¶ï¼ŒBè½¦æ°å¥½è¾¾åˆ°å°è·¯çš„ä¸­é—´ä½ç½®ã€‚</p></blockquote><h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * public class ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) &#123; val = x; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListNode <span class="title">middleNode</span><span class="params">(ListNode head)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(head == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        ListNode slow = head;</span><br><span class="line">        ListNode fast = head;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(ListNode curr = slow; slow != <span class="keyword">null</span>; )&#123;               </span><br><span class="line">            <span class="keyword">if</span>(fast == <span class="keyword">null</span> || fast.next == <span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                fast = fast.next.next;</span><br><span class="line">            &#125;</span><br><span class="line">            slow = slow.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> slow;        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨å¿«æ…¢æŒ‡é’ˆè§£å†³ä¸‰ä¸ªå•é“¾è¡¨ç›¸å…³çš„é—®é¢˜äº†ï¼š</p><blockquote><p><a href="https://wangwei.one/posts/java-algoDS-linked-list-cycle.html">å•é“¾è¡¨ç¯æ£€æµ‹</a></p><p><a href="https://wangwei.one/posts/java-algoDS-Remove-Nth-Node-From-End-of-List.html">åˆ é™¤å•é“¾è¡¨å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹</a></p><p><a href="https://wangwei.one/posts/java-algoDS-middle-of-the-linked-list.html">æ±‚é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹</a></p></blockquote><h3 id="è§£æ³•ä¸‰"><a href="#è§£æ³•ä¸‰" class="headerlink" title="è§£æ³•ä¸‰"></a>è§£æ³•ä¸‰</h3><p>è§£æ³•ä¸‰ä¹Ÿæ¯”è¾ƒå·§å¦™ï¼Œ éå†å•é“¾è¡¨ï¼Œåªæœ‰å½“ä¸‹æ ‡ä¸ºå¥‡æ•°æ—¶ï¼ŒæŒ‡é’ˆæ‰å‘å‰ç§»åŠ¨ï¼Œåˆ°æœ€åï¼ŒæŒ‡é’ˆæ‰€æŒ‡å³ä¸ºä¸­é—´èŠ‚ç‚¹ã€‚</p><h4 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * public class ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) &#123; val = x; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListNode <span class="title">middleNode</span><span class="params">(ListNode head)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(head == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ListNode target = head;</span><br><span class="line">        <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(ListNode curr = head; curr != <span class="keyword">null</span>; )&#123;</span><br><span class="line">            <span class="keyword">if</span>(index % <span class="number">2</span> == <span class="number">1</span>)&#123;</span><br><span class="line">                target = target.next;</span><br><span class="line">            &#125;</span><br><span class="line">            index++;</span><br><span class="line">            curr = curr.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>  target;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä¸‰ç§è§£æ³•çš„æ—¶é—´å¤æ‚åº¦å‡ä¸ºO(n)ï¼Œåœ¨leetcodeä¸Šçš„è¿è¡Œæ—¶é—´ä¸º 1msï¼Œè¶…è¿‡ <code>82.96%</code> ã€‚</p><h2 id="ç›¸å…³ç»ƒä¹ "><a href="#ç›¸å…³ç»ƒä¹ " class="headerlink" title="ç›¸å…³ç»ƒä¹ "></a>ç›¸å…³ç»ƒä¹ </h2><ul><li><a href="https://wangwei.one/posts/java-algoDS-reverse-linked-list.html">é“¾è¡¨åè½¬</a></li><li><a href="https://wangwei.one/posts/java-algoDS-linked-list-cycle.html">é“¾è¡¨ç¯æ£€æµ‹</a></li><li><a href="https://wangwei.one/posts/java-algoDS-Merge-Two-Sorted-Linked-Lists.html">æœ‰åºé“¾è¡¨åˆå¹¶</a></li><li><a href="https://wangwei.one/posts/java-algoDS-Remove-Nth-Node-From-End-of-List.html">åˆ é™¤å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹</a></li><li><a href="https://wangwei.one/posts/java-algoDS-LRU-implement-by-linkedlist.html">LRUç®—æ³•å®ç°</a></li><li><a href="https://wangwei.one/posts/java-algoDS-palindrome-linked-list.html">å›æ–‡é“¾è¡¨æ£€æµ‹</a></li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li>ã€Š<a href="http://gk.link/a/101Nt" target="_blank" rel="noopener">æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾</a>ã€‹</li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> AlgoDS </tag>
            
            <tag> LeetCode </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æ•°æ®ç»“æ„ä¸ç®—æ³• | Leetcode 19. Remove Nth Node From End of List]]></title>
      <url>/posts/java-algoDS-Remove-Nth-Node-From-End-of-List.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/puppy-dog-cute-love-cat-mammal-727359-pxhere.com.jpg?imageslim" alt="puppy-dog-cute-love-cat-mammal"></p><p>å‰é¢ï¼Œæˆ‘ä»¬å®ç°äº† <a href="https://wangwei.one/posts/java-algoDS-Merge-Two-Sorted-Linked-Lists.html">ä¸¤ä¸ªæœ‰åºé“¾è¡¨çš„åˆå¹¶</a> æ“ä½œï¼Œæœ¬ç¯‡æ¥èŠèŠï¼Œå¦‚ä½•åˆ é™¤ä¸€ä¸ªé“¾è¡¨çš„å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹ã€‚</p><a id="more"></a><h2 id="åˆ é™¤å•é“¾è¡¨å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹"><a href="#åˆ é™¤å•é“¾è¡¨å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹" class="headerlink" title="åˆ é™¤å•é“¾è¡¨å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹"></a>åˆ é™¤å•é“¾è¡¨å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹</h2><blockquote><p><a href="https://leetcode.com/problems/remove-nth-node-from-end-of-list/" target="_blank" rel="noopener">Leetcode 19. Remove Nth Node From End of List</a></p></blockquote><p>ç»™å®šä¸€ä¸ªå•é“¾è¡¨ï¼Œå¦‚: <code>1-&gt;2-&gt;3-&gt;4-&gt;5</code>ï¼Œè¦æ±‚åˆ é™¤å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹ï¼Œå‡è®¾ <code>N = 2</code>ï¼Œå¹¶è¿”å›å¤´èŠ‚ç‚¹ã€‚</p><p>åˆ™è¿”å›ç»“æœï¼š<code>1-&gt;2-&gt;3-&gt;5</code> .</p><h3 id="è§£æ³•ä¸€"><a href="#è§£æ³•ä¸€" class="headerlink" title="è§£æ³•ä¸€"></a>è§£æ³•ä¸€</h3><p>è¿™ä¸€é¢˜çš„éš¾åº¦æ ‡è®°ä¸º <code>medium</code>ï¼Œè§£æ³•ä¸€æ¯”è¾ƒå®¹æ˜“æƒ³å‡ºæ¥ï¼Œæˆ‘ä¸ªäººè§‰å¾—éš¾åº¦ä¸å¤§ã€‚</p><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>å¾ªç¯ä¸¤éï¼š</p><ol><li>å…ˆéå†ä¸€éï¼Œæ±‚å¾—æ•´ä¸ªé“¾è¡¨çš„é•¿åº¦ã€‚</li><li>å†éå†ä¸€éï¼Œå½“æ€»é•¿åº¦<code>len</code>å‡å» <code>n</code> ï¼Œæ°å¥½ç­‰äºå¾ªç¯çš„ä¸‹æ ‡<code>i</code>æ—¶ï¼Œå°±æ‰¾åˆ°å¯¹åº”è¦åˆ é™¤çš„ç›®æ ‡å…ƒç´ ï¼Œå°†<code>prev</code>èŠ‚ç‚¹ä¸<code>next</code>èŠ‚ç‚¹è¿æ¥èµ·æ¥å³å¯ã€‚</li></ol><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * public class ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) &#123; val = x; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListNode <span class="title">removeNthFromEnd</span><span class="params">(ListNode head, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(head == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(ListNode curr = head ; curr != <span class="keyword">null</span>;)&#123;</span><br><span class="line">            len++;</span><br><span class="line">            curr = curr.next;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(len == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// remove head</span></span><br><span class="line">        <span class="keyword">if</span>(len == n)&#123;</span><br><span class="line">            <span class="keyword">return</span> head.next;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        ListNode prev = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(ListNode curr = head; curr != <span class="keyword">null</span>;)&#123;</span><br><span class="line">            i++;</span><br><span class="line">            prev = curr;</span><br><span class="line">            curr = curr.next;</span><br><span class="line">         </span><br><span class="line">            <span class="keyword">if</span>(i == (len - n))&#123;</span><br><span class="line">                prev.next = curr.next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Leetcodeæµ‹è¯•çš„è¿è¡Œæ—¶é—´ä¸º<code>6ms</code>ï¼Œè¶…è¿‡äº†<code>98.75%</code>çš„javaä»£ç ã€‚</p><h3 id="è§£æ³•äºŒ"><a href="#è§£æ³•äºŒ" class="headerlink" title="è§£æ³•äºŒ"></a>è§£æ³•äºŒ</h3><p>è¿™ç§è§£æ³•ï¼Œæ¯”è¾ƒå·§å¦™ï¼Œæ²¡æœ‰æƒ³å‡ºæ¥ï¼ŒæŸ¥äº†ç½‘ä¸Šçš„è§£æ³•ï¼Œæ€è·¯å¦‚ä¸‹ï¼š</p><h4 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>åªéœ€è¦å¾ªç¯ä¸€éï¼Œå®šä¹‰ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªå¿«æŒ‡é’ˆï¼Œä¸€ä¸ªæ…¢æŒ‡é’ˆï¼Œè®©å¿«æŒ‡é’ˆçš„å·§å¥½é¢†å…ˆäºæ…¢æŒ‡é’ˆ<code>n</code>æ­¥ã€‚å½“å¿«æŒ‡é’ˆåˆ°è¾¾tailèŠ‚ç‚¹æ—¶ï¼Œæ»¡æŒ‡é’ˆå·§å¥½å°±æ˜¯æˆ‘ä»¬éœ€è¦åˆ é™¤çš„ç›®æ ‡å…ƒç´ ã€‚</p><h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * public class ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) &#123; val = x; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListNode <span class="title">removeNthFromEnd</span><span class="params">(ListNode head, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(head == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ListNode fast = head;</span><br><span class="line">        ListNode slow = head;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">            fast = fast.next;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(fast == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> slow.next;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        ListNode prev = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span>(ListNode curr = slow; curr != <span class="keyword">null</span>; )&#123;</span><br><span class="line">            <span class="comment">// when fast arrived at tail, remove slow.</span></span><br><span class="line">            <span class="keyword">if</span>(fast == <span class="keyword">null</span>)&#123;</span><br><span class="line">                prev.next =  curr.next;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            prev = curr;</span><br><span class="line">            curr = curr.next;</span><br><span class="line">            <span class="comment">// move fast forward</span></span><br><span class="line">            fast = fast.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç åœ¨LeetCodeä¸Šçš„æµ‹è¯•ç»“æœä¸è§£æ³•ä¸€çš„ä¸€æ ·ã€‚</p><p>è¿™ç§è§£æ³•ä¸ä¹‹å‰çš„ <a href="https://wangwei.one/posts/java-algoDS-linked-list-cycle.html">é“¾è¡¨ç¯æ£€æµ‹</a> é¢˜ç›®ä¸­éƒ½ä½¿ç”¨åˆ°äº†å¿«æ…¢æŒ‡é’ˆï¼Œç”¨æ¥å®šä½ç‰¹å®šçš„å…ƒç´ ã€‚</p><h2 id="ç›¸å…³ç»ƒä¹ "><a href="#ç›¸å…³ç»ƒä¹ " class="headerlink" title="ç›¸å…³ç»ƒä¹ "></a>ç›¸å…³ç»ƒä¹ </h2><ul><li><a href="https://wangwei.one/posts/java-algoDS-reverse-linked-list.html">é“¾è¡¨åè½¬</a></li><li><a href="https://wangwei.one/posts/java-algoDS-linked-list-cycle.html">é“¾è¡¨ç¯æ£€æµ‹</a></li><li><a href="https://wangwei.one/posts/java-algoDS-Merge-Two-Sorted-Linked-Lists.html">æœ‰åºé“¾è¡¨åˆå¹¶</a></li><li><a href="https://wangwei.one/posts/java-algoDS-middle-of-the-linked-list.html">æ±‚é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹</a></li><li><a href="https://wangwei.one/posts/java-algoDS-LRU-implement-by-linkedlist.html">LRUç®—æ³•å®ç°</a></li><li><a href="https://wangwei.one/posts/java-algoDS-palindrome-linked-list.html">å›æ–‡é“¾è¡¨æ£€æµ‹</a></li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li>ã€Š<a href="http://gk.link/a/101Nt" target="_blank" rel="noopener">æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾</a>ã€‹</li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> AlgoDS </tag>
            
            <tag> LeetCode </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æ•°æ®ç»“æ„ä¸ç®—æ³• | Leetcode 21. Merge Two Sorted Lists]]></title>
      <url>/posts/java-algoDS-Merge-Two-Sorted-Linked-Lists.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/bicycle_journey-wallpaper-960x600.jpg?imageslim" alt="bicycle_journey-wallpaper"></p><p>å‰é¢ï¼Œæˆ‘ä»¬å®ç°äº†é“¾è¡¨çš„ <a href="https://wangwei.one/posts/java-algoDS-linked-list-cycle.html">ç¯æ£€æµ‹</a> æ“ä½œï¼Œæœ¬ç¯‡æ¥èŠèŠï¼Œå¦‚ä½•åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨ã€‚</p><a id="more"></a><h2 id="æœ‰åºé“¾è¡¨åˆå¹¶"><a href="#æœ‰åºé“¾è¡¨åˆå¹¶" class="headerlink" title="æœ‰åºé“¾è¡¨åˆå¹¶"></a>æœ‰åºé“¾è¡¨åˆå¹¶</h2><blockquote><p><a href="https://leetcode.com/problems/merge-two-sorted-lists/" target="_blank" rel="noopener">Leetcode 21. Merge Two Sorted Lists</a></p></blockquote><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 1-&gt;2-&gt;4, 1-&gt;3-&gt;4</span><br><span class="line">Output: 1-&gt;1-&gt;2-&gt;3-&gt;4-&gt;4</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨è™šå‡çš„HeadèŠ‚ç‚¹"><a href="#ä½¿ç”¨è™šå‡çš„HeadèŠ‚ç‚¹" class="headerlink" title="ä½¿ç”¨è™šå‡çš„HeadèŠ‚ç‚¹"></a>ä½¿ç”¨è™šå‡çš„HeadèŠ‚ç‚¹</h3><p>å®šä¹‰ä¸€ä¸ªä¸´æ—¶è™šå‡çš„HeadèŠ‚ç‚¹ï¼Œå†åˆ›å»ºä¸€ä¸ªæŒ‡å‘tailçš„æŒ‡é’ˆï¼Œä»¥ä¾¿äºåœ¨å°¾éƒ¨æ·»åŠ èŠ‚ç‚¹ã€‚</p><p>å¯¹ListNode1å’ŒListNode2åŒæ—¶è¿›è¡Œéå†ï¼Œæ¯”è¾ƒæ¯æ¬¡å–å‡ºæ¥çš„èŠ‚ç‚¹å¤§å°ï¼Œå¹¶ç»‘å®šåˆ°å‰é¢tailæŒ‡é’ˆä¸Šå»ï¼Œç›´åˆ°æœ€ç»ˆæ‰€æœ‰çš„å…ƒç´ å…¨éƒ¨éå†å®Œã€‚</p><p>æœ€åï¼Œè¿”å› <code>dummyNode.next</code> ï¼Œå³ä¸ºæ–°é“¾è¡¨çš„headèŠ‚ç‚¹ã€‚</p><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * public class ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) &#123; val = x; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListNode <span class="title">mergeTwoLists</span><span class="params">(ListNode l1, ListNode l2)</span> </span>&#123;</span><br><span class="line">        ListNode dummyNode = <span class="keyword">new</span> ListNode(<span class="number">0</span>);</span><br><span class="line">        ListNode tail = dummyNode;  </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(l1 == <span class="keyword">null</span>)&#123;</span><br><span class="line">                tail.next = l2;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(l2 == <span class="keyword">null</span>)&#123;</span><br><span class="line">                tail.next = l1;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            ListNode next1 = l1;</span><br><span class="line">            ListNode next2 = l2;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(next1.val &lt;= next2.val)&#123;</span><br><span class="line">                tail.next = next1;</span><br><span class="line">                l1 = l1.next;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                tail.next = next2;</span><br><span class="line">                l2 = l2.next;</span><br><span class="line">            &#125; </span><br><span class="line">            tail = tail.next;</span><br><span class="line">        &#125;        </span><br><span class="line">        <span class="keyword">return</span> dummyNode.next;       </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é€’å½’"><a href="#é€’å½’" class="headerlink" title="é€’å½’"></a>é€’å½’</h3><p>ä½¿ç”¨é€’å½’çš„æ–¹å¼ï¼Œä»£ç æ¯”éå†çœ‹ä¸Šå»ç®€æ´å¾ˆå¤šï¼Œä½†æ˜¯å®ƒæ‰€å ç”¨çš„æ ˆç©ºé—´ä¼šéšç€é“¾è¡¨èŠ‚ç‚¹æ•°é‡çš„å¢åŠ è€Œå¢åŠ ã€‚</p><h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * public class ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) &#123; val = x; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    	</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListNode <span class="title">mergeTwoLists</span><span class="params">(ListNode l1, ListNode l2)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        ListNode result = <span class="keyword">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(l1 == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> l2;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(l2 == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> l1;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(l1.val &lt;= l2.val)&#123;</span><br><span class="line">            result = l1;</span><br><span class="line">            result.next = mergeTwoLists(l1.next, l2);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            result = l2;</span><br><span class="line">            result.next = mergeTwoLists(l1, l2.next);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç›¸å…³ç»ƒä¹ "><a href="#ç›¸å…³ç»ƒä¹ " class="headerlink" title="ç›¸å…³ç»ƒä¹ "></a>ç›¸å…³ç»ƒä¹ </h2><ul><li><a href="https://wangwei.one/posts/java-algoDS-reverse-linked-list.html">é“¾è¡¨åè½¬</a></li><li><a href="https://wangwei.one/posts/java-algoDS-linked-list-cycle.html">é“¾è¡¨ç¯æ£€æµ‹</a></li><li><a href="https://wangwei.one/posts/java-algoDS-Remove-Nth-Node-From-End-of-List.html">åˆ é™¤å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹</a></li><li><a href="https://wangwei.one/posts/java-algoDS-middle-of-the-linked-list.html">æ±‚é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹</a></li><li><a href="https://wangwei.one/posts/java-algoDS-LRU-implement-by-linkedlist.html">LRUç®—æ³•å®ç°</a></li><li><a href="https://wangwei.one/posts/java-algoDS-palindrome-linked-list.html">å›æ–‡é“¾è¡¨æ£€æµ‹</a></li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li>ã€Š<a href="http://gk.link/a/101Nt" target="_blank" rel="noopener">æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾</a>ã€‹</li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> AlgoDS </tag>
            
            <tag> LeetCode </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æ•°æ®ç»“æ„ä¸ç®—æ³• | Leetcode 141. Linked List Cycle]]></title>
      <url>/posts/java-algoDS-linked-list-cycle.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/pexels-photo-589810.jpeg?imageslim" alt="pexels-photo-589810"></p><p>å‰é¢ï¼Œæˆ‘ä»¬å®ç°äº†é“¾è¡¨çš„ <a href="https://wangwei.one/posts/java-algoDS-reverse-linked-list.html">åè½¬</a> æ“ä½œï¼Œæœ¬ç¯‡æ¥èŠèŠï¼Œå¦‚ä½•æ£€æµ‹å•é“¾è¡¨ä¸­çš„ç¯ã€‚</p><a id="more"></a><h2 id="å•é“¾è¡¨ç¯æ£€æµ‹"><a href="#å•é“¾è¡¨ç¯æ£€æµ‹" class="headerlink" title="å•é“¾è¡¨ç¯æ£€æµ‹"></a>å•é“¾è¡¨ç¯æ£€æµ‹</h2><blockquote><p><a href="https://leetcode.com/problems/linked-list-cycle/" target="_blank" rel="noopener">Leetcode 141. Linked List Cycle</a></p></blockquote><p>æœ‰ä¸¤ç§æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p><h3 id="ä½¿ç”¨Hashing"><a href="#ä½¿ç”¨Hashing" class="headerlink" title="ä½¿ç”¨Hashing"></a>ä½¿ç”¨Hashing</h3><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>å®šä¹‰ä¸€ä¸ªMapï¼Œå½“å¾ªç¯éå†Linked Listæ—¶ï¼Œä¾æ¬¡å°†Nodeæ”¾å…¥Mapä¸­ï¼Œç­‰åˆ°å¾ªç¯åˆ°ä¸‹ä¸€è½®æ—¶ï¼Œæ£€æŸ¥Nodeæ˜¯å¦å­˜åœ¨äºMapä¸­ï¼Œè‹¥å­˜åœ¨åˆ™è¡¨ç¤ºæœ‰ç¯å­˜åœ¨ã€‚</p><h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * class ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) &#123;</span></span><br><span class="line"><span class="comment"> *         val = x;</span></span><br><span class="line"><span class="comment"> *         next = null;</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasCycle</span><span class="params">(ListNode head)</span> </span>&#123;</span><br><span class="line">        Map map = <span class="keyword">new</span> IdentityHashMap();</span><br><span class="line">        <span class="keyword">for</span>(ListNode x = head; x != <span class="keyword">null</span>;)&#123;</span><br><span class="line">            <span class="keyword">if</span>(map.containsKey(x))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            map.put(x, <span class="keyword">null</span>);</span><br><span class="line">            x = x.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Floydåˆ¤åœˆç®—æ³•"><a href="#Floydåˆ¤åœˆç®—æ³•" class="headerlink" title="Floydåˆ¤åœˆç®—æ³•"></a>Floydåˆ¤åœˆç®—æ³•</h3><p>è¿™ä¸€ç§æ–¹æ³•ï¼Œä¸ä¸Šç½‘æŸ¥èµ„æ–™æ˜¯æ€ä¹ˆä¹Ÿæƒ³ä¸åˆ°çš„ï¼Œéå¸¸å·§å¦™ï¼ï¼ï¼</p><blockquote><p><a href="https://zh.wikipedia.org/wiki/Floyd%E5%88%A4%E5%9C%88%E7%AE%97%E6%B3%95" target="_blank" rel="noopener">Floydåˆ¤åœˆç®—æ³•</a></p><p>å¦‚æœæœ‰é™çŠ¶æ€æœºã€è¿­ä»£å‡½æ•°æˆ–è€…é“¾è¡¨ä¸Šå­˜åœ¨ç¯ï¼Œé‚£ä¹ˆåœ¨æŸä¸ªç¯ä¸Šä»¥ä¸åŒé€Ÿåº¦å‰è¿›çš„2ä¸ª<a href="https://zh.wikipedia.org/wiki/%E6%8C%87%E9%92%88_(%E4%BF%A1%E6%81%AF%E5%AD%A6" target="_blank" rel="noopener">æŒ‡é’ˆ</a>)å¿…å®šä¼šåœ¨æŸä¸ªæ—¶åˆ»ç›¸é‡ã€‚åŒæ—¶æ˜¾ç„¶åœ°ï¼Œå¦‚æœä»åŒä¸€ä¸ªèµ·ç‚¹(å³ä½¿è¿™ä¸ªèµ·ç‚¹ä¸åœ¨æŸä¸ªç¯ä¸Š)åŒæ—¶å¼€å§‹ä»¥ä¸åŒé€Ÿåº¦å‰è¿›çš„2ä¸ªæŒ‡é’ˆæœ€ç»ˆç›¸é‡ï¼Œé‚£ä¹ˆå¯ä»¥åˆ¤å®šå­˜åœ¨ä¸€ä¸ªç¯ï¼Œä¸”å¯ä»¥æ±‚å‡º2è€…ç›¸é‡å¤„æ‰€åœ¨çš„ç¯çš„èµ·ç‚¹ä¸é•¿åº¦ã€‚</p></blockquote><p>ä»Linked Listçš„HeadèŠ‚ç‚¹å‡ºå‘ï¼Œæˆ‘ä»¬å®šä¹‰ä¸¤ä¸ªç§»åŠ¨æŒ‡é’ˆï¼Œä¸€ä¸ªçš„ç§»åŠ¨é€Ÿåº¦ä¸ºæ¯æ¬¡å‰è¿›ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦ä¸€ä¸ªæ¯æ¬¡å‰è¿›ä¸¤ä¸ªèŠ‚ç‚¹ã€‚ç„¶ååˆ¤æ–­è¿™ä¸¤ä¸ªæŒ‡é’ˆç§»åŠ¨åçš„ç»“æœæ˜¯å¦ç›¸ç­‰ã€‚</p><blockquote><p>è¿™å°±ç±»ä¼¼äºä¸¤ä¸ªäººåœ¨æ“åœºä¸Šçš„è·‘æ­¥ä¸€æ ·ï¼Œä¸€ä¸ªå¿«ï¼Œä¸€ä¸ªæ…¢ï¼Œä»–ä»¬æ€»ä¼šåœ¨æŸä¸€ä¸ªä½ç½®ç›¸é‡ã€‚</p></blockquote><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * class ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) &#123;</span></span><br><span class="line"><span class="comment"> *         val = x;</span></span><br><span class="line"><span class="comment"> *         next = null;</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasCycle</span><span class="params">(ListNode head)</span> </span>&#123;</span><br><span class="line">        ListNode slow = head;</span><br><span class="line">        ListNode fast = head;</span><br><span class="line">        <span class="keyword">while</span>(fast != <span class="keyword">null</span> &amp;&amp; fast.next != <span class="keyword">null</span>)&#123;</span><br><span class="line">            slow = slow.next;</span><br><span class="line">            fast = fast.next.next;</span><br><span class="line">            <span class="keyword">if</span>(slow == fast)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ç§æ–¹å¼çš„æ—¶é—´å¤æ‚åº¦å‡ä¸ºO(n)ï¼Œç©ºé—´å¤æ‚åº¦å‡ä¸ºO(1).</p><h2 id="ç›¸å…³ç»ƒä¹ "><a href="#ç›¸å…³ç»ƒä¹ " class="headerlink" title="ç›¸å…³ç»ƒä¹ "></a>ç›¸å…³ç»ƒä¹ </h2><ul><li><a href="https://wangwei.one/posts/java-algoDS-reverse-linked-list.html">é“¾è¡¨åè½¬</a></li><li><a href="https://wangwei.one/posts/java-algoDS-Merge-Two-Sorted-Linked-Lists.html">æœ‰åºé“¾è¡¨åˆå¹¶</a></li><li><a href="https://wangwei.one/posts/java-algoDS-Remove-Nth-Node-From-End-of-List.html">åˆ é™¤å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹</a></li><li><a href="https://wangwei.one/posts/java-algoDS-middle-of-the-linked-list.html">æ±‚é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹</a></li><li><a href="https://wangwei.one/posts/java-algoDS-LRU-implement-by-linkedlist.html">LRUç®—æ³•å®ç°</a></li><li><a href="https://wangwei.one/posts/java-algoDS-palindrome-linked-list.html">å›æ–‡é“¾è¡¨æ£€æµ‹</a></li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://www.geeksforgeeks.org/detect-loop-in-a-linked-list/" target="_blank" rel="noopener">https://www.geeksforgeeks.org/detect-loop-in-a-linked-list/</a></li><li><a href="https://marcin-chwedczuk.github.io/find-cycle-start-in-singly-linked-list" target="_blank" rel="noopener">https://marcin-chwedczuk.github.io/find-cycle-start-in-singly-linked-list</a></li><li><a href="https://zh.wikipedia.org/wiki/Floyd%E5%88%A4%E5%9C%88%E7%AE%97%E6%B3%95" target="_blank" rel="noopener">Floydåˆ¤åœˆç®—æ³•</a></li><li>ã€Š<a href="http://gk.link/a/101Nt" target="_blank" rel="noopener">æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾</a>ã€‹</li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> AlgoDS </tag>
            
            <tag> LeetCode </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æ•°æ®ç»“æ„ä¸ç®—æ³• | Leetcode 206. Reverse Linked List]]></title>
      <url>/posts/java-algoDS-reverse-linked-list.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/62466_miscellaneous_small_mountain_village.jpg?imageslim" alt="pexels-photo-356807"></p><p>å‰é¢æˆ‘ä»¬å®ç°äº†å‡ ç§å¸¸è§çš„ <a href="https://wangwei.one/java-data-structures-and-algorithms-linkedlist.html">é“¾è¡¨</a> ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥èŠèŠå¦‚ä½•å®ç° <a href="https://github.com/wangweiX/java-algorithms/blob/master/src/main/java/one/wangwei/algorithms/datastructures/list/impl/SingleLinkedList.java" target="_blank" rel="noopener">å•é“¾è¡¨</a> çš„åè½¬ã€‚</p><a id="more"></a><h2 id="é“¾è¡¨åè½¬"><a href="#é“¾è¡¨åè½¬" class="headerlink" title="é“¾è¡¨åè½¬"></a>é“¾è¡¨åè½¬</h2><blockquote><p><a href="https://leetcode.com/problems/reverse-linked-list/" target="_blank" rel="noopener">Leetcode 206: Reverse Linked List</a></p></blockquote><p>ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Input: 1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;NULL</span><br><span class="line">Output: 5-&gt;4-&gt;3-&gt;2-&gt;1-&gt;NULL</span><br><span class="line"></span><br><span class="line">Input: NULL</span><br><span class="line">Output: NULL</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å¾ªç¯éå†å’Œé€’å½’è¿™ä¸¤ç§æ–¹å¼æ¥å®ç°é“¾è¡¨çš„åè½¬ã€‚</p><h3 id="éå†"><a href="#éå†" class="headerlink" title="éå†"></a>éå†</h3><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>å®šä¹‰ä¸‰ä¸ªæŒ‡é’ˆï¼Œåˆ†åˆ«ä¸ºprevã€currã€nextï¼Œç„¶åéå†æ‰€æœ‰nodeç»“ç‚¹ï¼Œå¹¶ç§»åŠ¨è¿™ä¸‰ä¸ªæŒ‡é’ˆï¼Œæ”¹å˜currç»“ç‚¹çš„nextæŒ‡å‘ï¼ŒæŒ‡å‘prevç»“ç‚¹ï¼Œå®ç°linkedListçš„åè½¬ã€‚</p><p><img src="https://img.i7years.com/blog/LinkedList-Reverse-Iteratively&amp;.gif" alt="LinkedList-Reverse-Iteratively"></p><h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * public class ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) &#123; val = x; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListNode <span class="title">reverseList</span><span class="params">(ListNode head)</span> </span>&#123;</span><br><span class="line">        ListNode prev = <span class="keyword">null</span>;</span><br><span class="line">        ListNode curr = head;</span><br><span class="line">        ListNode next = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">while</span>(curr != <span class="keyword">null</span>)&#123;</span><br><span class="line">            next = curr.next;</span><br><span class="line">            curr.next = prev;        </span><br><span class="line">            prev = curr;</span><br><span class="line">            curr = next;</span><br><span class="line">        &#125;</span><br><span class="line">        head = prev;</span><br><span class="line">        <span class="keyword">return</span> head; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/wangweiX/java-algorithms/blob/master/src/main/java/one/wangwei/algorithms/datastructures/list/impl/SingleLinkedList.java#L304" target="_blank" rel="noopener">æºç </a></p></blockquote><h3 id="é€’å½’"><a href="#é€’å½’" class="headerlink" title="é€’å½’"></a>é€’å½’</h3><p>å…¶å®é€’å½’çš„å®ç°æ–¹å¼å’Œå‰é¢å¾ªç¯çš„æ–¹å¼éå¸¸ç›¸ä¼¼ï¼Œå‰è€…æ˜¯é€šè¿‡å¾ªç¯æ¥ç§»åŠ¨æŒ‡é’ˆï¼Œåè€…æ˜¯é€šè¿‡é€’å½’æ¥ç§»åŠ¨æŒ‡é’ˆã€‚</p><p>å®šä¹‰ä¸€ä¸ªé€’å½’æ¥å£ï¼Œä¼ å…¥currä¸prevèŠ‚ç‚¹ä½œä¸ºå‚æ•°ï¼Œå†…éƒ¨å†å°†currçš„ä½œä¸ºä¸‹æ¬¡é€’å½’è°ƒç”¨çš„prevå…¥å‚ï¼Œ<code>curr.next</code> ä½œä¸ºä¸‹æ¬¡é€’å½’è°ƒç”¨çš„currå…¥å‚ã€‚</p><h4 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * public class ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) &#123; val = x; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListNode <span class="title">reverseList</span><span class="params">(ListNode head)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> reverseRecursively(head, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListNode <span class="title">reverseRecursively</span><span class="params">(ListNode curr, ListNode prev)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(curr == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(curr.next == <span class="keyword">null</span>)&#123;</span><br><span class="line">            ListNode head = curr;</span><br><span class="line">            curr.next = prev;</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        &#125;</span><br><span class="line">        ListNode next1 = curr.next;</span><br><span class="line">        curr.next = prev;</span><br><span class="line">        </span><br><span class="line">        ListNode head = reverseRecursively(next1, curr);</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/wangweiX/java-algorithms/blob/master/src/main/java/one/wangwei/algorithms/datastructures/list/impl/SingleLinkedList.java#L324" target="_blank" rel="noopener">æºç </a></p></blockquote><p>è¿™ä¸¤ç§æ–¹å¼çš„æ—¶é—´å¤æ‚åº¦å‡ä¸ºO(n)ï¼Œç©ºé—´å¤æ‚åº¦å‡ä¸ºO(1)ã€‚</p><h2 id="ç›¸å…³ç»ƒä¹ "><a href="#ç›¸å…³ç»ƒä¹ " class="headerlink" title="ç›¸å…³ç»ƒä¹ "></a>ç›¸å…³ç»ƒä¹ </h2><ul><li><a href="https://wangwei.one/posts/java-algoDS-linked-list-cycle.html">é“¾è¡¨ç¯æ£€æµ‹</a></li><li><a href="https://wangwei.one/posts/java-algoDS-Merge-Two-Sorted-Linked-Lists.html">æœ‰åºé“¾è¡¨åˆå¹¶</a></li><li><a href="https://wangwei.one/posts/java-algoDS-Remove-Nth-Node-From-End-of-List.html">åˆ é™¤å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹</a></li><li><a href="https://wangwei.one/posts/java-algoDS-middle-of-the-linked-list.html">æ±‚é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹</a></li><li><a href="https://wangwei.one/posts/java-algoDS-LRU-implement-by-linkedlist.html">LRUç®—æ³•å®ç°</a></li><li><a href="https://wangwei.one/posts/java-algoDS-palindrome-linked-list.html">å›æ–‡é“¾è¡¨æ£€æµ‹</a></li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li>ã€Š<a href="http://gk.link/a/101Nt" target="_blank" rel="noopener">æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾</a>ã€‹</li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> AlgoDS </tag>
            
            <tag> LeetCode </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æ•°æ®ç»“æ„ä¸ç®—æ³• | çº¿æ€§è¡¨ â€”â€” é“¾è¡¨]]></title>
      <url>/posts/java-data-structures-and-algorithms-linkedlist.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/pexels-photo-1322185.jpeg?imageslim" alt="pexels-photo-1322185"></p><h2 id="é“¾è¡¨"><a href="#é“¾è¡¨" class="headerlink" title="é“¾è¡¨"></a>é“¾è¡¨</h2><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>é€»è¾‘ç»“æ„ä¸Šä¸€ä¸ªæŒ¨ä¸€ä¸ªçš„æ•°æ®ï¼Œåœ¨å®é™…å­˜å‚¨æ—¶ï¼Œå¹¶æ²¡æœ‰åƒé¡ºåºè¡¨é‚£æ ·ä¹Ÿç›¸äº’ç´§æŒ¨ç€ã€‚æ°æ°ç›¸åï¼Œæ•°æ®éšæœºåˆ†å¸ƒåœ¨å†…å­˜ä¸­çš„å„ä¸ªä½ç½®ï¼Œè¿™ç§å­˜å‚¨ç»“æ„ç§°ä¸º<strong>çº¿æ€§è¡¨çš„é“¾å¼å­˜å‚¨</strong>ã€‚</p><a id="more"></a><p>ç”±äºåˆ†æ•£å­˜å‚¨ï¼Œä¸ºäº†èƒ½å¤Ÿä½“ç°å‡ºæ•°æ®å…ƒç´ ä¹‹é—´çš„é€»è¾‘å…³ç³»ï¼Œæ¯ä¸ªæ•°æ®å…ƒç´ åœ¨å­˜å‚¨çš„åŒæ—¶ï¼Œè¦é…å¤‡ä¸€ä¸ªæŒ‡é’ˆï¼Œç”¨äºæŒ‡å‘å®ƒçš„ç›´æ¥åç»§å…ƒç´ ï¼Œå³æ¯ä¸€ä¸ªæ•°æ®å…ƒç´ éƒ½æŒ‡å‘ä¸‹ä¸€ä¸ªæ•°æ®å…ƒç´ ï¼ˆæœ€åä¸€ä¸ªæŒ‡å‘NULL(ç©º)ï¼‰ã€‚è¿™ç§ç»“æ„æˆä¸º â€œ<strong>å•å‘é“¾è¡¨</strong>â€œã€‚</p><p><img src="https://img.i7years.com/blog/SingleLinkedList&amp;.png" alt="SingleLinkedList"></p><p>åœ¨å•å‘é“¾è¡¨çš„åŸºç¡€ä¸Šï¼Œç»™å„ä¸ªç»“ç‚¹é¢å¤–é…å¤‡ä¸€ä¸ªæŒ‡é’ˆå˜é‡ï¼Œç”¨äºæŒ‡å‘æ¯ä¸ªç»“ç‚¹çš„ç›´æ¥å‰è¶‹å…ƒç´ ã€‚è¿™æ ·çš„é“¾è¡¨è¢«ç§°ä¸ºâ€œ<strong>åŒå‘é“¾è¡¨</strong>â€æˆ–è€…â€œåŒé“¾è¡¨â€ã€‚</p><p><img src="https://img.i7years.com/blog/DoublyLinkedList&amp;.png" alt="DoublyLinkedList"></p><p>å½“å•å‘é“¾è¡¨çš„å°¾éƒ¨æ•°æ®æŒ‡å‘å¤´éƒ¨æ•°æ®æ—¶ï¼Œå°±æ„æˆäº†<strong>å•å‘å¾ªç¯é“¾è¡¨</strong>ã€‚</p><p><img src="https://img.i7years.com/blog/SinglyCircularLinkedList&amp;.png" alt="SinglyCircularLinkedList"></p><p>å½“åŒå‘é“¾è¡¨çš„å¤´éƒ¨å’Œå°¾éƒ¨ç›¸äº’æŒ‡å‘æ—¶ï¼Œå°±æ„æˆäº†<strong>åŒå‘å¾ªç¯é“¾è¡¨</strong>ã€‚</p><p><img src="https://img.i7years.com/blog/DoublyCircularLinkedList&amp;.png" alt="DoublyCircularLinkedList"></p><h2 id="å•å‘é“¾è¡¨"><a href="#å•å‘é“¾è¡¨" class="headerlink" title="å•å‘é“¾è¡¨"></a>å•å‘é“¾è¡¨</h2><p>å•å‘é“¾è¡¨åœ¨æ’å…¥å…ƒç´ ã€åˆ é™¤å…ƒç´ æ—¶ï¼Œéœ€è¦è·å–å‰é©±å…ƒç´ ï¼Œéœ€è¦ä»headå¼€å§‹éå†ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚</p><p>æ ¹æ®indexæŸ¥è¯¢å¯¹åº”å…ƒç´ ï¼Œä¹Ÿéœ€è¦ä»headå¼€å§‹éå†ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚</p><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.algorithms.datastructures.list.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> one.wangwei.algorithms.datastructures.list.IList;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Single Linked List</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> https://wangwei.one</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/12/25</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleLinkedList</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">IList</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * size</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * head node</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Node&lt;T&gt; head;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * tail node</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Node&lt;T&gt; tail;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * add element</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(T element)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> addLast(element);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * add element at index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, T element)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; size) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException(<span class="string">"Index: "</span> + index + <span class="string">", Size: "</span> + size);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (index == size) &#123;</span><br><span class="line">            <span class="keyword">return</span> add(element);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> addBefore(index, element);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Add Last element</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">addLast</span><span class="params">(T element)</span> </span>&#123;</span><br><span class="line">        Node&lt;T&gt; last = tail;</span><br><span class="line">        Node&lt;T&gt; newNode = <span class="keyword">new</span> Node&lt;&gt;(<span class="keyword">null</span>, element);</span><br><span class="line">        tail = newNode;</span><br><span class="line">        <span class="comment">// if linked list is empty</span></span><br><span class="line">        <span class="keyword">if</span> (last == <span class="keyword">null</span>) &#123;</span><br><span class="line">            head = newNode;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            last.next = newNode;</span><br><span class="line">        &#125;</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * add element before certain element</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">addBefore</span><span class="params">(<span class="keyword">int</span> index, T element)</span> </span>&#123;</span><br><span class="line">        checkPositionIndex(index);</span><br><span class="line">        <span class="comment">// prev node</span></span><br><span class="line">        Node&lt;T&gt; prev = <span class="keyword">null</span>;</span><br><span class="line">        Node&lt;T&gt; x = head;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">            prev = x;</span><br><span class="line">            x = x.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// current node</span></span><br><span class="line">        Node&lt;T&gt; current = x;</span><br><span class="line">        <span class="comment">// new node</span></span><br><span class="line">        Node&lt;T&gt; newNode = <span class="keyword">new</span> Node&lt;&gt;(current, element);</span><br><span class="line">        <span class="comment">// if current node is head</span></span><br><span class="line">        <span class="keyword">if</span> (prev == <span class="keyword">null</span>) &#123;</span><br><span class="line">            head = newNode;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            prev.next = newNode;</span><br><span class="line">        &#125;</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * remove element</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(T element)</span> </span>&#123;</span><br><span class="line">        Node&lt;T&gt; prev = <span class="keyword">null</span>;</span><br><span class="line">        Node&lt;T&gt; x = head;</span><br><span class="line">        <span class="keyword">if</span> (element == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span> (x != <span class="keyword">null</span> &amp;&amp; x.element != <span class="keyword">null</span>) &#123;</span><br><span class="line">                prev = x;</span><br><span class="line">                x = x.next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (x != <span class="keyword">null</span> &amp;&amp; !x.element.equals(element)) &#123;</span><br><span class="line">                prev = x;</span><br><span class="line">                x = x.next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if this linked is null OR don't find element</span></span><br><span class="line">        <span class="keyword">if</span> (x == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Node&lt;T&gt; next = x.next;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if delete node is head</span></span><br><span class="line">        <span class="keyword">if</span> (prev == <span class="keyword">null</span>) &#123;</span><br><span class="line">            head = next;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            prev.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// if delete node is tail</span></span><br><span class="line">        <span class="keyword">if</span> (next == <span class="keyword">null</span>) &#123;</span><br><span class="line">            tail = prev;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// for GC</span></span><br><span class="line">        x.element = <span class="keyword">null</span>;</span><br><span class="line">        x = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * remove element by index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        checkPositionIndex(index);</span><br><span class="line">        Node&lt;T&gt; prev = <span class="keyword">null</span>;</span><br><span class="line">        Node&lt;T&gt; x = head;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">            prev = x;</span><br><span class="line">            x = x.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if linked is empty</span></span><br><span class="line">        <span class="keyword">if</span> (x == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Node&lt;T&gt; next = x.next;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if delete node is head</span></span><br><span class="line">        <span class="keyword">if</span> (prev == <span class="keyword">null</span>) &#123;</span><br><span class="line">            head = next;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            prev.next = next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if delete node is tail</span></span><br><span class="line">        <span class="keyword">if</span> (next == <span class="keyword">null</span>) &#123;</span><br><span class="line">            tail = prev;</span><br><span class="line">        &#125;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> x.element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * set element by index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> old element</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, T element)</span> </span>&#123;</span><br><span class="line">        checkPositionIndex(index);</span><br><span class="line">        Node&lt;T&gt; node = node(index);</span><br><span class="line">        T oldElement = node.element;</span><br><span class="line">        node.element = element;</span><br><span class="line">        <span class="keyword">return</span> oldElement;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get element by index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        Node&lt;T&gt; node = node(index);</span><br><span class="line">        <span class="keyword">return</span> node == <span class="keyword">null</span> ? <span class="keyword">null</span> : node.element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get element by index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node&lt;T&gt; <span class="title">node</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        checkPositionIndex(index);</span><br><span class="line">        Node&lt;T&gt; x = head;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">            x = x.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * check index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkPositionIndex</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= size) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException(<span class="string">"Index: "</span> + index + <span class="string">", Size: "</span> + size);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * clear list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Node&lt;T&gt; x = head; x != <span class="keyword">null</span>; ) &#123;</span><br><span class="line">            Node&lt;T&gt; next = x.next;</span><br><span class="line">            x.element = <span class="keyword">null</span>;</span><br><span class="line">            x.next = <span class="keyword">null</span>;</span><br><span class="line">            x = next;</span><br><span class="line">        &#125;</span><br><span class="line">        head = tail = <span class="keyword">null</span>;</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * contain certain element</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(T element)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (element == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Node&lt;T&gt; x = head; x != <span class="keyword">null</span>; x = x.next) &#123;</span><br><span class="line">                <span class="keyword">if</span> (x.element == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (Node&lt;T&gt; x = head; x != <span class="keyword">null</span>; x = x.next) &#123;</span><br><span class="line">                <span class="keyword">if</span> (x.element.equals(element)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get list size</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Linked List Node</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Node&lt;T&gt; next;</span><br><span class="line">        <span class="keyword">private</span> T element;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(Node&lt;T&gt; next, T element)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.next = next;</span><br><span class="line">            <span class="keyword">this</span>.element = element;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/wangweiX/java-algorithms/blob/master/src/main/java/one/wangwei/algorithms/datastructures/list/impl/SingleLinkedList.java" target="_blank" rel="noopener">æºç </a></p></blockquote><h2 id="åŒå‘é“¾è¡¨"><a href="#åŒå‘é“¾è¡¨" class="headerlink" title="åŒå‘é“¾è¡¨"></a>åŒå‘é“¾è¡¨</h2><p>ç›¸æ¯”äºå•å‘é“¾è¡¨ï¼ŒåŒå‘é“¾è¡¨å¤šäº†ä¸€ä¸ªå‰é©±æŒ‡é’ˆï¼Œåœ¨æŸ¥æ‰¾å‰é©±èŠ‚ç‚¹æ—¶ï¼Œæ—¶é—´å¤æ‚åº¦é™ä½ä¸ºäº†O(1)ã€‚</p><p>é€šè¿‡indexæŸ¥è¯¢ï¼Œåˆ é™¤æŸä¸ªnodeèŠ‚ç‚¹ï¼Œæ—¶é—´å¤æ‚åº¦éƒ½é™ä¸ºäº†O(1)ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><h3 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.algorithms.datastructures.list.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> one.wangwei.algorithms.datastructures.list.IList;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Doubly Linked List</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> https://wangwei.one</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/04/28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DoublyLinkedList</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">IList</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * size</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * head element</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Node&lt;T&gt; head = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * tail element</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Node&lt;T&gt; tail = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * add element</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(T element)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> addLast(element);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * add element at index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, T element)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; size) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException(<span class="string">"Index: "</span> + index + <span class="string">", Size: "</span> + size);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (index == size) &#123;</span><br><span class="line">            <span class="keyword">return</span> add(element);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> addBefore(element, node(index));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Add Last element</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">addLast</span><span class="params">(T element)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Node&lt;T&gt; last = tail;</span><br><span class="line">        Node&lt;T&gt; newNode = <span class="keyword">new</span> Node&lt;&gt;(last, element, <span class="keyword">null</span>);</span><br><span class="line">        tail = newNode;</span><br><span class="line">        <span class="keyword">if</span> (last == <span class="keyword">null</span>) &#123;</span><br><span class="line">            head = newNode;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            last.next = newNode;</span><br><span class="line">        &#125;</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * add element before certain element</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> target</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">addBefore</span><span class="params">(T element, Node&lt;T&gt; target)</span> </span>&#123;</span><br><span class="line">        Node&lt;T&gt; prev = target.prev;</span><br><span class="line">        Node&lt;T&gt; newNode = <span class="keyword">new</span> Node&lt;&gt;(prev, element, target);</span><br><span class="line">        target.prev = newNode;</span><br><span class="line">        <span class="keyword">if</span> (prev == <span class="keyword">null</span>) &#123;</span><br><span class="line">            head = newNode;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            prev.next = newNode;</span><br><span class="line">        &#125;</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * remove node by element</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(T element)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (element == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Node&lt;T&gt; x = head; x != <span class="keyword">null</span>; x = x.next) &#123;</span><br><span class="line">                <span class="keyword">if</span> (x.element == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    unlink(x);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (Node&lt;T&gt; x = head; x != <span class="keyword">null</span>; x = x.next) &#123;</span><br><span class="line">                <span class="keyword">if</span> (element.equals(x.element)) &#123;</span><br><span class="line">                    unlink(x);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * remove node by index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> unlink(node(index));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get element by index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node&lt;T&gt; <span class="title">node</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        checkPositionIndex(index);</span><br><span class="line">        <span class="keyword">if</span> (index &lt; (size &gt;&gt; <span class="number">1</span>)) &#123;</span><br><span class="line">            Node&lt;T&gt; x = head;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">                x = x.next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Node&lt;T&gt; x = tail;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = size - <span class="number">1</span>; i &gt; index; i--) &#123;</span><br><span class="line">                x = x.prev;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * unlink node</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> T <span class="title">unlink</span><span class="params">(Node&lt;T&gt; node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> T element = node.element;</span><br><span class="line">        <span class="keyword">final</span> Node&lt;T&gt; prev = node.prev;</span><br><span class="line">        <span class="keyword">final</span> Node&lt;T&gt; next = node.next;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if unlink is head</span></span><br><span class="line">        <span class="keyword">if</span> (prev == <span class="keyword">null</span>) &#123;</span><br><span class="line">            head = next;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            prev.next = next;</span><br><span class="line">            <span class="comment">// clear prev</span></span><br><span class="line">            node.prev = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if unlink is tail</span></span><br><span class="line">        <span class="keyword">if</span> (next == <span class="keyword">null</span>) &#123;</span><br><span class="line">            tail = prev;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            next.prev = prev;</span><br><span class="line">            node.next = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        node.element = <span class="keyword">null</span>;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkPositionIndex</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= size) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException(<span class="string">"Index: "</span> + index + <span class="string">", Size: "</span> + size);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * set element by index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, T element)</span> </span>&#123;</span><br><span class="line">        checkPositionIndex(index);</span><br><span class="line">        Node&lt;T&gt; oldNode = node(index);</span><br><span class="line">        T oldElement = oldNode.element;</span><br><span class="line">        oldNode.element = element;</span><br><span class="line">        <span class="keyword">return</span> oldElement;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get element by index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        Node&lt;T&gt; node = node(index);</span><br><span class="line">        <span class="keyword">return</span> node == <span class="keyword">null</span> ? <span class="keyword">null</span> : node.element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * clear list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Node&lt;T&gt; x = head; x != <span class="keyword">null</span>; ) &#123;</span><br><span class="line">            Node&lt;T&gt; next = x.next;</span><br><span class="line">            x.element = <span class="keyword">null</span>;</span><br><span class="line">            x.next = <span class="keyword">null</span>;</span><br><span class="line">            x.prev = <span class="keyword">null</span>;</span><br><span class="line">            x = next;</span><br><span class="line">        &#125;</span><br><span class="line">        head = tail = <span class="keyword">null</span>;</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * contain certain element</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(T element)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (element == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Node&lt;T&gt; x = head; x != <span class="keyword">null</span>; x = x.next) &#123;</span><br><span class="line">                <span class="keyword">if</span> (x.element == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (Node&lt;T&gt; x = head; x != <span class="keyword">null</span>; x = x.next) &#123;</span><br><span class="line">                <span class="keyword">if</span> (element.equals(x.element)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get list size</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * node</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> T element;</span><br><span class="line">        <span class="keyword">private</span> Node&lt;T&gt; prev;</span><br><span class="line">        <span class="keyword">private</span> Node&lt;T&gt; next;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(Node&lt;T&gt; prev, T element, Node&lt;T&gt; next)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.element = element;</span><br><span class="line">            <span class="keyword">this</span>.prev = prev;</span><br><span class="line">            <span class="keyword">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/wangweiX/java-algorithms/blob/master/src/main/java/one/wangwei/algorithms/datastructures/list/impl/DoublyLinkedList.java" target="_blank" rel="noopener">æºä»£ç </a></p></blockquote><h2 id="å•å‘å¾ªç¯é“¾è¡¨"><a href="#å•å‘å¾ªç¯é“¾è¡¨" class="headerlink" title="å•å‘å¾ªç¯é“¾è¡¨"></a>å•å‘å¾ªç¯é“¾è¡¨</h2><p>ä¸å•å‘é“¾è¡¨ä¸€æ ·ï¼Œåœ¨å¯»æ‰¾å‰é©±èŠ‚ç‚¹æ—¶ï¼Œéœ€è¦éå†æ•´ä¸ªé“¾è¡¨ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n).</p><p>åœ¨ç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ æ—¶ï¼Œç‰¹åˆ«æ³¨æ„ï¼Œheadä¸tailä¸ºåŒä¸€èŠ‚ç‚¹ï¼Œå¹¶ä¸”éœ€è¦è‡ªæŒ‡å‘ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.algorithms.datastructures.list.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> one.wangwei.algorithms.datastructures.list.IList;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Singly Circular Linked List</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> https://wangwei.one</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/05/03</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SinglyCircularLinkedList</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">IList</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * size</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * head node</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Node&lt;T&gt; head = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * tail node</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Node&lt;T&gt; tail = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * add element</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(T element)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> addLast(element);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * add element at index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, T element)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; size) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException(<span class="string">"Index: "</span> + index + <span class="string">", Size: "</span> + size);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (index == size) &#123;</span><br><span class="line">            <span class="keyword">return</span> add(element);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> addBefore(index, element);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Add Last element</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">addLast</span><span class="params">(T element)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Node&lt;T&gt; last = tail;</span><br><span class="line">        Node&lt;T&gt; newElement = <span class="keyword">new</span> Node&lt;&gt;(element, head);</span><br><span class="line">        tail = newElement;</span><br><span class="line">        <span class="keyword">if</span> (last == <span class="keyword">null</span>) &#123;</span><br><span class="line">            head = newElement;</span><br><span class="line">            <span class="comment">// we need linked itself when add an element at first time</span></span><br><span class="line">            tail.next = head;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            last.next = newElement;</span><br><span class="line">        &#125;</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * add element before certain element</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">addBefore</span><span class="params">(<span class="keyword">int</span> index, T element)</span> </span>&#123;</span><br><span class="line">        checkPositionIndex(index);</span><br><span class="line">        <span class="comment">// prev node, start with tail</span></span><br><span class="line">        Node&lt;T&gt; prev = tail;</span><br><span class="line">        Node&lt;T&gt; x = head;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">            prev = x;</span><br><span class="line">            x = x.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// current node</span></span><br><span class="line">        Node&lt;T&gt; current = x;</span><br><span class="line">        <span class="comment">// new node</span></span><br><span class="line">        Node&lt;T&gt; newNode = <span class="keyword">new</span> Node&lt;&gt;(element, current);</span><br><span class="line">        <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</span><br><span class="line">            head = newNode;</span><br><span class="line">        &#125;</span><br><span class="line">        prev.next = newNode;</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * remove node by element</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(T element)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// start with tail</span></span><br><span class="line">        Node&lt;T&gt; prev = tail;</span><br><span class="line">        <span class="comment">// start with head</span></span><br><span class="line">        Node&lt;T&gt; x = head;</span><br><span class="line">        <span class="comment">// start with index -1</span></span><br><span class="line">        <span class="keyword">int</span> prevIndex = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (element == <span class="keyword">null</span> &amp;&amp; x.element == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (element != <span class="keyword">null</span> &amp;&amp; element.equals(x.element)) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            prev = x;</span><br><span class="line">            x = x.next;</span><br><span class="line">            prevIndex = i;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if this linked list is empty</span></span><br><span class="line">        <span class="keyword">if</span> (x == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if don't match element</span></span><br><span class="line">        <span class="keyword">if</span> (prevIndex == size - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Node&lt;T&gt; next = x.next;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if delete node is head</span></span><br><span class="line">        <span class="keyword">if</span> (prevIndex == -<span class="number">1</span>) &#123;</span><br><span class="line">            head = next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if delete node is tail</span></span><br><span class="line">        <span class="keyword">if</span> (prevIndex == size - <span class="number">2</span>) &#123;</span><br><span class="line">            tail = prev;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        prev.next = next;</span><br><span class="line"></span><br><span class="line">        size--;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</span><br><span class="line">            head = tail = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// for GC</span></span><br><span class="line">        x = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * remove element by index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        checkPositionIndex(index);</span><br><span class="line">        Node&lt;T&gt; prev = tail;</span><br><span class="line">        Node&lt;T&gt; x = head;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">            prev = x;</span><br><span class="line">            x = x.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if linked is empty</span></span><br><span class="line">        <span class="keyword">if</span> (x == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Node&lt;T&gt; next = x.next;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if delete node is head</span></span><br><span class="line">        <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</span><br><span class="line">            head = next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if delete node is tail</span></span><br><span class="line">        <span class="keyword">if</span> (index == size - <span class="number">1</span>) &#123;</span><br><span class="line">            tail = prev;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        prev.next = next;</span><br><span class="line"></span><br><span class="line">        size--;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</span><br><span class="line">            head = tail = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> x.element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get element by index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node&lt;T&gt; <span class="title">node</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        checkPositionIndex(index);</span><br><span class="line">        Node&lt;T&gt; x = head;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">            x = x.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkPositionIndex</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= size) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException(<span class="string">"Index: "</span> + index + <span class="string">", Size: "</span> + size);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * set element by index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, T element)</span> </span>&#123;</span><br><span class="line">        checkPositionIndex(index);</span><br><span class="line">        Node&lt;T&gt; oldNode = node(index);</span><br><span class="line">        T oldElement = oldNode.element;</span><br><span class="line">        oldNode.element = element;</span><br><span class="line">        <span class="keyword">return</span> oldElement;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get element by index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> node(index).element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * clear list element</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Node&lt;T&gt; x = head; x != <span class="keyword">null</span>; ) &#123;</span><br><span class="line">            Node&lt;T&gt; next = x.next;</span><br><span class="line">            x.element = <span class="keyword">null</span>;</span><br><span class="line">            x.next = <span class="keyword">null</span>;</span><br><span class="line">            x = next;</span><br><span class="line">        &#125;</span><br><span class="line">        head = tail = <span class="keyword">null</span>;</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * contain certain element</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(T element)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Node&lt;T&gt; x = head;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (element == <span class="keyword">null</span> &amp;&amp; x.element == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (element != <span class="keyword">null</span> &amp;&amp; element.equals(x.element)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            x = x.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get list size</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Node</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> T element;</span><br><span class="line">        <span class="keyword">private</span> Node&lt;T&gt; next;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(T element, Node&lt;T&gt; next)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.element = element;</span><br><span class="line">            <span class="keyword">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/wangweiX/java-algorithms/blob/master/src/main/java/one/wangwei/algorithms/datastructures/list/impl/SinglyCircularLinkedList.java" target="_blank" rel="noopener">æºä»£ç </a></p></blockquote><h2 id="åŒå‘å¾ªç¯é“¾è¡¨"><a href="#åŒå‘å¾ªç¯é“¾è¡¨" class="headerlink" title="åŒå‘å¾ªç¯é“¾è¡¨"></a>åŒå‘å¾ªç¯é“¾è¡¨</h2><p>åŒå‘å¾ªç¯é“¾è¡¨ç›¸æ¯”å•å‘å¾ªç¯é“¾è¡¨ï¼Œé™ä½äº†æŸ¥æ‰¾å‰é©±èŠ‚ç‚¹çš„å¤æ‚åº¦ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1).</p><p>åŒæ ·ç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ æ—¶ï¼Œheadä¸tailä¸ºåŒä¸€å…ƒç´ ï¼Œéœ€è¦è‡ªæŒ‡å‘ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.algorithms.datastructures.list.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> one.wangwei.algorithms.datastructures.list.IList;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Doubly circular linked list</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> https://wangwei.one</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/12/21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DoublyCircularLinkedList</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">IList</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * size</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * head node</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Node&lt;T&gt; head;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * tail node</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Node&lt;T&gt; tail;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * add element</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(T element)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> addLast(element);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * add element at index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, T element)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; size) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException(<span class="string">"Index: "</span> + index + <span class="string">", Size: "</span> + size);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (index == size) &#123;</span><br><span class="line">            <span class="keyword">return</span> add(element);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> addBefore(index, element);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Add last element</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">addLast</span><span class="params">(T element)</span> </span>&#123;</span><br><span class="line">        Node&lt;T&gt; last = tail;</span><br><span class="line">        Node&lt;T&gt; newNode = <span class="keyword">new</span> Node&lt;&gt;(element, last, head);</span><br><span class="line">        tail = newNode;</span><br><span class="line">        <span class="comment">// add element at first time</span></span><br><span class="line">        <span class="keyword">if</span> (last == <span class="keyword">null</span>) &#123;</span><br><span class="line">            head = newNode;</span><br><span class="line">            tail.next = head;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            last.next = newNode;</span><br><span class="line">        &#125;</span><br><span class="line">        head.prev = tail;</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * add element before certain element</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">addBefore</span><span class="params">(<span class="keyword">int</span> index, T element)</span> </span>&#123;</span><br><span class="line">        Node&lt;T&gt; target = node(index);</span><br><span class="line">        Node&lt;T&gt; prev = target.prev;</span><br><span class="line">        Node&lt;T&gt; newNode = <span class="keyword">new</span> Node&lt;&gt;(element, prev, target);</span><br><span class="line"></span><br><span class="line">        prev.next = newNode;</span><br><span class="line">        target.prev = newNode;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</span><br><span class="line">            head = newNode;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * remove element</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(T element)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// start with head</span></span><br><span class="line">        Node&lt;T&gt; x = head;</span><br><span class="line">        <span class="comment">// start with index -1</span></span><br><span class="line">        <span class="keyword">int</span> prevIndex = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (element == <span class="keyword">null</span> &amp;&amp; x.element == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (element != <span class="keyword">null</span> &amp;&amp; element.equals(x.element)) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            x = x.next;</span><br><span class="line">            prevIndex = i;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if this linked list is empty</span></span><br><span class="line">        <span class="keyword">if</span> (x == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if don't match element</span></span><br><span class="line">        <span class="keyword">if</span> (prevIndex == size - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Node&lt;T&gt; prev = x.prev;</span><br><span class="line">        Node&lt;T&gt; next = x.next;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if delete node is head</span></span><br><span class="line">        <span class="keyword">if</span> (prevIndex == -<span class="number">1</span>) &#123;</span><br><span class="line">            head = next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if delete node is tail</span></span><br><span class="line">        <span class="keyword">if</span> (prevIndex == size - <span class="number">2</span>) &#123;</span><br><span class="line">            tail = prev;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        prev.next = next;</span><br><span class="line">        next.prev = prev;</span><br><span class="line"></span><br><span class="line">        size--;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</span><br><span class="line">            head = tail = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// for GC</span></span><br><span class="line">        x = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * remove element by index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        checkPositionIndex(index);</span><br><span class="line">        Node&lt;T&gt; x = head;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">            x = x.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if linked is empty</span></span><br><span class="line">        <span class="keyword">if</span> (x == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Node&lt;T&gt; prev = x.prev;</span><br><span class="line">        Node&lt;T&gt; next = x.next;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if delete node is head</span></span><br><span class="line">        <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</span><br><span class="line">            head = next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if delete node is tail</span></span><br><span class="line">        <span class="keyword">if</span> (index == size - <span class="number">1</span>) &#123;</span><br><span class="line">            tail = prev;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        prev.next = next;</span><br><span class="line">        next.prev = prev;</span><br><span class="line"></span><br><span class="line">        size--;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</span><br><span class="line">            head = tail = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> x.element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkPositionIndex</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= size) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException(<span class="string">"Index: "</span> + index + <span class="string">", Size: "</span> + size);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * set element by index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> old element</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, T element)</span> </span>&#123;</span><br><span class="line">        Node&lt;T&gt; oldNode = node(index);</span><br><span class="line">        T oldElement = oldNode.element;</span><br><span class="line">        oldNode.element = element;</span><br><span class="line">        <span class="keyword">return</span> oldElement;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get element by index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> node(index).element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get element by index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node&lt;T&gt; <span class="title">node</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        checkPositionIndex(index);</span><br><span class="line">        <span class="keyword">if</span> (index &lt; (size &gt;&gt; <span class="number">1</span>)) &#123;</span><br><span class="line">            Node&lt;T&gt; x = head;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">                x = x.next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Node&lt;T&gt; x = tail;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = size - <span class="number">1</span>; i &gt; index; i--) &#123;</span><br><span class="line">                x = x.prev;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * clear list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Node&lt;T&gt; x = head; x != <span class="keyword">null</span>; ) &#123;</span><br><span class="line">            Node&lt;T&gt; next = x.next;</span><br><span class="line">            x.element = <span class="keyword">null</span>;</span><br><span class="line">            x.next = <span class="keyword">null</span>;</span><br><span class="line">            x = next;</span><br><span class="line">        &#125;</span><br><span class="line">        head = tail = <span class="keyword">null</span>;</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * contain certain element</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(T element)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Node&lt;T&gt; x = head;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (element == <span class="keyword">null</span> &amp;&amp; x.element == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (element != <span class="keyword">null</span> &amp;&amp; element.equals(x.element)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            x = x.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get list size</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Node</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> T element;</span><br><span class="line">        <span class="keyword">private</span> Node&lt;T&gt; prev;</span><br><span class="line">        <span class="keyword">private</span> Node&lt;T&gt; next;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(T element, Node&lt;T&gt; prev, Node&lt;T&gt; next)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.element = element;</span><br><span class="line">            <span class="keyword">this</span>.prev = prev;</span><br><span class="line">            <span class="keyword">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/wangweiX/java-algorithms/blob/master/src/main/java/one/wangwei/algorithms/datastructures/list/impl/DoublyCircularLinkedList.java" target="_blank" rel="noopener">æºä»£ç </a></p></blockquote><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å†™é“¾è¡¨ä»£ç ç‰¹åˆ«éœ€è¦æ³¨æ„è¾¹ç•Œæ¡ä»¶çš„å¤„ç†ï¼š</p><ul><li>å¦‚æœé“¾è¡¨ä¸ºç©ºï¼Œä»£ç èƒ½å¦æ­£å¸¸å·¥ä½œï¼Ÿ</li><li>å¦‚æœé“¾è¡¨åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œä»£ç èƒ½å¦æ­£å¸¸å·¥ä½œï¼Ÿ</li><li>å¦‚æœé“¾è¡¨åªæœ‰ä¸¤ä¸ªèŠ‚ç‚¹æ—¶ï¼Œä»£ç èƒ½å¦æ­£å¸¸å·¥ä½œï¼Ÿ</li><li>ä»£ç åœ¨åˆ é™¤æˆ–æ’å…¥Headå’ŒTailèŠ‚ç‚¹æ—¶ï¼Œè¿™å››ç§çš„é“¾è¡¨ç»“æ„æ˜¯å¦</li></ul><h2 id="ArrayList-vs-LinkedList"><a href="#ArrayList-vs-LinkedList" class="headerlink" title="ArrayList vs LinkedList"></a>ArrayList vs LinkedList</h2><table><thead><tr><th></th><th>ArrayList</th><th>LinkedList</th></tr></thead><tbody><tr><td>æ’å…¥&amp;<br>åˆ é™¤</td><td>O(n)</td><td>O(1)</td></tr><tr><td>éšæœºè®¿é—®</td><td>O(1)</td><td>O(n)</td></tr><tr><td>ä¼˜ç‚¹</td><td>è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå¯ä»¥å€ŸåŠ©CPUçš„é¢„å–æœºåˆ¶</td><td>å†…å­˜ä¸è¿ç»­ï¼Œå¤©ç„¶æ”¯æŒåŠ¨æ€æ‰©å®¹</td></tr><tr><td>ç¼ºç‚¹</td><td>æ— æ³•å­˜å‚¨å¤§æ•°æ®ï¼Œæ•°ç»„æ‰©å®¹è€—æ€§èƒ½</td><td>é¢‘ç¹åœ°æ’å…¥åˆ é™¤æ“ä½œï¼Œä¼šå¯¼è‡´å†…å­˜ç¢ç‰‡çš„å¢åŠ ï¼Œå¯¼è‡´é¢‘ç¹çš„GC</td></tr></tbody></table><h2 id="ç›¸å…³ç»ƒä¹ "><a href="#ç›¸å…³ç»ƒä¹ " class="headerlink" title="ç›¸å…³ç»ƒä¹ "></a>ç›¸å…³ç»ƒä¹ </h2><ul><li><a href="https://wangwei.one/posts/java-algoDS-reverse-linked-list.html">é“¾è¡¨åè½¬</a></li><li><a href="https://wangwei.one/posts/java-algoDS-linked-list-cycle.html">é“¾è¡¨ç¯æ£€æµ‹</a></li><li><a href="https://wangwei.one/posts/java-algoDS-Merge-Two-Sorted-Linked-Lists.html">æœ‰åºé“¾è¡¨åˆå¹¶</a></li><li><a href="https://wangwei.one/posts/java-algoDS-Remove-Nth-Node-From-End-of-List.html">åˆ é™¤å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹</a></li><li><a href="https://wangwei.one/posts/java-algoDS-middle-of-the-linked-list.html">æ±‚é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹</a></li><li><a href="https://wangwei.one/posts/java-algoDS-LRU-implement-by-linkedlist.html">LRUç®—æ³•å®ç°</a></li><li><a href="https://wangwei.one/posts/java-algoDS-palindrome-linked-list.html">å›æ–‡é“¾è¡¨æ£€æµ‹</a></li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="http://data.biancheng.net/view/5.html" target="_blank" rel="noopener">http://data.biancheng.net/view/5.html</a></li><li><a href="https://github.com/phishman3579/java-algorithms-implementation" target="_blank" rel="noopener">https://github.com/phishman3579/java-algorithms-implementation</a></li><li>ã€Š<a href="http://gk.link/a/101Nt" target="_blank" rel="noopener">æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾</a>ã€‹</li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> AlgoDS </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æ•°æ®ç»“æ„ä¸ç®—æ³• | çº¿æ€§è¡¨ â€”â€” é¡ºåºè¡¨]]></title>
      <url>/posts/java-data-structures-and-algorithms-arraylist.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/pexels-photo-577585.jpeg?imageslim" alt="pexels-photo-577585"></p><h2 id="çº¿æ€§è¡¨"><a href="#çº¿æ€§è¡¨" class="headerlink" title="çº¿æ€§è¡¨"></a>çº¿æ€§è¡¨</h2><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>å°†å…·æœ‰çº¿æ€§å…³ç³»çš„æ•°æ®å­˜å‚¨åˆ°è®¡ç®—æœºä¸­æ‰€ä½¿ç”¨çš„å­˜å‚¨ç»“æ„ç§°ä¸ºçº¿æ€§è¡¨ã€‚</p><p>çº¿æ€§ï¼Œæ˜¯æŒ‡æ•°æ®åœ¨<strong>é€»è¾‘ç»“æ„</strong>ä¸Šå…·æœ‰çº¿æ€§å…³ç³»ã€‚</p><a id="more"></a><h3 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h3><p>é€»è¾‘ç»“æ„ä¸Šç›¸é‚»çš„æ•°æ®åœ¨ç‰©ç†ç»“æ„å­˜å‚¨åˆ†ä¸¤ç§å½¢å¼ï¼š</p><ul><li>æ•°æ®åœ¨å†…å­˜ä¸­é›†ä¸­å­˜å‚¨ï¼Œé‡‡ç”¨é¡ºåºè¡¨ç¤ºç»“æ„ï¼Œç§°ä¸ºâ€é¡ºåºå­˜å‚¨â€ï¼›</li><li>æ•°æ®åœ¨å†…å­˜ä¸­åˆ†æ•£å­˜å‚¨ï¼Œé‡‡ç”¨é“¾å¼è¡¨ç¤ºç»“æ„ï¼Œç§°ä¸ºâ€é“¾å¼å­˜å‚¨â€ï¼›</li></ul><h2 id="é¡ºåºè¡¨"><a href="#é¡ºåºè¡¨" class="headerlink" title="é¡ºåºè¡¨"></a>é¡ºåºè¡¨</h2><h3 id="å®šä¹‰-1"><a href="#å®šä¹‰-1" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>é€»è¾‘ä¸Šå…·æœ‰çº¿æ€§å…³ç³»çš„æ•°æ®æŒ‰ç…§å‰åçš„æ¬¡åºå…¨éƒ¨å­˜å‚¨åœ¨ä¸€æ•´å—è¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ï¼Œä¹‹é—´ä¸å­˜åœ¨ç©ºéš™ï¼Œè¿™æ ·çš„å­˜å‚¨ç»“æ„ç§°ä¸ºé¡ºåºå­˜å‚¨ç»“æ„ã€‚</p><p>ä½¿ç”¨çº¿æ€§è¡¨çš„é¡ºåºå­˜å‚¨ç»“æ„ç”Ÿæˆçš„è¡¨ï¼Œç§°ä¸ºé¡ºåºè¡¨ã€‚</p><p><img src="https://img.i7years.com/blog/2-1FHG4324N34.png" alt=""></p><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p>é¡ºåºè¡¨çš„å­˜æ”¾æ•°æ®çš„ç‰¹ç‚¹å’Œæ•°ç»„ä¸€æ ·ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œé‡‡ç”¨æ•°ç»„æ¥å®ç°ï¼Œè¿™é‡Œæˆ‘ä»¬æ¥ç”¨æ•°ç»„æ¥ç®€å•å®ç°Javaä¸­å¸¸ç”¨çš„ArrayListã€‚</p><p>æ¥å£å®šä¹‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.algorithms.datastructures.list;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * List Interface</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> https://wangwei.one/</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/04/27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IList</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * add element</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(T element)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * add element at index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, T element)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * remove element</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(T element)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * remove element by index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * set element by index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> old element</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, T element)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get element by index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * clear list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * contain certain element</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(T element)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get list size</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/wangweiX/java-algorithms/blob/master/src/main/java/one/wangwei/algorithms/datastructures/list/IList.java" target="_blank" rel="noopener">æºä»£ç </a></p></blockquote><p>æ¥å£å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.algorithms.datastructures.list.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> one.wangwei.algorithms.datastructures.list.IList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Array List</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> https://wangwei.one</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/04/27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyArrayList</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">IList</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * default array size</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_SIZE = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * array size</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> T[] array = (T[]) <span class="keyword">new</span> Object[DEFAULT_SIZE];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * add element</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(T element)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> add(size, element);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * add element at index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, T element)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; size) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ArrayIndexOutOfBoundsException(<span class="string">"Index: "</span> + index + <span class="string">", Size: "</span> + size);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// need grow</span></span><br><span class="line">        <span class="keyword">if</span> (size &gt;= array.length) &#123;</span><br><span class="line">            grow();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// copy array element</span></span><br><span class="line">        <span class="keyword">if</span> (index &lt; size) &#123;</span><br><span class="line">            System.arraycopy(array, index, array, index + <span class="number">1</span>, size - index);</span><br><span class="line">        &#125;</span><br><span class="line">        array[index] = element;</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * grow 50%</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">grow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> growSize = size + (size &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        array = Arrays.copyOf(array, growSize);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * remove element</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(T element)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (element == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (array[i] == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    remove(i);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (array[i].equals(element)) &#123;</span><br><span class="line">                    remove(i);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * remove element by index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        checkPositionIndex(index);</span><br><span class="line">        T oldElement = array[index];</span><br><span class="line">        <span class="comment">// need copy element</span></span><br><span class="line">        <span class="keyword">if</span> (index != (size - <span class="number">1</span>)) &#123;</span><br><span class="line">            System.arraycopy(array, index + <span class="number">1</span>, array, index, size - index - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        --size;</span><br><span class="line">        array[size] = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">// shrink 25%</span></span><br><span class="line">        <span class="keyword">int</span> shrinkSize = size - (size &gt;&gt; <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">if</span> (shrinkSize &gt;= DEFAULT_SIZE &amp;&amp; shrinkSize &gt; size) &#123;</span><br><span class="line">            shrink();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> oldElement;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * shrink 25%</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">shrink</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> shrinkSize = size - (size &gt;&gt; <span class="number">2</span>);</span><br><span class="line">        array = Arrays.copyOf(array, shrinkSize);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * set element by index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, T element)</span> </span>&#123;</span><br><span class="line">        checkPositionIndex(index);</span><br><span class="line">        T oldElement = array[index];</span><br><span class="line">        array[index] = element;</span><br><span class="line">        <span class="keyword">return</span> oldElement;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get element by index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        checkPositionIndex(index);</span><br><span class="line">        <span class="keyword">return</span> array[index];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * check index</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkPositionIndex</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= size) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException(<span class="string">"Index: "</span> + index + <span class="string">", Size: "</span> + size);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * clear list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            array[i] = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * contain certain element</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(T element)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (element == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (array[i] == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (array[i].equals(element)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get list size</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/wangweiX/java-algorithms/blob/master/src/main/java/one/wangwei/algorithms/datastructures/list/impl/MyArrayList.java" target="_blank" rel="noopener">æºä»£ç </a></p></blockquote><p>ä¸»è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>æ·»åŠ å…ƒç´ æ—¶ ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦å¯¹Arrayè¿›è¡Œæ‰©å®¹ï¼›</li><li>åˆ é™¤å…ƒç´ æ—¶ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦å¯¹Arrayè¿›è¡Œæ”¶ç¼©ï¼›</li><li>removeä¸containsæ¥å£ï¼Œæ³¨æ„elementä¸ºnullçš„æƒ…å†µï¼›</li></ul><h2 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><ul><li>å¯¹æ•°æ®è¿›è¡Œéå†çš„æ—¶å€™ï¼Œæ•°æ®åœ¨è¿ç»­çš„ç‰©ç†ç©ºé—´ä¸­è¿›è¡Œå­˜æ”¾ï¼ŒCPUçš„å†…éƒ¨ç¼“å­˜ç»“æ„ä¼šç¼“å­˜è¿ç»­çš„å†…å­˜ç‰‡æ®µï¼Œå¯ä»¥å¤§å¹…é™ä½è¯»å–å†…å­˜çš„æ€§èƒ½å¼€é”€ï¼Œæ‰€ä»¥æŸ¥è¯¢æ¯”è¾ƒå¿«ï¼›</li><li>åˆ é™¤çº¿æ€§è¡¨ä¸­çš„å…ƒç´ çš„æ—¶å€™ï¼Œåé¢çš„å…ƒç´ ä¼šæ•´ä½“å‘å‰ç§»åŠ¨ï¼Œæ‰€ä»¥åˆ é™¤çš„æ•ˆç‡è¾ƒä½ï¼Œæ’å…¥ç±»ä¼¼ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼›</li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="http://data.biancheng.net/view/4.html" target="_blank" rel="noopener">http://data.biancheng.net/view/4.html</a></li><li><a href="https://github.com/phishman3579/java-algorithms-implementation" target="_blank" rel="noopener">https://github.com/phishman3579/java-algorithms-implementation</a></li><li>ã€Š<a href="http://gk.link/a/101Nt" target="_blank" rel="noopener">æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾</a>ã€‹</li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> AlgoDS </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Java 11 æ•™ç¨‹]]></title>
      <url>/posts/java-11-base-tutorial.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/cover/architecture-buildings-city-313782.webp?imageslim" alt="new era"></p><blockquote><p>åŸæ–‡ï¼š<a href="https://winterbe.com/posts/2018/09/24/java-11-tutorial/" target="_blank" rel="noopener">é“¾æ¥</a></p><p>ä½œè€…ï¼š<a href="https://github.com/winterbe" target="_blank" rel="noopener">Benjamin Winterberg</a></p><p>ç¿»è¯‘ï¼š<a href="https://wangwei.one">Wang Wei</a></p></blockquote><p><a href="http://openjdk.java.net/projects/jdk/11/" target="_blank" rel="noopener">Java11</a> å·²äº 2018/09/25 æˆåŠŸå‘å¸ƒï¼Œä¸è¿‡ç›®å‰ <a href="https://twitter.com/winterbe_/status/1035864662976413696" target="_blank" rel="noopener">ç»å¤§å¤šæ•°äºº</a> åœ¨ç”Ÿäº§ç¯å¢ƒä»æ—§ä½¿ç”¨çš„æ˜¯Java 8ã€‚è¿™ç¯‡ä»¥æ¡ˆä¾‹ä¸ºä¸»çš„æ•™ç¨‹æ¶µç›–äº†ä» Java 9 åˆ° Java 11çš„ç»å¤§å¤šæ•°é‡è¦çš„è¯­æ³•ä¸APIç‰¹æ€§ã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼</p><a id="more"></a><h2 id="å±€éƒ¨å˜é‡ç±»å‹æ¨æ–­"><a href="#å±€éƒ¨å˜é‡ç±»å‹æ¨æ–­" class="headerlink" title="å±€éƒ¨å˜é‡ç±»å‹æ¨æ–­"></a>å±€éƒ¨å˜é‡ç±»å‹æ¨æ–­</h2><p>Java 10å¼•å…¥äº†ä¸€ä¸ªæ–°çš„è¯­è¨€å…³é”®å­—<code>var</code>ï¼Œå®ƒå¯ä»¥åœ¨å£°æ˜<em>å±€éƒ¨å˜é‡</em> æ—¶æ›¿æ¢ç±»å‹ä¿¡æ¯ï¼ˆ <em>å±€éƒ¨</em> æ„å‘³ç€æ–¹æ³•ä½“å†…çš„å˜é‡å£°æ˜ï¼‰ã€‚</p><p>Java 10ä¹‹å‰ï¼Œå˜é‡çš„å£°æ˜å½¢å¼å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String text = <span class="string">"Hello Java 9"</span>;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>var</code> æ›¿æ¢ <code>String</code> ã€‚ç¼–è¯‘å™¨å°†ä¼šä»å˜é‡çš„èµ‹å€¼ä¸­æ¨æ–­å‡ºå®ƒçš„æ­£ç¡®ç±»å‹ã€‚åœ¨è¿™ä¸ªä¾‹å­é‡Œ å˜é‡<code>text</code> å³ä¸º <code>String</code> ç±»å‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var text = <span class="string">"Hello Java 10"</span>;</span><br></pre></td></tr></table></figure><p>ä¸åŒäº Javascript ä¸­çš„ <code>var</code> å…³é”®å­—ï¼ŒJavaä¸­çš„ <code>var</code> å£°æ˜çš„å˜é‡ä»æ—§æ˜¯é™æ€ç±»å‹ã€‚ä½ ä¸èƒ½å†æ¬¡èµ‹äºˆå¦ä¸€ä¸ªä¸åŸç±»å‹ä¸ç¬¦çš„å˜é‡å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var text = <span class="string">"Hello Java 11"</span>;</span><br><span class="line">text = <span class="number">23</span>;  <span class="comment">// ERROR: Incompatible types(ç±»å‹é”™è¯¯)</span></span><br></pre></td></tr></table></figure><p><code>var</code> å…³é”®å­—è¿˜å¯ä»¥ä¸ <code>final</code> ä¸€èµ·ä½¿ç”¨ï¼Œæ„ä¹‰åŒä¹‹å‰çš„ç‰ˆæœ¬ä¸€æ ·ï¼Œè¡¨ç¤ºä¸å¯ä¿®æ”¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> var text = <span class="string">"Hello Java 10"</span>;</span><br><span class="line">text = <span class="string">"Hello Java 11"</span>; <span class="comment">// Cannot assign a value to final variable 'text'</span></span><br></pre></td></tr></table></figure><p>å½“ç¼–è¯‘å™¨ä¸èƒ½æ­£ç¡®è¯†åˆ«å‡ºå˜é‡çš„æ•°å€¼ç±»å‹æ—¶ï¼Œ<code>var</code>å°†ä¸è¢«å…è®¸ä½¿ç”¨ã€‚ä¸‹é¢è¿™äº›ä»£ç éƒ½æ˜¯æ²¡æ³•ç¼–è¯‘çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Cannot infer type:</span></span><br><span class="line">var a;</span><br><span class="line">var nothing = <span class="keyword">null</span>;</span><br><span class="line">var lambda = () -&gt; System.out.println(<span class="string">"Pity!"</span>);</span><br><span class="line">var method = <span class="keyword">this</span>::someMethod;</span><br></pre></td></tr></table></figure><p>å±€éƒ¨å˜é‡ç±»å‹æ¨æ–­åœ¨ä¸å¤æ‚çš„æ³›å‹ç±»å‹ç»“åˆæ—¶ï¼Œèƒ½æ”¾å¤§å®ƒçš„ä»·å€¼ã€‚åœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>current</code> æ˜¯æœ‰ç€ä¸€ä¸ªå†—é•¿çš„æ•°æ®ç±»å‹ <code>Map&lt;String, List&lt;Integer&gt;&gt;</code> ï¼Œä¸è¿‡å®ƒçš„ç±»å‹å£°æ˜å¯ä»¥è¢« <code>var</code> è¿™ä¸ªå…³é”®å­—ç®€å•åœ°æ›¿æ¢æ‰ï¼Œè®©ä½ é¿å…äº†å†™ä¸€å¤§çªœçš„ç±»å‹éº»çƒ¦äº‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var myList = <span class="keyword">new</span> ArrayList&lt;Map&lt;String, List&lt;Integer&gt;&gt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (var current : myList) &#123;</span><br><span class="line">    <span class="comment">// current is infered to type: Map&lt;String, List&lt;Integer&gt;&gt;</span></span><br><span class="line">    System.out.println(current);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»Java 11å¼€å§‹ï¼Œlambdaè¡¨è¾¾å¼çš„å‚æ•°ä¹Ÿå…è®¸ä½¿ç”¨varå…³é”®å­—ï¼Œè¿™æ ·ä½¿å¾—ä½ å¯ä»¥ä¸ºè¿™äº›å‚æ•°æ·»åŠ æ³¨è§£æ ‡è¯†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Predicate&lt;String&gt; predicate = (<span class="meta">@Nullable</span> var a) -&gt; <span class="keyword">true</span>;</span><br></pre></td></tr></table></figure><blockquote><p>Tipï¼šåœ¨Intellij IDEAä¸­ï¼Œä½ å¯ä»¥åœ¨æŒ‰ä½CMD / CTRLçš„åŒæ—¶å°†é¼ æ ‡æ‚¬åœåœ¨å˜é‡ä¸Šï¼Œä»¥æ˜¾ç¤ºå˜é‡çš„æ¨æ–­ç±»å‹ã€‚</p></blockquote><h2 id="HTTP-Client"><a href="#HTTP-Client" class="headerlink" title="HTTP Client"></a>HTTP Client</h2><p>Java 9å¼•å…¥äº†ä¸€ä¸ªæ–°çš„å­µåŒ–<code>HttpClient</code> APIæ¥å¤„ç†HTTPè¯·æ±‚ã€‚ä»Java 11å¼€å§‹ï¼Œè¿™ä¸ªAPIå·²ç»å¯ä»¥åœ¨æ ‡å‡†åº“ <code>java.net</code> ä¸­ä½¿ç”¨äº†ã€‚è®©æˆ‘ä»¬æ¥æ¢ç´¢ä¸€ä¸‹é€šè¿‡è¿™ä¸ªAPIæˆ‘ä»¬å¯ä»¥åšäº›ä»€ä¹ˆã€‚</p><p>è¿™ä¸ªæ–°çš„ <code>HttpClient</code> æ—¢å¯ä»¥è¢«åŒæ­¥ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥è¢«å¼‚æ­¥ä½¿ç”¨ã€‚åŒæ­¥è¯·æ±‚å°†ä¼šé˜»å¡å½“å‰çš„çº¿ç¨‹ï¼Œç›´åˆ°è¿”å›å“åº”æ¶ˆæ¯ã€‚<code>BodyHandlers</code> å®šä¹‰äº†å“åº”æ¶ˆæ¯ä½“çš„ç±»å‹ï¼ˆe.g stringï¼Œbyte-array æˆ– fileï¼‰:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var request = HttpRequest.newBuilder()</span><br><span class="line">    .uri(URI.create(<span class="string">"https://wangwei.one"</span>))</span><br><span class="line">    .GET()</span><br><span class="line">    .build();</span><br><span class="line">var client = HttpClient.newHttpClient();</span><br><span class="line">HttpResponse&lt;String&gt; response = client.send(request, HttpResponse.BodyHandlers.ofString());</span><br><span class="line">System.out.println(response.body());</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„è¯·æ±‚ä¹Ÿå¯ä»¥è¢«å¼‚æ­¥æ‰§è¡Œã€‚è°ƒç”¨ <code>sendAsync</code> æ–¹æ³•ä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œå¹¶ä¸”ä¼šè¿”å› <code>CompletableFuture</code> å¯¹è±¡ï¼Œç”¨æ¥æ„å»ºå¼‚æ­¥æ‰§è¡Œç»“æœçš„æ“ä½œæµã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var request = HttpRequest.newBuilder()</span><br><span class="line">    .uri(URI.create(<span class="string">"https://wangwei.one"</span>))</span><br><span class="line">    .build();</span><br><span class="line">var client = HttpClient.newHttpClient();</span><br><span class="line">client.sendAsync(request, HttpResponse.BodyHandlers.ofString())</span><br><span class="line">    .thenApply(HttpResponse::body)</span><br><span class="line">    .thenAccept(System.out::println);</span><br></pre></td></tr></table></figure><blockquote><p>æˆ‘ä»¬å¯ä»¥çœç•¥ <code>.GET()</code> çš„è°ƒç”¨ï¼Œå› ä¸ºå®ƒé»˜è®¤çš„è¯·æ±‚æ–¹å¼ã€‚</p></blockquote><p>ä¸‹é¢è¿™ä¸ªåˆ—å­ï¼Œæˆ‘ä»¬ä»¥<code>POST</code>çš„æ–¹æ³•å‘æŒ‡å®šçš„URLå‘é€æ•°æ®ã€‚ç±»ä¼¼äº <code>BodyHandlers</code> ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>BodyPublishers</code> å»å®šä¹‰è¯·æ±‚æ¶ˆæ¯ä½“ä¸­ä½ æƒ³è¦å‘é€çš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚ strings, byte-arrays,files æˆ– input-streams:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var request = HttpRequest.newBuilder()</span><br><span class="line">    .uri(URI.create(<span class="string">"https://postman-echo.com/post"</span>))</span><br><span class="line">    .header(<span class="string">"Content-Type"</span>, <span class="string">"text/plain"</span>)</span><br><span class="line">    .POST(HttpRequest.BodyPublishers.ofString(<span class="string">"Hi there!"</span>))</span><br><span class="line">    .build();</span><br><span class="line">var client = HttpClient.newHttpClient();</span><br><span class="line">var response = client.send(request, HttpResponse.BodyHandlers.ofString());</span><br><span class="line">System.out.println(response.statusCode());      <span class="comment">// 200</span></span><br></pre></td></tr></table></figure><p>æœ€åè¿™ä¸ªåˆ—å­æ¥æ¼”ç¤ºå¦‚ä½•é€šè¿‡ <code>BASIC-AUTH</code> æ¥æ‰§è¡Œèº«ä»½è®¤è¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var request = HttpRequest.newBuilder()</span><br><span class="line">    .uri(URI.create(<span class="string">"https://postman-echo.com/basic-auth"</span>))</span><br><span class="line">    .build();</span><br><span class="line">var client = HttpClient.newBuilder()</span><br><span class="line">    .authenticator(<span class="keyword">new</span> Authenticator() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> PasswordAuthentication <span class="title">getPasswordAuthentication</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> PasswordAuthentication(<span class="string">"postman"</span>, <span class="string">"password"</span>.toCharArray());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .build();</span><br><span class="line">var response = client.send(request, HttpResponse.BodyHandlers.ofString());</span><br><span class="line">System.out.println(response.statusCode());      <span class="comment">// 200</span></span><br></pre></td></tr></table></figure><h2 id="Collections"><a href="#Collections" class="headerlink" title="Collections"></a>Collections</h2><p>åƒ<code>List</code>, <code>Set</code> å’Œ <code>Map</code> è¿™æ ·çš„é›†åˆï¼Œå®ƒä»¬çš„APIä¹Ÿå¾—åˆ°äº†æ‰©å±•ã€‚<code>List.of</code> å¯ä»¥ä»ç»™å®šçš„å‚æ•°ä¸­åˆ›å»ºä¸€ä¸ªä¸å¯å˜çš„listã€‚<code>List.copyOf</code> å¯ä»¥åˆ›å»ºä¸€ä¸ª list çš„ä¸å¯å˜å‰¯æœ¬ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var list = List.of(<span class="string">"A"</span>, <span class="string">"B"</span>, <span class="string">"C"</span>);</span><br><span class="line">var copy = List.copyOf(list);</span><br><span class="line">System.out.println(list == copy);   <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>å› ä¸º <code>list</code> å·²ç»æ˜¯ä¸å¯å˜çš„ï¼Œæ‰€ä»¥å®é™…ä¸Šä¸éœ€è¦å®é™…åœ°åœ°å»åˆ›å»º <code>list</code> å®ä¾‹çš„å‰¯æœ¬ï¼Œå› æ­¤ <code>list</code> å’Œ <code>copy</code> æ˜¯ç›¸åŒçš„å®ä¾‹ã€‚ ä½†æ˜¯ï¼Œå¦‚æœä½ å¤åˆ¶ä¸€ä¸ªå¯å˜åˆ—è¡¨ï¼Œé‚£ä¹ˆ <code>copy</code> ç¡®å®šå°±æ˜¯ä¸€ä¸ªæ–°å®ä¾‹ï¼Œå› æ­¤åœ¨æ”¹å˜åŸå§‹ list æ—¶ï¼Œè¦ä¿è¯æ²¡æœ‰å‰¯ä½œç”¨äº§ç”Ÿï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var list = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">var copy = List.copyOf(list);</span><br><span class="line">System.out.println(list == copy);   <span class="comment">// false</span></span><br></pre></td></tr></table></figure><p>å½“åˆ›å»ºä¸å¯å˜çš„ maps æ—¶ï¼Œä½ ä¸éœ€è¦äº²è‡ªå»åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„ map é›†åˆï¼Œä½ å¯ä»¥ç›´æ¥é€šè¿‡ <code>Map.of</code> æ¥è¿›è¡Œåˆ›å»ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var map = Map.of(<span class="string">"A"</span>, <span class="number">1</span>, <span class="string">"B"</span>, <span class="number">2</span>);</span><br><span class="line">System.out.println(map);    <span class="comment">// &#123;B=2, A=1&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>Java 11ä¸­çš„ä¸å¯å˜é›†åˆä»ç„¶ä½¿ç”¨æ—§<a href="https://docs.oracle.com/javase/10/docs/api/java/util/Collection.html" target="_blank" rel="noopener">Collection API</a>ä¸­çš„ç›¸åŒæ¥å£ã€‚ ä½†æ˜¯ï¼Œå¦‚æœå°è¯•é€šè¿‡æ·»åŠ æˆ–åˆ é™¤å…ƒç´ æ¥ä¿®æ”¹ä¸å¯å˜é›†åˆï¼Œåˆ™ä¼šæŠ›å‡ºjava.lang.UnsupportedOperationExceptionã€‚ å¹¸è¿çš„æ˜¯ï¼Œå¦‚æœä½ å°è¯•æ”¹å˜ä¸å¯å˜é›†åˆï¼ŒIntellij IDEAä¼šé€šè¿‡æ£€æŸ¥å‘å‡ºè­¦å‘Šã€‚</p></blockquote><h2 id="Streams"><a href="#Streams" class="headerlink" title="Streams"></a>Streams</h2><p>Java8ä¸­ä»‹ç»çš„Streamä¹Ÿæ–°å¢äº†æ–¹æ³•ã€‚<code>Stream.ofNullable</code> å¯ä»¥ä»å•ä¸ªå…ƒç´ ä¸­æ„é€ ä¸€ä¸ªStream:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stream.ofNullable(<span class="keyword">null</span>).count(); <span class="comment">// 0</span></span><br></pre></td></tr></table></figure><p><code>dropWhile</code> ä¸ <code>takeWhile</code> æ–¹æ³•å¯ä»¥ç”¨æ¥å†³å®šstreamä¸­çš„å“ªäº›å…ƒç´ å¯ä»¥è¢«æŠ›å¼ƒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">    .dropWhile(n -&gt; n &lt; <span class="number">3</span>)</span><br><span class="line">    .collect(Collectors.toList());  <span class="comment">// [3, 2, 1]</span></span><br><span class="line"></span><br><span class="line">Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">    .takeWhile(n -&gt; n &lt; <span class="number">3</span>)</span><br><span class="line">    .collect(Collectors.toList());  <span class="comment">// [1, 2]</span></span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœä½ å¯¹Streamsä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œä½ å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç«  <a href="https://winterbe.com/posts/2014/07/31/java8-stream-tutorial-examples/" target="_blank" rel="noopener">Java 8 Streams Tutorial</a>.</p></blockquote><h2 id="Optionals"><a href="#Optionals" class="headerlink" title="Optionals"></a>Optionals</h2><p><code>Optionals</code> ä¹Ÿæ–°å¢äº†ä¸€äº›éå¸¸å¥½ç”¨çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œç°åœ¨ä½ å¯ä»¥ç®€å•åœ°å°† <code>Optionals</code> è½¬æ¢ä¸º <code>Streams</code>ï¼Œæˆ–è€…ä½¿ç”¨å¦ä¸€ä¸ªoptionalä½œä¸ºä¸€ä¸ªç©ºoptionalçš„fallbackã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Optional.of(<span class="string">"foo"</span>).orElseThrow();     <span class="comment">// foo</span></span><br><span class="line">Optional.of(<span class="string">"foo"</span>).stream().count();  <span class="comment">// 1</span></span><br><span class="line">Optional.ofNullable(<span class="keyword">null</span>)</span><br><span class="line">    .or(() -&gt; Optional.of(<span class="string">"fallback"</span>))</span><br><span class="line">    .get();                           <span class="comment">// fallback</span></span><br></pre></td></tr></table></figure><h2 id="Strings"><a href="#Strings" class="headerlink" title="Strings"></a>Strings</h2><p>æœ€åŸºæœ¬çš„ç±»ä¹‹ä¸€ <code>String</code> æ–°å¢äº†ä¸€äº›è¾…åŠ©æ–¹æ³•ï¼Œç”¨ä»¥ä¿®å‰ªæˆ–æ£€æŸ¥ç©ºæ ¼ä»¥åŠå¯¹å­—ç¬¦ä¸²è¿›è¡ŒæµåŒ–å¤„ç†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">" "</span>.isBlank();                <span class="comment">// true</span></span><br><span class="line"><span class="string">" Foo Bar "</span>.strip();          <span class="comment">// "Foo Bar"</span></span><br><span class="line"><span class="string">" Foo Bar "</span>.stripTrailing();  <span class="comment">// " Foo Bar"</span></span><br><span class="line"><span class="string">" Foo Bar "</span>.stripLeading();   <span class="comment">// "Foo Bar "</span></span><br><span class="line"><span class="string">"Java"</span>.repeat(<span class="number">3</span>);             <span class="comment">// "JavaJavaJava"</span></span><br><span class="line"><span class="string">"A\nB\nC"</span>.lines().count();    <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><h2 id="InputStreams"><a href="#InputStreams" class="headerlink" title="InputStreams"></a>InputStreams</h2><p>æœ€åä½†å¹¶éæœ€ä¸é‡è¦çš„æ˜¯ï¼Œ<code>InputStream</code>æœ€ç»ˆè·å¾—äº†ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ–¹æ³•æ¥å°†æ•°æ®ä¼ è¾“åˆ°OutputStreamï¼Œè¿™æ˜¯ä¸€ä¸ªåœ¨å¤„ç†åŸå§‹æ•°æ®æµæ—¶éå¸¸å¸¸è§çš„ç”¨ä¾‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var classLoader = ClassLoader.getSystemClassLoader();</span><br><span class="line">var inputStream = classLoader.getResourceAsStream(<span class="string">"myFile.txt"</span>);</span><br><span class="line">var tempFile = File.createTempFile(<span class="string">"myFileCopy"</span>, <span class="string">"txt"</span>);</span><br><span class="line"><span class="keyword">try</span> (var outputStream = <span class="keyword">new</span> FileOutputStream(tempFile)) &#123;</span><br><span class="line">    inputStream.transferTo(outputStream);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–JVMç‰¹æ€§"><a href="#å…¶ä»–JVMç‰¹æ€§" class="headerlink" title="å…¶ä»–JVMç‰¹æ€§"></a>å…¶ä»–JVMç‰¹æ€§</h2><p>è¿™äº›æ˜¯ - åœ¨æˆ‘çœ‹æ¥ - ä»Java 8è¿ç§»åˆ°11æ—¶æœ€æœ‰è¶£çš„è¯­è¨€æ–°APIåŠŸèƒ½ã€‚ä½†æ˜¯åŠŸèƒ½åˆ—è¡¨å¹¶æ²¡æœ‰åœ¨è¿™é‡Œç»“æŸã€‚ æœ€æ–°çš„Javaç‰ˆæœ¬ä¸­åŒ…å«äº†æ›´å¤šå†…å®¹ï¼š</p><ul><li><a href="https://community.oracle.com/docs/DOC-1006738" target="_blank" rel="noopener">Flow API for reactive programming</a></li><li><a href="https://www.oracle.com/corporate/features/understanding-java-9-modules.html" target="_blank" rel="noopener">Java Module System</a></li><li><a href="https://blog.codefx.org/java/application-class-data-sharing/" target="_blank" rel="noopener">Application Class Data Sharing</a></li><li><a href="http://openjdk.java.net/jeps/309" target="_blank" rel="noopener">Dynamic Class-File Constants</a></li><li><a href="https://docs.oracle.com/javase/10/jshell/introduction-jshell.htm#JSHEL-GUID-630F27C8-1195-4989-9F6B-2C51D46F52C8" target="_blank" rel="noopener">Java REPL (JShell)</a></li><li><a href="http://openjdk.java.net/jeps/328" target="_blank" rel="noopener">Flight Recorder</a></li><li><a href="http://openjdk.java.net/jeps/327" target="_blank" rel="noopener">Unicode 10</a></li><li><a href="https://blog.idrsolutions.com/2018/04/java-10-improvements-to-garbage-collection-explained-in-5-minutes/" target="_blank" rel="noopener">G1: Full Parallel Garbage Collector</a></li><li><a href="http://openjdk.java.net/jeps/333" target="_blank" rel="noopener">ZGC: Scalable Low-Latency Garbage Collector</a></li><li><a href="http://openjdk.java.net/jeps/318" target="_blank" rel="noopener">Epsilon: No-Op Garbage Collector</a></li><li><a href="http://openjdk.java.net/jeps/335" target="_blank" rel="noopener">Deprecate the Nashorn JavaScript Engine</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Java11 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[åŸºäºJavaè¯­è¨€æ„å»ºåŒºå—é“¾ï¼ˆä¸ƒï¼‰â€”â€” äº¤æ˜“è„šæœ¬ï¼ˆæ™ºèƒ½åˆçº¦ï¼‰]]></title>
      <url>/posts/build-blockchain-in-java-transaction-script.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/rawpixel-652547-unsplash.jpg-webp" alt=""></p><p><a href="https://wangwei.one/posts/630e7ae5.html">ä¸Šä¸€ç¯‡</a> æ–‡ç« æˆ‘ä»¬å¼•å…¥ UTXOset å’Œ Merkle Tree å¯¹äº¤æ˜“æµç¨‹åšäº†äº›è®¸ä¼˜åŒ–ï¼Œæœ¬ç¯‡æ–‡ç« æˆ‘ä»¬å°†ä»‹ç»æ¯”ç‰¹å¸å¦ä¸€ä¸ªæ›´åŠ é‡è¦çš„æœºåˆ¶ â€”â€” äº¤æ˜“è„šæœ¬ã€‚</p><p>åœ¨ä»‹ç» <a href="https://wangwei.one/posts/9cf9e42a.html">UTXOçš„æ–‡ç« </a> ä¸­ï¼Œæˆ‘ä»¬å·²ç»äº†è§£åˆ°æ¯”ç‰¹å¸çš„äº¤æ˜“è¾“å‡ºç”±é”å®šè„šæœ¬é”å®šï¼Œå®ƒåªèƒ½è¢«äº¤æ˜“è¾“å‡ºæ‰€è¢«æŒ‡å‘çš„äº¤æ˜“è¾“å…¥ä¸­çš„è§£é”è„šæœ¬æ‰€è§£é”ï¼Œä»Šå¤©è®©æˆ‘ä»¬æ¥è¯¦ç»†è®¨è®ºä¸€ä¸‹å®ƒä»¬çš„å®ç°æœºåˆ¶ã€‚</p><a id="more"></a><h2 id="äº¤æ˜“è¯¦æƒ…"><a href="#äº¤æ˜“è¯¦æƒ…" class="headerlink" title="äº¤æ˜“è¯¦æƒ…"></a>äº¤æ˜“è¯¦æƒ…</h2><p>å¦‚ä»Šï¼Œå¤§å¤šæ•°æ¯”ç‰¹å¸ç½‘ç»œå¤„ç†çš„äº¤æ˜“æ˜¯ä»¥â€œAliceä»˜ç»™Bobâ€çš„å½¢å¼å­˜åœ¨çš„ã€‚åŒæ—¶ï¼Œå®ƒä»¬æ˜¯ä»¥ä¸€ç§ç§°ä¸ºâ€œP2PKHâ€ï¼ˆPay-to-Public-Key-Hashï¼‰è„šæœ¬ä¸ºåŸºç¡€çš„ã€‚ç„¶è€Œï¼Œé€šè¿‡ä½¿ç”¨è„šæœ¬æ¥é”å®šè¾“å‡ºå’Œè§£é”è¾“å…¥æ„å‘³ç€é€šè¿‡ä½¿ç”¨ç¼–ç¨‹è¯­è¨€ï¼Œæ¯”ç‰¹å¸äº¤æ˜“å¯ä»¥åŒ…å«æ— é™æ•°é‡çš„æ¡ä»¶ã€‚å½“ç„¶ï¼Œæ¯”ç‰¹å¸äº¤æ˜“å¹¶ä¸é™äºâ€œAliceä»˜ç»™Bobâ€ çš„å½¢å¼å’Œæ¨¡å¼ã€‚â€</p><p>è¿™åªæ˜¯è¿™ä¸ªè„šæœ¬è¯­è¨€å¯ä»¥è¡¨è¾¾çš„å¯èƒ½æ€§çš„å†°å±±ä¸€è§’ã€‚ç¨åï¼Œ æˆ‘ä»¬å°†ä¼šå…¨é¢å±•ç¤ºæ¯”ç‰¹å¸äº¤æ˜“è„šæœ¬è¯­è¨€çš„å„ä¸ªç»„æˆéƒ¨åˆ†ï¼›åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿä¼šæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨å®ƒå»è¡¨è¾¾å¤æ‚çš„ä½¿ç”¨æ¡ä»¶ä»¥åŠè§£é”è„šæœ¬å¦‚ä½•å»æ»¡è¶³è¿™äº›èŠ±è´¹æ¡ä»¶ã€‚</p><blockquote><p>æ¯”ç‰¹å¸äº¤æ˜“éªŒè¯å¹¶ä¸åŸºäºä¸€ä¸ªä¸å˜çš„æ¨¡å¼ï¼Œè€Œæ˜¯é€šè¿‡è¿è¡Œè„šæœ¬è¯­è¨€æ¥å®ç°ã€‚è¿™ç§è¯­è¨€å¯ä»¥è¡¨è¾¾å‡ºå¤šåˆ°æ•°ä¸å°½çš„æ¡ä»¶å˜ç§ã€‚è¿™ä¹Ÿæ˜¯æ¯”ç‰¹å¸ä½œä¸ºä¸€ç§â€œå¯ç¼–ç¨‹çš„è´§å¸â€æ‰€æ‹¥æœ‰çš„æƒåŠ›ã€‚</p></blockquote><p>æˆ‘ä»¬ä»¥<a href="https://github.com/bitcoinbook/bitcoinbook/blob/develop/ch02.asciidoc" target="_blank" rel="noopener">ã€Šç²¾é€šæ¯”ç‰¹å¸ï¼ˆç¬¬äºŒç‰ˆï¼‰ã€‹ç¬¬äºŒç« èŠ‚</a> ä¸­ Aliceå‘Bobè´­ä¹°å’–å•¡ä¸ºä¾‹ï¼Œç‚¹å‡»æŸ¥çœ‹è¯¥ç¬” <a href="https://blockchain.info/tx/0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2" target="_blank" rel="noopener">äº¤æ˜“è¯¦æƒ…</a></p><blockquote><p>äº¤æ˜“è¾“å…¥ï¼š0.1000 BTC</p><p>æ‰‹ç»­è´¹ç”¨ï¼š0.0005 BTC</p><p>æ”¯ä»˜è´¹ç”¨ï¼š0.0150 BTC</p><p>æ‰¾ é›¶ï¼š 0.0845 BTC</p></blockquote><p><img src="https://img.i7years.com/blog/tx-stream.png" alt="tx"></p><p>è¯¥ç¬”äº¤æ˜“çš„æ•°æ®å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"hash"</span>: <span class="string">"0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2"</span>,</span><br><span class="line">    <span class="attr">"locktime"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"size"</span>: <span class="number">258</span>,</span><br><span class="line">    <span class="attr">"txid"</span>: <span class="string">"0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2"</span>,</span><br><span class="line">    <span class="attr">"version"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"vin"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"scriptSig"</span>: &#123;</span><br><span class="line">                <span class="attr">"asm"</span>: <span class="string">"3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813[ALL] 0484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf"</span>,</span><br><span class="line">                <span class="attr">"hex"</span>: <span class="string">"483045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e381301410484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"sequence"</span>: <span class="number">4294967295</span>,</span><br><span class="line">            <span class="attr">"txid"</span>: <span class="string">"7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18"</span>,</span><br><span class="line">            <span class="attr">"vout"</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"vout"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"n"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"scriptPubKey"</span>: &#123;</span><br><span class="line">                <span class="attr">"addresses"</span>: [</span><br><span class="line">                    <span class="string">"1GdK9UzpHBzqzX2A9JFP3Di4weBwqgmoQA"</span></span><br><span class="line">                ],</span><br><span class="line">                <span class="attr">"asm"</span>: <span class="string">"OP_DUP OP_HASH160 ab68025513c3dbd2f7b92a94e0581f5d50f654e7 OP_EQUALVERIFY OP_CHECKSIG"</span>,</span><br><span class="line">                <span class="attr">"hex"</span>: <span class="string">"76a914ab68025513c3dbd2f7b92a94e0581f5d50f654e788ac"</span>,</span><br><span class="line">                <span class="attr">"reqSigs"</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">"type"</span>: <span class="string">"pubkeyhash"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"value"</span>: <span class="number">0.015</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"scriptPubKey"</span>: &#123;</span><br><span class="line">                <span class="attr">"addresses"</span>: [</span><br><span class="line">                    <span class="string">"1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK"</span></span><br><span class="line">                ],</span><br><span class="line">                <span class="attr">"asm"</span>: <span class="string">"OP_DUP OP_HASH160 7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8 OP_EQUALVERIFY OP_CHECKSIG"</span>,</span><br><span class="line">                <span class="attr">"hex"</span>: <span class="string">"76a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac"</span>,</span><br><span class="line">                <span class="attr">"reqSigs"</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">"type"</span>: <span class="string">"pubkeyhash"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"value"</span>: <span class="number">0.0845</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"vsize"</span>: <span class="number">258</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="äº¤æ˜“è¾“å…¥"><a href="#äº¤æ˜“è¾“å…¥" class="headerlink" title="äº¤æ˜“è¾“å…¥"></a>äº¤æ˜“è¾“å…¥</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">"vin": [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"scriptSig"</span>: &#123;</span><br><span class="line">            <span class="attr">"asm"</span>: <span class="string">"3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813[ALL] 0484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf"</span>,</span><br><span class="line">            <span class="attr">"hex"</span>: <span class="string">"483045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e381301410484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"sequence"</span>: <span class="number">4294967295</span>,</span><br><span class="line">        <span class="attr">"txid"</span>: <span class="string">"7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18"</span>,</span><br><span class="line">        <span class="attr">"vout"</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>å®ƒæ‰€åŒ…å«çš„ä¿¡æ¯ï¼š</p><ul><li>äº¤æ˜“IDã€‚åŒ…å«äº†å®ƒæ‰€æŒ‡å‘çš„UTXOçš„äº¤æ˜“çš„Hashå€¼ã€‚</li><li>UTXOä¸‹æ ‡ã€‚å®šä¹‰äº†å®ƒæ‰€æŒ‡å‘çš„UTXOåœ¨ä¸Šä¸€ç¬”äº¤æ˜“ä¸­äº¤æ˜“è¾“å‡ºæ•°ç»„çš„ä½ç½®(ä¸‹æ ‡å€¼)ã€‚</li><li>ç­¾åã€‚ç”¨äºæ»¡è¶³å®ƒæ‰€æŒ‡å‘çš„UTXOä¸Šæ‰€è®¾å®šçš„èŠ±è´¹æ¡ä»¶ã€‚</li></ul><h4 id="äº¤æ˜“è¾“å‡º"><a href="#äº¤æ˜“è¾“å‡º" class="headerlink" title="äº¤æ˜“è¾“å‡º"></a>äº¤æ˜“è¾“å‡º</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">"vout": [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"n"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"scriptPubKey"</span>: &#123;</span><br><span class="line">            <span class="attr">"addresses"</span>: [</span><br><span class="line">                <span class="string">"1GdK9UzpHBzqzX2A9JFP3Di4weBwqgmoQA"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"asm"</span>: <span class="string">"OP_DUP OP_HASH160 ab68025513c3dbd2f7b92a94e0581f5d50f654e7 OP_EQUALVERIFY OP_CHECKSIG"</span>,</span><br><span class="line">            <span class="attr">"hex"</span>: <span class="string">"76a914ab68025513c3dbd2f7b92a94e0581f5d50f654e788ac"</span>,</span><br><span class="line">            <span class="attr">"reqSigs"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"pubkeyhash"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"value"</span>: <span class="number">0.015</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"scriptPubKey"</span>: &#123;</span><br><span class="line">            <span class="attr">"addresses"</span>: [</span><br><span class="line">                <span class="string">"1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"asm"</span>: <span class="string">"OP_DUP OP_HASH160 7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8 OP_EQUALVERIFY OP_CHECKSIG"</span>,</span><br><span class="line">            <span class="attr">"hex"</span>: <span class="string">"76a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac"</span>,</span><br><span class="line">            <span class="attr">"reqSigs"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"pubkeyhash"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"value"</span>: <span class="number">0.0845</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>å®ƒæ‰€åŒ…å«çš„ä¿¡æ¯ï¼š</p><ul><li><p>æ¯”ç‰¹å¸çš„æ•°é‡ã€‚å•ä½ï¼šsatoshisï¼ˆèªï¼‰</p></li><li><p>æ¯”ç‰¹å¸åœ°å€ã€‚äº¤æ˜“è¾“å‡ºæ‰€ç»‘å®šçš„åœ°å€ã€‚</p></li><li><p>é”å®šè„šæœ¬ã€‚å®šä¹‰äº†èŠ±è´¹è¿™ç¬”äº¤æ˜“è¾“å‡ºæ‰€éœ€è¦æ»¡è¶³çš„é™åˆ¶æ¡ä»¶ã€‚å…¶ä¸­åŒ…å«äº†ä¸€äº›å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼š<code>OP_DUP</code>ã€<code>OP_HASH160</code>ã€<code>OP_EQUALVERIFY</code>ã€<code>OP_CHECKSIG</code>ï¼Œè¿™äº›å«æ“ä½œç ï¼Œåé¢ä¼šåšä»‹ç»ã€‚</p></li></ul><p>é‚£ä¹ˆï¼Œäº¤æ˜“è¾“å…¥ä¸­çš„<code>script</code> æ˜¯å¦‚ä½•æ»¡è¶³äº¤æ˜“è¾“å‡ºä¸­<code>script_string</code>çš„é™åˆ¶æ¡ä»¶çš„å‘¢ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥ä¸€èµ·çœ‹ä¸‹æ¯”ç‰¹å¸çš„äº¤æ˜“è„šæœ¬æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹æ¯”ç‰¹å¸æ‰€ç”¨åˆ°è„šæœ¬è¯­è¨€çš„ç‰¹æ€§ä»¥åŠå®ƒçš„å·¥ä½œåŸç†ã€‚</p><h2 id="æ¯”ç‰¹å¸è„šæœ¬è¯­è¨€"><a href="#æ¯”ç‰¹å¸è„šæœ¬è¯­è¨€" class="headerlink" title="æ¯”ç‰¹å¸è„šæœ¬è¯­è¨€"></a>æ¯”ç‰¹å¸è„šæœ¬è¯­è¨€</h2><h3 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h3><p>è„šæœ¬æ˜¯ä¸€ç§ç±»ä¼¼Forthçš„åŸºäºå †æ ˆçš„é€†æ³¢å…°è¡¨ç¤ºæ³•çš„å›¾çµéå®Œå¤‡è¯­è¨€ã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬é€ä¸ªè§£é‡Šä¸€ä¸‹ï¼š</p><h4 id="å›¾çµéå®Œå¤‡ï¼ˆTuring-Incompleteï¼‰"><a href="#å›¾çµéå®Œå¤‡ï¼ˆTuring-Incompleteï¼‰" class="headerlink" title="å›¾çµéå®Œå¤‡ï¼ˆTuring Incompleteï¼‰"></a>å›¾çµéå®Œå¤‡ï¼ˆ<strong>Turing Incomplete</strong>ï¼‰</h4><blockquote><p>ä»€ä¹ˆæ˜¯å›¾çµå®Œå¤‡</p><p>åœ¨<a href="https://zh.wikipedia.org/wiki/%E5%8F%AF%E8%AE%A1%E7%AE%97%E6%80%A7%E7%90%86%E8%AE%BA" target="_blank" rel="noopener">å¯è®¡ç®—æ€§ç†è®º</a>é‡Œï¼Œå¦‚æœä¸€ç³»åˆ—æ“ä½œæ•°æ®çš„è§„åˆ™ï¼ˆå¦‚<a href="https://zh.wikipedia.org/wiki/%E6%8C%87%E4%BB%A4%E9%9B%86" target="_blank" rel="noopener">æŒ‡ä»¤é›†</a>ã€<a href="https://zh.wikipedia.org/wiki/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80" target="_blank" rel="noopener">ç¼–ç¨‹è¯­è¨€</a>ã€<a href="https://zh.wikipedia.org/wiki/%E7%B4%B0%E8%83%9E%E8%87%AA%E5%8B%95%E6%A9%9F" target="_blank" rel="noopener">ç»†èƒè‡ªåŠ¨æœº</a>ï¼‰å¯ä»¥ç”¨æ¥æ¨¡æ‹Ÿ<a href="https://zh.wikipedia.org/wiki/%E5%9B%BE%E7%81%B5%E6%9C%BA" target="_blank" rel="noopener">å•å¸¦å›¾çµæœº</a>ï¼Œé‚£ä¹ˆå®ƒæ˜¯<strong>å›¾çµå®Œå¤‡çš„</strong>ã€‚è¿™ä¸ªè¯æºäºå¼•å…¥å›¾çµæœºæ¦‚å¿µçš„æ•°å­¦å®¶<a href="https://zh.wikipedia.org/wiki/%E8%89%BE%E4%BC%A6%C2%B7%E5%9B%BE%E7%81%B5" target="_blank" rel="noopener">è‰¾å€«Â·å›¾çµ</a>ã€‚</p><p>è™½ç„¶<a href="https://zh.wikipedia.org/wiki/%E5%9B%BE%E7%81%B5%E6%9C%BA" target="_blank" rel="noopener">å›¾çµæœº</a>ä¼šå—åˆ°å‚¨å­˜èƒ½åŠ›çš„<a href="https://zh.wikipedia.org/wiki/%E7%89%A9%E7%90%86" target="_blank" rel="noopener">ç‰©ç†</a>é™åˆ¶ï¼Œå›¾çµå®Œå…¨æ€§é€šå¸¸æŒ‡ã€Œå…·æœ‰æ— é™å­˜å‚¨èƒ½åŠ›çš„é€šç”¨ç‰©ç†æœºå™¨æˆ–ç¼–ç¨‹è¯­è¨€ã€ã€‚</p><p>æ¥æºï¼š<a href="https://zh.wikipedia.org/wiki/%E5%9C%96%E9%9D%88%E5%AE%8C%E5%82%99%E6%80%A7" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘</a></p><p><a href="https://en.wikipedia.org/wiki/Turing_completeness" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Turing_completeness</a></p></blockquote><p>å›¾çµéå®Œå¤‡è¯­è¨€å°†ä¼šæœ‰æœ‰é™çš„åŠŸèƒ½ï¼Œä¸èƒ½è¿›è¡Œè·³è½¬æˆ–/å’Œå¾ªç¯ã€‚å› æ­¤å®ƒä»¬ä¸èƒ½è¿›å…¥æ— çº¿å¾ªç¯ã€‚å›¾çµå®Œå¤‡å°±æ„å‘³ç€ï¼Œåœ¨ç»™å®šçš„è®¡ç®—èµ„æºå’Œå†…å­˜ä¸‹ï¼Œå›¾çµå®Œå¤‡ç¨‹åºï¼Œèƒ½å¤Ÿè§£å†³ä»»ä½•é—®é¢˜ã€‚<a href="https://blockgeeks.com/guides/solidity/" target="_blank" rel="noopener">Solidity</a> å°±æ˜¯å…¶ä¸­ä¸€ç§å›¾çµå®Œå¤‡è¯­è¨€ã€‚</p><h4 id="ä¸ºä»€ä¹ˆæ¯”ç‰¹å¸è„šæœ¬æ˜¯å›¾çµéå®Œå¤‡çš„"><a href="#ä¸ºä»€ä¹ˆæ¯”ç‰¹å¸è„šæœ¬æ˜¯å›¾çµéå®Œå¤‡çš„" class="headerlink" title="ä¸ºä»€ä¹ˆæ¯”ç‰¹å¸è„šæœ¬æ˜¯å›¾çµéå®Œå¤‡çš„"></a>ä¸ºä»€ä¹ˆæ¯”ç‰¹å¸è„šæœ¬æ˜¯å›¾çµéå®Œå¤‡çš„</h4><p>å› ä¸ºæ²¡æœ‰å¿…è¦ã€‚æ¯”ç‰¹å¸è„šæœ¬æ²¡æœ‰å¿…è¦åšåˆ°åƒä»¥å¤ªåŠæ™ºèƒ½åˆçº¦é‚£æ ·å¤æ‚ã€‚äº‹å®ä¸Šï¼Œå¦‚æœä¸€ä¸ªè„šæœ¬æ˜¯å›¾çµå®Œå¤‡çš„ï¼Œå®ƒä¼šç»™æ¶æ„çš„äººä»¥æœºä¼šå»éšæ„åˆ›é€ å¤æ‚çš„äº¤æ˜“ï¼Œè¿™å°†ä¼šåƒæ‰æ¯”ç‰¹å¸ç½‘ç»œçš„å“ˆå¸Œç‡å¹¶é™ä½æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½ã€‚</p><blockquote><p><strong>å“ˆå¸Œç‡</strong>æ˜¯æ¯”ç‰¹å¸ç½‘ç»œçš„å¤„ç†èƒ½åŠ›çš„è¡¡é‡å•ä½ã€‚ä¸ºäº†å®‰å…¨ï¼Œæ¯”ç‰¹å¸ç½‘ç»œå¿…é¡»è¿›è¡Œé«˜å¼ºåº¦çš„æ•°å­¦è¿ç®—ã€‚ç½‘ç»œçš„å“ˆå¸Œç‡è¾¾åˆ°10TH/sï¼Œæ„å‘³ç€è¿™ä¸ªç½‘ç»œæ¯ç§’èƒ½å¤„ç†10äº¿æ¬¡è®¡ç®—ã€‚</p></blockquote><h4 id="é€†æ³¢å…°è¡¨ç¤ºæ³•-Reverse-Polish-notation"><a href="#é€†æ³¢å…°è¡¨ç¤ºæ³•-Reverse-Polish-notation" class="headerlink" title="é€†æ³¢å…°è¡¨ç¤ºæ³•(Reverse Polish notation)"></a>é€†æ³¢å…°è¡¨ç¤ºæ³•(<strong>Reverse Polish notation</strong>)</h4><blockquote><p><strong>é€†æ³¢å…°è¡¨ç¤ºæ³•</strong>ï¼ˆ<strong>Reverse Polish notation</strong>ï¼Œ<strong>RPN</strong>ï¼Œæˆ–<strong>é€†æ³¢å…°è®°æ³•</strong>ï¼‰ï¼Œæ˜¯ä¸€ç§æ˜¯ç”±<a href="https://zh.wikipedia.org/wiki/%E6%B3%A2%E5%85%B0" target="_blank" rel="noopener">æ³¢å…°</a><a href="https://zh.wikipedia.org/wiki/%E6%95%B0%E5%AD%A6%E5%AE%B6" target="_blank" rel="noopener">æ•°å­¦å®¶</a><a href="https://zh.wikipedia.org/wiki/%E6%89%AC%C2%B7%E6%AD%A6%E5%8D%A1%E8%B0%A2%E7%BB%B4%E5%A5%87" target="_blank" rel="noopener">æ‰¬Â·æ­¦å¡è°¢ç»´å¥‡</a>1920å¹´å¼•å…¥çš„æ•°å­¦è¡¨è¾¾å¼æ–¹å¼ï¼Œåœ¨é€†æ³¢å…°è®°æ³•ä¸­ï¼Œæ‰€æœ‰<a href="https://zh.wikipedia.org/w/index.php?title=%E6%93%8D%E4%BD%9C%E7%AC%A6&amp;action=edit&amp;redlink=1" target="_blank" rel="noopener">æ“ä½œç¬¦</a>ç½®äº<a href="https://zh.wikipedia.org/wiki/%E6%93%8D%E4%BD%9C%E6%95%B0" target="_blank" rel="noopener">æ“ä½œæ•°</a>çš„åé¢ï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸º<strong>åç¼€è¡¨ç¤ºæ³•</strong>ã€‚é€†æ³¢å…°è®°æ³•ä¸éœ€è¦æ‹¬å·æ¥æ ‡è¯†æ“ä½œç¬¦çš„ä¼˜å…ˆçº§ã€‚</p><p>æ¥æºï¼š<a href="https://zh.wikipedia.org/wiki/%E9%80%86%E6%B3%A2%E5%85%B0%E8%A1%A8%E7%A4%BA%E6%B3%95" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘</a></p></blockquote><p>ä¾‹å¦‚ï¼š</p><table><thead><tr><th>è§£é‡Š</th><th>å¸¸è§„è¡¨ç¤º</th><th>é€†æ³¢å…°è¡¨ç¤ºæ³•</th></tr></thead><tbody><tr><td>ä¸‰åŠ å››</td><td>3 + 4</td><td>34+</td></tr><tr><td>å…ˆ3å‡å»4ï¼Œå†åŠ ä¸Š5</td><td>3 - 4 + 5</td><td>3 4 - 5 +</td></tr><tr><td>å…ˆ3å‡å»4ï¼Œå†ä¹˜ä»¥5</td><td>(3 - 4)*5</td><td>3 4 - 5 *</td></tr></tbody></table><h4 id="åŸºäºå †æ ˆ"><a href="#åŸºäºå †æ ˆ" class="headerlink" title="åŸºäºå †æ ˆ"></a>åŸºäºå †æ ˆ</h4><p>è¿™æ˜¯ä¸€ç§å…·æœ‰ LIFOï¼ˆLast In First Outï¼‰ç‰¹æ€§çš„æ•°æ®ç»“æ„ï¼Œç†Ÿæ‚‰æ•°æ®ç»“æ„çš„åº”è¯¥éå¸¸æ¸…æ¥šï¼Œè¿™é‡Œä¸å¤šåšä»‹ç»ã€‚</p><blockquote><p>æƒ³æ·±å…¥äº†è§£çš„æœ‹å‹ï¼Œå¯ä»¥æŸ¥çœ‹æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« </p><p><a href="https://wangwei.one/posts/java-data-structures-and-algorithms-stack.html">https://wangwei.one/posts/java-data-structures-and-algorithms-stack.html</a></p></blockquote><p><img src="https://img.i7years.com/blog/stack-1.png" alt="stack"></p><h4 id="ç±»Forthè„šæœ¬è¯­è¨€"><a href="#ç±»Forthè„šæœ¬è¯­è¨€" class="headerlink" title="ç±»Forthè„šæœ¬è¯­è¨€"></a>ç±»Forthè„šæœ¬è¯­è¨€</h4><p>æ¯”ç‰¹å¸è„šæœ¬æ°å¥½ç±»ä¼¼äºç¼–ç¨‹è¯­è¨€â€œForthâ€ï¼Œå®ƒä¹Ÿæ°å¥½æ˜¯åŸºäºå †æ ˆçš„ä¸€ç§ç¼–ç¨‹è¯­è¨€ã€‚</p><blockquote><p>æŸ¥çœ‹ï¼š<a href="https://zh.wikipedia.org/wiki/Forth" target="_blank" rel="noopener">Forthç¼–ç¨‹è¯­è¨€</a></p></blockquote><h3 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h3><p>æ¯”ç‰¹å¸çš„è„šæœ¬è¯­è¨€éå¸¸ç®€å•ï¼Œè¿™ç§è¯­è¨€çš„ä»£ç æ— éå°±æ˜¯ä¸€ç³»åˆ—æ•°æ®å’Œæ“ä½œç¬¦ã€‚è„šæœ¬è¯­è¨€é€šè¿‡ä»å·¦è‡³å³åœ°å¤„ç†æ¯ä¸ªé¡¹ç›®çš„æ–¹å¼æ‰§è¡Œè„šæœ¬ã€‚æ•°å­—ï¼ˆå¸¸æ•°ï¼‰è¢«æ¨é€è‡³å †æ ˆï¼Œæ“ä½œç¬¦å‘å †æ ˆæ¨é€ï¼ˆæˆ–ç§»é™¤ï¼‰ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°ï¼Œå¯¹å®ƒä»¬è¿›è¡Œå¤„ç†ï¼Œç”šè‡³å¯èƒ½ä¼šå‘å †æ ˆæ¨é€ä¸€ä¸ªç»“æœã€‚ä¾‹å¦‚ï¼ŒOP_ADDå°†ä»å †æ ˆç§»é™¤ä¸¤ä¸ªé¡¹ç›®ï¼Œå°†äºŒè€…ç›¸åŠ ï¼Œç„¶åå†å°†äºŒè€…ç›¸åŠ ä¹‹å’Œæ¨é€åˆ°å †æ ˆã€‚</p><p>æ¡ä»¶æ“ä½œç¬¦è¯„ä¼°ä¸€é¡¹æ¡ä»¶ï¼Œäº§ç”Ÿä¸€ä¸ªçœŸæˆ–å‡çš„ç»“æœã€‚ä¾‹å¦‚ï¼ŒOP_EQUALä»å †æ ˆç§»é™¤ä¸¤ä¸ªé¡¹ç›®ï¼Œå‡å¦‚äºŒè€…ç›¸ç­‰åˆ™æ¨é€çœŸï¼ˆè¡¨ç¤ºä¸º1ï¼‰ï¼Œå‡å¦‚äºŒè€…ä¸ç­‰åˆ™æ¨é€ä¸ºå‡ï¼ˆè¡¨ç¤ºä¸º0ï¼‰ã€‚æ¯”ç‰¹å¸äº¤æ˜“è„šæœ¬å¸¸å«æ¡ä»¶æ“ä½œç¬¦ï¼Œå½“ä¸€ç¬”äº¤æ˜“æœ‰æ•ˆæ—¶ï¼Œå°±ä¼šäº§ç”ŸTrueçš„ç»“æœã€‚</p><p>æˆ‘ä»¬ä»¥ä¸€ä¸ªç®€å•çš„è„šæœ¬æ¥è¿›è¡Œæ¼”ç¤ºï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span> <span class="number">3</span> OP_ADD <span class="number">5</span> OP_EQUAL</span><br></pre></td></tr></table></figure><p>ä»å·¦è‡³å³ï¼Œä¾æ¬¡æ‰§è¡Œï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://img.i7years.com/blog/script-example1.png" alt=""></p><p>å¼„æ˜ç™½è¿™ä¸ªè¿‡ç¨‹ä¹‹åï¼Œä½ ä¼šå‘ç°å…¶ä¸­æ‰€è•´å«çš„å †æ ˆç‰¹æ€§ä»¥åŠé€†æ³¢å…°è¡¨ç¤ºæ³•ç‰¹æ€§ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹æ¯”ç‰¹å¸è„šæœ¬çš„é”å®šä¸è§£é”é€»è¾‘ã€‚</p><h2 id="é”å®šä¸è§£é”é€»è¾‘"><a href="#é”å®šä¸è§£é”é€»è¾‘" class="headerlink" title="é”å®šä¸è§£é”é€»è¾‘"></a>é”å®šä¸è§£é”é€»è¾‘</h2><p>æ¯”ç‰¹å¸çš„äº¤æ˜“éªŒè¯å¼•æ“ä¾èµ–äºä¸¤ç±»è„šæœ¬æ¥éªŒè¯æ¯”ç‰¹å¸äº¤æ˜“ï¼šä¸€ä¸ªé”å®šè„šæœ¬å’Œä¸€ä¸ªè§£é”è„šæœ¬ã€‚</p><p><strong>é”å®šè„šæœ¬</strong>æ˜¯æ”¾ç½®åœ¨è¾“å‡ºä¸Šçš„æ¶ˆè´¹æ¡ä»¶ï¼šå®ƒæŒ‡å®šå°†æ¥è¦èŠ±è´¹è¾“å‡ºå¿…é¡»æ»¡è¶³çš„æ¡ä»¶ã€‚é”å®šè„šæœ¬å¸¸è¢«ç§°ä¸º<code>scriptPubKey</code>ï¼Œå› ä¸ºå®ƒé€šå¸¸åŒ…å«å…¬é’¥æˆ–æ¯”ç‰¹å¸åœ°å€ï¼ˆå…¬é’¥å“ˆå¸Œï¼‰ã€‚</p><p><strong>è§£é”è„šæœ¬</strong>æ˜¯é€šè¿‡â€œè§£å†³â€æˆ–æ»¡è¶³é”å®šè„šæœ¬ä¸Šçš„äº¤æ˜“è¾“å‡ºæ¡ä»¶å¹¶å…è®¸äº¤æ˜“è¾“å‡ºèŠ±è´¹çš„è„šæœ¬ã€‚ è§£é”è„šæœ¬æ˜¯æ¯ä¸ªäº¤æ˜“è¾“å…¥çš„ä¸€éƒ¨åˆ†ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒåŒ…å«äº†ç”±ç”¨æˆ·ç§é’¥æ‰€äº§ç”Ÿçš„æ•°å­—ç­¾åã€‚è§£é”è„šæœ¬å¸¸è¢«ç§°ä¸º <code>scriptSig</code> ï¼Œå› ä¸ºå®ƒé€šå¸¸åŒ…å«æ•°å­—ç­¾åã€‚</p><p>æ¯å½“è¦éªŒè¯ä¸€ç¬”äº¤æ˜“çš„æœ‰æ•ˆæ€§æ—¶ï¼Œè§£é”è„šæœ¬å’Œé”å®šè„šæœ¬ä¼šéšç€å †æ ˆçš„ä¼ é€’è¢«åˆ†åˆ«æ‰§è¡Œã€‚é¦–å…ˆï¼Œä½¿ç”¨å †æ ˆæ‰§è¡Œå¼•æ“æ‰§è¡Œè§£é”è„šæœ¬ã€‚å¦‚æœè§£é”è„šæœ¬åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æœªæŠ¥é”™(ä¾‹å¦‚:æ²¡æœ‰â€œæ‚¬æŒ‚â€æ“ä½œç )ï¼Œåˆ™å¤åˆ¶ ä¸»å †æ ˆ(è€Œä¸æ˜¯å¤‡ç”¨å †æ ˆ)ï¼Œå¹¶æ‰§è¡Œé”å®šè„šæœ¬ã€‚å¦‚æœä»è§£é”è„šæœ¬ä¸­å¤åˆ¶è€Œæ¥çš„å †æ ˆæ•°æ®æ‰§è¡Œé”å®šè„šæœ¬çš„ç»“æœ ä¸ºâ€œTRUEâ€ï¼Œé‚£ä¹ˆè§£é”è„šæœ¬å°±æˆåŠŸåœ°æ»¡è¶³äº†é”å®šè„šæœ¬æ‰€è®¾ç½®çš„æ¡ä»¶ï¼Œå› æ­¤ï¼Œè¯¥è¾“å…¥æ˜¯ä¸€ä¸ªèƒ½ä½¿ç”¨è¯¥UTXOçš„æœ‰æ•ˆæˆ æƒã€‚å¦‚æœåœ¨åˆå¹¶è„šæœ¬åçš„ç»“æœä¸æ˜¯â€TRUEâ€œä»¥å¤–çš„ä»»ä½•ç»“æœï¼Œè¾“å…¥éƒ½æ˜¯æ— æ•ˆçš„ï¼Œå› ä¸ºå®ƒä¸èƒ½æ»¡è¶³UTXOä¸­æ‰€è®¾ç½®çš„ä½¿ ç”¨è¯¥ç¬”èµ„é‡‘çš„æ¡ä»¶ã€‚</p><p>ä¸‹å›¾æ‰€ç¤ºæ˜¯æœ€ä¸ºå¸¸è§ç±»å‹çš„æ¯”ç‰¹å¸äº¤æ˜“ï¼ˆå‘å…¬é’¥å“ˆå¸Œè¿›è¡Œä¸€ç¬”æ”¯ä»˜ï¼‰çš„è§£é”å’Œé”å®šè„šæœ¬æ ·æœ¬ï¼Œè¯¥æ ·æœ¬å±•ç¤ºäº†åœ¨è„šæœ¬éªŒè¯ä¹‹å‰å°†è§£é”è„šæœ¬å’Œé”å®šè„šæœ¬ä¸²è”è€Œæˆçš„ç»„åˆè„šæœ¬ã€‚</p><p><img src="https://img.i7years.com/blog/bitcoin-script.png" alt=""></p><p>è¿™æ˜¯æ¯”ç‰¹å¸è„šæœ¬ä¸­ä½¿ç”¨æœ€ä¸ºå¸¸è§çš„ä¸€ç§å½¢å¼ï¼Œåå« <em>Pay to Public Key Hash</em> (P2PKH)ã€‚åŸºäºå‰é¢ <code>2 + 3 = 5</code> çš„éªŒè¯è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° P2PKH è„šæœ¬åœ¨å †æ ˆå¼•æ“ä¸­çš„éªŒè¯è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://img.i7years.com/blog/P2PKH.png" alt=""></p><p>å¥½äº†ï¼Œ åˆ°æ­¤ä¸ºæ­¢ï¼Œä½ å·²ç»å¯¹æ¯”ç‰¹å¸çš„äº¤æ˜“è„šæœ¬ä»¥åŠå®ƒçš„å·¥ä½œåŸç†å·²ç»æœ‰äº†ä¸€ä¸ªéå¸¸æ¸…æ¥šçš„ç†è§£ä¸è®¤è¯†ã€‚</p><p>å‚è€ƒèµ„æ–™</p><ul><li><a href="https://github.com/bitcoinbook/bitcoinbook/blob/develop/ch06.asciidoc" target="_blank" rel="noopener">ã€Šç²¾é€šæ¯”ç‰¹å¸ï¼ˆç¬¬äºŒç‰ˆï¼‰ã€‹ç¬¬å…­ç« </a></li><li><a href="https://jeiwan.cc/posts/building-blockchain-in-go-part-6" target="_blank" rel="noopener">https://jeiwan.cc/posts/building-blockchain-in-go-part-6</a></li><li><a href="https://blockgeeks.com/guides/best-bitcoin-script-guide" target="_blank" rel="noopener">https://blockgeeks.com/guides/best-bitcoin-script-guide</a></li><li><a href="https://blockgeeks.com/guides/bitcoin-script-guide-part-2" target="_blank" rel="noopener">https://blockgeeks.com/guides/bitcoin-script-guide-part-2</a></li><li><a href="https://en.bitcoin.it/wiki/Script" target="_blank" rel="noopener">https://en.bitcoin.it/wiki/Script</a></li></ul>]]></content>
      
        <categories>
            
            <category> blockchain </category>
            
        </categories>
        
        
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> bitcoin </tag>
            
            <tag> bitcoin-script </tag>
            
            <tag> smart contract </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[åŸºäºJavaè¯­è¨€æ„å»ºåŒºå—é“¾ï¼ˆå…­ï¼‰â€”â€” äº¤æ˜“ï¼ˆMerkle Treeï¼‰]]></title>
      <url>/posts/build-blockchain-in-java-transaction-merkle-tree.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/pexels-photo-38136.webp?imageslim" alt="pexels-photo-38136"></p><blockquote><p>æ–‡ç« çš„ä¸»è¦æ€æƒ³å’Œå†…å®¹å‡æ¥è‡ª <a href="https://jeiwan.cc/posts/building-blockchain-in-go-part-6/" target="_blank" rel="noopener">https://jeiwan.cc/posts/building-blockchain-in-go-part-6/</a></p></blockquote><h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>åœ¨è¿™ä¸€ç³»åˆ—æ–‡ç« çš„æœ€å¼€å§‹éƒ¨åˆ†ï¼Œæˆ‘ä»¬æåˆ°è¿‡åŒºå—é“¾æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æ•°æ®åº“ã€‚é‚£æ—¶å€™ï¼Œæˆ‘ä»¬å†³å®šè·³è¿‡â€åˆ†å¸ƒå¼â€è¿™ä¸€ç¯èŠ‚ï¼Œå¹¶ä¸”èšç„¦äºâ€æ•°æ®å­˜å‚¨â€è¿™ä¸€ç¯èŠ‚ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å‡ ä¹å®ç°äº†åŒºå—é“¾çš„æ‰€æœ‰ç»„æˆéƒ¨åˆ†ã€‚åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šæ¶‰åŠä¸€äº›åœ¨å‰é¢çš„æ–‡ç« ä¸­æ‰€å¿½ç•¥çš„ä¸€äº›æœºåˆ¶ï¼Œå¹¶ä¸”åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬å°†å¼€å§‹ç ”ç©¶åŒºå—é“¾çš„åˆ†å¸ƒå¼ç‰¹æ€§ã€‚</p><a id="more"></a><p>å‰é¢å„ä¸ªéƒ¨åˆ†å†…å®¹ï¼š</p><ol><li><a href="https://wangwei.one/posts/df195d9.html">åŸºæœ¬åŸå‹</a></li><li><a href="https://wangwei.one/posts/7890ab7e.html">å·¥ä½œé‡è¯æ˜</a></li><li><a href="https://wangwei.one/posts/35c768a3.html">æŒä¹…åŒ– &amp; å‘½ä»¤è¡Œ</a></li><li><a href="https://wangwei.one/posts/9cf9e42a.html">äº¤æ˜“ï¼ˆUTXOï¼‰</a></li><li><a href="https://wangwei.one/posts/f9088e0f.html">åœ°å€ï¼ˆé’±åŒ…ï¼‰</a></li></ol><h2 id="UTXOæ± "><a href="#UTXOæ± " class="headerlink" title="UTXOæ± "></a>UTXOæ± </h2><p>åœ¨ <a href="https://wangwei.one/posts/35c768a3.html">æŒä¹…åŒ– &amp; å‘½ä»¤è¡Œ</a> è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ç ”ç©¶äº†æ¯”ç‰¹å¸æ ¸å¿ƒå­˜å‚¨åŒºå—çš„æ–¹å¼ã€‚å½“ä¸­æˆ‘ä»¬æåˆ°è¿‡ä¸åŒºå—ç›¸å…³çš„æ•°æ®å­˜å‚¨åœ¨ <strong>blocks</strong> è¿™ä¸ªæ•°æ®æ¡¶ä¸­ï¼Œè€Œäº¤æ˜“æ•°æ®åˆ™å­˜å‚¨åœ¨ <strong>chainstate</strong> è¿™ä¸ªæ•°æ®æ¡¶ä¸­ï¼Œè®©æˆ‘ä»¬æ¥å›å¿†ä¸€ä¸‹ï¼Œ<strong>chainstate</strong> æ•°æ®æ¡¶çš„æ•°æ®ç»“æ„ï¼š</p><ul><li><p>â€˜câ€™ + 32-byte transaction hash -&gt; unspent transaction output record for that transaction</p><blockquote><p>æŸç¬”äº¤æ˜“çš„UTXOè®°å½•</p></blockquote></li></ul><ul><li><p>â€˜Bâ€™ -&gt; 32-byte block hash: the block hash up to which the database represents the unspent transaction outputs</p><blockquote><p>æ•°æ®åº“æ‰€è¡¨ç¤ºçš„UTXOçš„åŒºå—Hash</p></blockquote></li></ul><p>ä»é‚£ç¯‡æ–‡ç« å¼€å§‹ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†æ¯”ç‰¹å¸çš„äº¤æ˜“æœºåˆ¶ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ²¡æœ‰ç”¨åˆ° <strong>chainstate</strong> æ•°æ®æ¡¶å»å­˜å‚¨æˆ‘ä»¬çš„äº¤æ˜“è¾“å‡ºã€‚æ‰€ä»¥ï¼Œè¿™å°†æ˜¯æˆ‘ä»¬ç°åœ¨è¦å»åšçš„äº‹æƒ…ã€‚</p><p><strong>chainstate</strong> ä¸ä¼šå»å­˜å‚¨äº¤æ˜“æ•°æ®ã€‚ç›¸åï¼Œå®ƒå­˜å‚¨çš„æ˜¯ UTXO é›†ï¼Œä¹Ÿå°±æ˜¯æœªè¢«èŠ±è´¹çš„äº¤æ˜“è¾“å‡ºé›†åˆã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜å­˜å‚¨äº†â€æ•°æ®åº“æ‰€è¡¨ç¤ºçš„UTXOçš„åŒºå—Hashâ€ï¼Œæˆ‘ä»¬è¿™é‡Œå…ˆæš‚ä¸”å¿½ç•¥è¿™ä¸€ç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰ç”¨åˆ°åŒºå—é«˜åº¦ï¼ˆè¿™ä¸€ç‚¹æˆ‘ä»¬ä¼šåœ¨åé¢çš„æ–‡ç« è¿›è¡Œå®ç°ï¼‰ã€‚</p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦ UTXO æ± å‘¢ï¼Ÿ</p><p>ä¸€èµ·æ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬å‰é¢å®ç°çš„ <strong>findUnspentTransactions</strong> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * æŸ¥æ‰¾é’±åŒ…åœ°å€å¯¹åº”çš„æ‰€æœ‰æœªèŠ±è´¹çš„äº¤æ˜“</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> pubKeyHash é’±åŒ…å…¬é’¥Hash</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">private</span> Transaction[] findUnspentTransactions(<span class="keyword">byte</span>[] pubKeyHash) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">     Map&lt;String, <span class="keyword">int</span>[]&gt; allSpentTXOs = <span class="keyword">this</span>.getAllSpentTXOs(pubKeyHash);</span><br><span class="line">     Transaction[] unspentTxs = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// å†æ¬¡éå†æ‰€æœ‰åŒºå—ä¸­çš„äº¤æ˜“è¾“å‡º</span></span><br><span class="line">     <span class="keyword">for</span> (BlockchainIterator blockchainIterator = <span class="keyword">this</span>.getBlockchainIterator(); blockchainIterator.hashNext(); ) &#123;</span><br><span class="line">         Block block = blockchainIterator.next();</span><br><span class="line">         <span class="keyword">for</span> (Transaction transaction : block.getTransactions()) &#123;</span><br><span class="line"></span><br><span class="line">             String txId = Hex.encodeHexString(transaction.getTxId());</span><br><span class="line"></span><br><span class="line">             <span class="keyword">int</span>[] spentOutIndexArray = allSpentTXOs.get(txId);</span><br><span class="line"></span><br><span class="line">             <span class="keyword">for</span> (<span class="keyword">int</span> outIndex = <span class="number">0</span>; outIndex &lt; transaction.getOutputs().length; outIndex++) &#123;</span><br><span class="line">                 <span class="keyword">if</span> (spentOutIndexArray != <span class="keyword">null</span> &amp;&amp; ArrayUtils.contains(spentOutIndexArray, outIndex)) &#123;</span><br><span class="line">                     <span class="keyword">continue</span>;</span><br><span class="line">                 &#125;</span><br><span class="line"></span><br><span class="line">                 <span class="comment">// ä¿å­˜ä¸å­˜åœ¨ allSpentTXOs ä¸­çš„äº¤æ˜“</span></span><br><span class="line">                 <span class="keyword">if</span> (transaction.getOutputs()[outIndex].isLockedWithKey(pubKeyHash)) &#123;</span><br><span class="line">                     unspentTxs = ArrayUtils.add(unspentTxs, transaction);</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> unspentTxs;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>è¯¥æ–¹æ³•æ˜¯ç”¨æ¥æŸ¥æ‰¾é’±åŒ…åœ°å€å¯¹åº”çš„åŒ…å«æœªèŠ±è´¹äº¤æ˜“è¾“å‡ºçš„äº¤æ˜“ä¿¡æ¯ã€‚ç”±äºäº¤æ˜“ä¿¡æ¯æ˜¯å­˜å‚¨åœ¨åŒºå—å½“ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬ç°æœ‰çš„åšæ³•æ˜¯éå†åŒºå—é“¾ä¸­çš„æ¯ä¸ªåŒºå—ï¼Œç„¶åéå†æ¯ä¸ªåŒºå—ä¸­çš„äº¤æ˜“ä¿¡æ¯ï¼Œå†ç„¶åéå†æ¯ä¸ªäº¤æ˜“ä¸­çš„äº¤æ˜“è¾“å‡ºï¼Œå¹¶æ£€æŸ¥äº¤æ˜“è¾“å‡ºæ˜¯å¦è¢«ç›¸åº”çš„é’±åŒ…åœ°å€æ‰€é”å®šï¼Œæ•ˆç‡éå¸¸ä½ä¸‹ã€‚æˆªæ­¢2018å¹´3æœˆ29å·ï¼Œæ¯”ç‰¹å¸ä¸­æœ‰ <a href="https://blockchain.info/zh-cn/block-height/515698" target="_blank" rel="noopener">515698</a> ä¸ªåŒºå—ï¼Œå¹¶ä¸”è¿™äº›æ•°æ®å æ®äº†140+Gb çš„ç£ç›˜ç©ºé—´ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ä¸€ä¸ªäººå¿…é¡»è¿è¡Œå…¨èŠ‚ç‚¹ï¼ˆä¸‹è½½æ‰€æœ‰çš„åŒºå—æ•°æ®ï¼‰æ‰èƒ½éªŒè¯äº¤æ˜“ä¿¡æ¯ã€‚æ­¤å¤–ï¼ŒéªŒè¯äº¤æ˜“ä¿¡æ¯éœ€è¦éå†æ‰€æœ‰çš„åŒºå—ã€‚</p><p>é’ˆå¯¹è¿™ä¸ªé—®é¢˜çš„è§£å†³åŠæ³•æ˜¯éœ€è¦æœ‰ä¸€ä¸ªå­˜å‚¨äº†æ‰€æœ‰UTXOsï¼ˆæœªèŠ±è´¹äº¤æ˜“è¾“å‡ºï¼‰çš„ç´¢å¼•ï¼Œè¿™å°±æ˜¯ UTXOs æ± æ‰€è¦åšçš„äº‹æƒ…ï¼šUTXOsæ± å…¶å®æ˜¯ä¸€ä¸ªç¼“å­˜ç©ºé—´ï¼Œå®ƒæ‰€ç¼“å­˜çš„æ•°æ®éœ€è¦ä»æ„å»ºåŒºå—é“¾ä¸­æ‰€æœ‰çš„äº¤æ˜“æ•°æ®ä¸­è·å¾—ï¼ˆé€šè¿‡éå†æ‰€æœ‰çš„åŒºå—é“¾ï¼Œä¸è¿‡è¿™ä¸ªæ„å»ºæ“ä½œåªéœ€è¦æ‰§è¡Œä¸€æ¬¡å³å¯ï¼‰ï¼Œå¹¶ä¸”å®ƒåç»­è¿˜ä¼šç”¨äºé’±åŒ…ä½™é¢çš„è®¡ç®—ä»¥åŠæ–°çš„äº¤æ˜“æ•°æ®çš„éªŒè¯ã€‚æˆªæ­¢åˆ°2017å¹´9æœˆï¼ŒUTXOsæ± å¤§çº¦ä¸º 2.7Gbã€‚</p><p>å¥½äº†ï¼Œè®©æˆ‘ä»¬æ¥æƒ³ä¸€ä¸‹ï¼Œä¸ºäº†å®ç° UTXOs æ± æˆ‘ä»¬éœ€è¦åšå“ªäº›äº‹æƒ…ã€‚å½“å‰ï¼Œæœ‰ä¸‹åˆ—æ–¹æ³•è¢«ç”¨äºæŸ¥æ‰¾äº¤æ˜“ä¿¡æ¯ï¼š</p><ol><li><p><strong>Blockchain.getAllSpentTXOs</strong> â€”â€” æŸ¥è¯¢æ‰€æœ‰å·²è¢«èŠ±è´¹çš„äº¤æ˜“è¾“å‡ºã€‚å®ƒéœ€è¦éå†åŒºå—é“¾ä¸­æ‰€æœ‰åŒºå—ä¸­äº¤æ˜“ä¿¡æ¯ã€‚</p></li><li><p><strong>Blockchain.findUnspentTransactions</strong> â€”â€” æŸ¥è¯¢åŒ…å«æœªè¢«èŠ±è´¹çš„äº¤æ˜“è¾“å‡ºçš„äº¤æ˜“ä¿¡æ¯ã€‚å®ƒä¹Ÿéœ€è¦éå†åŒºå—é“¾ä¸­æ‰€æœ‰åŒºå—ä¸­äº¤æ˜“ä¿¡æ¯ã€‚</p></li><li><p><strong>Blockchain.findSpendableOutputs</strong> â€”â€” è¯¥æ–¹æ³•ç”¨äºæ–°çš„äº¤æ˜“åˆ›å»ºä¹‹æ—¶ã€‚å®ƒéœ€è¦æ‰¾åˆ°è¶³å¤Ÿå¤šçš„äº¤æ˜“è¾“å‡ºï¼Œä»¥æ»¡è¶³æ‰€éœ€æ”¯ä»˜çš„é‡‘é¢ã€‚éœ€è¦è°ƒç”¨ <strong>Blockchain.findUnspentTransactions</strong> æ–¹æ³•ã€‚</p></li><li><p><strong>Blockchain.findUTXO</strong> â€”â€” æŸ¥è¯¢é’±åŒ…åœ°å€æ‰€å¯¹åº”çš„æ‰€æœ‰æœªèŠ±è´¹äº¤æ˜“è¾“å‡ºï¼Œç„¶åç”¨äºè®¡ç®—é’±åŒ…ä½™é¢ã€‚éœ€è¦è°ƒç”¨</p><p><strong>Blockchain.findUnspentTransactions</strong> æ–¹æ³•ã€‚</p></li><li><p><strong>Blockchain.findTransaction</strong> â€”â€” é€šè¿‡äº¤æ˜“IDæŸ¥è¯¢äº¤æ˜“ä¿¡æ¯ã€‚å®ƒéœ€è¦éå†æ‰€æœ‰çš„åŒºå—ç›´åˆ°æ‰¾åˆ°äº¤æ˜“ä¿¡æ¯ä¸ºæ­¢ã€‚</p></li></ol><p>å¦‚ä½ æ‰€è§ï¼Œä¸Šé¢è¿™äº›æ–¹æ³•éƒ½éœ€è¦å»éå†æ•°æ®åº“ä¸­çš„æ‰€æœ‰åŒºå—ã€‚ç”±äºUTXOsæ± åªå­˜å‚¨æœªè¢«èŠ±è´¹çš„äº¤æ˜“è¾“å‡ºï¼Œè€Œä¸ä¼šå­˜å‚¨æ‰€æœ‰çš„äº¤æ˜“ä¿¡æ¯ï¼Œå› æ­¤æˆ‘ä»¬ä¸ä¼šå¯¹æœ‰ <strong>Blockchain.findTransaction</strong> è¿›è¡Œä¼˜åŒ–ã€‚</p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸‹åˆ—è¿™äº›æ–¹æ³•ï¼š</p><ol><li><strong>Blockchain.findUTXO</strong> â€”â€” é€šè¿‡éå†æ‰€æœ‰çš„åŒºå—æ¥æ‰¾åˆ°æ‰€æœ‰æœªè¢«èŠ±è´¹çš„äº¤æ˜“è¾“å‡º.</li><li><strong>UTXOSet.reindex</strong> â€”â€” è°ƒç”¨ä¸Šé¢ <strong>findUTXO</strong> æ–¹æ³•ï¼Œç„¶åå°†æŸ¥è¯¢ç»“æœå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚ä¹Ÿå³éœ€è¦è¿›è¡Œç¼“å­˜çš„åœ°æ–¹ã€‚</li><li><strong>UTXOSet.findSpendableOutputs</strong> â€”â€” ä¸ <strong>Blockchain.findSpendableOutputs</strong> ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºä¼šä½¿ç”¨ UTXO æ± ã€‚</li><li><strong>UTXOSet.findUTXO</strong> â€”â€” ä¸<strong>Blockchain.findUTXO</strong> ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºä¼šä½¿ç”¨ UTXO æ± ã€‚</li><li><strong>Blockchain.findTransaction</strong> â€”â€” é€»è¾‘ä¿æŒä¸å˜ã€‚</li></ol><p>è¿™æ ·ï¼Œä¸¤ä¸ªä½¿ç”¨æœ€é¢‘ç¹çš„æ–¹æ³•å°†ä»ç°åœ¨å¼€å§‹ä½¿ç”¨ç¼“å­˜ï¼è®©æˆ‘ä»¬å¼€å§‹ç¼–ç å§ï¼</p><p>å®šä¹‰ <strong>UTXOSet</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UTXOSet</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Blockchain blockchain;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å»º UTXO æ± ç´¢å¼•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UTXOSet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">   ...</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * é‡å»º UTXO æ± ç´¢å¼•</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Synchronized</span>   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reIndex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"Start to reIndex UTXO set !"</span>);</span><br><span class="line">        RocksDBUtils.getInstance().cleanChainStateBucket();</span><br><span class="line">        Map&lt;String, TXOutput[]&gt; allUTXOs = blockchain.findAllUTXOs();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, TXOutput[]&gt; entry : allUTXOs.entrySet()) &#123;</span><br><span class="line">            RocksDBUtils.getInstance().putUTXOs(entry.getKey(), entry.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">"ReIndex UTXO set finished ! "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ–¹æ³•ç”¨äºåˆå§‹åŒ– UTXOSetã€‚é¦–å…ˆï¼Œéœ€è¦æ¸…ç©º <code>chainstate</code> æ•°æ®æ¡¶ï¼Œç„¶åæŸ¥è¯¢æ‰€æœ‰æœªè¢«èŠ±è´¹çš„äº¤æ˜“è¾“å‡ºï¼Œå¹¶å°†å®ƒä»¬ä¿å­˜åˆ° <code>chainstate</code> æ•°æ®æ¡¶ä¸­ã€‚</p><p>å®ç° <strong>findSpendableOutputs</strong> æ–¹æ³•ï¼Œä¾› <strong>Transation.newUTXOTransaction</strong> è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UTXOSet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">   ... </span><br><span class="line"> </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯»æ‰¾èƒ½å¤ŸèŠ±è´¹çš„äº¤æ˜“</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pubKeyHash é’±åŒ…å…¬é’¥Hash</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> amount     èŠ±è´¹é‡‘é¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SpendableOutputResult <span class="title">findSpendableOutputs</span><span class="params">(<span class="keyword">byte</span>[] pubKeyHash, <span class="keyword">int</span> amount)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, <span class="keyword">int</span>[]&gt; unspentOuts = Maps.newHashMap();</span><br><span class="line">        <span class="keyword">int</span> accumulated = <span class="number">0</span>;</span><br><span class="line">        Map&lt;String, <span class="keyword">byte</span>[]&gt; chainstateBucket = RocksDBUtils.getInstance().getChainstateBucket();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, <span class="keyword">byte</span>[]&gt; entry : chainstateBucket.entrySet()) &#123;</span><br><span class="line">            String txId = entry.getKey();</span><br><span class="line">            TXOutput[] txOutputs = (TXOutput[]) SerializeUtils.deserialize(entry.getValue());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> outId = <span class="number">0</span>; outId &lt; txOutputs.length; outId++) &#123;</span><br><span class="line">                TXOutput txOutput = txOutputs[outId];</span><br><span class="line">                <span class="keyword">if</span> (txOutput.isLockedWithKey(pubKeyHash) &amp;&amp; accumulated &lt; amount) &#123;</span><br><span class="line">                    accumulated += txOutput.getValue();</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">int</span>[] outIds = unspentOuts.get(txId);</span><br><span class="line">                    <span class="keyword">if</span> (outIds == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        outIds = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;outId&#125;;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        outIds = ArrayUtils.add(outIds, outId);</span><br><span class="line">                    &#125;</span><br><span class="line">                    unspentOuts.put(txId, outIds);</span><br><span class="line">                    <span class="keyword">if</span> (accumulated &gt;= amount) &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SpendableOutputResult(accumulated, unspentOuts);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç° <strong>findUTXOs</strong> æ¥å£ï¼Œä¾› <strong>CLI.getBalance</strong> è°ƒç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UTXOSet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">   ... </span><br><span class="line"> </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥æ‰¾é’±åŒ…åœ°å€å¯¹åº”çš„æ‰€æœ‰UTXO</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pubKeyHash é’±åŒ…å…¬é’¥Hash</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> TXOutput[] findUTXOs(<span class="keyword">byte</span>[] pubKeyHash) &#123;</span><br><span class="line">        TXOutput[] utxos = &#123;&#125;;</span><br><span class="line">        Map&lt;String, <span class="keyword">byte</span>[]&gt; chainstateBucket = RocksDBUtils.getInstance().getChainstateBucket();</span><br><span class="line">        <span class="keyword">if</span> (chainstateBucket.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> utxos;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">byte</span>[] value : chainstateBucket.values()) &#123;</span><br><span class="line">            TXOutput[] txOutputs = (TXOutput[]) SerializeUtils.deserialize(value);</span><br><span class="line">            <span class="keyword">for</span> (TXOutput txOutput : txOutputs) &#123;</span><br><span class="line">                <span class="keyword">if</span> (txOutput.isLockedWithKey(pubKeyHash)) &#123;</span><br><span class="line">                    utxos = ArrayUtils.add(utxos, txOutput);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> utxos;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šè¿™äº›æ–¹æ³•éƒ½æ˜¯å…ˆå‰ <strong>Blockchain</strong> ä¸­ç›¸åº”æ–¹æ³•çš„å¾®è°ƒç‰ˆï¼Œå…ˆå‰çš„æ–¹æ³•å°†ä¸å†ä½¿ç”¨ã€‚</p><p>æœ‰äº†UTXOæ± ä¹‹åï¼Œæ„å‘³ç€æˆ‘ä»¬çš„äº¤æ˜“æ•°æ®åˆ†å¼€å­˜å‚¨åˆ°äº†ä¸¤ä¸ªä¸åŒçš„æ•°æ®æ¡¶ä¸­ï¼šäº¤æ˜“æ•°æ®å­˜å‚¨åˆ°äº† <strong>block</strong> æ•°æ®æ¡¶ä¸­ï¼Œè€ŒUTXOå­˜å‚¨åˆ°äº† <strong>chainstate</strong> æ•°æ®æ¡¶ä¸­ã€‚è¿™å°±éœ€è¦ä¸€ç§åŒæ­¥æœºåˆ¶æ¥ä¿è¯æ¯å½“ä¸€ä¸ªæ–°çš„åŒºå—äº§ç”Ÿæ—¶ï¼ŒUTXOæ± èƒ½å¤ŸåŠæ—¶åŒæ­¥æœ€æ–°åŒºå—ä¸­çš„äº¤æ˜“æ•°æ®ï¼Œæ¯•ç«Ÿæˆ‘ä»¬ä¸æƒ³é¢‘åœ°è¿›è¡Œ <strong>reIndex</strong> ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å¦‚ä¸‹æ–¹æ³•ï¼š</p><p>æ›´æ–°UTXOæ± ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UTXOSet</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">   ... </span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›´æ–°UTXOæ± </span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * å½“ä¸€ä¸ªæ–°çš„åŒºå—äº§ç”Ÿæ—¶ï¼Œéœ€è¦å»åšä¸¤ä»¶äº‹æƒ…ï¼š</span></span><br><span class="line"><span class="comment">     * 1ï¼‰ä»UTXOæ± ä¸­ç§»é™¤èŠ±è´¹æ‰äº†çš„äº¤æ˜“è¾“å‡ºï¼›</span></span><br><span class="line"><span class="comment">     * 2ï¼‰ä¿å­˜æ–°çš„æœªèŠ±è´¹äº¤æ˜“è¾“å‡ºï¼›</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tipBlock æœ€æ–°çš„åŒºå—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Synchronized</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Block tipBlock)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (tipBlock == <span class="keyword">null</span>) &#123;</span><br><span class="line">            log.error(<span class="string">"Fail to update UTXO set ! tipBlock is null !"</span>);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Fail to update UTXO set ! "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (Transaction transaction : tipBlock.getTransactions()) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ ¹æ®äº¤æ˜“è¾“å…¥æ’æŸ¥å‡ºå‰©ä½™æœªè¢«ä½¿ç”¨çš„äº¤æ˜“è¾“å‡º</span></span><br><span class="line">            <span class="keyword">if</span> (!transaction.isCoinbase()) &#123;</span><br><span class="line">                <span class="keyword">for</span> (TXInput txInput : transaction.getInputs()) &#123;</span><br><span class="line">                    <span class="comment">// ä½™ä¸‹æœªè¢«ä½¿ç”¨çš„äº¤æ˜“è¾“å‡º</span></span><br><span class="line">                    TXOutput[] remainderUTXOs = &#123;&#125;;</span><br><span class="line">                    String txId = Hex.encodeHexString(txInput.getTxId());</span><br><span class="line">                    TXOutput[] txOutputs = RocksDBUtils.getInstance().getUTXOs(txId);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (txOutputs == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> outIndex = <span class="number">0</span>; outIndex &lt; txOutputs.length; outIndex++) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (outIndex != txInput.getTxOutputIndex()) &#123;</span><br><span class="line">                            remainderUTXOs = ArrayUtils.add(remainderUTXOs, txOutputs[outIndex]);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// æ²¡æœ‰å‰©ä½™åˆ™åˆ é™¤ï¼Œå¦åˆ™æ›´æ–°</span></span><br><span class="line">                    <span class="keyword">if</span> (remainderUTXOs.length == <span class="number">0</span>) &#123;</span><br><span class="line">                        RocksDBUtils.getInstance().deleteUTXOs(txId);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        RocksDBUtils.getInstance().putUTXOs(txId, remainderUTXOs);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ–°çš„äº¤æ˜“è¾“å‡ºä¿å­˜åˆ°DBä¸­</span></span><br><span class="line">            TXOutput[] txOutputs = transaction.getOutputs();</span><br><span class="line">            String txId = Hex.encodeHexString(transaction.getTxId());</span><br><span class="line">            RocksDBUtils.getInstance().putUTXOs(txId, txOutputs);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬å°† UTXOSet ç”¨åˆ°å®ƒä»¬æ‰€éœ€ä¹‹å¤„å»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CLI</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   ...</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºåŒºå—é“¾</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> address</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createBlockchain</span><span class="params">(String address)</span> </span>&#123;</span><br><span class="line">        Blockchain blockchain = Blockchain.createBlockchain(address);</span><br><span class="line">        UTXOSet utxoSet = <span class="keyword">new</span> UTXOSet(blockchain);</span><br><span class="line">        utxoSet.reIndex();</span><br><span class="line">        log.info(<span class="string">"Done ! "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“åˆ›å»ºä¸€ä¸ªæ–°çš„åŒºå—é“¾æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦é‡å»º UTXO æ± ç´¢å¼•ã€‚æˆªæ­¢ç›®å‰ï¼Œè¿™æ˜¯å”¯ä¸€ä¸€å¤„ç”¨åˆ° <strong>reIndex</strong> çš„åœ°æ–¹ï¼Œå°½ç®¡çœ‹èµ·æœ‰äº›å¤šä½™ï¼Œå› ä¸ºåœ¨åŒºå—é“¾åˆ›å»ºä¹‹åˆä»…ä»…åªæœ‰ä¸€ä¸ªåŒºå—å’Œä¸€ç¬”äº¤æ˜“ã€‚</p><p>ä¿®æ”¹ <strong>CLI.send</strong> æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CLI</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è½¬è´¦</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> from</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> to</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> amount</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(String from, String to, <span class="keyword">int</span> amount)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        </span><br><span class="line">        ...</span><br><span class="line">        </span><br><span class="line">        Blockchain blockchain = Blockchain.createBlockchain(from);</span><br><span class="line">        Transaction transaction = Transaction.newUTXOTransaction(from, to, amount, blockchain);</span><br><span class="line">        Block newBlock = blockchain.mineBlock(<span class="keyword">new</span> Transaction[]&#123;transaction&#125;);</span><br><span class="line">        <span class="keyword">new</span> UTXOSet(blockchain).update(newBlock);</span><br><span class="line">		</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ä¸€ä¸ªæ–°çš„åŒºå—äº§ç”Ÿåï¼Œéœ€è¦å»æ›´æ–° UTXO æ± æ•°æ®ã€‚</p><p>è®©æˆ‘ä»¬æ¥æ£€æŸ¥ä¸€ä¸‹å®ƒä»¬çš„è¿è¡Œæƒ…å†µï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">$ ./blochchain.sh  createwallet</span><br><span class="line">wallet address : <span class="number">1</span>JgppX2xMshr35wHzvNWQBejUAZ3Te5Mdf</span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  createwallet</span><br><span class="line">wallet address : <span class="number">1</span>HX7bWwCjvxkjq65GUgAVRFfTZy6yKWkoG</span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  createwallet</span><br><span class="line">wallet address : <span class="number">1</span>L1RoFgyjCrNPCPHmSEBtNiV3h2wiF9mZV</span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  createblockchain -address <span class="number">1</span>JgppX2xMshr35wHzvNWQBejUAZ3Te5Mdf</span><br><span class="line"></span><br><span class="line">Elapsed Time: <span class="number">164.961</span> seconds </span><br><span class="line">correct hash Hex: <span class="number">00225493862611</span>bc517cb6b3610e99d26d98a6b52484c9fa745df6ceff93f445 </span><br><span class="line"></span><br><span class="line">Done ! </span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  getbalance -address <span class="number">1</span>JgppX2xMshr35wHzvNWQBejUAZ3Te5Mdf</span><br><span class="line">Balance of <span class="string">'1JgppX2xMshr35wHzvNWQBejUAZ3Te5Mdf'</span>: <span class="number">10</span></span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  send -from <span class="number">1</span>HX7bWwCjvxkjq65GUgAVRFfTZy6yKWkoG -to  <span class="number">1</span>JgppX2xMshr35wHzvNWQBejUAZ3Te5Mdf -amount <span class="number">5</span></span><br><span class="line">java.lang.Exception: ERROR: Not enough funds</span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  send -from <span class="number">1</span>JgppX2xMshr35wHzvNWQBejUAZ3Te5Mdf -to <span class="number">1</span>HX7bWwCjvxkjq65GUgAVRFfTZy6yKWkoG -amount <span class="number">2</span></span><br><span class="line">Elapsed Time: <span class="number">54.92</span> seconds </span><br><span class="line">correct hash Hex: <span class="number">0001</span>ab21f71ff2d6d532bf3b3388db790c2b03e28d7bd27bd669c5f6380a4e5b </span><br><span class="line"></span><br><span class="line">Success!</span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  send -from <span class="number">1</span>JgppX2xMshr35wHzvNWQBejUAZ3Te5Mdf -to <span class="number">1</span>L1RoFgyjCrNPCPHmSEBtNiV3h2wiF9mZV -amount <span class="number">2</span></span><br><span class="line">Elapsed Time: <span class="number">54.92</span> seconds </span><br><span class="line">correct hash Hex: <span class="number">0009</span>b925cc94e3db8bab2958b1fc2d1764aa15531e20756d92c3a93065c920f0 </span><br><span class="line"></span><br><span class="line">Success!</span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  getbalance -address <span class="number">1</span>JgppX2xMshr35wHzvNWQBejUAZ3Te5Mdf</span><br><span class="line">Balance of <span class="string">'1JgppX2xMshr35wHzvNWQBejUAZ3Te5Mdf'</span>: <span class="number">6</span></span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  getbalance -address <span class="number">1</span>HX7bWwCjvxkjq65GUgAVRFfTZy6yKWkoG</span><br><span class="line">Balance of <span class="string">'1HX7bWwCjvxkjq65GUgAVRFfTZy6yKWkoG'</span>: <span class="number">2</span></span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  getbalance -address <span class="number">1</span>L1RoFgyjCrNPCPHmSEBtNiV3h2wiF9mZV</span><br><span class="line">Balance of <span class="string">'1L1RoFgyjCrNPCPHmSEBtNiV3h2wiF9mZV'</span>: <span class="number">2</span></span><br></pre></td></tr></table></figure><h2 id="å¥–åŠ±æœºåˆ¶"><a href="#å¥–åŠ±æœºåˆ¶" class="headerlink" title="å¥–åŠ±æœºåˆ¶"></a>å¥–åŠ±æœºåˆ¶</h2><p>å‰é¢çš„ç« èŠ‚ä¸­æˆ‘ä»¬çœç•¥äº†çŸ¿å·¥æŒ–çŸ¿çš„å¥–åŠ±æœºåˆ¶ã€‚æ—¶æœºå·²ç»æˆç†Ÿï¼Œè¯¥å®ç°å®ƒäº†ã€‚</p><p>çŸ¿å·¥å¥–åŠ±å…¶å®æ˜¯ä¸€ä¸ª coinbase äº¤æ˜“ï¼ˆåˆ›å¸äº¤æ˜“ï¼‰ã€‚å½“ä¸€ä¸ªçŸ¿å·¥èŠ‚ç‚¹å¼€å§‹å»ç”Ÿäº§ä¸€ä¸ªæ–°çš„åŒºå—æ—¶ï¼Œä»–ä¼šä»é˜Ÿåˆ—ä¸­å–å‡ºä¸€äº›äº¤æ˜“æ•°æ®ï¼Œå¹¶ä¸”ä¸ºå®ƒä»¬é¢„åˆ¶ä¸€ä¸ª coinbase äº¤æ˜“ã€‚è¿™ç¬” coinbase äº¤æ˜“ä¸­ä»…æœ‰çš„äº¤æ˜“è¾“å‡ºåŒ…å«äº†çŸ¿å·¥çš„å…¬é’¥hashã€‚</p><p>åªéœ€è¦æ›´æ–° <strong>send</strong> å‘½ä»¤æ¥å£ï¼Œæˆ‘ä»¬å°±å¯ä»¥è½»æ¾å®ç°çŸ¿å·¥çš„å¥–åŠ±æœºåˆ¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CLI</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è½¬è´¦</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> from</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> to</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> amount</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(String from, String to, <span class="keyword">int</span> amount)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        </span><br><span class="line">        ...</span><br><span class="line">        </span><br><span class="line">        Blockchain blockchain = Blockchain.createBlockchain(from);</span><br><span class="line">        <span class="comment">// æ–°äº¤æ˜“</span></span><br><span class="line">        Transaction transaction = Transaction.newUTXOTransaction(from, to, amount, blockchain);</span><br><span class="line">        <span class="comment">// å¥–åŠ±</span></span><br><span class="line">        Transaction rewardTx = Transaction.newCoinbaseTX(from, <span class="string">""</span>);</span><br><span class="line">        Block newBlock = blockchain.mineBlock(<span class="keyword">new</span> Transaction[]&#123;transaction, rewardTx&#125;);</span><br><span class="line">        <span class="keyword">new</span> UTXOSet(blockchain).update(newBlock);</span><br><span class="line">		</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line"> 	   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜éœ€è¦ä¿®æ”¹äº¤æ˜“éªŒè¯æ–¹æ³•ï¼Œcoinbase äº¤æ˜“ç›´æ¥éªŒè¯é€šè¿‡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Blockchain</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äº¤æ˜“ç­¾åéªŒè¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tx</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">verifyTransactions</span><span class="params">(Transaction tx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (tx.isCoinbase()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æˆ‘ä»¬çš„å®ç°é€»è¾‘ä¸­ï¼Œä»£å¸çš„å‘é€ä¹Ÿæ˜¯åŒºå—çš„ç”Ÿäº§è€…ï¼Œå› æ­¤ï¼Œå¥–åŠ±ä¹Ÿå½’ä»–æ‰€æœ‰ã€‚</p><p>è®©æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹å¥–åŠ±æœºåˆ¶ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">$ ./blochchain.sh  createwallet </span><br><span class="line">wallet address : <span class="number">1</span>MpdtjTEsDvrkrLWmMswq4K3VPtevXXnUD</span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  createwallet </span><br><span class="line">wallet address : <span class="number">17</span>crpQoWy7TEkY9UPjZ3Qt9Fc2rWPUt8KX</span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  createwallet </span><br><span class="line">wallet address : <span class="number">12</span>L868QZW1ySYzf2oT5ha9py9M5JrSRhvT</span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  createblockchain -address <span class="number">1</span>MpdtjTEsDvrkrLWmMswq4K3VPtevXXnUD</span><br><span class="line"></span><br><span class="line">Elapsed Time: <span class="number">17.973</span> seconds</span><br><span class="line">correct hash Hex: <span class="number">0000</span>defe83a851a5db3803d5013bbc20c6234f176b2c52ae36fdb53d28b33d93 </span><br><span class="line"></span><br><span class="line">Done ! </span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  send -from <span class="number">1</span>MpdtjTEsDvrkrLWmMswq4K3VPtevXXnUD -to <span class="number">17</span>crpQoWy7TEkY9UPjZ3Qt9Fc2rWPUt8KX -amount <span class="number">6</span></span><br><span class="line">Elapsed Time: <span class="number">30.887</span> seconds</span><br><span class="line">correct hash Hex: <span class="number">00005</span>fd36a2609b43fd940577f93b8622e88e854f5ccfd70e113f763b6df69f7 </span><br><span class="line"></span><br><span class="line">Success!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  send -from <span class="number">1</span>MpdtjTEsDvrkrLWmMswq4K3VPtevXXnUD -to <span class="number">12</span>L868QZW1ySYzf2oT5ha9py9M5JrSRhvT -amount <span class="number">3</span></span><br><span class="line">Elapsed Time: <span class="number">45.267</span> seconds</span><br><span class="line">correct hash Hex: <span class="number">00009</span>fd7c59b830b60ec21ade7672921d2fb0962a1b06a42c245450e47582a13 </span><br><span class="line"></span><br><span class="line">Success!</span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  getbalance -address <span class="number">1</span>MpdtjTEsDvrkrLWmMswq4K3VPtevXXnUD</span><br><span class="line">Balance of <span class="string">'1MpdtjTEsDvrkrLWmMswq4K3VPtevXXnUD'</span>: <span class="number">21</span></span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  getbalance -address <span class="number">17</span>crpQoWy7TEkY9UPjZ3Qt9Fc2rWPUt8KX</span><br><span class="line">Balance of <span class="string">'17crpQoWy7TEkY9UPjZ3Qt9Fc2rWPUt8KX'</span>: <span class="number">6</span></span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  getbalance -address <span class="number">12</span>L868QZW1ySYzf2oT5ha9py9M5JrSRhvT</span><br><span class="line">Balance of <span class="string">'12L868QZW1ySYzf2oT5ha9py9M5JrSRhvT'</span>: <span class="number">3</span></span><br></pre></td></tr></table></figure><p><strong>1MpdtjTEsDvrkrLWmMswq4K3VPtevXXnUD</strong> è¿™ä¸ªåœ°å€ä¸€å…±æ”¶åˆ°äº†ä¸‰ä»½å¥–åŠ±ï¼š</p><ul><li><p>ç¬¬ä¸€æ¬¡æ˜¯å¼€é‡‡åˆ›ä¸–åŒºå—ï¼›</p></li><li><p>ç¬¬äºŒæ¬¡æ˜¯å¼€é‡‡åŒºå—ï¼š00005fd36a2609b43fd940577f93b8622e88e854f5ccfd70e113f763b6df69f7</p></li><li><p>ç¬¬ä¸‰æ¬¡æ˜¯å¼€é‡‡åŒºå—ï¼š00009fd7c59b830b60ec21ade7672921d2fb0962a1b06a42c245450e47582a13</p></li></ul><h2 id="Merkle-Tree"><a href="#Merkle-Tree" class="headerlink" title="Merkle Tree"></a>Merkle Tree</h2><p>Merkle Treeï¼ˆé»˜å…‹å°”æ ‘ï¼‰ æ˜¯è¿™ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬éœ€è¦é‡ç‚¹è®¨è®ºçš„ä¸€ä¸ªæœºåˆ¶ã€‚</p><p>æ­£å¦‚æˆ‘å‰é¢æåˆ°çš„é‚£æ ·ï¼Œæ•´ä¸ªæ¯”ç‰¹å¸çš„æ•°æ®åº“å åˆ°äº†å¤§çº¦140Gçš„ç£ç›˜ç©ºé—´ã€‚ç”±äºæ¯”ç‰¹å¸çš„åˆ†å¸ƒå¼ç‰¹æ€§ï¼Œç½‘ç»œä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹å¿…é¡»æ˜¯ç‹¬ç«‹ä¸”è‡ªç»™è‡ªè¶³çš„ã€‚æ¯ä¸ªæ¯”ç‰¹å¸èŠ‚ç‚¹éƒ½æ˜¯è·¯ç”±ã€åŒºå—é“¾æ•°æ®åº“ã€æŒ–çŸ¿ã€é’±åŒ…æœåŠ¡çš„åŠŸèƒ½é›†åˆã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½å‚ä¸å…¨ç½‘ç»œçš„è·¯ç”±åŠŸèƒ½ï¼ŒåŒæ—¶ä¹Ÿå¯èƒ½åŒ…å«å…¶ä»–åŠŸèƒ½ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½å‚ä¸éªŒè¯å¹¶ä¼ æ’­äº¤æ˜“åŠåŒºå—ä¿¡æ¯ï¼Œå‘ç°å¹¶ç»´æŒä¸å¯¹ç­‰èŠ‚ç‚¹çš„è¿æ¥ã€‚ä¸€ä¸ªå…¨èŠ‚ç‚¹ï¼ˆfull nodeï¼‰åŒ…æ‹¬ä»¥ä¸‹å››ä¸ªåŠŸèƒ½ï¼š</p><p><img src="https://img.i7years.com/blog/full_node.png-zoom50" alt="full node"></p><p>éšç€è¶Šæ¥è¶Šå¤šçš„äººå¼€å§‹ä½¿ç”¨æ¯”ç‰¹å¸ï¼Œè¿™æ¡è§„åˆ™å¼€å§‹å˜å¾—è¶Šæ¥è¶Šéš¾ä»¥éµå¾ªï¼šè®©æ¯ä¸€ä¸ªäººéƒ½å»è¿è¡Œä¸€ä¸ªå®Œæ•´çš„èŠ‚ç‚¹ä¸å¤ªç°å®ã€‚åœ¨ä¸­æœ¬èªå‘å¸ƒçš„ <a href="https://bitcoin.org/bitcoin.pdf" target="_blank" rel="noopener">æ¯”ç‰¹å¸ç™½çš®ä¹¦</a> ä¸­ï¼Œé’ˆå¯¹è¿™ä¸ªé—®é¢˜æå‡ºäº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼šSimplified Payment Verification (SPV)ï¼ˆç®€æ˜“æ”¯ä»˜éªŒè¯ï¼‰ã€‚SPVæ˜¯æ¯”ç‰¹å¸çš„è½»é‡çº§èŠ‚ç‚¹ï¼Œå®ƒä¸éœ€è¦ä¸‹è½½æ‰€æœ‰çš„åŒºå—é“¾æ•°æ®ï¼Œä¹Ÿ<strong>ä¸éœ€è¦éªŒè¯åŒºå—å’Œäº¤æ˜“æ•°æ®</strong>ã€‚ç›¸åï¼Œå½“SPVæƒ³è¦éªŒè¯ä¸€ç¬”äº¤æ˜“çš„æœ‰æ•ˆæ€§æ—¶ï¼Œå®ƒä¼šä»å®ƒæ‰€è¿æ¥çš„å…¨èŠ‚ç‚¹ä¸Šæ£€ç´¢æ‰€éœ€è¦çš„ä¸€äº›æ•°æ®ã€‚è¿™ç§æœºåˆ¶ä¿è¯äº†åœ¨åªæœ‰ä¸€ä¸ªå…¨èŠ‚ç‚¹çš„æƒ…å†µï¼Œå¯ä»¥è¿è¡Œå¤šä¸ªSPVè½»é’±åŒ…èŠ‚ç‚¹ã€‚</p><blockquote><p>æ›´å¤šæœ‰å…³SPVçš„ä»‹ç»ï¼Œè¯·æŸ¥çœ‹ï¼š<a href="https://github.com/bitcoinbook/bitcoinbook/blob/develop/ch08.asciidoc#simplified-payment-verification-spv-nodes" target="_blank" rel="noopener">ã€Šç²¾é€šæ¯”ç‰¹å¸ï¼ˆç¬¬äºŒç‰ˆï¼‰ã€‹ç¬¬å…«ç« </a></p></blockquote><p>ä¸ºäº†ä½¿SPVæˆä¸ºå¯èƒ½ï¼Œå°±éœ€è¦æœ‰ä¸€ç§æ–¹æ³•åœ¨æ²¡æœ‰å…¨é‡ä¸‹è½½åŒºå—æ•°æ®çš„æƒ…å†µä¸‹ï¼Œæ¥æ£€æŸ¥ä¸€ä¸ªåŒºå—æ˜¯å¦åŒ…å«äº†æŸç¬”äº¤æ˜“ã€‚è¿™å°±æ˜¯ <strong>Merkle Tree</strong> å‘æŒ¥ä½œç”¨çš„åœ°æ–¹äº†ã€‚</p><p>æ¯”ç‰¹å¸ä¸­æ‰€ä½¿ç”¨çš„Merkle Treeæ˜¯ä¸ºäº†è·å¾—äº¤æ˜“çš„Hashå€¼ï¼Œéšåè¿™ä¸ªå·²ç»è¢«Powï¼ˆå·¥ä½œé‡è¯æ˜ï¼‰ç³»ç»Ÿè®¤å¯äº†çš„Hashå€¼ä¼šè¢«ä¿å­˜åˆ°åŒºå—å¤´ä¸­ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªæ˜¯ç®€å•åœ°è®¡ç®—äº†ä¸€ä¸ªåŒºå—ä¸­æ¯ç¬”äº¤æ˜“çš„Hashå€¼ï¼Œç„¶ååœ¨å‡†å¤‡Powæ•°æ®æ—¶ï¼Œå†å¯¹è¿™äº›äº¤æ˜“è¿›è¡Œ <strong>SHA-256</strong> è®¡ç®—ã€‚è™½ç„¶è¿™æ˜¯ä¸€ä¸ªç”¨äºè·å–åŒºå—äº¤æ˜“å”¯ä¸€è¡¨ç¤ºçš„ä¸€ä¸ªä¸é”™çš„æ–¹å¼ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼ä¸å…·å¤‡ Merkle Tree çš„ä¼˜ç‚¹ã€‚</p><blockquote><p>æ›´å¤šæœ‰å…³Merkle Treeçš„ä»‹ç»ï¼Œè¯·æŸ¥çœ‹ï¼š<a href="https://github.com/bitcoinbook/bitcoinbook/blob/develop/ch09.asciidoc#merkle-trees" target="_blank" rel="noopener">ã€Šç²¾é€šæ¯”ç‰¹å¸ï¼ˆç¬¬äºŒç‰ˆï¼‰ã€‹ç¬¬ä¹ç« </a></p></blockquote><p>æ¥çœ‹ä¸€ä¸‹Merkle Treeçš„ç»“æ„ï¼š</p><p><img src="https://img.i7years.com/blog/merkle-tree-diagram.png" alt=""></p><p>æ¯ä¸€ä¸ªåŒºå—éƒ½ä¼šæ„å»ºä¸€ä¸ªMerkle Treeï¼Œå®ƒä»æœ€åº•éƒ¨çš„å¶å­èŠ‚ç‚¹å¼€å§‹å¾€ä¸Šæ„å»ºï¼Œæ¯ä¸€ä¸ªäº¤æ˜“çš„Hashå°±æ˜¯ä¸€ä¸ªå¶å­èŠ‚ç‚¹ï¼ˆæ¯”ç‰¹å¸ä¸­ç”¨çš„åŒSHA256ç®—æ³•ï¼‰ã€‚å¶å­èŠ‚ç‚¹çš„æ•°é‡å¿…é¡»æ˜¯å¶æ•°ä¸ªï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æ¯ä¸€ä¸ªåŒºå—éƒ½èƒ½åŒ…å«å¶æ•°ç¬”äº¤æ˜“æ•°æ®ã€‚å¦‚æœå­˜åœ¨å¥‡æ•°ç¬”äº¤æ˜“æ•°æ®ï¼Œé‚£ä¹ˆæœ€åä¸€ç¬”äº¤æ˜“æ•°æ®å°†ä¼šè¢«å¤åˆ¶ä¸€ä»½ï¼ˆè¿™ä»…ä»…å‘ç”Ÿåœ¨Merkle Treeä¸­ï¼Œè€Œä¸æ˜¯åŒºå—ä¸­ï¼‰ã€‚</p><p>ä»ä¸‹å¾€ä¸Šç§»åŠ¨ï¼Œå¶å­èŠ‚ç‚¹æˆå¯¹åˆ†ç»„ï¼Œå®ƒä»¬çš„Hashå€¼è¢«è¿æ¥åˆ°ä¸€èµ·ï¼Œå¹¶ä¸”åœ¨æ­¤åŸºç¡€ä¸Šå†æ¬¡è®¡ç®—å‡ºæ–°çš„Hashå€¼ã€‚æ–°çš„Hash å½¢æˆæ–°çš„æ ‘èŠ‚ç‚¹ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸æ–­åœ°è¢«é‡å¤ï¼Œç›´åˆ°æœ€åä»…å‰©ä¸€ä¸ªè¢«ç§°ä¸ºæ ¹èŠ‚ç‚¹çš„æ ‘èŠ‚ç‚¹ã€‚è¿™ä¸ªæ ¹èŠ‚ç‚¹çš„Hashå°±æ˜¯åŒºå—ä¸­äº¤æ˜“æ•°æ®ä»¬çš„å”¯ä¸€ä»£è¡¨ï¼Œå®ƒä¼šè¢«ä¿å­˜åˆ°åŒºå—å¤´ä¸­ï¼Œå¹¶è¢«ç”¨äºå‚ä¸POWç³»ç»Ÿçš„è®¡ç®—ã€‚</p><p>Merkleæ ‘çš„å¥½å¤„æ˜¯èŠ‚ç‚¹å¯ä»¥åœ¨ä¸ä¸‹è½½æ•´ä¸ªå—çš„æƒ…å†µä¸‹éªŒè¯æŸç¬”äº¤æ˜“çš„åˆæ³•æ€§ã€‚ ä¸ºæ­¤ï¼Œåªéœ€è¦äº¤æ˜“Hashï¼ŒMerkleæ ‘æ ¹Hashå’ŒMerkleè·¯å¾„ã€‚</p><p>Merkle Treeä»£ç å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.blockchain.transaction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.Lists;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> one.wangwei.blockchain.util.ByteUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.digest.DigestUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é»˜å…‹å°”æ ‘</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/04/15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MerkleTree</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Node root;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¶å­èŠ‚ç‚¹Hash</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[][] leafHashes;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MerkleTree</span><span class="params">(<span class="keyword">byte</span>[][] leafHashes)</span> </span>&#123;</span><br><span class="line">        constructTree(leafHashes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»åº•éƒ¨å¶å­èŠ‚ç‚¹å¼€å§‹å¾€ä¸Šæ„å»ºæ•´ä¸ªMerkle Tree</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> leafHashes</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">constructTree</span><span class="params">(<span class="keyword">byte</span>[][] leafHashes)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (leafHashes == <span class="keyword">null</span> || leafHashes.length &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"ERROR:Fail to construct merkle tree ! leafHashes data invalid ! "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.leafHashes = leafHashes;</span><br><span class="line">        List&lt;Node&gt; parents = bottomLevel(leafHashes);</span><br><span class="line">        <span class="keyword">while</span> (parents.size() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            parents = internalLevel(parents);</span><br><span class="line">        &#125;</span><br><span class="line">        root = parents.get(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„å»ºä¸€ä¸ªå±‚çº§èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> children</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;Node&gt; <span class="title">internalLevel</span><span class="params">(List&lt;Node&gt; children)</span> </span>&#123;</span><br><span class="line">        List&lt;Node&gt; parents = Lists.newArrayListWithCapacity(children.size() / <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; children.size() - <span class="number">1</span>; i += <span class="number">2</span>) &#123;</span><br><span class="line">            Node child1 = children.get(i);</span><br><span class="line">            Node child2 = children.get(i + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            Node parent = constructInternalNode(child1, child2);</span><br><span class="line">            parents.add(parent);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å†…éƒ¨èŠ‚ç‚¹å¥‡æ•°ä¸ªï¼Œåªå¯¹leftèŠ‚ç‚¹è¿›è¡Œè®¡ç®—</span></span><br><span class="line">        <span class="keyword">if</span> (children.size() % <span class="number">2</span> != <span class="number">0</span>) &#123;</span><br><span class="line">            Node child = children.get(children.size() - <span class="number">1</span>);</span><br><span class="line">            Node parent = constructInternalNode(child, <span class="keyword">null</span>);</span><br><span class="line">            parents.add(parent);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> parents;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åº•éƒ¨èŠ‚ç‚¹æ„å»º</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hashes</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;Node&gt; <span class="title">bottomLevel</span><span class="params">(<span class="keyword">byte</span>[][] hashes)</span> </span>&#123;</span><br><span class="line">        List&lt;Node&gt; parents = Lists.newArrayListWithCapacity(hashes.length / <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; hashes.length - <span class="number">1</span>; i += <span class="number">2</span>) &#123;</span><br><span class="line">            Node leaf1 = constructLeafNode(hashes[i]);</span><br><span class="line">            Node leaf2 = constructLeafNode(hashes[i + <span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">            Node parent = constructInternalNode(leaf1, leaf2);</span><br><span class="line">            parents.add(parent);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (hashes.length % <span class="number">2</span> != <span class="number">0</span>) &#123;</span><br><span class="line">            Node leaf = constructLeafNode(hashes[hashes.length - <span class="number">1</span>]);</span><br><span class="line">            <span class="comment">// å¥‡æ•°ä¸ªèŠ‚ç‚¹çš„æƒ…å†µï¼Œå¤åˆ¶æœ€åä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">            Node parent = constructInternalNode(leaf, leaf);</span><br><span class="line">            parents.add(parent);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> parents;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„å»ºå¶å­èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hash</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Node <span class="title">constructLeafNode</span><span class="params">(<span class="keyword">byte</span>[] hash)</span> </span>&#123;</span><br><span class="line">        Node leaf = <span class="keyword">new</span> Node();</span><br><span class="line">        leaf.hash = hash;</span><br><span class="line">        <span class="keyword">return</span> leaf;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„å»ºå†…éƒ¨èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> leftChild</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rightChild</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">constructInternalNode</span><span class="params">(Node leftChild, Node rightChild)</span> </span>&#123;</span><br><span class="line">        Node parent = <span class="keyword">new</span> Node();</span><br><span class="line">        <span class="keyword">if</span> (rightChild == <span class="keyword">null</span>) &#123;</span><br><span class="line">            parent.hash = leftChild.hash;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            parent.hash = internalHash(leftChild.hash, rightChild.hash);</span><br><span class="line">        &#125;</span><br><span class="line">        parent.left = leftChild;</span><br><span class="line">        parent.right = rightChild;</span><br><span class="line">        <span class="keyword">return</span> parent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¡ç®—å†…éƒ¨èŠ‚ç‚¹Hash</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> leftChildHash</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rightChildHash</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] internalHash(<span class="keyword">byte</span>[] leftChildHash, <span class="keyword">byte</span>[] rightChildHash) &#123;</span><br><span class="line">        <span class="keyword">byte</span>[] mergedBytes = ByteUtils.merge(leftChildHash, rightChildHash);</span><br><span class="line">        <span class="keyword">return</span> DigestUtils.sha256(mergedBytes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Merkle TreeèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">byte</span>[] hash;</span><br><span class="line">        <span class="keyword">private</span> Node left;</span><br><span class="line">        <span class="keyword">private</span> Node right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åä¿®æ”¹ <strong>Block.hashTransaction</strong> æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Block</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">   ... </span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯¹åŒºå—ä¸­çš„äº¤æ˜“ä¿¡æ¯è¿›è¡ŒHashè®¡ç®—</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] hashTransaction() &#123;</span><br><span class="line">        <span class="keyword">byte</span>[][] txIdArrays = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="keyword">this</span>.getTransactions().length][];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.getTransactions().length; i++) &#123;</span><br><span class="line">            txIdArrays[i] = <span class="keyword">this</span>.getTransactions()[i].hash();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MerkleTree(txIdArrays).getRoot().getHash();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>MerkleTreeçš„æ ¹èŠ‚ç‚¹çš„Hashå€¼ï¼Œå°±æ˜¯åŒºå—ä¸­äº¤æ˜“ä¿¡æ¯çš„å”¯ä¸€ä»£è¡¨ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>è¿™ä¸€èŠ‚æˆ‘ä»¬ä¸»è¦æ˜¯å¯¹å‰é¢çš„äº¤æ˜“æœºåˆ¶åšäº†è¿›ä¸€æ­¥çš„ä¼˜åŒ–ï¼ŒåŠ å…¥UTXOæ± å’ŒMerkle Treeæœºåˆ¶ã€‚</p><p>ä¸‹ä¸€è®²ï¼Œæˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹æ¯”ç‰¹å¸çš„äº¤æ˜“è„šæœ¬ç›¸å…³çš„å†…å®¹ã€‚</p><h2 id="èµ„æ–™"><a href="#èµ„æ–™" class="headerlink" title="èµ„æ–™"></a>èµ„æ–™</h2><ol><li>æºç ï¼š<a href="https://github.com/wangweiX/blockchain-java/tree/part6-transaction2" target="_blank" rel="noopener">https://github.com/wangweiX/blockchain-java/tree/part6-transaction2</a></li><li><a href="https://github.com/bitcoinbook/bitcoinbook" target="_blank" rel="noopener">ã€Šç²¾é€šæ¯”ç‰¹å¸ï¼ˆç¬¬äºŒç‰ˆï¼‰ã€‹</a></li><li><a href="https://en.bitcoin.it/wiki/Bitcoin_Core_0.11_(ch_2" target="_blank" rel="noopener">The UTXO Set</a>:_Data_Storage#The_UTXO_set_.28chainstate_leveldb.29)</li><li><a href="https://statoshi.info/dashboard/db/unspent-transaction-output-set" target="_blank" rel="noopener">UTXO set statistics</a></li><li><a href="https://en.bitcoin.it/wiki/Protocol_documentation#Merkle_Trees" target="_blank" rel="noopener">Merkle Tree</a></li><li><a href="https://medium.com/@jonaldfyookball/why-every-bitcoin-user-should-understand-spv-security-520d1d45e0b9" target="_blank" rel="noopener">Why every Bitcoin user should understand â€œSPV securityâ€</a></li><li><a href="https://en.bitcoin.it/wiki/Script" target="_blank" rel="noopener">Script</a></li><li><a href="https://github.com/sipa/bitcoin/commit/450cbb0944cd20a06ce806e6679a1f4c83c50db2" target="_blank" rel="noopener">â€œUltrapruneâ€ Bitcoin Core commit</a></li><li><a href="https://medium.com/@maraoz/smart-contracts-and-bitcoin-a5d61011d9b1" target="_blank" rel="noopener">Smart contracts and Bitcoin</a></li></ol><p><img src="https://img.i7years.com/blog/blockchain_exploer.png" alt=""></p><blockquote><p><a href="https://press.one/file/v?s=26e600c30e75eaa13e96be514125b88979ee8ec589372b3f60eb5e3d6884f3e35992f70a44875916b4efc8d87f3021bbf4dea9c23253a8496120b75cc47a6cb30&amp;h=5da52a1d62de45729187a3eed46039f776095760c0848e670140ced8c3c0c32a&amp;a=23fe9bfd7ceef4b44c2ce44dcac8e4a49caf8026&amp;f=P1&amp;v=2" target="_blank" rel="noopener">https://press.one/file/v?s=26e600c30e75eaa13e96be514125b88979ee8ec589372b3f60eb5e3d6884f3e35992f70a44875916b4efc8d87f3021bbf4dea9c23253a8496120b75cc47a6cb30&amp;h=5da52a1d62de45729187a3eed46039f776095760c0848e670140ced8c3c0c32a&amp;a=23fe9bfd7ceef4b44c2ce44dcac8e4a49caf8026&amp;f=P1&amp;v=2</a></p></blockquote>]]></content>
      
        <categories>
            
            <category> blockchain </category>
            
        </categories>
        
        
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> bitcoin </tag>
            
            <tag> Merkle Tree </tag>
            
            <tag> UTXO </tag>
            
            <tag> SPV </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[åŸºäºJavaè¯­è¨€æ„å»ºåŒºå—é“¾ï¼ˆäº”ï¼‰â€”â€” åœ°å€ï¼ˆé’±åŒ…ï¼‰]]></title>
      <url>/posts/build-blockchain-in-java-wallet-address.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/pexels-photo-730547.webp?imageslim" alt="wallet"></p><blockquote><p>æ–‡ç« çš„ä¸»è¦æ€æƒ³å’Œå†…å®¹å‡æ¥è‡ª <a href="https://jeiwan.cc/posts/building-blockchain-in-go-part-5/" target="_blank" rel="noopener">https://jeiwan.cc/posts/building-blockchain-in-go-part-5/</a></p></blockquote><h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>åœ¨ <a href="https://wangwei.one/posts/9cf9e42a.html">ä¸Šä¸€ç¯‡</a> æ–‡ç« å½“ä¸­ï¼Œæˆ‘ä»¬å¼€å§‹äº†äº¤æ˜“æœºåˆ¶çš„å®ç°ã€‚ä½ å·²ç»äº†è§£åˆ°äº¤æ˜“çš„ä¸€äº›éä¸ªäººç‰¹å¾ï¼šæ²¡æœ‰ç”¨æˆ·è´¦æˆ·ï¼Œæ‚¨çš„ä¸ªäººæ•°æ®ï¼ˆä¾‹å¦‚ï¼šå§“åã€æŠ¤ç…§å·ç ä»¥åŠSSN(ç¾å›½ç¤¾ä¼šå®‰å…¨å¡ï¼ˆSocial Security Cardï¼‰ä¸Šçš„9 ä½æ•°å­—)ï¼‰ä¸æ˜¯å¿…éœ€çš„ï¼Œå¹¶ä¸”ä¸å­˜å‚¨åœ¨æ¯”ç‰¹å¸çš„ä»»ä½•åœ°æ–¹ã€‚ä½†ä»ç„¶å¿…é¡»æœ‰ä¸€äº›ä¸œè¥¿èƒ½å¤Ÿè¯†åˆ«ä½ æ˜¯è¿™äº›äº¤æ˜“è¾“å‡ºçš„æ‰€æœ‰è€…ï¼ˆä¾‹å¦‚ï¼šé”å®šåœ¨è¿™äº›è¾“å‡ºä¸Šçš„å¸çš„æ‰€æœ‰è€…ï¼‰ã€‚è¿™å°±æ˜¯æ¯”ç‰¹å¸åœ°å€çš„ä½œç”¨æ‰€åœ¨ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªæ˜¯ä½¿ç”¨äº†ä»»æ„çš„ç”¨æˆ·å®šä¹‰çš„å­—ç¬¦ä¸²å½“åšåœ°å€ï¼Œç°åœ¨æ˜¯æ—¶å€™æ¥å®ç°çœŸæ­£çš„åœ°å€äº†ï¼Œå°±åƒå®ƒä»¬åœ¨æ¯”ç‰¹å¸ä¸­å®ç°çš„ä¸€æ ·ã€‚</p><a id="more"></a><h2 id="æ¯”ç‰¹å¸åœ°å€"><a href="#æ¯”ç‰¹å¸åœ°å€" class="headerlink" title="æ¯”ç‰¹å¸åœ°å€"></a>æ¯”ç‰¹å¸åœ°å€</h2><p>è¿™é‡Œæœ‰ä¸€ä¸ªæ¯”ç‰¹å¸åœ°å€çš„ç¤ºä¾‹ï¼š<a href="https://blockchain.info/address/1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa" target="_blank" rel="noopener">1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa</a>ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸æ—©æœŸçš„æ¯”ç‰¹å¸åœ°å€ï¼Œæ®ç§°æ˜¯å±äºä¸­æœ¬èªçš„æ¯”ç‰¹å¸åœ°å€ã€‚æ¯”ç‰¹å¸åœ°å€æ˜¯å…¬å¼€çš„ã€‚å¦‚æœä½ æƒ³è¦ç»™æŸäººå‘é€æ¯”ç‰¹å¸ï¼Œä½ éœ€è¦çŸ¥é“å¯¹æ–¹çš„æ¯”ç‰¹å¸åœ°å€ã€‚ä½†æ˜¯åœ°å€ï¼ˆå°½ç®¡å®ƒæ˜¯å”¯ä¸€çš„ï¼‰å¹¶ä¸èƒ½ä½œä¸ºä½ æ˜¯ä¸€ä¸ªé’±åŒ…æ‰€æœ‰è€…çš„å‡­è¯ã€‚äº‹å®ä¸Šï¼Œè¿™æ ·çš„åœ°å€æ˜¯å…¬é’¥çš„ä¸€ç§å¯è¯»æ€§æ›´å¥½çš„è¡¨ç¤º ã€‚åœ¨æ¯”ç‰¹å¸ä¸­ï¼Œä½ çš„èº«ä»½æ˜¯å­˜å‚¨åœ¨ä½ è®¡ç®—æœºä¸Šï¼ˆæˆ–å­˜å‚¨åœ¨ä½ æœ‰æƒè®¿é—®çš„å…¶ä»–ä½ç½®ï¼‰çš„ä¸€å¯¹ï¼ˆæˆ–å¤šå¯¹ï¼‰ç§é’¥å’Œå…¬é’¥ã€‚æ¯”ç‰¹å¸ä¾é åŠ å¯†ç®—æ³•çš„ç»„åˆæ¥åˆ›å»ºè¿™äº›å¯†é’¥ï¼Œå¹¶ä¿è¯ä¸–ç•Œä¸Šæ²¡æœ‰å…¶ä»–äººä»»ä½•äººå¯ä»¥åœ¨æ²¡æœ‰ç‰©ç†è®¿é—®å¯†é’¥çš„æƒ…å†µä¸‹è®¿é—®æ‚¨çš„æ¯”ç‰¹å¸ã€‚</p><blockquote><p>æ¯”ç‰¹å¸åœ°å€ä¸å…¬é’¥ä¸åŒã€‚æ¯”ç‰¹å¸åœ°å€æ˜¯ç”±å…¬é’¥ç»è¿‡å•å‘çš„å“ˆå¸Œå‡½æ•°ç”Ÿæˆçš„</p></blockquote><p><img src="https://img.i7years.com/blog/mbc2_0405_wangwei.png" alt="PubKey to bitcoin address"></p><p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹è¿™äº›åŠ å¯†ç®—æ³•ã€‚</p><blockquote><p><strong>æ³¨æ„</strong>ï¼šä¸è¦å‘æœ¬ç¯‡æ–‡ç« ä¸­çš„ä»£ç æ‰€ç”Ÿæˆçš„ä»»ä½•æ¯”ç‰¹å¸åœ°å€å‘é€çœŸå®çš„æ¯”ç‰¹å¸æ¥è¿›è¡Œæµ‹è¯•ï¼Œå¦åˆ™åæœè‡ªè´Ÿâ€¦â€¦</p></blockquote><h2 id="å…¬é’¥å¯†ç å­¦"><a href="#å…¬é’¥å¯†ç å­¦" class="headerlink" title="å…¬é’¥å¯†ç å­¦"></a>å…¬é’¥å¯†ç å­¦</h2><p>å…¬é’¥åŠ å¯†ç®—æ³•ï¼ˆpublic-key cryptographyï¼‰ä½¿ç”¨çš„æ˜¯å¯†é’¥å¯¹ï¼šå…¬é’¥å’Œç§é’¥ã€‚å…¬é’¥å±äºéæ•æ„Ÿä¿¡æ¯ï¼Œå¯ä»¥å‘ä»»ä½•äººé€éœ²ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œç§é’¥ä¸èƒ½å…¬å¼€æŠ«éœ²ï¼šé™¤äº†æ‰€æœ‰è€…ä¹‹å¤–ï¼Œä»»ä½•äººéƒ½ä¸èƒ½æ‹¥æœ‰ç§é’¥çš„æƒé™ï¼Œå› ä¸ºå®ƒæ˜¯ç”¨ä½œæ‰€æœ‰è€…æ ‡è¯†çš„ç§é’¥ã€‚ä½ çš„ç§é’¥ä»£è¡¨å°±æ˜¯ä½ ï¼ˆå½“ç„¶æ˜¯åœ¨åŠ å¯†è´§å¸ä¸–ç•Œé‡Œçš„ï¼‰ã€‚</p><p>æœ¬è´¨ä¸Šï¼Œæ¯”ç‰¹å¸é’±åŒ…å°±æ˜¯ä¸€å¯¹è¿™æ ·çš„å¯†é’¥ã€‚å½“ä½ å®‰è£…ä¸€ä¸ªé’±åŒ…åº”ç”¨ç¨‹åºæˆ–è€…ä½¿ç”¨æ¯”ç‰¹å¸å®¢æˆ·ç«¯å»ç”Ÿæˆä¸€ä¸ªæ–°çš„åœ°å€æ—¶ï¼Œå®ƒä»¬å°±ä¸ºä½ åˆ›å»ºå¥½äº†ä¸€ä¸ªå¯†é’¥å¯¹ã€‚åœ¨æ¯”ç‰¹å¸ç§ï¼Œè°æ§åˆ¶äº†ç§é’¥ï¼Œè°å°±æŒæ¡äº†æ‰€æœ‰å‘å¾€å¯¹åº”å…¬é’¥åœ°å€ä¸Šæ‰€æœ‰æ¯”ç‰¹å¸çš„æ§åˆ¶æƒã€‚</p><p>ç§é’¥å’Œå…¬é’¥åªæ˜¯éšæœºçš„å­—èŠ‚åºåˆ—ï¼Œå› æ­¤å®ƒä»¬ä¸èƒ½è¢«æ‰“å°åœ¨å±å¹•ä¸Šä¾›äººè¯»å–ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ¯”ç‰¹å¸ä¼šç”¨ä¸€ç§ç®—æ³•å°†å…¬é’¥çš„å­—èŠ‚åºåˆ—è½¬åŒ–ä¸ºäººç±»å¯è¯»çš„å­—ç¬¦ä¸²å½¢å¼ã€‚</p><blockquote><p>å¦‚æœä½ æ›¾ä»Šä½¿ç”¨è¿‡æ¯”ç‰¹å¸é’±åŒ…çš„åº”ç”¨ç¨‹åºï¼Œå®ƒå¯èƒ½ä¼šä¸ºä½ ç”ŸæˆåŠ©è®°è¯å¯†ç çŸ­è¯­ã€‚è¿™äº›åŠ©è®°è¯å¯ä»¥ç”¨æ¥æ›¿ä»£ç§é’¥ï¼Œå¹¶ä¸”èƒ½å¤Ÿç”Ÿæˆç§é’¥ã€‚è¿™ç§æœºåˆ¶æ˜¯é€šè¿‡ <a href="https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki" target="_blank" rel="noopener">BIP-039</a> æ¥å®ç°çš„ã€‚</p></blockquote><p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»çŸ¥é“åœ¨æ¯”ç‰¹å¸ä¸­ç”±ä»€ä¹ˆæ¥å†³å®šç”¨æˆ·çš„æ ‡è¯†äº†ã€‚ä½†æ˜¯ï¼Œæ¯”ç‰¹å¸æ˜¯å¦‚ä½•æ ¡éªŒäº¤æ˜“è¾“å‡ºï¼ˆå’Œå®ƒé‡Œé¢å­˜å‚¨çš„ä¸€äº›å¸ï¼‰çš„æ‰€æœ‰æƒçš„å‘¢ï¼Ÿ</p><h2 id="æ•°å­—ç­¾å"><a href="#æ•°å­—ç­¾å" class="headerlink" title="æ•°å­—ç­¾å"></a>æ•°å­—ç­¾å</h2><p>åœ¨æ•°å­¦å’Œå¯†ç å­¦ä¸­ï¼Œæœ‰ä¸ªæ•°å­—ç­¾åçš„æ¦‚å¿µï¼Œè¿™å¥—ç®—æ³•ä¿è¯äº†ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li>ä¿è¯æ•°æ®ä»å‘é€ç«¯ä¼ é€’åˆ°æ¥æ”¶ç«¯çš„è¿‡ç¨‹ä¸­ä¸ä¼šè¢«ç¯¡æ”¹ï¼›</li><li>æ•°æ®ç”±æŸä¸ªå‘é€è€…åˆ›å»ºï¼›</li><li>å‘é€è€…ä¸èƒ½å¦è®¤å‘é€çš„æ•°æ®ï¼›</li></ol><p>é€šè¿‡å¯¹æ•°æ®åº”ç”¨ç­¾åç®—æ³•ï¼ˆå³ç­¾ç½²æ•°æ®ï¼‰ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªç­¾åï¼Œä»¥åå¯ä»¥å¯¹å…¶è¿›è¡ŒéªŒè¯ã€‚æ•°å­—ç­¾åéœ€è¦ä½¿ç”¨ç§é’¥ï¼Œè€ŒéªŒè¯åˆ™éœ€è¦å…¬é’¥ã€‚</p><p>ä¸ºäº†èƒ½å¤Ÿç­¾ç½²æ•°æ®æˆ‘ä»¬éœ€è¦ï¼š</p><ol><li>ç”¨äºè¢«ç­¾åçš„æ•°æ®ï¼›</li><li>ç§é’¥ã€‚</li></ol><p>ç­¾åæ“ä½œä¼šäº§ç”Ÿä¸€ä¸ªå­˜å‚¨åœ¨äº¤æ˜“è¾“å…¥ä¸­çš„ç­¾åã€‚ä¸ºäº†èƒ½å¤ŸéªŒè¯ä¸€ä¸ªç­¾åï¼Œæˆ‘ä»¬éœ€è¦ï¼š</p><ol><li>ç­¾åä¹‹åçš„æ•°æ®ï¼›</li><li>ç­¾åï¼›</li><li>å…¬é’¥ã€‚</li></ol><p>ç®€å•æ¥è®²ï¼Œè¿™ä¸ªéªŒè¯çš„è¿‡ç¨‹å¯ä»¥è¢«æè¿°ä¸ºï¼šæ£€æŸ¥ç­¾åæ˜¯ç”±è¢«ç­¾åæ•°æ®åŠ ä¸Šç§é’¥å¾—æ¥ï¼Œå¹¶ä¸”è¿™ä¸ªå…¬é’¥ä¹Ÿæ˜¯ç”±è¯¥ç§é’¥ç”Ÿæˆã€‚</p><blockquote><p>æ•°å­—ç­¾åå¹¶ä¸æ˜¯ä¸€ç§åŠ å¯†æ–¹æ³•ï¼Œä½ æ— æ³•ä»ç­¾ååå‘æ„é€ å‡ºæºæ•°æ®ã€‚è¿™ä¸ªå’Œæˆ‘ä»¬ <a href="https://wangwei.one/posts/7890ab7e.html">å‰é¢</a> æåˆ°è¿‡çš„Hashç®—æ³•æœ‰ç‚¹ç±»ä¼¼ï¼šé€šè¿‡å¯¹ä¸€ä¸ªæ•°æ®ä½¿ç”¨Hashç®—æ³•ï¼Œä½ å¯ä»¥å¾—åˆ°è¯¥æ•°æ®çš„å”¯ä¸€è¡¨ç¤ºã€‚å®ƒä»¬ä¸¤è€…çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œç­¾åç®—æ³•å¤šäº†ä¸€ä¸ªå¯†é’¥å¯¹ï¼šå®ƒè®©æ•°å­—ç­¾åå¾—ä»¥éªŒè¯æˆä¸ºå¯èƒ½ã€‚</p><p>ä½†æ˜¯å¯†é’¥å¯¹ä¹Ÿèƒ½å¤Ÿç”¨äºå»åŠ å¯†æ•°æ®ï¼šç§é’¥ç”¨äºåŠ å¯†æ•°æ®ï¼Œå…¬é’¥ç”¨äºè§£å¯†æ•°æ®ã€‚ä¸è¿‡æ¯”ç‰¹å¸å¹¶æ²¡æœ‰ä½¿ç”¨åŠ å¯†ç®—æ³•ã€‚</p></blockquote><p>åœ¨æ¯”ç‰¹å¸ä¸­ï¼Œæ¯ä¸€ç¬”äº¤æ˜“è¾“å…¥éƒ½ä¼šè¢«è¯¥ç¬”äº¤æ˜“çš„åˆ›å»ºè€…è¿›è¡Œç­¾åã€‚æ¯”ç‰¹å¸ä¸­çš„æ¯ä¸€ç¬”äº¤æ˜“åœ¨æ”¾å…¥åŒºå—ä¹‹å‰éƒ½å¿…é¡»å¾—åˆ°éªŒè¯ã€‚éªŒè¯çš„æ„æ€å°±æ˜¯ï¼š</p><ul><li>æ£€æŸ¥äº¤æ˜“è¾“å…¥æ˜¯å¦æ‹¥æœ‰å¼•ç”¨å‰ä¸€ç¬”äº¤æ˜“ä¸­äº¤æ˜“è¾“å‡ºçš„æƒé™</li><li>æ£€æŸ¥äº¤æ˜“çš„ç­¾åæ˜¯å¦æ­£ç¡®</li></ul><p>æ•°æ®ç­¾åä»¥åŠç­¾åéªŒè¯çš„è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://img.i7years.com/blog/signing-scheme.png" alt="signing-scheme"></p><p>è®©æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹äº¤æ˜“çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼š</p><ol><li>æœ€å¼€å§‹ï¼Œä¼šæœ‰ä¸€ä¸ªåŒ…å«äº†Coinbaseäº¤æ˜“çš„åˆ›ä¸–åŒºå—ã€‚ç”±äºåœ¨Coinbaseäº¤æ˜“ä¸­æ²¡æœ‰çœŸæ­£çš„äº¤æ˜“è¾“å…¥ï¼Œæ‰€ä»¥å®ƒä¸éœ€è¦ç­¾åã€‚Coinbaseäº¤æ˜“çš„äº¤æ˜“è¾“å‡ºä¼šåŒ…å«ä¸€ä¸ªHashingä¹‹åçš„å…¬é’¥ï¼ˆä½¿ç”¨çš„ç®—æ³•ä¸º <code>RIPEMD16(SHA256(PubKey))</code> ï¼‰</li><li>å½“ä¸€ä¸ªäººå‘é€æ¯”ç‰¹å¸æ—¶ï¼Œä¼šåˆ›å»ºä¸€ç¬”äº¤æ˜“ã€‚è¿™ç¬”äº¤æ˜“çš„äº¤æ˜“è¾“å…¥ä¼šå¼•ç”¨å‰ä¸€ç¬”æˆ–å¤šç¬”äº¤æ˜“çš„äº¤æ˜“è¾“å‡ºã€‚æ¯ä¸€ä¸ªäº¤æ˜“è¾“å…¥å°†ä¼šå­˜å‚¨æœªç»Hashingå¤„ç†çš„å…¬é’¥ä»¥åŠæ•´ä¸ªäº¤æ˜“çš„ç­¾åä¿¡æ¯ã€‚</li><li>å½“æ¯”ç‰¹å¸ç½‘ç»œä¸­çš„å…¶ä»–èŠ‚ç‚¹æ”¶åˆ°å…¶ä»–èŠ‚ç‚¹å¹¿æ’­çš„äº¤æ˜“æ•°æ®ä¹‹åå°†ï¼Œå°†ä¼šå¯¹å…¶è¿›è¡ŒéªŒè¯ã€‚å…¶ä»–çš„äº‹æƒ…é™¤å¤–ï¼Œä»–ä»¬å°†ä¼šéªŒè¯ï¼š<ul><li>æ£€æŸ¥äº¤æ˜“è¾“å…¥ä¸­å…¬é’¥çš„Hashå€¼æ˜¯å¦ä¸å®ƒæ‰€å¼•ç”¨çš„äº¤æ˜“è¾“å‡ºçš„Hashå€¼æƒ³åŒ¹é…ï¼Œè¿™æ˜¯ç¡®ä¿å‘é€æ–¹åªèƒ½å‘é€å±äºä»–ä»¬è‡ªå·±çš„æ¯”ç‰¹å¸ã€‚</li><li>æ£€æŸ¥ç­¾åæ˜¯å¦æ­£ç¡®ï¼Œè¿™æ˜¯ä¸ºäº†ç¡®ä¿è¿™ç¬”äº¤æ˜“æ˜¯ç”±æ¯”ç‰¹å¸çš„çœŸæ­£æ‰€æœ‰è€…åˆ›å»ºçš„ã€‚</li></ul></li><li>å½“ä¸€ä¸ªçŸ¿å·¥å‡†å¤‡å¼€å§‹å¼€é‡‡ä¸€ä¸ªæ–°çš„åŒºå—æ—¶ï¼Œä»–ä¼šå°†äº¤æ˜“ä¿¡æ¯æ”¾å…¥åŒºå—ä¸­ï¼Œç„¶åå¼€å§‹æŒ–çŸ¿ã€‚</li><li>å½“ä¸€ä¸ªåŒºå—å®ŒæˆæŒ–çŸ¿ä¹‹åï¼Œç½‘ç»œä¸­çš„å…¶ä»–èŠ‚ç‚¹å°†ä¼šæ”¶åˆ°ä¸€æ¡åŒºå—å·²æŒ–çŸ¿å®Œæ¯•çš„æ¶ˆæ¯ï¼Œå¹¶ä¸”ä»–ä»¬ä¼šæŠŠè¿™ä¸ªåŒºå—æ·»åŠ åˆ°åŒºå—é“¾ä¸­å»ã€‚</li><li>å½“ä¸€ä¸ªåŒºå—è¢«æ·»åŠ åˆ°åŒºå—é“¾ä¹‹åï¼Œå°±æ ‡å¿—ç€è¿™ç¬”äº¤æ˜“å·²ç»å®Œæˆï¼Œå®ƒæ‰€äº§ç”Ÿçš„äº¤æ˜“è¾“å‡ºå°†ä¼šåœ¨æ–°çš„äº¤æ˜“ä¸­è¢«å¼•ç”¨ã€‚</li></ol><h2 id="æ¤­åœ†æ›²çº¿å¯†ç å­¦"><a href="#æ¤­åœ†æ›²çº¿å¯†ç å­¦" class="headerlink" title="æ¤­åœ†æ›²çº¿å¯†ç å­¦"></a>æ¤­åœ†æ›²çº¿å¯†ç å­¦</h2><p>æ­£å¦‚å‰é¢æ‰€æåˆ°çš„é‚£æ ·ï¼Œå…¬é’¥å’Œç§é’¥æ˜¯ä¸€ä¸²éšæœºçš„å­—ç¬¦åºåˆ—ã€‚ç”±äºç§é’¥æ˜¯ç”¨æ¥è¯†åˆ«æ¯”ç‰¹å¸æ‰€æœ‰è€…èº«ä»½çš„ç¼˜æ•…ï¼Œå› æ­¤æœ‰ä¸€ä¸ªå¿…è¦çš„æ¡ä»¶ï¼šè¿™ä¸ªéšæœºç®—æ³•å¿…é¡»äº§ç”ŸçœŸæ­£çš„éšæœºåºåˆ—ã€‚æˆ‘ä»¬ä¸å¸Œæœ›æ„å¤–åœ°ç”Ÿæˆå…¶ä»–äººæ‰€æ‹¥æœ‰çš„ç§é’¥ã€‚ä¹Ÿå°±æ˜¯è¦ä¿è¯éšæœºåºåˆ—çš„ç»å¯¹å”¯ä¸€æ€§ã€‚</p><p>æ¯”ç‰¹å¸æ˜¯ä½¿ç”¨çš„æ¤­åœ†æ›²çº¿æ¥ç”Ÿæˆçš„ç§é’¥ã€‚æ¤­åœ†æ›²çº¿æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„æ•°å­¦æ¦‚å¿µï¼Œè¿™é‡Œæˆ‘ä»¬ä¸åšè¯¦ç»†çš„ä»‹ç»ï¼ˆå¦‚æœä½ å¯¹æ­¤éå¸¸å¥½å¥‡ï¼Œå¯ä»¥ç‚¹å‡» <a href="http://andrea.corbellini.name/2015/05/17/elliptic-curve-cryptography-a-gentle-introduction/" target="_blank" rel="noopener">this gentle introduction to elliptic curves</a> è¿›è¡Œè¯¦ç»†çš„ äº†è§£ï¼Œè­¦å‘Šï¼šæ•°å­¦å…¬å¼ï¼‰ã€‚æˆ‘ä»¬éœ€è¦çŸ¥é“çš„æ˜¯ï¼Œè¿™äº›æ›²çº¿å¯ä»¥ç”¨æ¥ç”ŸæˆçœŸæ­£å¤§è€Œéšæœºçš„æ•°å­—ã€‚æ¯”ç‰¹å¸æ‰€é‡‡ç”¨çš„æ›²çº¿ç®—æ³•èƒ½å¤Ÿéšæœºç”Ÿæˆä¸€ä¸ªä»‹äº0åˆ° 2^2^56ä¹‹é—´çš„æ•°å­—ï¼ˆè¿™æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„æ•°å­—ï¼Œç”¨åè¿›åˆ¶è¡¨ç¤ºçš„è¯ï¼Œå¤§çº¦æ˜¯10^77ï¼Œ è€Œæ•´ä¸ªå¯è§çš„å®‡å®™ä¸­ï¼ŒåŸå­æ•°åœ¨ 10^78 åˆ° 10^82 ä¹‹é—´ï¼‰ ã€‚è¿™ä¹ˆå·¨å¤§çš„ä¸Šé™æ„å‘³ç€äº§ç”Ÿä¸¤ä¸ªä¸€æ ·çš„ç§é’¥æ˜¯å‡ ä¹ä¸å¯èƒ½çš„äº‹æƒ…ã€‚</p><p>å¦å¤–ï¼Œæˆ‘ä»¬å°†ä¼šä½¿ç”¨æ¯”ç‰¹å¸ä¸­æ‰€ä½¿ç”¨çš„ ECDSA ï¼ˆæ¤­åœ†æ›²çº¿æ•°å­—ç­¾åç®—æ³•ï¼‰å»ç­¾ç½²äº¤æ˜“ä¿¡æ¯ã€‚</p><h2 id="Base58å’ŒBase58Checkç¼–ç "><a href="#Base58å’ŒBase58Checkç¼–ç " class="headerlink" title="Base58å’ŒBase58Checkç¼–ç "></a>Base58å’ŒBase58Checkç¼–ç </h2><p>ç°åœ¨è®©æˆ‘ä»¬å›åˆ°ä¸Šé¢æåˆ°çš„æ¯”ç‰¹å¸åœ°å€ï¼š<a href="https://blockchain.info/address/1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa" target="_blank" rel="noopener">1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa</a> . ç°åœ¨æˆ‘ä»¬çŸ¥é“è¿™ä¸ªåœ°å€å…¶å®æ˜¯å…¬é’¥çš„ä¸€ç§å¯è¯»é«˜çš„è¡¨ç¤ºæ–¹å¼ã€‚å¦‚æœæˆ‘ä»¬å¯¹ä»–è¿›è¡Œè§£ç ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°å…¬é’¥çœ‹èµ·æ¥æ˜¯è¿™æ ·å­çš„ï¼ˆå­—èŠ‚åºåˆ—çš„åå…­è¿›åˆ¶çš„è¡¨ç¤ºæ–¹å¼ï¼‰ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0062</span>E907B15CBF27D5425399EBF6F0FB50EBB88F18C29B7D93</span><br></pre></td></tr></table></figure><h4 id="Base58"><a href="#Base58" class="headerlink" title="Base58"></a>Base58</h4><p>Base64ä½¿ç”¨äº†26ä¸ªå°å†™å­—æ¯ã€26ä¸ªå¤§å†™å­—æ¯ã€10ä¸ªæ•°å­—ä»¥åŠä¸¤ä¸ªç¬¦å·ï¼ˆä¾‹å¦‚â€œ+â€å’Œâ€œ/â€ï¼‰ï¼Œç”¨äºåœ¨ç”µå­é‚®ä»¶è¿™æ ·çš„åŸºäºæ–‡æœ¬çš„åª’ä»‹ä¸­ä¼ è¾“äºŒè¿›åˆ¶æ•°æ®ã€‚Base64é€šå¸¸ç”¨äºç¼–ç é‚®ä»¶ä¸­çš„é™„ä»¶ã€‚Base58æ˜¯ä¸€ç§åŸºäºæ–‡æœ¬çš„äºŒè¿›åˆ¶ç¼–ç æ ¼å¼ï¼Œç”¨åœ¨æ¯”ç‰¹å¸å’Œå…¶å®ƒçš„åŠ å¯†è´§å¸ä¸­ã€‚è¿™ç§ç¼–ç æ ¼å¼ä¸ä»…å®ç°äº†æ•°æ®å‹ç¼©ï¼Œä¿æŒäº†æ˜“è¯»æ€§ï¼Œè¿˜å…·æœ‰é”™è¯¯è¯Šæ–­åŠŸèƒ½ã€‚Base58æ˜¯Base64ç¼–ç æ ¼å¼çš„å­é›†ï¼ŒåŒæ ·ä½¿ç”¨å¤§å°å†™å­—æ¯å’Œ10ä¸ªæ•°å­—ï¼Œä½†èˆå¼ƒäº†ä¸€äº›å®¹æ˜“é”™è¯»å’Œåœ¨ç‰¹å®šå­—ä½“ä¸­å®¹æ˜“æ··æ·†çš„å­—ç¬¦ã€‚å…·ä½“åœ°ï¼ŒBase58ä¸å«Base64ä¸­çš„0ï¼ˆæ•°å­—0ï¼‰ã€Oï¼ˆå¤§å†™å­—æ¯oï¼‰ã€lï¼ˆå°å†™å­—æ¯Lï¼‰ã€Iï¼ˆå¤§å†™å­—æ¯iï¼‰ï¼Œä»¥åŠâ€œ+â€å’Œâ€œ/â€ä¸¤ä¸ªå­—ç¬¦ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒBase58å°±æ˜¯ç”±ä¸åŒ…æ‹¬ï¼ˆ0ï¼ŒOï¼Œlï¼ŒIï¼‰çš„å¤§å°å†™å­—æ¯å’Œæ•°å­—ç»„æˆã€‚</p><p>æ¯”ç‰¹å¸çš„Base58å­—æ¯è¡¨ï¼š</p><blockquote><p>123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz</p></blockquote><h4 id="Base58Check"><a href="#Base58Check" class="headerlink" title="Base58Check"></a>Base58Check</h4><p>Base58Checkæ˜¯ä¸€ç§å¸¸ç”¨åœ¨æ¯”ç‰¹å¸ä¸­çš„Base58ç¼–ç æ ¼å¼ï¼Œå¢åŠ äº†é”™è¯¯æ ¡éªŒç æ¥æ£€æŸ¥æ•°æ®åœ¨è½¬å½•ä¸­å‡ºç°çš„é”™è¯¯ã€‚æ ¡éªŒç é•¿4ä¸ªå­—èŠ‚ï¼Œæ·»åŠ åˆ°éœ€è¦ç¼–ç çš„æ•°æ®ä¹‹åã€‚æ ¡éªŒç æ˜¯ä»éœ€è¦ç¼–ç çš„æ•°æ®çš„å“ˆå¸Œå€¼ä¸­å¾—åˆ°çš„ï¼Œæ‰€ä»¥å¯ä»¥ç”¨æ¥æ£€æµ‹å¹¶é¿å…è½¬å½•å’Œè¾“å…¥ä¸­äº§ç”Ÿçš„é”™è¯¯ã€‚ä½¿ç”¨Base58checkç¼–ç æ ¼å¼æ—¶ï¼Œç¼–ç è½¯ä»¶ä¼šè®¡ç®—åŸå§‹æ•°æ®çš„æ ¡éªŒç å¹¶å’Œç»“æœæ•°æ®ä¸­è‡ªå¸¦çš„æ ¡éªŒç è¿›è¡Œå¯¹æ¯”ã€‚äºŒè€…ä¸åŒ¹é…åˆ™è¡¨æ˜æœ‰é”™è¯¯äº§ç”Ÿï¼Œé‚£ä¹ˆè¿™ä¸ªBase58Checkæ ¼å¼çš„æ•°æ®å°±æ˜¯æ— æ•ˆçš„ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªé”™è¯¯æ¯”ç‰¹å¸åœ°å€å°±ä¸ä¼šè¢«é’±åŒ…è®¤ä¸ºæ˜¯æœ‰æ•ˆçš„åœ°å€ï¼Œå¦åˆ™è¿™ç§é”™è¯¯ä¼šé€ æˆèµ„é‡‘çš„ä¸¢å¤±ã€‚</p><p>ä¸ºäº†ä½¿ç”¨Base58Checkç¼–ç æ ¼å¼å¯¹æ•°æ®ï¼ˆæ•°å­—ï¼‰è¿›è¡Œç¼–ç ï¼Œé¦–å…ˆæˆ‘ä»¬è¦å¯¹æ•°æ®æ·»åŠ ä¸€ä¸ªç§°ä½œâ€œç‰ˆæœ¬å­—èŠ‚â€çš„å‰ç¼€ï¼Œè¿™ä¸ªå‰ç¼€ç”¨æ¥æ˜ç¡®éœ€è¦ç¼–ç çš„æ•°æ®çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼Œæ¯”ç‰¹å¸åœ°å€çš„å‰ç¼€æ˜¯0ï¼ˆåå…­è¿›åˆ¶æ˜¯0x00ï¼‰ï¼Œè€Œå¯¹ç§é’¥ç¼–ç æ—¶å‰ç¼€æ˜¯128ï¼ˆåå…­è¿›åˆ¶æ˜¯0x80ï¼‰ã€‚</p><p>è®©æˆ‘ä»¬ä»¥ç¤ºæ„å›¾çš„å½¢å¼å±•ç¤ºä¸€ä¸‹ä»å…¬é’¥å¾—åˆ°åœ°å€çš„è¿‡ç¨‹ï¼š</p><p><img src="https://img.i7years.com/blog/mbc2_0406_wangwei.png" alt="Base58Check Encoding"></p><p>å› æ­¤ï¼Œä¸Šè¿°è§£ç çš„å…¬é’¥ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Version  Public key hash                           Checksum</span><br><span class="line"><span class="number">00</span>       <span class="number">62</span>E907B15CBF27D5425399EBF6F0FB50EBB88F18  C29B7D93</span><br></pre></td></tr></table></figure><p>ç”±äºå“ˆå¸Œå‡½æ•°æ˜¯å•å‘çš„ï¼ˆä¹Ÿå°±è¯´æ— æ³•é€†è½¬å›å»ï¼‰ï¼Œæ‰€ä»¥ä¸å¯èƒ½ä»ä¸€ä¸ªå“ˆå¸Œä¸­æå–å…¬é’¥ã€‚ä¸è¿‡é€šè¿‡æ‰§è¡Œå“ˆå¸Œå‡½æ•°å¹¶è¿›è¡Œå“ˆå¸Œæ¯”è¾ƒï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥ä¸€ä¸ªå…¬é’¥æ˜¯å¦è¢«ç”¨äºå“ˆå¸Œçš„ç”Ÿæˆã€‚</p><p>OKï¼Œç°åœ¨æˆ‘ä»¬æœ‰äº†æ‰€æœ‰çš„ä¸œè¥¿ï¼Œè®©æˆ‘ä»¬æ¥ç¼–å†™ä¸€äº›ä»£ç ã€‚ å½“ä¸€äº›æ¦‚å¿µè¢«å†™æˆä»£ç æ—¶ï¼Œæˆ‘ä»¬ä¼šå¯¹æ­¤ç†è§£çš„æ›´åŠ æ¸…æ™°å’Œæ·±åˆ»ã€‚</p><h2 id="åœ°å€å®ç°"><a href="#åœ°å€å®ç°" class="headerlink" title="åœ°å€å®ç°"></a>åœ°å€å®ç°</h2><p>è®©æˆ‘ä»¬ä» <strong>Wallet</strong> çš„æ„æˆå¼€å§‹ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦å…ˆå¼•å…¥ä¸€ä¸ªmavenåŒ…ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.bouncycastle<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>bcprov-jdk15on<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.59<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é’±åŒ…ç»“æ„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é’±åŒ…</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/03/14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Wallet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¡éªŒç é•¿åº¦</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ADDRESS_CHECKSUM_LEN = <span class="number">4</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç§é’¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> BCECPrivateKey privateKey;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…¬é’¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] publicKey;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Wallet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        initWallet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ–é’±åŒ…</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initWallet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            KeyPair keyPair = newECKeyPair();</span><br><span class="line">            BCECPrivateKey privateKey = (BCECPrivateKey) keyPair.getPrivate();</span><br><span class="line">            BCECPublicKey publicKey = (BCECPublicKey) keyPair.getPublic();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">byte</span>[] publicKeyBytes = publicKey.getQ().getEncoded(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>.setPrivateKey(privateKey);</span><br><span class="line">            <span class="keyword">this</span>.setPublicKey(publicKeyBytes);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºæ–°çš„å¯†é’¥å¯¹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> KeyPair <span class="title">newKeyPair</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// æ³¨å†Œ BC Provider</span></span><br><span class="line">        Security.addProvider(<span class="keyword">new</span> BouncyCastleProvider());</span><br><span class="line">        <span class="comment">// åˆ›å»ºæ¤­åœ†æ›²çº¿ç®—æ³•çš„å¯†é’¥å¯¹ç”Ÿæˆå™¨ï¼Œç®—æ³•ä¸º ECDSA</span></span><br><span class="line">        KeyPairGenerator g = KeyPairGenerator.getInstance(<span class="string">"ECDSA"</span>, BouncyCastleProvider.PROVIDER_NAME);</span><br><span class="line">        <span class="comment">// æ¤­åœ†æ›²çº¿ï¼ˆECï¼‰åŸŸå‚æ•°è®¾å®š</span></span><br><span class="line">        <span class="comment">// bitcoin ä¸ºä»€ä¹ˆä¼šé€‰æ‹© secp256k1ï¼Œè¯¦è§ï¼šhttps://bitcointalk.org/index.php?topic=151120.0</span></span><br><span class="line">        ECParameterSpec ecSpec = ECNamedCurveTable.getParameterSpec(<span class="string">"secp256k1"</span>);</span><br><span class="line">        g.initialize(ecSpec, <span class="keyword">new</span> SecureRandom());</span><br><span class="line">        <span class="keyword">return</span> g.generateKeyPair();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€è°“çš„é’±åŒ…ï¼Œå…¶å®æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå¯†é’¥å¯¹ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦å€ŸåŠ© <strong><em>KeyPairGenerator</em></strong> ç”Ÿæˆå¯†é’¥å¯¹ã€‚</p><p>æ¥ç€ï¼Œæˆ‘ä»¬æ¥ç”Ÿæˆæ¯”ç‰¹å¸çš„é’±åŒ…åœ°å€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Wallet</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">   </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–é’±åŒ…åœ°å€</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAddress</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 1. è·å– ripemdHashedKey</span></span><br><span class="line">        <span class="keyword">byte</span>[] ripemdHashedKey = BtcAddressUtils.ripeMD160Hash(<span class="keyword">this</span>.getPublicKey();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. æ·»åŠ ç‰ˆæœ¬ 0x00</span></span><br><span class="line">        ByteArrayOutputStream addrStream = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        addrStream.write((<span class="keyword">byte</span>) <span class="number">0</span>);</span><br><span class="line">        addrStream.write(ripemdHashedKey);</span><br><span class="line">        <span class="keyword">byte</span>[] versionedPayload = addrStream.toByteArray();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. è®¡ç®—æ ¡éªŒç </span></span><br><span class="line">        <span class="keyword">byte</span>[] checksum = BtcAddressUtils.checksum(versionedPayload);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. å¾—åˆ° version + paylod + checksum çš„ç»„åˆ</span></span><br><span class="line">        addrStream.write(checksum);</span><br><span class="line">        <span class="keyword">byte</span>[] binaryAddress = addrStream.toByteArray();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5. æ‰§è¡ŒBase58è½¬æ¢å¤„ç†</span></span><br><span class="line">        <span class="keyword">return</span> Base58Check.rawBytesToBase58(binaryAddress);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™ï¼Œä½ å°±å¯ä»¥å¾—åˆ° <strong>çœŸå®çš„æ¯”ç‰¹å¸åœ°å€</strong> äº†ï¼Œå¹¶ä¸”ä½ å¯ä»¥åˆ° <a href="https://blockchain.info/" target="_blank" rel="noopener">blockchain.info</a> ä¸Šå»æ£€æŸ¥è¿™ä¸ªåœ°å€çš„ä½™é¢ã€‚</p><blockquote><p>ä¾‹å¦‚ï¼Œé€šè¿‡ <strong>getAddress</strong> æ–¹æ³•ï¼Œå¾—åˆ°äº†ä¸€ä¸ªæ¯”ç‰¹å¸åœ°å€ä¸ºï¼š<a href="https://blockchain.info/address/1rZ9SjXMRwnbW3Pu8itC1HtNBVHERSQhaACbL16" target="_blank" rel="noopener">1rZ9SjXMRwnbW3Pu8itC1HtNBVHERSQhaACbL16</a></p></blockquote><p>æˆ‘æ•¢ä¿è¯ï¼Œæ— è®ºä½ ç”Ÿæˆå¤šå°‘æ¬¡æ¯”ç‰¹å¸åœ°å€ï¼Œå®ƒçš„ä½™é¢å§‹ç»ˆä¸º0.è¿™å°±æ˜¯ä¸ºä»€ä¹ˆé€‰æ‹©é€‚å½“çš„å…¬é’¥å¯†ç ç®—æ³•å¦‚æ­¤é‡è¦ï¼šè€ƒè™‘åˆ°ç§é’¥æ˜¯éšæœºæ•°å­—ï¼Œäº§ç”Ÿç›¸åŒæ•°å­—çš„æœºä¼šå¿…é¡»å°½å¯èƒ½ä½ã€‚ ç†æƒ³æƒ…å†µä¸‹ï¼Œå®ƒå¿…é¡»ä½è‡³â€œæ°¸ä¸â€ã€‚</p><p>å¦å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ä½ ä¸éœ€è¦è¿æ¥åˆ°æ¯”ç‰¹å¸çš„èŠ‚ç‚¹ä¸Šå»è·å–æ¯”ç‰¹å¸çš„åœ°å€ã€‚æœ‰å…³åœ°å€ç”Ÿæˆçš„å¼€æºç®—æ³•å·¥å…·åŒ…å·²ç»æœ‰å¾ˆå¤šç¼–ç¨‹è¯­è¨€å’Œåº“å®ç°äº†ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å»ä¿®æ”¹äº¤æ˜“è¾“å…¥ä¸è¾“å‡ºï¼Œè®©ä»–ä»¬å¼€å§‹ä½¿ç”¨çœŸå®çš„åœ°å€ï¼š</p><h4 id="äº¤æ˜“è¾“å…¥"><a href="#äº¤æ˜“è¾“å…¥" class="headerlink" title="äº¤æ˜“è¾“å…¥"></a>äº¤æ˜“è¾“å…¥</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * äº¤æ˜“è¾“å…¥</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2017/03/04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TXInput</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äº¤æ˜“Idçš„hashå€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] txId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äº¤æ˜“è¾“å‡ºç´¢å¼•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> txOutputIndex;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç­¾å</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] signature;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…¬é’¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] pubKey;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ£€æŸ¥å…¬é’¥hashæ˜¯å¦ç”¨äºäº¤æ˜“è¾“å…¥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pubKeyHash</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">usesKey</span><span class="params">(<span class="keyword">byte</span>[] pubKeyHash)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] lockingHash = BtcAddressUtils.ripeMD160Hash(<span class="keyword">this</span>.getPubKey());</span><br><span class="line">        <span class="keyword">return</span> Arrays.equals(lockingHash, pubKeyHash);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="äº¤æ˜“è¾“å‡º"><a href="#äº¤æ˜“è¾“å‡º" class="headerlink" title="äº¤æ˜“è¾“å‡º"></a>äº¤æ˜“è¾“å‡º</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * äº¤æ˜“è¾“å‡º</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2017/03/04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TXOutput</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> value;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…¬é’¥Hash</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] pubKeyHash;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºäº¤æ˜“è¾“å‡º</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> address</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TXOutput <span class="title">newTXOutput</span><span class="params">(<span class="keyword">int</span> value, String address)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åå‘è½¬åŒ–ä¸º byte æ•°ç»„</span></span><br><span class="line">        <span class="keyword">byte</span>[] versionedPayload = Base58Check.base58ToBytes(address);</span><br><span class="line">        <span class="keyword">byte</span>[] pubKeyHash = Arrays.copyOfRange(versionedPayload, <span class="number">1</span>, versionedPayload.length);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TXOutput(value, pubKeyHash);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ£€æŸ¥äº¤æ˜“è¾“å‡ºæ˜¯å¦èƒ½å¤Ÿä½¿ç”¨æŒ‡å®šçš„å…¬é’¥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pubKeyHash</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isLockedWithKey</span><span class="params">(<span class="keyword">byte</span>[] pubKeyHash)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.equals(<span class="keyword">this</span>.getPubKeyHash(), pubKeyHash);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä»£ç ä¸­è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„åœ°æ–¹éœ€è¦å˜åŠ¨ï¼Œè¿™é‡Œä¸ä¸€ä¸€æŒ‡å‡ºï¼Œè¯¦è§æ–‡æœ«çš„æºç è¿æ¥ã€‚</p></blockquote><p>æ³¨æ„ï¼Œç”±äºæˆ‘ä»¬ä¸ä¼šå»å®ç°è„šæœ¬è¯­è¨€ç‰¹æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å†ä½¿ç”¨ <strong>scriptPubKey</strong> å’Œ <strong>scriptSig</strong> å­—æ®µã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œæˆ‘ä»¬å°† <strong>scriptSig</strong> æ‹†åˆ†ä¸ºäº† <strong>signature</strong> å’Œ <strong>pubKey</strong> å­—æ®µï¼Œ<strong>scriptPubKey</strong> é‡å‘½åä¸ºäº† <strong>pubKeyHash</strong> ã€‚æˆ‘ä»¬å°†ä¼šå®ç°ç±»ä¼¼äºæ¯”ç‰¹å¸ä¸­çš„äº¤æ˜“è¾“å‡ºé”å®š/è§£é”é€»è¾‘å’Œäº¤æ˜“è¾“å…¥çš„ç­¾åé€»è¾‘ï¼Œä½†æ˜¯æˆ‘ä»¬ä¼šåœ¨æ–¹æ³•ä¸­æ‰§è¡Œæ­¤æ“ä½œã€‚</p><p><strong>usesKey</strong> ç”¨äºæ£€æŸ¥äº¤æ˜“è¾“å…¥ä¸­çš„å…¬é’¥æ˜¯å¦èƒ½å¤Ÿè§£é”äº¤æ˜“è¾“å‡ºã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œäº¤æ˜“è¾“å…¥ä¸­å­˜å‚¨çš„æ˜¯æœªç»hashè¿‡çš„å…¬é’¥ï¼Œä½†æ˜¯æ–¹æ³•å®ç°ä¸­å¯¹å®ƒåšäº†ä¸€æ­¥ <code>ripeMD160Hash</code> è½¬åŒ–ã€‚</p><p><strong>isLockedWithKey</strong> ç”¨äºæ£€æŸ¥æä¾›çš„å…¬é’¥Hashæ˜¯å¦èƒ½å¤Ÿç”¨äºè§£é”äº¤æ˜“è¾“å‡ºï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ <strong>usesKey</strong> çš„è¡¥å……ã€‚<strong>usesKey</strong> è¢«ç”¨äº <strong>getAllSpentTXOs</strong> æ–¹æ³•ä¸­ï¼Œ<strong>isLockedWithKey</strong> è¢«ç”¨äº <strong>findUnspentTransactions</strong> æ–¹æ³•ä¸­ï¼Œè¿™æ ·ä½¿å¾—åœ¨å‰åä¸¤ç¬”äº¤æ˜“ä¹‹é—´å»ºç«‹èµ·äº†è¿æ¥ã€‚</p><p><strong>newTXOutput</strong> æ–¹æ³•ä¸­ï¼Œå°† value é”å®šåˆ°äº† address ä¸Šã€‚å½“æˆ‘ä»¬å‘åˆ«äººå‘é€æ¯”ç‰¹å¸æ—¶ï¼Œæˆ‘ä»¬åªçŸ¥é“ä»–ä»¬çš„åœ°å€ï¼Œå› æ­¤å‡½æ•°å°†åœ°å€ä½œä¸ºå”¯ä¸€çš„å‚æ•°ã€‚ç„¶åè§£ç åœ°å€ï¼Œå¹¶ä»ä¸­æå–å…¬é’¥å“ˆå¸Œå¹¶ä¿å­˜åœ¨PubKeyHashå­—æ®µä¸­ã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥æ£€æŸ¥ä¸€ä¸‹æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">$ ./blochchain.sh  createwallet</span><br><span class="line">wallet address : <span class="number">13</span>dJAkeMyjjXvWCmhsXpDqnszHvhFSLVdh</span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  createwallet</span><br><span class="line">wallet address : <span class="number">1</span>BCY5gCXUMiFYc5ieBMfEUaZn3GYkvVZ2e</span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  createwallet</span><br><span class="line">wallet address : <span class="number">19</span>aomsC58CQ1tPzNLx7kV9yjk1pqZtSzL1</span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  createblockchain -address <span class="number">13</span>dJAkeMyjjXvWCmhsXpDqnszHvhFSLVdh</span><br><span class="line"></span><br><span class="line">Elapsed Time: <span class="number">6.77</span> seconds </span><br><span class="line">correct hash Hex: <span class="number">00000</span>e44be0c94c39a4fef24c67d85c428e8bfbd227e292d75c0f4d398e2e81c </span><br><span class="line"></span><br><span class="line">Done ! </span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  getbalance -address <span class="number">13</span>dJAkeMyjjXvWCmhsXpDqnszHvhFSLVdh</span><br><span class="line">Balance of <span class="string">'13dJAkeMyjjXvWCmhsXpDqnszHvhFSLVdh'</span>: <span class="number">10</span></span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  send -from <span class="number">1</span>BCY5gCXUMiFYc5ieBMfEUaZn3GYkvVZ2e -to  <span class="number">13</span>dJAkeMyjjXvWCmhsXpDqnszHvhFSLVd -amount <span class="number">5</span></span><br><span class="line">java.lang.Exception: ERROR: Not enough funds</span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  send -from <span class="number">13</span>dJAkeMyjjXvWCmhsXpDqnszHvhFSLVdh -to <span class="number">1</span>BCY5gCXUMiFYc5ieBMfEUaZn3GYkvVZ2e-amount <span class="number">5</span></span><br><span class="line">Elapsed Time: <span class="number">4.477</span> seconds </span><br><span class="line">correct hash Hex: <span class="number">00000</span>da41dfacc8032a553ed5b1aa5e24318d5d89ca14a16c4f70129609c8365 </span><br><span class="line"></span><br><span class="line">Success!</span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  getbalance -address <span class="number">13</span>dJAkeMyjjXvWCmhsXpDqnszHvhFSLVdh</span><br><span class="line">Balance of <span class="string">'13dJAkeMyjjXvWCmhsXpDqnszHvhFSLVdh'</span>: <span class="number">5</span></span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  getbalance -address <span class="number">1</span>BCY5gCXUMiFYc5ieBMfEUaZn3GYkvVZ2e</span><br><span class="line">Balance of <span class="string">'1BCY5gCXUMiFYc5ieBMfEUaZn3GYkvVZ2e'</span>: <span class="number">5</span></span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  getbalance -address <span class="number">19</span>aomsC58CQ1tPzNLx7kV9yjk1pqZtSzL1</span><br><span class="line">Balance of <span class="string">'19aomsC58CQ1tPzNLx7kV9yjk1pqZtSzL1'</span>: <span class="number">0</span></span><br></pre></td></tr></table></figure><p>Nice! ç°åœ¨è®©æˆ‘ä»¬ä¸€èµ·æ¥å®ç°äº¤æ˜“ç­¾åéƒ¨åˆ†çš„å†…å®¹ã€‚</p><h2 id="ç­¾åå®ç°"><a href="#ç­¾åå®ç°" class="headerlink" title="ç­¾åå®ç°"></a>ç­¾åå®ç°</h2><p>äº¤æ˜“æ•°æ®å¿…é¡»è¢«ç­¾åï¼Œå› ä¸ºè¿™æ˜¯æ¯”ç‰¹å¸ä¸­èƒ½å¤Ÿä¿è¯ä¸èƒ½èŠ±è´¹å±äºä»–äººæ¯”ç‰¹å¸çš„å”¯ä¸€æ–¹æ³•ã€‚å¦‚æœä¸€ä¸ªç­¾åæ˜¯æ— æ•ˆçš„ï¼Œé‚£ä¹ˆè¿™ç¬”äº¤æ˜“ä¹Ÿæ˜¯æ— æ•ˆçš„ï¼Œè¿™æ ·çš„è¯ï¼Œè¿™ç¬”äº¤æ˜“å°±ä¸èƒ½è¢«æ·»åŠ åˆ°åŒºå—é“¾ä¸­å»ã€‚</p><p>æˆ‘ä»¬å·²ç»æœ‰äº†å®ç°äº¤æ˜“ç­¾åçš„æ‰€æœ‰ç‰‡æ®µï¼Œè¿˜æœ‰ä¸€ä¸ªäº‹æƒ…é™¤å¤–ï¼šç”¨äºç­¾åçš„æ•°æ®ã€‚äº¤æ˜“æ•°æ®ä¸­å“ªä¸€éƒ¨åˆ†æ˜¯çœŸæ­£ç”¨äºç­¾åçš„å‘¢ï¼Ÿéš¾é“æ˜¯å…¨éƒ¨æ•°æ®ï¼Ÿé€‰æ‹©ç”¨äºç­¾åçš„æ•°æ®ç›¸å½“çš„é‡è¦ã€‚ç”¨äºç­¾åçš„æ•°æ®å¿…é¡»åŒ…å«ä»¥ç‹¬ç‰¹ä¸”å”¯ä¸€çš„æ–¹å¼æ ‡è¯†æ•°æ®çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œä»…å¯¹äº¤æ˜“è¾“å‡ºç­¾åæ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºæ­¤ç­¾åä¸ä¼šè€ƒè™‘å‘é€å‘ä¸æ¥æ”¶æ–¹ã€‚</p><p>è€ƒè™‘åˆ°äº¤æ˜“æ•°æ®è¦è§£é”å‰é¢çš„äº¤æ˜“è¾“å‡ºï¼Œé‡æ–°åˆ†é…äº¤æ˜“è¾“å‡ºä¸­çš„ <em>value</em> å€¼ï¼Œå¹¶ä¸”é”å®šæ–°çš„äº¤æ˜“è¾“å‡ºï¼Œå› æ­¤ä¸‹é¢è¿™äº›æ•°æ®æ˜¯å¿…é¡»è¢«ç­¾åçš„ï¼š</p><ol><li>å­˜å‚¨åœ¨è§£é”äº†çš„äº¤æ˜“è¾“å‡ºä¸­çš„å…¬é’¥Hashã€‚å®ƒæ ‡è¯†äº†äº¤æ˜“çš„å‘é€æ–¹ã€‚</li><li>å­˜å‚¨åœ¨æ–°çš„ã€é”å®šçš„äº¤æ˜“è¾“å‡ºä¸­çš„å…¬é’¥Hashã€‚å®ƒæ ‡è¯†äº†äº¤æ˜“çš„æ¥æ”¶æ–¹ã€‚</li><li>æ–°çš„äº¤æ˜“è¾“å‡ºä¸­åŒ…å«çš„ <em>value</em> å€¼ã€‚</li></ol><blockquote><p>åœ¨æ¯”ç‰¹å¸ä¸­ï¼Œé”å®š/è§£é”é€»è¾‘å­˜å‚¨åœ¨è„šæœ¬ä¸­ï¼Œè§£é”è„šæœ¬å­˜å‚¨åœ¨äº¤æ˜“è¾“å…¥çš„ <em>ScriptSig</em> å­—æ®µä¸­ï¼Œè€Œé”å®šè„šæœ¬å­˜å‚¨åœ¨äº¤æ˜“è¾“å‡ºçš„ <em>ScriptPubKey</em> çš„å­—æ®µä¸­ã€‚ ç”±äºæ¯”ç‰¹å¸å…è®¸ä¸åŒç±»å‹çš„è„šæœ¬ï¼Œå› æ­¤å®ƒä¼šå¯¹ScriptPubKeyçš„å…¨éƒ¨å†…å®¹è¿›è¡Œç­¾åã€‚</p></blockquote><p>å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬ä¸éœ€è¦å»å¯¹å­˜å‚¨åœ¨äº¤æ˜“è¾“å…¥ä¸­çš„å…¬é’¥è¿›è¡Œç­¾åã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œåœ¨æ¯”ç‰¹å¸ä¸­ï¼Œæ‰€ç­¾åçš„å¹¶ä¸æ˜¯ä¸€ä¸ªäº¤æ˜“ï¼Œè€Œæ˜¯ä¸€ä¸ªå»é™¤éƒ¨åˆ†å†…å®¹çš„äº¤æ˜“è¾“å…¥å‰¯æœ¬ï¼Œäº¤æ˜“è¾“å…¥é‡Œé¢å­˜å‚¨äº†è¢«å¼•ç”¨äº¤æ˜“è¾“å‡ºçš„ <code>ScriptPubKey</code> ã€‚</p><blockquote><p>è·å–ä¿®å‰ªåçš„äº¤æ˜“å‰¯æœ¬çš„è¯¦ç»†è¿‡ç¨‹åœ¨<a href="https://en.bitcoin.it/wiki/File:Bitcoin_OpCheckSig_InDetail.png" target="_blank" rel="noopener">è¿™é‡Œ</a>. è™½ç„¶å®ƒå¯èƒ½å·²ç»è¿‡æ—¶äº†ï¼Œä½†æ˜¯æˆ‘å¹¶æ²¡æœ‰æ‰¾åˆ°å¦ä¸€ä¸ªæ›´å¯é çš„æ¥æºã€‚</p></blockquote><p>OKï¼Œå®ƒçœ‹èµ·æ¥æœ‰ç‚¹å¤æ‚ï¼Œå› æ­¤è®©æˆ‘ä»¬æ¥å¼€å§‹codingå§ã€‚æˆ‘ä»¬å°†ä» <strong>Sign</strong> æ–¹æ³•å¼€å§‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Transaction</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   ...</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç­¾å</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> privateKey ç§é’¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> prevTxMap  å‰é¢å¤šç¬”äº¤æ˜“é›†åˆ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sign</span><span class="params">(BCECPrivateKey privateKey, Map&lt;String, Transaction&gt; prevTxMap)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// coinbase äº¤æ˜“ä¿¡æ¯ä¸éœ€è¦ç­¾åï¼Œå› ä¸ºå®ƒä¸å­˜åœ¨äº¤æ˜“è¾“å…¥ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.isCoinbase()) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å†æ¬¡éªŒè¯ä¸€ä¸‹äº¤æ˜“ä¿¡æ¯ä¸­çš„äº¤æ˜“è¾“å…¥æ˜¯å¦æ­£ç¡®ï¼Œä¹Ÿå°±æ˜¯èƒ½å¦æŸ¥æ‰¾å¯¹åº”çš„äº¤æ˜“æ•°æ®</span></span><br><span class="line">        <span class="keyword">for</span> (TXInput txInput : <span class="keyword">this</span>.getInputs()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (prevTxMap.get(Hex.encodeHexString(txInput.getTxId())) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"ERROR: Previous transaction is not correct"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºç”¨äºç­¾åçš„äº¤æ˜“ä¿¡æ¯çš„å‰¯æœ¬</span></span><br><span class="line">        Transaction txCopy = <span class="keyword">this</span>.trimmedCopy();</span><br><span class="line">      </span><br><span class="line">        Security.addProvider(<span class="keyword">new</span> BouncyCastleProvider());</span><br><span class="line">        Signature ecdsaSign = Signature.getInstance(<span class="string">"SHA256withECDSA"</span>, BouncyCastleProvider.PROVIDER_NAME);</span><br><span class="line">        ecdsaSign.initSign(privateKey);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; txCopy.getInputs().length; i++) &#123;</span><br><span class="line">            TXInput txInputCopy = txCopy.getInputs()[i];</span><br><span class="line">            <span class="comment">// è·å–äº¤æ˜“è¾“å…¥TxIDå¯¹åº”çš„äº¤æ˜“æ•°æ®</span></span><br><span class="line">            Transaction prevTx = prevTxMap.get(Hex.encodeHexString(txInputCopy.getTxId()));</span><br><span class="line">            <span class="comment">// è·å–äº¤æ˜“è¾“å…¥æ‰€å¯¹åº”çš„ä¸Šä¸€ç¬”äº¤æ˜“ä¸­çš„äº¤æ˜“è¾“å‡º</span></span><br><span class="line">            TXOutput prevTxOutput = prevTx.getOutputs()[txInputCopy.getTxOutputIndex()];</span><br><span class="line">            txInputCopy.setPubKey(prevTxOutput.getPubKeyHash());</span><br><span class="line">            txInputCopy.setSignature(<span class="keyword">null</span>);</span><br><span class="line">            <span class="comment">// å¾—åˆ°è¦ç­¾åçš„æ•°æ®ï¼Œå³äº¤æ˜“ID</span></span><br><span class="line">            txCopy.setTxId(txCopy.hash());</span><br><span class="line">            txInputCopy.setPubKey(<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¯¹æ•´ä¸ªäº¤æ˜“ä¿¡æ¯ä»…è¿›è¡Œç­¾åï¼Œå³å¯¹äº¤æ˜“IDè¿›è¡Œç­¾å</span></span><br><span class="line">            ecdsaSign.update(txCopy.getTxId());</span><br><span class="line">            <span class="keyword">byte</span>[] signature = ecdsaSign.sign();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å°†æ•´ä¸ªäº¤æ˜“æ•°æ®çš„ç­¾åèµ‹å€¼ç»™äº¤æ˜“è¾“å…¥ï¼Œå› ä¸ºäº¤æ˜“è¾“å…¥éœ€è¦åŒ…å«æ•´ä¸ªäº¤æ˜“ä¿¡æ¯çš„ç­¾å</span></span><br><span class="line">            <span class="comment">// æ³¨æ„æ˜¯å°†å¾—åˆ°çš„ç­¾åèµ‹å€¼ç»™åŸäº¤æ˜“ä¿¡æ¯ä¸­çš„äº¤æ˜“è¾“å…¥</span></span><br><span class="line">            <span class="keyword">this</span>.getInputs()[i].setSignature(signature);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•éœ€è¦ç§é’¥å’Œå‰é¢å¤šç¬”äº¤æ˜“é›†åˆä½œä¸ºå‚æ•°ã€‚æ­£å¦‚å‰é¢æ‰€æåˆ°çš„é‚£æ ·ï¼Œä¸ºäº†èƒ½å¤Ÿå¯¹äº¤æ˜“ä¿¡æ¯è¿›è¡Œç­¾åï¼Œæˆ‘ä»¬éœ€è¦èƒ½å¤Ÿè®¿é—®åˆ°è¢«äº¤æ˜“æ•°æ®ä¸­çš„äº¤æ˜“è¾“å…¥æ‰€å¼•ç”¨çš„äº¤æ˜“è¾“å‡ºï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¾—åˆ°å­˜å‚¨è¿™äº›äº¤æ˜“è¾“å‡ºçš„äº¤æ˜“ä¿¡æ¯ã€‚</p><p>è®©æˆ‘ä»¬æ¥ä¸€æ­¥ä¸€æ­¥reviewè¿™ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.isCoinbase()) &#123;</span><br><span class="line">   <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äº coinbase äº¤æ˜“ä¿¡æ¯ä¸å­˜åœ¨äº¤æ˜“è¾“å…¥ä¿¡æ¯ï¼Œå› æ­¤å®ƒä¸éœ€è¦ç­¾åï¼Œç›´æ¥return.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Transaction txCopy = <span class="keyword">this</span>.trimmedCopy();</span><br></pre></td></tr></table></figure><p>åˆ›å»ºäº¤æ˜“çš„å‰¯æœ¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Transaction</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   ...   </span><br><span class="line">   </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºç”¨äºç­¾åçš„äº¤æ˜“æ•°æ®å‰¯æœ¬</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Transaction <span class="title">trimmedCopy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        TXInput[] tmpTXInputs = <span class="keyword">new</span> TXInput[<span class="keyword">this</span>.getInputs().length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.getInputs().length; i++) &#123;</span><br><span class="line">            TXInput txInput = <span class="keyword">this</span>.getInputs()[i];</span><br><span class="line">            tmpTXInputs[i] = <span class="keyword">new</span> TXInput(txInput.getTxId(), txInput.getTxOutputIndex(), <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        TXOutput[] tmpTXOutputs = <span class="keyword">new</span> TXOutput[<span class="keyword">this</span>.getOutputs().length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.getOutputs().length; i++) &#123;</span><br><span class="line">            TXOutput txOutput = <span class="keyword">this</span>.getOutputs()[i];</span><br><span class="line">            tmpTXOutputs[i] = <span class="keyword">new</span> TXOutput(txOutput.getValue(), txOutput.getPubKeyHash());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Transaction(<span class="keyword">this</span>.getTxId(), tmpTXInputs, tmpTXOutputs);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªäº¤æ˜“æ•°æ®çš„å‰¯æœ¬åŒ…å«äº†äº¤æ˜“è¾“å…¥ä¸äº¤æ˜“è¾“å‡ºï¼Œä½†æ˜¯äº¤æ˜“è¾“å…¥çš„ <em>Signature</em> ä¸ <em>PubKey</em> éœ€è¦è®¾ç½®ä¸ºnullã€‚</p><p>ä½¿ç”¨ç§é’¥åˆå§‹åŒ– <code>SHA256withECDSA</code> ç­¾åç®—æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Security.addProvider(<span class="keyword">new</span> BouncyCastleProvider());</span><br><span class="line">Signature ecdsaSign = Signature.getInstance(<span class="string">"SHA256withECDSA"</span>,BouncyCastleProvider.PROVIDER_NAME);</span><br><span class="line">ecdsaSign.initSign(privateKey);</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿­ä»£äº¤æ˜“å‰¯æœ¬ä¸­çš„äº¤æ˜“è¾“å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (TXInput txInput : txCopy.getInputs()) &#123;</span><br><span class="line">      <span class="comment">// è·å–äº¤æ˜“è¾“å…¥TxIDå¯¹åº”çš„äº¤æ˜“æ•°æ®</span></span><br><span class="line">      Transaction prevTx = prevTxMap.get(Hex.encodeHexString(txInputCopy.getTxId()));</span><br><span class="line">      <span class="comment">// è·å–äº¤æ˜“è¾“å…¥æ‰€å¯¹åº”çš„ä¸Šä¸€ç¬”äº¤æ˜“ä¸­çš„äº¤æ˜“è¾“å‡º</span></span><br><span class="line">      TXOutput prevTxOutput = prevTx.getOutputs()[txInputCopy.getTxOutputIndex()];</span><br><span class="line">      txInputCopy.setPubKey(prevTxOutput.getPubKeyHash());</span><br><span class="line">      txInputCopy.setSignature(<span class="keyword">null</span>);</span><br></pre></td></tr></table></figure><p>åœ¨æ¯ä¸€ä¸ª txInputä¸­ï¼Œ<strong><em>signature</em></strong> éƒ½éœ€è¦è®¾ç½®ä¸º<code>null</code>ï¼ˆä»…ä»…æ˜¯ä¸ºäº†äºŒæ¬¡ç¡®è®¤æ£€æŸ¥ï¼‰ï¼Œå¹¶ä¸” <strong>pubKey</strong> è®¾ç½®ä¸ºå®ƒæ‰€å¼•ç”¨çš„äº¤æ˜“è¾“å‡ºçš„ <strong><em>pubKeyHash</em></strong> å­—æ®µã€‚åœ¨æ­¤åˆ»ï¼Œé™¤äº†å½“å‰çš„æ­£åœ¨å¾ªç¯çš„äº¤æ˜“è¾“å…¥(txInput)å¤–ï¼Œå…¶ä»–æ‰€æœ‰çš„äº¤æ˜“è¾“å…¥éƒ½æ˜¯â€ç©ºçš„â€ï¼Œä¹Ÿå°±æ˜¯è¯´ä»–ä»¬çš„ <code>Signature</code> å’Œ <code>PubKey</code> å­—æ®µè¢«è®¾ç½®ä¸º <code>null</code>ã€‚å› æ­¤ï¼Œ<strong>äº¤æ˜“è¾“å…¥æ˜¯è¢«åˆ†å¼€ç­¾åçš„</strong>ï¼Œå°½ç®¡è¿™å¯¹äºæˆ‘ä»¬çš„åº”ç”¨å¹¶ä¸ååˆ†ç´§è¦ï¼Œä½†æ˜¯æ¯”ç‰¹å¸å…è®¸äº¤æ˜“åŒ…å«å¼•ç”¨äº†ä¸åŒåœ°å€çš„è¾“å…¥ã€‚</p><p><code>Hash</code> æ–¹æ³•å¯¹äº¤æ˜“è¿›è¡Œåºåˆ—åŒ–ï¼Œå¹¶ä½¿ç”¨ SHA-256 ç®—æ³•è¿›è¡Œå“ˆå¸Œã€‚å“ˆå¸Œåçš„ç»“æœå°±æ˜¯æˆ‘ä»¬è¦ç­¾åçš„æ•°æ®ã€‚åœ¨è·å–å®Œå“ˆå¸Œï¼Œæˆ‘ä»¬åº”è¯¥é‡ç½® <code>PubKey</code> å­—æ®µï¼Œä»¥ä¾¿äºå®ƒä¸ä¼šå½±å“åé¢çš„è¿­ä»£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¾—åˆ°è¦ç­¾åçš„æ•°æ®ï¼Œå³äº¤æ˜“ID</span></span><br><span class="line">txCopy.setTxId(txCopy.hash());</span><br><span class="line">txInput.setPubKey(<span class="keyword">null</span>);</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæœ€å…³é”®çš„éƒ¨åˆ†æ¥äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¹æ•´ä¸ªäº¤æ˜“ä¿¡æ¯ä»…è¿›è¡Œç­¾åï¼Œå³å¯¹äº¤æ˜“IDè¿›è¡Œç­¾å</span></span><br><span class="line">Security.addProvider(<span class="keyword">new</span> BouncyCastleProvider());</span><br><span class="line">Signature ecdsaSign = Signature.getInstance(<span class="string">"SHA256withECDSA"</span>,BouncyCastleProvider.PROVIDER_NAME);</span><br><span class="line">ecdsaSign.initSign(privateKey);</span><br><span class="line">ecdsaSign.update(txCopy.getTxId());</span><br><span class="line"><span class="keyword">byte</span>[] signature = ecdsaSign.sign();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†æ•´ä¸ªäº¤æ˜“æ•°æ®çš„ç­¾åèµ‹å€¼ç»™äº¤æ˜“è¾“å…¥ï¼Œå› ä¸ºäº¤æ˜“è¾“å…¥éœ€è¦åŒ…å«æ•´ä¸ªäº¤æ˜“ä¿¡æ¯çš„ç­¾å</span></span><br><span class="line"><span class="comment">// æ³¨æ„æ˜¯å°†å¾—åˆ°çš„ç­¾åèµ‹å€¼ç»™åŸäº¤æ˜“ä¿¡æ¯ä¸­çš„äº¤æ˜“è¾“å…¥</span></span><br><span class="line"><span class="keyword">this</span>.getInputs()[i].setSignature(signature);</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>SHA256withECDSA</code> ç­¾åç®—æ³•åŠ ä¸Šç§é’¥ï¼Œæ¥å¯¹äº¤æ˜“IDè¿›è¡Œç­¾åï¼Œä»è€Œå¾—åˆ°äº†äº¤æ˜“è¾“å…¥æ‰€è¦è®¾ç½®çš„äº¤æ˜“ç­¾åã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥å®ç°äº¤æ˜“çš„éªŒè¯åŠŸèƒ½ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Transaction</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * éªŒè¯äº¤æ˜“ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> prevTxMap å‰é¢å¤šç¬”äº¤æ˜“é›†åˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">verify</span><span class="params">(Map&lt;String, Transaction&gt; prevTxMap)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// coinbase äº¤æ˜“ä¿¡æ¯ä¸éœ€è¦ç­¾åï¼Œä¹Ÿå°±æ— éœ€éªŒè¯</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.isCoinbase()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å†æ¬¡éªŒè¯ä¸€ä¸‹äº¤æ˜“ä¿¡æ¯ä¸­çš„äº¤æ˜“è¾“å…¥æ˜¯å¦æ­£ç¡®ï¼Œä¹Ÿå°±æ˜¯èƒ½å¦æŸ¥æ‰¾å¯¹åº”çš„äº¤æ˜“æ•°æ®</span></span><br><span class="line">        <span class="keyword">for</span> (TXInput txInput : <span class="keyword">this</span>.getInputs()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (prevTxMap.get(Hex.encodeHexString(txInput.getTxId())) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"ERROR: Previous transaction is not correct"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºç”¨äºç­¾åéªŒè¯çš„äº¤æ˜“ä¿¡æ¯çš„å‰¯æœ¬</span></span><br><span class="line">        Transaction txCopy = <span class="keyword">this</span>.trimmedCopy();</span><br><span class="line">        </span><br><span class="line">        Security.addProvider(<span class="keyword">new</span> BouncyCastleProvider());</span><br><span class="line">        ECParameterSpec ecParameters = ECNamedCurveTable.getParameterSpec(<span class="string">"secp256k1"</span>);</span><br><span class="line">        KeyFactory keyFactory = KeyFactory.getInstance(<span class="string">"ECDSA"</span>, BouncyCastleProvider.PROVIDER_NAME);</span><br><span class="line">        Signature ecdsaVerify = Signature.getInstance(<span class="string">"SHA256withECDSA"</span>, BouncyCastleProvider.PROVIDER_NAME);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.getInputs().length; i++) &#123;</span><br><span class="line">            TXInput txInput = <span class="keyword">this</span>.getInputs()[i];</span><br><span class="line">            <span class="comment">// è·å–äº¤æ˜“è¾“å…¥TxIDå¯¹åº”çš„äº¤æ˜“æ•°æ®</span></span><br><span class="line">            Transaction prevTx = prevTxMap.get(Hex.encodeHexString(txInput.getTxId()));</span><br><span class="line">            <span class="comment">// è·å–äº¤æ˜“è¾“å…¥æ‰€å¯¹åº”çš„ä¸Šä¸€ç¬”äº¤æ˜“ä¸­çš„äº¤æ˜“è¾“å‡º</span></span><br><span class="line">            TXOutput prevTxOutput = prevTx.getOutputs()[txInput.getTxOutputIndex()];</span><br><span class="line"></span><br><span class="line">            TXInput txInputCopy = txCopy.getInputs()[i];</span><br><span class="line">            txInputCopy.setSignature(<span class="keyword">null</span>);</span><br><span class="line">            txInputCopy.setPubKey(prevTxOutput.getPubKeyHash());</span><br><span class="line">            <span class="comment">// å¾—åˆ°è¦ç­¾åçš„æ•°æ®ï¼Œå³äº¤æ˜“ID</span></span><br><span class="line">            txCopy.setTxId(txCopy.hash());</span><br><span class="line">            txInputCopy.setPubKey(<span class="keyword">null</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ä½¿ç”¨æ¤­åœ†æ›²çº¿ x,y ç‚¹å»ç”Ÿæˆå…¬é’¥Key</span></span><br><span class="line">            BigInteger x = <span class="keyword">new</span> BigInteger(<span class="number">1</span>, Arrays.copyOfRange(txInput.getPubKey(), <span class="number">1</span>, <span class="number">33</span>));</span><br><span class="line">            BigInteger y = <span class="keyword">new</span> BigInteger(<span class="number">1</span>, Arrays.copyOfRange(txInput.getPubKey(), <span class="number">33</span>, <span class="number">65</span>));</span><br><span class="line">            ECPoint ecPoint = ecParameters.getCurve().createPoint(x, y);</span><br><span class="line"></span><br><span class="line">            ECPublicKeySpec keySpec = <span class="keyword">new</span> ECPublicKeySpec(ecPoint, ecParameters);</span><br><span class="line">            PublicKey publicKey = keyFactory.generatePublic(keySpec);</span><br><span class="line">            ecdsaVerify.initVerify(publicKey);</span><br><span class="line">            ecdsaVerify.update(txCopy.getTxId());</span><br><span class="line">            <span class="keyword">if</span> (!ecdsaVerify.verify(txInput.getSignature())) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–é€‰ï¼ŒåŒå‰é¢ç­¾åä¸€æ ·ï¼Œæˆ‘ä»¬å…ˆè·å–äº¤æ˜“çš„æ‹·è´æ•°æ®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Transaction txCopy = <span class="keyword">this</span>.trimmedCopy();</span><br></pre></td></tr></table></figure><p>è·å–æ¤­åœ†æ›²çº¿å‚æ•°å’Œç­¾åç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Security.addProvider(<span class="keyword">new</span> BouncyCastleProvider());</span><br><span class="line">ECParameterSpec ecParameters = ECNamedCurveTable.getParameterSpec(<span class="string">"secp256k1"</span>);</span><br><span class="line">KeyFactory keyFactory = KeyFactory.getInstance(<span class="string">"ECDSA"</span>, BouncyCastleProvider.PROVIDER_NAME);</span><br><span class="line">Signature ecdsaVerify = Signature.getInstance(<span class="string">"SHA256withECDSA"</span>, BouncyCastleProvider.PROVIDER_NAME);</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥æ£€æŸ¥æ¯ä¸€ä¸ªäº¤æ˜“è¾“å…¥çš„ç­¾åæ˜¯å¦æ­£ç¡®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.getInputs().length; i++) &#123;</span><br><span class="line">    TXInput txInput = <span class="keyword">this</span>.getInputs()[i];</span><br><span class="line">    <span class="comment">// è·å–äº¤æ˜“è¾“å…¥TxIDå¯¹åº”çš„äº¤æ˜“æ•°æ®</span></span><br><span class="line">    Transaction prevTx = prevTxMap.get(Hex.encodeHexString(txInput.getTxId()));</span><br><span class="line">    <span class="comment">// è·å–äº¤æ˜“è¾“å…¥æ‰€å¯¹åº”çš„ä¸Šä¸€ç¬”äº¤æ˜“ä¸­çš„äº¤æ˜“è¾“å‡º</span></span><br><span class="line">    TXOutput prevTxOutput = prevTx.getOutputs()[txInput.getTxOutputIndex()];</span><br><span class="line"></span><br><span class="line">    TXInput txInputCopy = txCopy.getInputs()[i];</span><br><span class="line">    txInputCopy.setSignature(<span class="keyword">null</span>);</span><br><span class="line">    txInputCopy.setPubKey(prevTxOutput.getPubKeyHash());</span><br><span class="line">    <span class="comment">// å¾—åˆ°è¦ç­¾åçš„æ•°æ®ï¼Œå³äº¤æ˜“ID</span></span><br><span class="line">    txCopy.setTxId(txCopy.hash());</span><br><span class="line">    txInputCopy.setPubKey(<span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™éƒ¨åˆ†ä¸Signæ–¹æ³•ä¸­çš„ç›¸åŒï¼Œå› ä¸ºåœ¨éªŒè¯è¿‡ç¨‹ä¸­æˆ‘ä»¬éœ€è¦ç­¾ç½²ç›¸åŒçš„æ•°æ®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨æ¤­åœ†æ›²çº¿ x,y ç‚¹å»ç”Ÿæˆå…¬é’¥Key</span></span><br><span class="line">BigInteger x = <span class="keyword">new</span> BigInteger(<span class="number">1</span>, Arrays.copyOfRange(txInput.getPubKey(), <span class="number">1</span>, <span class="number">33</span>));</span><br><span class="line">BigInteger y = <span class="keyword">new</span> BigInteger(<span class="number">1</span>, Arrays.copyOfRange(txInput.getPubKey(), <span class="number">33</span>, <span class="number">65</span>));</span><br><span class="line">ECPoint ecPoint = ecParameters.getCurve().createPoint(x, y);</span><br><span class="line"></span><br><span class="line">ECPublicKeySpec keySpec = <span class="keyword">new</span> ECPublicKeySpec(ecPoint, ecParameters);</span><br><span class="line">PublicKey publicKey = keyFactory.generatePublic(keySpec);</span><br><span class="line">ecdsaVerify.initVerify(publicKey);</span><br><span class="line">ecdsaVerify.update(txCopy.getTxId());</span><br><span class="line"><span class="keyword">if</span> (!ecdsaVerify.verify(txInput.getSignature())) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºäº¤æ˜“è¾“å…¥ä¸­å­˜å‚¨çš„ <code>pubkey</code> ï¼Œå®é™…ä¸Šæ˜¯æ¤­åœ†æ›²çº¿ä¸Šçš„ä¸€å¯¹ x,y åæ ‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä» pubKey å¾—åˆ°å…¬é’¥<code>PublicKey</code>ï¼Œç„¶ååœ¨ç”¨å…¬é’¥å»ç­¾åè¿›è¡ŒéªŒè¯ã€‚å¦‚æœéªŒè¯æˆåŠŸï¼Œåˆ™è¿”å›trueï¼Œå¦åˆ™ï¼Œè¿”å›falseã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–¹æ³•æ¥è·å–ä»¥å‰çš„äº¤æ˜“ã€‚ ç”±äºè¿™éœ€è¦ä¸åŒºå—é“¾äº’åŠ¨ï¼Œæˆ‘ä»¬å°†ä½¿å…¶æˆä¸º <strong>blockchain</strong> çš„ä¸€ç§æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Blockchain</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¾æ®äº¤æ˜“IDæŸ¥è¯¢äº¤æ˜“ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> txId äº¤æ˜“ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Transaction <span class="title">findTransaction</span><span class="params">(<span class="keyword">byte</span>[] txId)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (BlockchainIterator iterator = <span class="keyword">this</span>.getBlockchainIterator(); iterator.hashNext(); ) &#123;</span><br><span class="line">            Block block = iterator.next();</span><br><span class="line">            <span class="keyword">for</span> (Transaction tx : block.getTransactions()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (Arrays.equals(tx.getTxId(), txId)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> tx;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"ERROR: Can not found tx by txId ! "</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿›è¡Œäº¤æ˜“ç­¾å</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tx         äº¤æ˜“æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> privateKey ç§é’¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">signTransaction</span><span class="params">(Transaction tx, BCECPrivateKey privateKey)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// å…ˆæ¥æ‰¾åˆ°è¿™ç¬”æ–°çš„äº¤æ˜“ä¸­ï¼Œäº¤æ˜“è¾“å…¥æ‰€å¼•ç”¨çš„å‰é¢çš„å¤šç¬”äº¤æ˜“çš„æ•°æ®</span></span><br><span class="line">        Map&lt;String, Transaction&gt; prevTxMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (TXInput txInput : tx.getInputs()) &#123;</span><br><span class="line">            Transaction prevTx = <span class="keyword">this</span>.findTransaction(txInput.getTxId());</span><br><span class="line">            prevTxMap.put(Hex.encodeHexString(txInput.getTxId()), prevTx);</span><br><span class="line">        &#125;</span><br><span class="line">        tx.sign(privateKey, prevTxMap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äº¤æ˜“ç­¾åéªŒè¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tx</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">verifyTransactions</span><span class="params">(Transaction tx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Map&lt;String, Transaction&gt; prevTx = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (TXInput txInput : tx.getInputs()) &#123;</span><br><span class="line">            Transaction transaction = <span class="keyword">this</span>.findTransaction(txInput.getTxId());</span><br><span class="line">            prevTx.put(Hex.encodeHexString(txInput.getTxId()), transaction);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> tx.verify(prevTx);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æˆ‘ä»¬çš„äº¤æ˜“è¿›è¡ŒçœŸæ­£çš„ç­¾åå’ŒéªŒè¯äº†ï¼Œäº¤æ˜“çš„ç­¾åå‘ç”Ÿåœ¨ <strong>newUTXOTransaction</strong> ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Transaction <span class="title">newUTXOTransaction</span><span class="params">(String from, String to, <span class="keyword">int</span> amount, Blockchain blockchain)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        </span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    Transaction newTx = <span class="keyword">new</span> Transaction(<span class="keyword">null</span>, txInputs, txOutput);</span><br><span class="line">    newTx.setTxId(newTx.hash());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿›è¡Œäº¤æ˜“ç­¾å</span></span><br><span class="line">    blockchain.signTransaction(newTx, senderWallet.getPrivateKey());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> newTx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº¤æ˜“çš„éªŒè¯å‘ç”Ÿåœ¨ä¸€ç¬”äº¤æ˜“è¢«æ”¾å…¥åŒºå—ä¹‹å‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mineBlock</span><span class="params">(Transaction[] transactions)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// æŒ–çŸ¿å‰ï¼Œå…ˆéªŒè¯äº¤æ˜“è®°å½•</span></span><br><span class="line">    <span class="keyword">for</span> (Transaction tx : transactions) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.verifyTransactions(tx)) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"ERROR: Fail to mine block ! Invalid transaction ! "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>OKï¼Œè®©æˆ‘ä»¬å†ä¸€æ¬¡å¯¹æ•´ä¸ªå·¥ç¨‹çš„ä»£ç åšä¸€ä¸ªæµ‹è¯•ï¼Œæµ‹è¯•ç»“æœï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">$ ./blochchain.sh  createwallet</span><br><span class="line">wallet address : <span class="number">1</span>GTh9Yjh4eH2a69FMX2kvSpnkJAgLdXFD6</span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  createwallet</span><br><span class="line">wallet address : <span class="number">1</span>NnmFCuNnhPZHfXu38wZi8uEb446pDhaGB</span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  createwallet</span><br><span class="line">wallet address : <span class="number">13</span>K6rfHPifjdH4HXN2okpo4uxNRfVCx13f</span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  createblockchain -address <span class="number">1</span>GTh9Yjh4eH2a69FMX2kvSpnkJAgLdXFD6</span><br><span class="line"></span><br><span class="line">Elapsed Time: <span class="number">164.961</span> seconds </span><br><span class="line">correct hash Hex: <span class="number">00000524231</span>ae1832c49957848d2d1871cc35ff4d113c23be1937c6dff5cdf2a </span><br><span class="line"></span><br><span class="line">Done ! </span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  getbalance -address <span class="number">1</span>GTh9Yjh4eH2a69FMX2kvSpnkJAgLdXFD6</span><br><span class="line">Balance of <span class="string">'1GTh9Yjh4eH2a69FMX2kvSpnkJAgLdXFD6'</span>: <span class="number">10</span></span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  send -from <span class="number">1</span>NnmFCuNnhPZHfXu38wZi8uEb446pDhaGB -to  <span class="number">13</span>K6rfHPifjdH4HXN2okpo4uxNRfVCx13f -amount <span class="number">5</span></span><br><span class="line">java.lang.Exception: ERROR: Not enough funds</span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  send -from <span class="number">1</span>GTh9Yjh4eH2a69FMX2kvSpnkJAgLdXFD6 -to <span class="number">1</span>NnmFCuNnhPZHfXu38wZi8uEb446pDhaGB -amount <span class="number">5</span></span><br><span class="line">Elapsed Time: <span class="number">54.92</span> seconds </span><br><span class="line">correct hash Hex: <span class="number">00000354</span>f86cde369d4c39d2b3016ac9a74956425f1348b4c26b2cddb98c100b </span><br><span class="line"></span><br><span class="line">Success!</span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  getbalance -address <span class="number">1</span>GTh9Yjh4eH2a69FMX2kvSpnkJAgLdXFD6</span><br><span class="line">Balance of <span class="string">'1GTh9Yjh4eH2a69FMX2kvSpnkJAgLdXFD6'</span>: <span class="number">5</span></span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  getbalance -address <span class="number">1</span>NnmFCuNnhPZHfXu38wZi8uEb446pDhaGB</span><br><span class="line">Balance of <span class="string">'1NnmFCuNnhPZHfXu38wZi8uEb446pDhaGB'</span>: <span class="number">5</span></span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh  getbalance -address <span class="number">13</span>K6rfHPifjdH4HXN2okpo4uxNRfVCx13f</span><br><span class="line">Balance of <span class="string">'13K6rfHPifjdH4HXN2okpo4uxNRfVCx13f'</span>: <span class="number">0</span></span><br></pre></td></tr></table></figure><p>Goodï¼æ²¡æœ‰ä»»ä½•é”™è¯¯ï¼</p><p>è®©æˆ‘ä»¬æ³¨é‡Šæ‰ <code>NewUTXOTransaction</code> æ–¹æ³•ä¸­çš„ä¸€è¡Œä»£ç ï¼Œç¡®ä¿æœªè¢«ç­¾åçš„äº¤æ˜“ä¸èƒ½è¢«æ·»åŠ åˆ°åŒºå—ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    </span><br><span class="line"><span class="comment">// blockchain.signTransaction(newTx, senderWallet.getPrivateKey());</span></span><br><span class="line">    </span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">java.lang.Exception: Fail to verify transaction ! transaction invalid ! </span><br><span class="line">	at one.wangwei.blockchain.block.Blockchain.verifyTransactions(Blockchain.java:<span class="number">334</span>)</span><br><span class="line">	at one.wangwei.blockchain.block.Blockchain.mineBlock(Blockchain.java:<span class="number">76</span>)</span><br><span class="line">	at one.wangwei.blockchain.cli.CLI.send(CLI.java:<span class="number">202</span>)</span><br><span class="line">	at one.wangwei.blockchain.cli.CLI.parse(CLI.java:<span class="number">79</span>)</span><br><span class="line">	at one.wangwei.blockchain.BlockchainTest.main(BlockchainTest.java:<span class="number">23</span>)</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜</strong></p><p><strong><em>WalletUtils</em></strong> å¦‚è‹¥æŠ›å‡ºå¼‚å¸¸ï¼šIllegal key size or default parametersï¼Œè¯·æŒ‰ä»¥ä¸‹æ–¹æ³•è¿›è¡Œè§£å†³ï¼š</p><p><a href="https://stackoverflow.com/questions/6481627/java-security-illegal-key-size-or-default-parameters" target="_blank" rel="noopener">https://stackoverflow.com/questions/6481627/java-security-illegal-key-size-or-default-parameters</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬å­¦åˆ°äº†:</p><ol><li>ä½¿ç”¨æ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•ï¼Œå¦‚ä½•å»åˆ›å»ºé’±åŒ…ï¼›</li><li>äº†è§£åˆ°äº†å¦‚ä½•å»ç”Ÿæˆæ¯”ç‰¹å¸åœ°å€ï¼›</li><li>å¦‚ä½•å»å¯¹äº¤æ˜“ä¿¡æ¯è¿›è¡Œç­¾åå¹¶å¯¹ç­¾åè¿›è¡ŒéªŒè¯ï¼›</li></ol><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†æ¯”ç‰¹å¸çš„è®¸å¤šå…³é”®ç‰¹æ€§ï¼ æˆ‘ä»¬å·²ç»å®ç°äº†é™¤å¤–ç½‘ç»œå¤–çš„å‡ ä¹æ‰€æœ‰åŠŸèƒ½ï¼Œå¹¶ä¸”åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ç»§ç»­å®Œå–„äº¤æ˜“è¿™ä¸€ç¯èŠ‚æœºåˆ¶ã€‚</p><h2 id="èµ„æ–™"><a href="#èµ„æ–™" class="headerlink" title="èµ„æ–™"></a>èµ„æ–™</h2><ul><li><p>æºä»£ç ï¼š<a href="https://github.com/wangweiX/blockchain-java/tree/part5-wallet" target="_blank" rel="noopener">https://github.com/wangweiX/blockchain-java/tree/part5-wallet</a></p></li><li><p><a href="https://github.com/bitcoinbook/bitcoinbook/blob/develop/ch04.asciidoc" target="_blank" rel="noopener">ã€Šç²¾é€šæ¯”ç‰¹å¸ï¼ˆç¬¬äºŒç‰ˆï¼‰ã€‹â€”â€” ç¬¬å››ç« </a></p></li><li><p><a href="http://www.bouncycastle.org/wiki/display/JA1/Elliptic+Curve+Key+Pair+Generation+and+Key+Factories" target="_blank" rel="noopener">Elliptic Curve Key Pair Generation and Key Factories</a></p></li><li><p><a href="https://stackoverflow.com/questions/30116758/generating-publickey-from-x-and-y-values-of-elliptic-curve-point" target="_blank" rel="noopener">How to create public key objects with x and y coordinates?</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/Public-key_cryptography" target="_blank" rel="noopener">Public-key cryptography</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/Digital_signature" target="_blank" rel="noopener">Digital signatures</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/Elliptic_curve" target="_blank" rel="noopener">Elliptic curve</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/Elliptic_curve_cryptography" target="_blank" rel="noopener">Elliptic curve cryptography</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/Elliptic_Curve_Digital_Signature_Algorithm" target="_blank" rel="noopener">ECDSA</a></p></li><li><p><a href="https://en.bitcoin.it/wiki/Technical_background_of_version_1_Bitcoin_addresses" target="_blank" rel="noopener">Technical background of Bitcoin addresses</a></p></li><li><p><a href="https://en.bitcoin.it/wiki/Address" target="_blank" rel="noopener">Address</a></p></li><li><p><a href="https://en.bitcoin.it/wiki/Base58Check_encoding" target="_blank" rel="noopener">Base58</a></p></li><li><p><a href="http://andrea.corbellini.name/2015/05/17/elliptic-curve-cryptography-a-gentle-introduction/" target="_blank" rel="noopener">A gentle introduction to elliptic curve cryptography</a></p></li></ul><p><img src="https://img.i7years.com/blog/blockchain_exploer.png" alt=""></p><blockquote><p><a href="https://press.one/file/v?s=e314e0662f84fc732e37faa7abfa5615ce04675d70c3fad51d534ac60c7f38a41e5f468d43d209823e008299b24bde00ffcbd172896c1be5a1655c37f332e1a71&amp;h=cf27d733b01c15c2dff665f44233f12735f93bf3a4529166506fce3caff2872a&amp;a=23fe9bfd7ceef4b44c2ce44dcac8e4a49caf8026&amp;f=P1&amp;v=2" target="_blank" rel="noopener">https://press.one/file/v?s=e314e0662f84fc732e37faa7abfa5615ce04675d70c3fad51d534ac60c7f38a41e5f468d43d209823e008299b24bde00ffcbd172896c1be5a1655c37f332e1a71&amp;h=cf27d733b01c15c2dff665f44233f12735f93bf3a4529166506fce3caff2872a&amp;a=23fe9bfd7ceef4b44c2ce44dcac8e4a49caf8026&amp;f=P1&amp;v=2</a></p></blockquote>]]></content>
      
        <categories>
            
            <category> blockchain </category>
            
        </categories>
        
        
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> bitcoin </tag>
            
            <tag> Elliptic Curve </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[åŸºäºJavaè¯­è¨€æ„å»ºåŒºå—é“¾ï¼ˆå››ï¼‰â€”â€” äº¤æ˜“ï¼ˆUTXOï¼‰]]></title>
      <url>/posts/build-blockchain-in-java-transaction-utxo.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/ecommerce-2140604.jpg?imageslim" alt="bitcoin-blockchain-transactions"></p><blockquote><p>æ–‡ç« çš„ä¸»è¦æ€æƒ³å’Œå†…å®¹å‡æ¥è‡ª <a href="https://jeiwan.cc/posts/building-blockchain-in-go-part-4/" target="_blank" rel="noopener">https://jeiwan.cc/posts/building-blockchain-in-go-part-4/</a></p></blockquote><h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p><a href="https://wangwei.one/posts/35c768a3.html">ä¸Šä¸€ç¯‡</a> æ–‡ç« ï¼Œæˆ‘ä»¬å®ç°äº†åŒºå—æ•°æ®çš„æŒä¹…åŒ–ï¼Œæœ¬ç¯‡å¼€å§‹äº¤æ˜“ç¯èŠ‚çš„å®ç°ã€‚äº¤æ˜“è¿™ä¸€ç¯èŠ‚æ˜¯æ•´ä¸ªæ¯”ç‰¹å¸ç³»ç»Ÿå½“ä¸­æœ€ä¸ºå…³é”®çš„ä¸€ç¯ï¼Œå¹¶ä¸”åŒºå—é“¾å”¯ä¸€çš„ç›®çš„å°±æ˜¯é€šè¿‡å®‰å…¨çš„ã€å¯ä¿¡çš„æ–¹å¼æ¥å­˜å‚¨äº¤æ˜“ä¿¡æ¯ï¼Œé˜²æ­¢å®ƒä»¬åˆ›å»ºä¹‹åè¢«äººæ¶æ„ç¯¡æ”¹ã€‚ä»Šå¤©æˆ‘ä»¬å¼€å§‹å®ç°äº¤æ˜“è¿™ä¸€ç¯èŠ‚ï¼Œä½†ç”±äºè¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„è¯é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šç¬¬ä¸€éƒ¨åˆ†æˆ‘ä»¬å°†å®ç°åŒºå—é“¾äº¤æ˜“çš„åŸºæœ¬æœºåˆ¶ï¼Œåˆ°ç¬¬äºŒéƒ¨åˆ†ï¼Œæˆ‘ä»¬å†æ¥ç ”ç©¶å®ƒçš„ç»†èŠ‚ã€‚</p><a id="more"></a><h2 id="æ¯”ç‰¹å¸äº¤æ˜“"><a href="#æ¯”ç‰¹å¸äº¤æ˜“" class="headerlink" title="æ¯”ç‰¹å¸äº¤æ˜“"></a>æ¯”ç‰¹å¸äº¤æ˜“</h2><p>å¦‚æœä½ å¼€å‘è¿‡Webåº”ç”¨ç¨‹åºï¼Œä¸ºäº†å®ç°æ”¯ä»˜ç³»ç»Ÿï¼Œä½ å¯èƒ½ä¼šåœ¨æ•°æ®åº“ä¸­åˆ›å»ºä¸€äº›æ•°æ®åº“è¡¨ï¼š<code>è´¦æˆ·</code> å’Œ <code>äº¤æ˜“è®°å½•</code>ã€‚è´¦æˆ·ç”¨äºå­˜å‚¨ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ä»¥åŠè´¦æˆ·ä½™é¢ç­‰ä¿¡æ¯ï¼Œäº¤æ˜“è®°å½•ç”¨äºå­˜å‚¨èµ„é‡‘ä»ä¸€ä¸ªè´¦æˆ·è½¬ç§»åˆ°å¦ä¸€ä¸ªè´¦æˆ·çš„è®°å½•ã€‚ä½†æ˜¯åœ¨æ¯”ç‰¹å¸ä¸­ï¼Œæ”¯ä»˜ç³»ç»Ÿæ˜¯ä»¥ä¸€ç§å®Œå…¨ä¸ä¸€æ ·çš„æ–¹å¼å®ç°çš„ï¼Œåœ¨è¿™é‡Œï¼š</p><ul><li>æ²¡æœ‰è´¦æˆ·</li><li>æ²¡æœ‰ä½™é¢</li><li>æ²¡æœ‰åœ°å€</li><li>æ²¡æœ‰ Coinsï¼ˆå¸ï¼‰</li><li>æ²¡æœ‰å‘é€è€…å’Œæ¥å—è€…</li></ul><p>ç”±äºåŒºå—é“¾æ˜¯ä¸€ä¸ªå…¬å¼€çš„æ•°æ®åº“ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›å­˜å‚¨æœ‰å…³é’±åŒ…æ‰€æœ‰è€…çš„æ•æ„Ÿä¿¡æ¯ã€‚<code>Coins</code> ä¸ä¼šæ±‡æ€»åˆ°é’±åŒ…ä¸­ã€‚äº¤æ˜“ä¸ä¼šå°†èµ„é‡‘ä»ä¸€ä¸ªåœ°å€è½¬ç§»åˆ°å¦ä¸€ä¸ªåœ°å€ã€‚æ²¡æœ‰å¯ä¿å­˜å¸æˆ·ä½™é¢çš„å­—æ®µæˆ–å±æ€§ã€‚åªæœ‰äº¤æ˜“ä¿¡æ¯ã€‚é‚£æ¯”ç‰¹å¸çš„äº¤æ˜“ä¿¡æ¯é‡Œé¢åˆ°åº•å­˜å‚¨çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><h3 id="äº¤æ˜“ç»„æˆ"><a href="#äº¤æ˜“ç»„æˆ" class="headerlink" title="äº¤æ˜“ç»„æˆ"></a>äº¤æ˜“ç»„æˆ</h3><p>ä¸€ç¬”æ¯”ç‰¹å¸çš„äº¤æ˜“ç”± <code>äº¤æ˜“è¾“å…¥</code> å’Œ <code>äº¤æ˜“è¾“å‡º</code> ç»„æˆï¼Œæ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * äº¤æ˜“</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2017/03/04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Transaction</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äº¤æ˜“çš„Hash</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] txId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äº¤æ˜“è¾“å…¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> TXInput[] inputs;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äº¤æ˜“è¾“å‡º</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> TXOutput[] outputs;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ç¬”äº¤æ˜“çš„ <code>äº¤æ˜“è¾“å…¥</code> å…¶å®æ˜¯æŒ‡å‘ä¸Šä¸€ç¬”äº¤æ˜“çš„<code>äº¤æ˜“è¾“å‡º</code> ï¼ˆè¿™ä¸ªåé¢è¯¦ç»†è¯´æ˜ï¼‰ã€‚æˆ‘ä»¬é’±åŒ…é‡Œé¢çš„ Coinï¼ˆå¸ï¼‰å®é™…æ˜¯å­˜å‚¨åœ¨è¿™äº› <code>äº¤æ˜“è¾“å‡º</code> é‡Œé¢ã€‚ä¸‹å›¾è¡¨ç¤ºäº†åŒºå—é“¾äº¤æ˜“ç³»ç»Ÿé‡Œé¢å„ä¸ªäº¤æ˜“ç›¸äº’å¼•ç”¨çš„å…³ç³»ï¼š</p><p><img src="https://img.i7years.com/blog/transactions-diagram.png" alt="transactions-diagram"></p><p>æ³¨æ„ï¼š</p><ol><li>æœ‰äº› <code>äº¤æ˜“è¾“å‡º</code> å¹¶ä¸æ˜¯ç”± <code>äº¤æ˜“è¾“å…¥</code> äº§ç”Ÿï¼Œè€Œæ˜¯å‡­ç©ºäº§ç”Ÿçš„ï¼ˆåé¢ä¼šè¯¦ç»†ä»‹ç»ï¼‰ã€‚</li><li>ä½†ï¼Œ<code>äº¤æ˜“è¾“å…¥</code> å¿…é¡»æŒ‡å‘æŸä¸ª <code>äº¤æ˜“è¾“å‡º</code>ï¼Œå®ƒä¸èƒ½å‡­ç©ºäº§ç”Ÿã€‚</li><li>åœ¨ä¸€ç¬”äº¤æ˜“é‡Œé¢ï¼Œ<code>äº¤æ˜“è¾“å…¥</code> å¯èƒ½ä¼šæ¥è‡ªå¤šç¬”äº¤æ˜“æ‰€äº§ç”Ÿçš„ <code>äº¤æ˜“è¾“å‡º</code>ã€‚</li></ol><p>åœ¨æ•´ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¯¸å¦‚â€œé’±â€ï¼Œâ€œå¸â€ï¼Œâ€œèŠ±è´¹â€ï¼Œâ€œå‘é€â€ï¼Œâ€œè´¦æˆ·â€ç­‰è¯è¯­ã€‚ä½†æ¯”ç‰¹å¸ä¸­æ²¡æœ‰è¿™æ ·çš„æ¦‚å¿µï¼Œåœ¨æ¯”ç‰¹å¸äº¤æ˜“ä¸­ï¼Œäº¤æ˜“ä¿¡æ¯æ˜¯ç”± <code>é”å®šè„šæœ¬</code> é”å®šä¸€ä¸ªæ•°å€¼ï¼Œå¹¶ä¸”åªèƒ½è¢«æ‰€æœ‰è€…çš„ <code>è§£é”è„šæœ¬</code> è§£é”ã€‚ï¼ˆè§£é“ƒè¿˜é¡»ç³»é“ƒäººï¼‰</p><h2 id="äº¤æ˜“è¾“å‡º"><a href="#äº¤æ˜“è¾“å‡º" class="headerlink" title="äº¤æ˜“è¾“å‡º"></a>äº¤æ˜“è¾“å‡º</h2><p>è®©æˆ‘ä»¬å…ˆä»äº¤æ˜“è¾“å‡ºå¼€å§‹ï¼Œä»–çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * äº¤æ˜“è¾“å‡º</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2017/03/04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TXOutput</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> value;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é”å®šè„šæœ¬</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String scriptPubKey;</span><br><span class="line">	</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šï¼Œå®ƒè¡¨ç¤ºçš„æ˜¯èƒ½å¤Ÿå­˜å‚¨ â€œcoinsï¼ˆå¸ï¼‰â€çš„äº¤æ˜“è¾“å‡ºï¼ˆæ³¨æ„ <strong>value</strong> å­—æ®µï¼‰ã€‚å¹¶ä¸”è¿™é‡Œæ‰€è°“çš„ <strong>value</strong> å®é™…ä¸Šæ˜¯ç”±å­˜å‚¨åœ¨ <strong>ScriptPubKey</strong> ï¼ˆé”å®šè„šæœ¬ï¼‰ä¸­çš„ä¸€ä¸ªpuzzleï¼ˆéš¾é¢˜ï¼‰ æ‰€é”å®šã€‚åœ¨å†…éƒ¨ï¼Œæ¯”ç‰¹å¸ä½¿ç”¨ç§°ä¸ºè„šæœ¬çš„è„šæœ¬è¯­è¨€ï¼Œç”¨äºå®šä¹‰è¾“å‡ºé”å®šå’Œè§£é”é€»è¾‘ã€‚è¿™ä¸ªè¯­è¨€å¾ˆåŸå§‹ï¼ˆè¿™æ˜¯æ•…æ„çš„ï¼Œä»¥é¿å…å¯èƒ½çš„é»‘å®¢å’Œæ»¥ç”¨ï¼‰ï¼Œä½†æˆ‘ä»¬ä¸ä¼šè¯¦ç»†è®¨è®ºå®ƒã€‚ ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°å®ƒçš„è¯¦ç»†è§£é‡Šã€‚<a href="https://en.bitcoin.it/wiki/Script" target="_blank" rel="noopener">here</a></p><blockquote><p>åœ¨æ¯”ç‰¹å¸ä¸­ï¼Œ<em>value</em> å­—æ®µå­˜å‚¨ç€ <em>satoshis</em> çš„ä»»æ„å€çš„æ•°å€¼ï¼Œè€Œä¸æ˜¯BTCçš„æ•°é‡ã€‚<em>satoshis</em> æ˜¯æ¯”ç‰¹å¸çš„ç™¾ä¸‡åˆ†ä¹‹ä¸€ï¼ˆ0.00000001 BTCï¼‰ï¼Œå› æ­¤è¿™æ˜¯æ¯”ç‰¹å¸ä¸­æœ€å°çš„è´§å¸å•ä½ï¼ˆå¦‚1ç¾åˆ†ï¼‰ã€‚</p><blockquote><p><em>satoshis</em>ï¼šèª</p></blockquote><p>é”å®šè„šæœ¬æ˜¯ä¸€ä¸ªæ”¾åœ¨ä¸€ä¸ªè¾“å‡ºå€¼ä¸Šçš„â€œéšœç¢â€ï¼ŒåŒæ—¶å®ƒæ˜ç¡®äº†ä»ŠåèŠ±è´¹è¿™ç¬”è¾“å‡ºçš„æ¡ä»¶ã€‚ç”±äºé”å®šè„šæœ¬å¾€å¾€å«æœ‰ä¸€ä¸ªå…¬é’¥ï¼ˆå³æ¯”ç‰¹å¸åœ°å€ï¼‰ï¼Œåœ¨å†å²ä¸Šå®ƒæ›¾è¢«ç§°ä½œä¸€ä¸ªè„šæœ¬å…¬é’¥ä»£ç ã€‚åœ¨å¤§å¤šæ•°æ¯”ç‰¹å¸åº”ç”¨æºä»£ç ä¸­ï¼Œè„šæœ¬å…¬é’¥ä»£ç ä¾¿æ˜¯æˆ‘ä»¬æ‰€è¯´çš„é”å®šè„šæœ¬ã€‚</p></blockquote><p>ç”±äºæˆ‘ä»¬è¿˜æ²¡æœ‰å®ç°é’±åŒ…åœ°å€çš„é€»è¾‘ï¼Œæ‰€ä»¥è¿™é‡Œå…ˆæš‚ä¸”å¿½ç•¥é”å®šè„šæœ¬ç›¸å…³çš„é€»è¾‘ã€‚<strong>ScriptPubKey</strong> å°†ä¼šå­˜å‚¨ä»»æ„çš„å­—ç¬¦ä¸²ï¼ˆç”¨æˆ·å®šä¹‰çš„é’±åŒ…åœ°å€ï¼‰</p><blockquote><p>é¡ºä¾¿è¯´ä¸€å¥ï¼Œæ‹¥æœ‰è¿™æ ·çš„è„šæœ¬è¯­è¨€æ„å‘³ç€æ¯”ç‰¹å¸ä¹Ÿå¯ä»¥ç”¨ä½œæ™ºèƒ½åˆçº¦å¹³å°ã€‚</p></blockquote><p>å…³äº <code>äº¤æ˜“è¾“å‡º</code> çš„ä¸€ä¸ªé‡è¦çš„äº‹æƒ…æ˜¯å®ƒä»¬æ˜¯<strong>ä¸å¯åˆ†å‰²çš„</strong>ï¼Œè¿™æ„å‘³ç€ä½ ä¸èƒ½å°†å®ƒæ‰€å­˜å‚¨çš„æ•°å€¼æ‹†å¼€æ¥ä½¿ç”¨ã€‚å½“è¿™ä¸ªäº¤æ˜“è¾“å‡ºåœ¨æ–°çš„äº¤æ˜“ä¸­è¢«äº¤æ˜“è¾“å…¥æ‰€å¼•ç”¨æ—¶ï¼Œå®ƒå°†ä½œä¸ºä¸€ä¸ªæ•´ä½“è¢«èŠ±è´¹æ‰ã€‚ å¦‚æœå…¶å€¼å¤§äºæ‰€éœ€å€¼ï¼Œé‚£ä¹ˆå‰©ä½™çš„éƒ¨åˆ†åˆ™ä¼šä½œä¸ºé›¶é’±è¿”å›ç»™ä»˜æ¬¾æ–¹ã€‚ è¿™ä¸çœŸå®ä¸–ç•Œçš„æƒ…å†µç±»ä¼¼ï¼Œä¾‹å¦‚ï¼Œæ‚¨æ”¯ä»˜5ç¾å…ƒçš„é’ç¥¨ç”¨äºè´­ä¹°1ç¾å…ƒçš„ä¸œè¥¿ï¼Œé‚£ä¹ˆä½ å°†ä¼šå¾—åˆ°4ç¾å…ƒçš„é›¶é’±ã€‚</p><h2 id="äº¤æ˜“è¾“å…¥"><a href="#äº¤æ˜“è¾“å…¥" class="headerlink" title="äº¤æ˜“è¾“å…¥"></a>äº¤æ˜“è¾“å…¥</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * äº¤æ˜“è¾“å…¥</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2017/03/04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TXInput</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äº¤æ˜“Idçš„hashå€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] txId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äº¤æ˜“è¾“å‡ºç´¢å¼•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> txOutputIndex;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£é”è„šæœ¬</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String scriptSig;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‰é¢æåˆ°è¿‡ï¼Œä¸€ä¸ªäº¤æ˜“è¾“å…¥æŒ‡å‘çš„æ˜¯æŸä¸€ç¬”äº¤æ˜“çš„äº¤æ˜“è¾“å‡ºï¼š</p><ul><li><strong>txId</strong> å­˜å‚¨çš„æ˜¯æŸç¬”äº¤æ˜“çš„IDå€¼</li><li><strong>txOutputIndex</strong> å­˜å‚¨çš„æ˜¯äº¤æ˜“ä¸­è¿™ä¸ªäº¤æ˜“è¾“å‡ºçš„ç´¢å¼•ä½ç½®ï¼ˆå› ä¸ºä¸€ç¬”äº¤æ˜“å¯èƒ½åŒ…å«å¤šä¸ªäº¤æ˜“è¾“å‡ºï¼‰</li><li><strong>scriptSig</strong> ä¸»è¦æ˜¯æä¾›ç”¨äºäº¤æ˜“è¾“å‡ºä¸­ <strong>ScriptPubKey</strong> æ‰€éœ€çš„éªŒè¯æ•°æ®ã€‚<ul><li>å¦‚æœè¿™ä¸ªæ•°æ®è¢«éªŒè¯æ­£ç¡®ï¼Œé‚£ä¹ˆç›¸åº”çš„äº¤æ˜“è¾“å‡ºå°†è¢«è§£é”ï¼Œå¹¶ä¸”å…¶ä¸­çš„ value èƒ½å¤Ÿç”Ÿæˆæ–°çš„äº¤æ˜“è¾“å‡ºï¼›</li><li>å¦‚æœä¸æ­£ç¡®ï¼Œé‚£ä¹ˆç›¸åº”çš„äº¤æ˜“è¾“å‡ºå°†ä¸èƒ½è¢«äº¤æ˜“è¾“å…¥æ‰€å¼•ç”¨ï¼›</li></ul></li></ul><p>é€šè¿‡é”å®šè„šæœ¬ä¸è§£é”è„šæœ¬è¿™ç§æœºåˆ¶ï¼Œä¿è¯äº†æŸä¸ªç”¨æˆ·ä¸èƒ½èŠ±è´¹å±äºä»–äººçš„Coinsã€‚</p><p>åŒæ ·ï¼Œç”±äºæˆ‘ä»¬å°šæœªå®ç°é’±åŒ…åœ°å€åŠŸèƒ½ï¼Œ<strong>ScriptSig</strong> å°†ä¼šå­˜å‚¨ä»»æ„çš„ç”¨æˆ·æ‰€å®šä¹‰çš„é’±åŒ…åœ°å€ã€‚æˆ‘ä»¬å°†ä¼šåœ¨ä¸‹ä¸€ç« èŠ‚å®ç°å…¬é’¥å’Œæ•°å­—ç­¾åéªŒè¯ã€‚</p><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ã€‚äº¤æ˜“è¾“å‡ºæ˜¯â€Coinsâ€å®é™…å­˜å‚¨çš„åœ°æ–¹ã€‚æ¯ä¸€ä¸ªäº¤æ˜“è¾“å‡ºéƒ½å¸¦æœ‰ä¸€ä¸ªé”å®šè„šæœ¬ï¼Œå®ƒå†³å®šäº†è§£é”çš„é€»è¾‘ã€‚æ¯ä¸€ç¬”æ–°çš„äº¤æ˜“å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªäº¤æ˜“è¾“å…¥ä¸äº¤æ˜“è¾“å‡ºã€‚ä¸€ç¬”äº¤æ˜“çš„äº¤æ˜“è¾“å…¥æŒ‡å‘å‰ä¸€ç¬”äº¤æ˜“çš„äº¤æ˜“è¾“å‡ºï¼Œå¹¶ä¸”æä¾›ç”¨äºé”å®šè„šæœ¬è§£é”éœ€è¦çš„æ•°æ®ï¼ˆ<code>ScriptSig</code> å­—æ®µï¼‰ï¼Œç„¶ååˆ©ç”¨äº¤æ˜“è¾“å‡ºä¸­çš„ <code>value</code> å»åˆ›å»ºæ–°çš„äº¤æ˜“è¾“å‡ºã€‚</p><blockquote><p>æ³¨æ„ï¼Œè¿™æ®µè¯çš„åŸæ–‡å¦‚ä¸‹ï¼Œä½†æ˜¯é‡Œé¢æœ‰è¡¨è¿°é”™è¯¯çš„åœ°æ–¹ï¼Œäº¤æ˜“è¾“å‡ºå¸¦æœ‰çš„æ˜¯é”å®šè„šæœ¬ï¼Œè€Œä¸æ˜¯è§£é”è„šæœ¬ã€‚</p><p>Letâ€™s sum it up. Outputs are where â€œcoinsâ€ are stored. Each output comes with an unlocking script, which determines the logic of unlocking the output. Every new transaction must have at least one input and output. An input references an output from a previous transaction and provides data (the <code>ScriptSig</code> field) that is used in the outputâ€™s unlocking script to unlock it and use its value to create new outputs.</p></blockquote><p>é‚£åˆ°åº•æ˜¯å…ˆæœ‰äº¤æ˜“è¾“å…¥è¿˜æ˜¯å…ˆæœ‰äº¤æ˜“è¾“å‡ºå‘¢ï¼Ÿ</p><h2 id="é¸¡ä¸è›‹çš„é—®é¢˜"><a href="#é¸¡ä¸è›‹çš„é—®é¢˜" class="headerlink" title="é¸¡ä¸è›‹çš„é—®é¢˜"></a>é¸¡ä¸è›‹çš„é—®é¢˜</h2><p>åœ¨æ¯”ç‰¹å¸ä¸­ï¼Œé¸¡è›‹å…ˆäºé¸¡å‡ºç°ã€‚äº¤æ˜“è¾“å…¥æºè‡ªäºäº¤æ˜“è¾“å‡ºçš„é€»è¾‘æ˜¯å…¸å‹çš„â€å…ˆæœ‰é¸¡è¿˜æ˜¯å…ˆæœ‰è›‹â€çš„é—®é¢˜ï¼šäº¤æ˜“è¾“å…¥äº§ç”Ÿäº¤æ˜“è¾“å‡ºï¼Œäº¤æ˜“è¾“å‡ºåˆä¼šè¢«äº¤æ˜“è¾“å…¥æ‰€å¼•ç”¨ã€‚åœ¨æ¯”ç‰¹å¸ä¸­ï¼Œ<strong>äº¤æ˜“è¾“å‡ºå…ˆäºäº¤æ˜“è¾“å…¥å‡ºç°</strong>ã€‚</p><p>å½“çŸ¿å·¥å¼€å§‹å¼€é‡‡åŒºå—æ—¶ï¼ŒåŒºå—ä¸­ä¼šè¢«æ·»åŠ ä¸€ä¸ª <strong>coinbase</strong> äº¤æ˜“ï¼ˆåˆ›å¸äº¤æ˜“ï¼‰ã€‚coinbase äº¤æ˜“æ˜¯ä¸€ç§ç‰¹æ®Šçš„äº¤æ˜“ï¼Œå®ƒä¸éœ€è¦ä»¥å‰å·²ç»å­˜åœ¨çš„äº¤æ˜“è¾“å‡ºã€‚å®ƒä¼šå‡­ç©ºåˆ›å»ºå‡ºäº¤æ˜“è¾“å‡ºï¼ˆi.e: Coinsï¼‰ã€‚ä¹Ÿå³ï¼Œé¸¡è›‹çš„å‡ºç°å¹¶ä¸éœ€è¦æ¯é¸¡ï¼Œè¿™ç¬”äº¤æ˜“æ˜¯ä½œä¸ºçŸ¿å·¥æˆåŠŸæŒ–å‡ºæ–°çš„åŒºå—åçš„ä¸€ç¬”å¥–åŠ±ã€‚</p><p>æ­£å¦‚ä½ æ‰€çŸ¥é“çš„é‚£æ ·ï¼Œåœ¨åŒºå—é“¾çš„æœ€å‰ç«¯ï¼Œå³ç¬¬ä¸€ä¸ªåŒºå—ï¼Œæœ‰ä¸€ä¸ªåˆ›ä¸–åŒºå—ã€‚ä»–äº§ç”Ÿäº†åŒºå—é“¾ä¸­æœ‰å²ä»¥æ¥çš„ç¬¬ä¸€ä¸ªäº¤æ˜“è¾“å‡ºï¼Œå¹¶ä¸”ç”±äºæ²¡æœ‰å‰ä¸€ç¬”äº¤æ˜“ï¼Œä¹Ÿå°±æ²¡æœ‰ç›¸åº”çš„è¾“å‡ºï¼Œå› æ­¤ä¸éœ€è¦å‰ä¸€ç¬”äº¤æ˜“çš„äº¤æ˜“è¾“å‡ºã€‚</p><p>è®©æˆ‘ä»¬æ¥åˆ›å»º coinbase äº¤æ˜“ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ›å»ºCoinBaseäº¤æ˜“</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> to   æ”¶è´¦çš„é’±åŒ…åœ°å€</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> data è§£é”è„šæœ¬æ•°æ®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Transaction <span class="title">newCoinbaseTX</span><span class="params">(String to, String data)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isBlank(data)) &#123;</span><br><span class="line">        data = String.format(<span class="string">"Reward to '%s'"</span>, to);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åˆ›å»ºäº¤æ˜“è¾“å…¥</span></span><br><span class="line">    TXInput txInput = <span class="keyword">new</span> TXInput(<span class="keyword">new</span> <span class="keyword">byte</span>[]&#123;&#125;, -<span class="number">1</span>, data);</span><br><span class="line">    <span class="comment">// åˆ›å»ºäº¤æ˜“è¾“å‡º</span></span><br><span class="line">    TXOutput txOutput = <span class="keyword">new</span> TXOutput(SUBSIDY, to);</span><br><span class="line">    <span class="comment">// åˆ›å»ºäº¤æ˜“</span></span><br><span class="line">    Transaction tx = <span class="keyword">new</span> Transaction(<span class="keyword">null</span>, <span class="keyword">new</span> TXInput[]&#123;txInput&#125;, <span class="keyword">new</span> TXOutput[]&#123;txOutput&#125;);</span><br><span class="line">    <span class="comment">// è®¾ç½®äº¤æ˜“ID</span></span><br><span class="line">    tx.setTxId();</span><br><span class="line">    <span class="keyword">return</span> tx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>coinbaseäº¤æ˜“åªæœ‰ä¸€ä¸ªäº¤æ˜“è¾“å…¥ã€‚åœ¨æˆ‘ä»¬çš„ä»£ç å®ç°ä¸­ï¼Œ<strong>txId</strong> æ˜¯ç©ºæ•°ç»„ï¼Œ<strong>txOutputIndex</strong> è®¾ç½®ä¸ºäº† -1ã€‚å¦å¤–ï¼Œcoinbaseäº¤æ˜“ä¸ä¼šåœ¨ <strong>ScriptSig</strong> å­—æ®µä¸Šå­˜å‚¨è§£é”è„šæœ¬ï¼Œç›¸åï¼Œå­˜äº†ä¸€ä¸ªä»»æ„çš„æ•°æ®ã€‚</p><blockquote><p>åœ¨æ¯”ç‰¹å¸ä¸­ï¼Œç¬¬ä¸€ä¸ª coinbase äº¤æ˜“æŠ¥åˆŠäº†å¦‚ä¸‹çš„ä¿¡æ¯ï¼šâ€The Times 03/Jan/2009 Chancellor on brink of second bailout for banksâ€. <a href="https://blockchain.info/tx/4a5e1e4baab89f3a32518a88c31bc87f618f76673e2cc77ab2127b7afdeda33b?show_adv=true" target="_blank" rel="noopener">ç‚¹å‡»æŸ¥çœ‹</a></p></blockquote><p><strong>SUBSIDY</strong> æ˜¯æŒ–çŸ¿å¥–åŠ±æ•°é‡ã€‚åœ¨æ¯”ç‰¹å¸ä¸­ï¼Œè¿™ä¸ªå¥–åŠ±æ•°é‡æ²¡æœ‰å­˜å‚¨åœ¨ä»»ä½•åœ°æ–¹ï¼Œè€Œæ˜¯ä¾æ®ç°æœ‰åŒºå—çš„æ€»æ•°è¿›è¡Œè®¡ç®—è€Œå¾—åˆ°ï¼šåŒºå—æ€»æ•° é™¤ä»¥ 210000ã€‚å¼€é‡‡åˆ›ä¸–åŒºå—å¾—åˆ°çš„å¥–åŠ±ä¸º50BTCï¼Œæ¯è¿‡ 210000 ä¸ªåŒºå—ï¼Œå¥–åŠ±ä¼šå‡åŠã€‚åœ¨æˆ‘ä»¬çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬æš‚ä¸”å°†æŒ–çŸ¿å¥–åŠ±è®¾ç½®ä¸ºå¸¸æ•°ã€‚ï¼ˆè‡³å°‘ç›®å‰æ˜¯è¿™æ ·ï¼‰</p><h2 id="åœ¨åŒºå—é“¾ä¸­å­˜å‚¨äº¤æ˜“ä¿¡æ¯"><a href="#åœ¨åŒºå—é“¾ä¸­å­˜å‚¨äº¤æ˜“ä¿¡æ¯" class="headerlink" title="åœ¨åŒºå—é“¾ä¸­å­˜å‚¨äº¤æ˜“ä¿¡æ¯"></a>åœ¨åŒºå—é“¾ä¸­å­˜å‚¨äº¤æ˜“ä¿¡æ¯</h2><p>ä»ç°åœ¨å¼€å§‹ï¼Œæ¯ä¸€ä¸ªåŒºå—å¿…é¡»å­˜å‚¨è‡³å°‘ä¸€ä¸ªäº¤æ˜“ä¿¡æ¯ï¼Œå¹¶ä¸”å°½å¯èƒ½åœ°é¿å…åœ¨æ²¡æœ‰äº¤æ˜“æ•°æ®çš„æƒ…å†µä¸‹è¿›è¡ŒæŒ–çŸ¿ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»ç§»é™¤ <strong>Block</strong> å¯¹è±¡ä¸­çš„ <strong>date</strong> å­—æ®µï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ <strong>transactions</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŒºå—</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/02/02</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Block</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŒºå—hashå€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String hash;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‰ä¸€ä¸ªåŒºå—çš„hashå€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String previousHash;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äº¤æ˜“ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Transaction[] transactions;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŒºå—åˆ›å»ºæ—¶é—´(å•ä½:ç§’)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> timeStamp;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›¸åº”åœ°ï¼Œ<strong>newGenesisBlock</strong> ä¸ <strong>newBlock</strong> ä¹Ÿéƒ½éœ€è¦åšæ”¹å˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; åˆ›å»ºåˆ›ä¸–åŒºå— &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> coinbase</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Block <span class="title">newGenesisBlock</span><span class="params">(Transaction coinbase)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Block.newBlock(<span class="string">""</span>, <span class="keyword">new</span> Transaction[]&#123;coinbase&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; åˆ›å»ºæ–°åŒºå— &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> previousHash</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> transactions</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Block <span class="title">newBlock</span><span class="params">(String previousHash, Transaction[] transactions)</span> </span>&#123;</span><br><span class="line">     Block block = <span class="keyword">new</span> Block(<span class="string">""</span>, previousHash, transactions, Instant.now().getEpochSecond(), <span class="number">0</span>);</span><br><span class="line">     ProofOfWork pow = ProofOfWork.newProofOfWork(block);</span><br><span class="line">     PowResult powResult = pow.run();</span><br><span class="line">     block.setHash(powResult.getHash());</span><br><span class="line">     block.setNonce(powResult.getNonce());</span><br><span class="line">     <span class="keyword">return</span> block;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œä¿®æ”¹ <strong>newBlockchain</strong> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * &lt;p&gt; åˆ›å»ºåŒºå—é“¾ &lt;/p&gt;</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> address é’±åŒ…åœ°å€</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Blockchain <span class="title">newBlockchain</span><span class="params">(String address)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    String lastBlockHash = RocksDBUtils.getInstance().getLastBlockHash();</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isBlank(lastBlockHash)) &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º coinBase äº¤æ˜“</span></span><br><span class="line">        Transaction coinbaseTX = Transaction.newCoinbaseTX(address, <span class="string">""</span>);</span><br><span class="line">        Block genesisBlock = Block.newGenesisBlock(coinbaseTX);</span><br><span class="line">        lastBlockHash = genesisBlock.getHash();</span><br><span class="line">        RocksDBUtils.getInstance().putBlock(genesisBlock);</span><br><span class="line">        RocksDBUtils.getInstance().putLastBlockHash(lastBlockHash);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">new</span> Blockchain(lastBlockHash);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œä»£ç æœ‰é’±åŒ…åœ°å€çš„æ¥å£ï¼Œå°†ä¼šæ”¶åˆ°å¼€é‡‡åˆ›ä¸–åŒºå—çš„å¥–åŠ±ã€‚</p><h2 id="å·¥ä½œé‡è¯æ˜ï¼ˆPowï¼‰"><a href="#å·¥ä½œé‡è¯æ˜ï¼ˆPowï¼‰" class="headerlink" title="å·¥ä½œé‡è¯æ˜ï¼ˆPowï¼‰"></a>å·¥ä½œé‡è¯æ˜ï¼ˆPowï¼‰</h2><p>Powç®—æ³•å¿…é¡»å°†å­˜å‚¨åœ¨åŒºå—ä¸­çš„äº¤æ˜“ä¿¡æ¯è€ƒè™‘åœ¨å†…ï¼Œä»¥ä¿å­˜äº¤æ˜“ä¿¡æ¯å­˜å‚¨çš„ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»ä¿®æ”¹ <strong>ProofOfWork.prepareData</strong> æ¥å£ä»£ç é€»è¾‘ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‡†å¤‡æ•°æ®</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * æ³¨æ„ï¼šåœ¨å‡†å¤‡åŒºå—æ•°æ®æ—¶ï¼Œä¸€å®šè¦ä»åŸå§‹æ•°æ®ç±»å‹è½¬åŒ–ä¸ºbyte[]ï¼Œä¸èƒ½ç›´æ¥ä»å­—ç¬¦ä¸²è¿›è¡Œè½¬æ¢</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> nonce</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">prepareData</span><span class="params">(<span class="keyword">long</span> nonce)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">byte</span>[] prevBlockHashBytes = &#123;&#125;;</span><br><span class="line">   <span class="keyword">if</span> (StringUtils.isNoneBlank(<span class="keyword">this</span>.getBlock().getPrevBlockHash())) &#123;</span><br><span class="line">       prevBlockHashBytes = <span class="keyword">new</span> BigInteger(<span class="keyword">this</span>.getBlock().getPrevBlockHash(), <span class="number">16</span>).toByteArray();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> ByteUtils.merge(</span><br><span class="line">           prevBlockHashBytes,</span><br><span class="line">           <span class="keyword">this</span>.getBlock().hashTransaction(),</span><br><span class="line">           ByteUtils.toBytes(<span class="keyword">this</span>.getBlock().getTimeStamp()),</span><br><span class="line">           ByteUtils.toBytes(TARGET_BITS),</span><br><span class="line">           ByteUtils.toBytes(nonce)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <strong>hashTransaction</strong> ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯¹åŒºå—ä¸­çš„äº¤æ˜“ä¿¡æ¯è¿›è¡ŒHashè®¡ç®—</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">byte</span>[] hashTransaction() &#123;</span><br><span class="line">   <span class="keyword">byte</span>[][] txIdArrays = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="keyword">this</span>.getTransactions().length][];</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.getTransactions().length; i++) &#123;</span><br><span class="line">       txIdArrays[i] = <span class="keyword">this</span>.getTransactions()[i].getTxId();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> DigestUtils.sha256(ByteUtils.merge(txIds));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·ï¼Œæˆ‘ä»¬ä½¿ç”¨å“ˆå¸Œå€¼æ¥ä½œä¸ºæ•°æ®çš„å”¯ä¸€æ ‡è¯†ã€‚æˆ‘ä»¬å¸Œæœ›åŒºå—ä¸­çš„æ‰€æœ‰äº¤æ˜“æ•°æ®éƒ½èƒ½é€šè¿‡ä¸€ä¸ªå“ˆå¸Œå€¼æ¥å®šä¹‰å®ƒçš„å”¯ä¸€æ ‡è¯†ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬è®¡ç®—äº†æ¯ä¸€ä¸ªäº¤æ˜“çš„å”¯ä¸€å“ˆå¸Œå€¼ï¼Œç„¶åå°†ä»–ä»¬ä¸²è”èµ·æ¥ï¼Œå†å¯¹è¿™ä¸ªä¸²è”åçš„ç»„åˆè¿›è¡Œå“ˆå¸Œå€¼è®¡ç®—ã€‚</p><blockquote><p>æ¯”ç‰¹å¸ä½¿ç”¨æ›´å¤æ‚çš„æŠ€æœ¯ï¼šå®ƒå°†æ‰€æœ‰åŒ…å«åœ¨å—ä¸­çš„äº¤æ˜“è¡¨ç¤ºä¸º <a href="https://en.bitcoin.it/wiki/Protocol_documentation#Merkle_Trees" target="_blank" rel="noopener">Merkleæ ‘</a> ï¼Œå¹¶åœ¨Proof-of-Workç³»ç»Ÿä¸­ä½¿ç”¨è¯¥æ ‘çš„æ ¹æ•£åˆ—ã€‚ è¿™ç§æ–¹æ³•åªéœ€è¦è·ŸèŠ‚ç‚¹çš„æ•£åˆ—å€¼å°±å¯ä»¥å¿«é€Ÿæ£€æŸ¥å—æ˜¯å¦åŒ…å«æŸç¬”äº¤æ˜“ï¼Œè€Œæ— éœ€ä¸‹è½½æ‰€æœ‰äº¤æ˜“ã€‚</p></blockquote><h2 id="UTXOï¼ˆæœªèŠ±è´¹äº¤æ˜“è¾“å‡ºï¼‰"><a href="#UTXOï¼ˆæœªèŠ±è´¹äº¤æ˜“è¾“å‡ºï¼‰" class="headerlink" title="UTXOï¼ˆæœªèŠ±è´¹äº¤æ˜“è¾“å‡ºï¼‰"></a>UTXOï¼ˆæœªèŠ±è´¹äº¤æ˜“è¾“å‡ºï¼‰</h2><blockquote><p>UTXOï¼šunspend transaction output.ï¼ˆæœªè¢«èŠ±è´¹çš„äº¤æ˜“è¾“å‡ºï¼‰</p><p>åœ¨æ¯”ç‰¹å¸çš„ä¸–ç•Œé‡Œæ—¢æ²¡æœ‰è´¦æˆ·ï¼Œä¹Ÿæ²¡æœ‰ä½™é¢ï¼Œåªæœ‰åˆ†æ•£åˆ°åŒºå—é“¾é‡Œçš„UTXO.</p></blockquote><p><em>UTXO</em> æ˜¯ç†è§£æ¯”ç‰¹å¸äº¤æ˜“åŸç†çš„å…³é”®æ‰€åœ¨ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€æ®µåœºæ™¯ï¼š</p><p>åœºæ™¯ï¼šå‡è®¾ä½ è¿‡å»åˆ†åˆ«å‘Aã€Bã€Cè¿™ä¸‰ä¸ªæ¯”ç‰¹å¸ç”¨æˆ·è´­ä¹°äº†BTCï¼Œä»Aæ‰‹ä¸­è´­ä¹°äº†3.5ä¸ªBTCï¼Œä»Bæ‰‹ä¸­è´­ä¹°äº†4.5ä¸ªBTCï¼Œä»Cæ‰‹ä¸­è´­ä¹°äº†2ä¸ªBTCï¼Œç°åœ¨ä½ çš„æ¯”ç‰¹å¸é’±åŒ…é‡Œé¢æ°å¥½å‰©ä½™10ä¸ªBTCã€‚</p><p>é—®é¢˜ï¼šè¿™ä¸ª10ä¸ªBTCæ˜¯çœŸæ­£çš„10ä¸ªBTCå—ï¼Ÿå…¶å®ä¸æ˜¯ï¼Œè¿™å¥è¯å¯èƒ½å¬èµ·æ¥æœ‰ç‚¹æ€ªã€‚ï¼ˆä»€ä¹ˆï¼æˆ‘é’±åŒ…é‡Œé¢çš„BTCä¸æ˜¯çœŸæ­£çš„BTCï¼Œä½ ä¸è¦å“æˆ‘â€¦â€¦ï¼‰</p><p>è§£é‡Šï¼šå‰é¢æåˆ°è¿‡åœ¨æ¯”ç‰¹å¸çš„äº¤æ˜“ç³»ç»Ÿå½“ä¸­ï¼Œå¹¶ä¸å­˜åœ¨è´¦æˆ·ã€ä½™é¢è¿™äº›æ¦‚å¿µï¼Œæ‰€ä»¥ï¼Œä½ çš„é’±åŒ…é‡Œé¢çš„10ä¸ªBTCï¼Œå¹¶ä¸æ˜¯è¯´é’±åŒ…ä½™é¢ä¸º10ä¸ªBTCã€‚è€Œæ˜¯è¯´ï¼Œè¿™10ä¸ªBTCå…¶å®æ˜¯ç”±ä½ çš„æ¯”ç‰¹å¸åœ°å€ï¼ˆé’±åŒ…åœ°å€|å…¬é’¥ï¼‰é”å®šäº†çš„æ•£è½åœ¨å„ä¸ªåŒºå—å’Œå„ä¸ªäº¤æ˜“é‡Œé¢çš„UTXOçš„æ€»å’Œã€‚</p><p>UTXO æ˜¯æ¯”ç‰¹å¸äº¤æ˜“çš„åŸºæœ¬å•ä½ï¼Œæ¯ç¬”äº¤æ˜“éƒ½ä¼šäº§ç”ŸUTXOï¼Œä¸€ä¸ªUTXOå¯ä»¥æ˜¯ä¸€â€œèªâ€çš„ä»»æ„å€ã€‚ç»™æŸäººå‘é€æ¯”ç‰¹å¸å®é™…ä¸Šæ˜¯åˆ›é€ æ–°çš„UTXOï¼Œç»‘å®šåˆ°é‚£ä¸ªäººçš„é’±åŒ…åœ°å€ï¼Œå¹¶ä¸”èƒ½è¢«ä»–ç”¨äºæ–°çš„æ”¯ä»˜ã€‚</p><p>ä¸€èˆ¬çš„æ¯”ç‰¹å¸äº¤æ˜“ç”± <code>äº¤æ˜“è¾“å…¥</code> å’Œ <code>äº¤æ˜“è¾“å‡º</code> ä¸¤éƒ¨åˆ†ç»„æˆã€‚Aå‘ä½ æ”¯ä»˜3.5ä¸ªBTCè¿™ç¬”äº¤æ˜“ï¼Œå®é™…ä¸Šäº§ç”Ÿäº†ä¸€ä¸ªæ–°çš„UTXOï¼Œè¿™ä¸ªæ–°çš„UTXO ç­‰äº 3.5ä¸ªBTCï¼ˆ3.5äº¿èªï¼‰ï¼Œå¹¶ä¸”é”å®šåˆ°äº†ä½ çš„æ¯”ç‰¹å¸é’±åŒ…åœ°å€ä¸Šã€‚</p><p>å‡å¦‚ä½ è¦ç»™ä½ å¥³ï¼ˆç”·ï¼‰æœ‹å‹è½¬ 1.5 BTCï¼Œé‚£ä¹ˆä½ çš„é’±åŒ…ä¼šä»å¯ç”¨çš„UTXOä¸­é€‰å–ä¸€ä¸ªæˆ–å¤šä¸ªå¯ç”¨çš„ä¸ªä½“æ¥æ‹¼å‡‘å‡ºä¸€ä¸ªå¤§äºæˆ–ç­‰äºä¸€ç¬”äº¤æ˜“æ‰€éœ€çš„æ¯”ç‰¹å¸é‡ã€‚æ¯”å¦‚åœ¨è¿™ä¸ªå‡è®¾åœºæ™¯é‡Œé¢ï¼Œä½ çš„é’±åŒ…ä¼šé€‰å–ä½ å’ŒCçš„äº¤æ˜“ä¸­çš„UTXOä½œä¸º äº¤æ˜“è¾“å…¥ï¼Œinput = 2BTCï¼Œè¿™é‡Œä¼šç”Ÿæˆä¸¤ä¸ªæ–°çš„äº¤æ˜“è¾“å‡ºï¼Œä¸€ä¸ªè¾“å‡ºï¼ˆUTXO = 1.5 BTCï¼‰ä¼šè¢«ç»‘å®šåˆ°ä½ å¥³ï¼ˆç”·ï¼‰æœ‹å‹çš„é’±åŒ…åœ°å€ä¸Šï¼Œå¦ä¸€ä¸ªè¾“å‡ºï¼ˆUTXO = 0.5 BTCï¼‰ä¼šä½œä¸ºæ‰¾é›¶ï¼Œé‡æ–°ç»‘å®šåˆ°ä½ çš„é’±åŒ…åœ°å€ä¸Šã€‚</p><blockquote><p>æœ‰å…³æ¯”ç‰¹å¸äº¤æ˜“è¿™éƒ¨åˆ†æ›´è¯¦ç»†çš„å†…å®¹ï¼Œè¯·æŸ¥çœ‹ï¼š<a href="https://github.com/bitcoinbook/bitcoinbook/blob/develop/ch06.asciidoc#transactions" target="_blank" rel="noopener">ã€Šç²¾é€šæ¯”ç‰¹å¸ï¼ˆç¬¬äºŒç‰ˆï¼‰ã€‹ç¬¬6ç«  â€”â€” äº¤æ˜“</a></p></blockquote><p>æˆ‘ä»¬éœ€è¦æ‰¾åˆ°æ‰€æœ‰æœªèŠ±è´¹çš„äº¤æ˜“è¾“å‡ºï¼ˆUTXOï¼‰ã€‚<em>Unspent(æœªèŠ±è´¹)</em> æ„å‘³ç€è¿™äº›äº¤æ˜“è¾“å‡ºä»æœªè¢«äº¤æ˜“è¾“å…¥æ‰€æŒ‡å‘ã€‚è¿™å‰é¢çš„å›¾ç‰‡ä¸­ï¼ŒUTXOå¦‚ä¸‹ï¼š</p><ol><li>tx0, output 1;</li><li>tx1, output 0;</li><li>tx3, output 0;</li><li>tx4, output 0.</li></ol><p>å½“ç„¶ï¼Œå½“æˆ‘ä»¬æ£€æŸ¥ä½™é¢æ—¶ï¼Œæˆ‘ä¸éœ€è¦åŒºå—é“¾ä¸­æ‰€æœ‰çš„UTXOï¼Œæˆ‘åªéœ€è¦èƒ½è¢«æˆ‘ä»¬è§£é”çš„UTXOï¼ˆå½“å‰ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰å®ç°å¯†é’¥å¯¹ï¼Œè€Œæ˜¯æ›¿ä»£ä¸ºç”¨æˆ·è‡ªå®šä¹‰çš„é’±åŒ…åœ°å€ï¼‰ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨äº¤æ˜“è¾“å…¥ä¸äº¤æ˜“è¾“å‡ºä¸Šå®šä¹‰é”å®š-è§£é”çš„æ–¹æ³•ï¼š</p><p>äº¤æ˜“è¾“å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TXInput</span> </span>&#123;</span><br><span class="line">  	</span><br><span class="line">    ...</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­è§£é”æ•°æ®æ˜¯å¦èƒ½å¤Ÿè§£é”äº¤æ˜“è¾“å‡º</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unlockingData</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canUnlockOutputWith</span><span class="params">(String unlockingData)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getScriptSig().endsWith(unlockingData);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº¤æ˜“è¾“å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TXOutput</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­è§£é”æ•°æ®æ˜¯å¦èƒ½å¤Ÿè§£é”äº¤æ˜“è¾“å‡º</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unlockingData</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canBeUnlockedWith</span><span class="params">(String unlockingData)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getScriptPubKey().endsWith(unlockingData);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬æš‚æ—¶ç”¨ <strong>unlockingData</strong> æ¥ä¸è„šæœ¬å­—æ®µè¿›è¡Œæ¯”è¾ƒã€‚æˆ‘ä»¬ä¼šåœ¨åé¢çš„æ–‡ç« ä¸­æ¥å¯¹è¿™éƒ¨åˆ†å†…å®¹è¿›è¡Œä¼˜åŒ–ï¼Œæˆ‘ä»¬å°†ä¼šåŸºäºç§é’¥æ¥å®ç°ç”¨æˆ·çš„é’±åŒ…åœ°å€ã€‚</p><p>ä¸‹ä¸€æ­¥ï¼ŒæŸ¥è¯¢æ‰€æœ‰ä¸é’±åŒ…åœ°å€ç»‘å®šçš„åŒ…å«UTXOçš„äº¤æ˜“ä¿¡æ¯ï¼Œæœ‰ç‚¹å¤æ‚ï¼ˆæœ¬ç¯‡å…ˆè¿™æ ·å®ç°ï¼Œåé¢æˆ‘ä»¬åšä¸€ä¸ªä¸é’±åŒ…åœ°å€æ˜ å°„çš„UTXOæ± æ¥è¿›è¡Œä¼˜åŒ–ï¼‰ï¼š</p><ul><li>ä»ä¸é’±åŒ…åœ°å€å¯¹åº”çš„äº¤æ˜“è¾“å…¥ä¸­æŸ¥è¯¢å‡ºæ‰€æœ‰å·²è¢«èŠ±è´¹äº†çš„äº¤æ˜“è¾“å‡º</li><li>å†æ¥æ’é™¤ï¼Œå¯»æ‰¾åŒ…å«æœªè¢«èŠ±è´¹çš„äº¤æ˜“è¾“å‡ºçš„äº¤æ˜“</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Blockchain</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥æ‰¾é’±åŒ…åœ°å€å¯¹åº”çš„æ‰€æœ‰æœªèŠ±è´¹çš„äº¤æ˜“</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> address é’±åŒ…åœ°å€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Transaction[] findUnspentTransactions(String address) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Map&lt;String, <span class="keyword">int</span>[]&gt; allSpentTXOs = <span class="keyword">this</span>.getAllSpentTXOs(address);</span><br><span class="line">        Transaction[] unspentTxs = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å†æ¬¡éå†æ‰€æœ‰åŒºå—ä¸­çš„äº¤æ˜“è¾“å‡º</span></span><br><span class="line">        <span class="keyword">for</span> (BlockchainIterator blockchainIterator = <span class="keyword">this</span>.getBlockchainIterator(); blockchainIterator.hashNext(); ) &#123;</span><br><span class="line">            Block block = blockchainIterator.next();</span><br><span class="line">            <span class="keyword">for</span> (Transaction transaction : block.getTransactions()) &#123;</span><br><span class="line"></span><br><span class="line">                String txId = Hex.encodeHexString(transaction.getTxId());</span><br><span class="line"></span><br><span class="line">                <span class="keyword">int</span>[] spentOutIndexArray = allSpentTXOs.get(txId);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> outIndex = <span class="number">0</span>; outIndex &lt; transaction.getOutputs().length; outIndex++) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (spentOutIndexArray != <span class="keyword">null</span> &amp;&amp; ArrayUtils.contains(spentOutIndexArray, outIndex)) &#123;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// ä¿å­˜ä¸å­˜åœ¨ allSpentTXOs ä¸­çš„äº¤æ˜“</span></span><br><span class="line">                    <span class="keyword">if</span> (transaction.getOutputs()[outIndex].canBeUnlockedWith(address)) &#123;</span><br><span class="line">                        unspentTxs = ArrayUtils.add(unspentTxs, transaction);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> unspentTxs;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»äº¤æ˜“è¾“å…¥ä¸­æŸ¥è¯¢åŒºå—é“¾ä¸­æ‰€æœ‰å·²è¢«èŠ±è´¹äº†çš„äº¤æ˜“è¾“å‡º</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> address é’±åŒ…åœ°å€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> äº¤æ˜“IDä»¥åŠå¯¹åº”çš„äº¤æ˜“è¾“å‡ºä¸‹æ ‡åœ°å€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, <span class="keyword">int</span>[]&gt; getAllSpentTXOs(String address) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// å®šä¹‰TxId â€”â€”&gt; spentOutIndex[]ï¼Œå­˜å‚¨äº¤æ˜“IDä¸å·²è¢«èŠ±è´¹çš„äº¤æ˜“è¾“å‡ºæ•°ç»„ç´¢å¼•å€¼</span></span><br><span class="line">        Map&lt;String, <span class="keyword">int</span>[]&gt; spentTXOs = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (BlockchainIterator blockchainIterator = <span class="keyword">this</span>.getBlockchainIterator(); blockchainIterator.hashNext(); ) &#123;</span><br><span class="line">            Block block = blockchainIterator.next();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (Transaction transaction : block.getTransactions()) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœæ˜¯ coinbase äº¤æ˜“ï¼Œç›´æ¥è·³è¿‡ï¼Œå› ä¸ºå®ƒä¸å­˜åœ¨å¼•ç”¨å‰ä¸€ä¸ªåŒºå—çš„äº¤æ˜“è¾“å‡º</span></span><br><span class="line">                <span class="keyword">if</span> (transaction.isCoinbase()) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span> (TXInput txInput : transaction.getInputs()) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (txInput.canUnlockOutputWith(address)) &#123;</span><br><span class="line">                        String inTxId = Hex.encodeHexString(txInput.getTxId());</span><br><span class="line">                        <span class="keyword">int</span>[] spentOutIndexArray = spentTXOs.get(inTxId);</span><br><span class="line">                        <span class="keyword">if</span> (spentOutIndexArray == <span class="keyword">null</span>) &#123;</span><br><span class="line">                            spentTXOs.put(inTxId, <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;txInput.getTxOutputIndex()&#125;);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            spentOutIndexArray = ArrayUtils.add(spentOutIndexArray, txInput.getTxOutputIndex());</span><br><span class="line">                            spentTXOs.put(inTxId, spentOutIndexArray);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> spentTXOs;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾—åˆ°äº†æ‰€æœ‰åŒ…å«UTXOçš„äº¤æ˜“æ•°æ®ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°æ‰€æœ‰UTXOé›†åˆäº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Blockchain</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   ...</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥æ‰¾é’±åŒ…åœ°å€å¯¹åº”çš„æ‰€æœ‰UTXO</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> address é’±åŒ…åœ°å€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> TXOutput[] findUTXO(String address) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Transaction[] unspentTxs = <span class="keyword">this</span>.findUnspentTransactions(address);</span><br><span class="line">        TXOutput[] utxos = &#123;&#125;;</span><br><span class="line">        <span class="keyword">if</span> (unspentTxs == <span class="keyword">null</span> || unspentTxs.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> utxos;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (Transaction tx : unspentTxs) &#123;</span><br><span class="line">            <span class="keyword">for</span> (TXOutput txOutput : tx.getOutputs()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (txOutput.canBeUnlockedWith(address)) &#123;</span><br><span class="line">                    utxos = ArrayUtils.add(utxos, txOutput);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> utxos;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°è·å–é’±åŒ…åœ°å€ä½™é¢çš„æ¥å£äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CLI</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">        </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢é’±åŒ…ä½™é¢</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> address é’±åŒ…åœ°å€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getBalance</span><span class="params">(String address)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Blockchain blockchain = Blockchain.createBlockchain(address);</span><br><span class="line">        TXOutput[] txOutputs = blockchain.findUTXO(address);</span><br><span class="line">        <span class="keyword">int</span> balance = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (txOutputs != <span class="keyword">null</span> &amp;&amp; txOutputs.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (TXOutput txOutput : txOutputs) &#123;</span><br><span class="line">                balance += txOutput.getValue();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.printf(<span class="string">"Balance of '%s': %d\n"</span>, address, balance);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    ...</span><br><span class="line">        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢ <em>wangwei</em> è¿™ä¸ªé’±åŒ…åœ°å€çš„ä½™é¢ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ./blockchain.sh getbalance -address wangwei</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">Balance of <span class="string">'wangwei'</span>: <span class="number">10</span></span><br></pre></td></tr></table></figure><h2 id="è½¬è´¦"><a href="#è½¬è´¦" class="headerlink" title="è½¬è´¦"></a>è½¬è´¦</h2><p>ç°åœ¨ï¼Œæˆ‘ä»¬æƒ³è¦ç»™æŸäººå‘é€ä¸€äº›å¸ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ç¬”æ–°çš„äº¤æ˜“ï¼Œç„¶åæ”¾å…¥åŒºå—ä¸­ï¼Œå†è¿›è¡ŒæŒ–çŸ¿ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªæ˜¯å®ç°äº† <em>coinbase</em> äº¤æ˜“ï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦å®ç°å¸¸è§çš„åˆ›å»ºäº¤æ˜“æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Transaction</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">   ...</span><br><span class="line">   </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä» from å‘  to æ”¯ä»˜ä¸€å®šçš„ amount çš„é‡‘é¢</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> from       æ”¯ä»˜é’±åŒ…åœ°å€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> to         æ”¶æ¬¾é’±åŒ…åœ°å€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> amount     äº¤æ˜“é‡‘é¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> blockchain åŒºå—é“¾</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Transaction <span class="title">newUTXOTransaction</span><span class="params">(String from, String to, <span class="keyword">int</span> amount, Blockchain blockchain)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        SpendableOutputResult result = blockchain.findSpendableOutputs(from, amount);</span><br><span class="line">        <span class="keyword">int</span> accumulated = result.getAccumulated();</span><br><span class="line">        Map&lt;String, <span class="keyword">int</span>[]&gt; unspentOuts = result.getUnspentOuts();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (accumulated &lt; amount) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"ERROR: Not enough funds"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Iterator&lt;Map.Entry&lt;String, <span class="keyword">int</span>[]&gt;&gt; iterator = unspentOuts.entrySet().iterator();</span><br><span class="line"></span><br><span class="line">        TXInput[] txInputs = &#123;&#125;;</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            Map.Entry&lt;String, <span class="keyword">int</span>[]&gt; entry = iterator.next();</span><br><span class="line">            String txIdStr = entry.getKey();</span><br><span class="line">            <span class="keyword">int</span>[] outIdxs = entry.getValue();</span><br><span class="line">            <span class="keyword">byte</span>[] txId = Hex.decodeHex(txIdStr);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> outIndex : outIdxs) &#123;</span><br><span class="line">                txInputs = ArrayUtils.add(txInputs, <span class="keyword">new</span> TXInput(txId, outIndex, from));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        TXOutput[] txOutput = &#123;&#125;;</span><br><span class="line">        txOutput = ArrayUtils.add(txOutput, <span class="keyword">new</span> TXOutput(amount, to));</span><br><span class="line">        <span class="keyword">if</span> (accumulated &gt; amount) &#123;</span><br><span class="line">            txOutput = ArrayUtils.add(txOutput, <span class="keyword">new</span> TXOutput((accumulated - amount), from));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Transaction newTx = <span class="keyword">new</span> Transaction(<span class="keyword">null</span>, txInputs, txOutput);</span><br><span class="line">        newTx.setTxId();</span><br><span class="line">        <span class="keyword">return</span> newTx;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨åˆ›å»ºæ–°çš„äº¤æ˜“è¾“å‡ºä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº‹å…ˆæ‰¾åˆ°æ‰€æœ‰çš„UTXOï¼Œå¹¶ç¡®ä¿æœ‰è¶³å¤Ÿçš„é‡‘é¢ã€‚è¿™å°±æ˜¯ <strong>findSpendableOutputs</strong> è¦å¹²çš„äº‹æƒ…ã€‚ä¹‹åï¼Œä¸ºæ¯ä¸ªæ‰¾åˆ°çš„è¾“å‡ºåˆ›å»ºä¸€ä¸ªå¼•ç”¨å®ƒçš„è¾“å…¥ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªäº¤æ˜“è¾“å‡ºï¼š</p><ol><li>ä¸€ä¸ª <em>output</em> ç”¨äºé”å®šåˆ°æ¥æ”¶è€…çš„é’±åŒ…åœ°å€ä¸Šã€‚è¿™ä¸ªæ˜¯çœŸæ­£è¢«è½¬èµ°çš„coinsï¼›</li><li>å¦ä¸€ä¸ª <em>output</em> é”å®šåˆ°å‘é€è€…çš„é’±åŒ…åœ°å€ä¸Šã€‚è¿™ä¸ªå°±æ˜¯ æ‰¾é›¶ã€‚åªæœ‰å½“ç”¨äºæ”¯ä»˜çš„UTXOæ€»å’Œå¤§äºè¦æ”¯ä»˜çš„é‡‘é¢æ—¶ï¼Œæ‰ä¼šåˆ›å»ºè¿™éƒ¨åˆ†çš„ äº¤æ˜“è¾“å‡ºã€‚è®°ä½ï¼šäº¤æ˜“è¾“å‡ºæ˜¯<strong>ä¸å¯åˆ†å‰²çš„</strong></li></ol><p><strong>findSpendableOutputs</strong> éœ€è¦è°ƒç”¨æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„ <strong>findUnspentTransactions</strong> æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Blockchain</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯»æ‰¾èƒ½å¤ŸèŠ±è´¹çš„äº¤æ˜“</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> address é’±åŒ…åœ°å€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> amount  èŠ±è´¹é‡‘é¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SpendableOutputResult <span class="title">findSpendableOutputs</span><span class="params">(String address, <span class="keyword">int</span> amount)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Transaction[] unspentTXs = <span class="keyword">this</span>.findUnspentTransactions(address);</span><br><span class="line">        <span class="keyword">int</span> accumulated = <span class="number">0</span>;</span><br><span class="line">        Map&lt;String, <span class="keyword">int</span>[]&gt; unspentOuts = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Transaction tx : unspentTXs) &#123;</span><br><span class="line"></span><br><span class="line">            String txId = Hex.encodeHexString(tx.getTxId());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> outId = <span class="number">0</span>; outId &lt; tx.getOutputs().length; outId++) &#123;</span><br><span class="line"></span><br><span class="line">                TXOutput txOutput = tx.getOutputs()[outId];</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (txOutput.canBeUnlockedWith(address) &amp;&amp; accumulated &lt; amount) &#123;</span><br><span class="line">                    accumulated += txOutput.getValue();</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">int</span>[] outIds = unspentOuts.get(txId);</span><br><span class="line">                    <span class="keyword">if</span> (outIds == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        outIds = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;outId&#125;;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        outIds = ArrayUtils.add(outIds, outId);</span><br><span class="line">                    &#125;</span><br><span class="line">                    unspentOuts.put(txId, outIds);</span><br><span class="line">                    <span class="keyword">if</span> (accumulated &gt;= amount) &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SpendableOutputResult(accumulated, unspentOuts);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•ä¼šéå†æ‰€æœ‰çš„UTXOå¹¶ç»Ÿè®¡ä»–ä»¬çš„æ€»é¢ã€‚å½“è®¡ç®—çš„æ€»é¢æ°å¥½å¤§äºæˆ–è€…ç­‰äºéœ€è¦è½¬è´¦çš„é‡‘é¢æ—¶ï¼Œæ–¹æ³•ä¼šåœæ­¢éå†ï¼Œç„¶åè¿”å›ç”¨äºæ”¯ä»˜çš„æ€»é¢ä»¥åŠæŒ‰äº¤æ˜“IDåˆ†ç»„çš„äº¤æ˜“è¾“å‡ºç´¢å¼•å€¼æ•°ç»„ã€‚æˆ‘ä»¬ä¸æƒ³è¦èŠ±æ›´å¤šçš„é’±ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ <strong>Block.mineBlock</strong> æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Block</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   ...</span><br><span class="line">   </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰“åŒ…äº¤æ˜“ï¼Œè¿›è¡ŒæŒ–çŸ¿</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> transactions</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mineBlock</span><span class="params">(Transaction[] transactions)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String lastBlockHash = RocksDBUtils.getInstance().getLastBlockHash();</span><br><span class="line">        <span class="keyword">if</span> (lastBlockHash == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"ERROR: Fail to get last block hash ! "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Block block = Block.newBlock(lastBlockHash, transactions);</span><br><span class="line">        <span class="keyword">this</span>.addBlock(block);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œæˆ‘ä»¬æ¥å®ç°è½¬è´¦çš„æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CLI</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   ...</span><br><span class="line">  </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è½¬è´¦</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> from</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> to</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> amount</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(String from, String to, <span class="keyword">int</span> amount)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Blockchain blockchain = Blockchain.createBlockchain(from);</span><br><span class="line">        Transaction transaction = Transaction.newUTXOTransaction(from, to, amount, blockchain);</span><br><span class="line">        blockchain.mineBlock(<span class="keyword">new</span> Transaction[]&#123;transaction&#125;);</span><br><span class="line">        RocksDBUtils.getInstance().closeDB();</span><br><span class="line">        System.out.println(<span class="string">"Success!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è½¬è´¦ï¼Œæ„å‘³ç€åˆ›å»ºä¸€ç¬”æ–°çš„äº¤æ˜“å¹¶ä¸”é€šè¿‡æŒ–çŸ¿çš„æ–¹å¼å°†å…¶å­˜å…¥åŒºå—ä¸­ã€‚ä½†æ˜¯ï¼Œæ¯”ç‰¹å¸ä¸ä¼šåƒæˆ‘ä»¬è¿™æ ·åšï¼Œå®ƒä¼šæŠŠæ–°çš„äº¤æ˜“è®°å½•å…ˆå­˜åˆ°å†…å­˜æ± ä¸­ï¼Œå½“ä¸€ä¸ªçŸ¿å·¥å‡†å¤‡å»å¼€é‡‡ä¸€ä¸ªåŒºå—æ—¶ï¼Œå®ƒä¼šæŠŠæ‰“åŒ…å†…å­˜æ± ä¸­çš„æ‰€æœ‰äº¤æ˜“ä¿¡æ¯ï¼Œå¹¶ä¸”åˆ›å»ºä¸€ä¸ªå€™é€‰åŒºå—ã€‚åªæœ‰å½“è¿™ä¸ªåŒ…å«æ‰€æœ‰äº¤æ˜“ä¿¡æ¯çš„å€™é€‰åŒºå—è¢«æˆåŠŸå¼€é‡‡å¹¶ä¸”è¢«æ·»åŠ åˆ°åŒºå—é“¾ä¸Šæ—¶ï¼Œè¿™äº›äº¤æ˜“ä¿¡æ¯æ‰ç®—è¢«ç¡®è®¤ã€‚</p><p>è®©æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…ˆç¡®è®¤ wangwei çš„ä½™é¢</span></span><br><span class="line">$ ./blockchain.sh getbalance -address wangwei</span><br><span class="line">Balance of <span class="string">'wangwei'</span>: <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è½¬è´¦</span></span><br><span class="line">$ ./blockchain.sh send -from wangwei -to Pedro -amount <span class="number">6</span></span><br><span class="line">Elapsed Time: <span class="number">0.828</span> seconds </span><br><span class="line">correct hash Hex: <span class="number">00000</span>c5f50cf72db1f375a5d454f98bc49d07335db921cbef5fa9e58ad34d462 </span><br><span class="line"></span><br><span class="line">Success!</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢ wangwei çš„ä½™é¢</span></span><br><span class="line">$ ./blockchain.sh getbalance -address wangwei</span><br><span class="line">Balance of <span class="string">'wangwei'</span>: <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢ Pedro çš„ä½™é¢</span></span><br><span class="line">$ ./blockchain.sh getbalance -address Pedro</span><br><span class="line">Balance of <span class="string">'Pedro'</span>: <span class="number">6</span></span><br></pre></td></tr></table></figure><p>èµï¼ç°åœ¨è®©æˆ‘ä»¬æ¥åˆ›å»ºæ›´å¤šçš„äº¤æ˜“å¹¶ä¸”ç¡®ä¿ä»å¤šä¸ªäº¤æ˜“è¾“å‡ºè¿›è¡Œè½¬è´¦æ˜¯æ­£å¸¸çš„ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ ./blockchain.sh send -from Pedro -to Helen -amount <span class="number">2</span></span><br><span class="line">Elapsed Time: <span class="number">2.533</span> seconds </span><br><span class="line">correct hash Hex: <span class="number">00000</span>c81d541ad407a3767ad633d1147602df86fe14e1962ec145ab17b633e88 </span><br><span class="line"></span><br><span class="line">Success!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ ./blockchain.sh send -from wangwei -to Helen -amount <span class="number">2</span></span><br><span class="line">Elapsed Time: <span class="number">1.481</span> seconds </span><br><span class="line">correct hash Hex: <span class="number">00000</span>c3f8b82c2b970438f5f1f39d56bb8a9d66341efc92a02ffcbff91acd84b </span><br><span class="line"></span><br><span class="line">Success!</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼ŒHelen è¿™ä¸ªé’±åŒ…åœ°å€ä¸Šæœ‰äº†ä¸¤ç¬”ä» wangwei å’Œ Pedro è½¬è´¦ä¸­äº§ç”Ÿçš„UTXOï¼Œè®©æˆ‘ä»¬å°†å®ƒä»¬å†è½¬è´¦ç»™å¦å¤–ä¸€ä¸ªäººï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ ./blockchain.sh send -from Helen -to Rachel -amount <span class="number">3</span></span><br><span class="line">Elapsed Time: <span class="number">17.136</span> seconds </span><br><span class="line">correct hash Hex: <span class="number">000000</span>b1226a947166c2b01a15d1cd3558ddf86fe99bad28a0501a2af60f6a02 </span><br><span class="line"></span><br><span class="line">Success!</span><br><span class="line"></span><br><span class="line">$ ./blochchain.sh getbalance -address wangwei</span><br><span class="line">Balance of <span class="string">'wangwei'</span>: <span class="number">2</span></span><br><span class="line">$ ./blochchain.sh getbalance -address Pedro  </span><br><span class="line">Balance of <span class="string">'Pedro'</span>: <span class="number">4</span></span><br><span class="line">$ ./blochchain.sh getbalance -address Helen</span><br><span class="line">Balance of <span class="string">'Helen'</span>: <span class="number">1</span></span><br><span class="line">$ ./blochchain.sh getbalance -address Rachel</span><br><span class="line">Balance of <span class="string">'Rachel'</span>: <span class="number">3</span></span><br></pre></td></tr></table></figure><p>éå¸¸æ£’ï¼è®©æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹å¤±è´¥çš„åœºæ™¯ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ./blochchain.sh send -from wangwei -to Ivan -amount <span class="number">5</span> </span><br><span class="line">java.lang.Exception: ERROR: Not enough funds</span><br><span class="line">        at one.wangwei.blockchain.transaction.Transaction.newUTXOTransaction(Transaction.java:<span class="number">104</span>)</span><br><span class="line">        at one.wangwei.blockchain.cli.CLI.send(CLI.java:<span class="number">138</span>)</span><br><span class="line">        at one.wangwei.blockchain.cli.CLI.parse(CLI.java:<span class="number">73</span>)</span><br><span class="line">        at one.wangwei.blockchain.cli.Main.main(Main.java:<span class="number">7</span>)</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬ç¯‡å†…å®¹æœ‰ç‚¹éš¾åº¦ï¼Œä½†å¥½æ­¹æˆ‘ä»¬ç°åœ¨æœ‰äº†äº¤æ˜“ä¿¡æ¯äº†ã€‚å°½ç®¡ï¼Œç¼ºå°‘åƒæ¯”ç‰¹å¸è¿™ä¸€ç±»åŠ å¯†è´§å¸çš„ä¸€äº›å…³é”®ç‰¹æ€§ï¼š</p><ol><li>é’±åŒ…åœ°å€ã€‚æˆ‘ä»¬è¿˜æ²¡æœ‰åŸºäºç§é’¥çš„çœŸå®åœ°å€ã€‚</li><li>å¥–åŠ±ã€‚æŒ–çŸ¿ç»å¯¹æ²¡æœ‰åˆ©æ¶¦ã€‚</li><li>UTXOæ± ã€‚å½“æˆ‘ä»¬è®¡ç®—é’±åŒ…åœ°å€çš„ä½™é¢æ—¶ï¼Œæˆ‘ä»¬éœ€è¦éå†æ‰€æœ‰çš„åŒºå—ä¸­çš„æ‰€æœ‰äº¤æ˜“ä¿¡æ¯ï¼Œå½“æœ‰è®¸è®¸å¤šå¤šçš„åŒºå—æ—¶ï¼Œè¿™å°†èŠ±è´¹ä¸å°‘çš„æ—¶é—´ã€‚æ­¤å¤–ï¼Œå¦‚æœæˆ‘ä»¬æƒ³éªŒè¯ä»¥åçš„äº¤æ˜“ï¼Œå¯èƒ½éœ€è¦å¾ˆé•¿æ—¶é—´ã€‚ UTXOè¿Ÿæ—¨åœ¨è§£å†³è¿™äº›é—®é¢˜å¹¶å¿«é€Ÿå¤„ç†äº¤æ˜“ã€‚</li><li>å†…å­˜æ± ã€‚ è¿™æ˜¯äº¤æ˜“åœ¨æ‰“åŒ…æˆåŒºå—ä¹‹å‰å­˜å‚¨çš„åœ°æ–¹ã€‚ åœ¨æˆ‘ä»¬å½“å‰çš„å®ç°ä¸­ï¼Œä¸€ä¸ªå—åªåŒ…å«ä¸€ç¬”äº¤æ˜“ï¼Œè€Œä¸”æ•ˆç‡å¾ˆä½ã€‚</li></ol><h2 id="èµ„æ–™"><a href="#èµ„æ–™" class="headerlink" title="èµ„æ–™"></a>èµ„æ–™</h2><ul><li>æºä»£ç ï¼š<a href="https://github.com/wangweiX/blockchain-java/tree/part4-transaction1" target="_blank" rel="noopener">https://github.com/wangweiX/blockchain-java/tree/part4-transaction1</a></li><li><a href="https://github.com/bitcoinbook/bitcoinbook/blob/develop/ch06.asciidoc#transactions" target="_blank" rel="noopener">ã€Šç²¾é€šæ¯”ç‰¹å¸ï¼ˆç¬¬äºŒç‰ˆï¼‰ã€‹ç¬¬6ç«  â€”â€” äº¤æ˜“</a></li></ul><p><img src="https://img.i7years.com/blog/blockchain_exploer.png" alt=""></p><blockquote><p><a href="https://press.one/file/v?s=ef3077c075f4ea9ffa0bd7a17d004d0af5fd1f67d8380989aba29b505c2343e7a5cf4e8a4ef75b82cb5ddea2428e5a8d9d0437c0a236ee49230005bb49104e8b1&amp;h=3e4f040f8eb07adfd8915dda4dbb1e2301860d195e5b9445a0256e56d01cebc7&amp;a=23fe9bfd7ceef4b44c2ce44dcac8e4a49caf8026&amp;f=P1&amp;v=2" target="_blank" rel="noopener">https://press.one/file/v?s=ef3077c075f4ea9ffa0bd7a17d004d0af5fd1f67d8380989aba29b505c2343e7a5cf4e8a4ef75b82cb5ddea2428e5a8d9d0437c0a236ee49230005bb49104e8b1&amp;h=3e4f040f8eb07adfd8915dda4dbb1e2301860d195e5b9445a0256e56d01cebc7&amp;a=23fe9bfd7ceef4b44c2ce44dcac8e4a49caf8026&amp;f=P1&amp;v=2</a></p></blockquote>]]></content>
      
        <categories>
            
            <category> blockchain </category>
            
        </categories>
        
        
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> bitcoin </tag>
            
            <tag> UTXO </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[åŸºäºJavaè¯­è¨€æ„å»ºåŒºå—é“¾ï¼ˆä¸‰ï¼‰â€”â€” æŒä¹…åŒ– & å‘½ä»¤è¡Œ]]></title>
      <url>/posts/build-blockchain-in-java-data-persistence.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/Millerblockchainadj-3200x2400.webp?imageslim" alt="blockchain"></p><blockquote><p>æ–‡ç« çš„ä¸»è¦æ€æƒ³å’Œå†…å®¹å‡æ¥è‡ªï¼š<a href="https://jeiwan.cc/posts/building-blockchain-in-go-part-3/" target="_blank" rel="noopener">https://jeiwan.cc/posts/building-blockchain-in-go-part-3/</a></p></blockquote><h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p><a href="https://wangwei.one/posts/7890ab7e.html">ä¸Šä¸€ç¯‡</a> æ–‡ç« æˆ‘ä»¬å®ç°äº†åŒºå—é“¾çš„å·¥ä½œé‡è¯æ˜æœºåˆ¶ï¼ˆPowï¼‰ï¼Œå°½å¯èƒ½åœ°å®ç°äº†æŒ–çŸ¿ã€‚ä½†æ˜¯è·ç¦»çœŸæ­£çš„åŒºå—é“¾åº”ç”¨è¿˜æœ‰å¾ˆå¤šé‡è¦çš„ç‰¹æ€§æ²¡æœ‰å®ç°ã€‚ä»Šå¤©æˆ‘ä»¬æ¥å®ç°åŒºå—é“¾æ•°æ®çš„å­˜å‚¨æœºåˆ¶ï¼Œå°†æ¯æ¬¡ç”Ÿæˆçš„åŒºå—é“¾æ•°æ®ä¿å­˜ä¸‹æ¥ã€‚æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼ŒåŒºå—é“¾æœ¬è´¨ä¸Šæ˜¯ä¸€æ¬¾åˆ†å¸ƒå¼çš„æ•°æ®åº“ï¼Œæˆ‘ä»¬è¿™é‡Œä¸å®ç°â€åˆ†å¸ƒå¼â€ï¼Œåªèšç„¦äºæ•°æ®å­˜å‚¨éƒ¨åˆ†ã€‚</p><a id="more"></a><h2 id="æ•°æ®åº“é€‰æ‹©"><a href="#æ•°æ®åº“é€‰æ‹©" class="headerlink" title="æ•°æ®åº“é€‰æ‹©"></a>æ•°æ®åº“é€‰æ‹©</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„å®ç°æœºåˆ¶ä¸­è¿˜æ²¡æœ‰åŒºå—å­˜å‚¨è¿™ä¸€ç¯èŠ‚ï¼Œå¯¼è‡´æˆ‘ä»¬çš„åŒºå—æ¯æ¬¡ç”Ÿæˆä¹‹åéƒ½ä¿å­˜åœ¨äº†å†…å­˜ä¸­ã€‚è¿™æ ·ä¸ä¾¿äºæˆ‘ä»¬é‡æ–°ä½¿ç”¨åŒºå—é“¾ï¼Œæ¯æ¬¡éƒ½è¦ä»å¤´å¼€å§‹ç”ŸæˆåŒºå—ï¼Œä¹Ÿä¸èƒ½å¤Ÿè·Ÿä»–äººå…±äº«æˆ‘ä»¬çš„åŒºå—é“¾ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶å­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚</p><p>æˆ‘ä»¬è¯¥é€‰æ‹©å“ªä¸€æ¬¾æ•°æ®åº“å‘¢ï¼Ÿäº‹å®ä¸Šï¼Œåœ¨ã€Š<a href="https://github.com/wangweiX/blockchain-explore/tree/master/white-paper/0000-bitcoin" target="_blank" rel="noopener">æ¯”ç‰¹å¸ç™½çš®ä¹¦</a>ã€‹ä¸­å¹¶æ²¡æœ‰æ˜ç¡®æŒ‡å®šä½¿ç”¨å“ªä¸€ç§çš„æ•°æ®åº“ï¼Œå› æ­¤è¿™ä¸ªç”±å¼€å‘äººå‘˜è‡ªå·±å†³å®šã€‚<a href="https://zh.wikipedia.org/wiki/%E4%B8%AD%E6%9C%AC%E8%81%AA" target="_blank" rel="noopener">ä¸­æœ¬èª</a> å¼€å‘çš„ <a href="https://github.com/bitcoin/bitcoin" target="_blank" rel="noopener">Bitcoin Core</a> ä¸­ä½¿ç”¨çš„æ˜¯<a href="https://github.com/google/leveldb" target="_blank" rel="noopener">LevelDB</a>ã€‚åŸæ–‡ <a href="https://jeiwan.cc/posts/building-blockchain-in-go-part-3/" target="_blank" rel="noopener">Building Blockchain in Go. Part 3: Persistence and CLI</a> ä¸­ä½¿ç”¨çš„æ˜¯ <a href="https://github.com/boltdb/bolt" target="_blank" rel="noopener">BoltDB</a> ï¼Œå¯¹Goè¯­è¨€æ”¯æŒæ¯”è¾ƒå¥½ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„æ˜¯Javaæ¥å®ç°ï¼ŒBoltDBä¸æ”¯æŒJavaï¼Œè¿™é‡Œæˆ‘ä»¬é€‰ç”¨ <a href="https://github.com/facebook/rocksdb" target="_blank" rel="noopener">Rocksdb</a> ã€‚</p><blockquote><p>å½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹© LevelDBï¼Œéå¸¸ä¸é”™çš„LevelDBä»‹ç»æ–‡ç« ï¼š<a href="https://mp.weixin.qq.com/s/rN6HX2VzsRi3_EKXYKuJAA" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/rN6HX2VzsRi3_EKXYKuJAA</a></p><p>RocksDBæ˜¯ç”±Facebookæ•°æ®åº“å·¥ç¨‹å›¢é˜Ÿå¼€å‘å’Œç»´æŠ¤çš„ä¸€æ¬¾key-valueå­˜å‚¨å¼•æ“ï¼Œæ¯”LevelDBæ€§èƒ½æ›´åŠ å¼ºå¤§ï¼Œæœ‰å…³Rocksdbçš„è¯¦ç»†ä»‹ç»ï¼Œè¯·ç§»æ­¥è‡³å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://github.com/facebook/rocksdb" target="_blank" rel="noopener">https://github.com/facebook/rocksdb</a> ï¼Œè¿™é‡Œä¸å¤šåšä»‹ç»ã€‚</p></blockquote><h2 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h2><p>åœ¨æˆ‘ä»¬å¼€å§‹å®ç°æ•°æ®æŒä¹…åŒ–ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè¦ç¡®å®šæˆ‘ä»¬è¯¥å¦‚ä½•å»å­˜å‚¨æˆ‘ä»¬çš„æ•°æ®ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ¯”ç‰¹å¸æ˜¯æ€ä¹ˆåšçš„ã€‚</p><p>ç®€å•æ¥è®²ï¼Œæ¯”ç‰¹å¸ä½¿ç”¨äº†ä¸¤ä¸ªâ€buckets(æ¡¶)â€æ¥å­˜å‚¨æ•°æ®ï¼š</p><ul><li><strong>blocks</strong>. æè¿°é“¾ä¸Šæ‰€æœ‰åŒºå—çš„å…ƒæ•°æ®.</li><li><strong>chainstate</strong>. å­˜å‚¨åŒºå—é“¾çš„çŠ¶æ€ï¼ŒæŒ‡çš„æ˜¯å½“å‰æ‰€æœ‰çš„<code>UTXO</code>ï¼ˆæœªèŠ±è´¹äº¤æ˜“è¾“å‡ºï¼‰ä»¥åŠä¸€äº›å…ƒæ•°æ®.</li></ul><blockquote><p>â€œåœ¨æ¯”ç‰¹å¸çš„ä¸–ç•Œé‡Œæ—¢æ²¡æœ‰è´¦æˆ·ï¼Œä¹Ÿæ²¡æœ‰ä½™é¢ï¼Œåªæœ‰åˆ†æ•£åˆ°åŒºå—é“¾é‡Œçš„UTXOã€‚â€</p><p>è¯¦è§ï¼š<a href="https://github.com/bitcoinbook/bitcoinbook/blob/develop/ch06.asciidoc#transaction-outputs-and-inputs" target="_blank" rel="noopener">ã€Šç²¾é€šæ¯”ç‰¹å¸ã€‹ç¬¬äºŒç‰ˆ ç¬¬06ç« èŠ‚ â€”â€” äº¤æ˜“çš„è¾“å…¥ä¸è¾“å‡º</a></p></blockquote><p>æ­¤å¤–ï¼Œæ¯ä¸ªåŒºå—æ•°æ®éƒ½æ˜¯ä»¥å•ç‹¬çš„æ–‡ä»¶å½¢å¼å­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚è¿™æ ·åšæ˜¯å‡ºäºæ€§èƒ½çš„è€ƒè™‘ï¼šå½“è¯»å–æŸä¸€ä¸ªå•ç‹¬çš„åŒºå—æ•°æ®æ—¶ï¼Œä¸éœ€è¦åŠ è½½æ‰€æœ‰çš„åŒºå—æ•°æ®åˆ°å†…å­˜ä¸­æ¥ã€‚</p><p>åœ¨ <code>blocks</code> è¿™ä¸ªæ¡¶ä¸­ï¼Œå­˜å‚¨çš„é”®å€¼å¯¹ï¼š</p><ul><li><p>â€˜bâ€™ + 32-byte block hash -&gt; block index record</p><blockquote><p>åŒºå—çš„ç´¢å¼•è®°å½•</p></blockquote></li><li><p>â€˜fâ€™ + 4-byte file number -&gt; file information record</p><blockquote><p>æ–‡ä»¶ä¿¡æ¯è®°å½•</p></blockquote></li><li><p>â€˜lâ€™ -&gt; 4-byte file number: the last block file number used</p><blockquote><p>æœ€æ–°çš„ä¸€ä¸ªåŒºå—æ‰€ä½¿ç”¨çš„æ–‡ä»¶ç¼–ç </p></blockquote></li><li><p>â€˜Râ€™ -&gt; 1-byte boolean: whether weâ€™re in the process of reindexing</p><blockquote><p>æ˜¯å¦å¤„äºé‡å»ºç´¢å¼•çš„è¿›ç¨‹å½“ä¸­</p></blockquote></li><li><p>â€˜Fâ€™ + 1-byte flag name length + flag name string -&gt; 1 byte boolean: various flags that can be on or off</p><blockquote><p>å„ç§å¯ä»¥æ‰“å¼€æˆ–å…³é—­çš„flagæ ‡å¿—</p></blockquote></li><li><p>â€˜tâ€™ + 32-byte transaction hash -&gt; transaction index record</p><blockquote><p>äº¤æ˜“ç´¢å¼•è®°å½•</p></blockquote></li></ul><p>åœ¨ <code>chainstate</code> è¿™ä¸ªæ¡¶ä¸­ï¼Œå­˜å‚¨çš„é”®å€¼å¯¹ï¼š</p><ul><li><p>â€˜câ€™ + 32-byte transaction hash -&gt; unspent transaction output record for that transaction</p><blockquote><p>æŸç¬”äº¤æ˜“çš„UTXOè®°å½•</p></blockquote></li></ul><ul><li><p>â€˜Bâ€™ -&gt; 32-byte block hash: the block hash up to which the database represents the unspent transaction outputs</p><blockquote><p>æ•°æ®åº“æ‰€è¡¨ç¤ºçš„UTXOçš„åŒºå—Hashï¼ˆæŠ±æ­‰ï¼Œè¿™ä¸€ç‚¹æˆ‘è¿˜æ²¡å¼„æ˜ç™½â€¦â€¦ï¼‰</p></blockquote></li></ul><p>ç”±äºæˆ‘ä»¬è¿˜æ²¡æœ‰å®ç°äº¤æ˜“ç›¸å…³çš„ç‰¹æ€§ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬è¿™é‡Œåªä½¿ç”¨ <code>block</code> æ¡¶ã€‚å¦å¤–ï¼Œå‰é¢æåˆ°è¿‡çš„ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸ä¼šå®ç°å„ä¸ªåŒºå—æ•°æ®å„è‡ªå­˜å‚¨åœ¨ç‹¬ç«‹çš„æ–‡ä»¶ä¸Šï¼Œè€Œæ˜¯ç»Ÿä¸€å­˜æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œé¢ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸è¦å­˜å‚¨å’Œæ–‡ä»¶ç¼–ç ç›¸å…³çš„æ•°æ®ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬æ‰€ç”¨åˆ°çš„é”®å€¼å¯¹å°±ç®€åŒ–ä¸ºï¼š</p><ul><li><p>32-byte block-hash -&gt; Block structure (serialized)</p><blockquote><p>åŒºå—æ•°æ®ä¸åŒºå—hashçš„é”®å€¼å¯¹</p></blockquote></li><li><p>â€˜lâ€™ -&gt; the hash of the last block in a chain</p><blockquote><p>æœ€æ–°ä¸€ä¸ªåŒºå—hashçš„é”®å€¼å¯¹</p></blockquote></li></ul><p>(<a href="https://en.bitcoin.it/wiki/Bitcoin_Core_0.11_(ch_2" target="_blank" rel="noopener">æŸ¥çœ‹æ›´åŠ è¯¦ç»†çš„è§£é‡Š</a>:_Data_Storage))</p><h2 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h2><p>RocksDBçš„Keyä¸Valueåªèƒ½ä»¥byte[]çš„å½¢å¼è¿›è¡Œå­˜å‚¨ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°åºåˆ—åŒ–ä¸ååºåˆ—åŒ–åº“ <a href="https://github.com/EsotericSoftware/kryo" target="_blank" rel="noopener">Kryo</a>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.blockchain.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.esotericsoftware.kryo.Kryo;</span><br><span class="line"><span class="keyword">import</span> com.esotericsoftware.kryo.io.Input;</span><br><span class="line"><span class="keyword">import</span> com.esotericsoftware.kryo.io.Output;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åºåˆ—åŒ–å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/02/07</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SerializeUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ååºåˆ—åŒ–</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bytes å¯¹è±¡å¯¹åº”çš„å­—èŠ‚æ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">deserialize</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> </span>&#123;</span><br><span class="line">        Input input = <span class="keyword">new</span> Input(bytes);</span><br><span class="line">        Object obj = <span class="keyword">new</span> Kryo().readClassAndObject(input);</span><br><span class="line">        input.close();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åºåˆ—åŒ–</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> object éœ€è¦åºåˆ—åŒ–çš„å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] serialize(Object object) &#123;</span><br><span class="line">        Output output = <span class="keyword">new</span> Output(<span class="number">4096</span>, -<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">new</span> Kryo().writeClassAndObject(output, object);</span><br><span class="line">        <span class="keyword">byte</span>[] bytes = output.toBytes();</span><br><span class="line">        output.close();</span><br><span class="line">        <span class="keyword">return</span> bytes;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æŒä¹…åŒ–"><a href="#æŒä¹…åŒ–" class="headerlink" title="æŒä¹…åŒ–"></a>æŒä¹…åŒ–</h2><p>ä¸Šé¢å·²ç»è¯´è¿‡ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨<code>RocksDB</code>ï¼Œæˆ‘ä»¬å…ˆå†™ä¸€ä¸ªç›¸å…³çš„å·¥å…·ç±»<code>RocksDBUtils</code>ï¼Œä¸»è¦çš„åŠŸèƒ½å¦‚ä¸‹ï¼š</p><ul><li>putLastBlockHashï¼šä¿å­˜æœ€æ–°ä¸€ä¸ªåŒºå—çš„Hashå€¼</li><li>getLastBlockHashï¼šæŸ¥è¯¢æœ€æ–°ä¸€ä¸ªåŒºå—çš„Hashå€¼</li><li>putBlockï¼šä¿å­˜åŒºå—</li><li>getBlockï¼šæŸ¥è¯¢åŒºå—</li></ul><blockquote><p>æ³¨æ„ï¼šBoltDB æ”¯æŒ Bucket çš„ç‰¹æ€§ï¼Œè€ŒRocksDB ä¸æ”¯æŒï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬è‡ªå·±ä½¿ç”¨Mapæ¥åšä¸€ä¸ªæ˜ å°„ã€‚</p></blockquote><h3 id="RocksDBUtils"><a href="#RocksDBUtils" class="headerlink" title="RocksDBUtils"></a>RocksDBUtils</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.blockchain.store;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.Maps;</span><br><span class="line"><span class="keyword">import</span> one.wangwei.blockchain.block.Block;</span><br><span class="line"><span class="keyword">import</span> one.wangwei.blockchain.util.SerializeUtils;</span><br><span class="line"><span class="keyword">import</span> org.rocksdb.RocksDB;</span><br><span class="line"><span class="keyword">import</span> org.rocksdb.RocksDBException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å­˜å‚¨å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/02/27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RocksDBUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŒºå—é“¾æ•°æ®æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DB_FILE = <span class="string">"blockchain.db"</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŒºå—æ¡¶å‰ç¼€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String BLOCKS_BUCKET_KEY = <span class="string">"blocks"</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æœ€æ–°ä¸€ä¸ªåŒºå—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String LAST_BLOCK_KEY = <span class="string">"l"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> RocksDBUtils instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RocksDBUtils <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (RocksDBUtils.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> RocksDBUtils();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RocksDB db;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * block buckets</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, <span class="keyword">byte</span>[]&gt; blocksBucket;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">RocksDBUtils</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        openDB();</span><br><span class="line">        initBlockBucket();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰“å¼€æ•°æ®åº“</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">openDB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            db = RocksDB.open(DB_FILE);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RocksDBException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Fail to open db ! "</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ– blocks æ•°æ®æ¡¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initBlockBucket</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] blockBucketKey = SerializeUtils.serialize(BLOCKS_BUCKET_KEY);</span><br><span class="line">            <span class="keyword">byte</span>[] blockBucketBytes = db.get(blockBucketKey);</span><br><span class="line">            <span class="keyword">if</span> (blockBucketBytes != <span class="keyword">null</span>) &#123;</span><br><span class="line">                blocksBucket = (Map) SerializeUtils.deserialize(blockBucketBytes);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                blocksBucket = Maps.newHashMap();</span><br><span class="line">                db.put(blockBucketKey, SerializeUtils.serialize(blocksBucket));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RocksDBException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Fail to init block bucket ! "</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿å­˜æœ€æ–°ä¸€ä¸ªåŒºå—çš„Hashå€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tipBlockHash</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">putLastBlockHash</span><span class="params">(String tipBlockHash)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            blocksBucket.put(LAST_BLOCK_KEY, SerializeUtils.serialize(tipBlockHash));</span><br><span class="line">            db.put(SerializeUtils.serialize(BLOCKS_BUCKET_KEY), SerializeUtils.serialize(blocksBucket));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RocksDBException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Fail to put last block hash ! "</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢æœ€æ–°ä¸€ä¸ªåŒºå—çš„Hashå€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getLastBlockHash</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] lastBlockHashBytes = blocksBucket.get(LAST_BLOCK_KEY);</span><br><span class="line">        <span class="keyword">if</span> (lastBlockHashBytes != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (String) SerializeUtils.deserialize(lastBlockHashBytes);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿å­˜åŒºå—</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> block</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">putBlock</span><span class="params">(Block block)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            blocksBucket.put(block.getHash(), SerializeUtils.serialize(block));</span><br><span class="line">            db.put(SerializeUtils.serialize(BLOCKS_BUCKET_KEY), SerializeUtils.serialize(blocksBucket));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RocksDBException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Fail to put block ! "</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢åŒºå—</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> blockHash</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Block <span class="title">getBlock</span><span class="params">(String blockHash)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Block) SerializeUtils.deserialize(blocksBucket.get(blockHash));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…³é—­æ•°æ®åº“</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">closeDB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            db.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Fail to close db ! "</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºåŒºå—é“¾"><a href="#åˆ›å»ºåŒºå—é“¾" class="headerlink" title="åˆ›å»ºåŒºå—é“¾"></a>åˆ›å»ºåŒºå—é“¾</h3><p>ç°åœ¨æˆ‘ä»¬æ¥ä¼˜åŒ– <code>Blockchain.newBlockchain</code> æ¥å£çš„ä»£ç é€»è¾‘ï¼Œæ”¹ä¸ºå¦‚ä¸‹é€»è¾‘ï¼š</p><p><img src="https://img.i7years.com/blog/blockchain_flow.jpg" alt=""></p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * &lt;p&gt; åˆ›å»ºåŒºå—é“¾ &lt;/p&gt;</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Blockchain <span class="title">newBlockchain</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    String lastBlockHash = RocksDBUtils.getInstance().getLastBlockHash();</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isBlank(lastBlockHash)) &#123;</span><br><span class="line">        Block genesisBlock = Block.newGenesisBlock();</span><br><span class="line">        lastBlockHash = genesisBlock.getHash();</span><br><span class="line">        RocksDBUtils.getInstance().putBlock(genesisBlock);</span><br><span class="line">        RocksDBUtils.getInstance().putLastBlockHash(lastBlockHash);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">new</span> Blockchain(lastBlockHash);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ <code>Blockchain</code> çš„æ•°æ®ç»“æ„ï¼Œåªè®°å½•æœ€æ–°ä¸€ä¸ªåŒºå—é“¾çš„Hashå€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Blockchain</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> String lastBlockHash;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Blockchain</span><span class="params">(String lastBlockHash)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lastBlockHash = lastBlockHash;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯æ¬¡æŒ–çŸ¿å®Œæˆåï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å°†æœ€æ–°çš„åŒºå—ä¿¡æ¯ä¿å­˜ä¸‹æ¥ï¼Œå¹¶ä¸”æ›´æ–°æœ€æ–°åŒºå—é“¾Hashå€¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; æ·»åŠ åŒºå—  &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addBlock</span><span class="params">(String data)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">   String lastBlockHash = RocksDBUtils.getInstance().getLastBlockHash();</span><br><span class="line">   <span class="keyword">if</span> (StringUtils.isBlank(lastBlockHash)) &#123;</span><br><span class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"Fail to add block into blockchain ! "</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">this</span>.addBlock(Block.newBlock(lastBlockHash, data));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; æ·»åŠ åŒºå—  &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> block</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addBlock</span><span class="params">(Block block)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    RocksDBUtils.getInstance().putLastBlockHash(block.getHash());</span><br><span class="line">    RocksDBUtils.getInstance().putBlock(block);</span><br><span class="line">    <span class="keyword">this</span>.lastBlockHash = block.getHash();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°æ­¤ï¼Œå­˜å‚¨éƒ¨åˆ†çš„åŠŸèƒ½å°±å®ç°å®Œæ¯•ï¼Œæˆ‘ä»¬è¿˜ç¼ºå°‘ä¸€ä¸ªåŠŸèƒ½ï¼š</p><h2 id="æ£€ç´¢åŒºå—é“¾"><a href="#æ£€ç´¢åŒºå—é“¾" class="headerlink" title="æ£€ç´¢åŒºå—é“¾"></a>æ£€ç´¢åŒºå—é“¾</h2><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„åŒºå—éƒ½ä¿å­˜åˆ°äº†æ•°æ®åº“ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬èƒ½å¤Ÿé‡æ–°æ‰“å¼€å·²æœ‰çš„åŒºå—é“¾å¹¶ä¸”å‘å…¶æ·»åŠ æ–°çš„åŒºå—ã€‚ä½†è¿™ä¹Ÿå¯¼è‡´æˆ‘ä»¬å†ä¹Ÿæ— æ³•æ‰“å°å‡ºåŒºå—é“¾ä¸­æ‰€æœ‰åŒºå—çš„ä¿¡æ¯ï¼Œå› ä¸ºï¼Œæˆ‘ä»¬æ²¡æœ‰å°†åŒºå—å­˜å‚¨åœ¨æ•°ç»„å½“ä¸­ã€‚è®©æˆ‘ä»¬æ¥ä¿®å¤è¿™ä¸ªç‘•ç–µï¼</p><p>æˆ‘ä»¬åœ¨Blockchainä¸­åˆ›å»ºä¸€ä¸ªå†…éƒ¨ç±» <code>BlockchainIterator</code> ï¼Œä½œä¸ºåŒºå—é“¾çš„è¿­ä»£å™¨ï¼Œé€šè¿‡åŒºå—ä¹‹å‰çš„hashè¿æ¥æ¥ä¾æ¬¡è¿­ä»£è¾“å‡ºåŒºå—ä¿¡æ¯ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Blockchain</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    ....</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŒºå—é“¾è¿­ä»£å™¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlockchainIterator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String currentBlockHash;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">BlockchainIterator</span><span class="params">(String currentBlockHash)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.currentBlockHash = currentBlockHash;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªåŒºå—</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hashNext</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isBlank(currentBlockHash)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Block lastBlock = RocksDBUtils.getInstance().getBlock(currentBlockHash);</span><br><span class="line">            <span class="keyword">if</span> (lastBlock == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// åˆ›ä¸–åŒºå—ç›´æ¥æ”¾è¡Œ</span></span><br><span class="line">            <span class="keyword">if</span> (lastBlock.getPrevBlockHash().length() == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> RocksDBUtils.getInstance().getBlock(lastBlock.getPrevBlockHash()) != <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * è¿”å›åŒºå—</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Block <span class="title">next</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            Block currentBlock = RocksDBUtils.getInstance().getBlock(currentBlockHash);</span><br><span class="line">            <span class="keyword">if</span> (currentBlock != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.currentBlockHash = currentBlock.getPrevBlockHash();</span><br><span class="line">                <span class="keyword">return</span> currentBlock;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">    </span><br><span class="line">    ....    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/02/05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlockchainTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Blockchain blockchain = Blockchain.newBlockchain();</span><br><span class="line"></span><br><span class="line">            blockchain.addBlock(<span class="string">"Send 1.0 BTC to wangwei"</span>);</span><br><span class="line">            blockchain.addBlock(<span class="string">"Send 2.5 more BTC to wangwei"</span>);</span><br><span class="line">            blockchain.addBlock(<span class="string">"Send 3.5 more BTC to wangwei"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (Blockchain.BlockchainIterator iterator = blockchain.getBlockchainIterator(); iterator.hashNext(); ) &#123;</span><br><span class="line">                Block block = iterator.next();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (block != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">boolean</span> validate = ProofOfWork.newProofOfWork(block).validate();</span><br><span class="line">                    System.out.println(block.toString() + <span class="string">", validate = "</span> + validate);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*è¾“å‡º*/</span></span><br><span class="line"></span><br><span class="line">Block&#123;hash=<span class="string">'0000012f87a0510dd0ee7048a6bd52db3002bae7d661126dc28287bd6c23189a'</span>, prevBlockHash=<span class="string">'0000024b2c23c4fb06c2e2c1349275d415efe17a51db24cd4883da0067300ddf'</span>, data=<span class="string">'Send 3.5 more BTC to wangwei'</span>, timeStamp=<span class="number">1519724875</span>, nonce=<span class="number">369110</span>&#125;, validate = <span class="keyword">true</span></span><br><span class="line">Block&#123;hash=<span class="string">'0000024b2c23c4fb06c2e2c1349275d415efe17a51db24cd4883da0067300ddf'</span>, prevBlockHash=<span class="string">'00000b14fefb51ba2a7428549d469bcf3efae338315e7289d3e6dc4caf589d79'</span>, data=<span class="string">'Send 2.5 more BTC to wangwei'</span>, timeStamp=<span class="number">1519724872</span>, nonce=<span class="number">896348</span>&#125;, validate = <span class="keyword">true</span></span><br><span class="line">Block&#123;hash=<span class="string">'00000b14fefb51ba2a7428549d469bcf3efae338315e7289d3e6dc4caf589d79'</span>, prevBlockHash=<span class="string">'0000099ced1b02f40c750c5468bb8c4fd800ec9f46fea5d8b033e5d054f0f703'</span>, data=<span class="string">'Send 1.0 BTC to wangwei'</span>, timeStamp=<span class="number">1519724869</span>, nonce=<span class="number">673955</span>&#125;, validate = <span class="keyword">true</span></span><br><span class="line">Block&#123;hash=<span class="string">'0000099ced1b02f40c750c5468bb8c4fd800ec9f46fea5d8b033e5d054f0f703'</span>, prevBlockHash=<span class="string">''</span>, data=<span class="string">'Genesis Block'</span>, timeStamp=<span class="number">1519724866</span>, nonce=<span class="number">840247</span>&#125;, validate = <span class="keyword">true</span></span><br></pre></td></tr></table></figure><h2 id="å‘½ä»¤è¡Œç•Œé¢"><a href="#å‘½ä»¤è¡Œç•Œé¢" class="headerlink" title="å‘½ä»¤è¡Œç•Œé¢"></a>å‘½ä»¤è¡Œç•Œé¢</h2><p><code>CLI</code> éƒ¨åˆ†çš„å†…å®¹ï¼Œè¿™é‡Œä¸åšè¯¦ç»†ä»‹ç»ï¼Œå…·ä½“å¯ä»¥å»æŸ¥çœ‹æ–‡æœ«çš„Githubæºç é“¾æ¥ã€‚å¤§è‡´æ­¥éª¤å¦‚ä¸‹ï¼š</p><h5 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h5><p>æ·»åŠ pom.xmlé…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-cli<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-cli<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">	<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">archive</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">addClasspath</span>&gt;</span>true<span class="tag">&lt;/<span class="name">addClasspath</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">classpathPrefix</span>&gt;</span>lib/<span class="tag">&lt;/<span class="name">classpathPrefix</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>one.wangwei.blockchain.cli.Main<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">descriptorRef</span>&gt;</span>jar-with-dependencies<span class="tag">&lt;/<span class="name">descriptorRef</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">id</span>&gt;</span>make-assembly<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- this is used for inheritance merges --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- æŒ‡å®šåœ¨æ‰“åŒ…èŠ‚ç‚¹æ‰§è¡ŒjaråŒ…åˆå¹¶æ“ä½œ --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">goal</span>&gt;</span>single<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">   </span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ·»åŠ shellè„šæœ¬ <code>blockchain.sh</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>!/bin/bash</span><br><span class="line"></span><br><span class="line">set -e</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> Check if the jar has been built.</span><br><span class="line">if [ ! -e target/blockchain-java-jar-with-dependencies.jar ]; then</span><br><span class="line">  echo "Compiling blockchain project to a JAR"</span><br><span class="line">  mvn package -DskipTests</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">java -jar target/blockchain-java-jar-with-dependencies.jar "$@"</span><br></pre></td></tr></table></figure><h5 id="æ‰§è¡Œå‘½ä»¤"><a href="#æ‰§è¡Œå‘½ä»¤" class="headerlink" title="æ‰§è¡Œå‘½ä»¤"></a>æ‰§è¡Œå‘½ä»¤</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥å·¥ç¨‹æ ¹è·¯åŠ²</span></span><br><span class="line">$ cd blockchain-java</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°å¸®åŠ©ä¿¡æ¯</span></span><br><span class="line">$ ./blockchain.sh -h </span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ åŒºå—</span></span><br><span class="line">$ ./blockchain.sh -add <span class="string">"Send 1.5 BTC to wangwei"</span></span><br><span class="line">$ ./blockchain.sh -add <span class="string">"Send 2.5 BTC to wangwei"</span></span><br><span class="line">$ ./blockchain.sh -add <span class="string">"Send 3.5 BTC to wangwei"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°åŒºå—é“¾</span></span><br><span class="line">$ ./blockchain.sh -print</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬ç¯‡æˆ‘ä»¬å®ç°äº†åŒºå—é“¾çš„å­˜å‚¨åŠŸèƒ½ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†å®ç°åœ°å€ã€äº¤æ˜“ã€é’±åŒ…è¿™ä¸€äº›åˆ—çš„åŠŸèƒ½ã€‚</p><h2 id="èµ„æ–™"><a href="#èµ„æ–™" class="headerlink" title="èµ„æ–™"></a>èµ„æ–™</h2><ul><li>æºä»£ç ï¼š<a href="https://github.com/wangweiX/blockchain-java/tree/part3-persistence" target="_blank" rel="noopener">https://github.com/wangweiX/blockchain-java/tree/part3-persistence</a></li><li><a href="https://jeiwan.cc/posts/building-blockchain-in-go-part-3/" target="_blank" rel="noopener">https://jeiwan.cc/posts/building-blockchain-in-go-part-3/</a></li><li><a href="https://github.com/bitcoinbook/bitcoinbook" target="_blank" rel="noopener">ã€Šç²¾é€šæ¯”ç‰¹å¸ã€‹ç¬¬äºŒç‰ˆ</a></li></ul><p><img src="https://img.i7years.com/blog/blockchain_exploer.png" alt=""></p><blockquote><p><a href="https://press.one/file/v?s=62076a14b3d0693cf88d19db7e2d6a5a8e05b3de0c77deee242615c5480f8818104c24b65500a8cac096dee3b2e6862cec266916ee6545dd38f3650a459c7b221&amp;h=7732ed4bedb1bb10a4d24df75b719ac2d56ae76a1b5a8f06ccc2ca6dc2d3ce30&amp;a=23fe9bfd7ceef4b44c2ce44dcac8e4a49caf8026&amp;f=P1&amp;v=2" target="_blank" rel="noopener">https://press.one/file/v?s=62076a14b3d0693cf88d19db7e2d6a5a8e05b3de0c77deee242615c5480f8818104c24b65500a8cac096dee3b2e6862cec266916ee6545dd38f3650a459c7b221&amp;h=7732ed4bedb1bb10a4d24df75b719ac2d56ae76a1b5a8f06ccc2ca6dc2d3ce30&amp;a=23fe9bfd7ceef4b44c2ce44dcac8e4a49caf8026&amp;f=P1&amp;v=2</a></p></blockquote>]]></content>
      
        <categories>
            
            <category> blockchain </category>
            
        </categories>
        
        
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> bitcoin </tag>
            
            <tag> RocksDB </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[åŸºäºJavaè¯­è¨€æ„å»ºåŒºå—é“¾ï¼ˆäºŒï¼‰â€”â€” å·¥ä½œé‡è¯æ˜]]></title>
      <url>/posts/build-blockchain-in-java-proof-of-work.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/bitcoin-miner.webp?imageslim" alt=""></p><blockquote><p>æ–‡ç« çš„ä¸»è¦æ€æƒ³å’Œå†…å®¹å‡æ¥è‡ª <a href="https://jeiwan.cc/posts/building-blockchain-in-go-part-2/" target="_blank" rel="noopener">https://jeiwan.cc/posts/building-blockchain-in-go-part-2/</a></p></blockquote><h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>åœ¨ <a href="https://wangwei.one/posts/df195d9.html">ä¸Šä¸€ç¯‡</a> æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å®ç°äº†åŒºå—é“¾æœ€åŸºæœ¬çš„æ•°æ®ç»“æ„æ¨¡å‹ï¼Œæ·»åŠ åŒºå—ä»¥åŠå’Œå‰ä¸€ä¸ªåŒºå—è¿æ¥åœ¨ä¸€èµ·ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬çš„å®ç°æ–¹å¼éå¸¸ç®€å•ï¼Œè€ŒçœŸå®çš„æ¯”ç‰¹å¸åŒºå—é“¾ä¸­ï¼Œæ¯ä¸€ä¸ªåŒºå—çš„æ·»åŠ éƒ½æ˜¯éœ€è¦ç»è¿‡å¤§é‡çš„è®¡ç®—æ‰å¯ä»¥å®Œæˆï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„<code>æŒ–çŸ¿</code>ã€‚</p><a id="more"></a><h2 id="å·¥ä½œé‡è¯æ˜æœºåˆ¶"><a href="#å·¥ä½œé‡è¯æ˜æœºåˆ¶" class="headerlink" title="å·¥ä½œé‡è¯æ˜æœºåˆ¶"></a>å·¥ä½œé‡è¯æ˜æœºåˆ¶</h2><p>åŒºå—é“¾æœ€å…³é”®çš„ä¸€ä¸ªæ€æƒ³å°±æ˜¯ï¼Œå¿…é¡»è¿›è¡Œå¤§é‡ä¸”å›°éš¾çš„è®¡ç®—å·¥ä½œæ‰èƒ½å°†äº¤æ˜“æ•°æ®å­˜æ”¾åˆ°åŒºå—é“¾ä¸Šã€‚è¿™ç§å·¥ä½œæœºåˆ¶æ‰èƒ½ä¿è¯æ•´ä¸ªåŒºå—é“¾æ•°æ®çš„å®‰å…¨æ€§å’Œä¸€è‡´æ€§ã€‚åŒæ—¶ï¼Œå®Œæˆè¿™ä¸ªè®¡ç®—å·¥ä½œçš„çŸ¿å·¥ä¼šå¾—åˆ°ç›¸åº”çš„Tokenå¥–åŠ±ã€‚</p><p>è¿™å¥—æœºåˆ¶å’Œæˆ‘ä»¬çš„ç°å®ç”Ÿæ´»éå¸¸ç›¸ä¼¼ï¼šæˆ‘ä»¬å¿…é¡»åŠªåŠ›å·¥ä½œæ¥èµšå–æŠ¥é…¬ç”¨ä»¥ç»´æŒæˆ‘ä»¬çš„ç”Ÿæ´»ã€‚åœ¨åŒºå—é“¾ä¸­ï¼Œç½‘ç»œä¸­çš„çŸ¿å·¥ä»¬åŠªåŠ›å·¥ä½œæ¥ç»´æŒåŒºå—é“¾ç½‘ç»œï¼Œä¸ºå…¶æ·»åŠ åŒºå—ï¼Œå¹¶ä¸”è·å¾—ä¸€å®šçš„Tokenå¥–åŠ±ã€‚ä½œä¸ºä»–ä»¬å·¥ä½œçš„æˆæœï¼Œä¸€ä¸ªåŒºå—ä»¥å®‰å…¨çš„æ–¹å¼è¢«ç»„åˆè¿›äº†åŒºå—é“¾ä¸­ï¼Œè¿™æ ·å°±ä¿è¯äº†æ•´ä¸ªåŒºå—é“¾æ•°æ®åº“çš„ç¨³å®šæ€§ã€‚è¿˜æœ‰ä¸€ä¸ªå¿…é¡»è¦æ³¨æ„çš„æ˜¯ï¼ŒæŸä¸ªçŸ¿å·¥å®Œæˆäº†è®¡ç®—å·¥ä½œçš„ç»“æœï¼Œè¿˜å¿…é¡»å¾—åˆ°å…¶ä»–æ‰€æœ‰çŸ¿å·¥çš„è®¤åŒï¼ˆè¯æ˜æ˜¯æ­£ç¡®çš„ï¼‰ï¼Œè¿™æ ·æ‰ç®—å®Œæˆã€‚</p><p>è¿™ä¸€æ•´å¥—çš„è®¡ç®—å’Œè¯æ˜æœºåˆ¶ï¼Œå°±ç§°ä¸º<strong>Proof-of-Workï¼ˆå·¥ä½œé‡è¯æ˜ï¼‰</strong>ã€‚è®¡ç®—å·¥ä½œæ˜¯éå¸¸éå¸¸å›°éš¾çš„ï¼Œå› ä¸ºå®ƒéœ€è¦æ¶ˆè€—å¤§é‡çš„è®¡ç®—æœºç®—åŠ›èµ„æºï¼Œå³ä½¿æ˜¯æ€§èƒ½éå¸¸é«˜çš„è®¡ç®—æœºéƒ½ä¸èƒ½éå¸¸å¿«åœ°è®¡ç®—å‡ºæ­£ç¡®çš„ç»“æœã€‚æ­¤å¤–ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¿™é¡¹è®¡ç®—å·¥ä½œçš„éš¾åº¦ä¹Ÿä¼šéšä¹‹å¢åŠ ï¼Œç›®çš„æ˜¯ä¸ºäº†ä¿è¯æ¯å°æ—¶6ä¸ªæ–°åŒºå—çš„å‡ºå—ç‡ã€‚åœ¨æ¯”ç‰¹å¸ä¸­ï¼Œè¿™ç§å·¥ä½œçš„ç›®æ ‡æ˜¯æ‰¾åˆ°æ»¡è¶³æŸä¸ªç‰¹å®šè¦æ±‚çš„åŒºå—Hashï¼ˆå“ˆå¸Œå€¼ï¼‰ã€‚è¿™ä¸ªåŒºå—å“ˆå¸Œå€¼å°±æ˜¯å·¥ä½œç»“æœçš„ä¸€ä¸ªè¯æ˜ã€‚å› æ­¤ï¼Œè®¡ç®—å·¥ä½œçš„ç›®çš„å°±æ˜¯ä¸ºäº†å¯»æ‰¾åˆ°è¿™ä¸ªè¯æ˜å€¼ã€‚</p><p>æœ€åè¦æ³¨æ„çš„æ˜¯ï¼Œè®¡ç®—å‡ºè¿™ä¸ªç‰¹å®šçš„Hashï¼ˆå“ˆå¸Œå€¼ï¼‰æ˜¯éå¸¸å›°éš¾çš„ï¼Œä½†æ˜¯åˆ«äººæ¥éªŒè¯è¿™ä¸ªHashå€¼æ˜¯å¦æ­£ç¡®çš„æ—¶å€™ï¼Œæ˜¯éå¸¸ç®€å•çš„ï¼Œä¸€ä¸‹å­å°±èƒ½å®Œæˆã€‚</p><h2 id="Hashing"><a href="#Hashing" class="headerlink" title="Hashing"></a>Hashing</h2><blockquote><p>Hashï¼šå“ˆå¸Œ | æ•£åˆ—</p></blockquote><p>æˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹<strong>Hashingï¼ˆå“ˆå¸Œï¼‰</strong>ï¼Œå¯¹è¿™ä¸€å—éå¸¸ç†Ÿæ‚‰çš„æœ‹å‹å¯ä»¥ç›´æ¥è·³è¿‡è¿™ä¸€æ®µå†…å®¹ã€‚</p><p>å“ˆå¸Œæ˜¯ä¸€ç§è®¡ç®—æœºç®—æ³•ï¼Œè¯¥ç®—æ³•èƒ½å¤Ÿè®¡ç®—å‡ºä»»æ„å¤§å°æ•°æ®çš„å“ˆå¸Œå€¼ï¼Œå¹¶ä¸”è¿™ä¸ªå“ˆå¸Œå€¼çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œ256bitã€‚è¿™ä¸ªè¢«è®¡ç®—å‡ºæ¥çš„å“ˆå¸Œå€¼èƒ½å¤Ÿä½œä¸ºè¿™ä¸ªæ•°æ®çš„<strong>å”¯ä¸€</strong>ä»£è¡¨ã€‚å“ˆå¸Œç®—æ³•æœ‰å‡ ä¸ªå…³é”®çš„ç‰¹æ€§ï¼š</p><blockquote><ul><li><strong>ä¸å¯é€†æ€§</strong>ã€‚ä¸èƒ½æ ¹æ®ä¸€ä¸ªå“ˆå¸Œå€¼æ¨å¯¼å‡ºåŸå§‹æ•°æ®ã€‚æ‰€ä»¥ï¼Œå“ˆå¸Œä¸æ˜¯åŠ å¯†ã€‚</li><li><strong>å”¯ä¸€æ€§</strong>ã€‚æ¯ä¸ªæ•°æ®æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå”¯ä¸€çš„å“ˆå¸Œå€¼ã€‚</li><li><strong>è¿¥å¼‚æ€§</strong>ã€‚åŸå§‹æ•°æ®ä¸€ä¸ç‚¹çš„å˜åŒ–éƒ½å°†å¾—åˆ°å®Œå…¨ä¸ä¸€æ ·çš„å“ˆå¸Œå€¼ã€‚</li></ul></blockquote><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SHA256(&quot;wangwei1&quot;) â€”â€”&gt; 1e898b7c9adaad86c20139a302ccd5277f81040cab68dc2aecfc684773532652</span><br><span class="line">SHA256(&quot;wangwei2&quot;) â€”â€”&gt; c9cc7417c17318c8aab448cc8ace24c53b6dcf350f5c5fd8e91cbc3b011a179d</span><br></pre></td></tr></table></figure><p>å“ˆå¸Œç®—æ³•è¢«å¹¿æ³›ç”¨äºéªŒè¯æ–‡ä»¶çš„ä¸€è‡´æ€§ä¸Šã€‚æ¯”å¦‚è½¯ä»¶æä¾›å•†é€šå¸¸ä¼šåœ¨å®‰è£…åŒ…ä¸Šé™„åŠ ä¸€ä¸ªæ£€éªŒç ï¼ˆchecksumsï¼‰ï¼Œå½“æˆ‘ä»¬ä¸‹è½½å®Œä¸€ä¸ªè½¯ä»¶å®‰è£…åŒ…åï¼Œå¯ä»¥ç”¨å“ˆå¸Œå‡½æ•°è®¡ç®—ä¸€ä¸‹è¿™ä¸ªè½¯ä»¶å®‰è£…åŒ…çš„å“ˆå¸Œå€¼ï¼Œç„¶åå†å’Œè½¯ä»¶å®‰è£…åŒ…çš„æ£€éªŒç åšä¸ªå¯¹æ¯”ï¼Œå°±å¯ä»¥çŸ¥é“ä¸‹è½½çš„å®‰è£…åŒ…æ˜¯å¦å®Œæ•´ã€æ˜¯å¦æœ‰æ•°æ®ä¸¢å¤±ã€‚</p><p>åœ¨åŒºå—é“¾ä¸­ï¼Œå“ˆå¸Œå€¼ç”¨äºä¿è¯åŒºå—çš„ä¸€è‡´æ€§ã€‚æ¯ä¸€ä¸ªåŒºå—è¢«ç”¨äºè¿›è¡Œå“ˆå¸Œè®¡ç®—çš„æ•°æ®ï¼Œéƒ½åŒ…å«å‰ä¸€ä¸ªåŒºå—é“¾çš„å“ˆå¸Œå€¼ï¼Œå› æ­¤ä»»ä½•äººæƒ³è¦ä¿®æ”¹åŒºå—çš„æ•°æ®å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ï¼Œä»–å¿…é¡»è¦æŠŠæ•´ä¸ªåŒºå—é“¾ä¸­ä»åˆ›ä¸–åŒºå—åˆ°æœ€æ–°çš„åŒºå—çš„æ‰€æœ‰å“ˆå¸Œå€¼å…¨éƒ¨é‡æ–°è®¡ç®—ä¸€éã€‚</p><blockquote><p>ä½ å¯ä»¥è„‘è¡¥ä¸€ä¸‹è¿™ä¸ªå·¥ä½œé‡æœ‰å¤šå¤§ï¼ŒæŒ‰ç…§ç›®å‰è®¡ç®—æœºçš„ç®—åŠ›æ¥çœ‹ï¼Œå‡ ä¹ä¸å¯èƒ½</p></blockquote><h2 id="Hashcash"><a href="#Hashcash" class="headerlink" title="Hashcash"></a>Hashcash</h2><p>æ¯”ç‰¹å¸çš„å·¥ä½œé‡è¯æ˜æ˜¯ä½¿ç”¨çš„æ˜¯<a href="https://en.wikipedia.org/wiki/Hashcash" target="_blank" rel="noopener">Hashcash</a>ç®—æ³•ï¼Œä¸€ç§æœ€åˆè¢«ç”¨äºååƒåœ¾é‚®ä»¶çš„ç®—æ³•ï¼Œå®ƒå¯ä»¥è¢«æ‹†è§£ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p><ol><li>è·å–æŸç§å…¬å¼€å¯çŸ¥çš„æ•°æ®dataï¼ˆåœ¨é‚®ä»¶æ¡ˆä¾‹ä¸­ï¼ŒæŒ‡çš„æ˜¯æ”¶ä»¶äººé‚®ä»¶åœ°å€ï¼›æ¯”ç‰¹å¸æ¡ˆä¾‹ä¸­ï¼ŒæŒ‡çš„æ˜¯åŒºå—å¤´ï¼‰</li><li>æ·»åŠ ä¸€ä¸ªè®¡æ•°å™¨counterï¼Œåˆå§‹å€¼è®¾ç½®ä¸º0ï¼›</li><li>è®¡ç®— data ä¸ counteræ‹¼æ¥å­—ç¬¦ä¸²çš„å“ˆå¸Œå€¼ï¼›</li><li>æ£€æŸ¥ä¸Šä¸€æ­¥çš„å“ˆå¸Œå€¼æ˜¯å¦æ»¡è¶³æŸä¸ªæ¡ä»¶ï¼Œæ»¡è¶³åˆ™åœæ­¢è®¡ç®—ï¼Œä¸æ»¡è¶³åˆ™ counter åŠ 1ï¼Œç„¶åé‡å¤ç¬¬3æ­¥å’Œç¬¬4æ­¥ï¼Œç›´åˆ°æ»¡è¶³è¿™ä¸ªç‰¹å®šçš„æ¡ä»¶ä¸ºæ­¢ã€‚</li></ol><p>è¿™æ˜¯ä¸€ç§ç²—æš´çš„ç®—æ³•ï¼šä½ æ”¹å˜è®¡æ•°å™¨ï¼Œè®¡ç®—ä¸€ä¸ªæ–°çš„å“ˆå¸Œå€¼ï¼Œæ£€æŸ¥å®ƒï¼Œå¢åŠ è®¡æ•°å™¨ï¼Œè®¡ç®—ä¸€ä¸ªæ–°çš„å“ˆå¸Œå€¼ï¼Œå¾ªç¯å¾€å¤ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒéœ€è¦èŠ±è´¹å¤§é‡è®¡ç®—æœºç®—åŠ›èµ„æºçš„åŸå› æ‰€åœ¨ã€‚</p><p>è®©æˆ‘ä»¬æ¥è¿‘è·ç¦»çœ‹ä¸€ä¸‹è¿™ä¸ªç‰¹å®šçš„æ¡ä»¶æŒ‡çš„æ˜¯ä»€ä¹ˆã€‚åœ¨åŸå§‹çš„<code>Hashcash</code>ç®—æ³•ä¸­ï¼Œè¿™ä¸ªç‰¹æ®Šçš„è¦æ±‚æŒ‡çš„æ˜¯è®¡ç®—å‡ºæ¥çš„å“ˆå¸Œå€¼çš„å‰20bitå¿…é¡»å…¨æ˜¯é›¶ï¼Œ</p><p>åœ¨æ¯”ç‰¹å¸ç§ï¼Œè¿™ç§è¦æ±‚å“ˆå¸Œå€¼å‰é¢æœ‰å¤šå°‘ä¸ªé›¶æ‰“å¤´çš„è¦æ±‚æ˜¯éšç€æ—¶é—´çš„æ¨ç§»è€Œä¸æ–­è°ƒæ•´çš„ï¼Œè¿™æ˜¯å‡ºäºè®¾è®¡çš„ç›®çš„ï¼Œå°½ç®¡åœ¨è®¡ç®—æœºçš„ç®—åŠ›ä¼šä¸æ–­çš„æå‡å’Œè¶Šæ¥è¶Šå¤šçš„çŸ¿å·¥åŠ å…¥è¿™ä¸ªç½‘ç»œä¸­çš„æƒ…å†µä¸‹ï¼Œéƒ½è¦ä¿è¯æ¯10minç”Ÿäº§ä¸€ä¸ªåŒºå—ã€‚</p><p>æˆ‘ä»¬æ¼”ç¤ºä¸€ä¸‹è¿™ä¸ªç®—æ³•ï¼Œ</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¡ç®—å­—ç¬¦ä¸²'I like donuts'çš„å“ˆå¸Œå€¼</span></span><br><span class="line">SHA256(<span class="string">"I like donuts"</span>) </span><br><span class="line">â€”â€”&gt; f80867f6efd4484c23b0e7184e53fe4af6ab49b97f5293fcd50d5b2bfa73a4d0</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹¼æ¥ä¸€ä¸ªè®¡æ•°å™¨å€¼(ca07ca)ï¼Œå†æ¬¡è¿›è¡ŒHashè®¡ç®—</span></span><br><span class="line">SHA256(<span class="string">"I like donutsca07ca"</span>) </span><br><span class="line">â€”â€”&gt; <span class="number">0000002</span>f7c1fe31cb82acdc082cfec47620b7e4ab94f2bf9e096c436fc8cee06</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>ca07ca</code>æ˜¯è®¡æ•°å™¨å€¼çš„åå…­è¿›åˆ¶ï¼Œä»–è¡¨ç¤ºçš„åè¿›åˆ¶å€¼ä¸º<code>13240266</code></p><blockquote><p>å³ï¼Œä»0å¼€å§‹ï¼Œæ€»å…±è®¡ç®—äº†13240266æ¬¡ï¼Œæ‰è®¡ç®—å‡º<code>I like donuts</code>è¿™ä¸ªæ•°æ®çš„Hashå€¼ï¼Œæ»¡è¶³å‰6ä½(3å­—èŠ‚)å…¨æ˜¯é›¶ã€‚</p></blockquote><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><blockquote><p>æ€è·¯ï¼š</p><p>1ï¼‰æ¯æ¬¡åŒºå—è¢«æ·»åŠ åˆ°åŒºå—é“¾ä¹‹å‰ï¼Œå…ˆè¦è¿›è¡ŒæŒ–çŸ¿ï¼ˆPowï¼‰</p><p>2ï¼‰æŒ–çŸ¿è¿‡ç¨‹ä¸­ï¼Œäº§ç”Ÿçš„ Hash å€¼ï¼Œå¦‚æœå°äºéš¾åº¦ç›®æ ‡å€¼åˆ™æ·»åŠ è¿›åŒºå—ï¼Œå¦åˆ™ç»§ç»­æŒ–çŸ¿ï¼Œç›´åˆ°æ‰¾åˆ°æ­£ç¡®çš„Hashä¸ºæ­¢</p><p>3ï¼‰æœ€åï¼ŒéªŒè¯åŒºå—Hashæ˜¯å¦æœ‰æ•ˆ</p></blockquote><h4 id="å®šä¹‰Powç±»"><a href="#å®šä¹‰Powç±»" class="headerlink" title="å®šä¹‰Powç±»"></a>å®šä¹‰Powç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å·¥ä½œé‡è¯æ˜</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/02/04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProofOfWork</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * éš¾åº¦ç›®æ ‡ä½</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TARGET_BITS = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŒºå—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Block block;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * éš¾åº¦ç›®æ ‡å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> BigInteger target;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">ProofOfWork</span><span class="params">(Block block, BigInteger target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.block = block;</span><br><span class="line">        <span class="keyword">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºæ–°çš„å·¥ä½œé‡è¯æ˜ï¼Œè®¾å®šéš¾åº¦ç›®æ ‡å€¼</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * å¯¹1è¿›è¡Œç§»ä½è¿ç®—ï¼Œå°†1å‘å·¦ç§»åŠ¨ (256 - TARGET_BITS) ä½ï¼Œå¾—åˆ°æˆ‘ä»¬çš„éš¾åº¦ç›®æ ‡å€¼</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> block</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ProofOfWork <span class="title">newProofOfWork</span><span class="params">(Block block)</span> </span>&#123;</span><br><span class="line">        BigInteger targetValue = BigInteger.valueOf(<span class="number">1</span>).shiftLeft((<span class="number">256</span> - TARGET_BITS));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ProofOfWork(block, targetValue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>è®¾å®šä¸€ä¸ªéš¾åº¦ç›®æ ‡ä½<code>TARGET_BITS</code>ï¼Œè¡¨ç¤ºæœ€ç»ˆæŒ–çŸ¿æŒ–å‡ºæ¥Hashå€¼ï¼Œè½¬åŒ–ä¸ºäºŒè¿›åˆ¶åï¼Œä¸256ç›¸æ¯”ï¼Œé•¿åº¦å°‘äº†å¤šå°‘bitï¼Œä¹Ÿå³äºŒè¿›åˆ¶å‰é¢æœ‰å¤šå°‘bitæ˜¯é›¶.</p><blockquote><ul><li><code>TARGET_BITS</code> è¶Šå¤§ï¼Œæœ€ç»ˆ<code>targetValue</code>å°±è¶Šå°ï¼Œè¦æ±‚è®¡ç®—å‡ºæ¥çš„Hashè¶Šæ¥è¶Šå°ï¼Œä¹Ÿå°±æ˜¯æŒ–çŸ¿çš„éš¾åº¦è¶Šæ¥è¶Šå¤§ã€‚</li><li>æˆ‘ä»¬è¿™é‡Œçš„<code>TARGET_BITS</code>æ˜¯å›ºå®šçš„ï¼Œä½†æ˜¯åœ¨çœŸå®çš„æ¯”ç‰¹å¸ä¸­ï¼Œéš¾åº¦ç›®æ ‡æ˜¯éšç€æ—¶é—´çš„æ¨æ¨ï¼Œä¼šåŠ¨æ€è°ƒæ•´çš„ã€‚è¯¦è§ï¼š<a href="https://github.com/bitcoinbook/bitcoinbook/blob/develop/ch10.asciidoc#target-representation" target="_blank" rel="noopener">ã€Šç²¾é€šæ¯”ç‰¹å¸ ï¼ˆç¬¬äºŒç‰ˆï¼‰ã€‹ç¬¬10ç« </a></li></ul></blockquote></li><li><p>ç”±äºæ•°å€¼æ¯”è¾ƒå¤§ï¼Œè¿™é‡Œè¦ä½¿ç”¨<code>BitInteger</code>ç±»å‹ã€‚</p></li></ul><h4 id="å‡†å¤‡æ•°æ®"><a href="#å‡†å¤‡æ•°æ®" class="headerlink" title="å‡†å¤‡æ•°æ®"></a>å‡†å¤‡æ•°æ®</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‡†å¤‡æ•°æ®</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * æ³¨æ„ï¼šåœ¨å‡†å¤‡åŒºå—æ•°æ®æ—¶ï¼Œä¸€å®šè¦ä»åŸå§‹æ•°æ®ç±»å‹è½¬åŒ–ä¸ºbyte[]ï¼Œä¸èƒ½ç›´æ¥ä»å­—ç¬¦ä¸²è¿›è¡Œè½¬æ¢</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> nonce</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">prepareData</span><span class="params">(<span class="keyword">long</span> nonce)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">byte</span>[] prevBlockHashBytes = &#123;&#125;;</span><br><span class="line">   <span class="keyword">if</span> (StringUtils.isNoneBlank(<span class="keyword">this</span>.getBlock().getPrevBlockHash())) &#123;</span><br><span class="line">       prevBlockHashBytes = <span class="keyword">new</span> BigInteger(<span class="keyword">this</span>.getBlock().getPrevBlockHash(), <span class="number">16</span>).toByteArray();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> ByteUtils.merge(</span><br><span class="line">           prevBlockHashBytes,</span><br><span class="line">           <span class="keyword">this</span>.getBlock().getData().getBytes(),</span><br><span class="line">           ByteUtils.toBytes(<span class="keyword">this</span>.getBlock().getTimeStamp()),</span><br><span class="line">           ByteUtils.toBytes(TARGET_BITS),</span><br><span class="line">           ByteUtils.toBytes(nonce)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å‚ä¸Hashè¿ç®—çš„å¦‚ä¸‹å‡ ä¸ªä¿¡æ¯ï¼š<ul><li>å‰ä¸€ä¸ªåŒºå—ï¼ˆçˆ¶åŒºå—ï¼‰çš„Hashå€¼ï¼›</li><li>åŒºå—ä¸­çš„äº¤æ˜“æ•°æ®ï¼›</li><li>åŒºå—ç”Ÿæˆçš„æ—¶é—´ï¼›</li><li>éš¾åº¦ç›®æ ‡ï¼›</li><li>ç”¨äºå·¥ä½œé‡è¯æ˜ç®—æ³•çš„è®¡æ•°å™¨</li></ul></li></ul><blockquote><p>è¯¦è§ï¼š<a href="https://github.com/bitcoinbook/bitcoinbook/blob/develop/ch09.asciidoc#block-header" target="_blank" rel="noopener">ã€Šç²¾é€šæ¯”ç‰¹å¸ ï¼ˆç¬¬äºŒç‰ˆï¼‰ã€‹ç¬¬09ç« </a></p></blockquote><h4 id="Powç®—æ³•"><a href="#Powç®—æ³•" class="headerlink" title="Powç®—æ³•"></a>Powç®—æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿è¡Œå·¥ä½œé‡è¯æ˜ï¼Œå¼€å§‹æŒ–çŸ¿ï¼Œæ‰¾åˆ°å°äºéš¾åº¦ç›®æ ‡å€¼çš„Hash</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PowResult <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> nonce = <span class="number">0</span>;</span><br><span class="line">    String shaHex = <span class="string">""</span>;</span><br><span class="line">    System.out.printf(<span class="string">"Mining the block containingï¼š%s \n"</span>, <span class="keyword">this</span>.getBlock().getData());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">while</span> (nonce &lt; Long.MAX_VALUE) &#123;</span><br><span class="line">        String data = <span class="keyword">this</span>.prepareData(nonce);</span><br><span class="line">        shaHex = DigestUtils.sha256Hex(data);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">new</span> BigInteger(shaHex, <span class="number">16</span>).compareTo(<span class="keyword">this</span>.target) == -<span class="number">1</span>) &#123;</span><br><span class="line">            System.out.printf(<span class="string">"Elapsed Time: %s seconds \n"</span>, (<span class="keyword">float</span>) (System.currentTimeMillis() - startTime) / <span class="number">1000</span>);</span><br><span class="line">            System.out.printf(<span class="string">"correct hash Hex: %s \n\n"</span>, shaHex);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            nonce++;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">new</span> PowResult(nonce, shaHex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¾ªç¯ä½“é‡Œé¢ä¸»è¦ä»¥ä¸‹å››æ­¥ï¼š<ul><li>å‡†å¤‡æ•°æ®</li><li>è¿›è¡Œsha256è¿ç®—</li><li>è½¬åŒ–ä¸ºBigInterç±»å‹</li><li>ä¸targetè¿›è¡Œæ¯”è¾ƒ</li></ul></li><li>æœ€åï¼Œè¿”å›æ­£ç¡®çš„Hashå€¼ä»¥åŠè¿ç®—è®¡æ•°å™¨<code>nonce</code></li></ul><h4 id="éªŒè¯åŒºå—Hashæœ‰æ•ˆæ€§"><a href="#éªŒè¯åŒºå—Hashæœ‰æ•ˆæ€§" class="headerlink" title="éªŒè¯åŒºå—Hashæœ‰æ•ˆæ€§"></a>éªŒè¯åŒºå—Hashæœ‰æ•ˆæ€§</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * éªŒè¯åŒºå—æ˜¯å¦æœ‰æ•ˆ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">validate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String data = <span class="keyword">this</span>.prepareData(<span class="keyword">this</span>.getBlock().getNonce());</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> BigInteger(DigestUtils.sha256Hex(data), <span class="number">16</span>).compareTo(<span class="keyword">this</span>.target) == -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹åŒºå—æ·»åŠ é€»è¾‘"><a href="#ä¿®æ”¹åŒºå—æ·»åŠ é€»è¾‘" class="headerlink" title="ä¿®æ”¹åŒºå—æ·»åŠ é€»è¾‘"></a>ä¿®æ”¹åŒºå—æ·»åŠ é€»è¾‘</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; åˆ›å»ºæ–°åŒºå— &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> previousHash</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Block <span class="title">newBlock</span><span class="params">(String previousHash, String data)</span> </span>&#123;</span><br><span class="line">    Block block = <span class="keyword">new</span> Block(<span class="string">""</span>, previousHash, data, Instant.now().getEpochSecond(), <span class="number">0</span>);</span><br><span class="line">    ProofOfWork pow = ProofOfWork.newProofOfWork(block);</span><br><span class="line">    PowResult powResult = pow.run();</span><br><span class="line">    block.setHash(powResult.getHash());</span><br><span class="line">    block.setNonce(powResult.getNonce());</span><br><span class="line">    <span class="keyword">return</span> block;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºåŒºå—</li><li>åˆ›å»ºPowç®—æ³•å¯¹è±¡</li><li>æ‰§è¡ŒPowç®—æ³•</li><li>ä¿å­˜è¿”å›çš„Hashä»¥åŠè¿ç®—è®¡æ•°å™¨</li></ul><h4 id="æµ‹è¯•è¿è¡Œ"><a href="#æµ‹è¯•è¿è¡Œ" class="headerlink" title="æµ‹è¯•è¿è¡Œ"></a>æµ‹è¯•è¿è¡Œ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/02/05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlockchainTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Blockchain blockchain = Blockchain.newBlockchain();</span><br><span class="line"></span><br><span class="line">        blockchain.addBlock(<span class="string">"Send 1 BTC to Ivan"</span>);</span><br><span class="line">        blockchain.addBlock(<span class="string">"Send 2 more BTC to Ivan"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Block block : blockchain.getBlockList()) &#123;</span><br><span class="line">            System.out.println(<span class="string">"Prev.hash: "</span> + block.getPrevBlockHash());</span><br><span class="line">            System.out.println(<span class="string">"Data: "</span> + block.getData());</span><br><span class="line">            System.out.println(<span class="string">"Hash: "</span> + block.getHash());</span><br><span class="line">            System.out.println(<span class="string">"Nonce: "</span> + block.getNonce());</span><br><span class="line"></span><br><span class="line">            ProofOfWork pow = ProofOfWork.newProofOfWork(block);</span><br><span class="line">            System.out.println(<span class="string">"Pow valid: "</span> +  pow.validate() + <span class="string">"\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¾å®šTARGET_BITS = 20ï¼Œå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Mining the block containingï¼šGenesis Block </span><br><span class="line">Elapsed Time: <span class="number">2.118</span> seconds </span><br><span class="line">correct hash Hex: <span class="number">00000828</span>ee8289ef6381f297585ef8c952fde93fc2b673ff7cc655f699bb2442 </span><br><span class="line"></span><br><span class="line">Mining the block containingï¼šSend <span class="number">1</span> BTC to Ivan </span><br><span class="line">Elapsed Time: <span class="number">1.069</span> seconds </span><br><span class="line">correct hash Hex: <span class="number">00000</span>a38c0d7f2ebbd20773e93770298aa8bc0cc6d85fca8756fe0646ae7fea5 </span><br><span class="line"></span><br><span class="line">Mining the block containingï¼šSend <span class="number">2</span> more BTC to Ivan </span><br><span class="line">Elapsed Time: <span class="number">4.258</span> seconds </span><br><span class="line">correct hash Hex: <span class="number">00000777f</span>93efe91d9aabcba14ab3d8ab8e0255b89818cdb9b93cfa844ad0c7f </span><br><span class="line"></span><br><span class="line">Prev.hash: </span><br><span class="line">Data: Genesis Block</span><br><span class="line">Hash: <span class="number">00000828</span>ee8289ef6381f297585ef8c952fde93fc2b673ff7cc655f699bb2442</span><br><span class="line">Nonce: <span class="number">522163</span></span><br><span class="line">Pow valid: <span class="keyword">true</span></span><br><span class="line"></span><br><span class="line">Prev.hash: <span class="number">00000828</span>ee8289ef6381f297585ef8c952fde93fc2b673ff7cc655f699bb2442</span><br><span class="line">Data: Send <span class="number">1</span> BTC to Ivan</span><br><span class="line">Hash: <span class="number">00000</span>a38c0d7f2ebbd20773e93770298aa8bc0cc6d85fca8756fe0646ae7fea5</span><br><span class="line">Nonce: <span class="number">474758</span></span><br><span class="line">Pow valid: <span class="keyword">true</span></span><br><span class="line"></span><br><span class="line">Prev.hash: <span class="number">00000</span>a38c0d7f2ebbd20773e93770298aa8bc0cc6d85fca8756fe0646ae7fea5</span><br><span class="line">Data: Send <span class="number">2</span> more BTC to Ivan</span><br><span class="line">Hash: <span class="number">00000777f</span>93efe91d9aabcba14ab3d8ab8e0255b89818cdb9b93cfa844ad0c7f</span><br><span class="line">Nonce: <span class="number">1853839</span></span><br><span class="line">Pow valid: <span class="keyword">true</span></span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æˆ‘ä»¬æ­£åœ¨ä¸€æ­¥ä¸€æ­¥æ¥è¿‘çœŸå®çš„åŒºå—é“¾æ¶æ„ï¼Œæœ¬ç¯‡æˆ‘ä»¬å®ç°äº†æŒ–çŸ¿æœºåˆ¶ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æœ‰å¾ˆå¤šå…³é”®æ€§çš„åŠŸèƒ½æ²¡æœ‰å®ç°ï¼šåŒºå—é“¾æ•°æ®åº“çš„æŒä¹…æ€§ã€é’±åŒ…ã€åœ°å€ã€äº¤æ˜“ã€å…±è¯†æœºåˆ¶ï¼Œè¿™äº›æˆ‘ä»¬åé¢ä¸€æ­¥ä¸€æ­¥æ¥å®ç°</p><h2 id="èµ„æ–™"><a href="#èµ„æ–™" class="headerlink" title="èµ„æ–™"></a>èµ„æ–™</h2><ul><li>æºä»£ç ï¼š<a href="https://github.com/wangweiX/blockchain-java/tree/part2-pow" target="_blank" rel="noopener">https://github.com/wangweiX/blockchain-java/tree/part2-pow</a></li></ul><ul><li><a href="https://jeiwan.cc/posts/building-blockchain-in-go-part-2/" target="_blank" rel="noopener">https://jeiwan.cc/posts/building-blockchain-in-go-part-2/</a></li><li><a href="https://github.com/bitcoinbook/bitcoinbook" target="_blank" rel="noopener">ã€Šç²¾é€šæ¯”ç‰¹å¸ï¼ˆç¬¬äºŒç‰ˆï¼‰ã€‹</a></li></ul><p><img src="https://img.i7years.com/blog/blockchain_exploer.png" alt=""></p><blockquote><p><a href="https://press.one/file/v?s=4fb1e0818984baa1c44f0816f56490d616247c0ec4bc1ae69ce5d7b75ac93468a4fdab2d120a8077ff54b467b6c268ab220dc4247374ed06e5000972488d30e60&amp;h=976aeef7414e3e5779d73cb9950c566eb1ac7a0d75f2ab76a0bea31b30e94686&amp;a=23fe9bfd7ceef4b44c2ce44dcac8e4a49caf8026&amp;f=P1&amp;v=2" target="_blank" rel="noopener">https://press.one/file/v?s=4fb1e0818984baa1c44f0816f56490d616247c0ec4bc1ae69ce5d7b75ac93468a4fdab2d120a8077ff54b467b6c268ab220dc4247374ed06e5000972488d30e60&amp;h=976aeef7414e3e5779d73cb9950c566eb1ac7a0d75f2ab76a0bea31b30e94686&amp;a=23fe9bfd7ceef4b44c2ce44dcac8e4a49caf8026&amp;f=P1&amp;v=2</a></p></blockquote>]]></content>
      
        <categories>
            
            <category> blockchain </category>
            
        </categories>
        
        
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> bitcoin </tag>
            
            <tag> pow </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[åŸºäºJavaè¯­è¨€æ„å»ºåŒºå—é“¾ï¼ˆä¸€ï¼‰â€”â€” åŸºæœ¬åŸå‹]]></title>
      <url>/posts/build-blockchain-in-java-base-prototype.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/Blockchain-Technology-is-Changing-the-World-As-We-Know-It.webp?imageslim" alt=""></p><blockquote><p>æ–‡ç« çš„ä¸»è¦æ€æƒ³å’Œå†…å®¹å‡æ¥è‡ª <a href="https://jeiwan.cc/posts/building-blockchain-in-go-part-1/" target="_blank" rel="noopener">https://jeiwan.cc/posts/building-blockchain-in-go-part-1/</a></p></blockquote><h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>åŒºå—é“¾æŠ€æœ¯æ˜¯ä¸€é¡¹æ¯”äººå·¥æ™ºèƒ½æ›´å…·é©å‘½æ€§çš„æŠ€æœ¯ï¼Œäººå·¥æ™ºèƒ½åªæ˜¯æé«˜äº†äººç±»çš„ç”Ÿäº§åŠ›ï¼Œè€ŒåŒºå—é“¾åˆ™å°†æ”¹å˜äººç±»ç¤¾ä¼šçš„ç”Ÿäº§å…³ç³»ï¼Œå®ƒå°†ä¼šé¢ è¦†æˆ‘ä»¬äººç±»ç¤¾ä¼šç°æœ‰çš„åä½œæ–¹å¼ã€‚äº†è§£å’ŒæŒæ¡åŒºå—é“¾ç›¸å…³çŸ¥è¯†å’ŒæŠ€æœ¯ï¼Œæ˜¯æˆ‘ä»¬æ¯ä½å¼€å‘äººå‘˜å¿…é¡»è¦å»åšçš„äº‹æƒ…ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½æŠŠæ¡ä½è¿™æ³¢æ—¶ä»£è¶‹åŠ¿çš„çº¢åˆ©ã€‚</p><p>æœ¬æ–‡å°†åŸºäºJavaè¯­è¨€æ„å»ºç®€åŒ–ç‰ˆçš„blockchainï¼Œæ¥å®ç°æ•°å­—è´§å¸ã€‚</p><a id="more"></a><h2 id="åˆ›å»ºåŒºå—"><a href="#åˆ›å»ºåŒºå—" class="headerlink" title="åˆ›å»ºåŒºå—"></a>åˆ›å»ºåŒºå—</h2><p>åŒºå—é“¾æ˜¯ç”±åŒ…å«äº¤æ˜“ä¿¡æ¯çš„åŒºå—ä»åå‘å‰æœ‰åºé“¾æ¥èµ·æ¥çš„æ•°æ®ç»“æ„ã€‚åŒºå—è¢«ä»åå‘å‰æœ‰åºåœ°é“¾æ¥åœ¨è¿™ä¸ªé“¾æ¡é‡Œï¼Œæ¯ä¸ªåŒºå—éƒ½æŒ‡å‘å‰ä¸€ä¸ªåŒºå—ã€‚ä»¥æ¯”ç‰¹å¸ä¸ºä¾‹ï¼Œæ¯ä¸ªåŒºå—ä¸»è¦åŒ…å«å¦‚ä¸‹ä¿¡æ¯å­—æ®µï¼š</p><blockquote><ul><li>åŒºå—å¤§å°ï¼šç”¨å­—èŠ‚è¡¨ç¤ºçš„åŒºå—æ•°æ®å¤§å°</li><li>åŒºå—å¤´ï¼šç»„æˆåŒºå—å¤´çš„å‡ ä¸ªå­—æ®µ<ul><li>åŒºå—å¤´hashå€¼</li><li>çˆ¶åŒºå—å¤´hashå€¼</li><li>æ—¶é—´æˆ³ï¼šåŒºå—äº§ç”Ÿçš„è¿‘ä¼¼æ—¶é—´</li><li>Merkleæ ¹ï¼šè¯¥åŒºå—ä¸­äº¤æ˜“çš„merkleæ ‘æ ¹çš„å“ˆå¸Œå€¼</li><li>éš¾åº¦ç›®æ ‡ï¼šè¯¥åŒºå—å·¥ä½œé‡è¯æ˜ç®—æ³•çš„éš¾åº¦ç›®æ ‡</li><li>Nonceï¼šç”¨äºå·¥ä½œé‡è¯æ˜ç®—æ³•çš„è®¡æ•°å™¨</li></ul></li><li>äº¤æ˜“è®¡æ•°å™¨ï¼šäº¤æ˜“çš„æ•°é‡</li><li>äº¤æ˜“ï¼šè®°å½•åœ¨åŒºå—é‡Œçš„äº¤æ˜“ä¿¡æ¯</li></ul><blockquote><p>è¯¦è§ï¼š<a href="https://github.com/bitcoinbook/bitcoinbook/blob/develop/ch09.asciidoc#structure-of-a-block" target="_blank" rel="noopener">ã€Šç²¾é€šæ¯”ç‰¹å¸ã€‹ï¼ˆç¬¬äºŒç‰ˆï¼‰ç¬¬9ç« â€”â€”åŒºå—é“¾</a></p></blockquote></blockquote><h5 id="åŒºå—æ•°æ®ç»“æ„"><a href="#åŒºå—æ•°æ®ç»“æ„" class="headerlink" title="åŒºå—æ•°æ®ç»“æ„"></a>åŒºå—æ•°æ®ç»“æ„</h5><p><img src="https://img.i7years.com/blog/1_627BG-7qMtaXNsX0n41C6Q.png" alt=""></p><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸»è¦æ˜¯ä¸ºäº†å®ç°æœ€ç®€å•çš„åŒºå—é“¾ç»“æ„ï¼Œä»…ä»…åŒ…å«ä»¥ä¸‹å‡ ä¸ªä¿¡æ¯å­—æ®µï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŒºå—</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/02/02</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Block</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŒºå—hashå€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String hash;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‰ä¸€ä¸ªåŒºå—çš„hashå€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String previousHash;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŒºå—æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String data;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŒºå—åˆ›å»ºæ—¶é—´(å•ä½:ç§’)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> timeStamp;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Block</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Block</span><span class="params">(String hash, String previousHash, String data, <span class="keyword">long</span> timeStamp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>();</span><br><span class="line">        <span class="keyword">this</span>.hash = hash;</span><br><span class="line">        <span class="keyword">this</span>.previousHash = previousHash;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">        <span class="keyword">this</span>.timeStamp = timeStamp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="åŒºå—Hashå€¼è®¡ç®—"><a href="#åŒºå—Hashå€¼è®¡ç®—" class="headerlink" title="åŒºå—Hashå€¼è®¡ç®—"></a>åŒºå—Hashå€¼è®¡ç®—</h5><p>åŠ å¯†Hashå€¼ï¼Œä¸€ä¸ªé€šè¿‡SHA256ç®—æ³•å¯¹åŒºå—å¤´è¿›è¡ŒäºŒæ¬¡å“ˆå¸Œè®¡ç®—è€Œå¾—åˆ°çš„æ•°å­—æŒ‡çº¹ã€‚Hashå€¼ç”¨äºç¡®ä¿blockchainçš„å®‰å…¨ã€‚Hashè®¡ç®—æ˜¯è®¡ç®—æ•æ„Ÿçš„æ“ä½œï¼Œå³ä½¿åœ¨é«˜æ€§èƒ½ç”µè„‘ä¹Ÿéœ€è¦èŠ±è´¹ä¸€æ®µæ—¶é—´æ¥å®Œæˆè®¡ç®—(è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆäººä»¬è´­ä¹°é«˜æ€§èƒ½GPUè¿›è¡Œæ¯”ç‰¹å¸æŒ–çŸ¿çš„åŸå› )ã€‚blockchainæ¶æ„è®¾è®¡æœ‰æ„ä½¿Hashè®¡ç®—å˜å¾—å›°éš¾ï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†åŠ å¤§æ–°å¢ä¸€ä¸ªblockçš„éš¾åº¦ï¼Œè¿›è€Œé˜²æ­¢blockåœ¨å¢åŠ åè¢«éšæ„ä¿®æ”¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; åˆ›å»ºæ–°åŒºå— &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> previousHash</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Block <span class="title">newBlock</span><span class="params">(String previousHash, String data)</span> </span>&#123;</span><br><span class="line">        Block block = <span class="keyword">new</span> Block(<span class="string">""</span>, previousHash, data.getBytes(),     Instant.now().getEpochSecond());</span><br><span class="line">        block.setHash();</span><br><span class="line">        <span class="keyword">return</span> block;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¡ç®—åŒºå—Hash</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * æ³¨æ„ï¼šåœ¨å‡†å¤‡åŒºå—æ•°æ®æ—¶ï¼Œä¸€å®šè¦ä»åŸå§‹æ•°æ®ç±»å‹è½¬åŒ–ä¸ºbyte[]ï¼Œä¸èƒ½ç›´æ¥ä»å­—ç¬¦ä¸²è¿›è¡Œè½¬æ¢</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setHash</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">byte</span>[] prevBlockHashBytes = &#123;&#125;;</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isNoneBlank(<span class="keyword">this</span>.getPrevBlockHash())) &#123;</span><br><span class="line">        prevBlockHashBytes = <span class="keyword">new</span> BigInteger(<span class="keyword">this</span>.getPrevBlockHash(), <span class="number">16</span>).toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">byte</span>[] headers = ByteUtils.merge(</span><br><span class="line">           prevBlockHashBytes,</span><br><span class="line">           <span class="keyword">this</span>.getData().getBytes(),</span><br><span class="line">           ByteUtils.toBytes(<span class="keyword">this</span>.getTimeStamp()));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.setHash(DigestUtils.sha256Hex(headers));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºåŒºå—é“¾"><a href="#åˆ›å»ºåŒºå—é“¾" class="headerlink" title="åˆ›å»ºåŒºå—é“¾"></a>åˆ›å»ºåŒºå—é“¾</h2><p>åŒºå—é“¾æœ¬è´¨ä¸Šæ˜¯ä¸€ç§<strong>æœ‰åº</strong>ã€<strong>åå‘é“¾æ¥é“¾è¡¨</strong>çš„æ•°æ®ç»“æ„ã€‚è¿™æ„å‘³ç€ï¼ŒblockæŒ‰ç…§æ’å…¥çš„é¡ºåºå­˜æ”¾ï¼ŒåŒæ—¶æ¯ä¸ªblockéƒ½ä¿å­˜æŒ‡å‘ä¸Šä¸€ä¸ªblockçš„é“¾æ¥ã€‚è¿™ç§ç»“æ„ä¿è¯å¯ä»¥å¿«é€Ÿè·å–æœ€æ–°æ’å…¥çš„blockåŒæ—¶è·å–å®ƒçš„hashå€¼ã€‚è¿™ç§ç»“æ„ä¿è¯å¯ä»¥å¿«é€Ÿè·å–æœ€æ–°æ’å…¥çš„blockåŒæ—¶ï¼ˆé«˜æ•ˆåœ°ï¼‰è·å–å®ƒçš„hashå€¼ã€‚</p><h5 id="åŒºå—é“¾æ•°æ®ç»“æ„"><a href="#åŒºå—é“¾æ•°æ®ç»“æ„" class="headerlink" title="åŒºå—é“¾æ•°æ®ç»“æ„"></a>åŒºå—é“¾æ•°æ®ç»“æ„</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; åŒºå—é“¾ &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/02/02</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Blockchain</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Block&gt; blockList;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Blockchain</span><span class="params">(List&lt;Block&gt; blockList)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.blockList = blockList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ·»åŠ åŒºå—"><a href="#æ·»åŠ åŒºå—" class="headerlink" title="æ·»åŠ åŒºå—"></a>æ·»åŠ åŒºå—</h5><blockquote><p>æ–°å¢ä¸€ä¸ªæ·»åŠ åŒºå—é“¾çš„æ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; æ·»åŠ åŒºå—  &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> data æ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addBlock</span><span class="params">(String data)</span> </span>&#123;</span><br><span class="line">   Block previousBlock = blockList.get(blockList.size() - <span class="number">1</span>);</span><br><span class="line">   <span class="keyword">this</span>.addBlock(Block.newBlock(previousBlock.getHash(), data));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; æ·»åŠ åŒºå—  &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> block åŒºå—</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addBlock</span><span class="params">(Block block)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">this</span>.blockList.add(block);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="åˆ›ä¸–åŒºå—"><a href="#åˆ›ä¸–åŒºå—" class="headerlink" title="åˆ›ä¸–åŒºå—"></a>åˆ›ä¸–åŒºå—</h5><blockquote><p>åœ¨æ·»åŠ åŒºå—ä¹‹å‰ï¼ŒåŒºå—é“¾å¿…é¡»æœ‰ä¸ª<code>åˆ›ä¸–åŒºå—</code>ï¼Œåœ¨<code>Block</code>ä¸­æ–°å¢åˆ›ä¸–åŒºå—æ–¹æ³•ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * &lt;p&gt; åˆ›å»ºåˆ›ä¸–åŒºå— &lt;/p&gt;</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Block <span class="title">newGenesisBlock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> Block.newBlock(<span class="string">""</span>, <span class="string">"Genesis Block"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="åˆ›å»ºåŒºå—é“¾-1"><a href="#åˆ›å»ºåŒºå—é“¾-1" class="headerlink" title="åˆ›å»ºåŒºå—é“¾"></a>åˆ›å»ºåŒºå—é“¾</h5><blockquote><p>å†åœ¨<code>Blockchain</code>ä¸­æ–°å¢åˆ›å»ºåŒºå—é“¾çš„æ–¹æ³•ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; åˆ›å»ºåŒºå—é“¾ &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Blockchain <span class="title">newBlockchain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;Block&gt; blocks = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">    blocks.add(Block.newGenesisBlock());</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Blockchain(blocks);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•è¿è¡Œ"><a href="#æµ‹è¯•è¿è¡Œ" class="headerlink" title="æµ‹è¯•è¿è¡Œ"></a>æµ‹è¯•è¿è¡Œ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/02/05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlockchainTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Blockchain blockchain = Blockchain.newBlockchain();</span><br><span class="line">        blockchain.addBlock(<span class="string">"Send 1 BTC to Ivan"</span>);</span><br><span class="line">        blockchain.addBlock(<span class="string">"Send 2 more BTC to Ivan"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Block block : blockchain.getBlockList()) &#123;</span><br><span class="line">            System.out.println(<span class="string">"Prev. hash: "</span> + block.getPreviousHash());</span><br><span class="line">            System.out.println(<span class="string">"Data: "</span> + block.getData());</span><br><span class="line">            System.out.println(<span class="string">"Hash: "</span> + block.getHash());</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼š</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Prev. hash: </span><br><span class="line">Data: Genesis Block</span><br><span class="line">Hash: <span class="number">4492</span>cb9d396a9a52e7ff17ef3782f022ddcdc7b2c276bc6dd3d448b0655eb3d4</span><br><span class="line"></span><br><span class="line">Prev. hash: <span class="number">4492</span>cb9d396a9a52e7ff17ef3782f022ddcdc7b2c276bc6dd3d448b0655eb3d4</span><br><span class="line">Data: Send <span class="number">1</span> BTC to Ivan</span><br><span class="line">Hash: cd716d59d98ad673035ab7035ece751718ea9842944a4743c298bebc0fe24c04</span><br><span class="line"></span><br><span class="line">Prev. hash: cd716d59d98ad673035ab7035ece751718ea9842944a4743c298bebc0fe24c04</span><br><span class="line">Data: Send <span class="number">2</span> more BTC to Ivan</span><br><span class="line">Hash: <span class="number">42f</span>78d6a86f88aa9b5b10e468494dfd1b3f558a9fb74a01eb348c2cbfc5d000a</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªéå¸¸ç®€å•çš„åŒºå—é“¾åŸå‹ï¼šå®ƒåªæ˜¯ä¸€ä¸ªå—çš„æ•°ç»„ï¼Œæ¯ä¸ªå—éƒ½ä¸å‰ä¸€ä¸ªå—æœ‰è¿æ¥ã€‚ å®é™…çš„åŒºå—é“¾è¦å¤æ‚å¾—å¤šã€‚</p><ul><li>ç¼ºå°‘äº¤æ˜“ä¿¡æ¯ï¼šæˆ‘ä»¬çš„åŒºå—é“¾è¿˜æ²¡æœ‰ä»»ä½•äº¤æ˜“ä¿¡æ¯ã€‚</li><li>ç¼ºå°‘å·¥ä½œé‡è¯æ˜ï¼šæˆ‘ä»¬çš„ç”Ÿäº§åŒºå—éå¸¸ç®€å•å¿«æ·ï¼Œå®é™…çš„åŒºå—é“¾ä¸­ï¼Œç”Ÿäº§ä¸€ä¸ªåŒºå—éœ€è¦è¿›è¡Œå¤§é‡çš„è®¡ç®—ã€‚</li><li>ç¼ºå°‘å…±è¯†æœºåˆ¶ï¼šåŒºå—é“¾æ˜¯ä¸€ä¸ªéå•ä¸€å†³ç­–è€…çš„åˆ†å¸ƒå¼æ•°æ®åº“ã€‚ å› æ­¤ï¼Œä¸€ä¸ªæ–°çš„åŒºå—å¿…é¡»å¾—åˆ°ç½‘ç»œçš„å…¶ä»–å‚ä¸è€…çš„ç¡®è®¤å’Œæ‰¹</li></ul><p>åœ¨ä»¥åçš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»è¿™äº›åŠŸèƒ½ã€‚</p><h2 id="èµ„æ–™"><a href="#èµ„æ–™" class="headerlink" title="èµ„æ–™"></a>èµ„æ–™</h2><ul><li>æºä»£ç ï¼š<a href="https://github.com/wangweiX/blockchain-java/tree/part1-Basic_Prototype" target="_blank" rel="noopener">https://github.com/wangweiX/blockchain-java/tree/part1-Basic_Prototype</a></li></ul><ul><li><a href="https://jeiwan.cc/posts/building-blockchain-in-go-part-1/" target="_blank" rel="noopener">https://jeiwan.cc/posts/building-blockchain-in-go-part-1/</a></li><li><a href="https://github.com/bitcoinbook/bitcoinbook" target="_blank" rel="noopener">ã€Šç²¾é€šæ¯”ç‰¹å¸ï¼ˆç¬¬äºŒç‰ˆï¼‰ã€‹</a></li></ul><p><img src="https://img.i7years.com/blog/blockchain_exploer.png" alt=""></p><blockquote><p><a href="https://press.one/file/v?s=e2926b487ace53de6e9defb2a68561220b8da974cf712dccf8f546c770e6df6813abeb96bdb49d4199858fa8e404959a8b07631fc0c9804787f45f816f8abef30&amp;h=f3625969fe71d4d0b31df504b7f7c8598c5617fcf92b54238f65fa666724022c&amp;a=23fe9bfd7ceef4b44c2ce44dcac8e4a49caf8026&amp;f=P1&amp;v=2" target="_blank" rel="noopener">https://press.one/file/v?s=e2926b487ace53de6e9defb2a68561220b8da974cf712dccf8f546c770e6df6813abeb96bdb49d4199858fa8e404959a8b07631fc0c9804787f45f816f8abef30&amp;h=f3625969fe71d4d0b31df504b7f7c8598c5617fcf92b54238f65fa666724022c&amp;a=23fe9bfd7ceef4b44c2ce44dcac8e4a49caf8026&amp;f=P1&amp;v=2</a></p></blockquote>]]></content>
      
        <categories>
            
            <category> blockchain </category>
            
        </categories>
        
        
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> bitcoin </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Node.Jså­¦ä¹ ç¬”è®°]]></title>
      <url>/posts/learning-nodejs.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>Node.js æ˜¯æˆ‘2018å¹´è®¡åˆ’å­¦ä¹ çš„ä¸€é—¨ç¼–ç¨‹è¯­è¨€ï¼Œå­¦ä¹ ä¸€ä¸‹JSå¼‚æ­¥ç¼–ç¨‹ä¸å‡½æ•°å¼ç¼–ç¨‹çš„æ€æƒ³ã€‚</p><blockquote><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/wangweiX/node.js-learning" target="_blank" rel="noopener">https://github.com/wangweiX/node.js-learning</a></p></blockquote><a id="more"></a><h2 id="Javascript-å­¦ä¹ "><a href="#Javascript-å­¦ä¹ " class="headerlink" title="Javascript å­¦ä¹ "></a>Javascript å­¦ä¹ </h2><ul><li><a href="https://github.com/wangweiX/node.js-learning/blob/master/JavaScript%E5%AD%A6%E4%B9%A0(1" target="_blank" rel="noopener">Variables</a>.md)</li><li><a href="https://github.com/wangweiX/node.js-learning/blob/master/JavaScript%E5%AD%A6%E4%B9%A0(2" target="_blank" rel="noopener">Operators</a>.md)</li><li><a href="https://github.com/wangweiX/node.js-learning/blob/master/JavaScript%E5%AD%A6%E4%B9%A0(3" target="_blank" rel="noopener">Primitive Data Type</a>.md)</li><li><a href="https://github.com/wangweiX/node.js-learning/blob/master/JavaScript%E5%AD%A6%E4%B9%A0(4" target="_blank" rel="noopener">Functions</a>.md)</li><li><a href="https://github.com/wangweiX/node.js-learning/blob/master/JavaScript%E5%AD%A6%E4%B9%A0(5" target="_blank" rel="noopener">Objects</a>.md)</li><li><a href="https://github.com/wangweiX/node.js-learning/blob/master/JavaScript%E5%AD%A6%E4%B9%A0(6" target="_blank" rel="noopener">Symbol Type</a>.md)</li><li><a href="https://github.com/wangweiX/node.js-learning/blob/master/JavaScript%E5%AD%A6%E4%B9%A0(7" target="_blank" rel="noopener">Array</a>.md)</li><li><a href="https://github.com/wangweiX/node.js-learning/blob/master/JavaScript%E5%AD%A6%E4%B9%A0(8" target="_blank" rel="noopener">Map,WeakMap,Set,WeakSet</a>.md)</li><li><a href="https://github.com/wangweiX/node.js-learning/blob/master/JavaScript%E5%AD%A6%E4%B9%A0(9" target="_blank" rel="noopener">Iterables</a>.md)</li><li><a href="https://github.com/wangweiX/node.js-learning/blob/master/JavaScript%E5%AD%A6%E4%B9%A0(10" target="_blank" rel="noopener">JSON</a>.md)</li><li><a href="https://github.com/wangweiX/node.js-learning/blob/master/JavaScript%E5%AD%A6%E4%B9%A0(11" target="_blank" rel="noopener">Date and time</a>.md)</li><li><a href="https://github.com/wangweiX/node.js-learning/blob/master/JavaScript%E5%AD%A6%E4%B9%A0(12" target="_blank" rel="noopener">Property flags and descriptors</a>.md)</li><li><a href="https://github.com/wangweiX/node.js-learning/blob/master/JavaScript%E5%AD%A6%E4%B9%A0(13" target="_blank" rel="noopener">Property getters and setters</a>.md)</li><li><a href="https://github.com/wangweiX/node.js-learning/blob/master/JavaScript%E5%AD%A6%E4%B9%A0(14" target="_blank" rel="noopener">Prototypal inheritance</a>.md)</li></ul><h2 id="Node-Js-å­¦ä¹ "><a href="#Node-Js-å­¦ä¹ " class="headerlink" title="Node.Js å­¦ä¹ "></a>Node.Js å­¦ä¹ </h2><ul><li><a href="https://github.com/wangweiX/node.js-learning/blob/master/NodeJs%E5%AD%A6%E4%B9%A0(1" target="_blank" rel="noopener">Build First Web Server</a>.md)</li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> NodeJs </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[EOSå­¦ä¹ (3) | EOSè´§å¸åˆçº¦æ¼”ç¤º]]></title>
      <url>/posts/blockchain-eos-currency-smart-contract.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/eos-logo.jpg" alt=""></p><blockquote><p>æœ¬æ–‡æ¼”ç¤ºå¦‚ä½•åˆ›å»ºè´¦å·ã€å¦‚ä½•è½¬è´¦</p><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://github.com/eosio/eos#example-currency-contract-walkthrough" target="_blank" rel="noopener">https://github.com/eosio/eos#example-currency-contract-walkthrough</a></p></blockquote><a id="more"></a><h3 id="å¯åŠ¨EOSIO"><a href="#å¯åŠ¨EOSIO" class="headerlink" title="å¯åŠ¨EOSIO"></a>å¯åŠ¨EOSIO</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd ~/eos/build/programs/eosiod/</span><br><span class="line">$ ./eosiod</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®é’±åŒ…å¹¶å¯¼å…¥è´¦æˆ·ç§é’¥"><a href="#è®¾ç½®é’±åŒ…å¹¶å¯¼å…¥è´¦æˆ·ç§é’¥" class="headerlink" title="è®¾ç½®é’±åŒ…å¹¶å¯¼å…¥è´¦æˆ·ç§é’¥"></a>è®¾ç½®é’±åŒ…å¹¶å¯¼å…¥è´¦æˆ·ç§é’¥</h3><h5 id="åˆ›å»ºé’±åŒ…"><a href="#åˆ›å»ºé’±åŒ…" class="headerlink" title="åˆ›å»ºé’±åŒ…"></a>åˆ›å»ºé’±åŒ…</h5><blockquote><p>è¯·ç¡®ä¿ä½ åœ¨å¯åŠ¨<code>eosiod</code>ä¹‹å‰ï¼Œå·²ç»åœ¨<code>config.ini</code>ä¸­é…ç½®äº†é’±åŒ…æ’ä»¶<code>plugin = eosio::wallet_api_plugin</code></p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cd ~/eos/build/programs/eosioc/</span><br><span class="line">$ ./eosioc wallet create -n wangwei </span><br><span class="line"><span class="comment"># å°†åœ¨ ~/eos/build/programs/eosiod/data-dir/ ä¸‹ç”Ÿæˆä¸€ä¸ªåä¸ºwangweiçš„é’±åŒ…æ–‡ä»¶ wangwei.wallet</span></span><br><span class="line"><span class="comment"># ä¸åŠ  -n wangwei, åˆ™ä¼šç”Ÿæˆé»˜è®¤é’±åŒ…æ–‡ä»¶ï¼Œåä¸º default.wallet æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><h5 id="å¯¼å…¥æµ‹è¯•è´¦å·"><a href="#å¯¼å…¥æµ‹è¯•è´¦å·" class="headerlink" title="å¯¼å…¥æµ‹è¯•è´¦å·"></a>å¯¼å…¥æµ‹è¯•è´¦å·</h5><blockquote><p>å°†é…ç½®æ–‡ä»¶<code>config.ini</code>ä¸­ç»™äºˆçš„æµ‹è¯•ç§é’¥å¯¼å…¥åˆ°é’±åŒ…ä¸­æ¥ï¼Œè¯¥ç§é’¥ä¸ºæµ‹è¯•è´¦å·<code>inita</code>çš„ç§é’¥</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¼å…¥ç§é’¥ 5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3 åˆ° wangwei è¿™ä¸ªé’±åŒ…</span></span><br><span class="line">$ ./eosioc wallet import -n wangwei <span class="number">5</span>KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºè´§å¸åˆçº¦è´¦å·"><a href="#åˆ›å»ºè´§å¸åˆçº¦è´¦å·" class="headerlink" title="åˆ›å»ºè´§å¸åˆçº¦è´¦å·"></a>åˆ›å»ºè´§å¸åˆçº¦è´¦å·</h3><h5 id="åˆ›å»ºä¸¤ä¸ªå¯†é’¥å¯¹"><a href="#åˆ›å»ºä¸¤ä¸ªå¯†é’¥å¯¹" class="headerlink" title="åˆ›å»ºä¸¤ä¸ªå¯†é’¥å¯¹"></a>åˆ›å»ºä¸¤ä¸ªå¯†é’¥å¯¹</h5><blockquote><p>åˆ›å»ºä¸¤ä¸ªå¯†é’¥å¯¹ï¼Œåé¢ä¼šåˆ†åˆ«èµ‹äºˆ<code>owner</code>æƒé™å’Œ<code>active</code>æƒé™</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cd ~/eos/build/programs/eosioc/</span><br><span class="line">$ ./eosioc create key <span class="comment"># PUBLIC_KEY_1ï¼Œæƒé™ï¼šowner_key</span></span><br><span class="line">$ ./eosioc create key <span class="comment"># PUBLIC_KEY_2ï¼Œæƒé™ï¼šactive_key</span></span><br></pre></td></tr></table></figure><h5 id="åˆ›å»ºä¸€ä¸ªæ–°è´¦å·"><a href="#åˆ›å»ºä¸€ä¸ªæ–°è´¦å·" class="headerlink" title="åˆ›å»ºä¸€ä¸ªæ–°è´¦å·"></a>åˆ›å»ºä¸€ä¸ªæ–°è´¦å·</h5><blockquote><p>ä½¿ç”¨<code>inita</code>åˆ›å»ºä¸€ä¸ªåä¸º<code>currency</code>çš„è´¦å·ï¼Œå°†ä¸Šä¸€æ­¥ç”Ÿæˆçš„PUBLIC_KEY_1é…ç½®ä¸ºå®ƒçš„owneræƒé™ï¼ŒPUBLIC_KEY_2é…ç½®ä¸ºå®ƒçš„activeæƒé™</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">$ ./eosioc create account inita currency PUBLIC_KEY_1 PUBLIC_KEY_2</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿”å›ä¿¡æ¯</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"transaction_id"</span>: <span class="string">"c5294137c04aa29178eeebe17f457288163e6b6e3e10c36644ddf8382a6d067e"</span>,</span><br><span class="line">  <span class="string">"processed"</span>: &#123;</span><br><span class="line">    <span class="string">"status"</span>: <span class="string">"executed"</span>,</span><br><span class="line">    <span class="string">"id"</span>: <span class="string">"c5294137c04aa29178eeebe17f457288163e6b6e3e10c36644ddf8382a6d067e"</span>,</span><br><span class="line">    <span class="string">"action_traces"</span>: [</span><br><span class="line">      null,&#123;</span><br><span class="line">        <span class="string">"receiver"</span>: <span class="string">"eosio"</span>,</span><br><span class="line">        <span class="string">"act"</span>: &#123;</span><br><span class="line">          <span class="string">"account"</span>: <span class="string">"eosio"</span>,</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"newaccount"</span>,</span><br><span class="line">          <span class="string">"authorization"</span>: [&#123;</span><br><span class="line">              <span class="string">"actor"</span>: <span class="string">"inita"</span>,</span><br><span class="line">              <span class="string">"permission"</span>: <span class="string">"active"</span></span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          <span class="string">"data"</span>: &#123;</span><br><span class="line">            <span class="string">"creator"</span>: <span class="string">"inita"</span>,</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"currency"</span>,</span><br><span class="line">            <span class="string">"owner"</span>: &#123;</span><br><span class="line">              <span class="string">"threshold"</span>: <span class="number">1</span>,</span><br><span class="line">              <span class="string">"accounts"</span>: [],</span><br><span class="line">              <span class="string">"keys"</span>: [&#123;</span><br><span class="line">                  <span class="string">"key"</span>: <span class="string">"EOS6ayDacXRvP8ZdLW4LNHvRsPeBQBbzvtm7HSkBuyvnLEkAUpfsS"</span>,</span><br><span class="line">                  <span class="string">"weight"</span>: <span class="number">1</span></span><br><span class="line">                &#125;</span><br><span class="line">              ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"active"</span>: &#123;</span><br><span class="line">              <span class="string">"threshold"</span>: <span class="number">1</span>,</span><br><span class="line">              <span class="string">"accounts"</span>: [],</span><br><span class="line">              <span class="string">"keys"</span>: [&#123;</span><br><span class="line">                  <span class="string">"key"</span>: <span class="string">"EOS6VJWWuc6C5p75P2NMNyFM4wYRcAx41NXD1nW7EVdFMGFTejMhZ"</span>,</span><br><span class="line">                  <span class="string">"weight"</span>: <span class="number">1</span></span><br><span class="line">                &#125;</span><br><span class="line">              ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"recovery"</span>: &#123;</span><br><span class="line">              <span class="string">"threshold"</span>: <span class="number">1</span>,</span><br><span class="line">              <span class="string">"accounts"</span>: [&#123;</span><br><span class="line">                  <span class="string">"permission"</span>: &#123;</span><br><span class="line">                    <span class="string">"actor"</span>: <span class="string">"inita"</span>,</span><br><span class="line">                    <span class="string">"permission"</span>: <span class="string">"active"</span></span><br><span class="line">                  &#125;,</span><br><span class="line">                  <span class="string">"weight"</span>: <span class="number">1</span></span><br><span class="line">                &#125;</span><br><span class="line">              ],</span><br><span class="line">              <span class="string">"keys"</span>: []</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"deposit"</span>: <span class="string">"1.0000 EOS"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"hex_data"</span>: <span class="string">"000000000093dd740000001e4d75af460100000000010002df9ca0db36688723ca23b83a2c11679945598ed7ef4bbe2234a7bfae283e16fe01000100000000010002d2be4c48f289f51bd9afb6680679cd6955181aabc8324c4d6ce729f0db9e054a01000100000001000000000093dd7400000000a8ed3232010000102700000000000004454f5300000000"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"console"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"region_id"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">"cycle_index"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">"data_access"</span>: [&#123;</span><br><span class="line">            <span class="string">"type"</span>: <span class="string">"write"</span>,</span><br><span class="line">            <span class="string">"scope"</span>: <span class="string">"eosio.auth"</span>,</span><br><span class="line">            <span class="string">"sequence"</span>: <span class="number">21</span></span><br><span class="line">          &#125;,&#123;</span><br><span class="line">            <span class="string">"type"</span>: <span class="string">"write"</span>,</span><br><span class="line">            <span class="string">"scope"</span>: <span class="string">"inita"</span>,</span><br><span class="line">            <span class="string">"sequence"</span>: <span class="number">1</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"deferred_transactions"</span>: []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æŸ¥è¯¢æ–°è´¦æˆ·ä¿¡æ¯"><a href="#æŸ¥è¯¢æ–°è´¦æˆ·ä¿¡æ¯" class="headerlink" title="æŸ¥è¯¢æ–°è´¦æˆ·ä¿¡æ¯"></a>æŸ¥è¯¢æ–°è´¦æˆ·ä¿¡æ¯</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">$ ./eosioc get account currency</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿”å›ä¿¡æ¯ï¼š</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"account_name"</span>: <span class="string">"currency"</span>,</span><br><span class="line">  <span class="string">"eos_balance"</span>: <span class="string">"0.0000 EOS"</span>,</span><br><span class="line">  <span class="string">"staked_balance"</span>: <span class="string">"1.0000 EOS"</span>,</span><br><span class="line">  <span class="string">"unstaking_balance"</span>: <span class="string">"0.0000 EOS"</span>,</span><br><span class="line">  <span class="string">"last_unstaking_time"</span>: <span class="string">"2035-10-29T06:32:22"</span>,</span><br><span class="line">  <span class="string">"permissions"</span>: [&#123;</span><br><span class="line">      <span class="string">"perm_name"</span>: <span class="string">"active"</span>,</span><br><span class="line">      <span class="string">"parent"</span>: <span class="string">"owner"</span>,</span><br><span class="line">      <span class="string">"required_auth"</span>: &#123;</span><br><span class="line">        <span class="string">"threshold"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">"accounts"</span>: [],</span><br><span class="line">        <span class="string">"keys"</span>: [&#123;</span><br><span class="line">            <span class="string">"key"</span>: <span class="string">"EOS6VJWWuc6C5p75P2NMNyFM4wYRcAx41NXD1nW7EVdFMGFTejMhZ"</span>,</span><br><span class="line">            <span class="string">"weight"</span>: <span class="number">1</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,&#123;</span><br><span class="line">      <span class="string">"perm_name"</span>: <span class="string">"owner"</span>,</span><br><span class="line">      <span class="string">"parent"</span>: <span class="string">""</span>,</span><br><span class="line">      <span class="string">"required_auth"</span>: &#123;</span><br><span class="line">        <span class="string">"threshold"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">"accounts"</span>: [],</span><br><span class="line">        <span class="string">"keys"</span>: [&#123;</span><br><span class="line">            <span class="string">"key"</span>: <span class="string">"EOS6ayDacXRvP8ZdLW4LNHvRsPeBQBbzvtm7HSkBuyvnLEkAUpfsS"</span>,</span><br><span class="line">            <span class="string">"weight"</span>: <span class="number">1</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å¯¼å…¥å‰é¢ç”Ÿæˆçš„activiteæƒé™çš„ç§é’¥"><a href="#å¯¼å…¥å‰é¢ç”Ÿæˆçš„activiteæƒé™çš„ç§é’¥" class="headerlink" title="å¯¼å…¥å‰é¢ç”Ÿæˆçš„activiteæƒé™çš„ç§é’¥"></a>å¯¼å…¥å‰é¢ç”Ÿæˆçš„activiteæƒé™çš„ç§é’¥</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./eosioc wallet import -n wangwei XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</span><br></pre></td></tr></table></figure><blockquote><p>EOS å‡ ä¸ªå¯†é’¥çš„ç‰¹ç‚¹</p><blockquote><p>å…¬é’¥ä»¥<code>EOS</code>æ‰“å¤´</p><p>ç§é’¥ä»¥<code>5</code>æ‰“å¤´</p><p>é’±åŒ…å¯†é’¥ä»¥<code>PW</code>æ‰“å¤´</p></blockquote></blockquote><h3 id="ä¸Šä¼ æ ·ä¾‹åˆçº¦åˆ°åŒºå—é“¾ä¸Š"><a href="#ä¸Šä¼ æ ·ä¾‹åˆçº¦åˆ°åŒºå—é“¾ä¸Š" class="headerlink" title="ä¸Šä¼ æ ·ä¾‹åˆçº¦åˆ°åŒºå—é“¾ä¸Š"></a>ä¸Šä¼ æ ·ä¾‹åˆçº¦åˆ°åŒºå—é“¾ä¸Š</h3><h5 id="æ£€æŸ¥currencyè´¦å·æ˜¯å¦å·²ç»å­˜åœ¨åˆçº¦"><a href="#æ£€æŸ¥currencyè´¦å·æ˜¯å¦å·²ç»å­˜åœ¨åˆçº¦" class="headerlink" title="æ£€æŸ¥currencyè´¦å·æ˜¯å¦å·²ç»å­˜åœ¨åˆçº¦"></a>æ£€æŸ¥<code>currency</code>è´¦å·æ˜¯å¦å·²ç»å­˜åœ¨åˆçº¦</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ./eosioc get code currency</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿”å›ä¿¡æ¯å¦‚ä¸‹</span></span><br><span class="line">code hash: <span class="number">0000000000000000000000000000000000000000000000000000000000000000</span></span><br></pre></td></tr></table></figure><h5 id="ä½¿ç”¨currencyè´¦å·ä¸Šä¼ åˆçº¦"><a href="#ä½¿ç”¨currencyè´¦å·ä¸Šä¼ åˆçº¦" class="headerlink" title="ä½¿ç”¨currencyè´¦å·ä¸Šä¼ åˆçº¦"></a>ä½¿ç”¨<code>currency</code>è´¦å·ä¸Šä¼ åˆçº¦</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line">$ ./eosioc set contract currency ../../contracts/currency/currency.wast ../../contracts/currency/currency.abi</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿”å›ä¿¡æ¯</span></span><br><span class="line">Reading WAST...</span><br><span class="line">Assembling WASM...</span><br><span class="line">Publishing contract...</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"transaction_id"</span>: <span class="string">"7566cf7ddbce99f64690c0a4d22577d0ee8154b7579be135b9e797356ea8cda1"</span>,</span><br><span class="line">  <span class="string">"processed"</span>: &#123;</span><br><span class="line">    <span class="string">"status"</span>: <span class="string">"executed"</span>,</span><br><span class="line">    <span class="string">"id"</span>: <span class="string">"7566cf7ddbce99f64690c0a4d22577d0ee8154b7579be135b9e797356ea8cda1"</span>,</span><br><span class="line">    <span class="string">"action_traces"</span>: [</span><br><span class="line">      null,</span><br><span class="line">      null,</span><br><span class="line">      null,&#123;</span><br><span class="line">        <span class="string">"receiver"</span>: <span class="string">"eosio"</span>,</span><br><span class="line">        <span class="string">"act"</span>: &#123;</span><br><span class="line">          <span class="string">"account"</span>: <span class="string">"eosio"</span>,</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"setcode"</span>,</span><br><span class="line">          <span class="string">"authorization"</span>: [&#123;</span><br><span class="line">              <span class="string">"actor"</span>: <span class="string">"currency"</span>,</span><br><span class="line">              <span class="string">"permission"</span>: <span class="string">"active"</span></span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          <span class="string">"data"</span>: &#123;</span><br><span class="line">            <span class="string">"account"</span>: <span class="string">"currency"</span>,</span><br><span class="line">            <span class="string">"vmtype"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">"vmversion"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">"code"</span>: <span class="string">"0061736d0100000001570f60017e0060027f7f0060037f7f7f017f60047e7e7f7f017f60017f017f60057e7e7e7f7f017f6000017f60027f7f017f60000060027e7e0060027e7e017f60017f0060047f7e7e7f0060047e7e7e7f0060037f7f7f0002b3010b03656e760b616374696f6e5f73697a65000603656e7606617373657274000103656e76086c6f61645f693634000503656e76066d656d637079000203656e76066d656d736574000203656e760b726561645f616374696f6e000703656e760c726571756972655f61757468000003656e7611726571756972655f726563697069656e74000003656e76047362726b000403656e760b73656e645f696e6c696e65000103656e760973746f72655f693634000303161508090a0b0b0b0b0c0c0d02010b07070704070e07010404017000000503010001073003066d656d6f72790200056170706c79000c1b5f474c4f42414c5f5f7375625f495f63757272656e63792e637070000b0af44015f202004100420037028c4041004200370294404100420037029c40410042003702a440410042003702ac40410041003602b440410041003602b840410041003602bc40410041003602c040410041003602c440410041003602c840410041003602cc40410041003602d040410041003602d440410041003602d840410041003602dc40410041003602e040410041003602e440410041003602e840410041003602ec40410041003602f040410041003602f440410041003602f840410041003602fc404100410036028041410041003602844141004100360288414100410036028c414100410036029041410041003602944141004100360298414100410036029c41410041003602a041410041003602a441410041003602a841410041003602ac41410041003602b041410041003602b441410041003602b841410041003602bc41410041003602c041410041003602c441410041003602c841410041003602cc41410041003602d041410041003602d4410b090020002001100d1a0b990201057f4100410028020441306b2206360204410021050240200042808080f0d1a9ddd7c600520d000240024002402001428080808080a0e998f600510d00200142808080b8d585cfe64d520d032006100e2006100f200641286a2d0000450d022006412c6a2802002205450d0220052005280200417f6a220436020020040d02200641246a2802002202450d0241002802cc4122044101480d02418cc00021052004410c6c418cc0006a21030340200541046a2802002204450d030240200441046a20024b0d00200420052802006a20024b0d030b2005410c6a22052003490d000c030b0b20061010200610110c010b2002417c6a2205200528020041ffffffff07713602000b410121050b4100200641306a36020420050b3301037f41004100280204220310002201410f6a4170716b22023602042002200110051a200020022001101d410020033602040ba80304017e017f027e027f4100410028020441306b22063602042000290300100620002903002101200029030810072001100720002903002101200642003703182006428486d59205370310200641206a428486d592052001200641106a10132006290328210320002903102104200041186a2202290300428486d592055141e0c1001001200320045a4180c4001001410141d0c20010012006428486d59205370320410141f0c20010012006200641206a410810031a2006200320047d370320410141f0c200100120064108722205200641206a410810031a20014280808080f2a9d3883220064110100a1a20002903082101200642003703182006428486d59205370310200641206a428486d592052001200641106a101320062903282104200029031021032002290300428486d592055141e0c1001001200320047c220420035a41a0c2001001410141d0c20010012006428486d59205370320410141f0c20010012006200641206a410810031a20062004370320410141f0c20010012005200641206a410810031a20014280808080f2a9d3883220064110100a1a4100200641306a3602040b8c0101047f41004100280204220410002201410f6a4170716b22023602042002200110051a200041106a220342848abd9a0537030020004200370308200141074b41f0c300100120002002410810031a2001417871220141084741f0c3001001200041086a200241086a410810031a200141104741f0c30010012003200241106a410810031a410020043602040bc30505027f017e017f017e017f4100410028020441d0006b220636020442808080f0d1a9ddd7c6001006200642003703482006428486d59205370340200641106a428486d5920542808080f0d1a9ddd7c600200641c0006a101220002903082103200041106a2202290300428486d592055141e0c1001001200320062903187c20035a41a0c20010012006200320062903187c370318410141d0c200100120062006290310370340410141f0c2001001200641206a200641c0006a410810031a20062006290318370340410141f0c2001001200641206a4108722204200641c0006a410810031a42808080f0d1a9ddd7c60042808080808080e4a646200641206a4110100a1a200642003703382006428486d59205370330200641c0006a428486d5920542808080f0d1a9ddd7c600200641306a101320062903482105200029030821032002290300428486d592055141e0c1001001200320057c220520035a41a0c2001001410141d0c20010012006428486d59205370340410141f0c2001001200641206a200641c0006a410810031a20062005370340410141f0c20010012004200641c0006a410810031a42808080f0d1a9ddd7c6004280808080f2a9d38832200641206a4110100a1a20002903082103200029030021052002290300428486d592055141e0c1001001200641003a0008200642003703002006410036020c42808080f0d1a9ddd7c6002005200320061014024020062d0008450d002006410c6a2802002200450d0020002000280200417f6a220236020020020d0020062802042204450d0041002802cc4122024101480d00418cc00021002002410c6c418cc0006a21010340200041046a2802002202450d0102400240200241046a20044b0d00200220002802006a20044b0d010b2000410c6a22002001490d010c020b0b2004417c6a2200200028020041ffffffff07713602000b4100200641d0006a3602040bba0201027f4100410028020441a0086b22053602042005200137030002400240200242808080f0d1a9ddd7c60042808080808080e4a646200541800810022204417f4c0d0020054200370388082005428486d5920537038008200441074b41f0c300100120054180086a2005410810031a200441787141084741f0c300100120054180086a41086a2005410872410810031a200041086a20052903880837030020002005290380083703000c010b410141d0c20010012005200329030037039808410141f0c200100120054180086a20054198086a410810031a2005200329030837039808410141f0c200100120054180086a41087220054198086a410810031a200242808080808080e4a64620054180086a4110100a1a200041086a2003290308370300200020032903003703000b4100200541a0086a3602040bba0201027f4100410028020441a0086b22053602042005200137030002400240200242808080f0d1a9ddd7c6004280808080f2a9d38832200541800810022204417f4c0d0020054200370388082005428486d5920537038008200441074b41f0c300100120054180086a2005410810031a200441787141084741f0c300100120054180086a41086a2005410872410810031a200041086a20052903880837030020002005290380083703000c010b410141d0c20010012005200329030037039808410141f0c200100120054180086a20054198086a410810031a2005200329030837039808410141f0c200100120054180086a41087220054198086a410810031a20024280808080f2a9d3883220054180086a4110100a1a200041086a2003290308370300200020032903003703000b4100200541a0086a3602040bbe0803077f047e017f410041002802044180016b220f3602044200210c423b210b4180c300210a4200210d034002400240024002400240200c4205560d00200a2c00002204419f7f6a41ff017141194b0d01200441a5016a21040c020b4200210e200c420b580d020c030b200441d0016a41002004414f6a41ff01714105491b21040b2004ad423886423887210e0b200e421f83200b42ffffffff0f8386210e0b200a41016a210a200c42017c210c200e200d84210d200b427b7c220b427a520d000b200f200d370340200f42808080f0d1a9ddd7c600370338410141e0c100100120032d0008210820032802002105200328020421040240200328020c220a450d00200a200a28020041016a3602000b200f41206a428486d59205370300200f41086a41246a2004360200200f41306a220320083a0000200f2001370310200f2000370308200f2002370318200f2005360228200f41346a200a3602000240200a450d00200a200a28020041016a3602000b200f41d8006a4101200f41386a10152105200f41c8006a41246a22094100360200200f4200370264200f42808080f0d1a9ddd7c600370348200f42808080b8d585cfe64d370350200f41f0006a200f41086a10162009200f280278360200200f200f290370370264024020032d0000450d00200f41346a2802002203450d0020032003280200417f6a220936020020090d00200f412c6a2802002206450d0041002802cc4122094101480d00418cc00021032009410c6c418cc0006a21070340200341046a2802002209450d0102400240200941046a20064b0d00200920032802006a20064b0d010b2003410c6a22032007490d010c020b0b2006417c6a2203200328020041ffffffff07713602000b0240200841ff0171450d00200a450d00200a200a280200417f6a220336020020030d002004450d0041002802cc4122034101480d00418cc000210a2003410c6c418cc0006a21080340200a41046a2802002203450d0102400240200341046a20044b0d002003200a2802006a20044b0d010b200a410c6a220a2008490d010c020b0b2004417c6a220a200a28020041ffffffff07713602000b200f41c8006a10170240200f2802642203450d0041002802cc4122044101480d00418cc000210a2004410c6c418cc0006a21080340200a41046a2802002204450d0102400240200441046a20034b0d002004200a2802006a20034b0d010b200a410c6a220a2008490d010c020b0b2003417c6a220a200a28020041ffffffff07713602000b200f41ec006a4100360200200f41e4006a4200370200024020052802002203450d0041002802cc4122044101480d00418cc000210a2004410c6c418cc0006a21080340200a41046a2802002204450d0102400240200441046a20034b0d002004200a2802006a20034b0d010b200a410c6a220a2008490d010c020b0b2003417c6a220a200a28020041ffffffff07713602000b4100200f4180016a3602040ba207010b7f20004100360208200042003702000240024002402001450d00410c2001410474101821070240200041046a2204280200450d004100210b4100210c03402007200b6a22082000280200200b6a2209290300370300200841086a200941086a290300370300200b41106a210b200c41016a220c2004280200490d000b0b024020002802002208450d0041002802cc41220c4101480d00418cc000210b200c410c6c418cc0006a21090340200b41046a280200220c450d0102400240200c41046a20084b0d00200c200b2802006a20084b0d010b200b410c6a220b2009490d010c020b0b2008417c6a220b200b28020041ffffffff07713602000b20002007360200200041086a220620013602002001450d014100210a0240200041046a220728020022082001220b470d004102210d0c030b4100210d0c020b4110210d0c010b4110210d0b037f024002400240024002400240024002400240024002400240024002400240024002400240024002400240024002400240024002400240024002400240200d0e11020304050607090a010b0c0d0e0f000810100b2009417c6a220b200b28020041ffffffff0771360200200728020021084108210d0c1d0b20002004360200200620033602004100210d0c1c0b200028020020084104746a220b2002290300370300200b41086a200241086a2903003703002007200728020041016a2208360200200a41016a220a2001460d0e4101210d0c1b0b20082006280200220b470d0f4102210d0c1a0b417f2108200b417f460d0d4103210d0c190b410c200b41016a2203410474101821042007280200450d0e4104210d0c180b4100210b4100210c4105210d0c170b2004200b6a22082000280200200b6a2209290300370300200841086a200941086a290300370300200b41106a210b200c41016a220c20072802002208490d0d0c0e0b410021084106210d0c150b20002802002209450d0d4107210d0c140b41002802cc41220c4101480d0d4109210d0c130b418cc000210b200c410c6c418cc0006a2105410a210d0c120b200b41046a280200220c450d0c410b210d0c110b200c41046a20094b0d0e410c210d0c100b200c200b2802006a20094b0d0e410d210d0c0f0b200b410c6a220b2005490d0a0c0b0b20000f0b4110210d0c0c0b4100210d0c0b0b4100210d0c0a0b410f210d0c090b4105210d0c080b4106210d0c070b4108210d0c060b4108210d0c050b4108210d0c040b410a210d0c030b4108210d0c020b410d210d0c010b410e210d0c000b0b820303057f017e017f4100410028020441106b220836020420004100360208200042003702004160200128022022036b21062003ad210703402006417f6a2106200742078822074200520d000b410020066b21024100210502402006450d00410c200210182105200041086a20023602002000200536020020052103200221040340200341003a0000200341016a21032004417f6a22040d000b0b200041046a200236020020082005360204200820053602002008200520066b36020820082001101c1a200141206a350200210720082802042106200841086a210503402007a721032008200742078822074200522204410774200341ff0071723a000f200528020020066b41004a41f0c200100120082802042008410f6a410110031a2008200828020441016a220636020420040d000b0240200141206a2802002203450d00200141246a2802002104200841086a28020020066b20034e41f0c200100120082802042004200310031a2008200828020420036a3602040b4100200841106a3602040ba80302017e057f4100410028020441206b2206360204200041146a280200220341047441106a21022003ad21010340200241016a2102200142078822014200520d000b200041206a280200220320026a21022003ad21010340200241016a2102200142078822014200520d000b024002402002450d00410c2002101822052103200221040340200341003a0000200341016a21032004417f6a22040d000c020b0b410021050b200620053602082006200520026a220336021020062000290300370318200241074a41f0c20010012005200641186a410810031a200620002903083703182003200541086a22046b41074a41f0c20010012004200641186a410810031a2006200541106a36020c200641086a200041106a10192000411c6a101a1a20052002100902402005450d0041002802cc4122034101480d00418cc00021022003410c6c418cc0006a21040340200241046a2802002203450d0102400240200341046a20054b0d00200320022802006a20054b0d010b2002410c6a22022004490d010c020b0b2005417c6a2202200228020041ffffffff07713602000b4100200641206a3602040bd804010c7f02402001450d00024020002802c041220d0d004110210d200041c0c1006a41103602000b200141086a200141046a41077122026b200120021b210202400240024020002802c441220a200d4f0d002000200a410c6c6a4180c0006a21010240200a0d0020004184c0006a220d2802000d0020014180c000360200200d2000360200200041004180c00010041a0b200241046a210a034002402001280208220d200a6a20012802004b0d002001280204200d6a220d200d28020041808080807871200272360200200141086a22012001280200200a6a360200200d200d28020041808080807872360200200d41046a22010d030b2000101b22010d000b0b41fcffffff0720026b2104200041c8c1006a210b200041c0c1006a210c20002802c8412203210d03402000200d410c6c6a22014188c0006a28020020014180c0006a2205280200464190c300100120014184c0006a280200220641046a210d0340200620052802006a2107200d417c6a2208280200220941ffffffff07712101024020094100480d000240200120024f0d000340200d20016a220a20074f0d01200a280200220a4100480d012001200a41ffffffff07716a41046a22012002490d000b0b20082001200220012002491b200941808080807871723602000240200120024d0d00200d20026a200420016a41ffffffff07713602000b200120024f0d040b200d20016a41046a220d2007490d000b41002101200b4100200b28020041016a220d200d200c280200461b220d360200200d2003470d000b0b20010f0b2008200828020041808080807872360200200d0f0b41000bc40203037f017e037f4100410028020441106b22083602042000280204210620013502042105200041086a2103200041046a210403402005a721072008200542078822054200522202410774200741ff0071723a0008200328020020066b41004a41f0c20010012004280200200841086a410110031a2004200428020041016a220636020020020d000b0240200141046a2802002204450d002001280200220720044104746a2103200041046a2104034020082007290300370308200041086a220228020020066b41074a41f0c20010012004280200200841086a410810031a2004200428020041086a22063602002008200741086a290300370308200228020020066b41074a41f0c20010012004280200200841086a410810031a2004200428020041086a2206360200200741106a22072003470d000b0b4100200841106a36020420000b860203047f017e027f4100410028020441106b22083602042000280204210720013502042106200041086a2104200041046a210503402006a721022008200642078822064200522203410774200241ff0071723a000f200428020020076b41004a41f0c200100120052802002008410f6a410110031a2005200528020041016a220736020020030d000b0240200141046a2802002203450d0020012802002105200041086a2104200041046a21020340200820052d00003a000e200428020020076b41004a41f0c200100120022802002008410e6a410110031a2002200228020041016a2207360200200541016a21052003417f6a22030d000b0b4100200841106a36020420000b870301077f200020002802c4412201410c6c6a22064180c0006a210702400240418080c000410010086b220241004c0d00200241808004200241808004491b22021008220320064184c0006a2802002204200728020022066a460d010240200620002001410c6c6a4188c0006a22052802002201460d00200420016a2204200428020041808080807871417c20016b20066a72360200200520072802003602002004200428020041ffffffff07713602000b200041c4c1006a2207200728020041016a220736020020002007410c6c6a22004184c0006a200336020020004180c0006a2200200236020020034100200210041a20000f0b02402007280200220320064188c0006a22042802002206460d0020002001410c6c6a4184c0006a28020020066a2202200228020041808080807871417c20066b20036a72360200200420072802003602002002200228020041ffffffff07713602000b2000200041c4c1006a220728020041016a22023602c0412007200236020041000f0b2007200620026a36020020070b870201027f4100410028020441106b220336020420032001290300370308200028020820002802046b41074a41f0c20010012000280204200341086a410810031a2000200028020441086a220236020420032001290308370308200028020820026b41074a41f0c20010012000280204200341086a410810031a2000200028020441086a220236020420032001290310370308200028020820026b41074a41f0c20010012000280204200341086a410810031a2000200028020441086a22023602042003200141186a290300370308200028020820026b41074a41f0c20010012000280204200341086a410810031a2000200028020441086a3602044100200341106a36020420000ba00203017f017e027f4100410028020441106b2206360204420021042000420037031020004200370320200041186a42848abd9a0537030041002105200041286a41003a00002000412c6a410036020020062001360204200620013602002006200120026a36020820062000101e1a20062802042102200641086a21030340200220032802004941b0c4001001200628020422022d000021012006200241016a2202360204200141ff0071200541ff0171220574ad2004842104200541076a210520014107760d000b200041206a2004a72201101f02402001450d00200041246a2802002105200641086a28020020062802046b20014f41f0c300100120052006280204200110031a2006200628020420016a3602040b4100200641106a3602040bd40101017f200028020820002802046b41074b41f0c300100120012000280204410810031a2000200028020441086a2202360204200028020820026b41074b41f0c3001001200141086a2000280204410810031a2000200028020441086a2202360204200028020820026b41074b41f0c3001001200141106a2000280204410810031a2000200028020441086a2202360204200028020820026b41074b41f0c3001001200141186a22012000280204410810031a2000200028020441086a3602042001290300428486d592055141c0c400100120000beb0301057f0240024002400240024002400240024002402001450d002000280200220420014d0d0120002001360200200028020420016a41003a00000f0b20002d0008450d072000410c6a2802002201450d0720012001280200417f6a22043602002004450d010c070b200420014f0d05410c2001101822022000280204200028020010031a20002d0008450d042000410c6a2802002204450d0420042004280200417f6a22033602002003450d010c040b20002802042202450d0541002802cc4122044101480d05418cc00021012004410c6c418cc0006a21030340200141046a2802002204450d060240200441046a20024b0d00200420012802006a20024b0d030b2001410c6a22012003490d000c060b0b200041046a2802002205450d0241002802cc4122034101480d02418cc00021042003410c6c418cc0006a21060340200441046a2802002203450d030240200341046a20054b0d00200320042802006a20054b0d030b2004410c6a22042006490d000c030b0b2002417c6a2201200128020041ffffffff07713602000c030b2005417c6a2204200428020041ffffffff07713602000b20002001360200200041046a2002360200200041086a41013a00002000410c6a41003602000b0f0b20004200370200200041086a41013a00002000410c6a41003602000b0bfb020b0041040b04603200000041e0c1000b3c617474656d707420746f20636f6e73747275637420746f6b656e2066726f6d206173736574207769746820646966666572656e742073796d626f6c000041a0c2000b26696e7465676572206f766572666c6f7720616464696e6720746f6b656e2062616c616e6365000041d0c2000b1b73696e676c65746f6e20746f6f2062696720746f2073746f7265000041f0c2000b06777269746500004180c3000b0761637469766500004190c3000b566d616c6c6f635f66726f6d5f6672656564207761732064657369676e656420746f206f6e6c792062652063616c6c6564206166746572205f686561702077617320636f6d706c6574656c7920616c6c6f6361746564000041f0c3000b057265616400004180c4000b2c696e746567657220756e646572666c6f77207375627472616374696e6720746f6b656e2062616c616e6365000041b0c4000b04676574000041c0c4000b16756e657870656374656420617373657420747970650000a312046e616d65200b616374696f6e5f73697a650006617373657274020000086c6f61645f693634050000000000066d656d63707903000000066d656d736574030000000b726561645f616374696f6e0200000c726571756972655f61757468010011726571756972655f726563697069656e740100047362726b01000b73656e645f696e6c696e650200000973746f72655f69363404000000001b5f474c4f42414c5f5f7375625f495f63757272656e63792e63707000056170706c79020130013181015f5a4e35656f73696f386469737061746368494e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545454e53345f31337472616e736665725f6d656d6f454e53345f356973737565454a454545627979070130013101320133013401350136755f5a4e35656f73696f3133756e7061636b5f616374696f6e494e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c7931333831333139343238457945454531337472616e736665725f6d656d6f454545545f76040130013101320133615f5a4e35656f73696f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545326f6e45524b4e53335f387472616e73666572450701300131013201330134013501366c5f5a4e35656f73696f3133756e7061636b5f616374696f6e494e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545356973737565454545545f7605013001310132013301345e5f5a4e35656f73696f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545326f6e45524b4e53335f35697373756545070130013101320133013401350136af015f5a4e35656f73696f377461626c653634494c7935303933343138363737363535353638333834454c793134323839323335353232333930383531353834454e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545313463757272656e63795f7374617473454531336765745f6f725f637265617465457979524b53355f06013001310132013301340135a6015f5a4e35656f73696f377461626c653634494c7935303933343138363737363535353638333834454c7933363037373439373738373335313034303030454e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545376163636f756e74454531336765745f6f725f637265617465457979524b53355f060130013101320133013401356f5f5a4e35656f73696f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c793133383133313934323845794545453135696e6c696e655f7472616e7366657245797953325f4e535f36737472696e6745100130013101320133013401350136013701380139023130023131023132023133023134023135315f5a4e35656f73696f36766563746f72494e535f31367065726d697373696f6e5f6c6576656c45454332456a524b53315f0e01300131013201330134013501360137013801390231300231310231320231337a5f5a4e35656f73696f347061636b494e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c7931333831333139343238457945454531337472616e736665725f6d656d6f4545454e535f36766563746f7249634545524b545f09013001310132013301340135013601370138185f5a4e4b35656f73696f36616374696f6e3473656e644576070130013101320133013401350136225f5a4e35656f73696f31346d656d6f72795f6d616e61676572366d616c6c6f63456d0e0130013101320133013401350136013701380139023130023131023132023133505f5a4e35656f73696f6c73494e535f31306461746173747265616d49506345454e535f31367065726d697373696f6e5f6c6576656c45454552545f53365f524b4e535f36766563746f724954305f4545090130013101320133013401350136013701383b5f5a4e35656f73696f6c73494e535f31306461746173747265616d495063454563454552545f53355f524b4e535f36766563746f724954305f4545090130013101320133013401350136013701382d5f5a4e35656f73696f31346d656d6f72795f6d616e6167657231366e6578745f6163746976655f68656170457608013001310132013301340135013601377b5f5a4e35656f73696f6c73494e535f31306461746173747265616d4950634545454552545f53355f524b4e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545387472616e7366657245040130013101320133705f5a4e35656f73696f36756e7061636b494e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c7931333831333139343238457945454531337472616e736665725f6d656d6f454545545f504b636a0701300131013201330134013501367b5f5a4e35656f73696f7273494e535f31306461746173747265616d49504b634545454552545f53365f524e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545387472616e736665724503013001310132195f5a4e35656f73696f36737472696e6736726573697a65456a070130013101320133013401350136"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"hex_data"</span>: <span class="string">"0000001e4d75af46000087590061736d0100000001570f60017e0060027f7f0060037f7f7f017f60047e7e7f7f017f60017f017f60057e7e7e7f7f017f6000017f60027f7f017f60000060027e7e0060027e7e017f60017f0060047f7e7e7f0060047e7e7e7f0060037f7f7f0002b3010b03656e760b616374696f6e5f73697a65000603656e7606617373657274000103656e76086c6f61645f693634000503656e76066d656d637079000203656e76066d656d736574000203656e760b726561645f616374696f6e000703656e760c726571756972655f61757468000003656e7611726571756972655f726563697069656e74000003656e76047362726b000403656e760b73656e645f696e6c696e65000103656e760973746f72655f693634000303161508090a0b0b0b0b0c0c0d02010b07070704070e07010404017000000503010001073003066d656d6f72790200056170706c79000c1b5f474c4f42414c5f5f7375625f495f63757272656e63792e637070000b0af44015f202004100420037028c4041004200370294404100420037029c40410042003702a440410042003702ac40410041003602b440410041003602b840410041003602bc40410041003602c040410041003602c440410041003602c840410041003602cc40410041003602d040410041003602d440410041003602d840410041003602dc40410041003602e040410041003602e440410041003602e840410041003602ec40410041003602f040410041003602f440410041003602f840410041003602fc404100410036028041410041003602844141004100360288414100410036028c414100410036029041410041003602944141004100360298414100410036029c41410041003602a041410041003602a441410041003602a841410041003602ac41410041003602b041410041003602b441410041003602b841410041003602bc41410041003602c041410041003602c441410041003602c841410041003602cc41410041003602d041410041003602d4410b090020002001100d1a0b990201057f4100410028020441306b2206360204410021050240200042808080f0d1a9ddd7c600520d000240024002402001428080808080a0e998f600510d00200142808080b8d585cfe64d520d032006100e2006100f200641286a2d0000450d022006412c6a2802002205450d0220052005280200417f6a220436020020040d02200641246a2802002202450d0241002802cc4122044101480d02418cc00021052004410c6c418cc0006a21030340200541046a2802002204450d030240200441046a20024b0d00200420052802006a20024b0d030b2005410c6a22052003490d000c030b0b20061010200610110c010b2002417c6a2205200528020041ffffffff07713602000b410121050b4100200641306a36020420050b3301037f41004100280204220310002201410f6a4170716b22023602042002200110051a200020022001101d410020033602040ba80304017e017f027e027f4100410028020441306b22063602042000290300100620002903002101200029030810072001100720002903002101200642003703182006428486d59205370310200641206a428486d592052001200641106a10132006290328210320002903102104200041186a2202290300428486d592055141e0c1001001200320045a4180c4001001410141d0c20010012006428486d59205370320410141f0c20010012006200641206a410810031a2006200320047d370320410141f0c200100120064108722205200641206a410810031a20014280808080f2a9d3883220064110100a1a20002903082101200642003703182006428486d59205370310200641206a428486d592052001200641106a101320062903282104200029031021032002290300428486d592055141e0c1001001200320047c220420035a41a0c2001001410141d0c20010012006428486d59205370320410141f0c20010012006200641206a410810031a20062004370320410141f0c20010012005200641206a410810031a20014280808080f2a9d3883220064110100a1a4100200641306a3602040b8c0101047f41004100280204220410002201410f6a4170716b22023602042002200110051a200041106a220342848abd9a0537030020004200370308200141074b41f0c300100120002002410810031a2001417871220141084741f0c3001001200041086a200241086a410810031a200141104741f0c30010012003200241106a410810031a410020043602040bc30505027f017e017f017e017f4100410028020441d0006b220636020442808080f0d1a9ddd7c6001006200642003703482006428486d59205370340200641106a428486d5920542808080f0d1a9ddd7c600200641c0006a101220002903082103200041106a2202290300428486d592055141e0c1001001200320062903187c20035a41a0c20010012006200320062903187c370318410141d0c200100120062006290310370340410141f0c2001001200641206a200641c0006a410810031a20062006290318370340410141f0c2001001200641206a4108722204200641c0006a410810031a42808080f0d1a9ddd7c60042808080808080e4a646200641206a4110100a1a200642003703382006428486d59205370330200641c0006a428486d5920542808080f0d1a9ddd7c600200641306a101320062903482105200029030821032002290300428486d592055141e0c1001001200320057c220520035a41a0c2001001410141d0c20010012006428486d59205370340410141f0c2001001200641206a200641c0006a410810031a20062005370340410141f0c20010012004200641c0006a410810031a42808080f0d1a9ddd7c6004280808080f2a9d38832200641206a4110100a1a20002903082103200029030021052002290300428486d592055141e0c1001001200641003a0008200642003703002006410036020c42808080f0d1a9ddd7c6002005200320061014024020062d0008450d002006410c6a2802002200450d0020002000280200417f6a220236020020020d0020062802042204450d0041002802cc4122024101480d00418cc00021002002410c6c418cc0006a21010340200041046a2802002202450d0102400240200241046a20044b0d00200220002802006a20044b0d010b2000410c6a22002001490d010c020b0b2004417c6a2200200028020041ffffffff07713602000b4100200641d0006a3602040bba0201027f4100410028020441a0086b22053602042005200137030002400240200242808080f0d1a9ddd7c60042808080808080e4a646200541800810022204417f4c0d0020054200370388082005428486d5920537038008200441074b41f0c300100120054180086a2005410810031a200441787141084741f0c300100120054180086a41086a2005410872410810031a200041086a20052903880837030020002005290380083703000c010b410141d0c20010012005200329030037039808410141f0c200100120054180086a20054198086a410810031a2005200329030837039808410141f0c200100120054180086a41087220054198086a410810031a200242808080808080e4a64620054180086a4110100a1a200041086a2003290308370300200020032903003703000b4100200541a0086a3602040bba0201027f4100410028020441a0086b22053602042005200137030002400240200242808080f0d1a9ddd7c6004280808080f2a9d38832200541800810022204417f4c0d0020054200370388082005428486d5920537038008200441074b41f0c300100120054180086a2005410810031a200441787141084741f0c300100120054180086a41086a2005410872410810031a200041086a20052903880837030020002005290380083703000c010b410141d0c20010012005200329030037039808410141f0c200100120054180086a20054198086a410810031a2005200329030837039808410141f0c200100120054180086a41087220054198086a410810031a20024280808080f2a9d3883220054180086a4110100a1a200041086a2003290308370300200020032903003703000b4100200541a0086a3602040bbe0803077f047e017f410041002802044180016b220f3602044200210c423b210b4180c300210a4200210d034002400240024002400240200c4205560d00200a2c00002204419f7f6a41ff017141194b0d01200441a5016a21040c020b4200210e200c420b580d020c030b200441d0016a41002004414f6a41ff01714105491b21040b2004ad423886423887210e0b200e421f83200b42ffffffff0f8386210e0b200a41016a210a200c42017c210c200e200d84210d200b427b7c220b427a520d000b200f200d370340200f42808080f0d1a9ddd7c600370338410141e0c100100120032d0008210820032802002105200328020421040240200328020c220a450d00200a200a28020041016a3602000b200f41206a428486d59205370300200f41086a41246a2004360200200f41306a220320083a0000200f2001370310200f2000370308200f2002370318200f2005360228200f41346a200a3602000240200a450d00200a200a28020041016a3602000b200f41d8006a4101200f41386a10152105200f41c8006a41246a22094100360200200f4200370264200f42808080f0d1a9ddd7c600370348200f42808080b8d585cfe64d370350200f41f0006a200f41086a10162009200f280278360200200f200f290370370264024020032d0000450d00200f41346a2802002203450d0020032003280200417f6a220936020020090d00200f412c6a2802002206450d0041002802cc4122094101480d00418cc00021032009410c6c418cc0006a21070340200341046a2802002209450d0102400240200941046a20064b0d00200920032802006a20064b0d010b2003410c6a22032007490d010c020b0b2006417c6a2203200328020041ffffffff07713602000b0240200841ff0171450d00200a450d00200a200a280200417f6a220336020020030d002004450d0041002802cc4122034101480d00418cc000210a2003410c6c418cc0006a21080340200a41046a2802002203450d0102400240200341046a20044b0d002003200a2802006a20044b0d010b200a410c6a220a2008490d010c020b0b2004417c6a220a200a28020041ffffffff07713602000b200f41c8006a10170240200f2802642203450d0041002802cc4122044101480d00418cc000210a2004410c6c418cc0006a21080340200a41046a2802002204450d0102400240200441046a20034b0d002004200a2802006a20034b0d010b200a410c6a220a2008490d010c020b0b2003417c6a220a200a28020041ffffffff07713602000b200f41ec006a4100360200200f41e4006a4200370200024020052802002203450d0041002802cc4122044101480d00418cc000210a2004410c6c418cc0006a21080340200a41046a2802002204450d0102400240200441046a20034b0d002004200a2802006a20034b0d010b200a410c6a220a2008490d010c020b0b2003417c6a220a200a28020041ffffffff07713602000b4100200f4180016a3602040ba207010b7f20004100360208200042003702000240024002402001450d00410c2001410474101821070240200041046a2204280200450d004100210b4100210c03402007200b6a22082000280200200b6a2209290300370300200841086a200941086a290300370300200b41106a210b200c41016a220c2004280200490d000b0b024020002802002208450d0041002802cc41220c4101480d00418cc000210b200c410c6c418cc0006a21090340200b41046a280200220c450d0102400240200c41046a20084b0d00200c200b2802006a20084b0d010b200b410c6a220b2009490d010c020b0b2008417c6a220b200b28020041ffffffff07713602000b20002007360200200041086a220620013602002001450d014100210a0240200041046a220728020022082001220b470d004102210d0c030b4100210d0c020b4110210d0c010b4110210d0b037f024002400240024002400240024002400240024002400240024002400240024002400240024002400240024002400240024002400240024002400240200d0e11020304050607090a010b0c0d0e0f000810100b2009417c6a220b200b28020041ffffffff0771360200200728020021084108210d0c1d0b20002004360200200620033602004100210d0c1c0b200028020020084104746a220b2002290300370300200b41086a200241086a2903003703002007200728020041016a2208360200200a41016a220a2001460d0e4101210d0c1b0b20082006280200220b470d0f4102210d0c1a0b417f2108200b417f460d0d4103210d0c190b410c200b41016a2203410474101821042007280200450d0e4104210d0c180b4100210b4100210c4105210d0c170b2004200b6a22082000280200200b6a2209290300370300200841086a200941086a290300370300200b41106a210b200c41016a220c20072802002208490d0d0c0e0b410021084106210d0c150b20002802002209450d0d4107210d0c140b41002802cc41220c4101480d0d4109210d0c130b418cc000210b200c410c6c418cc0006a2105410a210d0c120b200b41046a280200220c450d0c410b210d0c110b200c41046a20094b0d0e410c210d0c100b200c200b2802006a20094b0d0e410d210d0c0f0b200b410c6a220b2005490d0a0c0b0b20000f0b4110210d0c0c0b4100210d0c0b0b4100210d0c0a0b410f210d0c090b4105210d0c080b4106210d0c070b4108210d0c060b4108210d0c050b4108210d0c040b410a210d0c030b4108210d0c020b410d210d0c010b410e210d0c000b0b820303057f017e017f4100410028020441106b220836020420004100360208200042003702004160200128022022036b21062003ad210703402006417f6a2106200742078822074200520d000b410020066b21024100210502402006450d00410c200210182105200041086a20023602002000200536020020052103200221040340200341003a0000200341016a21032004417f6a22040d000b0b200041046a200236020020082005360204200820053602002008200520066b36020820082001101c1a200141206a350200210720082802042106200841086a210503402007a721032008200742078822074200522204410774200341ff0071723a000f200528020020066b41004a41f0c200100120082802042008410f6a410110031a2008200828020441016a220636020420040d000b0240200141206a2802002203450d00200141246a2802002104200841086a28020020066b20034e41f0c200100120082802042004200310031a2008200828020420036a3602040b4100200841106a3602040ba80302017e057f4100410028020441206b2206360204200041146a280200220341047441106a21022003ad21010340200241016a2102200142078822014200520d000b200041206a280200220320026a21022003ad21010340200241016a2102200142078822014200520d000b024002402002450d00410c2002101822052103200221040340200341003a0000200341016a21032004417f6a22040d000c020b0b410021050b200620053602082006200520026a220336021020062000290300370318200241074a41f0c20010012005200641186a410810031a200620002903083703182003200541086a22046b41074a41f0c20010012004200641186a410810031a2006200541106a36020c200641086a200041106a10192000411c6a101a1a20052002100902402005450d0041002802cc4122034101480d00418cc00021022003410c6c418cc0006a21040340200241046a2802002203450d0102400240200341046a20054b0d00200320022802006a20054b0d010b2002410c6a22022004490d010c020b0b2005417c6a2202200228020041ffffffff07713602000b4100200641206a3602040bd804010c7f02402001450d00024020002802c041220d0d004110210d200041c0c1006a41103602000b200141086a200141046a41077122026b200120021b210202400240024020002802c441220a200d4f0d002000200a410c6c6a4180c0006a21010240200a0d0020004184c0006a220d2802000d0020014180c000360200200d2000360200200041004180c00010041a0b200241046a210a034002402001280208220d200a6a20012802004b0d002001280204200d6a220d200d28020041808080807871200272360200200141086a22012001280200200a6a360200200d200d28020041808080807872360200200d41046a22010d030b2000101b22010d000b0b41fcffffff0720026b2104200041c8c1006a210b200041c0c1006a210c20002802c8412203210d03402000200d410c6c6a22014188c0006a28020020014180c0006a2205280200464190c300100120014184c0006a280200220641046a210d0340200620052802006a2107200d417c6a2208280200220941ffffffff07712101024020094100480d000240200120024f0d000340200d20016a220a20074f0d01200a280200220a4100480d012001200a41ffffffff07716a41046a22012002490d000b0b20082001200220012002491b200941808080807871723602000240200120024d0d00200d20026a200420016a41ffffffff07713602000b200120024f0d040b200d20016a41046a220d2007490d000b41002101200b4100200b28020041016a220d200d200c280200461b220d360200200d2003470d000b0b20010f0b2008200828020041808080807872360200200d0f0b41000bc40203037f017e037f4100410028020441106b22083602042000280204210620013502042105200041086a2103200041046a210403402005a721072008200542078822054200522202410774200741ff0071723a0008200328020020066b41004a41f0c20010012004280200200841086a410110031a2004200428020041016a220636020020020d000b0240200141046a2802002204450d002001280200220720044104746a2103200041046a2104034020082007290300370308200041086a220228020020066b41074a41f0c20010012004280200200841086a410810031a2004200428020041086a22063602002008200741086a290300370308200228020020066b41074a41f0c20010012004280200200841086a410810031a2004200428020041086a2206360200200741106a22072003470d000b0b4100200841106a36020420000b860203047f017e027f4100410028020441106b22083602042000280204210720013502042106200041086a2104200041046a210503402006a721022008200642078822064200522203410774200241ff0071723a000f200428020020076b41004a41f0c200100120052802002008410f6a410110031a2005200528020041016a220736020020030d000b0240200141046a2802002203450d0020012802002105200041086a2104200041046a21020340200820052d00003a000e200428020020076b41004a41f0c200100120022802002008410e6a410110031a2002200228020041016a2207360200200541016a21052003417f6a22030d000b0b4100200841106a36020420000b870301077f200020002802c4412201410c6c6a22064180c0006a210702400240418080c000410010086b220241004c0d00200241808004200241808004491b22021008220320064184c0006a2802002204200728020022066a460d010240200620002001410c6c6a4188c0006a22052802002201460d00200420016a2204200428020041808080807871417c20016b20066a72360200200520072802003602002004200428020041ffffffff07713602000b200041c4c1006a2207200728020041016a220736020020002007410c6c6a22004184c0006a200336020020004180c0006a2200200236020020034100200210041a20000f0b02402007280200220320064188c0006a22042802002206460d0020002001410c6c6a4184c0006a28020020066a2202200228020041808080807871417c20066b20036a72360200200420072802003602002002200228020041ffffffff07713602000b2000200041c4c1006a220728020041016a22023602c0412007200236020041000f0b2007200620026a36020020070b870201027f4100410028020441106b220336020420032001290300370308200028020820002802046b41074a41f0c20010012000280204200341086a410810031a2000200028020441086a220236020420032001290308370308200028020820026b41074a41f0c20010012000280204200341086a410810031a2000200028020441086a220236020420032001290310370308200028020820026b41074a41f0c20010012000280204200341086a410810031a2000200028020441086a22023602042003200141186a290300370308200028020820026b41074a41f0c20010012000280204200341086a410810031a2000200028020441086a3602044100200341106a36020420000ba00203017f017e027f4100410028020441106b2206360204420021042000420037031020004200370320200041186a42848abd9a0537030041002105200041286a41003a00002000412c6a410036020020062001360204200620013602002006200120026a36020820062000101e1a20062802042102200641086a21030340200220032802004941b0c4001001200628020422022d000021012006200241016a2202360204200141ff0071200541ff0171220574ad2004842104200541076a210520014107760d000b200041206a2004a72201101f02402001450d00200041246a2802002105200641086a28020020062802046b20014f41f0c300100120052006280204200110031a2006200628020420016a3602040b4100200641106a3602040bd40101017f200028020820002802046b41074b41f0c300100120012000280204410810031a2000200028020441086a2202360204200028020820026b41074b41f0c3001001200141086a2000280204410810031a2000200028020441086a2202360204200028020820026b41074b41f0c3001001200141106a2000280204410810031a2000200028020441086a2202360204200028020820026b41074b41f0c3001001200141186a22012000280204410810031a2000200028020441086a3602042001290300428486d592055141c0c400100120000beb0301057f0240024002400240024002400240024002402001450d002000280200220420014d0d0120002001360200200028020420016a41003a00000f0b20002d0008450d072000410c6a2802002201450d0720012001280200417f6a22043602002004450d010c070b200420014f0d05410c2001101822022000280204200028020010031a20002d0008450d042000410c6a2802002204450d0420042004280200417f6a22033602002003450d010c040b20002802042202450d0541002802cc4122044101480d05418cc00021012004410c6c418cc0006a21030340200141046a2802002204450d060240200441046a20024b0d00200420012802006a20024b0d030b2001410c6a22012003490d000c060b0b200041046a2802002205450d0241002802cc4122034101480d02418cc00021042003410c6c418cc0006a21060340200441046a2802002203450d030240200341046a20054b0d00200320042802006a20054b0d030b2004410c6a22042006490d000c030b0b2002417c6a2201200128020041ffffffff07713602000c030b2005417c6a2204200428020041ffffffff07713602000b20002001360200200041046a2002360200200041086a41013a00002000410c6a41003602000b0f0b20004200370200200041086a41013a00002000410c6a41003602000b0bfb020b0041040b04603200000041e0c1000b3c617474656d707420746f20636f6e73747275637420746f6b656e2066726f6d206173736574207769746820646966666572656e742073796d626f6c000041a0c2000b26696e7465676572206f766572666c6f7720616464696e6720746f6b656e2062616c616e6365000041d0c2000b1b73696e676c65746f6e20746f6f2062696720746f2073746f7265000041f0c2000b06777269746500004180c3000b0761637469766500004190c3000b566d616c6c6f635f66726f6d5f6672656564207761732064657369676e656420746f206f6e6c792062652063616c6c6564206166746572205f686561702077617320636f6d706c6574656c7920616c6c6f6361746564000041f0c3000b057265616400004180c4000b2c696e746567657220756e646572666c6f77207375627472616374696e6720746f6b656e2062616c616e6365000041b0c4000b04676574000041c0c4000b16756e657870656374656420617373657420747970650000a312046e616d65200b616374696f6e5f73697a650006617373657274020000086c6f61645f693634050000000000066d656d63707903000000066d656d736574030000000b726561645f616374696f6e0200000c726571756972655f61757468010011726571756972655f726563697069656e740100047362726b01000b73656e645f696e6c696e650200000973746f72655f69363404000000001b5f474c4f42414c5f5f7375625f495f63757272656e63792e63707000056170706c79020130013181015f5a4e35656f73696f386469737061746368494e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545454e53345f31337472616e736665725f6d656d6f454e53345f356973737565454a454545627979070130013101320133013401350136755f5a4e35656f73696f3133756e7061636b5f616374696f6e494e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c7931333831333139343238457945454531337472616e736665725f6d656d6f454545545f76040130013101320133615f5a4e35656f73696f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545326f6e45524b4e53335f387472616e73666572450701300131013201330134013501366c5f5a4e35656f73696f3133756e7061636b5f616374696f6e494e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545356973737565454545545f7605013001310132013301345e5f5a4e35656f73696f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545326f6e45524b4e53335f35697373756545070130013101320133013401350136af015f5a4e35656f73696f377461626c653634494c7935303933343138363737363535353638333834454c793134323839323335353232333930383531353834454e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545313463757272656e63795f7374617473454531336765745f6f725f637265617465457979524b53355f06013001310132013301340135a6015f5a4e35656f73696f377461626c653634494c7935303933343138363737363535353638333834454c7933363037373439373738373335313034303030454e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545376163636f756e74454531336765745f6f725f637265617465457979524b53355f060130013101320133013401356f5f5a4e35656f73696f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c793133383133313934323845794545453135696e6c696e655f7472616e7366657245797953325f4e535f36737472696e6745100130013101320133013401350136013701380139023130023131023132023133023134023135315f5a4e35656f73696f36766563746f72494e535f31367065726d697373696f6e5f6c6576656c45454332456a524b53315f0e01300131013201330134013501360137013801390231300231310231320231337a5f5a4e35656f73696f347061636b494e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c7931333831333139343238457945454531337472616e736665725f6d656d6f4545454e535f36766563746f7249634545524b545f09013001310132013301340135013601370138185f5a4e4b35656f73696f36616374696f6e3473656e644576070130013101320133013401350136225f5a4e35656f73696f31346d656d6f72795f6d616e61676572366d616c6c6f63456d0e0130013101320133013401350136013701380139023130023131023132023133505f5a4e35656f73696f6c73494e535f31306461746173747265616d49506345454e535f31367065726d697373696f6e5f6c6576656c45454552545f53365f524b4e535f36766563746f724954305f4545090130013101320133013401350136013701383b5f5a4e35656f73696f6c73494e535f31306461746173747265616d495063454563454552545f53355f524b4e535f36766563746f724954305f4545090130013101320133013401350136013701382d5f5a4e35656f73696f31346d656d6f72795f6d616e6167657231366e6578745f6163746976655f68656170457608013001310132013301340135013601377b5f5a4e35656f73696f6c73494e535f31306461746173747265616d4950634545454552545f53355f524b4e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545387472616e7366657245040130013101320133705f5a4e35656f73696f36756e7061636b494e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c7931333831333139343238457945454531337472616e736665725f6d656d6f454545545f504b636a0701300131013201330134013501367b5f5a4e35656f73696f7273494e535f31306461746173747265616d49504b634545454552545f53365f524e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545387472616e736665724503013001310132195f5a4e35656f73696f36737472696e6736726573697a65456a070130013101320133013401350136"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"console"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"region_id"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">"cycle_index"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">"data_access"</span>: [&#123;</span><br><span class="line">            <span class="string">"type"</span>: <span class="string">"write"</span>,</span><br><span class="line">            <span class="string">"scope"</span>: <span class="string">"eosio.auth"</span>,</span><br><span class="line">            <span class="string">"sequence"</span>: <span class="number">22</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,&#123;</span><br><span class="line">        <span class="string">"receiver"</span>: <span class="string">"currency"</span>,</span><br><span class="line">        <span class="string">"act"</span>: &#123;</span><br><span class="line">          <span class="string">"account"</span>: <span class="string">"eosio"</span>,</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"setcode"</span>,</span><br><span class="line">          <span class="string">"authorization"</span>: [&#123;</span><br><span class="line">              <span class="string">"actor"</span>: <span class="string">"currency"</span>,</span><br><span class="line">              <span class="string">"permission"</span>: <span class="string">"active"</span></span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          <span class="string">"data"</span>: &#123;</span><br><span class="line">            <span class="string">"account"</span>: <span class="string">"currency"</span>,</span><br><span class="line">            <span class="string">"vmtype"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">"vmversion"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">"code"</span>: <span class="string">"0061736d0100000001570f60017e0060027f7f0060037f7f7f017f60047e7e7f7f017f60017f017f60057e7e7e7f7f017f6000017f60027f7f017f60000060027e7e0060027e7e017f60017f0060047f7e7e7f0060047e7e7e7f0060037f7f7f0002b3010b03656e760b616374696f6e5f73697a65000603656e7606617373657274000103656e76086c6f61645f693634000503656e76066d656d637079000203656e76066d656d736574000203656e760b726561645f616374696f6e000703656e760c726571756972655f61757468000003656e7611726571756972655f726563697069656e74000003656e76047362726b000403656e760b73656e645f696e6c696e65000103656e760973746f72655f693634000303161508090a0b0b0b0b0c0c0d02010b07070704070e07010404017000000503010001073003066d656d6f72790200056170706c79000c1b5f474c4f42414c5f5f7375625f495f63757272656e63792e637070000b0af44015f202004100420037028c4041004200370294404100420037029c40410042003702a440410042003702ac40410041003602b440410041003602b840410041003602bc40410041003602c040410041003602c440410041003602c840410041003602cc40410041003602d040410041003602d440410041003602d840410041003602dc40410041003602e040410041003602e440410041003602e840410041003602ec40410041003602f040410041003602f440410041003602f840410041003602fc404100410036028041410041003602844141004100360288414100410036028c414100410036029041410041003602944141004100360298414100410036029c41410041003602a041410041003602a441410041003602a841410041003602ac41410041003602b041410041003602b441410041003602b841410041003602bc41410041003602c041410041003602c441410041003602c841410041003602cc41410041003602d041410041003602d4410b090020002001100d1a0b990201057f4100410028020441306b2206360204410021050240200042808080f0d1a9ddd7c600520d000240024002402001428080808080a0e998f600510d00200142808080b8d585cfe64d520d032006100e2006100f200641286a2d0000450d022006412c6a2802002205450d0220052005280200417f6a220436020020040d02200641246a2802002202450d0241002802cc4122044101480d02418cc00021052004410c6c418cc0006a21030340200541046a2802002204450d030240200441046a20024b0d00200420052802006a20024b0d030b2005410c6a22052003490d000c030b0b20061010200610110c010b2002417c6a2205200528020041ffffffff07713602000b410121050b4100200641306a36020420050b3301037f41004100280204220310002201410f6a4170716b22023602042002200110051a200020022001101d410020033602040ba80304017e017f027e027f4100410028020441306b22063602042000290300100620002903002101200029030810072001100720002903002101200642003703182006428486d59205370310200641206a428486d592052001200641106a10132006290328210320002903102104200041186a2202290300428486d592055141e0c1001001200320045a4180c4001001410141d0c20010012006428486d59205370320410141f0c20010012006200641206a410810031a2006200320047d370320410141f0c200100120064108722205200641206a410810031a20014280808080f2a9d3883220064110100a1a20002903082101200642003703182006428486d59205370310200641206a428486d592052001200641106a101320062903282104200029031021032002290300428486d592055141e0c1001001200320047c220420035a41a0c2001001410141d0c20010012006428486d59205370320410141f0c20010012006200641206a410810031a20062004370320410141f0c20010012005200641206a410810031a20014280808080f2a9d3883220064110100a1a4100200641306a3602040b8c0101047f41004100280204220410002201410f6a4170716b22023602042002200110051a200041106a220342848abd9a0537030020004200370308200141074b41f0c300100120002002410810031a2001417871220141084741f0c3001001200041086a200241086a410810031a200141104741f0c30010012003200241106a410810031a410020043602040bc30505027f017e017f017e017f4100410028020441d0006b220636020442808080f0d1a9ddd7c6001006200642003703482006428486d59205370340200641106a428486d5920542808080f0d1a9ddd7c600200641c0006a101220002903082103200041106a2202290300428486d592055141e0c1001001200320062903187c20035a41a0c20010012006200320062903187c370318410141d0c200100120062006290310370340410141f0c2001001200641206a200641c0006a410810031a20062006290318370340410141f0c2001001200641206a4108722204200641c0006a410810031a42808080f0d1a9ddd7c60042808080808080e4a646200641206a4110100a1a200642003703382006428486d59205370330200641c0006a428486d5920542808080f0d1a9ddd7c600200641306a101320062903482105200029030821032002290300428486d592055141e0c1001001200320057c220520035a41a0c2001001410141d0c20010012006428486d59205370340410141f0c2001001200641206a200641c0006a410810031a20062005370340410141f0c20010012004200641c0006a410810031a42808080f0d1a9ddd7c6004280808080f2a9d38832200641206a4110100a1a20002903082103200029030021052002290300428486d592055141e0c1001001200641003a0008200642003703002006410036020c42808080f0d1a9ddd7c6002005200320061014024020062d0008450d002006410c6a2802002200450d0020002000280200417f6a220236020020020d0020062802042204450d0041002802cc4122024101480d00418cc00021002002410c6c418cc0006a21010340200041046a2802002202450d0102400240200241046a20044b0d00200220002802006a20044b0d010b2000410c6a22002001490d010c020b0b2004417c6a2200200028020041ffffffff07713602000b4100200641d0006a3602040bba0201027f4100410028020441a0086b22053602042005200137030002400240200242808080f0d1a9ddd7c60042808080808080e4a646200541800810022204417f4c0d0020054200370388082005428486d5920537038008200441074b41f0c300100120054180086a2005410810031a200441787141084741f0c300100120054180086a41086a2005410872410810031a200041086a20052903880837030020002005290380083703000c010b410141d0c20010012005200329030037039808410141f0c200100120054180086a20054198086a410810031a2005200329030837039808410141f0c200100120054180086a41087220054198086a410810031a200242808080808080e4a64620054180086a4110100a1a200041086a2003290308370300200020032903003703000b4100200541a0086a3602040bba0201027f4100410028020441a0086b22053602042005200137030002400240200242808080f0d1a9ddd7c6004280808080f2a9d38832200541800810022204417f4c0d0020054200370388082005428486d5920537038008200441074b41f0c300100120054180086a2005410810031a200441787141084741f0c300100120054180086a41086a2005410872410810031a200041086a20052903880837030020002005290380083703000c010b410141d0c20010012005200329030037039808410141f0c200100120054180086a20054198086a410810031a2005200329030837039808410141f0c200100120054180086a41087220054198086a410810031a20024280808080f2a9d3883220054180086a4110100a1a200041086a2003290308370300200020032903003703000b4100200541a0086a3602040bbe0803077f047e017f410041002802044180016b220f3602044200210c423b210b4180c300210a4200210d034002400240024002400240200c4205560d00200a2c00002204419f7f6a41ff017141194b0d01200441a5016a21040c020b4200210e200c420b580d020c030b200441d0016a41002004414f6a41ff01714105491b21040b2004ad423886423887210e0b200e421f83200b42ffffffff0f8386210e0b200a41016a210a200c42017c210c200e200d84210d200b427b7c220b427a520d000b200f200d370340200f42808080f0d1a9ddd7c600370338410141e0c100100120032d0008210820032802002105200328020421040240200328020c220a450d00200a200a28020041016a3602000b200f41206a428486d59205370300200f41086a41246a2004360200200f41306a220320083a0000200f2001370310200f2000370308200f2002370318200f2005360228200f41346a200a3602000240200a450d00200a200a28020041016a3602000b200f41d8006a4101200f41386a10152105200f41c8006a41246a22094100360200200f4200370264200f42808080f0d1a9ddd7c600370348200f42808080b8d585cfe64d370350200f41f0006a200f41086a10162009200f280278360200200f200f290370370264024020032d0000450d00200f41346a2802002203450d0020032003280200417f6a220936020020090d00200f412c6a2802002206450d0041002802cc4122094101480d00418cc00021032009410c6c418cc0006a21070340200341046a2802002209450d0102400240200941046a20064b0d00200920032802006a20064b0d010b2003410c6a22032007490d010c020b0b2006417c6a2203200328020041ffffffff07713602000b0240200841ff0171450d00200a450d00200a200a280200417f6a220336020020030d002004450d0041002802cc4122034101480d00418cc000210a2003410c6c418cc0006a21080340200a41046a2802002203450d0102400240200341046a20044b0d002003200a2802006a20044b0d010b200a410c6a220a2008490d010c020b0b2004417c6a220a200a28020041ffffffff07713602000b200f41c8006a10170240200f2802642203450d0041002802cc4122044101480d00418cc000210a2004410c6c418cc0006a21080340200a41046a2802002204450d0102400240200441046a20034b0d002004200a2802006a20034b0d010b200a410c6a220a2008490d010c020b0b2003417c6a220a200a28020041ffffffff07713602000b200f41ec006a4100360200200f41e4006a4200370200024020052802002203450d0041002802cc4122044101480d00418cc000210a2004410c6c418cc0006a21080340200a41046a2802002204450d0102400240200441046a20034b0d002004200a2802006a20034b0d010b200a410c6a220a2008490d010c020b0b2003417c6a220a200a28020041ffffffff07713602000b4100200f4180016a3602040ba207010b7f20004100360208200042003702000240024002402001450d00410c2001410474101821070240200041046a2204280200450d004100210b4100210c03402007200b6a22082000280200200b6a2209290300370300200841086a200941086a290300370300200b41106a210b200c41016a220c2004280200490d000b0b024020002802002208450d0041002802cc41220c4101480d00418cc000210b200c410c6c418cc0006a21090340200b41046a280200220c450d0102400240200c41046a20084b0d00200c200b2802006a20084b0d010b200b410c6a220b2009490d010c020b0b2008417c6a220b200b28020041ffffffff07713602000b20002007360200200041086a220620013602002001450d014100210a0240200041046a220728020022082001220b470d004102210d0c030b4100210d0c020b4110210d0c010b4110210d0b037f024002400240024002400240024002400240024002400240024002400240024002400240024002400240024002400240024002400240024002400240200d0e11020304050607090a010b0c0d0e0f000810100b2009417c6a220b200b28020041ffffffff0771360200200728020021084108210d0c1d0b20002004360200200620033602004100210d0c1c0b200028020020084104746a220b2002290300370300200b41086a200241086a2903003703002007200728020041016a2208360200200a41016a220a2001460d0e4101210d0c1b0b20082006280200220b470d0f4102210d0c1a0b417f2108200b417f460d0d4103210d0c190b410c200b41016a2203410474101821042007280200450d0e4104210d0c180b4100210b4100210c4105210d0c170b2004200b6a22082000280200200b6a2209290300370300200841086a200941086a290300370300200b41106a210b200c41016a220c20072802002208490d0d0c0e0b410021084106210d0c150b20002802002209450d0d4107210d0c140b41002802cc41220c4101480d0d4109210d0c130b418cc000210b200c410c6c418cc0006a2105410a210d0c120b200b41046a280200220c450d0c410b210d0c110b200c41046a20094b0d0e410c210d0c100b200c200b2802006a20094b0d0e410d210d0c0f0b200b410c6a220b2005490d0a0c0b0b20000f0b4110210d0c0c0b4100210d0c0b0b4100210d0c0a0b410f210d0c090b4105210d0c080b4106210d0c070b4108210d0c060b4108210d0c050b4108210d0c040b410a210d0c030b4108210d0c020b410d210d0c010b410e210d0c000b0b820303057f017e017f4100410028020441106b220836020420004100360208200042003702004160200128022022036b21062003ad210703402006417f6a2106200742078822074200520d000b410020066b21024100210502402006450d00410c200210182105200041086a20023602002000200536020020052103200221040340200341003a0000200341016a21032004417f6a22040d000b0b200041046a200236020020082005360204200820053602002008200520066b36020820082001101c1a200141206a350200210720082802042106200841086a210503402007a721032008200742078822074200522204410774200341ff0071723a000f200528020020066b41004a41f0c200100120082802042008410f6a410110031a2008200828020441016a220636020420040d000b0240200141206a2802002203450d00200141246a2802002104200841086a28020020066b20034e41f0c200100120082802042004200310031a2008200828020420036a3602040b4100200841106a3602040ba80302017e057f4100410028020441206b2206360204200041146a280200220341047441106a21022003ad21010340200241016a2102200142078822014200520d000b200041206a280200220320026a21022003ad21010340200241016a2102200142078822014200520d000b024002402002450d00410c2002101822052103200221040340200341003a0000200341016a21032004417f6a22040d000c020b0b410021050b200620053602082006200520026a220336021020062000290300370318200241074a41f0c20010012005200641186a410810031a200620002903083703182003200541086a22046b41074a41f0c20010012004200641186a410810031a2006200541106a36020c200641086a200041106a10192000411c6a101a1a20052002100902402005450d0041002802cc4122034101480d00418cc00021022003410c6c418cc0006a21040340200241046a2802002203450d0102400240200341046a20054b0d00200320022802006a20054b0d010b2002410c6a22022004490d010c020b0b2005417c6a2202200228020041ffffffff07713602000b4100200641206a3602040bd804010c7f02402001450d00024020002802c041220d0d004110210d200041c0c1006a41103602000b200141086a200141046a41077122026b200120021b210202400240024020002802c441220a200d4f0d002000200a410c6c6a4180c0006a21010240200a0d0020004184c0006a220d2802000d0020014180c000360200200d2000360200200041004180c00010041a0b200241046a210a034002402001280208220d200a6a20012802004b0d002001280204200d6a220d200d28020041808080807871200272360200200141086a22012001280200200a6a360200200d200d28020041808080807872360200200d41046a22010d030b2000101b22010d000b0b41fcffffff0720026b2104200041c8c1006a210b200041c0c1006a210c20002802c8412203210d03402000200d410c6c6a22014188c0006a28020020014180c0006a2205280200464190c300100120014184c0006a280200220641046a210d0340200620052802006a2107200d417c6a2208280200220941ffffffff07712101024020094100480d000240200120024f0d000340200d20016a220a20074f0d01200a280200220a4100480d012001200a41ffffffff07716a41046a22012002490d000b0b20082001200220012002491b200941808080807871723602000240200120024d0d00200d20026a200420016a41ffffffff07713602000b200120024f0d040b200d20016a41046a220d2007490d000b41002101200b4100200b28020041016a220d200d200c280200461b220d360200200d2003470d000b0b20010f0b2008200828020041808080807872360200200d0f0b41000bc40203037f017e037f4100410028020441106b22083602042000280204210620013502042105200041086a2103200041046a210403402005a721072008200542078822054200522202410774200741ff0071723a0008200328020020066b41004a41f0c20010012004280200200841086a410110031a2004200428020041016a220636020020020d000b0240200141046a2802002204450d002001280200220720044104746a2103200041046a2104034020082007290300370308200041086a220228020020066b41074a41f0c20010012004280200200841086a410810031a2004200428020041086a22063602002008200741086a290300370308200228020020066b41074a41f0c20010012004280200200841086a410810031a2004200428020041086a2206360200200741106a22072003470d000b0b4100200841106a36020420000b860203047f017e027f4100410028020441106b22083602042000280204210720013502042106200041086a2104200041046a210503402006a721022008200642078822064200522203410774200241ff0071723a000f200428020020076b41004a41f0c200100120052802002008410f6a410110031a2005200528020041016a220736020020030d000b0240200141046a2802002203450d0020012802002105200041086a2104200041046a21020340200820052d00003a000e200428020020076b41004a41f0c200100120022802002008410e6a410110031a2002200228020041016a2207360200200541016a21052003417f6a22030d000b0b4100200841106a36020420000b870301077f200020002802c4412201410c6c6a22064180c0006a210702400240418080c000410010086b220241004c0d00200241808004200241808004491b22021008220320064184c0006a2802002204200728020022066a460d010240200620002001410c6c6a4188c0006a22052802002201460d00200420016a2204200428020041808080807871417c20016b20066a72360200200520072802003602002004200428020041ffffffff07713602000b200041c4c1006a2207200728020041016a220736020020002007410c6c6a22004184c0006a200336020020004180c0006a2200200236020020034100200210041a20000f0b02402007280200220320064188c0006a22042802002206460d0020002001410c6c6a4184c0006a28020020066a2202200228020041808080807871417c20066b20036a72360200200420072802003602002002200228020041ffffffff07713602000b2000200041c4c1006a220728020041016a22023602c0412007200236020041000f0b2007200620026a36020020070b870201027f4100410028020441106b220336020420032001290300370308200028020820002802046b41074a41f0c20010012000280204200341086a410810031a2000200028020441086a220236020420032001290308370308200028020820026b41074a41f0c20010012000280204200341086a410810031a2000200028020441086a220236020420032001290310370308200028020820026b41074a41f0c20010012000280204200341086a410810031a2000200028020441086a22023602042003200141186a290300370308200028020820026b41074a41f0c20010012000280204200341086a410810031a2000200028020441086a3602044100200341106a36020420000ba00203017f017e027f4100410028020441106b2206360204420021042000420037031020004200370320200041186a42848abd9a0537030041002105200041286a41003a00002000412c6a410036020020062001360204200620013602002006200120026a36020820062000101e1a20062802042102200641086a21030340200220032802004941b0c4001001200628020422022d000021012006200241016a2202360204200141ff0071200541ff0171220574ad2004842104200541076a210520014107760d000b200041206a2004a72201101f02402001450d00200041246a2802002105200641086a28020020062802046b20014f41f0c300100120052006280204200110031a2006200628020420016a3602040b4100200641106a3602040bd40101017f200028020820002802046b41074b41f0c300100120012000280204410810031a2000200028020441086a2202360204200028020820026b41074b41f0c3001001200141086a2000280204410810031a2000200028020441086a2202360204200028020820026b41074b41f0c3001001200141106a2000280204410810031a2000200028020441086a2202360204200028020820026b41074b41f0c3001001200141186a22012000280204410810031a2000200028020441086a3602042001290300428486d592055141c0c400100120000beb0301057f0240024002400240024002400240024002402001450d002000280200220420014d0d0120002001360200200028020420016a41003a00000f0b20002d0008450d072000410c6a2802002201450d0720012001280200417f6a22043602002004450d010c070b200420014f0d05410c2001101822022000280204200028020010031a20002d0008450d042000410c6a2802002204450d0420042004280200417f6a22033602002003450d010c040b20002802042202450d0541002802cc4122044101480d05418cc00021012004410c6c418cc0006a21030340200141046a2802002204450d060240200441046a20024b0d00200420012802006a20024b0d030b2001410c6a22012003490d000c060b0b200041046a2802002205450d0241002802cc4122034101480d02418cc00021042003410c6c418cc0006a21060340200441046a2802002203450d030240200341046a20054b0d00200320042802006a20054b0d030b2004410c6a22042006490d000c030b0b2002417c6a2201200128020041ffffffff07713602000c030b2005417c6a2204200428020041ffffffff07713602000b20002001360200200041046a2002360200200041086a41013a00002000410c6a41003602000b0f0b20004200370200200041086a41013a00002000410c6a41003602000b0bfb020b0041040b04603200000041e0c1000b3c617474656d707420746f20636f6e73747275637420746f6b656e2066726f6d206173736574207769746820646966666572656e742073796d626f6c000041a0c2000b26696e7465676572206f766572666c6f7720616464696e6720746f6b656e2062616c616e6365000041d0c2000b1b73696e676c65746f6e20746f6f2062696720746f2073746f7265000041f0c2000b06777269746500004180c3000b0761637469766500004190c3000b566d616c6c6f635f66726f6d5f6672656564207761732064657369676e656420746f206f6e6c792062652063616c6c6564206166746572205f686561702077617320636f6d706c6574656c7920616c6c6f6361746564000041f0c3000b057265616400004180c4000b2c696e746567657220756e646572666c6f77207375627472616374696e6720746f6b656e2062616c616e6365000041b0c4000b04676574000041c0c4000b16756e657870656374656420617373657420747970650000a312046e616d65200b616374696f6e5f73697a650006617373657274020000086c6f61645f693634050000000000066d656d63707903000000066d656d736574030000000b726561645f616374696f6e0200000c726571756972655f61757468010011726571756972655f726563697069656e740100047362726b01000b73656e645f696e6c696e650200000973746f72655f69363404000000001b5f474c4f42414c5f5f7375625f495f63757272656e63792e63707000056170706c79020130013181015f5a4e35656f73696f386469737061746368494e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545454e53345f31337472616e736665725f6d656d6f454e53345f356973737565454a454545627979070130013101320133013401350136755f5a4e35656f73696f3133756e7061636b5f616374696f6e494e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c7931333831333139343238457945454531337472616e736665725f6d656d6f454545545f76040130013101320133615f5a4e35656f73696f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545326f6e45524b4e53335f387472616e73666572450701300131013201330134013501366c5f5a4e35656f73696f3133756e7061636b5f616374696f6e494e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545356973737565454545545f7605013001310132013301345e5f5a4e35656f73696f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545326f6e45524b4e53335f35697373756545070130013101320133013401350136af015f5a4e35656f73696f377461626c653634494c7935303933343138363737363535353638333834454c793134323839323335353232333930383531353834454e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545313463757272656e63795f7374617473454531336765745f6f725f637265617465457979524b53355f06013001310132013301340135a6015f5a4e35656f73696f377461626c653634494c7935303933343138363737363535353638333834454c7933363037373439373738373335313034303030454e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545376163636f756e74454531336765745f6f725f637265617465457979524b53355f060130013101320133013401356f5f5a4e35656f73696f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c793133383133313934323845794545453135696e6c696e655f7472616e7366657245797953325f4e535f36737472696e6745100130013101320133013401350136013701380139023130023131023132023133023134023135315f5a4e35656f73696f36766563746f72494e535f31367065726d697373696f6e5f6c6576656c45454332456a524b53315f0e01300131013201330134013501360137013801390231300231310231320231337a5f5a4e35656f73696f347061636b494e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c7931333831333139343238457945454531337472616e736665725f6d656d6f4545454e535f36766563746f7249634545524b545f09013001310132013301340135013601370138185f5a4e4b35656f73696f36616374696f6e3473656e644576070130013101320133013401350136225f5a4e35656f73696f31346d656d6f72795f6d616e61676572366d616c6c6f63456d0e0130013101320133013401350136013701380139023130023131023132023133505f5a4e35656f73696f6c73494e535f31306461746173747265616d49506345454e535f31367065726d697373696f6e5f6c6576656c45454552545f53365f524b4e535f36766563746f724954305f4545090130013101320133013401350136013701383b5f5a4e35656f73696f6c73494e535f31306461746173747265616d495063454563454552545f53355f524b4e535f36766563746f724954305f4545090130013101320133013401350136013701382d5f5a4e35656f73696f31346d656d6f72795f6d616e6167657231366e6578745f6163746976655f68656170457608013001310132013301340135013601377b5f5a4e35656f73696f6c73494e535f31306461746173747265616d4950634545454552545f53355f524b4e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545387472616e7366657245040130013101320133705f5a4e35656f73696f36756e7061636b494e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c7931333831333139343238457945454531337472616e736665725f6d656d6f454545545f504b636a0701300131013201330134013501367b5f5a4e35656f73696f7273494e535f31306461746173747265616d49504b634545454552545f53365f524e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545387472616e736665724503013001310132195f5a4e35656f73696f36737472696e6736726573697a65456a070130013101320133013401350136"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"hex_data"</span>: <span class="string">"0000001e4d75af46000087590061736d0100000001570f60017e0060027f7f0060037f7f7f017f60047e7e7f7f017f60017f017f60057e7e7e7f7f017f6000017f60027f7f017f60000060027e7e0060027e7e017f60017f0060047f7e7e7f0060047e7e7e7f0060037f7f7f0002b3010b03656e760b616374696f6e5f73697a65000603656e7606617373657274000103656e76086c6f61645f693634000503656e76066d656d637079000203656e76066d656d736574000203656e760b726561645f616374696f6e000703656e760c726571756972655f61757468000003656e7611726571756972655f726563697069656e74000003656e76047362726b000403656e760b73656e645f696e6c696e65000103656e760973746f72655f693634000303161508090a0b0b0b0b0c0c0d02010b07070704070e07010404017000000503010001073003066d656d6f72790200056170706c79000c1b5f474c4f42414c5f5f7375625f495f63757272656e63792e637070000b0af44015f202004100420037028c4041004200370294404100420037029c40410042003702a440410042003702ac40410041003602b440410041003602b840410041003602bc40410041003602c040410041003602c440410041003602c840410041003602cc40410041003602d040410041003602d440410041003602d840410041003602dc40410041003602e040410041003602e440410041003602e840410041003602ec40410041003602f040410041003602f440410041003602f840410041003602fc404100410036028041410041003602844141004100360288414100410036028c414100410036029041410041003602944141004100360298414100410036029c41410041003602a041410041003602a441410041003602a841410041003602ac41410041003602b041410041003602b441410041003602b841410041003602bc41410041003602c041410041003602c441410041003602c841410041003602cc41410041003602d041410041003602d4410b090020002001100d1a0b990201057f4100410028020441306b2206360204410021050240200042808080f0d1a9ddd7c600520d000240024002402001428080808080a0e998f600510d00200142808080b8d585cfe64d520d032006100e2006100f200641286a2d0000450d022006412c6a2802002205450d0220052005280200417f6a220436020020040d02200641246a2802002202450d0241002802cc4122044101480d02418cc00021052004410c6c418cc0006a21030340200541046a2802002204450d030240200441046a20024b0d00200420052802006a20024b0d030b2005410c6a22052003490d000c030b0b20061010200610110c010b2002417c6a2205200528020041ffffffff07713602000b410121050b4100200641306a36020420050b3301037f41004100280204220310002201410f6a4170716b22023602042002200110051a200020022001101d410020033602040ba80304017e017f027e027f4100410028020441306b22063602042000290300100620002903002101200029030810072001100720002903002101200642003703182006428486d59205370310200641206a428486d592052001200641106a10132006290328210320002903102104200041186a2202290300428486d592055141e0c1001001200320045a4180c4001001410141d0c20010012006428486d59205370320410141f0c20010012006200641206a410810031a2006200320047d370320410141f0c200100120064108722205200641206a410810031a20014280808080f2a9d3883220064110100a1a20002903082101200642003703182006428486d59205370310200641206a428486d592052001200641106a101320062903282104200029031021032002290300428486d592055141e0c1001001200320047c220420035a41a0c2001001410141d0c20010012006428486d59205370320410141f0c20010012006200641206a410810031a20062004370320410141f0c20010012005200641206a410810031a20014280808080f2a9d3883220064110100a1a4100200641306a3602040b8c0101047f41004100280204220410002201410f6a4170716b22023602042002200110051a200041106a220342848abd9a0537030020004200370308200141074b41f0c300100120002002410810031a2001417871220141084741f0c3001001200041086a200241086a410810031a200141104741f0c30010012003200241106a410810031a410020043602040bc30505027f017e017f017e017f4100410028020441d0006b220636020442808080f0d1a9ddd7c6001006200642003703482006428486d59205370340200641106a428486d5920542808080f0d1a9ddd7c600200641c0006a101220002903082103200041106a2202290300428486d592055141e0c1001001200320062903187c20035a41a0c20010012006200320062903187c370318410141d0c200100120062006290310370340410141f0c2001001200641206a200641c0006a410810031a20062006290318370340410141f0c2001001200641206a4108722204200641c0006a410810031a42808080f0d1a9ddd7c60042808080808080e4a646200641206a4110100a1a200642003703382006428486d59205370330200641c0006a428486d5920542808080f0d1a9ddd7c600200641306a101320062903482105200029030821032002290300428486d592055141e0c1001001200320057c220520035a41a0c2001001410141d0c20010012006428486d59205370340410141f0c2001001200641206a200641c0006a410810031a20062005370340410141f0c20010012004200641c0006a410810031a42808080f0d1a9ddd7c6004280808080f2a9d38832200641206a4110100a1a20002903082103200029030021052002290300428486d592055141e0c1001001200641003a0008200642003703002006410036020c42808080f0d1a9ddd7c6002005200320061014024020062d0008450d002006410c6a2802002200450d0020002000280200417f6a220236020020020d0020062802042204450d0041002802cc4122024101480d00418cc00021002002410c6c418cc0006a21010340200041046a2802002202450d0102400240200241046a20044b0d00200220002802006a20044b0d010b2000410c6a22002001490d010c020b0b2004417c6a2200200028020041ffffffff07713602000b4100200641d0006a3602040bba0201027f4100410028020441a0086b22053602042005200137030002400240200242808080f0d1a9ddd7c60042808080808080e4a646200541800810022204417f4c0d0020054200370388082005428486d5920537038008200441074b41f0c300100120054180086a2005410810031a200441787141084741f0c300100120054180086a41086a2005410872410810031a200041086a20052903880837030020002005290380083703000c010b410141d0c20010012005200329030037039808410141f0c200100120054180086a20054198086a410810031a2005200329030837039808410141f0c200100120054180086a41087220054198086a410810031a200242808080808080e4a64620054180086a4110100a1a200041086a2003290308370300200020032903003703000b4100200541a0086a3602040bba0201027f4100410028020441a0086b22053602042005200137030002400240200242808080f0d1a9ddd7c6004280808080f2a9d38832200541800810022204417f4c0d0020054200370388082005428486d5920537038008200441074b41f0c300100120054180086a2005410810031a200441787141084741f0c300100120054180086a41086a2005410872410810031a200041086a20052903880837030020002005290380083703000c010b410141d0c20010012005200329030037039808410141f0c200100120054180086a20054198086a410810031a2005200329030837039808410141f0c200100120054180086a41087220054198086a410810031a20024280808080f2a9d3883220054180086a4110100a1a200041086a2003290308370300200020032903003703000b4100200541a0086a3602040bbe0803077f047e017f410041002802044180016b220f3602044200210c423b210b4180c300210a4200210d034002400240024002400240200c4205560d00200a2c00002204419f7f6a41ff017141194b0d01200441a5016a21040c020b4200210e200c420b580d020c030b200441d0016a41002004414f6a41ff01714105491b21040b2004ad423886423887210e0b200e421f83200b42ffffffff0f8386210e0b200a41016a210a200c42017c210c200e200d84210d200b427b7c220b427a520d000b200f200d370340200f42808080f0d1a9ddd7c600370338410141e0c100100120032d0008210820032802002105200328020421040240200328020c220a450d00200a200a28020041016a3602000b200f41206a428486d59205370300200f41086a41246a2004360200200f41306a220320083a0000200f2001370310200f2000370308200f2002370318200f2005360228200f41346a200a3602000240200a450d00200a200a28020041016a3602000b200f41d8006a4101200f41386a10152105200f41c8006a41246a22094100360200200f4200370264200f42808080f0d1a9ddd7c600370348200f42808080b8d585cfe64d370350200f41f0006a200f41086a10162009200f280278360200200f200f290370370264024020032d0000450d00200f41346a2802002203450d0020032003280200417f6a220936020020090d00200f412c6a2802002206450d0041002802cc4122094101480d00418cc00021032009410c6c418cc0006a21070340200341046a2802002209450d0102400240200941046a20064b0d00200920032802006a20064b0d010b2003410c6a22032007490d010c020b0b2006417c6a2203200328020041ffffffff07713602000b0240200841ff0171450d00200a450d00200a200a280200417f6a220336020020030d002004450d0041002802cc4122034101480d00418cc000210a2003410c6c418cc0006a21080340200a41046a2802002203450d0102400240200341046a20044b0d002003200a2802006a20044b0d010b200a410c6a220a2008490d010c020b0b2004417c6a220a200a28020041ffffffff07713602000b200f41c8006a10170240200f2802642203450d0041002802cc4122044101480d00418cc000210a2004410c6c418cc0006a21080340200a41046a2802002204450d0102400240200441046a20034b0d002004200a2802006a20034b0d010b200a410c6a220a2008490d010c020b0b2003417c6a220a200a28020041ffffffff07713602000b200f41ec006a4100360200200f41e4006a4200370200024020052802002203450d0041002802cc4122044101480d00418cc000210a2004410c6c418cc0006a21080340200a41046a2802002204450d0102400240200441046a20034b0d002004200a2802006a20034b0d010b200a410c6a220a2008490d010c020b0b2003417c6a220a200a28020041ffffffff07713602000b4100200f4180016a3602040ba207010b7f20004100360208200042003702000240024002402001450d00410c2001410474101821070240200041046a2204280200450d004100210b4100210c03402007200b6a22082000280200200b6a2209290300370300200841086a200941086a290300370300200b41106a210b200c41016a220c2004280200490d000b0b024020002802002208450d0041002802cc41220c4101480d00418cc000210b200c410c6c418cc0006a21090340200b41046a280200220c450d0102400240200c41046a20084b0d00200c200b2802006a20084b0d010b200b410c6a220b2009490d010c020b0b2008417c6a220b200b28020041ffffffff07713602000b20002007360200200041086a220620013602002001450d014100210a0240200041046a220728020022082001220b470d004102210d0c030b4100210d0c020b4110210d0c010b4110210d0b037f024002400240024002400240024002400240024002400240024002400240024002400240024002400240024002400240024002400240024002400240200d0e11020304050607090a010b0c0d0e0f000810100b2009417c6a220b200b28020041ffffffff0771360200200728020021084108210d0c1d0b20002004360200200620033602004100210d0c1c0b200028020020084104746a220b2002290300370300200b41086a200241086a2903003703002007200728020041016a2208360200200a41016a220a2001460d0e4101210d0c1b0b20082006280200220b470d0f4102210d0c1a0b417f2108200b417f460d0d4103210d0c190b410c200b41016a2203410474101821042007280200450d0e4104210d0c180b4100210b4100210c4105210d0c170b2004200b6a22082000280200200b6a2209290300370300200841086a200941086a290300370300200b41106a210b200c41016a220c20072802002208490d0d0c0e0b410021084106210d0c150b20002802002209450d0d4107210d0c140b41002802cc41220c4101480d0d4109210d0c130b418cc000210b200c410c6c418cc0006a2105410a210d0c120b200b41046a280200220c450d0c410b210d0c110b200c41046a20094b0d0e410c210d0c100b200c200b2802006a20094b0d0e410d210d0c0f0b200b410c6a220b2005490d0a0c0b0b20000f0b4110210d0c0c0b4100210d0c0b0b4100210d0c0a0b410f210d0c090b4105210d0c080b4106210d0c070b4108210d0c060b4108210d0c050b4108210d0c040b410a210d0c030b4108210d0c020b410d210d0c010b410e210d0c000b0b820303057f017e017f4100410028020441106b220836020420004100360208200042003702004160200128022022036b21062003ad210703402006417f6a2106200742078822074200520d000b410020066b21024100210502402006450d00410c200210182105200041086a20023602002000200536020020052103200221040340200341003a0000200341016a21032004417f6a22040d000b0b200041046a200236020020082005360204200820053602002008200520066b36020820082001101c1a200141206a350200210720082802042106200841086a210503402007a721032008200742078822074200522204410774200341ff0071723a000f200528020020066b41004a41f0c200100120082802042008410f6a410110031a2008200828020441016a220636020420040d000b0240200141206a2802002203450d00200141246a2802002104200841086a28020020066b20034e41f0c200100120082802042004200310031a2008200828020420036a3602040b4100200841106a3602040ba80302017e057f4100410028020441206b2206360204200041146a280200220341047441106a21022003ad21010340200241016a2102200142078822014200520d000b200041206a280200220320026a21022003ad21010340200241016a2102200142078822014200520d000b024002402002450d00410c2002101822052103200221040340200341003a0000200341016a21032004417f6a22040d000c020b0b410021050b200620053602082006200520026a220336021020062000290300370318200241074a41f0c20010012005200641186a410810031a200620002903083703182003200541086a22046b41074a41f0c20010012004200641186a410810031a2006200541106a36020c200641086a200041106a10192000411c6a101a1a20052002100902402005450d0041002802cc4122034101480d00418cc00021022003410c6c418cc0006a21040340200241046a2802002203450d0102400240200341046a20054b0d00200320022802006a20054b0d010b2002410c6a22022004490d010c020b0b2005417c6a2202200228020041ffffffff07713602000b4100200641206a3602040bd804010c7f02402001450d00024020002802c041220d0d004110210d200041c0c1006a41103602000b200141086a200141046a41077122026b200120021b210202400240024020002802c441220a200d4f0d002000200a410c6c6a4180c0006a21010240200a0d0020004184c0006a220d2802000d0020014180c000360200200d2000360200200041004180c00010041a0b200241046a210a034002402001280208220d200a6a20012802004b0d002001280204200d6a220d200d28020041808080807871200272360200200141086a22012001280200200a6a360200200d200d28020041808080807872360200200d41046a22010d030b2000101b22010d000b0b41fcffffff0720026b2104200041c8c1006a210b200041c0c1006a210c20002802c8412203210d03402000200d410c6c6a22014188c0006a28020020014180c0006a2205280200464190c300100120014184c0006a280200220641046a210d0340200620052802006a2107200d417c6a2208280200220941ffffffff07712101024020094100480d000240200120024f0d000340200d20016a220a20074f0d01200a280200220a4100480d012001200a41ffffffff07716a41046a22012002490d000b0b20082001200220012002491b200941808080807871723602000240200120024d0d00200d20026a200420016a41ffffffff07713602000b200120024f0d040b200d20016a41046a220d2007490d000b41002101200b4100200b28020041016a220d200d200c280200461b220d360200200d2003470d000b0b20010f0b2008200828020041808080807872360200200d0f0b41000bc40203037f017e037f4100410028020441106b22083602042000280204210620013502042105200041086a2103200041046a210403402005a721072008200542078822054200522202410774200741ff0071723a0008200328020020066b41004a41f0c20010012004280200200841086a410110031a2004200428020041016a220636020020020d000b0240200141046a2802002204450d002001280200220720044104746a2103200041046a2104034020082007290300370308200041086a220228020020066b41074a41f0c20010012004280200200841086a410810031a2004200428020041086a22063602002008200741086a290300370308200228020020066b41074a41f0c20010012004280200200841086a410810031a2004200428020041086a2206360200200741106a22072003470d000b0b4100200841106a36020420000b860203047f017e027f4100410028020441106b22083602042000280204210720013502042106200041086a2104200041046a210503402006a721022008200642078822064200522203410774200241ff0071723a000f200428020020076b41004a41f0c200100120052802002008410f6a410110031a2005200528020041016a220736020020030d000b0240200141046a2802002203450d0020012802002105200041086a2104200041046a21020340200820052d00003a000e200428020020076b41004a41f0c200100120022802002008410e6a410110031a2002200228020041016a2207360200200541016a21052003417f6a22030d000b0b4100200841106a36020420000b870301077f200020002802c4412201410c6c6a22064180c0006a210702400240418080c000410010086b220241004c0d00200241808004200241808004491b22021008220320064184c0006a2802002204200728020022066a460d010240200620002001410c6c6a4188c0006a22052802002201460d00200420016a2204200428020041808080807871417c20016b20066a72360200200520072802003602002004200428020041ffffffff07713602000b200041c4c1006a2207200728020041016a220736020020002007410c6c6a22004184c0006a200336020020004180c0006a2200200236020020034100200210041a20000f0b02402007280200220320064188c0006a22042802002206460d0020002001410c6c6a4184c0006a28020020066a2202200228020041808080807871417c20066b20036a72360200200420072802003602002002200228020041ffffffff07713602000b2000200041c4c1006a220728020041016a22023602c0412007200236020041000f0b2007200620026a36020020070b870201027f4100410028020441106b220336020420032001290300370308200028020820002802046b41074a41f0c20010012000280204200341086a410810031a2000200028020441086a220236020420032001290308370308200028020820026b41074a41f0c20010012000280204200341086a410810031a2000200028020441086a220236020420032001290310370308200028020820026b41074a41f0c20010012000280204200341086a410810031a2000200028020441086a22023602042003200141186a290300370308200028020820026b41074a41f0c20010012000280204200341086a410810031a2000200028020441086a3602044100200341106a36020420000ba00203017f017e027f4100410028020441106b2206360204420021042000420037031020004200370320200041186a42848abd9a0537030041002105200041286a41003a00002000412c6a410036020020062001360204200620013602002006200120026a36020820062000101e1a20062802042102200641086a21030340200220032802004941b0c4001001200628020422022d000021012006200241016a2202360204200141ff0071200541ff0171220574ad2004842104200541076a210520014107760d000b200041206a2004a72201101f02402001450d00200041246a2802002105200641086a28020020062802046b20014f41f0c300100120052006280204200110031a2006200628020420016a3602040b4100200641106a3602040bd40101017f200028020820002802046b41074b41f0c300100120012000280204410810031a2000200028020441086a2202360204200028020820026b41074b41f0c3001001200141086a2000280204410810031a2000200028020441086a2202360204200028020820026b41074b41f0c3001001200141106a2000280204410810031a2000200028020441086a2202360204200028020820026b41074b41f0c3001001200141186a22012000280204410810031a2000200028020441086a3602042001290300428486d592055141c0c400100120000beb0301057f0240024002400240024002400240024002402001450d002000280200220420014d0d0120002001360200200028020420016a41003a00000f0b20002d0008450d072000410c6a2802002201450d0720012001280200417f6a22043602002004450d010c070b200420014f0d05410c2001101822022000280204200028020010031a20002d0008450d042000410c6a2802002204450d0420042004280200417f6a22033602002003450d010c040b20002802042202450d0541002802cc4122044101480d05418cc00021012004410c6c418cc0006a21030340200141046a2802002204450d060240200441046a20024b0d00200420012802006a20024b0d030b2001410c6a22012003490d000c060b0b200041046a2802002205450d0241002802cc4122034101480d02418cc00021042003410c6c418cc0006a21060340200441046a2802002203450d030240200341046a20054b0d00200320042802006a20054b0d030b2004410c6a22042006490d000c030b0b2002417c6a2201200128020041ffffffff07713602000c030b2005417c6a2204200428020041ffffffff07713602000b20002001360200200041046a2002360200200041086a41013a00002000410c6a41003602000b0f0b20004200370200200041086a41013a00002000410c6a41003602000b0bfb020b0041040b04603200000041e0c1000b3c617474656d707420746f20636f6e73747275637420746f6b656e2066726f6d206173736574207769746820646966666572656e742073796d626f6c000041a0c2000b26696e7465676572206f766572666c6f7720616464696e6720746f6b656e2062616c616e6365000041d0c2000b1b73696e676c65746f6e20746f6f2062696720746f2073746f7265000041f0c2000b06777269746500004180c3000b0761637469766500004190c3000b566d616c6c6f635f66726f6d5f6672656564207761732064657369676e656420746f206f6e6c792062652063616c6c6564206166746572205f686561702077617320636f6d706c6574656c7920616c6c6f6361746564000041f0c3000b057265616400004180c4000b2c696e746567657220756e646572666c6f77207375627472616374696e6720746f6b656e2062616c616e6365000041b0c4000b04676574000041c0c4000b16756e657870656374656420617373657420747970650000a312046e616d65200b616374696f6e5f73697a650006617373657274020000086c6f61645f693634050000000000066d656d63707903000000066d656d736574030000000b726561645f616374696f6e0200000c726571756972655f61757468010011726571756972655f726563697069656e740100047362726b01000b73656e645f696e6c696e650200000973746f72655f69363404000000001b5f474c4f42414c5f5f7375625f495f63757272656e63792e63707000056170706c79020130013181015f5a4e35656f73696f386469737061746368494e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545454e53345f31337472616e736665725f6d656d6f454e53345f356973737565454a454545627979070130013101320133013401350136755f5a4e35656f73696f3133756e7061636b5f616374696f6e494e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c7931333831333139343238457945454531337472616e736665725f6d656d6f454545545f76040130013101320133615f5a4e35656f73696f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545326f6e45524b4e53335f387472616e73666572450701300131013201330134013501366c5f5a4e35656f73696f3133756e7061636b5f616374696f6e494e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545356973737565454545545f7605013001310132013301345e5f5a4e35656f73696f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545326f6e45524b4e53335f35697373756545070130013101320133013401350136af015f5a4e35656f73696f377461626c653634494c7935303933343138363737363535353638333834454c793134323839323335353232333930383531353834454e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545313463757272656e63795f7374617473454531336765745f6f725f637265617465457979524b53355f06013001310132013301340135a6015f5a4e35656f73696f377461626c653634494c7935303933343138363737363535353638333834454c7933363037373439373738373335313034303030454e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545376163636f756e74454531336765745f6f725f637265617465457979524b53355f060130013101320133013401356f5f5a4e35656f73696f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c793133383133313934323845794545453135696e6c696e655f7472616e7366657245797953325f4e535f36737472696e6745100130013101320133013401350136013701380139023130023131023132023133023134023135315f5a4e35656f73696f36766563746f72494e535f31367065726d697373696f6e5f6c6576656c45454332456a524b53315f0e01300131013201330134013501360137013801390231300231310231320231337a5f5a4e35656f73696f347061636b494e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c7931333831333139343238457945454531337472616e736665725f6d656d6f4545454e535f36766563746f7249634545524b545f09013001310132013301340135013601370138185f5a4e4b35656f73696f36616374696f6e3473656e644576070130013101320133013401350136225f5a4e35656f73696f31346d656d6f72795f6d616e61676572366d616c6c6f63456d0e0130013101320133013401350136013701380139023130023131023132023133505f5a4e35656f73696f6c73494e535f31306461746173747265616d49506345454e535f31367065726d697373696f6e5f6c6576656c45454552545f53365f524b4e535f36766563746f724954305f4545090130013101320133013401350136013701383b5f5a4e35656f73696f6c73494e535f31306461746173747265616d495063454563454552545f53355f524b4e535f36766563746f724954305f4545090130013101320133013401350136013701382d5f5a4e35656f73696f31346d656d6f72795f6d616e6167657231366e6578745f6163746976655f68656170457608013001310132013301340135013601377b5f5a4e35656f73696f6c73494e535f31306461746173747265616d4950634545454552545f53355f524b4e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545387472616e7366657245040130013101320133705f5a4e35656f73696f36756e7061636b494e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c7931333831333139343238457945454531337472616e736665725f6d656d6f454545545f504b636a0701300131013201330134013501367b5f5a4e35656f73696f7273494e535f31306461746173747265616d49504b634545454552545f53365f524e535f313667656e657269635f63757272656e6379494e535f35746f6b656e494c7935303933343138363737363535353638333834454c79313338313331393432384579454545387472616e736665724503013001310132195f5a4e35656f73696f36737472696e6736726573697a65456a070130013101320133013401350136"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"console"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"region_id"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">"cycle_index"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">"data_access"</span>: []</span><br><span class="line">      &#125;,&#123;</span><br><span class="line">        <span class="string">"receiver"</span>: <span class="string">"eosio"</span>,</span><br><span class="line">        <span class="string">"act"</span>: &#123;</span><br><span class="line">          <span class="string">"account"</span>: <span class="string">"eosio"</span>,</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"setabi"</span>,</span><br><span class="line">          <span class="string">"authorization"</span>: [&#123;</span><br><span class="line">              <span class="string">"actor"</span>: <span class="string">"currency"</span>,</span><br><span class="line">              <span class="string">"permission"</span>: <span class="string">"active"</span></span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          <span class="string">"data"</span>: &#123;</span><br><span class="line">            <span class="string">"account"</span>: <span class="string">"currency"</span>,</span><br><span class="line">            <span class="string">"abi"</span>: &#123;</span><br><span class="line">              <span class="string">"types"</span>: [&#123;</span><br><span class="line">                  <span class="string">"new_type_name"</span>: <span class="string">"account_name"</span>,</span><br><span class="line">                  <span class="string">"type"</span>: <span class="string">"name"</span></span><br><span class="line">                &#125;</span><br><span class="line">              ],</span><br><span class="line">              <span class="string">"structs"</span>: [&#123;</span><br><span class="line">                  <span class="string">"name"</span>: <span class="string">"transfer"</span>,</span><br><span class="line">                  <span class="string">"base"</span>: <span class="string">""</span>,</span><br><span class="line">                  <span class="string">"fields"</span>: [&#123;</span><br><span class="line">                      <span class="string">"name"</span>: <span class="string">"from"</span>,</span><br><span class="line">                      <span class="string">"type"</span>: <span class="string">"account_name"</span></span><br><span class="line">                    &#125;,&#123;</span><br><span class="line">                      <span class="string">"name"</span>: <span class="string">"to"</span>,</span><br><span class="line">                      <span class="string">"type"</span>: <span class="string">"account_name"</span></span><br><span class="line">                    &#125;,&#123;</span><br><span class="line">                      <span class="string">"name"</span>: <span class="string">"quantity"</span>,</span><br><span class="line">                      <span class="string">"type"</span>: <span class="string">"asset"</span></span><br><span class="line">                    &#125;,&#123;</span><br><span class="line">                      <span class="string">"name"</span>: <span class="string">"memo"</span>,</span><br><span class="line">                      <span class="string">"type"</span>: <span class="string">"string"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                  ]</span><br><span class="line">                &#125;,&#123;</span><br><span class="line">                  <span class="string">"name"</span>: <span class="string">"issue"</span>,</span><br><span class="line">                  <span class="string">"base"</span>: <span class="string">""</span>,</span><br><span class="line">                  <span class="string">"fields"</span>: [&#123;</span><br><span class="line">                      <span class="string">"name"</span>: <span class="string">"to"</span>,</span><br><span class="line">                      <span class="string">"type"</span>: <span class="string">"account_name"</span></span><br><span class="line">                    &#125;,&#123;</span><br><span class="line">                      <span class="string">"name"</span>: <span class="string">"quantity"</span>,</span><br><span class="line">                      <span class="string">"type"</span>: <span class="string">"asset"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                  ]</span><br><span class="line">                &#125;,&#123;</span><br><span class="line">                  <span class="string">"name"</span>: <span class="string">"account"</span>,</span><br><span class="line">                  <span class="string">"base"</span>: <span class="string">""</span>,</span><br><span class="line">                  <span class="string">"fields"</span>: [&#123;</span><br><span class="line">                      <span class="string">"name"</span>: <span class="string">"currency"</span>,</span><br><span class="line">                      <span class="string">"type"</span>: <span class="string">"uint64"</span></span><br><span class="line">                    &#125;,&#123;</span><br><span class="line">                      <span class="string">"name"</span>: <span class="string">"balance"</span>,</span><br><span class="line">                      <span class="string">"type"</span>: <span class="string">"uint64"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                  ]</span><br><span class="line">                &#125;,&#123;</span><br><span class="line">                  <span class="string">"name"</span>: <span class="string">"currency_stats"</span>,</span><br><span class="line">                  <span class="string">"base"</span>: <span class="string">""</span>,</span><br><span class="line">                  <span class="string">"fields"</span>: [&#123;</span><br><span class="line">                      <span class="string">"name"</span>: <span class="string">"currency"</span>,</span><br><span class="line">                      <span class="string">"type"</span>: <span class="string">"uint64"</span></span><br><span class="line">                    &#125;,&#123;</span><br><span class="line">                      <span class="string">"name"</span>: <span class="string">"supply"</span>,</span><br><span class="line">                      <span class="string">"type"</span>: <span class="string">"uint64"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                  ]</span><br><span class="line">                &#125;</span><br><span class="line">              ],</span><br><span class="line">              <span class="string">"actions"</span>: [&#123;</span><br><span class="line">                  <span class="string">"name"</span>: <span class="string">"transfer"</span>,</span><br><span class="line">                  <span class="string">"type"</span>: <span class="string">"transfer"</span></span><br><span class="line">                &#125;,&#123;</span><br><span class="line">                  <span class="string">"name"</span>: <span class="string">"issue"</span>,</span><br><span class="line">                  <span class="string">"type"</span>: <span class="string">"issue"</span></span><br><span class="line">                &#125;</span><br><span class="line">              ],</span><br><span class="line">              <span class="string">"tables"</span>: [&#123;</span><br><span class="line">                  <span class="string">"name"</span>: <span class="string">"account"</span>,</span><br><span class="line">                  <span class="string">"index_type"</span>: <span class="string">"i64"</span>,</span><br><span class="line">                  <span class="string">"key_names"</span>: [</span><br><span class="line">                    <span class="string">"currency"</span></span><br><span class="line">                  ],</span><br><span class="line">                  <span class="string">"key_types"</span>: [</span><br><span class="line">                    <span class="string">"uint64"</span></span><br><span class="line">                  ],</span><br><span class="line">                  <span class="string">"type"</span>: <span class="string">"account"</span></span><br><span class="line">                &#125;,&#123;</span><br><span class="line">                  <span class="string">"name"</span>: <span class="string">"stat"</span>,</span><br><span class="line">                  <span class="string">"index_type"</span>: <span class="string">"i64"</span>,</span><br><span class="line">                  <span class="string">"key_names"</span>: [</span><br><span class="line">                    <span class="string">"currency"</span></span><br><span class="line">                  ],</span><br><span class="line">                  <span class="string">"key_types"</span>: [</span><br><span class="line">                    <span class="string">"uint64"</span></span><br><span class="line">                  ],</span><br><span class="line">                  <span class="string">"type"</span>: <span class="string">"currency_stats"</span></span><br><span class="line">                &#125;</span><br><span class="line">              ]</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"hex_data"</span>: <span class="string">"0000001e4d75af46010c6163636f756e745f6e616d65046e616d6504087472616e7366657200040466726f6d0c6163636f756e745f6e616d6502746f0c6163636f756e745f6e616d65087175616e74697479056173736574046d656d6f06737472696e67056973737565000202746f0c6163636f756e745f6e616d65087175616e74697479056173736574076163636f756e7400020863757272656e63790675696e7436340762616c616e63650675696e7436340e63757272656e63795f737461747300020863757272656e63790675696e74363406737570706c790675696e74363402000000572d3ccdcd087472616e736665720000000000a5317605697373756502000000204f4d113203693634010863757272656e6379010675696e743634076163636f756e740000000000904dc603693634010863757272656e6379010675696e7436340e63757272656e63795f7374617473"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"console"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"region_id"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">"cycle_index"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">"data_access"</span>: []</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"deferred_transactions"</span>: []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å†æ¬¡æ£€æŸ¥currencyè´¦å·åˆçº¦ç¼–å·"><a href="#å†æ¬¡æ£€æŸ¥currencyè´¦å·åˆçº¦ç¼–å·" class="headerlink" title="å†æ¬¡æ£€æŸ¥currencyè´¦å·åˆçº¦ç¼–å·"></a>å†æ¬¡æ£€æŸ¥<code>currency</code>è´¦å·åˆçº¦ç¼–å·</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ./eosioc get code currency</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿”å›å¦‚ä¸‹ä¿¡æ¯</span></span><br><span class="line">code hash: <span class="number">135</span>bb95927600a21dcc701223a107215e3b25cb19b196e0c38fa7d7f2082c869</span><br></pre></td></tr></table></figure><h5 id="å‘è¡Œè´§å¸"><a href="#å‘è¡Œè´§å¸" class="headerlink" title="å‘è¡Œè´§å¸"></a>å‘è¡Œè´§å¸</h5><blockquote><p>åœ¨ä½¿ç”¨è´§å¸åˆçº¦ä¹‹å‰ï¼Œä½ å¿…é¡»å…ˆå‘è¡Œè´§å¸</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">$ ./eosioc push action currency issue <span class="string">'&#123;"to":"currency","quantity":"1000.0000 CUR"&#125;'</span> --permission currency@active</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿”å›å¦‚ä¸‹ä¿¡æ¯</span></span><br><span class="line"><span class="number">2347850</span>ms thread-<span class="number">0</span>   main.cpp:<span class="number">1149</span>                 operator()           ] Converting argument to binary...</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"transaction_id"</span>: <span class="string">"afd44bfce56e8f96eecf6075f7d98e8b573ca318e158002f0abc83489bcb46fb"</span>,</span><br><span class="line">  <span class="string">"processed"</span>: &#123;</span><br><span class="line">    <span class="string">"status"</span>: <span class="string">"executed"</span>,</span><br><span class="line">    <span class="string">"id"</span>: <span class="string">"afd44bfce56e8f96eecf6075f7d98e8b573ca318e158002f0abc83489bcb46fb"</span>,</span><br><span class="line">    <span class="string">"action_traces"</span>: [</span><br><span class="line">      null,</span><br><span class="line">      null,&#123;</span><br><span class="line">        <span class="string">"receiver"</span>: <span class="string">"currency"</span>,</span><br><span class="line">        <span class="string">"act"</span>: &#123;</span><br><span class="line">          <span class="string">"account"</span>: <span class="string">"currency"</span>,</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"issue"</span>,</span><br><span class="line">          <span class="string">"authorization"</span>: [&#123;</span><br><span class="line">              <span class="string">"actor"</span>: <span class="string">"currency"</span>,</span><br><span class="line">              <span class="string">"permission"</span>: <span class="string">"active"</span></span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          <span class="string">"data"</span>: &#123;</span><br><span class="line">            <span class="string">"to"</span>: <span class="string">"currency"</span>,</span><br><span class="line">            <span class="string">"quantity"</span>: <span class="string">"1000.0000 CUR"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"hex_data"</span>: <span class="string">"0000001e4d75af4680969800000000000443555200000000"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"console"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"region_id"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">"cycle_index"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">"data_access"</span>: [&#123;</span><br><span class="line">            <span class="string">"type"</span>: <span class="string">"write"</span>,</span><br><span class="line">            <span class="string">"scope"</span>: <span class="string">"currency"</span>,</span><br><span class="line">            <span class="string">"sequence"</span>: <span class="number">0</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,&#123;</span><br><span class="line">        <span class="string">"receiver"</span>: <span class="string">"currency"</span>,</span><br><span class="line">        <span class="string">"act"</span>: &#123;</span><br><span class="line">          <span class="string">"account"</span>: <span class="string">"currency"</span>,</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"transfer"</span>,</span><br><span class="line">          <span class="string">"authorization"</span>: [&#123;</span><br><span class="line">              <span class="string">"actor"</span>: <span class="string">"currency"</span>,</span><br><span class="line">              <span class="string">"permission"</span>: <span class="string">"active"</span></span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          <span class="string">"data"</span>: &#123;</span><br><span class="line">            <span class="string">"from"</span>: <span class="string">"currency"</span>,</span><br><span class="line">            <span class="string">"to"</span>: <span class="string">"currency"</span>,</span><br><span class="line">            <span class="string">"quantity"</span>: <span class="string">"1000.0000 CUR"</span>,</span><br><span class="line">            <span class="string">"memo"</span>: <span class="string">""</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"hex_data"</span>: <span class="string">"0000001e4d75af460000001e4d75af468096980000000000044355520000000000"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"console"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"region_id"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">"cycle_index"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">"data_access"</span>: [&#123;</span><br><span class="line">            <span class="string">"type"</span>: <span class="string">"write"</span>,</span><br><span class="line">            <span class="string">"scope"</span>: <span class="string">"currency"</span>,</span><br><span class="line">            <span class="string">"sequence"</span>: <span class="number">1</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"deferred_transactions"</span>: []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ£€æŸ¥è´§å¸åˆçº¦çš„åˆå§‹ä½™é¢"><a href="#æ£€æŸ¥è´§å¸åˆçº¦çš„åˆå§‹ä½™é¢" class="headerlink" title="æ£€æŸ¥è´§å¸åˆçº¦çš„åˆå§‹ä½™é¢"></a>æ£€æŸ¥è´§å¸åˆçº¦çš„åˆå§‹ä½™é¢</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ ./eosioc get table currency currency account</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"rows"</span>: [&#123;</span><br><span class="line">     <span class="string">"currency"</span>: <span class="number">1381319428</span>,</span><br><span class="line">     <span class="string">"balance"</span>: <span class="number">10000000</span></span><br><span class="line">     &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"more"</span>: false</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç”¨æ ·æœ¬â€œè´§å¸â€åˆçº¦è½¬ç§»èµ„é‡‘"><a href="#ç”¨æ ·æœ¬â€œè´§å¸â€åˆçº¦è½¬ç§»èµ„é‡‘" class="headerlink" title="ç”¨æ ·æœ¬â€œè´§å¸â€åˆçº¦è½¬ç§»èµ„é‡‘"></a>ç”¨æ ·æœ¬â€œè´§å¸â€åˆçº¦è½¬ç§»èµ„é‡‘</h3><p>ç†è®ºä¸Šï¼Œä»»ä½•äººåœ¨ä»»ä½•æ—¶é—´å¯ä»¥ä»»ä½•åˆçº¦å‘é€ä»»æ„çš„æ¶ˆæ¯ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰ç»™äºˆç›¸åº”çš„æƒé™çš„è¯ï¼Œåˆçº¦ä¼šæ‹’ç»æ¥å—è¯¥æ¶ˆæ¯ã€‚æ¶ˆæ¯çš„å‘é€å¿…é¡»ä¾èµ–ä¸€å®šçš„æƒé™æ‰èƒ½å‘é€ã€‚</p><p>å¦‚ä¸‹ç¤ºä¾‹ï¼Œä½¿ç”¨<code>currency</code>è´¦å·çš„<code>active</code>æƒé™å‘è´¦æˆ·<code>inita</code>è½¬ç§»<code>20CUR</code></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">$ ./eosioc push action currency transfer <span class="string">'&#123;"from":"currency","to":"inita","quantity":"20.0000 CUR","memo":"my first transfer"&#125;'</span> --permission currency@active</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿”å›ä¿¡æ¯</span></span><br><span class="line"><span class="number">2646382</span>ms thread-<span class="number">0</span>   main.cpp:<span class="number">1149</span>                 operator()           ] Converting argument to binary...</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"transaction_id"</span>: <span class="string">"740bc3ed54ba251a0abaf32dd46e2b80f5187acc788881ea52550702ba84a23a"</span>,</span><br><span class="line">  <span class="string">"processed"</span>: &#123;</span><br><span class="line">    <span class="string">"status"</span>: <span class="string">"executed"</span>,</span><br><span class="line">    <span class="string">"id"</span>: <span class="string">"740bc3ed54ba251a0abaf32dd46e2b80f5187acc788881ea52550702ba84a23a"</span>,</span><br><span class="line">    <span class="string">"action_traces"</span>: [</span><br><span class="line">      null,</span><br><span class="line">      null,&#123;</span><br><span class="line">        <span class="string">"receiver"</span>: <span class="string">"currency"</span>,</span><br><span class="line">        <span class="string">"act"</span>: &#123;</span><br><span class="line">          <span class="string">"account"</span>: <span class="string">"currency"</span>,</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"transfer"</span>,</span><br><span class="line">          <span class="string">"authorization"</span>: [&#123;</span><br><span class="line">              <span class="string">"actor"</span>: <span class="string">"currency"</span>,</span><br><span class="line">              <span class="string">"permission"</span>: <span class="string">"active"</span></span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          <span class="string">"data"</span>: &#123;</span><br><span class="line">            <span class="string">"from"</span>: <span class="string">"currency"</span>,</span><br><span class="line">            <span class="string">"to"</span>: <span class="string">"inita"</span>,</span><br><span class="line">            <span class="string">"quantity"</span>: <span class="string">"20.0000 CUR"</span>,</span><br><span class="line">            <span class="string">"memo"</span>: <span class="string">"my first transfer"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"hex_data"</span>: <span class="string">"0000001e4d75af46000000000093dd74400d0300000000000443555200000000116d79206669727374207472616e73666572"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"console"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"region_id"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">"cycle_index"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">"data_access"</span>: [&#123;</span><br><span class="line">            <span class="string">"type"</span>: <span class="string">"write"</span>,</span><br><span class="line">            <span class="string">"scope"</span>: <span class="string">"currency"</span>,</span><br><span class="line">            <span class="string">"sequence"</span>: <span class="number">2</span></span><br><span class="line">          &#125;,&#123;</span><br><span class="line">            <span class="string">"type"</span>: <span class="string">"write"</span>,</span><br><span class="line">            <span class="string">"scope"</span>: <span class="string">"inita"</span>,</span><br><span class="line">            <span class="string">"sequence"</span>: <span class="number">0</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,&#123;</span><br><span class="line">        <span class="string">"receiver"</span>: <span class="string">"inita"</span>,</span><br><span class="line">        <span class="string">"act"</span>: &#123;</span><br><span class="line">          <span class="string">"account"</span>: <span class="string">"currency"</span>,</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"transfer"</span>,</span><br><span class="line">          <span class="string">"authorization"</span>: [&#123;</span><br><span class="line">              <span class="string">"actor"</span>: <span class="string">"currency"</span>,</span><br><span class="line">              <span class="string">"permission"</span>: <span class="string">"active"</span></span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          <span class="string">"data"</span>: &#123;</span><br><span class="line">            <span class="string">"from"</span>: <span class="string">"currency"</span>,</span><br><span class="line">            <span class="string">"to"</span>: <span class="string">"inita"</span>,</span><br><span class="line">            <span class="string">"quantity"</span>: <span class="string">"20.0000 CUR"</span>,</span><br><span class="line">            <span class="string">"memo"</span>: <span class="string">"my first transfer"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"hex_data"</span>: <span class="string">"0000001e4d75af46000000000093dd74400d0300000000000443555200000000116d79206669727374207472616e73666572"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"console"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"region_id"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">"cycle_index"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">"data_access"</span>: []</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"deferred_transactions"</span>: []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="è¯»å–æ ·ä¾‹è´§å¸åˆçº¦è´¦æˆ·ä½™é¢"><a href="#è¯»å–æ ·ä¾‹è´§å¸åˆçº¦è´¦æˆ·ä½™é¢" class="headerlink" title="è¯»å–æ ·ä¾‹è´§å¸åˆçº¦è´¦æˆ·ä½™é¢"></a>è¯»å–æ ·ä¾‹è´§å¸åˆçº¦è´¦æˆ·ä½™é¢</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  æŸ¥è¯¢ inita ä½™é¢</span></span><br><span class="line">$ ./eosioc get table inita currency account</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"rows"</span>: [&#123;</span><br><span class="line">      <span class="string">"currency"</span>: <span class="number">1381319428</span>,</span><br><span class="line">      <span class="string">"balance"</span>: <span class="number">200000</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"more"</span>: false</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#  æŸ¥è¯¢ currency ä½™é¢</span></span><br><span class="line">$ ./eosioc get table currency currency account</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"rows"</span>: [&#123;</span><br><span class="line">      <span class="string">"currency"</span>: <span class="number">1381319428</span>,</span><br><span class="line">      <span class="string">"balance"</span>: <span class="number">9800000</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"more"</span>: false</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img.i7years.com/blog/blockchain_exploer.png" alt=""></p>]]></content>
      
        <categories>
            
            <category> blockchain </category>
            
        </categories>
        
        
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> eos </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ç”±æµ…å…¥æ·±å­¦ä¹ EOS]]></title>
      <url>/posts/learning-eos-develop.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/eos-logo.jpg" alt="eos-logo"></p><p>å¸¦ä½ ç³»ç»Ÿæ€§åœ°ã€ç”±æµ…å…¥æ·±åœ°å­¦ä¹ å’Œäº†è§£EOSç›¸å…³æŠ€æœ¯â€¦â€¦</p><a id="more"></a><h1 id="å‰æ"><a href="#å‰æ" class="headerlink" title="å‰æ"></a>å‰æ</h1><ul><li><p>éœ€è¦å¯¹<code>åŒºå—é“¾</code>æœ‰ä¸ªåŸºæœ¬çš„è®¤è¯†ï¼Œæ¯”å¦‚ä»€ä¹ˆæ˜¯åŒºå—é“¾ï¼Œæœ‰å“ªäº›ç‰¹ç‚¹ç­‰ç­‰ï¼Œç½‘ä¸Šèµ„æ–™å¾ˆå¤šã€‚</p></li><li><p>å¯¹<code>æ¯”ç‰¹å¸</code>çš„å·¥ä½œåŸç†æœ‰ä¸€ä¸ªæ·±å…¥çš„ç ”ç©¶ï¼Œæ¨èã€Šç²¾é€šæ¯”ç‰¹å¸ã€‹ç¬¬äºŒç‰ˆï¼Œä¸€å®šè¦ç²¾è¯»ã€‚</p></li><li><p>å¯¹<code>ä»¥å¤ªåŠ</code>ã€<code>æ™ºèƒ½åˆçº¦</code>æœ‰æ‰€äº†è§£ã€‚</p></li></ul><h1 id="åˆè¯†EOS"><a href="#åˆè¯†EOS" class="headerlink" title="åˆè¯†EOS"></a>åˆè¯†EOS</h1><ul><li><p>ç†Ÿè¯»EOSç™½çš®ä¹¦ï¼Œè¿™ä¸€å—åé¢æˆ‘ä¼šå†™ä¸€äº›EOSç™½çš®ä¹¦è§£è¯»ç‰ˆå‡ºæ¥ã€‚</p><blockquote><p>ç™½çš®ä¹¦åœ°å€ï¼š<a href="https://github.com/EOSIO/Documentation" target="_blank" rel="noopener">https://github.com/EOSIO/Documentation</a></p></blockquote></li><li><p><a href="https://wangwei.one/posts/57dd6237.html">EOSæœ¯è¯­è¡¨</a></p></li></ul><h1 id="éƒ¨ç½²è¿è¡ŒEOS"><a href="#éƒ¨ç½²è¿è¡ŒEOS" class="headerlink" title="éƒ¨ç½²è¿è¡ŒEOS"></a>éƒ¨ç½²è¿è¡ŒEOS</h1><ol><li><a href="https://wangwei.one/posts/181733fc.html">è¿è¡ŒEOSæºä»£ç ï¼ˆä¸€ï¼‰</a></li><li><a href="https://wangwei.one/posts/b726a89e.html">è¿è¡ŒEOSæºä»£ç ï¼ˆäºŒï¼‰</a></li><li><a href="https://wangwei.one/posts/81ba25e.html">EOS Programs &amp; Tools ä»‹ç»</a></li><li><a href="https://wangwei.one/posts/869983fd.html">EOSè´§å¸åˆçº¦æ¼”ç¤º</a></li><li><a href="https://wangwei.one/posts/88eff102.html">è¿æ¥EOSå…¬å…±æµ‹è¯•ç½‘ç»œ</a></li></ol><p><img src="https://img.i7years.com/blog/blockchain_exploer.png" alt=""></p>]]></content>
      
        <categories>
            
            <category> blockchain </category>
            
        </categories>
        
        
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> eos </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[è¿æ¥EOSå…¬å…±æµ‹è¯•ç½‘ç»œ]]></title>
      <url>/posts/blockchain-eos-connect-public-network.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/eos-logo.jpg" alt="eos-logo"></p><blockquote><p>æœ¬æ–‡ä»‹ç»å¦‚ä½•å°†è‡ªå·±çš„æœ¬åœ°æµ‹è¯•ç½‘ç»œè¿æ¥åˆ°EOSå…¬å…±æµ‹è¯•ç½‘ç»œ(Public Testnet)ä¸Šã€‚</p><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://github.com/EOSIO/eos/wiki/Testnet%3A%20Public" target="_blank" rel="noopener">https://github.com/EOSIO/eos/wiki/Testnet%3A%20Public</a></p></blockquote><a id="more"></a><h1 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h1><p>æœ¬åœ°å·²ç»èƒ½å¤Ÿæ­£å¸¸è¿è¡Œèµ·äº†EOSçš„æµ‹è¯•ç½‘ç»œã€‚å¦‚æœ‰é—®é¢˜ï¼Œå¯å‚è€ƒè¿™ç¯‡æ–‡æ¡£ï¼š<a href="https://wangwei.one/posts/181733fc.html">è¿è¡ŒEOSæºä»£ç ï¼ˆä¸€ï¼‰</a></p><h1 id="å…¬å…±æµ‹è¯•ç½‘ç»œç«¯ç‚¹-Public-Testnet-Endpoints"><a href="#å…¬å…±æµ‹è¯•ç½‘ç»œç«¯ç‚¹-Public-Testnet-Endpoints" class="headerlink" title="å…¬å…±æµ‹è¯•ç½‘ç»œç«¯ç‚¹(Public Testnet Endpoints)"></a>å…¬å…±æµ‹è¯•ç½‘ç»œç«¯ç‚¹(Public Testnet Endpoints)</h1><p>ç°åœ¨å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼å»è®¿é—®EOS Public Testnet Endpoints</p><ul><li>HTTP Endpoint: <code>testnet1.eos.io</code></li><li>P2P Endpoint: <code>p2p-testnet1.eos.io:9876</code></li><li>Web Wallet Endpoint: <code>t1wallet.eos.io</code>, <code>t1api.eos.io</code>, <code>t1readonly.eos.io</code></li></ul><p>é€šè¿‡æµè§ˆå™¨æˆ–è€…ç»ˆç«¯å‘½ä»¤è¡Œ<code>crul</code>è®¿é—®<code>testnet1.eos.io/v1/chain/get_info</code>,è·å¾—æµ‹è¯•é“¾ä¿¡æ¯</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl testnet1.eos.io/v1/chain/get_info</span><br></pre></td></tr></table></figure><p><img src="https://img.i7years.com/blog/WX20180122-193329.png" alt=""></p><h1 id="å°†æœ¬åœ°EOSD-EOSæœåŠ¡ç«¯-è¿æ¥åˆ°å…¬å…±æµ‹è¯•ç½‘ç»œä¸Š"><a href="#å°†æœ¬åœ°EOSD-EOSæœåŠ¡ç«¯-è¿æ¥åˆ°å…¬å…±æµ‹è¯•ç½‘ç»œä¸Š" class="headerlink" title="å°†æœ¬åœ°EOSD(EOSæœåŠ¡ç«¯)è¿æ¥åˆ°å…¬å…±æµ‹è¯•ç½‘ç»œä¸Š"></a>å°†æœ¬åœ°EOSD(EOSæœåŠ¡ç«¯)è¿æ¥åˆ°å…¬å…±æµ‹è¯•ç½‘ç»œä¸Š</h1><h4 id="ä¿®æ”¹é…ç½®æ–‡ä»¶config-ini"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶config-ini" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶config.ini"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶config.ini</h4><ul><li><p>è·¯å¾„ï¼š<code>~/eos/build/scripts/testnet_np/config.ini</code></p></li><li><p>å°†é…ç½®é¡¹<code>p2p-server-address</code>ä¸­çš„<code>localhost</code>æ”¹ä¸ºä½ å½“å‰ç½‘ç»œçš„<code>å…¬ç½‘Ipåœ°å€</code>ï¼Œå¦åˆ™åé¢è¿è¡Œæ—¶ä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š</p><blockquote><p>å…¬ç½‘IpæŸ¥è¯¢ï¼šç›´æ¥ç™¾åº¦ï¼Œè¾“å…¥IPï¼Œå³å¯æŸ¥è¯¢</p></blockquote></li></ul><p><img src="https://img.i7years.com/blog/photo_2018-01-22_19-41-09.jpg" alt=""></p><h4 id="æ‰§è¡Œè„šæœ¬"><a href="#æ‰§è¡Œè„šæœ¬" class="headerlink" title="æ‰§è¡Œè„šæœ¬"></a>æ‰§è¡Œè„šæœ¬</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰§è¡Œå…¬å…±æµ‹è¯•ç½‘ç»œè¿æ¥è„šæœ¬</span></span><br><span class="line">$ cd ~/eos/build/scripts</span><br><span class="line">$ ./start_npnode.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ—¥å¿—è¾“å‡º</span></span><br><span class="line">Launched eosd.</span><br><span class="line">See testnet_np/stderr.txt <span class="keyword">for</span> eosd output.</span><br><span class="line">Synching requires at least <span class="number">8</span> minutes, depending on network conditions.</span><br></pre></td></tr></table></figure><h4 id="æŸ¥è¯¢åŒºå—åŒæ­¥æ—¥å¿—"><a href="#æŸ¥è¯¢åŒºå—åŒæ­¥æ—¥å¿—" class="headerlink" title="æŸ¥è¯¢åŒºå—åŒæ­¥æ—¥å¿—"></a>æŸ¥è¯¢åŒºå—åŒæ­¥æ—¥å¿—</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tail -f testnet_np/stderr.txt</span><br></pre></td></tr></table></figure><p><img src="https://img.i7years.com/blog/WX20180122-194932@2x.png" alt=""></p><blockquote><p>çœ‹åˆ° accept_blockï¼ŒSyncing Blockchainï¼Œè¡¨ç¤ºæœ¬åœ°æ­£åœ¨ä»å…¬å…±æµ‹è¯•ç½‘ç»œä¸ŠåŒæ­¥åŒºå—ä¿¡æ¯ã€‚</p></blockquote><h1 id="ä½¿ç”¨EOSCå®¢æˆ·ç«¯è¿æ¥åˆ°å…¬å…±æµ‹è¯•ç½‘ç»œä¸Š"><a href="#ä½¿ç”¨EOSCå®¢æˆ·ç«¯è¿æ¥åˆ°å…¬å…±æµ‹è¯•ç½‘ç»œä¸Š" class="headerlink" title="ä½¿ç”¨EOSCå®¢æˆ·ç«¯è¿æ¥åˆ°å…¬å…±æµ‹è¯•ç½‘ç»œä¸Š"></a>ä½¿ç”¨EOSCå®¢æˆ·ç«¯è¿æ¥åˆ°å…¬å…±æµ‹è¯•ç½‘ç»œä¸Š</h1><h4 id="è¿æ¥Public-Testnet"><a href="#è¿æ¥Public-Testnet" class="headerlink" title="è¿æ¥Public Testnet"></a>è¿æ¥Public Testnet</h4><p>å½“<code>eosd</code>è¿æ¥åˆ°äº†Public Testnetä¸Šæ—¶ï¼Œå†ä½¿ç”¨<code>eosc</code>è¿æ¥åˆ°æœ¬åœ°æµ‹è¯•ç½‘ç»œlocalhost:80å³å¯</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ eosc -H $&#123;http_endpoint&#125; -p <span class="number">80</span> $&#123;options&#125; $&#123;subcommand&#125;</span><br></pre></td></tr></table></figure><h4 id="é’±åŒ…åŠŸèƒ½ä½¿ç”¨"><a href="#é’±åŒ…åŠŸèƒ½ä½¿ç”¨" class="headerlink" title="é’±åŒ…åŠŸèƒ½ä½¿ç”¨"></a>é’±åŒ…åŠŸèƒ½ä½¿ç”¨</h4><p>å…¬å…±æµ‹è¯•ç½‘ç»œæ²¡æœ‰æä¾›ä»»ä½•æœ‰å…³é’±åŒ…çš„åŠŸèƒ½ï¼Œä¸ºäº†èƒ½å¤Ÿå¯¹äº¤æ˜“è¿›è¡Œç­¾åã€å‘é€äº¤æ˜“ä¿¡æ¯ä»¥åŠè¿›è¡Œç›¸å…³çš„é’±åŒ…æ“ä½œï¼Œéœ€è¦ä½¿ç”¨<code>eosc</code>è¿æ¥åˆ°æœ¬åœ°æµ‹è¯•ç½‘ç»œä¸Šå¹¶ä¸”è¦å°† <code>eosd</code>è¿æ¥åˆ°Public Testnetä¸Šæ—¶ï¼Œè¿™æ ·æ‰èƒ½è¿›è¡Œç›¸å…³é’±åŒ…çš„æ“ä½œã€‚</p><h5 id="åˆ›å»ºé’±åŒ…"><a href="#åˆ›å»ºé’±åŒ…" class="headerlink" title="åˆ›å»ºé’±åŒ…"></a>åˆ›å»ºé’±åŒ…</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd ~/eos/build/programs/eosc</span><br><span class="line">$ ./eosc wallet create</span><br></pre></td></tr></table></figure><p><img src="https://img.i7years.com/blog/WX20180124-231535@2x.png" alt=""></p><h5 id="åˆ›å»ºå¯†é’¥å¯¹"><a href="#åˆ›å»ºå¯†é’¥å¯¹" class="headerlink" title="åˆ›å»ºå¯†é’¥å¯¹"></a>åˆ›å»ºå¯†é’¥å¯¹</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd ~/eos/build/programs/eosc</span><br><span class="line">$ ./eosc create key</span><br></pre></td></tr></table></figure><p><img src="https://img.i7years.com/blog/WX20180124-232320@2x.png" alt=""></p><h5 id="å¯¼å…¥ç§é’¥"><a href="#å¯¼å…¥ç§é’¥" class="headerlink" title="å¯¼å…¥ç§é’¥"></a>å¯¼å…¥ç§é’¥</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cd ~/eos/build/programs/eosc</span><br><span class="line">$ ./eosc wallet import <span class="number">5</span>xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><br><span class="line">imported private key <span class="keyword">for</span>: EOSxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><br></pre></td></tr></table></figure><p><img src="https://img.i7years.com/blog/blockchain_exploer.png" alt=""></p>]]></content>
      
        <categories>
            
            <category> blockchain </category>
            
        </categories>
        
        
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> eos </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[EOSå­¦ä¹ (2) | EOS Glossary]]></title>
      <url>/posts/blockchain-eos-glossary.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/eos-logo.jpg" alt="eos-logo"></p><blockquote><p>æœ¬æ–‡ä»‹ç»å’ŒEOSç›¸å…³çš„ä¸€äº›æœ¯è¯­</p><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://github.com/eosio/eos/wiki/Glossary" target="_blank" rel="noopener">https://github.com/eosio/eos/wiki/Glossary</a></p></blockquote><a id="more"></a><h2 id="Account-è´¦æˆ·"><a href="#Account-è´¦æˆ·" class="headerlink" title="Account(è´¦æˆ·)"></a>Account(è´¦æˆ·)</h2><h5 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h5><p>An on-chain identifier made up of native and/or custom permissions that are assigned one or more keys or accounts.</p><blockquote><p>ç”±æœ¬åœ°å’Œ/æˆ–è‡ªå®šä¹‰æƒé™ç»„æˆçš„é“¾ä¸Šæ ‡è¯†ç¬¦ï¼Œå¯ä»¥åˆ†é…ä¸€ä¸ªæˆ–å¤šä¸ªå¯†é’¥æˆ–è€…å¸æˆ·ã€‚</p></blockquote><h2 id="Authority-æƒåŠ›"><a href="#Authority-æƒåŠ›" class="headerlink" title="Authority(æƒåŠ›)"></a>Authority(æƒåŠ›)</h2><h5 id="å®šä¹‰-1"><a href="#å®šä¹‰-1" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h5><p>An abstract of permissions that represent how permissions are organized in reality that are bound to an individual or groups of individuals.</p><blockquote><p>ä»£è¡¨ç°å®ä¸–ç•Œä¸­ä¸€ä¸ªä¸ªä½“æˆ–è€…ä¸€ç¾¤ä¸ªä½“çš„æƒé™ç»„ç»‡æ–¹å¼çš„æŠ½è±¡å®šä¹‰ã€‚</p></blockquote><h2 id="Block-åŒºå—"><a href="#Block-åŒºå—" class="headerlink" title="Block(åŒºå—)"></a>Block(åŒºå—)</h2><h5 id="åŒä¹‰è¯"><a href="#åŒä¹‰è¯" class="headerlink" title="åŒä¹‰è¯"></a>åŒä¹‰è¯</h5><blockquote><p>Blk</p></blockquote><h5 id="å®šä¹‰-2"><a href="#å®šä¹‰-2" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h5><p>A confirmable unit of the Blockchain. Each block contains zero or more Transactions, as well as a cryptographic connection to all prior blocks. When a block becomes â€œirreversibly confirmedâ€ ï¼Œitâ€™s because a supermajority of Block Producers have agreed that the given Block contains correct Transactions. Once a Block is irreversibly confirmed, it becomes a permanent part of the immutable Blockchain.</p><blockquote><p>åŒºå—é“¾çš„å¯ç¡®è®¤å•ä½ã€‚ æ¯ä¸ªåŒºå—åŒ…å«é›¶ç¬”æˆ–å¤šç¬”äº¤æ˜“ï¼Œä»¥åŠåˆ°å…ˆå‰æ‰€æœ‰åŒºå—çš„åŠ å¯†è¿æ¥ã€‚ å½“ç»å¯¹å¤šæ•°çš„åŒºå—ç”Ÿäº§è€…çš„ä¸€è‡´åŒæ„è¯¥åŒºå—åŒ…å«äº†æ­£ç¡®çš„äº¤æ˜“æ—¶ï¼Œ è¿™ä¸ªåŒºå—å°±å˜æˆäº†â€œä¸å¯é€†è½¬åœ°ç¡®è®¤â€ã€‚ ä¸€æ—¦ä¸€ä¸ªåŒºå—è¢«ä¸å¯é€†è½¬åœ°ç¡®è®¤ï¼Œå®ƒå°±æˆä¸ºä¸å¯å˜æ›´åŒºå—é“¾çš„æ°¸ä¹…çš„ä¸€éƒ¨åˆ†ã€‚</p></blockquote><h2 id="DAC-å»ä¸­å¿ƒåŒ–çš„è‡ªæ²»å›¢ä½“æˆ–å…¬å¸"><a href="#DAC-å»ä¸­å¿ƒåŒ–çš„è‡ªæ²»å›¢ä½“æˆ–å…¬å¸" class="headerlink" title="DAC(å»ä¸­å¿ƒåŒ–çš„è‡ªæ²»å›¢ä½“æˆ–å…¬å¸)"></a>DAC(å»ä¸­å¿ƒåŒ–çš„è‡ªæ²»å›¢ä½“æˆ–å…¬å¸)</h2><h5 id="å®šä¹‰-3"><a href="#å®šä¹‰-3" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h5><p>Decentralized Autonomous Collective, or Decentralized Autonomous Corporation.</p><blockquote><p>å»ä¸­å¿ƒåŒ–çš„è‡ªæ²»é›†ä½“æˆ–å»ä¸­å¿ƒåŒ–çš„è‡ªæ²»å…¬å¸</p></blockquote><h2 id="DAO-å»ä¸­å¿ƒåŒ–è‡ªæ²»ç»„ç»‡"><a href="#DAO-å»ä¸­å¿ƒåŒ–è‡ªæ²»ç»„ç»‡" class="headerlink" title="DAO(å»ä¸­å¿ƒåŒ–è‡ªæ²»ç»„ç»‡)"></a>DAO(å»ä¸­å¿ƒåŒ–è‡ªæ²»ç»„ç»‡)</h2><h5 id="å®šä¹‰-4"><a href="#å®šä¹‰-4" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h5><p>Decentralized Autonomous Organization.</p><blockquote><p>å»ä¸­å¿ƒåŒ–çš„è‡ªæ²»ç»„ç»‡</p></blockquote><h2 id="DPoS-æˆæƒè‚¡æƒè¯æ˜æœºåˆ¶"><a href="#DPoS-æˆæƒè‚¡æƒè¯æ˜æœºåˆ¶" class="headerlink" title="DPoS(æˆæƒè‚¡æƒè¯æ˜æœºåˆ¶)"></a>DPoS(æˆæƒè‚¡æƒè¯æ˜æœºåˆ¶)</h2><h5 id="å®šä¹‰-5"><a href="#å®šä¹‰-5" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h5><p>Delegated Proof of Stake. Also, â€œDemocracy as Proof of Stake.â€ DPoS is one of a collection of consensus algorithms, i.e. methods by which block producers can agree (reach consensus) on which transactions and which blocks are â€œrealâ€ and should be confirmed and treated as irreversible.</p><blockquote><p><strong>æˆæƒè‚¡æƒè¯æ˜æœºåˆ¶</strong>ï¼Œä¹Ÿå«åšâ€æ°‘ä¸»ä¸»ä¹‰è¯æ˜æœºåˆ¶â€ã€‚DPoSæ˜¯å…±è¯†ç®—æ³•é›†åˆä¸­çš„ä¸€ç§ï¼Œå³é€‰å–å“ªäº›åŒºå—ç”Ÿäº§è€…å¯ä»¥åŒæ„ï¼ˆè¾¾æˆå…±è¯†ï¼‰å“ªäº›äº¤æ˜“å’Œå“ªäº›åŒºå—æ˜¯â€œçœŸå®çš„â€å¹¶ä¸”åº”è¯¥è¢«ç¡®è®¤å’Œè¢«è§†ä¸ºä¸å¯é€†çš„ä¸€ç§ç®—æ³•ã€‚</p></blockquote><h2 id="Key-pair-å¯†é’¥å¯¹"><a href="#Key-pair-å¯†é’¥å¯¹" class="headerlink" title="Key pair(å¯†é’¥å¯¹)"></a>Key pair(å¯†é’¥å¯¹)</h2><h5 id="åŒä¹‰è¯-1"><a href="#åŒä¹‰è¯-1" class="headerlink" title="åŒä¹‰è¯"></a>åŒä¹‰è¯</h5><blockquote><p>keys</p></blockquote><h5 id="å®šä¹‰-6"><a href="#å®šä¹‰-6" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h5><p>A public key and its corresponding private key</p><blockquote><p>å…¬é’¥ä»¥åŠå’Œå®ƒå¯¹åº”çš„ç§é’¥</p></blockquote><h2 id="larimer-æ‹‰ç‘é»˜"><a href="#larimer-æ‹‰ç‘é»˜" class="headerlink" title="larimer(æ‹‰ç‘é»˜)"></a>larimer(æ‹‰ç‘é»˜)</h2><h5 id="å®šä¹‰-7"><a href="#å®šä¹‰-7" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h5><p>1/10000 of an EOS (token) <code>0.0001 EOS</code></p><blockquote><p>1 EOS = 10000 larimer</p></blockquote><h2 id="Master-Password-ä¸»å¯†ç "><a href="#Master-Password-ä¸»å¯†ç " class="headerlink" title="Master Password(ä¸»å¯†ç )"></a>Master Password(ä¸»å¯†ç )</h2><h5 id="å®šä¹‰-8"><a href="#å®šä¹‰-8" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h5><p>The password used to to unlock (decrypt) a wallet file</p><blockquote><p>ç”¨äºè§£é”ï¼ˆè§£å¯†ï¼‰é’±åŒ…æ–‡ä»¶çš„å¯†ç </p></blockquote><h2 id="Message-æ¶ˆæ¯"><a href="#Message-æ¶ˆæ¯" class="headerlink" title="Message(æ¶ˆæ¯)"></a>Message(æ¶ˆæ¯)</h2><h5 id="åŒä¹‰è¯-2"><a href="#åŒä¹‰è¯-2" class="headerlink" title="åŒä¹‰è¯"></a>åŒä¹‰è¯</h5><blockquote><p>Msg</p></blockquote><h5 id="å®šä¹‰-9"><a href="#å®šä¹‰-9" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h5><p>A change to the Blockchain. One or more messages make up a Transaction.</p><blockquote><p>è¡¨ç¤ºåŒºå—é“¾çš„ä¸€ç§å˜åŒ–ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆæ¯ç»„æˆä¸€ç¬”äº¤æ˜“.</p></blockquote><h2 id="Oracle-é¢„è¨€æœº"><a href="#Oracle-é¢„è¨€æœº" class="headerlink" title="Oracle(é¢„è¨€æœº)"></a>Oracle(é¢„è¨€æœº)</h2><h5 id="å®šä¹‰-10"><a href="#å®šä¹‰-10" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h5><p>â€œAn oracle, in the context of blockchains and smart contracts, is an agent that finds and verifies real-world occurrences and submits this information to a blockchain to be used by smart contracts.â€ <em><a href="https://blockchainhub.net/blockchain-oracles/" target="_blank" rel="noopener">Source</a></em></p><blockquote><p>åœ¨åŒºå—é“¾å’Œæ™ºèƒ½åˆçº¦çš„èƒŒæ™¯ä¸‹ï¼Œé¢„è¨€æœºæ˜¯ä¸€ä¸ªèƒ½å¤Ÿå‘ç°å’ŒéªŒè¯çœŸå®ä¸–ç•Œäº‹ä»¶çš„ä»£ç†ï¼Œå¹¶å°†è¿™äº›ä¿¡æ¯æäº¤ç»™æ™ºèƒ½åˆçº¦ä½¿ç”¨çš„åŒºå—é“¾ã€‚<a href="https://blockchainhub.net/blockchain-oracles/" target="_blank" rel="noopener">è¯¦æƒ…</a></p><blockquote><p>ç†è§£ï¼šé¢„è¨€æœºæ˜¯æ™ºèƒ½åˆçº¦è·å–å¤–éƒ¨ä¿¡æ¯çš„å”¯ä¸€é€”å¾„ã€‚æ™ºèƒ½åˆçº¦é€»è¾‘çš„è§¦å‘éœ€è¦ä¿¡æ¯æºï¼Œæ²¡æœ‰æä¾›å¤–éƒ¨ä¿¡æ¯çš„é¢„è¨€æœºï¼Œæ™ºèƒ½åˆçº¦çš„å®ç”¨æ€§å¤§æ‰“æŠ˜æ‰£</p></blockquote></blockquote><h2 id="Permission-æƒé™"><a href="#Permission-æƒé™" class="headerlink" title="Permission(æƒé™)"></a>Permission(æƒé™)</h2><h5 id="å®šä¹‰-11"><a href="#å®šä¹‰-11" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h5><p>A weighted security mechanism that determines whether or not a message is properly authorized by evaluating its signature(s) authority</p><blockquote><p>ä¸€ä¸ªåŠ æƒçš„å®‰å…¨æœºåˆ¶ï¼Œé€šè¿‡è¯„ä¼°å…¶ç­¾åæƒé™æ¥ç¡®å®šä¸€ä¸ªæ¶ˆæ¯æ˜¯å¦è¢«æ­£ç¡®æˆæƒ</p></blockquote><h2 id="Private-Key-ç§é’¥"><a href="#Private-Key-ç§é’¥" class="headerlink" title="Private Key(ç§é’¥)"></a>Private Key(ç§é’¥)</h2><h5 id="å®šä¹‰-12"><a href="#å®šä¹‰-12" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h5><p>A secret key used to sign transactions</p><blockquote><p>ç”¨äºç­¾ç½²äº¤æ˜“çš„å¯†é’¥</p></blockquote><h2 id="Public-Key-å…¬é’¥"><a href="#Public-Key-å…¬é’¥" class="headerlink" title="Public Key(å…¬é’¥)"></a>Public Key(å…¬é’¥)</h2><h5 id="åŒä¹‰è¯-3"><a href="#åŒä¹‰è¯-3" class="headerlink" title="åŒä¹‰è¯"></a>åŒä¹‰è¯</h5><blockquote><p>pub key</p></blockquote><h5 id="å®šä¹‰-13"><a href="#å®šä¹‰-13" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h5><p>A publicly available key that is transmitted alongside a transaction.</p><blockquote><p>ä¸äº¤æ˜“ä¸€èµ·ä¼ é€çš„å¯å…¬å¼€ä½¿ç”¨çš„å¯†é’¥</p></blockquote><h2 id="Smart-Contract-æ™ºèƒ½åˆçº¦"><a href="#Smart-Contract-æ™ºèƒ½åˆçº¦" class="headerlink" title="Smart Contract(æ™ºèƒ½åˆçº¦)"></a>Smart Contract(æ™ºèƒ½åˆçº¦)</h2><h5 id="å®šä¹‰-14"><a href="#å®šä¹‰-14" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h5><p>A smart contract is a computer protocol intended to facilitate, verify, or enforce the negotiation or performance of a contract.</p><blockquote><p>æ™ºèƒ½åˆçº¦æ˜¯ä¸€ç§æ—¨åœ¨ä¿ƒè¿›ã€éªŒè¯æˆ–æ‰§è¡Œåˆ¤æ–­æˆ–å±¥è¡ŒåˆåŒçš„è®¡ç®—æœºåè®®ã€‚</p></blockquote><h2 id="Transaction-äº¤æ˜“"><a href="#Transaction-äº¤æ˜“" class="headerlink" title="Transaction(äº¤æ˜“)"></a>Transaction(äº¤æ˜“)</h2><h5 id="åŒä¹‰è¯-4"><a href="#åŒä¹‰è¯-4" class="headerlink" title="åŒä¹‰è¯"></a>åŒä¹‰è¯</h5><blockquote><p>Tx, Txn</p></blockquote><h5 id="å®šä¹‰-15"><a href="#å®šä¹‰-15" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h5><p>A complete all-or-nothing change to the Blockchain. A combination of one or more Messages. Usually, the execution of a Smart Contract.</p><blockquote><p>åŒºå—é“¾ä¸Šå½»åº•çš„è¦ä¹ˆæœ‰è¦ä¹ˆæ— çš„å˜åŒ–ã€‚æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆæ¯çš„ç»„åˆã€‚é€šå¸¸ï¼Œç”¨äºæ™ºèƒ½åˆçº¦çš„æ‰§è¡Œã€‚</p></blockquote><h2 id="Wallet-é’±åŒ…"><a href="#Wallet-é’±åŒ…" class="headerlink" title="Wallet(é’±åŒ…)"></a>Wallet(é’±åŒ…)</h2><h5 id="å®šä¹‰-16"><a href="#å®šä¹‰-16" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h5><p>An encrypted file generated and/or managed by a client (for example, <code>eosc</code>) that manages private keys and facilitates the signing of transactions in a secure manner. Wallets may be in a locked or unlocked state.</p><blockquote><p>ç”±å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚<code>eosc</code>ï¼‰ç”Ÿæˆå’Œ/æˆ–ç®¡ç†çš„åŠ å¯†æ–‡ä»¶ï¼Œç”¨äºç®¡ç†ç§é’¥å¹¶ä¾¿äºä»¥å®‰å…¨æ–¹å¼ç­¾ç½²äº¤æ˜“ã€‚ é’±åŒ…å¯èƒ½å¤„äºé”å®šæˆ–è§£é”çŠ¶æ€ã€‚</p></blockquote><h2 id="Witness-è§è¯äºº"><a href="#Witness-è§è¯äºº" class="headerlink" title="Witness(è§è¯äºº)"></a>Witness(è§è¯äºº)</h2><h5 id="åŒä¹‰è¯-5"><a href="#åŒä¹‰è¯-5" class="headerlink" title="åŒä¹‰è¯"></a>åŒä¹‰è¯</h5><blockquote><p>block producer(åŒºå—ç”Ÿäº§è€…)</p></blockquote><h5 id="å®šä¹‰-17"><a href="#å®šä¹‰-17" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h5><p>The node that is currently taking its turn producing the â€œright nowâ€ block for the blockchain. Or, a member of the group of nodes who have been elected to take such turns. Synonymous with â€˜block producerâ€™.</p><blockquote><p>å½“å‰æ­£åœ¨è½®æµä¸ºåŒºå—é“¾ç”Ÿäº§â€œç«‹å³â€åŒºå—çš„èŠ‚ç‚¹ã€‚ æˆ–è€…ï¼Œè¢«é€‰ä¸ºè½®æµèŠ‚ç‚¹ç»„çš„ç»„æˆæˆå‘˜ä¹‹ä¸€ã€‚ ä¸â€œåŒºå—ç”Ÿäº§è€…â€åŒä¹‰ã€‚</p></blockquote><p><img src="https://img.i7years.com/blog/blockchain_exploer.png" alt=""></p>]]></content>
      
        <categories>
            
            <category> blockchain </category>
            
        </categories>
        
        
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> eos </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[å…¨çƒåŒºå—é“¾é¡¶çº§ä¼šè®®Token Summit 2017ä¸€æ‰‹ä¿¡æ¯è§£è¯»]]></title>
      <url>/posts/blockchain-token-summit-2017.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><blockquote><p>ä»¥ä¸‹å†…å®¹å‡æ¥è‡ªxditeè€å¸ˆçš„ç›´æ’­åˆ†äº«</p></blockquote><h1 id="Token-Summit-ä»‹ç»"><a href="#Token-Summit-ä»‹ç»" class="headerlink" title="Token Summit ä»‹ç»"></a>Token Summit ä»‹ç»</h1><h3 id="Token-Summit"><a href="#Token-Summit" class="headerlink" title="Token Summit"></a>Token Summit</h3><ul><li>å…¨çƒåŒºå—é“¾çš„é¡¶çº§ä¼šè®®ï¼Œæ˜¯åŒºå—é“¾è¡Œä¸šé‡Œæœ€å…·å…¬ä¿¡åŠ›çš„ä¼šè®®</li></ul><a id="more"></a><h3 id="ä¼šè®®ä¸»é¢˜"><a href="#ä¼šè®®ä¸»é¢˜" class="headerlink" title="ä¼šè®®ä¸»é¢˜"></a>ä¼šè®®ä¸»é¢˜</h3><ul><li><p>Token Summit Iï¼šExplored in-depth the Token-Based Economy.</p><blockquote><p>ç¬¬ä¸€æ¬¡ä¼šè®®ä¸»è¦æ·±åº¦æ¢è®¨ä»¥ä»£å¸ä¸ºåŸºç¡€çš„æ•°å­—ç»æµã€‚</p></blockquote></li><li><p>Token Summit IIï¼šDiscuss the economics, regulation and practices around blockchain-based tokens, protocols, and crypto-assets. Focus on Designing Token-Based Economies, a key theme for this conference.</p><blockquote><p>ç¬¬äºŒæ¬¡ä¼šè®®è®¨è®ºåŸºäºåŒºå—é“¾çš„ä»£å¸ï¼Œåè®®å’ŒåŠ å¯†èµ„äº§çš„ç»æµï¼Œæ³•è§„å’Œå®è·µã€‚é‡ç‚¹å…³æ³¨è®¾è®¡ä»¤ç‰Œç»æµã€‚</p></blockquote></li></ul><h3 id="ä¸»è¦çš„å‚ä¸è€…"><a href="#ä¸»è¦çš„å‚ä¸è€…" class="headerlink" title="ä¸»è¦çš„å‚ä¸è€…"></a>ä¸»è¦çš„å‚ä¸è€…</h3><ul><li>ä¼ä¸šå®¶ã€æŠ•èµ„è€…ã€é‡‘èä¸“ä¸šäººå£«ã€å¾‹å¸ˆã€åŸºé‡‘ç»ç†ã€ç›‘ç®¡è€…æˆ–å•†ä¸šä¸»ç®¡ç­‰</li></ul><h3 id="ä»·å€¼"><a href="#ä»·å€¼" class="headerlink" title="ä»·å€¼"></a>ä»·å€¼</h3><ul><li>å‘æ˜æ½œåœ¨çš„åˆ›æ–°æ€æƒ³ï¼Œæ–°çš„å•†ä¸šæ¨¡å¼ä»¥åŠå°šæœªè¢«å®æ–½çš„å•†ä¸šç‚¹å­</li></ul><h3 id="åˆ›å§‹äºº"><a href="#åˆ›å§‹äºº" class="headerlink" title="åˆ›å§‹äºº"></a>åˆ›å§‹äºº</h3><ul><li>William Mougayar</li><li>Twitterï¼š<a href="https://twitter.com/wmougayar" target="_blank" rel="noopener">https://twitter.com/wmougayar</a></li><li>è‘—ä½œï¼š<a href="https://www.amazon.com/Business-Blockchain-Practice-Application-Technology/dp/1119300312/ref=sr_1_1?ie=UTF8&amp;qid=1513312767&amp;sr=8-1&amp;keywords=The+Business+Blockchain" target="_blank" rel="noopener">ã€ŠThe Business Blockchainã€‹</a> / <a href="https://www.amazon.cn/dp/B01M1EKNFA/ref=sr_1_1?ie=UTF8&amp;qid=1513306546&amp;sr=8-1&amp;keywords=%E5%95%86%E4%B8%9A%E5%8C%BA%E5%9D%97%E9%93%BE%C2%B7%E5%BC%80%E5%90%AF%E5%8A%A0%E5%AF%86%E7%BB%8F%E6%B5%8E%E6%96%B0" target="_blank" rel="noopener">ã€Šå•†ä¸šåŒºå—é“¾Â·å¼€å¯åŠ å¯†ç»æµæ–°æ—¶ä»£ã€‹</a></li></ul><h3 id="ç½‘å€"><a href="#ç½‘å€" class="headerlink" title="ç½‘å€"></a>ç½‘å€</h3><ul><li>å®˜ç½‘åœ°å€ï¼š<a href="http://tokensummit.com/" target="_blank" rel="noopener">http://tokensummit.com/</a></li><li>Youtubeï¼š<a href="https://www.youtube.com/channel/UClKay1eOR8D825wY5PBYFUA" target="_blank" rel="noopener">Token Summit Official YouTube Channel</a></li></ul><h1 id="åˆ†äº«å†…å®¹"><a href="#åˆ†äº«å†…å®¹" class="headerlink" title="åˆ†äº«å†…å®¹"></a>åˆ†äº«å†…å®¹</h1><h2 id="æœ‰è¶£çš„ç°è±¡"><a href="#æœ‰è¶£çš„ç°è±¡" class="headerlink" title="æœ‰è¶£çš„ç°è±¡"></a>æœ‰è¶£çš„ç°è±¡</h2><ul><li><p>Token Summit ä¸€èˆ¬æ˜¯æ¯5~6æœˆä¸¾åŠä¸€æ¬¡ï¼Œä¼šè®®æ¯æ¬¡ä¸¾åŠçš„æ—¶å€™å¸ä»·éƒ½æ˜¯ä¸Šæ¬¡çš„5å€ï¼Œä¸­é—´é—´éš”å¤§çº¦5ä¸ªæœˆï¼Œç›®å‰è¿ç»­15ä¸ªæœˆï¼Œå¸ä»·è¿ç»­æ¶¨ 5 x 5 å€ã€‚</p><blockquote><p>æˆ‘ä»¬å¯ä»¥é¢„æµ‹5ä¸ªæœˆåçš„å¸ä»·å¤§æ¦‚æ˜¯å¤šå°‘(æ³¨æ„ï¼šè¿™å¹¶ä¸èƒ½ä½œä¸ºä½ çš„æŠ•èµ„å»ºè®®ï¼Œä¸è¦é¢ å€’å› æœå…³ç³» ~ ^_^ ~)</p></blockquote></li></ul><h2 id="å‡ ä¸ªè§‚ç‚¹"><a href="#å‡ ä¸ªè§‚ç‚¹" class="headerlink" title="å‡ ä¸ªè§‚ç‚¹"></a>å‡ ä¸ªè§‚ç‚¹</h2><ul><li><p><strong>å»ç°åœºå‚åŠ conferenceï¼Œå‘æ˜æœ€æ–°çš„è¡Œä¸šåŠ¨æ€</strong>ã€‚é¢†å…ˆä¸–ç•Œçš„æŠ€æœ¯éƒ½æ˜¯conferenceæ¼”è®²ä¸Šæåˆ°è¿‡çš„ï¼Œæ‰€ä»¥è¿½ä¸€äº›æœ€æ–°çš„æŠ€æœ¯ï¼Œæœ€å¥½æ˜¯åˆ°ç°åœºå»çœ‹ï¼Œç‰¹åˆ«æ˜¯åƒåŒºå—é“¾è¿™æ ·å¿«é€Ÿå‘å±•çš„æŠ€æœ¯ã€‚<strong>å¸åœˆä¸€æœˆï¼Œäººé—´ä¸€å¹´</strong>ã€‚å½“æˆ‘ä»¬æŠ•èµ„çš„ä¸œè¥¿æœ‰ä¿¡æ¯å·®æ—¶ï¼Œä¸€å®šè¦åˆ°ç°åœºå»çœ‹ï¼Œå»æ„Ÿå—è¡Œä¸šç°åœ¨çš„çƒ­åº¦ã€‚</p></li><li><p><strong>ç‰›å¸‚çš„åˆ¤æ–­æ–¹æ³•</strong>ï¼Œå½“ä½ çœ‹åˆ°ä¹±ä¸ƒå…«ç³Ÿçš„å°å¸éƒ½åœ¨æ¶¨çš„æ—¶å€™ï¼Œé‚£å·®ä¸å¤šå°±æ˜¯è¶‹è¿‘äºç‰›å¸‚äº†ï¼Œä½†æ˜¯å¦‚æœåªæœ‰BTCåœ¨æ¶¨ï¼Œé‚£è¿˜ç®—ä¸ä¸Šç‰›å¸‚ã€‚</p><blockquote><p>ä»Šå¹´ç‰›å¸‚çš„å‡ ä¸ªèŠ‚ç‚¹ï¼š2017å¹´5æœˆã€2017å¹´7æœˆã€2017å¹´12æœˆ</p></blockquote></li><li><p>ç°åœ¨è¿›åœºä¸ç®—æ™šï¼Œ<strong>ä¸€åˆ‡æ‰åˆšåˆšå¼€å§‹</strong>ã€‚æœ€è¿‘å‚åŠ ä¼šè®®ï¼Œæ˜æ˜¾æ„Ÿå—åˆ°ç°åœºçš„äººï¼Œéå¸¸éå¸¸å¤šï¼Œä¹‹å‰çš„ Token Summit éƒ½æ˜¯æŠ€æœ¯æ°´å¹³cutting edge(å‰æ²¿ã€å°–ç«¯)çš„äººå‚åŠ çš„ï¼Œç°åœ¨ä¹±ä¸ƒå…«ç³Ÿçš„Developer(å¼€å‘è€…)éƒ½ç–¯ç‹‚çš„æ¶Œå…¥åˆ°äº†è¿™ä¸ªä¸–ç•Œã€‚</p><blockquote><p>ä»¥ä»Šå¹´å›½å†…äº¤æ˜“æ‰€å…³é—­ä¸ºåˆ†ç•Œçº¿ï¼Œä¹‹å‰ç®—ä½œæ˜¯çŸ³å™¨æ—¶ä»£ï¼Œä¹‹åçš„ç°åœ¨å¤§æ¦‚å¤„äºå†œä¸šæ—¶ä»£ï¼Œç°åœ¨æœ‰è¶Šæ¥è¶Šå¤šçš„èµ„æœ¬ã€äº’è”ç½‘æ­£è§„å†›å’Œå¾ˆä¼šåšé¡¹ç›®çš„äººå†²äº†è¿›æ¥ï¼Œä¸€åˆ‡æ‰åˆšåˆšå¼€å§‹ï¼Œæƒ³è¦è¿™è¿™ä¸ªåŒºå—é“¾ä¸–ç•Œå­˜æ´»ï¼Œä¸€å®šè¦äº†è§£åŒºå—é“¾ä¸–ç•Œçš„ä¸€äº›æœ¬è´¨ã€‚</p></blockquote></li></ul><p><img src="https://img.i7years.com/blog/just_begin.jpg" alt="Everything is just beginning"></p><h2 id="ä»€ä¹ˆæ˜¯Token"><a href="#ä»€ä¹ˆæ˜¯Token" class="headerlink" title="ä»€ä¹ˆæ˜¯Token"></a>ä»€ä¹ˆæ˜¯Token</h2><p><strong>Token</strong>ï¼ˆä»£å¸ï¼‰ç®€è€Œè¨€ä¹‹å°±æ˜¯ä¸€ä¸ªåŒºå—é“¾é¡¹ç›®é‡Œçš„ä»·å€¼ç¬¦å·ã€‚ä¸€èˆ¬èµ·åˆ°ä»·å€¼å°ºåº¦ã€äº¤æ˜“åª’ä»‹ï¼Œæ‰¿æ‹…äº¤æ˜“è´¹ç”¨çš„ä½œç”¨ã€‚</p><h3 id="Tokenåˆ†ç±»"><a href="#Tokenåˆ†ç±»" class="headerlink" title="Tokenåˆ†ç±»"></a>Tokenåˆ†ç±»</h3><ul><li><p>Coinsï¼šå¤šåŠç”±æœºæ„æˆ–æ”¿åºœå‘è¡Œï¼Œä¸»è¦ä»·å€¼åœ¨äºè½¬ç§»èµ„é‡‘å’Œå‚¨å­˜ä»·å€¼ï¼Œä¾‹å¦‚BTCã€‚</p></li><li><p>Utility Tokensï¼ˆå·¥å…·ç±»çš„ä»£å¸ï¼‰ï¼šå‘è¡Œæ–¹å‘è¡Œçš„ç”¨äºæŸä¸€ä¸ªæœåŠ¡ä½¿ç”¨çš„åª’ä»‹ï¼Œåƒæ¶ˆè€—å“ã€æ‰‹ç»­è´¹ã€ä½¿ç”¨æƒåˆ©ã€‚</p></li><li><p>Tokenize Securityï¼ˆä»£å¸åŒ–çš„è¯åˆ¸ï¼‰ï¼šä¾æ®Howey testï¼ˆè±ªä¼Šæµ‹è¯•ï¼‰åŸåˆ™ï¼Œåˆ¤æ–­é‡‘èäº§å“æ˜¯å¦å±äºè¯åˆ¸æ³•è§„å®šçš„æŠ•èµ„å¥‘çº¦ï¼š</p><blockquote><ol><li>å¿…é¡»æœ‰é‡‘é’±çš„æŠ•èµ„ ï¼ˆinvestment of moneyï¼‰</li><li>èµ„é‡‘å¿…é¡»æŠ•èµ„äºä¸€ä¸ªå…±åŒäº‹ä¸šï¼ˆcommon enterpriseï¼‰</li><li>æŠ•èµ„äººæœ‰è·åˆ©ä¹‹æœŸæœ›ï¼ˆexpectation of profitï¼‰</li><li>åˆ©æ¶¦ä¹‹æœ‰æ— ï¼Œå…¨ç„¶æ¥è‡ªäºä»–äººçš„åŠªåŠ›ï¼ˆsolely from the efforts of othersï¼‰</li></ol></blockquote></li></ul><h3 id="ç†è§£Tokençš„é‡è¦æ€§"><a href="#ç†è§£Tokençš„é‡è¦æ€§" class="headerlink" title="ç†è§£Tokençš„é‡è¦æ€§"></a>ç†è§£Tokençš„é‡è¦æ€§</h3><ul><li><p>å¾ˆå¤šäººå®¹æ˜“æ··æ·†<code>Utility Tokens</code>å’Œ<code>Tokenize Security</code></p></li><li><p>å†å²èƒŒæ™¯</p><blockquote><p>ICO æœ€æ—©çš„å½¢å¼æ˜¯Tokençš„æ— å¿æèµ ï¼Œåæ¥è¡ç”Ÿä¸ºæœ‰äººæœŸå¾…è¿™ä¸ªæèµ æœ‰æ‰€å›æŠ¥ï¼Œä½†æ˜¯åœ¨è®¾è®¡å›æŠ¥çš„æ—¶å€™ï¼Œè¿™ä¸ªå›æŠ¥å°±ä¸å°å¿ƒè®¾è®¡æˆäº†<code>Tokenize Security</code>ã€‚æ‰€ä»¥ï¼ŒåŒºåˆ†<code>Utility Tokens</code>å’Œ<code>Tokenize Security</code>éå¸¸é‡è¦ï¼Œå› ä¸ºè¿™ä¼šå½±å“Tokençš„å®é™…ä»·å€¼å’ŒTokenåœ¨å„å›½çš„ç›‘ç®¡ç¨‹åº¦ã€‚</p></blockquote></li><li><p>æœ€æ–°çš„ç©æ³•ï¼ˆä¸­å›½å¼çš„ç©æ³•ï¼‰</p><ul><li><strong>ç”¨Tokenå…‘æ¢Token</strong><ul><li>ç›´æ¥æèµ Tokenæˆ–è€…ç›´æ¥ç”¨æ³•å¸è´­ä¹°Tokenéƒ½ä¼šæ³•å¾‹é£é™©ï¼›</li><li>Tokenæ˜¯å±äºå•†å“ï¼Œç”¨å•†å“å…‘æ¢å•†å“å¹¶ä¸å¤ªè§¦çŠ¯æ³•å¾‹ã€‚</li></ul></li><li><strong>Tokenå›è´­</strong><ul><li>æ‰¿è¯ºTokenä¼šå›æŠ¥åˆ©æ¶¦ï¼Œå°±æœ‰å¯èƒ½å˜æˆSecurityï¼ŒSecurityåœ¨å„å›½éƒ½ä¼šè¢«é“¶ç›‘ä¼šã€è¯ç›‘ä¼šæˆ–SCEç›‘ç®¡ã€‚ç®¡ä¸æ˜¯é—®é¢˜ï¼Œä½†æ˜¯è¿™åè€Œä¼šé™åˆ¶å•†ä¸šæ¨¡å‹çš„å‘å±•ã€‚</li><li>æ‹¿åˆ©æ¶¦å»å›è´­å¸‚é¢ä¸Šçš„Tokenï¼Œç„¶åæŠŠè¿™äº›Tokenæ‹¿å»é”€æ¯ï¼Œé”€æ¯ä¼šå¯¼è‡´ä»·æ ¼çš„è‡ªç„¶ä¸Šæ¶¨ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…Utility Tokenså˜æˆTokenize Securityã€‚è¿™ä¹Ÿæ˜¯ç›®å‰Utility Tokensçš„ä¸»è¦å‘è¡Œæ–¹å¼ã€‚</li></ul></li></ul></li></ul><h3 id="Tokençš„å¸ä»·ä»ä½•è€Œæ¥"><a href="#Tokençš„å¸ä»·ä»ä½•è€Œæ¥" class="headerlink" title="Tokençš„å¸ä»·ä»ä½•è€Œæ¥"></a>Tokençš„å¸ä»·ä»ä½•è€Œæ¥</h3><ul><li><p>Tokenæœ¬èº«å…·æœ‰çœŸæ­£çš„ä»·å€¼</p><ul><li>Utilityç±»çš„Tokenæ¶ˆè€—è¿‡å¿«ï¼Œé™ä½äº†Supply(ä¾›ç»™)ï¼Œå¯¼è‡´ä»·æ ¼ä¸Šå‡ï¼›</li><li>æœ¬èº«å…·æœ‰æ‰¿è½½ä»·å€¼ï¼Œæ¯”å¦‚BTCå’ŒETHï¼Œè¢«æ‹¿æ¥å½“è½¬è´¦çš„ç½‘ç»œï¼›</li><li>æ‹¿æ¥å½“ä¼—ç­¹çš„ç­¹ç ï¼Œæ¯”å¦‚ETHã€EOS</li><li>äº¤æ˜“åª’ä»‹ï¼Œäº¤æ˜“æ‰€å‘è¡Œçš„ä»£å¸ï¼Œä¾‹å¦‚BNBã€QASHã€Tether(USDT)ã€‚äº¤æ˜“æ‰€ä¸ºä»€ä¹ˆä¼šå‘è¡ŒTokenå‘¢ï¼Ÿ1ï¼‰æˆ‘ä»¬çš„èµ„äº§å­˜åœ¨äº¤æ˜“æ‰€ï¼Œéœ€è¦ä¸€ä¸ªé¿é™©çš„ç¼“å†²ç©ºé—´ï¼›2ï¼‰å„å›½çš„æ³•å¸å…¥å£éƒ½æœ‰ä¸€å®šçš„å±é™©ï¼›3ï¼‰é€šè¿‡äº¤æ˜“æ‰€å‘è¡Œçš„Tokenå»å…‘æ¢å…¶ä»–çš„Tokenï¼Œå¯ä»¥è§„é¿æ³•å¾‹é£é™©</li></ul></li><li><p>ç¾¤ä¼—æœŸå¾…Tokenäº§ç”Ÿä»·å€¼</p><ul><li>å…¬å¸å¸ã€‚å…¬å¸å‘è¡Œçš„Tokenã€‚å…¬å¸è·Ÿè°åˆä½œï¼Œç¾¤ä¼—ä¼šæœŸå¾…è¿™ä¸ªåˆä½œè€…ä¼šæ‹‰ç›˜ï¼Œä¼šæœ‰ä¸€äº›åˆ©å¥½ã€‚</li><li>ç¤¾ç¾¤å¸ã€‚æ¯”å¦‚åƒEOSã€ETHï¼Œå‘å¸ƒä¸€äº›æ–°çš„æ¶ˆæ¯ï¼Œæ¯”å¦‚æ”¹å–„æ€§èƒ½ã€ä¸Šä¸»ç½‘ã€åˆ†å‰ï¼Œç”±äºç¤¾ç¾¤çš„æ¶ˆæ¯åˆ©å¥½ï¼Œå¯èƒ½ä¼šé€ æˆçŸ­æœŸä»·æ ¼æ‹‰å‡ã€‚</li></ul></li></ul><p><strong>æŠ•èµ„å¸ç§çš„å»ºè®®</strong></p><p>1ï¼‰<strong>é€‰æ‹©å…·æœ‰é•¿æœŸä»·å€¼çš„å¸ç§</strong>ã€‚ä¸ç®¡æ˜¯æ¶ˆè€—å‹çš„ï¼Œè¿˜æ˜¯æ‰¿è½½ä»·å€¼ï¼Œè¿˜æ˜¯ä¼—ç­¹ï¼Œè¿™äº›éƒ½å¯èƒ½è®©ä»–çš„ä»·å€¼é£é€Ÿå¢åŠ ã€‚</p><p>2ï¼‰<strong>é€‰æ‹©ç¤¾ç¾¤å¸</strong>ã€‚å…¬å¸å¸æ‹‰ç›˜çš„æ•ˆæœæœ‰é™ï¼Œç¤¾ç¾¤å¸æœ‰å¹¿å¤§çš„å¼€å‘è€…å’Œåˆä½œå•†ï¼Œäººå¤šåŠ›é‡å¤§ï¼Œæ¶ˆæ¯é¢çš„ä¼ æ’­ä¼šäº§ç”Ÿå¾ˆå¤§çš„æ‹‰ç›˜æ•ˆæœã€‚</p><p>3ï¼‰<strong>ä¸€å®šè¦å¼„æ‡‚è‡ªå·±æŠ•èµ„çš„å“ç§ï¼Œæ‰¾åˆ°ä»·å€¼æŠ•èµ„çš„æ ¹æºæ‰€åœ¨</strong>ã€‚æƒ³è¦åšé•¿æœŸçš„ä»·å€¼æŠ•èµ„ï¼Œä¸€å®šè¦å¼„æ¸…æ¥šæˆ‘ä»¬æŠ•èµ„çš„é“¾ã€æŠ•èµ„çš„ä»£å¸çš„çœŸæ­£ä»·å€¼æ¥è‡ªäºå“ªé‡Œï¼Œæ˜¯å› ä¸ºä»€ä¹ˆæ‰äº§ç”Ÿä»·å€¼ï¼Œä¸ºä»€ä¹ˆå¸ä»·ä¼šä¸Šæ¶¨ã€‚</p><h1 id="Tokençš„åˆè§„åŒ–è¿›å±•"><a href="#Tokençš„åˆè§„åŒ–è¿›å±•" class="headerlink" title="Tokençš„åˆè§„åŒ–è¿›å±•"></a>Tokençš„åˆè§„åŒ–è¿›å±•</h1><h2 id="ICOå’ŒTokenå¸‚åœºçš„ä¸¤ç§çŠ¶å†µ"><a href="#ICOå’ŒTokenå¸‚åœºçš„ä¸¤ç§çŠ¶å†µ" class="headerlink" title="ICOå’ŒTokenå¸‚åœºçš„ä¸¤ç§çŠ¶å†µ"></a>ICOå’ŒTokenå¸‚åœºçš„ä¸¤ç§çŠ¶å†µ</h2><ul><li><p>å›½å¤–æ¯”è¾ƒè€å®ï¼Œå€¾å‘é€šè¿‡è·Ÿå¤§çš„å¸æ‰€ã€åˆè§„çš„å¸æ‰€åˆä½œï¼Œå°†Tokenåˆè§„åŒ–ã€‚</p></li><li><p>å›½å†…æ¯”è¾ƒå€¾å‘å‘æ˜ä¸åŒçš„ç©æ³•ï¼Œç»•è¿‡æ”¿åºœç›‘ç®¡ã€‚</p><blockquote><p>ç»•è¿‡ç›‘ç®¡å¹¶ä¸æ˜¯ä¸å¥½çš„ï¼Œè§„åˆ™å¹¶ä¸æ˜¯ç”±æ³•å¾‹è§„å®šçš„ï¼Œè€Œæ˜¯åœ¨ä¸å½±å“å¤§å®¶å…±åŒåˆ©ç›Šçš„æƒ…å†µä¸‹æ‰€è¾¾æˆçš„ä¸€ç§é›†ä½“å…±è¯†ã€‚</p><p>å¦‚æœè¿‡äºéµå®ˆæ”¿åºœç°æœ‰çš„æ³•è§„ï¼Œä¼šå¯¼è‡´æ•ˆç‡é™ä½ï¼Œä¼šé˜»ç¢è¡Œä¸šå‘å±•æ­¥ä¼ï¼Œä¸–ç•Œå¾—ä¸åˆ°æ¼”åŒ–ã€‚</p><p>å¦‚æœå¤ªç»•è§„å®šï¼Œä¼šå¯¼è‡´åŒºå—é“¾æŠ•èµ„è€…é¢ä¸´å·¨å¤§çš„é£é™©ã€‚</p></blockquote></li></ul><h2 id="ICOä¸ºä»€ä¹ˆè¦åˆè§„åŒ–"><a href="#ICOä¸ºä»€ä¹ˆè¦åˆè§„åŒ–" class="headerlink" title="ICOä¸ºä»€ä¹ˆè¦åˆè§„åŒ–"></a>ICOä¸ºä»€ä¹ˆè¦åˆè§„åŒ–</h2><ul><li><p>æ”¿åºœéœ€è¦ä¿æŠ¤æœ¬å›½çš„å›½æ°‘ã€‚ç”¨Tokenå‹Ÿé›†èµ„é‡‘å…¶å®éå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯è¿™ä¼šè®©å¾ˆå¤šä¸åˆæ ¼çš„æŠ•èµ„è€…ç›´æ¥é¢ä¸´å·¨å¤§çš„æŠ•èµ„é£é™©ã€‚</p><blockquote><p>ä»€ä¹ˆæ˜¯åˆæ ¼æŠ•èµ„äººã€‚å…·å¤‡ç›¸å½“ç¨‹åº¦çš„é£é™©è¯†åˆ«èƒ½åŠ›ä»¥åŠé£é™©æ‰¿æ‹…èƒ½åŠ›ã€‚ç®€è€Œè¨€ä¹‹ï¼Œ<strong>æ™ºå•†è¦é«˜çœ‹å¾—æ‡‚ï¼Œæœ‰é’±èµ”å¾—èµ·</strong>ã€‚</p></blockquote></li><li><p>å¦ä¸€æ–¹é¢ï¼ŒTokençš„å‘è¡Œå•†ä¹Ÿä¸å¸Œæœ›ä¸æ˜ç™½ä»·å€¼æŠ•èµ„çš„å°æ•£æˆ·éšæ„å†²è¿›æ¥ï¼Œè¿™ä¼šä¼¤å®³ç»è¥ç”Ÿæ„çš„ç¨³å®šæ€§ã€‚æ¯”å¦‚ï¼ŒTelegramä¸Šæ¯å¤©éƒ½ä¼šçœ‹åˆ°æœ‰äººå‚¬é—®å•¥æ—¶å€™ä¸Šäº¤æ˜“æ‰€å•Šï¼Œå¸ä»·ä»€ä¹ˆæ—¶å€™ç‚’å•Šï¼Œä»€ä¹ˆæ—¶å€™å‡å€¼å•Šã€‚</p></li></ul><h2 id="å›½å¤–ICOå‘è¡Œå¹³å°"><a href="#å›½å¤–ICOå‘è¡Œå¹³å°" class="headerlink" title="å›½å¤–ICOå‘è¡Œå¹³å°"></a>å›½å¤–ICOå‘è¡Œå¹³å°</h2><h3 id="ä¸»è¦çš„å¹³å°"><a href="#ä¸»è¦çš„å¹³å°" class="headerlink" title="ä¸»è¦çš„å¹³å°"></a>ä¸»è¦çš„å¹³å°</h3><ul><li><a href="https://coinlist.co/" target="_blank" rel="noopener">CoinList</a></li><li><em>ç›´å¸ƒç½—é™€</em>åŒºå—é“¾<em>äº¤æ˜“æ‰€</em>ï¼ˆGBXï¼‰</li><li><a href="https://www.kickico.com/zh/" target="_blank" rel="noopener">KICKICO</a>ã€‚å¹¶æœªåˆè§„ï¼Œåªæ˜¯è®©tokenä¸Šæ¶ï¼Œä¹Ÿä¸ä¼šæä¾›ä»¥ä¸‹çš„æœåŠ¡ã€‚</li></ul><h3 id="æä¾›çš„æœåŠ¡"><a href="#æä¾›çš„æœåŠ¡" class="headerlink" title="æä¾›çš„æœåŠ¡"></a>æä¾›çš„æœåŠ¡</h3><ul><li>å¸®åŠ©Tokenåšå‡ºåˆè§„çš„æ³•å¾‹æ¶æ„ï¼›</li><li>å¦‚æœTokenä¸å¯é¿å…åœ°è¦è®¾è®¡æˆSecurity(è¯åˆ¸)ï¼Œ ä»–ä»¬ä¼šå¸®åŠ©Tokenè®¾è®¡æˆåˆè§„çš„Securityï¼›</li><li>æä¾›åˆæ ¼çš„æŠ•èµ„äººï¼Œæä¾›åšå¹³å°ã€åšKYC(å……åˆ†äº†è§£ä½ çš„å®¢æˆ·)çš„æœåŠ¡ã€‚</li></ul><h2 id="ICS-é¦–æ¬¡å¹³å°å‘å”®"><a href="#ICS-é¦–æ¬¡å¹³å°å‘å”®" class="headerlink" title="ICS(é¦–æ¬¡å¹³å°å‘å”®)"></a>ICS(é¦–æ¬¡å¹³å°å‘å”®)</h2><ul><li>å¸åœˆç°åœ¨è¿˜å¤„äºæ··æ²Œæ—¶ä»£ï¼Œåˆè§„ä¸ä¸€å®šèµšé’±ï¼Œèµšé’±ä¸ä¸€å®šåˆè§„ï¼Œè¿˜æœ‰å·¨å¤§çš„é£é™©ã€‚å‘è¡Œæ‰€ä¸ä»…è¦åˆè§„ï¼Œæœ€é‡è¦çš„è¿˜éœ€è¦æœ‰å½±å“åŠ›ï¼Œå¦‚ä¸Šä¸‹æ¸¸æ‰“é€šï¼Œä¸€çº§äºŒçº§å¸‚åœºæ‰“é€šå»èµšé’±ã€‚</li><li>ICOé€šå¸¸çš„åšæ³•ï¼šè®¾è®¡ä¸€ä¸ªæ™ºèƒ½åˆçº¦ï¼Œæ‹¿ETHå…‘æ¢ç‰¹å®šçš„Tokenã€‚åˆçº¦æœ¬èº«ä¼šé”å®šèµ·ã€æœ€å¤§ä¸Šé™ã€è½¬æ¢æ¶ˆè€—çš„æ•ˆç‡ï¼Œé˜²æ­¢ä¸Šä¸‹é½æ‰‹äººä¸ºçš„é£é™©ã€‚</li><li>ICSï¼ˆé¦–æ¬¡å¹³å°å‘å”®ï¼‰ï¼Œå›½å†…å¸æ‰€è½¬å‹çš„å›½å¤–å¸æ‰€çš„å¸¸è§„åšæ³•ï¼Œå¸å¾ˆå®¹æ˜“è¢«é”€å”®å‡ºå»ï¼Œä½†æ˜¯æœ‰ä¸€å®šçš„é£é™©ã€‚å› ä¸ºä½ æ— æ³•çŸ¥é“åˆçº¦æ˜¯å¦é”å®šï¼Œå›¢é˜Ÿå’Œæœºæ„æ˜¯å¦ä¼šæ‹¿å‡ºæ¥ç ¸ç›˜ã€‚è™½ç„¶å¾ˆå…ˆè¿›ï¼Œä½†æ˜¯å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚</li></ul><h1 id="å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€"><a href="#å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€" class="headerlink" title="å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€"></a>å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€</h1><h3 id="ä¸‰å¤§äº¤æ˜“æ‰€å¯¹æ¯”"><a href="#ä¸‰å¤§äº¤æ˜“æ‰€å¯¹æ¯”" class="headerlink" title="ä¸‰å¤§äº¤æ˜“æ‰€å¯¹æ¯”"></a>ä¸‰å¤§äº¤æ˜“æ‰€å¯¹æ¯”</h3><table><thead><tr><th>äº¤æ˜“æ‰€</th><th>äº¤æ˜“ç±»å‹</th><th>ä¸‹åŠå¹´è§„åˆ’</th></tr></thead><tbody><tr><td>Kyber(KNC)</td><td>åšçš„æ˜¯ETH <em>on-chain</em>çš„äº¤æ˜“</td><td>ç§¯æä¸å¤šä¸ªå›½å†…å¤–å‡ åä¸‡ç”¨æˆ·çš„é’±åŒ…ã€ä¸æ³•å¸å‚å•†è¾¾æˆåˆä½œå…±è¯†ï¼Œè¾¾åˆ°å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€çš„è¿è¡Œæ•ˆç‡ã€‚</td></tr><tr><td>OmiseGo(omg)</td><td>åšçš„æ˜¯éƒ¨åˆ†çš„ETH <em>on-chain</em>çš„äº¤æ˜“ï¼Œåªæœ‰åœ¨ç»“ç®—é‚£éƒ¨åˆ†æ‰ä¼š<em>on-chain</em></td><td>ä¸<em>prisma</em>åˆä½œï¼Œæå‡äº¤æ˜“ã€æ”¯ä»˜çš„æ•ˆç‡ã€‚</td></tr><tr><td>0x(ZRX)</td><td>åšçš„æ˜¯ETH <em>on-chain</em>çš„äº¤æ˜“</td><td>å€¾å‘äºå°†è‡ªèº«ä½œä¸ºinfrastructure(åŸºç¡€è®¾æ–½)é”€å”®å‡ºå»ï¼Œè®©æ›´å¤šäº¤æ˜“æ‰€æˆ–è€…æ˜¯æƒ³å¼€äº¤æ˜“æ‰€çš„äººå¯ä»¥ç”¨0xæ‹“å±•è‡ªå·±çš„å¸æ‰€ã€‚</td></tr></tbody></table><h3 id="å¯¹äºäº¤æ˜“æ‰€çš„æ€è€ƒ"><a href="#å¯¹äºäº¤æ˜“æ‰€çš„æ€è€ƒ" class="headerlink" title="å¯¹äºäº¤æ˜“æ‰€çš„æ€è€ƒ"></a>å¯¹äºäº¤æ˜“æ‰€çš„æ€è€ƒ</h3><p>äº¤æ˜“æ‰€çš„æœ¬è´¨åœ¨äºäº¤æ˜“é€Ÿåº¦å’Œäº¤æ˜“æ·±åº¦ï¼Œäº¤æ˜“æ‰€çš„å‘å±•æ–¹å‘åº”è¯¥ä¾§é‡äºæå‡è¿™ä¸¤ä¸ªæœ¬è´¨æŒ‡æ ‡ã€‚æ‰€è°“çš„äº¤æ˜“æ‰€ï¼Œå…¶å®å°±æ˜¯è¦è®©èµ„äº§å¿«é€ŸæµåŠ¨èµ·æ¥ï¼Œå»ä¸å»ä¸­å¿ƒåŒ–å¹¶ä¸é‡è¦ï¼Œå»ä¸­å¿ƒåŒ–ä¼šå¸¦æ¥æ•ˆç‡é™ä½çš„å½±å“ï¼Œä¸­å¿ƒåŒ–è™½è¯´æœ‰æ•ˆç‡ä¸Šçš„æå‡ï¼Œä½†ä¹Ÿä¼šæœ‰ä¸Šä¸‹é½æ‰‹çš„é£é™©ã€‚</p><p>ä»»ä½•æŠ€æœ¯éƒ½æœ‰å…¶pros-cons(ä¼˜ç¼ºç‚¹)ï¼Œæˆ‘ä»¬è¦å›å½’æœ¬è´¨å»æ€è€ƒï¼Œä»–ä»¬çš„å›¢é˜Ÿæœ‰æ²¡æœ‰æœç€æœ¬è´¨çš„æ–¹å‘å»å‰è¡Œã€‚</p><h1 id="å¯¹äºåŒºå—é“¾çš„æ€è€ƒ"><a href="#å¯¹äºåŒºå—é“¾çš„æ€è€ƒ" class="headerlink" title="å¯¹äºåŒºå—é“¾çš„æ€è€ƒ"></a>å¯¹äºåŒºå—é“¾çš„æ€è€ƒ</h1><h3 id="åŒºå—é“¾äº§å“çš„æœ¬è´¨"><a href="#åŒºå—é“¾äº§å“çš„æœ¬è´¨" class="headerlink" title="åŒºå—é“¾äº§å“çš„æœ¬è´¨"></a>åŒºå—é“¾äº§å“çš„æœ¬è´¨</h3><p>åŒºå—é“¾çš„æœ¬è´¨å°±æ˜¯ä¸€æ¬¾èƒ½é€šä¿¡çš„æ•°æ®åº“äº§å“ï¼Œå®ƒæ‰€èƒ½åšåˆ°çš„ï¼Œæ•°æ®åº“åŠ ä¸Šç½‘è·¯é€šä¿¡ä¹Ÿå¯ä»¥åšåˆ°ã€‚</p><h3 id="ä»€ä¹ˆæ ·çš„åŒºå—é“¾äº§å“å€¼å¾—æŠ•èµ„"><a href="#ä»€ä¹ˆæ ·çš„åŒºå—é“¾äº§å“å€¼å¾—æŠ•èµ„" class="headerlink" title="ä»€ä¹ˆæ ·çš„åŒºå—é“¾äº§å“å€¼å¾—æŠ•èµ„"></a>ä»€ä¹ˆæ ·çš„åŒºå—é“¾äº§å“å€¼å¾—æŠ•èµ„</h3><h4 id="æ€è€ƒå‡ºå‘ç‚¹"><a href="#æ€è€ƒå‡ºå‘ç‚¹" class="headerlink" title="æ€è€ƒå‡ºå‘ç‚¹"></a>æ€è€ƒå‡ºå‘ç‚¹</h4><ul><li>è¿™æ¬¾åŒºå—é“¾äº§å“åˆ°åº•<strong>è§£å†³äº†ç°å®ä¸–ç•Œä¸­ä»€ä¹ˆæ ·çš„åˆšéœ€æ€§é—®é¢˜</strong>ï¼Ÿ</li><li>è¿™æ¬¾åŒºå—é“¾äº§å“åœ¨æ•ˆç‡æå‡æ–¹é¢å¤„äºä»€ä¹ˆæ ·çš„æ—¶é—´ç­‰çº§ï¼Ÿæ˜¯ä»¥day(å¤©)è®¡ç®—çš„ï¼Œè¿˜æ˜¯ä»¥hour(å°æ—¶)è®¡ç®—çš„ï¼Œè¿˜æ˜¯ä»¥min(åˆ†é’Ÿ)è®¡ç®—çš„ï¼Œè¿˜æ˜¯ä»¥sec(ç§’)è®¡ç®—çš„ã€‚</li><li>å®ƒåˆ°åº•æ˜¯åœ¨é©è°çš„å‘½ï¼Ÿå®ƒæå‡çš„æ•ˆç‡æ˜¯ä¸æ˜¯ç°æœ‰äº§å“æ–¹æ¡ˆçš„10å€ç”šè‡³æ˜¯100å€ï¼Ÿ</li></ul><h4 id="æˆåŠŸçš„æ¡ˆä¾‹"><a href="#æˆåŠŸçš„æ¡ˆä¾‹" class="headerlink" title="æˆåŠŸçš„æ¡ˆä¾‹"></a>æˆåŠŸçš„æ¡ˆä¾‹</h4><ul><li>ä¸ºä»€ä¹ˆè¯´BTCæˆ–ETHå¯¹è·¨å¢ƒæ”¯ä»˜æ¥è¯´æ˜¯ä¸€åœºé©å‘½ï¼Ÿç°åœ¨çš„è·¨å¢ƒæ”¯ä»˜é€šå¸¸ä½¿ç”¨SWIFTæ¨¡å¼ï¼Œä½†æ˜¯SWIFTæ¨¡å¼çš„äº¤æ˜“é€Ÿåº¦æ˜¯ä»¥Day(å¤©)ä¸ºå•ä½è¿›è¡Œè®¡ç®—çš„ï¼Œè€ŒBTCæˆ–ETHèƒ½å¤Ÿåœ¨å‡ åˆ†é’Ÿæˆ–è€…ä¸€ä¸¤ä¸ªå°æ—¶å†…å®Œæˆäº¤æ˜“ã€‚</li></ul><h4 id="è­¦æƒ•çš„è¯¯åŒº"><a href="#è­¦æƒ•çš„è¯¯åŒº" class="headerlink" title="è­¦æƒ•çš„è¯¯åŒº"></a>è­¦æƒ•çš„è¯¯åŒº</h4><ul><li>å¾ˆå¤šåŒºå—é“¾äº§å“å·ç§°æœ‰å¾ˆå¤šå¾ˆå¤šçš„åŠŸèƒ½ï¼Œä½†æ˜¯è¿™äº›åŠŸèƒ½å¹¶æ²¡æœ‰è§£å†³å®é™…çš„é—®é¢˜ï¼Œè§£å†³åˆšéœ€é—®é¢˜æ‰ä¼šæœ‰ä»·å€¼ï¼Œä¸è¦è¢«è¿™äº›åŠŸèƒ½è¿·æƒ‘ï¼Œè¦æ€è€ƒæœ¬è´¨åˆ°åº•æ˜¯ä»€ä¹ˆã€‚</li></ul><h4 id="ç†è®ºåŸºçŸ³"><a href="#ç†è®ºåŸºçŸ³" class="headerlink" title="ç†è®ºåŸºçŸ³"></a>ç†è®ºåŸºçŸ³</h4><ul><li><a href="https://strategyn.com/jobs-to-be-done/jobs-to-be-done-theory/" target="_blank" rel="noopener">Jobs to be done</a>ã€‚æ¨èä¹¦ç±ï¼šå…‹é›·é¡¿Â·å…‹é‡Œæ–¯æ±€ç”Ÿã€Š<a href="https://www.amazon.cn/dp/0062435612/ref=sr_1_fkmr0_1?ie=UTF8&amp;qid=1513392848&amp;sr=8-1-fkmr0&amp;keywords=Competing+Against+Luck+%E4%B8%AD%E6%96%87%E7%89%88" target="_blank" rel="noopener">Competing Against Luck</a>ã€‹/ ã€Š<a href="http://www.books.com.tw/products/0010760251" target="_blank" rel="noopener">å‰µæ–°çš„ç”¨é€”ç†è«–ï¼šæŒæ¡æ¶ˆè²»è€…é¸æ“‡ï¼Œå‰µæ–°ä¸å¿…ç¢°é‹æ°£</a>ã€‹</li><li>äº†è§£å®¢æˆ·çš„purposeï¼ˆæ„å›¾ï¼‰ã€‚åˆ›æ–°ä¸åªæ˜¯éœ€è¦äº†è§£å®¢æˆ·çš„éœ€æ±‚ï¼Œæ›´è¦äº†è§£ï¼šé¡¾å®¢é€‰æ‹©è¿™ä¸ªäº§å“åšä»€ä¹ˆï¼Ÿä¹Ÿå°±æ˜¯è¦äº†è§£ä½¿ç”¨äº§å“çš„çœŸæ­£ç”¨é€”ï¼Œåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ç”¨ï¼Œè¿œèƒœè¿‡æ‹¼å‘½æ”¹å–„äº§å“çš„åŠŸèƒ½ã€ç‰¹è‰²ã€‚</li><li>å¥½10å€çš„ç†è®ºã€‚æ¶ˆè´¹è€…ä¸€èˆ¬ä¼šå¯¹ç°æœ‰çš„solutionï¼ˆè§£å†³æ–¹æ¡ˆï¼‰ä¼šé«˜ä¼°3å€ä»¥ä¸Šï¼ŒåŒæ ·ï¼Œåˆ›ä¸šè€…ä¼šé«˜ä¼°è‡ªå·±åšå‡ºæ¥çš„äº§å“æ¯”å®é™…ä½œå‡ºæ¥çš„äº§å“è¦å¥½3å€ä»¥ä¸Šã€‚æ‰€ä»¥ï¼Œæ–°çš„äº§å“ä¸€å®šè¦æ¯”ç°æœ‰çš„äº§å“å¥½ 3 x 3 å€ï¼Œä¹Ÿå°±æ˜¯10å€ä»¥ä¸Šï¼Œå¥½ä¸€ç‚¹æ²¡ç”¨ï¼Œè¦å¥½å¾ˆå¤šå€ï¼Œæ‰èƒ½å¤Ÿè„±å¼•è€Œå‡ºã€‚ï¼ˆè¿™ä¸ªå’Œç¬‘æ¥è€å¸ˆè¯´çš„è¦åšè¿œè¶…ç¬¬äºŒçš„ç¬¬ä¸€åé“ç†ä¸€æ ·ï¼Œç§¯ç´¯å¤´éƒ¨æ•ˆåº”ï¼‰</li><li>è¿ç”¨<a href="https://strategyn.com/jobs-to-be-done/jobs-to-be-done-theory/" target="_blank" rel="noopener">Jobs to be done</a>å’Œ<code>å¥½10å€ç†è®º</code>ï¼Œå¯ä»¥å»åˆ¤æ–­å“ªä¸€äº›äº§å“å…¶å®æ˜¯è¨€è¿‡å…¶å®ã€‚</li></ul><h4 id="å¯¹EOSçš„å‡ ç‚¹ç–‘è™‘"><a href="#å¯¹EOSçš„å‡ ç‚¹ç–‘è™‘" class="headerlink" title="å¯¹EOSçš„å‡ ç‚¹ç–‘è™‘"></a>å¯¹EOSçš„å‡ ç‚¹ç–‘è™‘</h4><p>ETHé‡‡ç”¨çš„æ˜¯å·¥ä½œé‡è¯æ˜ï¼ˆProof of workï¼‰ç®—æ³•ï¼Œéœ€è¦è¿ç”¨çŸ¿å·¥çš„ç®—åŠ›ï¼Œæ•ˆç‡å¾ˆä½ï¼Œæœ€è¿‘è¢«ä¸€åªçŒ«æå®äº†ã€‚åªèƒ½æ‰¿è½½åˆ†çº§ä»¥ä¸Šçš„æ•ˆåº”ï¼Œä½†æ˜¯æ²¡æ³•æ‰¿è½½ç§’çº§ä»¥ä¸Šçš„æ•ˆåº”ã€‚EOSé‡‡ç”¨çš„æ˜¯å§”æ‰˜è‚¡æƒè¯æ˜ï¼ˆDelegated Proof of Stakeï¼‰ç®—æ³•ï¼Œæ¯”ETHå¿«å¾ˆå¤šï¼Œå·ç§°å¯ä»¥è¾¾åˆ°å•†ä¸šçº§çš„ã€‚</p><p>EOSçš„å±€é™ï¼š</p><ul><li>æœ¬è´¨ä¸Šè¿˜åªæ˜¯ä¸€ä¸ªå…¬å¸å¸ï¼ŒEOSæ²¡æœ‰å‚åŠ æœ¬æ¬¡çš„Summitï¼Œå›½å¤–çš„å¸åœˆä¸å¤ªå…³æ³¨EOSè¿™ä¸ªToken</li><li>EOSæƒ³è¦å»ºç«‹ä¸€ä¸ªç”Ÿæ€åœˆï¼Œè¦å…‹æœä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š<ul><li>æœ‰å¤šå°‘developeræ„¿æ„ç”¨ä½ ï¼Œæœ‰å¤šå°‘developeræ„¿æ„ä»ETHè½¬åˆ°EOSï¼ŒEOSæ˜¯å¦ç¬¦åˆ10å€ç†è®º</li><li>å¾ˆå¤šäººç°åœ¨æ˜¯é ç€ETHèµšé’±çš„ï¼Œæ¯”å¦‚ICOã€å¼€å‘æ™ºèƒ½åˆçº¦ã€åšç›¸å…³çš„Serviceç­‰ç­‰ï¼Œæ•´ä¸ªIndustryï¼ˆäº§ä¸šï¼‰éƒ½æ˜¯åŸºäºETHçš„ï¼ŒEOSå¤šå¤§ç¨‹åº¦ä¸Šèƒ½è¶…è¶ŠETHï¼Œç›®å‰æ¥çœ‹è¿˜æ˜¯ä¸ªç–‘é—®ã€‚</li></ul></li></ul><h1 id="é•¿çº¿æŠ•èµ„"><a href="#é•¿çº¿æŠ•èµ„" class="headerlink" title="é•¿çº¿æŠ•èµ„"></a>é•¿çº¿æŠ•èµ„</h1><p>æœ¬æ¬¡åˆ†äº«çš„ç›®çš„ï¼Œæ˜¯è®©å¤§å®¶é€šè¿‡å›½å¤–ç»è¥çš„ç°çŠ¶ã€è¿˜æœ‰Tokençš„æœ¬è´¨ã€è¿˜æœ‰æŠ€æœ¯åœˆåˆ†äº«çš„ç°å†µï¼Œè®©å¤§å®¶äº†è§£åŒºå—é“¾æŠ•èµ„æ˜¯æ€ä¹ˆæ ·ä¸€å›äº‹ã€‚</p><p>å¾ˆå¤šäººå–œæ¬¢æŠŠä¸“æ³¨åŠ›æ˜¯æ”¾åœ¨çŸ­çº¿ä¸Šï¼Œè¿™å…¶å®æ˜¯å¾ˆå¯æƒœçš„ã€‚</p><p>æ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯åšé•¿çº¿ï¼Œæœ‰äº›äººè®¤ä¸ºè‡ªå·±çš„é€ƒé¡¶çš„åŠŸå¤«å¾ˆå‰å®³ï¼Œä½†å…¶å®å®ƒå¹¶æ²¡æœ‰è·‘èµ¢å¤§ç›˜ï¼Œæ‰€è°“çš„è·‘èµ¢å¤§ç›˜ï¼Œå…¶å®æ˜¯èƒ½ä¸èƒ½è·‘èµ¢BTCï¼Œä½ çš„æŠ•èµ„æ•ˆåº”æœ‰æ²¡æœ‰è¶…è¶ŠBTCçš„æ¶¨å¹…å‘¢ï¼Ÿæ‰€ä»¥ï¼Œä½ ä¸åº”ä¸“æ³¨ä½ æŠ•èµ„çš„Coinæ¶¨äº†å¤šå°‘é’±ï¼Œè€Œæ˜¯åº”è¯¥ä¸“æ³¨Coinä½ æœ‰æ²¡æœ‰è¶…è¶ŠBTCçš„æ¶¨å¹…ã€‚</p><p>æ‰€ä»¥ï¼Œæƒ³è¦åšé•¿çº¿æŠ•èµ„ï¼Œä¸€å®šè¦å¯»æ‰¾åˆ°é‚£äº›èƒ½è·‘èµ¢BTCå¤§ç›˜çš„Coinã€‚</p><h1 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h1><ol><li><p>Qï¼šè¯·é—®eosè¿™ç§é“¾å†…æ‰©å±•æ–¹æ¡ˆè¿˜æ˜¯é›·ç”µç½‘ç»œè¿™ç§ä¾§é“¾æ‰©å±•æ–¹æ¡ˆæœ‰å‰é€”ï¼Ÿ</p><p>Aï¼šè¿™ä¸ªä¸ç¡®å®šï¼Œè¿™ä¸ªè¦çœ‹åŒºå—é“¾å®é™…å‘å±•é€Ÿåº¦å’Œå®é™…çš„Caseï¼ŒETHè¿™è¾¹çš„å‘å±•é€Ÿåº¦æœ‰ç‚¹æ…¢ï¼ŒETHå¦‚æœè¦è½¬æˆPoSï¼Œé‚£ä¼šè§¦åŠçŸ¿å·¥çš„åˆ©ç›Šï¼ŒçŸ¿å·¥å›å˜ä¸æ˜¯é—¹ç€å¥½ç©çš„ã€‚</p></li><li><p>Qï¼šåŒºå—é“¾å…¬å¸çš„æ·˜æ±°å‘¨æœŸä¸€èˆ¬æ˜¯å¤šä¹…ä¸€è½®å‘¢ï¼Ÿ</p><p>Aï¼šè¿™ä¸ªä¸ç¡®å®šï¼Œå…¶å®è¡Œä¸šé‡Œé¢ä¹Ÿæœ‰ä¸€äº›ç©ºæ°”å¸ï¼Œä¸€ç›´é€ ä¸å‡ºå¸ï¼Œä½†æ˜¯å®ƒçš„ä»·æ ¼ä¸€ç›´å±…é«˜ä¸ä¸‹ï¼Œä¸»è¦å› ä¸ºè¿™äº›å¸çš„ä¼—ç­¹ä»·æ ¼æ˜¯å’ŒETHç»‘å®šçš„ï¼Œåªè¦ä¸è½åœ°å°±è¿˜ä¼šæœ‰å¸Œæœ›ï¼Œè¦è¯´æ·˜æ±°çš„è¯ï¼Œå¯èƒ½å°±æ˜¯è·‘è·¯äº†~~~</p></li><li><p>Qï¼šç°åœ¨å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€çš„ä½¿ç”¨ä½“éªŒæ™®éå¯¹ç”¨æˆ·å¾ˆä¸å‹å¥½ï¼ŒçœŸçš„æ˜¯æŠ€æœ¯ä¸Šå¾ˆéš¾æ”¹å–„å—ï¼Ÿ</p><p>Aï¼š1ï¼‰å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€æœ¬èº«ç”¨çš„æ˜¯on-chainä¸Šé¢çš„æŠ€æœ¯ï¼Œä¹Ÿå°±æ˜¯å®Œæˆä¸€ä¸ªäº¤æ˜“ï¼Œä½ å¿…é¡»è¦å…ˆæ‰“é’±åˆ°æ™ºèƒ½åˆçº¦ä¸Šé¢ï¼Œè¿˜éœ€è¦ç”¨çŸ¿å·¥è´¹å‘è¡Œå¹¿æ’­ï¼Œåˆ«äººè¦ä¹°å–ä¹‹åï¼Œç„¶åè·Ÿä½ è¿›è¡Œäº¤æ˜“ï¼Œä½ æ‰èƒ½æŠŠä½ çš„ETHæ‹¿å‡ºæ¥ï¼Œ å¹¿æ’­ä¸€æ¬¡è¦å¥½å‡ åˆ†é’Ÿï¼Œå†å˜æˆå»ä¸­å¿ƒåŒ–çš„äº¤æ˜“æ‰€ï¼Œäº¤æ˜“çš„é€Ÿåº¦è¿œä¸å¦‚OTCã€‚å»ä¸­å¿ƒåŒ–çš„äº¤æ˜“æ‰€æœ¬è´¨ä¸Šæ²¡æœ‰ä»€ä¹ˆé©å‘½ï¼Œåªæ˜¯äº¤æ˜“æ›´åŠ é€æ˜åŒ–äº†</p><p>2ï¼‰åŒºå—é“¾çš„ä»£ç ä¸å¥½å†™ï¼Œä¸€æ—¦depolyå°±ä¼šæ°¸ä¹…æ‰§è¡Œï¼Œæ›´æ–°åˆçº¦æœ¬èº«å°±æ˜¯impossibleæˆ–è€…æ˜¯éå¸¸å›°éš¾çš„3ï¼‰ç»å¤§å¤šæ•°ç¨‹åºå‘˜éƒ½ç¼ºä¹æ˜¯äº§å“èƒ½åŠ›ï¼Œåšå‡ºæ¥çš„ä¸œè¥¿ä¸€èˆ¬å¾ˆéš¾ç”¨ã€‚</p></li><li><p>Qï¼šä»¥å¤ªåŠè¢«ä¸€åªçŒ«å°±èƒ½æç˜«ç—ªï¼Œæœªæ¥ä»¥å¤ªåŠä¼šä¸ä¼šåƒå¸‚é¢ä¸Šè¯´çš„ï¼Œç”¨é—ªç”µã€å¤§éƒ½ä¼šç­‰å‡çº§ä¹‹åï¼Œè§£å†³å®ƒæœ¬èº«è®¾è®¡çš„ç¼ºé™·ï¼Œç„¶åæœ‰éå¸¸å¤§çš„å‰æ™¯ï¼Ÿä»è€ŒæŠ—è¡¡eos</p><p>Aï¼šæ˜¯æœ‰å¯èƒ½çš„ï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨ä¸çŸ¥é“Vç¥ç°åœ¨æ˜¯åœ¨KTVå”±æ­Œå‘¢è¿˜æ˜¯åœ¨æ”¹Codeï¼Œä»–çš„å°ä¼™ä¼´ä»¬ç°åœ¨çš„è¿›å±•å¦‚ä½•ï¼Œè¿™äº›éƒ½å¾ˆéš¾è¯´ã€‚ä½†æ˜¯æˆ‘å¸Œæœ›å¤§å®¶èšç„¦åœ¨åŒºå—é“¾æœ¬è´¨ä¸æŠ€æœ¯ä¸Šå»çœ‹ä¸€ä¸ªåŒºå—é“¾çš„é•¿æœŸä»·å€¼ã€‚</p></li><li><p>Qï¼šæ˜¯å¦å¯èƒ½åˆ›å»ºä¸€ç§æœºåˆ¶é™åˆ¶é¡¹ç›®æ–¹åŠ¨ç”¨ICOå‹Ÿé›†åˆ°çš„èµ„äº§?</p><p>Aï¼šè¿™ä¸ªä¸»è¦çœ‹é¡¹ç›®æ–¹æœ¬èº«çš„è‰¯çŸ¥äº†ã€‚åŸæœ¬ICOçš„åˆçº¦å°±ä¼šé”å®šå›¢é˜Ÿçš„èµ„é‡‘è¦ç»‘å®šå¤šä¹…æˆ–è€…é€å¹´è§£å†»ï¼Œæ¯”å¦‚ IPFSè¿Ÿè¿Ÿä¸å‘å¸ï¼Œå°±æ˜¯ä»–ä»¬æœ¬èº«ICOçš„åˆçº¦é”å®šçš„ã€‚ä½†æ˜¯å¦‚æœèµ°ICSï¼Œä»–æ‹¿å‡ºæ¥çš„ç§å‹ŸTokenï¼Œæœ‰æ²¡æœ‰é”å®šèµ·ï¼Œç”šè‡³é¡¹ç›®æ–¹æœ¬èº«æœ‰æ²¡æœ‰åŒºå—é“¾å·¥ç¨‹å¸ˆï¼Œè¿™éƒ½æ˜¯å€¼å¾—ç–‘é—®çš„ã€‚</p></li><li><p>Qï¼šåŸºäºåŒºå—é“¾çš„æ¸¸æˆä¼šå¤§çˆ†å‘å—ï¼Ÿæœ‰è¿™æ ·çš„æŠ€æœ¯åŸºç¡€å—ï¼Ÿ</p><p>Aï¼šå…¶å®æ˜¯æœ‰çš„ï¼Œä»¥å¤ªåŠçš„çŒ«å¦‚æœåªæ˜¯ä¸€ä¸ªå•æœºæ¸¸æˆçš„è¯ï¼Œå¤§å®¶å¯èƒ½ç©ä¸€ç©å°±ç®—äº†ï¼Œè¿™åªçŒ«æœ¬èº«æ²¡ä»€ä¹ˆä»·å€¼ï¼Œä½†æ˜¯è¿™ä¸ªçŒ«æ˜¯å»ºç«‹åœ¨ETHä¸Šçš„ï¼ŒåŠ¨ç”¨çš„ETHçš„ä»·å€¼ï¼Œä»·æ ¼åˆé‚£ä¹ˆè´µï¼Œæ‰€ä»¥å¤§å®¶å°±ä¼šåœ¨ä¸Šé¢ç©ã€‚æˆ‘ä¸ç¡®å®æ˜¯å¦ä¼šçˆ†å‘ï¼Œæˆ‘åªèƒ½è¯´è¿™æ˜¯ä¸€ä¸ªå¾ˆç‰¹æ®Šçš„ç°è±¡ã€‚</p></li><li><p>Qï¼šè€å¸ˆèƒ½è®²è§£ä¸€ä¸‹ï¼ŒETHã€EOSå’Œä»¥åå¾—dfinityä¸‰è€…çš„å…±åŒç‚¹å’ŒåŒºåˆ«å—ï¼Ÿ</p><p>Aï¼šdfinityæ²¡æœ‰ç ”ç©¶è¿‡ï¼Œè¿™é‡Œæ²¡æ³•è¯„è®º</p></li><li><p>Qï¼šæœ€è¿‘ä¼šå‘ç°è·‘ä¸è¿‡BTCçš„å¸ç§è¶Šæ¥è¶Šå¤šï¼Œæœªæ¥ä¼°è®¡ä¹Ÿæ˜¯ï¼Œæ¥ä¸‹æ¥æ€ä¹ˆé€‰æ‹©å¤§æ¦‚ç‡èƒ½è·‘èµ¢æ¯”ç‰¹å¸çš„ä¼—ç­¹å“ç§ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆå¯¹äºæ™®é€šå°ç™½æœ‰æ•ˆçš„ç­–ç•¥ï¼Ÿ</p><p>Aï¼šçœ‹å“ªä¸ªå“ç§çš„Kçº¿èƒ½è·‘èµ¢BTCçš„ï¼Œè·‘å¾—è¿‡çš„å°±æŠ¼ï¼Œç„¶åå°±æ”¾ç€ä¸è¦ç®¡äº†ï¼Œä¸è¦è·Ÿç€åˆ«äººè¿½æ¶¨æ€è·Œï¼Œä½ ä¼šæ­»çš„å¾ˆæƒ¨çš„</p></li><li><p>Qï¼šåŒºå—é“¾ä¼šå¯¹äº’è”ç½‘è¿›è¡Œä¸€ä¸ªæ€æ ·çš„é©æ–°ï¼Ÿ</p><p>Aï¼šåŒºå—é“¾æœ¬è´¨å°±æ˜¯è§£å†³ä¿¡ä»»å’Œäº¤æ˜“æ•ˆç‡çš„é—®é¢˜ï¼Œä½ è¦çœ‹çœ‹åŒºå—é“¾äº§å“æ‰€è§£å†³çš„é—®é¢˜æ˜¯ä¸æ˜¯ç”¨æˆ·çš„åˆšéœ€</p></li><li><p>Qï¼šåç»­çš„é“¾åœˆæ˜¯å¦ä¼šå‡ºç°ç™¾é“¾äº‰é¸£çš„æƒ…å†µï¼Ÿ</p><p>Aï¼šç°åœ¨å°±æ˜¯è¿™ç§æƒ…å†µäº†</p></li><li><p>Qï¼šè€å¸ˆèƒ½å¦è°ˆè°ˆåšä¸ºå°æ•£åº”å¯¹BTCåˆ†å‰çš„ç­–ç•¥ï¼Ÿ</p><p>Aï¼šä¸è¦è´ªå›¾é‚£äº›ç³–æœ~é€ æˆè‡ªå·±çš„èµ„äº§æŸå¤±ï¼Œé•¿æœŸä¸æ–­åœ°ä¹°è¿›ï¼Œé•¿æœŸæ¡ç€å°±è¡Œ</p></li><li><p>Qï¼šå…¬å¸å¸ä»€ä¹ˆéƒ½å¯ä»¥ä»£å¸åŒ–ï¼Œåªè¦åšå¥½æ˜ å°„ï¼Œå¦‚å®¶é‡Œçš„æˆ¿å­ï¼Œä»–ä»¬æ˜¯å¦‚ä½•åšåˆ°æ˜ å°„çš„ï¼Ÿ</p><p>Aï¼šæˆ‘ä¸€èˆ¬éƒ½ä¸ä¼šæŠ•èµ„è¿™ç§ä»£å¸ï¼Œæˆ‘ä¸çŸ¥é“ä»–ä»¬æ˜¯å¦‚ä½•åœ¨æŠ€æœ¯ä¸Šå’Œæ³•å¾‹ä¸Šåšæ˜ å°„çš„ï¼Œæ‰€è¯´ï¼Œä¸æ‡‚ä¸æŠ•ã€‚</p></li><li><p>Qï¼šBTCä¸€ç›´åœ¨åˆ†å‰ï¼ŒEHTä¹Ÿåœ¨åˆ†å‰ï¼Œåˆ†å‰ä»¥åä¼šä¸ä¼šæˆä¸ºä¸€ç§ä¸»æµæ¨¡å¼ï¼Ÿ</p><p>Aï¼šè¿™ä¸ªå·²ç»æ˜¯å¸¸æ€äº†ï¼Œå°±çœ‹äº¤æ˜“æ‰€æ”¯ä¸æ”¯æŒåˆ†å‰äº†ï¼Œæ²¡æœ‰ä»·å€¼çš„é“¾åˆ†å‰è¿˜æ˜¯æ²¡æœ‰ä»·å€¼ã€‚</p></li><li><p>Qï¼šå¦‚ä½•çœ‹å¾…åˆ†å‰å¸ï¼Œè¿™æ¬¡åˆ†å‰å¸çœŸçš„èƒ½æ•‘BTCå—ï¼Ÿ</p><p>Aï¼šæˆ‘ç›®å‰æ²¡æœ‰çœ‹åˆ°èƒ½æ•‘BTCçš„åˆ†å‰å¸ï¼Œæ•‘BTCè¦ä»è¿™ä¸‰ä¸ªæ–¹é¢å»çœ‹ï¼š1ï¼‰æé«˜BTCçš„äº¤æ˜“æ•ˆç‡ï¼›2ï¼‰é™ä½BTCçš„è€—èƒ½ï¼›3ï¼‰ä¸è¦ç ´åBTCçš„ä»·å€¼</p></li><li><p>Qï¼šç›®å‰ä¸­å›½åŒºå—é“¾ï¼ˆæŠ€æœ¯ï¼‰è¡Œä¸šä¸å›½å¤–åŒºå—é“¾ï¼ˆæŠ€æœ¯ï¼‰è¡Œä¸šç›¸æ¯”è½åå¤šå°‘ï¼Ÿ</p><p>Aï¼šå›½å†…çš„åŒºå—é“¾æŠ€æœ¯å’Œäº¤æ˜“å½¢æ€å·²ç»è¿œè¿œè¶…è¿‡å›½å¤–äº†</p></li><li><p>Qï¼šæ€ä¹ˆè¯„ä¼°ä¸€ä¸ªå¸ç§çš„é•¿æœŸä»·å€¼ï¼Ÿ</p><p>Aï¼š1ï¼‰çœ‹å®ƒçš„çœŸæ­£ä»·å€¼ï¼›2ï¼‰çœ‹ç¾¤ä¼—çš„æœŸå¾…ä»·å€¼ï¼›3ï¼‰èƒ½å¦è·‘å¾—è¿‡BTC</p></li><li><p>Qï¼šé™¤äº†äº¤æ˜“æ‰€ï¼Œè¿˜æœ‰é‚£äº›çœŸæ­£è½åœ°çš„é¡¹ç›®ï¼Œèƒ½è®©æˆ‘ä»¬ç›¸ä¿¡2018å¹´ä¼šæ˜¯åº”ç”¨çš„è½åœ°å¹´?</p><p>Aï¼šæ‚²è§‚åœ°çœ‹2018å¹´ä¸ä¼šæ˜¯åº”ç”¨çš„è½åœ°å¹´ï¼ŒETHå·¨æ…¢ï¼Œç”¨å®ƒå¼€å‘åº”ç”¨ä¸å¯èƒ½ï¼ŒEOSå·ç§°å¾ˆç‰›é€¼ï¼Œä½†æ˜¯å®ƒè¿˜æ²¡æœ‰è¢«åšå‡ºæ¥ï¼Œå¯èƒ½è¿˜æ˜¯ä¸€ä¸ªå‘å¸å¹´</p></li><li><p>Qï¼šåŒºå—é“¾é¡¹ç›®ä¸€å®šè¦å‘è¡Œä»£å¸å—ï¼Ÿ</p><p>Aï¼šä¸ä¸€å®šï¼Œåªæ˜¯å‘è¡Œä»£å¸æ¯”ä»·å®¹æ˜“ç­¹é›†åˆ°èµ„é‡‘</p></li><li><p>Qï¼šéƒ‘è€å¸ˆï¼Œèƒ½é¢„æµ‹ä¸€ä¸‹ï¼Œå„ç§åˆ†å‰å¸æœªæ¥çš„ç»“å±€å—ï¼Ÿ</p><p>Aï¼šæ²¡åŠæ³•é¢„æµ‹ï¼Œè¿™ä¸ªæ‰åˆšå¼€å§‹</p></li><li><p>Qï¼šç°åœ¨åˆšåˆšè¿›å»å†œä¸šæ—¶ä»£çš„é€»è¾‘ä»…ä»…å°±æ˜¯å¤§é‡çš„æœºæ„æ¶Œå…¥å—ï¼Ÿ</p><p>Aï¼šé€»è¾‘å°±æ˜¯ï¼Œç°åœ¨çš„é“¾ä¸Šé¢è¿˜æ²¡æœ‰çœŸæ­£çš„åº”ç”¨ï¼ŒETHä¸Šçš„æœ€å¤§åº”ç”¨ä¹Ÿåªæ˜¯ICOï¼Œæ²¡æœ‰äººçœŸæ­£ç”¨ETHæ¥å¼€å‘ä¸€ä¸ªå¯ä»¥ç”¨çš„ä¸œè¥¿</p></li><li><p>Qï¼šå°ç™½æ€ä¹ˆåˆ¤æ–­ä»£ç è´¨é‡ï¼Ÿ</p><p>Aï¼šæ²¡åŠæ³•åˆ¤æ–­ä»£ç è´¨é‡ï¼Œå»ºè®®è¿˜æ˜¯çœ‹è°å¯ä»¥è·‘èµ¢BTC</p></li><li><p>Qï¼šåŒºå—é“¾çš„å¥½å¤šé¡¹ç›®éƒ½æ˜¯å¼€æºçš„ï¼Œå¼€æºè¿™ç§è½¯ä»¶çš„å¼€å‘æ¨¡å¼ï¼Œæ˜¯å¦æ˜¯æœªæ¥å¤§å‹å¯ç”¨è½¯ä»¶æ¬¢è¿çš„å¼€å‘æ¨¡å¼</p><p>Aï¼šç°åœ¨å°±å·²ç»æ˜¯è¿™ç§æ¨¡å¼äº†</p></li><li><p>Qï¼šå¦‚ä½•åˆ¤æ–­ç†Šå¸‚æ¥äº†ï¼Ÿ</p><p>Aï¼šå½“ä½ åœ¨åœºå¤–äº¤æ˜“æ‰€ä¹°åˆ°å¸è·Ÿåœºå†…äº¤æ˜“æ‰€ä¹°åˆ°å¸ç›¸å·®æ²¡å¤šå°‘çš„æ—¶å€™ï¼Œå°±æ˜¯ç†Šå¸‚æ¥äº†ï¼Œå¦‚æœä»·å·®å¾ˆå¤§ï¼Œå°±è¡¨ç¤ºæ˜¯ç‰›å¸‚</p></li><li><p>Qï¼šä»¥å‰ä¸¤å¹´ä¸€è½®ç‰›å¸‚ï¼Œç°åœ¨çš„ç†Šå¸‚ä¸ç‰›å¸‚çš„å‘¨æœŸè€å¸ˆå¦‚ä½•çœ‹å¾…ï¼Ÿ</p><p>Aï¼šå·®ä¸2~3æœˆçš„å‘¨æœŸï¼Œå› ä¸ºç°åœ¨æœ‰å¾ˆå¤šæˆç†Ÿéƒ¨é˜Ÿè¿›æ¥æ‰“äº†ï¼Œå‘¨æœŸå˜åŒ–ä¼šè¶Šæ¥è¶Šå¿«ï¼Œå¤§æ¶¨å¤§è·Œï¼Œæ›²çº¿å˜åŒ–çš„é¢‘ç‡ä¼šè¶Šæ¥è¶Šé«˜ï¼Œåé¢ä¼šè¶Šæ¥è¶Šéš¾åˆ¤æ–­ç‰›ç†Šå¸‚</p></li><li><p>Qï¼šåŒºå—é“¾è®©äººäººéƒ½å¯ä»¥æˆä¸ºæŠ•èµ„äººï¼Œè¿™ç§æŠ•èµ„ä»£å¸çš„æ¨¡å¼ä¼šæŒç»­å­˜åœ¨å—ï¼Ÿæœªæ¥ä¼šæˆä¸ºä¸»æµå—ï¼Ÿ</p><p>Aï¼šä¼šæŒç»­å­˜åœ¨ã€‚ä»¥å‰æŠ•èµ„æ˜¯è¦å è‚¡ä»½çš„ï¼Œå è‚¡ä»½æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯å¤šæ•°å…¬å¸ä¸å¸Œæœ›æ§åˆ¶æƒè¢«æµå¤±ï¼Œä»–ä»¬å¸Œæœ›ç”¨è‚¡æƒæ¢æœªæ¥çš„åˆ©æ¶¦ï¼Œåˆ›å§‹äººåªå¸Œæœ›åˆ©æ¶¦å‡ºè®©è€Œä¸æ˜¯è‚¡ä»½å‡ºè®©ã€‚Tokençš„æ–¹å¼æ˜¯ï¼Œåˆ›å§‹äººå¯ä»¥é¢„å…ˆæ‹¿åˆ°æœªæ¥çš„åˆ©æ¶¦ï¼Œç‡å…ˆè¿›è¡Œæ‰©å¼ ï¼Œå†è€…å°±æ˜¯åŒºå—é“¾é¡¹ç›®çš„ä¸­å¥–çš„å€æ•°æ˜¯è·Ÿå¤©ä½¿è½®æŒ‚é’©çš„ï¼ŒTokenç»“ç®—æ¯”è¾ƒå¿«ï¼Œé€šå¸¸5ä¸ªæœˆå†…å°±ä¼šæ‹¿åˆ°1000å€ï¼Œä½†æ˜¯å¤©ä½¿æŠ•èµ„é€šå¸¸è¦ç­‰åˆ°IPOä¹‹åï¼Œæ‰€ä»¥ä»–æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ²¡æœ‰æ•ˆç‡çš„æ–¹å¼ã€‚æ˜¯å¦èƒ½æˆä¸ºä¸»æµæŠ•èµ„æ–¹å¼ï¼Œå°±è¦çœ‹æ³•è§„äº†ï¼Œæ¯”å¦‚Securityè¿™ä¸€å—å°±æ˜¯å…¨ä¸–ç•Œæ­£åœ¨è§£å†³çš„</p></li><li><p>Qï¼šè€å¸ˆï¼ŒDPOSå’Œé—ªç”µç½‘ç»œèƒ½è§£å†³BTCçš„äº¤æ˜“é€Ÿåº¦é—®é¢˜å—ï¼Ÿ</p><p>Aï¼šBTCå¦‚æœç”¨DPOSçš„è¯ï¼Œè¿™ä¸ªä¸»è¦å¼€å§‹çœ‹çŸ¿å·¥ï¼ŒBTCä»POWæ¢æˆDPOSï¼Œä¼šè§¦åŠçŸ¿å·¥çš„åˆ©ç›Š</p></li><li><p>Qï¼šè€å¸ˆï¼Œ1æœˆåœ¨æ—§é‡‘å±±ä¸¾åŠçš„ä¸­ç¾åŒºå—é“¾å¤§ä¼šå€¼ä¸å€¼å¾—å‚åŠ ï¼Ÿ</p><p>Aï¼šå”¯æœ‰è®¤çŸ¥å‡çº§ï¼Œä½ çš„æŠ•èµ„èƒ½åŠ›ï¼Œä½ çš„èµšé’±èƒ½åŠ›æ‰èƒ½å¾—åˆ°å‡çº§ï¼Œä¸å…¶æ‹¿è¿™äº›é’±å»å‹å°å¸ï¼Œå€’ä¸å¦‚å»å‡çº§è‡ªå·±çš„å¤§è„‘å’Œè®¤è¯†</p></li></ol><p>åè¯è§£æï¼š</p><ul><li>SECï¼šç¾å›½è¯åˆ¸äº¤æ˜“å§”å‘˜ä¼šï¼ˆU.S. Securities and Exchange Commissionï¼‰</li><li>on-chainäº¤æ˜“ï¼š<a href="https://steemit.com/cn-cryptocurrency/@cifer/on-chain-off-chain" target="_blank" rel="noopener">é“¾ä¸Šäº¤æ˜“</a></li><li>SWIFTï¼šSociety for Worldwide Interbank Financial Telecommunicationï¼ˆç¯çƒåŒä¸šé“¶è¡Œé‡‘èç”µè®¯åä¼šï¼‰</li></ul><p>å‚è€ƒèµ„æ–™ï¼š</p><ul><li><a href="http://attach.i7years.com/attach/treatise.doc" target="_blank" rel="noopener">ç¾åœ‹è­‰åˆ¸æ³•è¦ä¸Šã€Œè­‰åˆ¸ã€ä¹‹é‡è¦åˆ¤æ–·åŸå‰‡</a></li><li><a href="https://www.linkedin.com/pulse/20141125143442-132518611-what-is-a-security-the-howey-test-and-reves-test/" target="_blank" rel="noopener">What Is A Security? The Howey Test And Reves Test</a></li><li><a href="http://www.ftchinese.com/story/001073960?full=y" target="_blank" rel="noopener">ICOï¼šå¦‚ä½•ç›‘ç®¡æ³•å¤–ä¹‹åœ°ï¼Ÿ</a></li></ul>]]></content>
      
        <categories>
            
            <category> blockchain </category>
            
        </categories>
        
        
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Token </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[c++å­¦ä¹ ç¬”è®°]]></title>
      <url>/posts/learning-c-plus.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>ä»Šå¹´å¯¹<a href="https://zh.wikipedia.org/wiki/%E5%8C%BA%E5%9D%97%E9%93%BE" target="_blank" rel="noopener">åŒºå—é“¾</a>æŠ€æœ¯äº§ç”Ÿäº†æµ“åšçš„å…´è¶£ï¼Œå­¦ä¹ c++ç¼–ç¨‹ä¸»è¦çš„ç›®çš„åœ¨äºæƒ³å»ç ”ç©¶ä¸‹<a href="https://github.com/bitcoin/bitcoin" target="_blank" rel="noopener">bitcoin</a>ã€<a href="https://github.com/eosio/eos" target="_blank" rel="noopener">eos</a>ç­‰åŒºå—é“¾çš„æºä»£ç ï¼Œå¼„æ‡‚ä»–ä»¬çš„è¿è¡Œæœºåˆ¶åŠåŸç†ã€‚</p><a id="more"></a><h1 id="å­¦ä¹ æ•™ç¨‹"><a href="#å­¦ä¹ æ•™ç¨‹" class="headerlink" title="å­¦ä¹ æ•™ç¨‹"></a>å­¦ä¹ æ•™ç¨‹</h1><blockquote><p>GitHub: <a href="https://github.com/wangweiX/c-learning" target="_blank" rel="noopener">https://github.com/wangweiX/c-learning</a></p></blockquote><h3 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h3><ul><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step01" target="_blank" rel="noopener">Step01 - Initialization project</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step02" target="_blank" rel="noopener">Step02 - Variables, initialization, and assignment</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step03" target="_blank" rel="noopener">Step03 - Creating a Basic Calculator</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step04" target="_blank" rel="noopener">Step04 - If / else Statement</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step05" target="_blank" rel="noopener">Step05 - Function</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step06" target="_blank" rel="noopener">Step06 - Object-oriented programming(OOP)</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step07" target="_blank" rel="noopener">Step07 - Placing Classes in Separate Files</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step08" target="_blank" rel="noopener">Step08 - Whileã€forã€do while Loops</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step09" target="_blank" rel="noopener">Step09 - Assignment and Increment Operators</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step10" target="_blank" rel="noopener">Step10 - Making a Stock Market Simulator</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step12" target="_blank" rel="noopener">Step11 - Switch</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step12" target="_blank" rel="noopener">Step12 - Logical Operators</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step13" target="_blank" rel="noopener">Step13 - Random Number Generator</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step14" target="_blank" rel="noopener">Step14 - Default parameters</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step15" target="_blank" rel="noopener">Step15 - Unary Scope Resolution Operator</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step16" target="_blank" rel="noopener">Step16 - Function Overloading</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step17" target="_blank" rel="noopener">Step17 - Recursion</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step18" target="_blank" rel="noopener">Step18 - Array</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step19" target="_blank" rel="noopener">Step19 - Multidimensional Arrays</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step20" target="_blank" rel="noopener">Step20 - Pointer</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step21" target="_blank" rel="noopener">Step21 - Passing arguments by value / reference / address</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step22" target="_blank" rel="noopener">Step22 - Sizeof</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step23" target="_blank" rel="noopener">Step23 - Pointers and Math</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step24" target="_blank" rel="noopener">Step24 - Arrow Member Selection Operator(-&gt;)</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step25" target="_blank" rel="noopener">Step25 - Destructors</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step26" target="_blank" rel="noopener">Step26 - Const class objects and member functions</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step27" target="_blank" rel="noopener">Step27 - Constructor member initializer lists</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step28" target="_blank" rel="noopener">Step28 - Object relationships - Composition</a></li><li><a href="https://github.com/wangweiX/c-learning/tree/master/c%2B%2Blearning-step29" target="_blank" rel="noopener">Step29 - Friend functions and classes</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> c++ </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[EOSå­¦ä¹ (1) | å®‰è£…éƒ¨ç½²]]></title>
      <url>/posts/blockchain-eos-build.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/eos-logo.jpg" alt="eos-logo"></p><p>æœ¬ç¯‡æ–‡ç« æ•™ä½ å¦‚ä½•æœ¬åœ°å®‰è£…EOSã€‚</p><a id="more"></a><h3 id="EOSIOç‰ˆæœ¬"><a href="#EOSIOç‰ˆæœ¬" class="headerlink" title="EOSIOç‰ˆæœ¬"></a>EOSIOç‰ˆæœ¬</h3><ul><li>Beginning build version: 1.2</li><li>2018å¹´ 4æœˆ 9æ—¥ æ˜ŸæœŸä¸€ 06æ—¶13åˆ†18ç§’ UTC</li><li>git head id: 124c62d0e1b3974bcd551b885518ff05301b39c9</li><li>Current branch: * master</li><li>ARCHITECTURE: Darwin</li></ul><h3 id="ç³»ç»Ÿç¯å¢ƒ"><a href="#ç³»ç»Ÿç¯å¢ƒ" class="headerlink" title="ç³»ç»Ÿç¯å¢ƒ"></a>ç³»ç»Ÿç¯å¢ƒ</h3><ul><li>OS name: Darwin</li><li>OS Version: 10.13.4</li></ul><h3 id="æ‰§è¡Œæ„å»ºè„šæœ¬"><a href="#æ‰§è¡Œæ„å»ºè„šæœ¬" class="headerlink" title="æ‰§è¡Œæ„å»ºè„šæœ¬"></a>æ‰§è¡Œæ„å»ºè„šæœ¬</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https://github.com/eosio/eos --recursive</span><br><span class="line">$ cd eos</span><br><span class="line">$ ./eosio_build.sh</span><br></pre></td></tr></table></figure><p>å‡ºç°å¦‚ä¸‹ä¿¡æ¯ï¼Œè¡¨ç¤ºæ„å»ºæˆåŠŸï¼š</p><p><img src="https://img.i7years.com/blog/eos_build_01.png" alt=""></p><h3 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ /usr/local/bin/mongod -f /usr/local/etc/mongod.conf &amp; cd /Users/wangwei/eos/build; make test</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç»“æœï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">Test project /Users/wangwei/eos/build</span><br><span class="line">      Start  <span class="number">1</span>: validate_simple.token_abi</span><br><span class="line"> <span class="number">1</span>/<span class="number">26</span> Test  <span class="comment">#1: validate_simple.token_abi ...........   Passed    1.05 sec</span></span><br><span class="line">      Start  <span class="number">2</span>: validate_eosio.token_abi</span><br><span class="line"> <span class="number">2</span>/<span class="number">26</span> Test  <span class="comment">#2: validate_eosio.token_abi ............   Passed    0.07 sec</span></span><br><span class="line">      Start  <span class="number">3</span>: validate_eosio.msig_abi</span><br><span class="line"> <span class="number">3</span>/<span class="number">26</span> Test  <span class="comment">#3: validate_eosio.msig_abi .............   Passed    0.08 sec</span></span><br><span class="line">      Start  <span class="number">4</span>: validate_multi_index_test_abi</span><br><span class="line"> <span class="number">4</span>/<span class="number">26</span> Test  <span class="comment">#4: validate_multi_index_test_abi .......   Passed    0.09 sec</span></span><br><span class="line">      Start  <span class="number">5</span>: validate_eosio.system_abi</span><br><span class="line"> <span class="number">5</span>/<span class="number">26</span> Test  <span class="comment">#5: validate_eosio.system_abi ...........   Passed    0.07 sec</span></span><br><span class="line">      Start  <span class="number">6</span>: validate_identity_abi</span><br><span class="line"> <span class="number">6</span>/<span class="number">26</span> Test  <span class="comment">#6: validate_identity_abi ...............   Passed    0.08 sec</span></span><br><span class="line">      Start  <span class="number">7</span>: validate_identity_test_abi</span><br><span class="line"> <span class="number">7</span>/<span class="number">26</span> Test  <span class="comment">#7: validate_identity_test_abi ..........   Passed    0.07 sec</span></span><br><span class="line">      Start  <span class="number">8</span>: validate_currency_abi</span><br><span class="line"> <span class="number">8</span>/<span class="number">26</span> Test  <span class="comment">#8: validate_currency_abi ...............   Passed    0.08 sec</span></span><br><span class="line">      Start  <span class="number">9</span>: validate_stltest_abi</span><br><span class="line"> <span class="number">9</span>/<span class="number">26</span> Test  <span class="comment">#9: validate_stltest_abi ................   Passed    0.08 sec</span></span><br><span class="line">      Start <span class="number">10</span>: validate_exchange_abi</span><br><span class="line"><span class="number">10</span>/<span class="number">26</span> Test <span class="comment">#10: validate_exchange_abi ...............   Passed    0.08 sec</span></span><br><span class="line">      Start <span class="number">11</span>: validate_test.inline_abi</span><br><span class="line"><span class="number">11</span>/<span class="number">26</span> Test <span class="comment">#11: validate_test.inline_abi ............   Passed    0.07 sec</span></span><br><span class="line">      Start <span class="number">12</span>: validate_asserter_abi</span><br><span class="line"><span class="number">12</span>/<span class="number">26</span> Test <span class="comment">#12: validate_asserter_abi ...............   Passed    0.08 sec</span></span><br><span class="line">      Start <span class="number">13</span>: validate_infinite_abi</span><br><span class="line"><span class="number">13</span>/<span class="number">26</span> Test <span class="comment">#13: validate_infinite_abi ...............   Passed    0.07 sec</span></span><br><span class="line">      Start <span class="number">14</span>: validate_proxy_abi</span><br><span class="line"><span class="number">14</span>/<span class="number">26</span> Test <span class="comment">#14: validate_proxy_abi ..................   Passed    0.07 sec</span></span><br><span class="line">      Start <span class="number">15</span>: validate_test_api_abi</span><br><span class="line"><span class="number">15</span>/<span class="number">26</span> Test <span class="comment">#15: validate_test_api_abi ...............   Passed    0.07 sec</span></span><br><span class="line">      Start <span class="number">16</span>: validate_test_api_mem_abi</span><br><span class="line"><span class="number">16</span>/<span class="number">26</span> Test <span class="comment">#16: validate_test_api_mem_abi ...........   Passed    0.07 sec</span></span><br><span class="line">      Start <span class="number">17</span>: validate_test_api_db_abi</span><br><span class="line"><span class="number">17</span>/<span class="number">26</span> Test <span class="comment">#17: validate_test_api_db_abi ............   Passed    0.07 sec</span></span><br><span class="line">      Start <span class="number">18</span>: validate_test_api_multi_index_abi</span><br><span class="line"><span class="number">18</span>/<span class="number">26</span> Test <span class="comment">#18: validate_test_api_multi_index_abi ...   Passed    0.07 sec</span></span><br><span class="line">      Start <span class="number">19</span>: validate_eosio.bios_abi</span><br><span class="line"><span class="number">19</span>/<span class="number">26</span> Test <span class="comment">#19: validate_eosio.bios_abi .............   Passed    0.08 sec</span></span><br><span class="line">      Start <span class="number">20</span>: validate_noop_abi</span><br><span class="line"><span class="number">20</span>/<span class="number">26</span> Test <span class="comment">#20: validate_noop_abi ...................   Passed    0.07 sec</span></span><br><span class="line">      Start <span class="number">21</span>: validate_dice_abi</span><br><span class="line"><span class="number">21</span>/<span class="number">26</span> Test <span class="comment">#21: validate_dice_abi ...................   Passed    0.08 sec</span></span><br><span class="line">      Start <span class="number">22</span>: chain_test_binaryen</span><br><span class="line"><span class="number">22</span>/<span class="number">26</span> Test <span class="comment">#22: chain_test_binaryen .................   Passed  286.59 sec</span></span><br><span class="line">      Start <span class="number">23</span>: chain_test_wavm</span><br><span class="line"><span class="number">23</span>/<span class="number">26</span> Test <span class="comment">#23: chain_test_wavm .....................   Passed  344.66 sec</span></span><br><span class="line">      Start <span class="number">24</span>: nodeos_run_test</span><br><span class="line"><span class="number">24</span>/<span class="number">26</span> Test <span class="comment">#24: nodeos_run_test .....................   Passed   48.39 sec</span></span><br><span class="line">      Start <span class="number">25</span>: p2p_dawn515_test</span><br><span class="line"><span class="number">25</span>/<span class="number">26</span> Test <span class="comment">#25: p2p_dawn515_test ....................   Passed    1.13 sec</span></span><br><span class="line">      Start <span class="number">26</span>: nodeos_run_test-mongodb</span><br><span class="line"><span class="number">26</span>/<span class="number">26</span> Test <span class="comment">#26: nodeos_run_test-mongodb .............   Passed  125.22 sec</span></span><br><span class="line"></span><br><span class="line"><span class="number">100</span>% tests passed, <span class="number">0</span> tests failed out of <span class="number">26</span></span><br><span class="line"></span><br><span class="line">Total Test time (real) = <span class="number">809.08</span> sec</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd build</span><br><span class="line">$ sudo make install</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆä¹‹åï¼Œåœ¨ <code>/usr/local/bin</code> ä¸‹ä¼šæœ‰ <code>nodeos</code>ã€<code>cleos</code>ã€<code>keosd</code> ä¸‰ä¸ªå·¥å…·ã€‚</p><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><ul><li><code>nodeos</code>é…ç½®æ–‡ä»¶ï¼š<code>~/Library/Application Support/eosio/nodeos/config/config.ini</code></li><li><code>keosd</code>é…ç½®æ–‡ä»¶ï¼š<code>~/eosio-wallet/config.ini</code></li></ul><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><ul><li><code>nodeos</code> (node + eos = nodeos) - ç”¨äºé€šè¿‡é…ç½®æ’ä»¶æ¥è¿è¡ŒèŠ‚ç‚¹çš„æ ¸å¿ƒEOSIOèŠ‚ç‚¹å®ˆæŠ¤ç¨‹åºã€‚ä¾‹å¦‚ç”¨äºåŒºå—çš„ç”Ÿäº§ï¼Œä¸“ç”¨APIç«¯ç‚¹å’Œæœ¬åœ°å¼€å‘ã€‚</li><li><code>cleos</code> (cli + eos = cleos) - ä¸ä¸»é“¾äº¤äº’ä»¥åŠç®¡ç†é’±åŒ…çš„å‘½ä»¤è¡Œå·¥å…·ç•Œé¢ã€‚</li><li><code>keosd</code> (key + eos = keosd) - å°†EOSIOå¯†é’¥å®‰å…¨å­˜å‚¨åœ¨é’±åŒ…ä¸­çš„ç»„ä»¶ã€‚</li></ul><p>è¿™äº›ç»„ä»¶ä¹‹é—´çš„åŸºæœ¬å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ åœ¨æ¥ä¸‹æ¥çš„éƒ¨åˆ†ä¸­ï¼Œæ‚¨å°†æ„å»ºEOSIOç»„ä»¶ï¼Œå¹¶å°†å®ƒä»¬éƒ¨ç½²åœ¨å•ä¸ªä¸»æœºï¼Œå•èŠ‚ç‚¹æµ‹è¯•ç½‘ç»œï¼ˆtestnetï¼‰é…ç½®ä¸­ã€‚</p><p><img src="https://img.i7years.com/blog/8f31cfd-Basic-EOSIO-System-Architecture.png" alt="Basic-EOSIO-System-Architecture"></p><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ul><li><a href="https://developers.eos.io/eosio-nodeos/docs/install-nodeos" target="_blank" rel="noopener">https://developers.eos.io/eosio-nodeos/docs/install-nodeos</a></li><li><a href="https://developers.eos.io/eosio-nodeos/docs/" target="_blank" rel="noopener">https://developers.eos.io/eosio-nodeos/docs/</a></li></ul><p><img src="https://img.i7years.com/blog/blockchain_exploer.png" alt=""></p>]]></content>
      
        <categories>
            
            <category> blockchain </category>
            
        </categories>
        
        
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> eos </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Nettyæ–°è¿æ¥æ¥å…¥ä¸NioSocketChannelåˆ†æ]]></title>
      <url>/posts/netty-new-connection-and-niosocketchannel-analyse.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/pexels-photo-1629236.jpeg?imageslim" alt="pexels-photo-1629236"></p><p>å‰é¢çš„ä¸€äº›ç« èŠ‚ï¼Œæˆ‘ä»¬åˆ†æäº†Nettyçš„ä¸‰å¤§ç»„ä»¶ â€”â€” <a href="https://wangwei.one/posts/netty-channel-source-analyse.html">Channel</a> ã€<a href="https://wangwei.one/posts/netty-nioeventloop-analyse-for-startup.html">EventLoop</a>ã€<a href="https://wangwei.one/posts/netty-pipeline-source-analyse-2.html">Pipeline</a> ï¼Œå¯¹Nettyçš„å·¥ä½œåŸç†æœ‰äº†æ·±å…¥çš„äº†è§£ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹å½“NettyæœåŠ¡ç«¯å¯åŠ¨åï¼ŒNettyæ˜¯å¦‚ä½•å¤„ç†æ–°è¿æ¥æ¥å…¥çš„ã€‚</p><a id="more"></a><blockquote><p>Nettyç‰ˆæœ¬ï¼š4.1.30</p></blockquote><p>æœ¬æ–‡å†…å®¹ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å››éƒ¨åˆ†ï¼š</p><ul><li>æ–°è¿æ¥æ£€æµ‹</li><li>NioSocketChannelåˆ›å»º</li><li>NioSocketChannelåˆå§‹åŒ–ä¸æ³¨å†Œ</li><li>NioSocketChannelæ³¨å†ŒREADå…´è¶£é›†</li></ul><h2 id="æ–°è¿æ¥æ£€æµ‹"><a href="#æ–°è¿æ¥æ£€æµ‹" class="headerlink" title="æ–°è¿æ¥æ£€æµ‹"></a>æ–°è¿æ¥æ£€æµ‹</h2><p>å‰é¢ï¼Œæˆ‘ä»¬åœ¨è®² <a href="https://wangwei.one/posts/netty-nioeventloop-analyse-for-startup.html">EventLoopçš„å¯åŠ¨è¿‡ç¨‹æºç åˆ†æ</a> æ—¶ï¼Œè§£è¯»è¿‡ä¸‹é¢è¿™æ®µä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">NioEventLoop</span> <span class="keyword">extends</span> <span class="title">SingleThreadEventLoop</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">processSelectedKey</span><span class="params">(SelectionKey k, AbstractNioChannel ch)</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            ...</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ((readyOps &amp; (SelectionKey.OP_READ | SelectionKey.OP_ACCEPT)) != <span class="number">0</span> || readyOps == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// è¯»å–readäº‹ä»¶</span></span><br><span class="line">                unsafe.read();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (CancelledKeyException ignored) &#123;</span><br><span class="line">            unsafe.close(unsafe.voidPromise());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        ...</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜æ˜¯ä»¥æœåŠ¡ç«¯ <strong><em>NioServerSocketChannel</em></strong> ä¸ºä¾‹ï¼Œå®ƒç»‘å®šçš„unsafeå®ä¾‹ä¸º <strong><em>NioMessageUnsafe</em></strong> ã€‚ä¸Šé¢çš„ <code>unsafe.read()</code> æ¥å£ï¼Œä¼šå‘ä¸‹è°ƒç”¨åˆ° NioMessageUnsafe.read() æ¥å£ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractNioMessageChannel</span> <span class="keyword">extends</span> <span class="title">AbstractNioChannel</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    ...</span><br><span class="line">   	</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">NioMessageUnsafe</span> <span class="keyword">extends</span> <span class="title">AbstractNioUnsafe</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">// ç”¨äºä¿å­˜æ–°å»ºç«‹çš„ NioSocketChannel çš„é›†åˆ</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Object&gt; readBuf = <span class="keyword">new</span> ArrayList&lt;Object&gt;();</span><br><span class="line">		</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="comment">// ç¡®ä¿åœ¨å½“å‰çº¿ç¨‹ä¸EventLoopä¸­çš„ä¸€è‡´</span></span><br><span class="line">            <span class="function"><span class="keyword">assert</span> <span class="title">eventLoop</span><span class="params">()</span>.<span class="title">inEventLoop</span><span class="params">()</span></span>;</span><br><span class="line">            <span class="comment">// è·å– NioServerSocketChannel configé…ç½®</span></span><br><span class="line">            <span class="keyword">final</span> ChannelConfig config = config();</span><br><span class="line">            <span class="comment">// è·å– NioServerSocketChannel ç»‘å®šçš„ pipeline</span></span><br><span class="line">            <span class="keyword">final</span> ChannelPipeline pipeline = pipeline();</span><br><span class="line">            <span class="comment">// è·å–RecvByteBuf åˆ†é…å™¨ Handle</span></span><br><span class="line">            <span class="comment">// å½“channelåœ¨æ¥æ”¶æ•°æ®æ—¶ï¼ŒallocHandle ä¼šç”¨äºåˆ†é…ByteBufæ¥ä¿å­˜æ•°æ®</span></span><br><span class="line">            <span class="comment">// å…³äºallocHandleåé¢å†å»åšè¯¦ç»†ä»‹ç»</span></span><br><span class="line">            <span class="keyword">final</span> RecvByteBufAllocator.Handle allocHandle = unsafe().recvBufAllocHandle();</span><br><span class="line">            <span class="comment">// é‡ç½®å·²ç´¯ç§¯çš„æ‰€æœ‰è®¡æ•°å™¨ï¼Œå¹¶ä¸ºä¸‹ä¸€ä¸ªè¯»å–å¾ªç¯è¯»å–å¤šå°‘æ¶ˆæ¯/å­—èŠ‚æ•°æ®æä¾›å»ºè®®</span></span><br><span class="line">            allocHandle.reset(config);</span><br><span class="line">			</span><br><span class="line">            <span class="keyword">boolean</span> closed = <span class="keyword">false</span>;</span><br><span class="line">            Throwable exception = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">do</span> &#123;</span><br><span class="line">                        <span class="comment">// è°ƒç”¨åé¢çš„ doReadMessages æ¥å£ï¼Œè¯»å–åˆ°messageåˆ™è¿”å›1</span></span><br><span class="line">                        <span class="keyword">int</span> localRead = doReadMessages(readBuf);</span><br><span class="line">                        <span class="keyword">if</span> (localRead == <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (localRead &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                            closed = <span class="keyword">true</span>;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">						<span class="comment">// å¯¹å½“å‰readå¾ªç¯æ‰€è¯»å–åˆ°çš„messageæ•°é‡è®¡æ•°+1</span></span><br><span class="line">                        allocHandle.incMessagesRead(localRead);</span><br><span class="line">                        <span class="comment">// åˆ¤æ–­æ˜¯å¦ç»§ç»­è¯»å–message</span></span><br><span class="line">                    &#125; <span class="keyword">while</span> (allocHandle.continueReading());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">                    exception = t;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">int</span> size = readBuf.size();</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i ++) &#123;</span><br><span class="line">                    readPending = <span class="keyword">false</span>;</span><br><span class="line">                    <span class="comment">// è°ƒç”¨pipelineä¼ æ’­ChannelReadäº‹ä»¶</span></span><br><span class="line">                    pipeline.fireChannelRead(readBuf.get(i));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// æ¸…ç©ºreadBuf</span></span><br><span class="line">                readBuf.clear();</span><br><span class="line">                allocHandle.readComplete();</span><br><span class="line">                <span class="comment">// è°ƒç”¨pipelineä¼ æ’­ ChannelReadComplete äº‹ä»¶</span></span><br><span class="line">                pipeline.fireChannelReadComplete();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (exception != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    closed = closeOnReadError(exception);</span><br><span class="line">                    pipeline.fireExceptionCaught(exception);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (closed) &#123;</span><br><span class="line">                    inputShutdown = <span class="keyword">true</span>;</span><br><span class="line">                    <span class="keyword">if</span> (isOpen()) &#123;</span><br><span class="line">                        close(voidPromise());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">// Check if there is a readPending which was not processed yet.</span></span><br><span class="line">                <span class="comment">// This could be for two reasons:</span></span><br><span class="line">                <span class="comment">// * The user called Channel.read() or ChannelHandlerContext.read() in channelRead(...) method</span></span><br><span class="line">                <span class="comment">// * The user called Channel.read() or ChannelHandlerContext.read() in channelReadComplete(...) method</span></span><br><span class="line">                <span class="comment">//</span></span><br><span class="line">                <span class="comment">// See https://github.com/netty/netty/issues/2254</span></span><br><span class="line">                <span class="keyword">if</span> (!readPending &amp;&amp; !config.isAutoRead()) &#123;</span><br><span class="line">                    removeReadOp();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äº <code>doReadMessages(...)</code> çš„åˆ†æï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NioServerSocketChannel</span> <span class="keyword">extends</span> <span class="title">AbstractNioMessageChannel</span> <span class="keyword">implements</span> <span class="title">io</span>.<span class="title">netty</span>.<span class="title">channel</span>.<span class="title">socket</span>.<span class="title">ServerSocketChannel</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// è¯»å–æ¶ˆæ¯</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">doReadMessages</span><span class="params">(List&lt;Object&gt; buf)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// è·å– SocketChannel </span></span><br><span class="line">        SocketChannel ch = SocketUtils.accept(javaChannel());</span><br><span class="line">		</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (ch != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// ä½¿ç”¨SocketChannelåˆ›å»ºNioSocketChannelï¼Œå°†å…¶å­˜å…¥buf listä¸­</span></span><br><span class="line">                <span class="comment">// å…³äºNioSocketChannelçš„åˆ›å»ºè¯·çœ‹åé¢çš„åˆ†æ</span></span><br><span class="line">                buf.add(<span class="keyword">new</span> NioSocketChannel(<span class="keyword">this</span>, ch));</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            logger.warn(<span class="string">"Failed to create a new channel from an accepted socket."</span>, t);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                ch.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable t2) &#123;</span><br><span class="line">                logger.warn(<span class="string">"Failed to close a socket."</span>, t2);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äº <code>continueReading()</code> æ¥å£çš„åˆ†æï¼Œè‡³äºç»“æœä¸ºä»€ä¹ˆè¿”å›falseï¼Œåé¢ä¼šå•ç‹¬åˆ†æï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultMaxMessagesRecvByteBufAllocator</span> <span class="keyword">implements</span> <span class="title">MaxMessagesRecvByteBufAllocator</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> maxMessagesPerRead;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> respectMaybeMoreData = <span class="keyword">true</span>;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">MaxMessageHandle</span> <span class="keyword">implements</span> <span class="title">ExtendedHandle</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> ChannelConfig config;</span><br><span class="line">        <span class="comment">// æ¯æ¬¡è¯»å–æœ€å¤§çš„æ¶ˆæ¯æ•°</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> maxMessagePerRead;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> totalMessages;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> totalBytesRead;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> attemptedBytesRead;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> lastBytesRead;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> respectMaybeMoreData = DefaultMaxMessagesRecvByteBufAllocator.<span class="keyword">this</span>.respectMaybeMoreData;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> UncheckedBooleanSupplier defaultMaybeMoreSupplier = <span class="keyword">new</span> UncheckedBooleanSupplier() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> attemptedBytesRead == lastBytesRead;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        ...</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ˜¯å¦ç»§ç»­è¯»å–message    </span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">continueReading</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> continueReading(defaultMaybeMoreSupplier);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ˜¯å¦ç»§ç»­è¯»å–message</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">continueReading</span><span class="params">(UncheckedBooleanSupplier maybeMoreDataSupplier)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// é»˜è®¤æƒ…å†µä¸‹ config.isAutoRead() ä¸ºtrue</span></span><br><span class="line">            <span class="comment">// respectMaybeMoreData é»˜è®¤ä¸º true</span></span><br><span class="line">            <span class="comment">// maybeMoreDataSupplier.get() ä¸ºfalse</span></span><br><span class="line">            <span class="comment">// totalMessagesç¬¬ä¸€æ¬¡å¾ªç¯åˆ™ä¸º1</span></span><br><span class="line">            <span class="comment">// maxMessagePerReadä¸º16</span></span><br><span class="line">			<span class="comment">// ç»“æœè¿”å›false</span></span><br><span class="line">            <span class="keyword">return</span> config.isAutoRead() &amp;&amp;</span><br><span class="line">                (!respectMaybeMoreData || maybeMoreDataSupplier.get()) &amp;&amp;</span><br><span class="line">                totalMessages &lt; maxMessagePerRead &amp;&amp;</span><br><span class="line">                totalBytesRead &gt; <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        ...</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="NioSocketChannelåˆ›å»º"><a href="#NioSocketChannelåˆ›å»º" class="headerlink" title="NioSocketChannelåˆ›å»º"></a>NioSocketChannelåˆ›å»º</h2><p>ä¸Šé¢åˆ†ææ–°è¿æ¥æ¥å…¥ï¼Œæåˆ°äº† <strong><em>NioSocketChannel</em></strong> çš„åˆ›å»ºï¼Œæˆ‘ä»¬è¿™é‡Œæ¥è¯¦ç»†åˆ†æä¸€ä¸‹ï¼ŒNioSocketChannelçš„åˆ›å»ºè¿‡ç¨‹ä¸æ­¤å‰æˆ‘ä»¬åˆ†æ <a href="https://wangwei.one/posts/netty-channel-source-analyse.html">NioServerSocketChannelåˆ›å»º</a> å¤§ä½“ç±»ä¼¼ã€‚</p><h3 id="æ„é€ å™¨"><a href="#æ„é€ å™¨" class="headerlink" title="æ„é€ å™¨"></a>æ„é€ å™¨</h3><p>å…ˆæ¥çœ‹çœ‹ NioSocketChannel çš„æ„é€ å‡½æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NioSocketChannel</span> <span class="keyword">extends</span> <span class="title">AbstractNioByteChannel</span> <span class="keyword">implements</span> <span class="title">io</span>.<span class="title">netty</span>.<span class="title">channel</span>.<span class="title">socket</span>.<span class="title">SocketChannel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">NioSocketChannel</span><span class="params">(Channel parent, SocketChannel socket)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨çˆ¶ç±»æ„é€ å™¨</span></span><br><span class="line">        <span class="keyword">super</span>(parent, socket);</span><br><span class="line">        <span class="comment">// åˆ›å»ºNioSocketChannelConfig</span></span><br><span class="line">        config = <span class="keyword">new</span> NioSocketChannelConfig(<span class="keyword">this</span>, socket.socket());</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    ...</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çˆ¶ç±» <strong><em>AbstractNioByteChannel</em></strong> æ„é€ å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractNioByteChannel</span> <span class="keyword">extends</span> <span class="title">AbstractNioChannel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">AbstractNioByteChannel</span><span class="params">(Channel parent, SelectableChannel ch)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨çˆ¶ç±»æ„é€ å™¨ï¼Œå¹¶è®¾ç½®å…´è¶£é›†ä¸ºSelectionKey.OP_READï¼Œå¯¹readäº‹ä»¶æ„Ÿå…´è¶£</span></span><br><span class="line">        <span class="keyword">super</span>(parent, ch, SelectionKey.OP_READ);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çˆ¶ç±» <strong><em>AbstractNioChannel</em></strong> æ„é€ å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractNioChannel</span> <span class="keyword">extends</span> <span class="title">AbstractChannel</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">AbstractNioChannel</span><span class="params">(Channel parent, SelectableChannel ch, <span class="keyword">int</span> readInterestOp)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨çˆ¶ç±»æ„é€ å™¨</span></span><br><span class="line">        <span class="keyword">super</span>(parent);</span><br><span class="line">        <span class="comment">// è®¾ç½®channel</span></span><br><span class="line">        <span class="keyword">this</span>.ch = ch;</span><br><span class="line">        <span class="comment">// è®¾ç½®å…´è¶£é›†</span></span><br><span class="line">        <span class="keyword">this</span>.readInterestOp = readInterestOp;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è®¾ç½®ä¸ºéé˜»å¡</span></span><br><span class="line">            ch.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çˆ¶ç±» <strong><em>AbstractChannel</em></strong> æ„é€ å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractChannel</span> <span class="keyword">extends</span> <span class="title">DefaultAttributeMap</span> <span class="keyword">implements</span> <span class="title">Channel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="title">AbstractChannel</span><span class="params">(Channel parent)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®parent</span></span><br><span class="line">        <span class="keyword">this</span>.parent = parent;</span><br><span class="line">        <span class="comment">// åˆ›å»ºchannelId</span></span><br><span class="line">        id = newId();</span><br><span class="line">        <span class="comment">// åˆ›å»ºunsafe</span></span><br><span class="line">        unsafe = newUnsafe();</span><br><span class="line">        <span class="comment">// åˆ›å»ºpipeline</span></span><br><span class="line">        pipeline = newChannelPipeline();</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ChannelConfigåˆ›å»º"><a href="#ChannelConfigåˆ›å»º" class="headerlink" title="ChannelConfigåˆ›å»º"></a>ChannelConfigåˆ›å»º</h3><p>æ¥ç€æˆ‘ä»¬çœ‹çœ‹ <strong><em>NioSocketChannelConfig</em></strong> çš„åˆ›å»ºé€»è¾‘ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NioSocketChannel</span> <span class="keyword">extends</span> <span class="title">AbstractNioByteChannel</span> <span class="keyword">implements</span> <span class="title">io</span>.<span class="title">netty</span>.<span class="title">channel</span>.<span class="title">socket</span>.<span class="title">SocketChannel</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    ...</span><br><span class="line">       </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">NioSocketChannelConfig</span><span class="params">(NioSocketChannel channel, Socket javaSocket)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨çˆ¶ç±»æ„é€ å™¨</span></span><br><span class="line">        <span class="keyword">super</span>(channel, javaSocket);</span><br><span class="line">        calculateMaxBytesPerGatheringWrite();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">	    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çˆ¶ç±» <strong><em>DefaultSocketChannelConfig</em></strong> æ„é€ å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultSocketChannelConfig</span> <span class="keyword">extends</span> <span class="title">DefaultChannelConfig</span> <span class="keyword">implements</span> <span class="title">SocketChannelConfig</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   ...</span><br><span class="line">      </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">DefaultSocketChannelConfig</span><span class="params">(SocketChannel channel, Socket javaSocket)</span> </span>&#123;</span><br><span class="line">       <span class="comment">// è°ƒç”¨çˆ¶ç±»æ„é€ å™¨ï¼Œç»‘å®šsocketchannel </span></span><br><span class="line">       <span class="keyword">super</span>(channel);</span><br><span class="line">        <span class="keyword">if</span> (javaSocket == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"javaSocket"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç»‘å®šjava socket</span></span><br><span class="line">        <span class="keyword">this</span>.javaSocket = javaSocket;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">// Enable TCP_NODELAY by default if possible.</span></span><br><span class="line">        <span class="comment">// nettyä¸€èˆ¬è¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šï¼Œä¸åœ¨Androidä¸Šï¼ŒcanEnableTcpNoDelayByDefaultè¿”å›true</span></span><br><span class="line">        <span class="keyword">if</span> (PlatformDependent.canEnableTcpNoDelayByDefault()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">            	<span class="comment">// å¼€å¯ TCP_NODELAY ï¼Œå¼€å¯TCPçš„nagleç®—æ³•</span></span><br><span class="line">                <span class="comment">// å°½é‡ä¸è¦ç­‰å¾…ï¼Œåªè¦å‘é€ç¼“å†²åŒºä¸­æœ‰æ•°æ®ï¼Œå¹¶ä¸”å‘é€çª—å£æ˜¯æ‰“å¼€çš„ï¼Œå°±å°½é‡æŠŠæ•°æ®å‘é€åˆ°ç½‘ç»œä¸Šå»ã€‚</span></span><br><span class="line">                setTcpNoDelay(<span class="keyword">true</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="comment">// Ignore.</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;                                  </span><br><span class="line">     </span><br><span class="line">    ... </span><br><span class="line">                                        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="NioSocketChannelåˆå§‹åŒ–ä¸æ³¨å†Œ"><a href="#NioSocketChannelåˆå§‹åŒ–ä¸æ³¨å†Œ" class="headerlink" title="NioSocketChannelåˆå§‹åŒ–ä¸æ³¨å†Œ"></a>NioSocketChannelåˆå§‹åŒ–ä¸æ³¨å†Œ</h2><p>ä¸Šé¢å°èŠ‚åˆ†æäº†NioSocketChannelçš„åˆ›å»ºé€»è¾‘ï¼Œåˆ›å»ºå®Œæˆä¹‹åï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹NioSocketChannelæ˜¯å¦‚ä½•æ³¨å†Œåˆ°NioEventLoopä¸Šå»çš„ã€‚</p><p>åœ¨å‰é¢å°èŠ‚åˆ†ææ–°è¿æ¥æ£€æµ‹çš„æœ‰å¦‚ä¸‹å°æ®µä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">NioMessageUnsafe</span> <span class="keyword">extends</span> <span class="title">AbstractNioUnsafe</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> size = readBuf.size();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i ++) &#123;</span><br><span class="line">        readPending = <span class="keyword">false</span>;</span><br><span class="line">        <span class="comment">// è°ƒç”¨pipelineä¼ æ’­ChannelReadäº‹ä»¶</span></span><br><span class="line">        pipeline.fireChannelRead(readBuf.get(i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨pipelineä¼ æ’­ChannelReadäº‹ä»¶ï¼Œè¿™é‡Œçš„Pipelineæ˜¯æœåŠ¡ç«¯Channelï¼Œä¹Ÿå°±æ˜¯NioServerSocketChannelæ‰€ç»‘å®šçš„Pipelineï¼Œæ­¤æ—¶çš„Pipelineçš„å†…éƒ¨ç»“æ„æ˜¯æ€ä¹ˆæ ·å­çš„å‘¢ï¼Ÿ</p><p><img src="https://img.i7years.com/netty/Pipeline-ServerBootstrapAcceptor.png" alt="Pipeline-ServerBootstrapAcceptor"></p><p>é‚£è¿™ä¸ª <strong><em>ServerBootstrapAcceptor</em></strong> æ˜¯ä»å“ªé‡Œæ¥çš„å‘¢ï¼Ÿ</p><p>åœ¨æ­¤å‰ï¼Œæˆ‘ä»¬åˆ†æ <a href="https://wangwei.one/posts/netty-channel-source-analyse.html#Channel%E5%88%9D%E5%A7%8B%E5%8C%96">NioServerSocketChannelåˆå§‹åŒ–</a> æ—¶ï¼Œæœ‰è¿‡ä¸‹é¢è¿™æ®µä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerBootstrap</span> <span class="keyword">extends</span> <span class="title">AbstractBootstrap</span>&lt;<span class="title">ServerBootstrap</span>, <span class="title">ServerChannel</span>&gt; </span>&#123;</span><br><span class="line"> 	</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// NioServerSocketChannelåˆå§‹åŒ–    </span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(Channel channel)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// è·å–å¯åŠ¨å™¨ å¯åŠ¨æ—¶é…ç½®çš„optionå‚æ•°ï¼Œä¸»è¦æ˜¯TCPçš„ä¸€äº›å±æ€§</span></span><br><span class="line">        <span class="keyword">final</span> Map&lt;ChannelOption&lt;?&gt;, Object&gt; options = options0();</span><br><span class="line">        <span class="comment">// å°†è·å¾—åˆ° options é…ç½®åˆ° ChannelConfig ä¸­å»</span></span><br><span class="line">        <span class="keyword">synchronized</span> (options) &#123;</span><br><span class="line">            setChannelOptions(channel, options, logger);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å– ServerBootstrap å¯åŠ¨æ—¶é…ç½®çš„ attr å‚æ•°</span></span><br><span class="line">        <span class="keyword">final</span> Map&lt;AttributeKey&lt;?&gt;, Object&gt; attrs = attrs0();</span><br><span class="line">        <span class="comment">// é…ç½® Channel attrï¼Œä¸»è¦æ˜¯è®¾ç½®ç”¨æˆ·è‡ªå®šä¹‰çš„ä¸€äº›å‚æ•°</span></span><br><span class="line">        <span class="keyword">synchronized</span> (attrs) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Entry&lt;AttributeKey&lt;?&gt;, Object&gt; e: attrs.entrySet()) &#123;</span><br><span class="line">                <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">                AttributeKey&lt;Object&gt; key = (AttributeKey&lt;Object&gt;) e.getKey();</span><br><span class="line">                channel.attr(key).set(e.getValue());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–channelä¸­çš„ pipelineï¼Œè¿™ä¸ªpipelineä½¿æˆ‘ä»¬å‰é¢åœ¨channelåˆ›å»ºè¿‡ç¨‹ä¸­è®¾ç½®çš„ pipeline</span></span><br><span class="line">        ChannelPipeline p = channel.pipeline();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†å¯åŠ¨å™¨ä¸­é…ç½®çš„ childGroup ä¿å­˜åˆ°å±€éƒ¨å˜é‡ currentChildGroup</span></span><br><span class="line">        <span class="keyword">final</span> EventLoopGroup currentChildGroup = childGroup;</span><br><span class="line">        <span class="comment">// å°†å¯åŠ¨å™¨ä¸­é…ç½®çš„ childHandler ä¿å­˜åˆ°å±€éƒ¨å˜é‡ currentChildHandler</span></span><br><span class="line">        <span class="keyword">final</span> ChannelHandler currentChildHandler = childHandler;</span><br><span class="line">        <span class="keyword">final</span> Entry&lt;ChannelOption&lt;?&gt;, Object&gt;[] currentChildOptions;</span><br><span class="line">        <span class="keyword">final</span> Entry&lt;AttributeKey&lt;?&gt;, Object&gt;[] currentChildAttrs;</span><br><span class="line">        <span class="comment">// ä¿å­˜ç”¨æˆ·è®¾ç½®çš„ childOptions åˆ°å±€éƒ¨å˜é‡ currentChildOptions</span></span><br><span class="line">        <span class="keyword">synchronized</span> (childOptions) &#123;</span><br><span class="line">            currentChildOptions = childOptions.entrySet().toArray(newOptionArray(childOptions.size()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ä¿å­˜ç”¨æˆ·è®¾ç½®çš„ childAttrs åˆ°å±€éƒ¨å˜é‡ currentChildAttrs</span></span><br><span class="line">        <span class="keyword">synchronized</span> (childAttrs) &#123;</span><br><span class="line">            currentChildAttrs = childAttrs.entrySet().toArray(newAttrArray(childAttrs.size()));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        p.addLast(<span class="keyword">new</span> ChannelInitializer&lt;Channel&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(<span class="keyword">final</span> Channel ch)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">final</span> ChannelPipeline pipeline = ch.pipeline();</span><br><span class="line">                <span class="comment">// è·å–å¯åŠ¨å™¨ä¸Šé…ç½®çš„handler</span></span><br><span class="line">                ChannelHandler handler = config.handler();</span><br><span class="line">                <span class="keyword">if</span> (handler != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// æ·»åŠ  handler åˆ° pipeline ä¸­</span></span><br><span class="line">                    pipeline.addLast(handler);</span><br><span class="line">                &#125;</span><br><span class="line">                ch.eventLoop().execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        <span class="comment">// ç”¨childç›¸å…³çš„å‚æ•°åˆ›å»ºå‡ºä¸€ä¸ªæ–°è¿æ¥æ¥å…¥å™¨ServerBootstrapAcceptor</span></span><br><span class="line">                        <span class="comment">// é€šè¿‡ ServerBootstrapAcceptor å¯ä»¥å°†ä¸€ä¸ªæ–°è¿æ¥ç»‘å®šåˆ°ä¸€ä¸ªçº¿ç¨‹ä¸Šå»</span></span><br><span class="line">                        <span class="comment">// æ¯æ¬¡æœ‰æ–°çš„è¿æ¥è¿›æ¥ ServerBootstrapAcceptor éƒ½ä¼šç”¨childç›¸å…³çš„å±æ€§å¯¹å®ƒä»¬è¿›è¡Œé…ç½®ï¼Œå¹¶æ³¨å†Œåˆ°ChaildGroupä¸Šå»</span></span><br><span class="line">                        pipeline.addLast(<span class="keyword">new</span> ServerBootstrapAcceptor(</span><br><span class="line">                                ch, currentChildGroup, currentChildHandler, currentChildOptions, currentChildAttrs));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">	    </span><br><span class="line">    ...    </span><br><span class="line"> 	   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ServerBootstrapAcceptor"><a href="#ServerBootstrapAcceptor" class="headerlink" title="ServerBootstrapAcceptor"></a>ServerBootstrapAcceptor</h3><p>NioServerSocketChannelåˆå§‹åŒ–æ—¶ï¼Œå‘NioServerSocketChannelæ‰€ç»‘å®šçš„Pipelineæ·»åŠ äº†ä¸€ä¸ªInboundHandlerèŠ‚ç‚¹ â€”â€” <strong><em>ServerBootstrapAcceptor</em></strong> ï¼Œå…¶ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerBootstrap</span> <span class="keyword">extends</span> <span class="title">AbstractBootstrap</span>&lt;<span class="title">ServerBootstrap</span>, <span class="title">ServerChannel</span>&gt; </span>&#123;</span><br><span class="line">	</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerBootstrapAcceptor</span> <span class="keyword">extends</span> <span class="title">ChannelInboundHandlerAdapter</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">// å­EventLoopGroupï¼Œå³ä¸ºworkGroup</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> EventLoopGroup childGroup;</span><br><span class="line">        <span class="comment">// ServerBootstrapå¯åŠ¨æ—¶é…ç½®çš„ childHandler</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> ChannelHandler childHandler;</span><br><span class="line">        <span class="comment">// ServerBootstrapå¯åŠ¨æ—¶é…ç½®çš„ childOptions</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Entry&lt;ChannelOption&lt;?&gt;, Object&gt;[] childOptions;</span><br><span class="line">        <span class="comment">// ServerBootstrapå¯åŠ¨æ—¶é…ç½®çš„ childAttrs</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Entry&lt;AttributeKey&lt;?&gt;, Object&gt;[] childAttrs;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Runnable enableAutoReadTask;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">// æ„é€ å‡½æ•°</span></span><br><span class="line">        ServerBootstrapAcceptor(</span><br><span class="line">                <span class="keyword">final</span> Channel channel, EventLoopGroup childGroup, ChannelHandler childHandler,</span><br><span class="line">                Entry&lt;ChannelOption&lt;?&gt;, Object&gt;[] childOptions, Entry&lt;AttributeKey&lt;?&gt;, Object&gt;[] childAttrs) &#123;</span><br><span class="line">            <span class="keyword">this</span>.childGroup = childGroup;</span><br><span class="line">            <span class="keyword">this</span>.childHandler = childHandler;</span><br><span class="line">            <span class="keyword">this</span>.childOptions = childOptions;</span><br><span class="line">            <span class="keyword">this</span>.childAttrs = childAttrs;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Task which is scheduled to re-enable auto-read.</span></span><br><span class="line">            <span class="comment">// It's important to create this Runnable before we try to submit it as otherwise the URLClassLoader may</span></span><br><span class="line">            <span class="comment">// not be able to load the class because of the file limit it already reached.</span></span><br><span class="line">            <span class="comment">//</span></span><br><span class="line">            <span class="comment">// See https://github.com/netty/netty/issues/1328</span></span><br><span class="line">            enableAutoReadTask = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    channel.config().setAutoRead(<span class="keyword">true</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¤„ç†Pipelineæ‰€ä¼ æ’­çš„channelReadäº‹ä»¶</span></span><br><span class="line">        <span class="comment">// ä¹Ÿå°±æ˜¯å‰é¢æ–°è¿æ¥æ£€æµ‹æ—¶çœ‹åˆ°çš„é‚£æ®µä»£ç </span></span><br><span class="line">        <span class="comment">// pipeline.fireChannelRead(readBuf.get(i));</span></span><br><span class="line">        <span class="comment">// ServerBootstrapAcceptorçš„channelReadæ¥å£å°†ä¼šè¢«è°ƒç”¨ï¼Œç”¨äºå¤„ç†channelReadäº‹ä»¶</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// è·å–ä¼ æ’­äº‹ä»¶çš„å¯¹è±¡æ•°æ®ï¼Œå³ä¸ºå‰é¢çš„readBuf.get(i)</span></span><br><span class="line">            <span class="comment">// readBuf.get(i)å–å‡ºçš„å¯¹è±¡ä¸º NioSocketChannel</span></span><br><span class="line">            <span class="keyword">final</span> Channel child = (Channel) msg;</span><br><span class="line">			<span class="comment">// å‘ NioSocketChannel æ·»åŠ childHandlerï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸çœ‹åˆ°çš„</span></span><br><span class="line">            <span class="comment">// ServerBootstrapåœ¨å¯åŠ¨æ—¶é…ç½®çš„ä»£ç ï¼š</span></span><br><span class="line">            <span class="comment">// ServerBootstrap.childHandler(new ChannelInitializer&lt;SocketChannel&gt;() &#123;...&#125; ï¼‰</span></span><br><span class="line">            <span class="comment">// æœ€ç»ˆçš„ç»“æœå°±æ˜¯å‘NioSocketChannelçš„Pipelineæ·»åŠ ç”¨æˆ·è‡ªå®šä¹‰çš„ChannelHandler</span></span><br><span class="line">            <span class="comment">// ç”¨äºå¤„ç†å®¢æˆ·ç«¯çš„channelè¿æ¥</span></span><br><span class="line">            child.pipeline().addLast(childHandler);</span><br><span class="line">			<span class="comment">// é…ç½® NioSocketChannelçš„TCPå±æ€§</span></span><br><span class="line">            setChannelOptions(child, childOptions, logger);</span><br><span class="line">			<span class="comment">// é…ç½® NioSocketChannel ä¸€äº›ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®</span></span><br><span class="line">            <span class="keyword">for</span> (Entry&lt;AttributeKey&lt;?&gt;, Object&gt; e: childAttrs) &#123;</span><br><span class="line">                child.attr((AttributeKey&lt;Object&gt;) e.getKey()).set(e.getValue());</span><br><span class="line">            &#125;</span><br><span class="line">			<span class="comment">// å°†NioSocketChannelæ³¨å†Œåˆ°childGroupï¼Œä¹Ÿå°±æ˜¯Nettyçš„WorkerGroupå½“ä¸­å»</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                childGroup.register(child).addListener(<span class="keyword">new</span> ChannelFutureListener() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operationComplete</span><span class="params">(ChannelFuture future)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        <span class="keyword">if</span> (!future.isSuccess()) &#123;</span><br><span class="line">                            forceClose(child, future.cause());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">                forceClose(child, t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    ...</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å…³äº ChannelInitializer çš„è®²è§£ï¼Œå¯ä»¥çœ‹æ­¤å‰ <a href="https://wangwei.one/posts/netty-pipeline-source-analyse-1.html">Pipelineæºç åˆ†æ</a> æ–‡ç« ã€‚</p></blockquote><p>åé¢çš„registeré€»è¾‘ï¼Œå°±ä¸æˆ‘ä»¬å‰é¢è®²è§£ <a href="https://wangwei.one/posts/netty-channel-source-analyse.html#Channel%E6%B3%A8%E5%86%8C">NioServerSocketChannelæ³¨å†Œ</a> å¤§ä½“ç±»ä¼¼äº†ï¼Œè¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractChannel</span> <span class="keyword">extends</span> <span class="title">DefaultAttributeMap</span> <span class="keyword">implements</span> <span class="title">Channel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// æ³¨å†ŒNioSocketChannel</span></span><br><span class="line">    <span class="comment">// eventLoopä¸ºchildGroup    </span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(EventLoop eventLoop, <span class="keyword">final</span> ChannelPromise promise)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        ...</span><br><span class="line">		<span class="comment">// ç»‘å®ševentLoopåˆ°NioSocketChannelä¸Š</span></span><br><span class="line">        AbstractChannel.<span class="keyword">this</span>.eventLoop = eventLoop;</span><br><span class="line">		<span class="comment">// ç°åœ¨åˆ†æçš„é€»è¾‘æ˜¯åœ¨æœåŠ¡ç«¯çš„çº¿ç¨‹ä¸Šï¼ŒeventLoopä¸ä¸»çº¿ç¨‹ä¸åŒï¼Œè¿”å›false</span></span><br><span class="line">        <span class="keyword">if</span> (eventLoop.inEventLoop()) &#123;</span><br><span class="line">            register0(promise);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                eventLoop.execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        <span class="comment">// è¿™é‡Œæ¥è°ƒç”¨register0æ–¹æ³•</span></span><br><span class="line">                        register0(promise);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">                logger.warn(</span><br><span class="line">                        <span class="string">"Force-closing a channel whose registration task was not accepted by an event loop: &#123;&#125;"</span>,</span><br><span class="line">                        AbstractChannel.<span class="keyword">this</span>, t);</span><br><span class="line">                closeForcibly();</span><br><span class="line">                closeFuture.setClosed();</span><br><span class="line">                safeSetFailure(promise, t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// æ³¨å†Œ</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">register0</span><span class="params">(ChannelPromise promise)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            </span><br><span class="line">            ...</span><br><span class="line">                </span><br><span class="line">            <span class="keyword">boolean</span> firstRegistration = neverRegistered;</span><br><span class="line">            <span class="comment">// è°ƒç”¨ doRegister()</span></span><br><span class="line">            doRegister();</span><br><span class="line">            neverRegistered = <span class="keyword">false</span>;</span><br><span class="line">            registered = <span class="keyword">true</span>;</span><br><span class="line">            </span><br><span class="line">            pipeline.invokeHandlerAddedIfNeeded();</span><br><span class="line"></span><br><span class="line">            safeSetSuccess(promise);</span><br><span class="line">            pipeline.fireChannelRegistered();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æœåŠ¡ç«¯çš„NioServerSocketChannelå·²ç»ä¸å®¢æˆ·ç«¯çš„NioSocketChannelå»ºç«‹äº†è¿æ¥</span></span><br><span class="line">            <span class="comment">// æ‰€ä»¥ï¼ŒNioSocketChannelæ˜¯å¤„äºæ¿€æ´»çŠ¶æ€ï¼ŒisActive()è¿”å›ture</span></span><br><span class="line">            <span class="keyword">if</span> (isActive()) &#123;</span><br><span class="line">                <span class="comment">// å¯¹äºæ–°è¿æ¥ï¼Œæ˜¯ç¬¬ä¸€æ¬¡æ³¨å†Œ</span></span><br><span class="line">                <span class="keyword">if</span> (firstRegistration) &#123;</span><br><span class="line">                    <span class="comment">// ä¼ æ’­ChannelActiveäº‹ä»¶</span></span><br><span class="line">                    pipeline.fireChannelActive();</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (config().isAutoRead()) &#123;</span><br><span class="line">                    beginRead();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            ...</span><br><span class="line">                </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            <span class="comment">// Close the channel directly to avoid FD leak.</span></span><br><span class="line">            closeForcibly();</span><br><span class="line">            closeFuture.setClosed();</span><br><span class="line">            safeSetFailure(promise, t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">	        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨åˆ°NioSocketChannelä¸­çš„doRegister()æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractNioChannel</span> <span class="keyword">extends</span> <span class="title">AbstractChannel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">        </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doRegister</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> selected = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// å°†selectoræ³¨å†Œåˆ°åº•å±‚JDK channelä¸Šï¼Œå¹¶é™„åŠ äº†NioSocketChannelå¯¹è±¡</span></span><br><span class="line">                <span class="comment">// å…´è¶£é›†è®¾ç½®ä¸º0ï¼Œè¡¨ç¤ºä¸å…³å¿ƒä»»ä½•äº‹ä»¶</span></span><br><span class="line">                selectionKey = javaChannel().register(eventLoop().unwrappedSelector(), <span class="number">0</span>, <span class="keyword">this</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (CancelledKeyException e) &#123;</span><br><span class="line">                ...</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> 	</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="NioSocketChannel-æ³¨å†ŒOP-READå…´è¶£é›†"><a href="#NioSocketChannel-æ³¨å†ŒOP-READå…´è¶£é›†" class="headerlink" title="NioSocketChannel æ³¨å†ŒOP_READå…´è¶£é›†"></a>NioSocketChannel æ³¨å†ŒOP_READå…´è¶£é›†</h2><p>ç´§æ¥ç€ä¸Šé¢çš„åˆ†æï¼Œä¼ æ’­ChannelActiveäº‹ä»¶ä¹‹åçš„é€»è¾‘ï¼Œä¸»è¦å°±æ˜¯å‘å®¢æˆ·ç«¯çš„NioSocketChannelæ³¨å†Œä¸€ä¸ªReadå…´è¶£é›†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (isActive()) &#123;</span><br><span class="line">    <span class="comment">// å¯¹äºæ–°è¿æ¥ï¼Œæ˜¯ç¬¬ä¸€æ¬¡æ³¨å†Œ</span></span><br><span class="line">    <span class="keyword">if</span> (firstRegistration) &#123;</span><br><span class="line">        <span class="comment">// ä¼ æ’­ChannelActiveäº‹ä»¶</span></span><br><span class="line">        pipeline.fireChannelActive();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (config().isAutoRead()) &#123;</span><br><span class="line">        beginRead();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ <a href="https://wangwei.one/posts/netty-pipeline-source-analyse-2.html">Pipelineçš„ä¼ æ’­æœºåˆ¶</a> ï¼Œæœ€ç»ˆä¼šè°ƒç”¨åˆ°doBeginRead()æ¥å£ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractNioChannel</span> <span class="keyword">extends</span> <span class="title">AbstractChannel</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractNioUnsafe</span> <span class="keyword">extends</span> <span class="title">AbstractUnsafe</span> <span class="keyword">implements</span> <span class="title">NioUnsafe</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        ...</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doBeginRead</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="comment">// Channel.read() or ChannelHandlerContext.read() was called</span></span><br><span class="line">            <span class="comment">// ä¿å­˜selectionKeyåˆ°å±€éƒ¨å˜é‡</span></span><br><span class="line">            <span class="keyword">final</span> SelectionKey selectionKey = <span class="keyword">this</span>.selectionKey;</span><br><span class="line">            <span class="comment">// åˆ¤æ–­æœ‰æ•ˆæ€§</span></span><br><span class="line">            <span class="keyword">if</span> (!selectionKey.isValid()) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">		</span><br><span class="line">            readPending = <span class="keyword">true</span>;</span><br><span class="line">			</span><br><span class="line">            <span class="comment">// è·å–selectionKeyçš„å…´è¶£é›†</span></span><br><span class="line">            <span class="comment">// å‰é¢å°ç»“åˆ†ædoRegister()æ¥å£æåˆ°ï¼ŒselectionKeyçš„å…´è¶£é›†è®¾ç½®ä¸º0</span></span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> interestOps = selectionKey.interestOps();</span><br><span class="line">            <span class="comment">// è¿™é‡Œçš„ readInterestOp æ˜¯å‰é¢è®²NioSocketChannelåˆ›å»ºæ—¶è®¾ç½®çš„å€¼</span></span><br><span class="line">            <span class="comment">// ä¸º SelectionKey.OP_READï¼Œä¹Ÿå°±æ˜¯1</span></span><br><span class="line">            <span class="keyword">if</span> ((interestOps &amp; readInterestOp) == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// è¿™æ ·ï¼ŒselectionKeyæœ€ç»ˆè®¾ç½®çš„å…´è¶£é›†ä¸ºSelectionKey.OP_READ</span></span><br><span class="line">                <span class="comment">// è¡¨ç¤ºå¯¹è¯»äº‹ä»¶æ„Ÿå…´è¶£</span></span><br><span class="line">                selectionKey.interestOps(interestOps | readInterestOp);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;    </span><br><span class="line">            </span><br><span class="line">        ...    </span><br><span class="line">        </span><br><span class="line">    &#125;    </span><br><span class="line">	</span><br><span class="line">    ...</span><br><span class="line">        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><ul><li>Nettyæ˜¯åœ¨å“ªé‡Œæ£€æµ‹æœ‰æ–°è¿æ¥æ¥å…¥çš„ï¼Ÿ</li><li>æ–°è¿æ¥æ˜¯æ€æ ·æ³¨å†Œåˆ°NioEventLoopçº¿ç¨‹ä¸Šçš„ï¼Ÿ</li><li>NioSocketChannelæ˜¯æ€æ ·åˆå§‹åŒ–åŠæ³¨å†Œçš„ï¼Ÿ</li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://coding.imooc.com/class/230.html" target="_blank" rel="noopener">Javaè¯»æºç ä¹‹Nettyæ·±å…¥å‰–æ</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Netty </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Netty Pipelineæºç åˆ†æ(2)]]></title>
      <url>/posts/netty-pipeline-source-analyse-2.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/pexels-photo-154575.jpeg?imageslim" alt="pexels-photo-154575"></p><p><a href="https://wangwei.one/posts/netty-pipeline-source-analyse-1.html">å‰é¢</a> ï¼Œæˆ‘ä»¬åˆ†æäº†Netty Pipelineçš„åˆå§‹åŒ–åŠèŠ‚ç‚¹æ·»åŠ ä¸åˆ é™¤é€»è¾‘ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ¥åˆ†æPipelineçš„äº‹ä»¶ä¼ æ’­æœºåˆ¶ã€‚</p><a id="more"></a><blockquote><p>Nettyç‰ˆæœ¬ï¼š4.1.30</p></blockquote><h2 id="inBoundäº‹ä»¶ä¼ æ’­"><a href="#inBoundäº‹ä»¶ä¼ æ’­" class="headerlink" title="inBoundäº‹ä»¶ä¼ æ’­"></a>inBoundäº‹ä»¶ä¼ æ’­</h2><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>æˆ‘ä»¬é€šè¿‡ä¸‹é¢è¿™ä¸ªä¾‹å­æ¥æ¼”ç¤ºNetty Pipelineçš„äº‹ä»¶ä¼ æ’­æœºåˆ¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NettyPipelineInboundExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        EventLoopGroup group = <span class="keyword">new</span> NioEventLoopGroup(<span class="number">1</span>);</span><br><span class="line">        ServerBootstrap strap = <span class="keyword">new</span> ServerBootstrap();</span><br><span class="line">        strap.group(group)</span><br><span class="line">                .channel(NioServerSocketChannel.class)</span><br><span class="line">                .localAddress(<span class="keyword">new</span> InetSocketAddress(<span class="number">8888</span>))</span><br><span class="line">                .childOption(ChannelOption.TCP_NODELAY, <span class="keyword">true</span>)</span><br><span class="line">                .childHandler(<span class="keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(SocketChannel ch)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        ch.pipeline().addLast(<span class="keyword">new</span> InboundHandlerA());</span><br><span class="line">                        ch.pipeline().addLast(<span class="keyword">new</span> InboundHandlerB());</span><br><span class="line">                        ch.pipeline().addLast(<span class="keyword">new</span> InboundHandlerC());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ChannelFuture future = strap.bind().sync();</span><br><span class="line">            future.channel().closeFuture().sync();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            group.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InboundHandlerA</span> <span class="keyword">extends</span> <span class="title">ChannelInboundHandlerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"InboundHandler A : "</span> + msg);</span><br><span class="line">        <span class="comment">// ä¼ æ’­readäº‹ä»¶åˆ°ä¸‹ä¸€ä¸ªchannelhandler</span></span><br><span class="line">        ctx.fireChannelRead(msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InboundHandlerB</span> <span class="keyword">extends</span> <span class="title">ChannelInboundHandlerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"InboundHandler B : "</span> + msg);</span><br><span class="line">        <span class="comment">// ä¼ æ’­readäº‹ä»¶åˆ°ä¸‹ä¸€ä¸ªchannelhandler</span></span><br><span class="line">        ctx.fireChannelRead(msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelActive</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// channelæ¿€æ´»ï¼Œè§¦å‘channelReadäº‹ä»¶ï¼Œä»pipelineçš„heandContextèŠ‚ç‚¹å¼€å§‹å¾€ä¸‹ä¼ æ’­</span></span><br><span class="line">        ctx.channel().pipeline().fireChannelRead(<span class="string">"Hello world"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InboundHandlerC</span> <span class="keyword">extends</span> <span class="title">ChannelInboundHandlerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"InboundHandler C : "</span> + msg);</span><br><span class="line">        <span class="comment">// ä¼ æ’­readäº‹ä»¶åˆ°ä¸‹ä¸€ä¸ªchannelhandler</span></span><br><span class="line">        ctx.fireChannelRead(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/wangweiX/netty-in-action/blob/2.0-SNAPSHOT/chapter6/src/main/java/nia/chapter6/NettyPipelineInboundExample.java" target="_blank" rel="noopener">æºç </a></p></blockquote><p>é€šè¿‡ telnet æ¥è¿æ¥ä¸Šé¢å¯åŠ¨å¥½çš„nettyæœåŠ¡ï¼Œè§¦å‘channel activeäº‹ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> telnet 127.0.0.1 8888</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§InboundHandlerAã€InboundHandlerBã€InboundHandlerCçš„æ·»åŠ é¡ºåºï¼Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">InboundHandler A : Hello world</span><br><span class="line">InboundHandler B : Hello world</span><br><span class="line">InboundHandler C : Hello world</span><br></pre></td></tr></table></figure><p>è‹¥æ˜¯è°ƒç”¨å®ƒä»¬çš„æ·»åŠ é¡ºåºï¼Œåˆ™ä¼šè¾“å‡ºå¯¹åº”é¡ºåºçš„ä¿¡æ¯ï¼Œe.g:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line">ch.pipeline().addLast(<span class="keyword">new</span> InboundHandlerB());</span><br><span class="line">ch.pipeline().addLast(<span class="keyword">new</span> InboundHandlerA());</span><br><span class="line">ch.pipeline().addLast(<span class="keyword">new</span> InboundHandlerC());</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">InboundHandler B : Hello world</span><br><span class="line">InboundHandler A : Hello world</span><br><span class="line">InboundHandler C : Hello world</span><br></pre></td></tr></table></figure><h3 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><blockquote><p><strong>å¼ºçƒˆå»ºè®®</strong> ä¸‹é¢çš„æµç¨‹ï¼Œè‡ªå·±é€šè¿‡IDEçš„Debugæ¨¡å¼æ¥åˆ†æ</p></blockquote><p>å¾…nettyå¯åŠ¨æˆåŠŸï¼Œé€šè¿‡telnetè¿æ¥åˆ°nettyï¼Œç„¶åé€šè¿‡telnetç»ˆç«¯è¾“å…¥ä»»æ„å­—ç¬¦ï¼ˆè¿™ä¸€æ­¥æ‰å¼€å¯Debugæ¨¡å¼ï¼‰ï¼Œè¿›å…¥Debugæ¨¡å¼ã€‚</p><p>è§¦å‘channel readäº‹ä»¶ï¼Œä»ä¸‹é¢çš„å…¥å£å¼€å§‹è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultChannelPipeline</span> <span class="keyword">implements</span> <span class="title">ChannelPipeline</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// å‡ºå‘channel readäº‹ä»¶</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> ChannelPipeline <span class="title">fireChannelRead</span><span class="params">(Object msg)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä»headèŠ‚ç‚¹å¼€å§‹å¾€ä¸‹ä¼ æ’­readäº‹ä»¶</span></span><br><span class="line">        AbstractChannelHandlerContext.invokeChannelRead(head, msg);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨ AbstractChannelHandlerContext ä¸­çš„ <code>invokeChannelRead(head, msg)</code> æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractChannelHandlerContext</span> <span class="keyword">extends</span> <span class="title">DefaultAttributeMap</span></span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">ChannelHandlerContext</span>, <span class="title">ResourceLeakHint</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è°ƒç”¨channel read</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">invokeChannelRead</span><span class="params">(<span class="keyword">final</span> AbstractChannelHandlerContext next, Object msg)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è·å–æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">final</span> Object m = next.pipeline.touch(ObjectUtil.checkNotNull(msg, <span class="string">"msg"</span>), next);</span><br><span class="line">        <span class="comment">// è·å– EventExecutor</span></span><br><span class="line">        EventExecutor executor = next.executor();</span><br><span class="line">        <span class="comment">// true</span></span><br><span class="line">        <span class="keyword">if</span> (executor.inEventLoop()) &#123;</span><br><span class="line">        	<span class="comment">// è°ƒç”¨ä¸‹é¢çš„invokeChannelReadæ¥å£ï¼šinvokeChannelRead(Object msg)</span></span><br><span class="line">            next.invokeChannelRead(m);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            executor.execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    next.invokeChannelRead(m);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">invokeChannelRead</span><span class="params">(Object msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (invokeHandler()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">            	<span class="comment">// handler():è·å–å½“å‰éå†åˆ°çš„channelHandlerï¼Œç¬¬ä¸€ä¸ªä¸ºHeandContextï¼Œæœ€åä¸ºTailContext</span></span><br><span class="line">            	<span class="comment">// è°ƒç”¨channel handlerçš„channelReadæ¥å£</span></span><br><span class="line">                ((ChannelInboundHandler) handler()).channelRead(<span class="keyword">this</span>, msg);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">                notifyHandlerException(t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            fireChannelRead(msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ChannelHandlerContext <span class="title">fireChannelRead</span><span class="params">(<span class="keyword">final</span> Object msg)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è°ƒå›åˆ°ä¸Šé¢çš„ invokeChannelRead(final AbstractChannelHandlerContext next, Object msg)</span></span><br><span class="line">        invokeChannelRead(findContextInbound(), msg);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éå†å‡ºä¸‹ä¸€ä¸ªChannelHandler</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> AbstractChannelHandlerContext <span class="title">findContextInbound</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        AbstractChannelHandlerContext ctx = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">        	<span class="comment">//è·å–ä¸‹ä¸€ä¸ªinboundç±»å‹çš„èŠ‚ç‚¹</span></span><br><span class="line">            ctx = ctx.next;</span><br><span class="line">            <span class="comment">// å¿…é¡»ä¸ºinboundç±»å‹</span></span><br><span class="line">        &#125; <span class="keyword">while</span> (!ctx.inbound);</span><br><span class="line">        <span class="keyword">return</span> ctx;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Pipelineä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸ºHeadContextï¼Œå®ƒå¯¹äºchannelReadäº‹ä»¶çš„å¤„ç†ï¼Œæ˜¯ç›´æ¥å¾€ä¸‹ä¼ æ’­ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">HeadContext</span> <span class="keyword">extends</span> <span class="title">AbstractChannelHandlerContext</span></span></span><br><span class="line"><span class="class">	</span></span><br><span class="line"><span class="class">	...</span></span><br><span class="line"><span class="class">	</span></span><br><span class="line"><span class="class">	@<span class="title">Override</span></span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">void</span> <span class="title">channelRead</span>(<span class="title">ChannelHandlerContext</span> <span class="title">ctx</span>, <span class="title">Object</span> <span class="title">msg</span>) <span class="title">throws</span> <span class="title">Exception</span> </span>&#123;</span><br><span class="line">    	<span class="comment">// HeadContextå¾€ä¸‹ä¼ æ’­channelReadäº‹ä»¶ï¼Œ</span></span><br><span class="line">   		<span class="comment">// è°ƒç”¨HeandlerContextä¸­çš„æ¥å£ï¼šfireChannelRead(final Object msg)</span></span><br><span class="line">    	ctx.fireChannelRead(msg);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±è¿™æ ·ä¸€ç›´å¾ªç¯ä¸‹å»ï¼Œä¾æ¬¡ä¼šè°ƒç”¨åˆ° InboundHandlerAã€InboundHandlerBã€InboundHandlerC ä¸­çš„ <code>channelRead(ChannelHandlerContext ctx, Object msg)</code> æ¥å£ã€‚</p><p>åˆ°æœ€åä¸€ä¸ªTailContextèŠ‚ç‚¹ï¼Œå®ƒå¯¹channelReadäº‹ä»¶çš„å¤„ç†å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultChannelPipeline</span> <span class="keyword">implements</span> <span class="title">ChannelPipeline</span> </span>&#123;</span><br><span class="line">	    </span><br><span class="line">    <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">TailContext</span> <span class="keyword">extends</span> <span class="title">AbstractChannelHandlerContext</span> <span class="keyword">implements</span> <span class="title">ChannelInboundHandler</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">        ...</span><br><span class="line">		        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="comment">// è°ƒç”¨onUnhandledInboundMessageæ¥å£</span></span><br><span class="line">            onUnhandledInboundMessage(msg);</span><br><span class="line">        &#125;      </span><br><span class="line"></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	...</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯¹æœªå¤„ç†inboundæ¶ˆæ¯åšæœ€åçš„å¤„ç†</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onUnhandledInboundMessage</span><span class="params">(Object msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            logger.debug(<span class="string">"Discarded inbound message &#123;&#125; that reached at the tail of the pipeline. Please check your pipeline configuration."</span>, msg);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// å¯¹msgå¯¹è±¡çš„å¼•ç”¨æ•°å‡1ï¼Œå½“msgå¯¹è±¡çš„å¼•ç”¨æ•°ä¸º0æ—¶ï¼Œé‡Šæ”¾è¯¥å¯¹è±¡çš„å†…å­˜</span></span><br><span class="line">            ReferenceCountUtil.release(msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå°±æ˜¯pipelineå¯¹inBoundæ¶ˆæ¯çš„å¤„ç†æµç¨‹ã€‚</p><h4 id="SimpleChannelInboundHandler"><a href="#SimpleChannelInboundHandler" class="headerlink" title="SimpleChannelInboundHandler"></a>SimpleChannelInboundHandler</h4><p>åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œå‡å¦‚ä¸­é—´æœ‰ä¸€ä¸ªChannelHandleræœªå¯¹channelReadäº‹ä»¶è¿›è¡Œä¼ æ’­ï¼Œå°±ä¼šå¯¼è‡´æ¶ˆæ¯å¯¹è±¡æ— æ³•å¾—åˆ°é‡Šæ”¾ï¼Œæœ€ç»ˆå¯¼è‡´å†…å­˜æ³„éœ²ã€‚</p><p>æˆ‘ä»¬è¿˜å¯ä»¥ç»§æ‰¿ SimpleChannelInboundHandler æ¥è‡ªå®šä¹‰ChannelHandlerï¼Œå®ƒçš„channelReadæ–¹æ³•ï¼Œå¯¹æ¶ˆæ¯å¯¹è±¡åšäº†msgå¤„ç†ï¼Œé˜²æ­¢å†…å­˜æ³„éœ²ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleChannelInboundHandler</span>&lt;<span class="title">I</span>&gt; <span class="keyword">extends</span> <span class="title">ChannelInboundHandlerAdapter</span> </span>&#123;</span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> release = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (acceptInboundMessage(msg)) &#123;</span><br><span class="line">                <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">                I imsg = (I) msg;</span><br><span class="line">                channelRead0(ctx, imsg);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                release = <span class="keyword">false</span>;</span><br><span class="line">                ctx.fireChannelRead(msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (autoRelease &amp;&amp; release) &#123;</span><br><span class="line">                <span class="comment">// å¯¹msgå¯¹è±¡çš„å¼•ç”¨æ•°å‡1ï¼Œå½“msgå¯¹è±¡çš„å¼•ç”¨æ•°ä¸º0æ—¶ï¼Œé‡Šæ”¾è¯¥å¯¹è±¡çš„å†…å­˜</span></span><br><span class="line">                ReferenceCountUtil.release(msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="outBoundäº‹ä»¶ä¼ æ’­"><a href="#outBoundäº‹ä»¶ä¼ æ’­" class="headerlink" title="outBoundäº‹ä»¶ä¼ æ’­"></a>outBoundäº‹ä»¶ä¼ æ’­</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥åˆ†æPipelineçš„outBoundäº‹ä»¶ä¼ æ’­æœºåˆ¶ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><h3 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NettyPipelineOutboundExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        EventLoopGroup group = <span class="keyword">new</span> NioEventLoopGroup(<span class="number">1</span>);</span><br><span class="line">        ServerBootstrap strap = <span class="keyword">new</span> ServerBootstrap();</span><br><span class="line">        strap.group(group)</span><br><span class="line">                .channel(NioServerSocketChannel.class)</span><br><span class="line">                .localAddress(<span class="keyword">new</span> InetSocketAddress(<span class="number">8888</span>))</span><br><span class="line">                .childOption(ChannelOption.TCP_NODELAY, <span class="keyword">true</span>)</span><br><span class="line">                .childHandler(<span class="keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(SocketChannel ch)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        ch.pipeline().addLast(<span class="keyword">new</span> OutboundHandlerA());</span><br><span class="line">                        ch.pipeline().addLast(<span class="keyword">new</span> OutboundHandlerB());</span><br><span class="line">                        ch.pipeline().addLast(<span class="keyword">new</span> OutboundHandlerC());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ChannelFuture future = strap.bind().sync();</span><br><span class="line">            future.channel().closeFuture().sync();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            group.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OutboundHandlerA</span> <span class="keyword">extends</span> <span class="title">ChannelOutboundHandlerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(ChannelHandlerContext ctx, Object msg, ChannelPromise promise)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// è¾“å‡ºæ¶ˆæ¯</span></span><br><span class="line">        System.out.println(<span class="string">"OutboundHandlerA: "</span> + msg);</span><br><span class="line">        <span class="comment">// ä¼ æ’­writeäº‹ä»¶åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        ctx.write(msg, promise);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OutboundHandlerB</span> <span class="keyword">extends</span> <span class="title">ChannelOutboundHandlerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(ChannelHandlerContext ctx, Object msg, ChannelPromise promise)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// è¾“å‡ºæ¶ˆæ¯</span></span><br><span class="line">        System.out.println(<span class="string">"OutboundHandlerB: "</span> + msg);</span><br><span class="line">        <span class="comment">// ä¼ æ’­writeäº‹ä»¶åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        ctx.write(msg, promise);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handlerAdded</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// å¾…handlerAddedäº‹ä»¶è§¦å‘3såï¼Œæ¨¡æ‹Ÿè§¦å‘ä¸€ä¸ª</span></span><br><span class="line">        ctx.executor().schedule(() -&gt; &#123;</span><br><span class="line"><span class="comment">//            ctx.write("Hello world ! ");</span></span><br><span class="line">            ctx.channel().write(<span class="string">"Hello world ! "</span>);</span><br><span class="line">        &#125;, <span class="number">3</span>, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OutboundHandlerC</span> <span class="keyword">extends</span> <span class="title">ChannelOutboundHandlerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(ChannelHandlerContext ctx, Object msg, ChannelPromise promise)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// è¾“å‡ºæ¶ˆæ¯</span></span><br><span class="line">        System.out.println(<span class="string">"OutboundHandlerC: "</span> + msg);</span><br><span class="line">        <span class="comment">// ä¼ æ’­writeäº‹ä»¶åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        ctx.write(msg, promise);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/wangweiX/netty-in-action/blob/2.0-SNAPSHOT/chapter6/src/main/java/nia/chapter6/NettyPipelineOutboundExample.java" target="_blank" rel="noopener">æºç </a></p></blockquote><p>é€šè¿‡ telnet æ¥è¿æ¥ä¸Šé¢å¯åŠ¨å¥½çš„nettyæœåŠ¡ï¼Œè§¦å‘channel addedäº‹ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> telnet 127.0.0.1 8888</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§OutboundHandlerAã€OutboundHandlerBã€OutboundHandlerCçš„æ·»åŠ é¡ºåºï¼Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">OutboundHandlerC: Hello world ! </span><br><span class="line">OutboundHandlerB: Hello world ! </span><br><span class="line">OutboundHandlerA: Hello world !</span><br></pre></td></tr></table></figure><p>è¾“å‡ºçš„é¡ºåºæ­£å¥½ä¸ChannelHandlerçš„æ·»åŠ é¡ºåºç›¸åã€‚</p><p>è‹¥æ˜¯è°ƒç”¨å®ƒä»¬çš„æ·»åŠ é¡ºåºï¼Œåˆ™ä¼šè¾“å‡ºå¯¹åº”é¡ºåºçš„ä¿¡æ¯ï¼Œe.g:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line">ch.pipeline().addLast(<span class="keyword">new</span> InboundHandlerB());</span><br><span class="line">ch.pipeline().addLast(<span class="keyword">new</span> InboundHandlerA());</span><br><span class="line">ch.pipeline().addLast(<span class="keyword">new</span> InboundHandlerC());</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">OutboundHandlerC: Hello world ! </span><br><span class="line">OutboundHandlerA: Hello world ! </span><br><span class="line">OutboundHandlerB: Hello world !</span><br></pre></td></tr></table></figure><h3 id="æºç åˆ†æ-1"><a href="#æºç åˆ†æ-1" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><blockquote><p><strong>å¼ºçƒˆå»ºè®®</strong> ä¸‹é¢çš„æµç¨‹ï¼Œè‡ªå·±é€šè¿‡IDEçš„Debugæ¨¡å¼æ¥åˆ†æ</p></blockquote><p>ä»channelçš„writeæ–¹æ³•å¼€å§‹ï¼Œå¾€ä¸‹ä¼ æ’­writeäº‹ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractChannel</span> <span class="keyword">extends</span> <span class="title">DefaultAttributeMap</span> <span class="keyword">implements</span> <span class="title">Channel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ChannelFuture <span class="title">write</span><span class="params">(Object msg)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨pipelineå¾€ä¸‹ä¼ æ’­wirteäº‹ä»¶</span></span><br><span class="line">        <span class="keyword">return</span> pipeline.write(msg);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€æ¥çœ‹çœ‹Pipelineä¸­çš„writeæ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultChannelPipeline</span> <span class="keyword">implements</span> <span class="title">ChannelPipeline</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> ChannelFuture <span class="title">write</span><span class="params">(Object msg)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä»tailèŠ‚ç‚¹å¼€å§‹ä¼ æ’­</span></span><br><span class="line">        <span class="keyword">return</span> tail.write(msg);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...    </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨ChannelHandlerContextä¸­çš„writeæ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractChannelHandlerContext</span> <span class="keyword">extends</span> <span class="title">DefaultAttributeMap</span></span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">ChannelHandlerContext</span>, <span class="title">ResourceLeakHint</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ChannelFuture <span class="title">write</span><span class="params">(Object msg)</span> </span>&#123;</span><br><span class="line">   	 	<span class="comment">// å¾€ä¸‹è°ƒç”¨writeæ¥å£</span></span><br><span class="line">        <span class="keyword">return</span> write(msg, newPromise());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ChannelFuture <span class="title">write</span><span class="params">(<span class="keyword">final</span> Object msg, <span class="keyword">final</span> ChannelPromise promise)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (msg == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"msg"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (isNotValidPromise(promise, <span class="keyword">true</span>)) &#123;</span><br><span class="line">                ReferenceCountUtil.release(msg);</span><br><span class="line">                <span class="comment">// cancelled</span></span><br><span class="line">                <span class="keyword">return</span> promise;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line">            ReferenceCountUtil.release(msg);</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¾€ä¸‹è°ƒç”¨writeæ¥å£</span></span><br><span class="line">        write(msg, <span class="keyword">false</span>, promise);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> promise;</span><br><span class="line">    &#125;    </span><br><span class="line">     </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(Object msg, <span class="keyword">boolean</span> flush, ChannelPromise promise)</span> </span>&#123;</span><br><span class="line">    	<span class="comment">// å¯»æ‰¾ä¸‹ä¸€ä¸ªoutboundç±»å‹çš„channelHandlerContext</span></span><br><span class="line">        AbstractChannelHandlerContext next = findContextOutbound();</span><br><span class="line">        <span class="keyword">final</span> Object m = pipeline.touch(msg, next);</span><br><span class="line">        EventExecutor executor = next.executor();</span><br><span class="line">        <span class="keyword">if</span> (executor.inEventLoop()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (flush) &#123;</span><br><span class="line">                next.invokeWriteAndFlush(m, promise);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            	<span class="comment">// è°ƒç”¨æ¥å£ invokeWrite(Object msg, ChannelPromise promise)</span></span><br><span class="line">                next.invokeWrite(m, promise);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            AbstractWriteTask task;</span><br><span class="line">            <span class="keyword">if</span> (flush) &#123;</span><br><span class="line">                task = WriteAndFlushTask.newInstance(next, m, promise);</span><br><span class="line">            &#125;  <span class="keyword">else</span> &#123;</span><br><span class="line">                task = WriteTask.newInstance(next, m, promise);</span><br><span class="line">            &#125;</span><br><span class="line">            safeExecute(executor, task, promise, m);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯»æ‰¾ä¸‹ä¸€ä¸ªoutboundç±»å‹çš„channelHandlerContext</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> AbstractChannelHandlerContext <span class="title">findContextOutbound</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        AbstractChannelHandlerContext ctx = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            ctx = ctx.prev;</span><br><span class="line">        &#125; <span class="keyword">while</span> (!ctx.outbound);</span><br><span class="line">        <span class="keyword">return</span> ctx;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">invokeWrite</span><span class="params">(Object msg, ChannelPromise promise)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (invokeHandler()) &#123;</span><br><span class="line">        	<span class="comment">// ç»§ç»­å¾€ä¸‹è°ƒç”¨</span></span><br><span class="line">            invokeWrite0(msg, promise);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            write(msg, promise);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">invokeWrite0</span><span class="params">(Object msg, ChannelPromise promise)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">        	<span class="comment">// è·å–å½“å‰çš„channelHandlerï¼Œè°ƒç”¨å…¶writeæ¥å£</span></span><br><span class="line">        	<span class="comment">// handler()ä¾æ¬¡ä¼šè¿”å› OutboundHandlerC OutboundHandlerB OutboundHandlerA</span></span><br><span class="line">            ((ChannelOutboundHandler) handler()).write(<span class="keyword">this</span>, msg, promise);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            notifyOutboundHandlerException(t, promise);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...    </span><br><span class="line">        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆä¼šè°ƒç”¨åˆ°HeadContextçš„writeæ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(ChannelHandlerContext ctx, Object msg, ChannelPromise promise)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨unsafeè¿›è¡Œå†™æ•°æ®æ“ä½œ</span></span><br><span class="line">    unsafe.write(msg, promise);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¼‚å¸¸ä¼ æ’­"><a href="#å¼‚å¸¸ä¼ æ’­" class="headerlink" title="å¼‚å¸¸ä¼ æ’­"></a>å¼‚å¸¸ä¼ æ’­</h2><p>äº†è§£äº†Pipelineçš„å…¥ç«™ä¸å‡ºç«™äº‹ä»¶çš„æœºåˆ¶ä¹‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹Pipelineçš„å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚</p><h3 id="ç¤ºä¾‹-2"><a href="#ç¤ºä¾‹-2" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NettyPipelineExceptionCaughtExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        EventLoopGroup group = <span class="keyword">new</span> NioEventLoopGroup(<span class="number">1</span>);</span><br><span class="line">        ServerBootstrap strap = <span class="keyword">new</span> ServerBootstrap();</span><br><span class="line">        strap.group(group)</span><br><span class="line">                .channel(NioServerSocketChannel.class)</span><br><span class="line">                .localAddress(<span class="keyword">new</span> InetSocketAddress(<span class="number">8888</span>))</span><br><span class="line">                .childOption(ChannelOption.TCP_NODELAY, <span class="keyword">true</span>)</span><br><span class="line">                .childHandler(<span class="keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(SocketChannel ch)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        ch.pipeline().addLast(<span class="keyword">new</span> InboundHandlerA());</span><br><span class="line">                        ch.pipeline().addLast(<span class="keyword">new</span> InboundHandlerB());</span><br><span class="line">                        ch.pipeline().addLast(<span class="keyword">new</span> InboundHandlerC());</span><br><span class="line">                        ch.pipeline().addLast(<span class="keyword">new</span> OutboundHandlerA());</span><br><span class="line">                        ch.pipeline().addLast(<span class="keyword">new</span> OutboundHandlerB());</span><br><span class="line">                        ch.pipeline().addLast(<span class="keyword">new</span> OutboundHandlerC());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ChannelFuture future = strap.bind().sync();</span><br><span class="line">            future.channel().closeFuture().sync();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            group.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">InboundHandlerA</span> <span class="keyword">extends</span> <span class="title">ChannelInboundHandlerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"InboundHandlerA.exceptionCaught:"</span> + cause.getMessage());</span><br><span class="line">            ctx.fireExceptionCaught(cause);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">InboundHandlerB</span> <span class="keyword">extends</span> <span class="title">ChannelInboundHandlerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"ERROR !!!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"InboundHandlerB.exceptionCaught:"</span> + cause.getMessage());</span><br><span class="line">            ctx.fireExceptionCaught(cause);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">InboundHandlerC</span> <span class="keyword">extends</span> <span class="title">ChannelInboundHandlerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"InboundHandlerC.exceptionCaught:"</span> + cause.getMessage());</span><br><span class="line">            ctx.fireExceptionCaught(cause);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">OutboundHandlerA</span> <span class="keyword">extends</span> <span class="title">ChannelOutboundHandlerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"OutboundHandlerA.exceptionCaught:"</span> + cause.getMessage());</span><br><span class="line">            ctx.fireExceptionCaught(cause);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">OutboundHandlerB</span> <span class="keyword">extends</span> <span class="title">ChannelOutboundHandlerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"OutboundHandlerB.exceptionCaught:"</span> + cause.getMessage());</span><br><span class="line">            ctx.fireExceptionCaught(cause);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">OutboundHandlerC</span> <span class="keyword">extends</span> <span class="title">ChannelOutboundHandlerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"OutboundHandlerC.exceptionCaught:"</span> + cause.getMessage());</span><br><span class="line">            ctx.fireExceptionCaught(cause);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/wangweiX/netty-in-action/blob/2.0-SNAPSHOT/chapter6/src/main/java/nia/chapter6/NettyPipelineExceptionCaughtExample.java" target="_blank" rel="noopener">æºç </a></p></blockquote><p>é€šè¿‡ telnet æ¥è¿æ¥ä¸Šé¢å¯åŠ¨å¥½çš„nettyæœåŠ¡ï¼Œå¹¶åœ¨æ§åˆ¶å°å‘é€ä»»æ„å­—ç¬¦ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> telnet 127.0.0.1 8888</span><br></pre></td></tr></table></figure><p>è§¦å‘channel readäº‹ä»¶å¹¶æŠ›å‡ºå¼‚å¸¸ï¼Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">InboundHandlerB.exceptionCaught:ERROR !!!</span><br><span class="line">InboundHandlerC.exceptionCaught:ERROR !!!</span><br><span class="line">OutboundHandlerA.exceptionCaught:ERROR !!!</span><br><span class="line">OutboundHandlerB.exceptionCaught:ERROR !!!</span><br><span class="line">OutboundHandlerC.exceptionCaught:ERROR !!!</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å¼‚å¸¸çš„æ•è·ä¸æˆ‘ä»¬æ·»åŠ çš„ChannelHandleré¡ºåºç›¸åŒã€‚</p><h3 id="æºç åˆ†æ-2"><a href="#æºç åˆ†æ-2" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><p>åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼ŒInboundHandlerBçš„ChannelReadæ¥å£æŠ›å‡ºå¼‚å¸¸ï¼Œå¯¼è‡´ä»InboundHandlerAå°†ChannelReadäº‹ä»¶ä¼ æ’­åˆ°InboundHandlerBçš„è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼Œå¼‚å¸¸è¢«æ•è·ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractChannelHandlerContext</span> <span class="keyword">extends</span> <span class="title">DefaultAttributeMap</span></span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">ChannelHandlerContext</span>, <span class="title">ResourceLeakHint</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    ...</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ChannelHandlerContext <span class="title">fireExceptionCaught</span><span class="params">(<span class="keyword">final</span> Throwable cause)</span> </span>&#123;</span><br><span class="line">    	<span class="comment">//è°ƒç”¨invokeExceptionCaughtæ¥å£</span></span><br><span class="line">        invokeExceptionCaught(next, cause);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">invokeExceptionCaught</span><span class="params">(<span class="keyword">final</span> AbstractChannelHandlerContext next, <span class="keyword">final</span> Throwable cause)</span> </span>&#123;</span><br><span class="line">        ObjectUtil.checkNotNull(cause, <span class="string">"cause"</span>);</span><br><span class="line">        EventExecutor executor = next.executor();</span><br><span class="line">        <span class="keyword">if</span> (executor.inEventLoop()) &#123;</span><br><span class="line">        	<span class="comment">// è°ƒç”¨ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„invokeExceptionCaughtæ¥å£</span></span><br><span class="line">            next.invokeExceptionCaught(cause);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                executor.execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        next.invokeExceptionCaught(cause);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">                <span class="keyword">if</span> (logger.isWarnEnabled()) &#123;</span><br><span class="line">                    logger.warn(<span class="string">"Failed to submit an exceptionCaught() event."</span>, t);</span><br><span class="line">                    logger.warn(<span class="string">"The exceptionCaught() event that was failed to submit was:"</span>, cause);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">invokeChannelRead</span><span class="params">(Object msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (invokeHandler()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">                ((ChannelInboundHandler) handler()).channelRead(<span class="keyword">this</span>, msg);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">                <span class="comment">// å¼‚å¸¸æ•è·ï¼Œå¾€ä¸‹ä¼ æ’­</span></span><br><span class="line">                notifyHandlerException(t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            fireChannelRead(msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// é€šçŸ¥Handlerå‘ç”Ÿå¼‚å¸¸äº‹ä»¶</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">notifyHandlerException</span><span class="params">(Throwable cause)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (inExceptionCaught(cause)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (logger.isWarnEnabled()) &#123;</span><br><span class="line">                logger.warn(</span><br><span class="line">                    <span class="string">"An exception was thrown by a user handler "</span> +</span><br><span class="line">                    <span class="string">"while handling an exceptionCaught event"</span>, cause);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">// å¾€ä¸‹è°ƒç”¨invokeExceptionCaughtæ¥å£</span></span><br><span class="line">        invokeExceptionCaught(cause);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">invokeExceptionCaught</span><span class="params">(<span class="keyword">final</span> Throwable cause)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (invokeHandler()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// è°ƒç”¨å½“å‰ChannelHandlerçš„exceptionCaughtæ¥å£</span></span><br><span class="line">                <span class="comment">// åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œä¾æ¬¡ä¼šè°ƒç”¨InboundHandlerBã€InboundHandlerCã€</span></span><br><span class="line">                <span class="comment">// OutboundHandlerAã€OutboundHandlerBã€OutboundHandlC</span></span><br><span class="line">                handler().exceptionCaught(<span class="keyword">this</span>, cause);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable error) &#123;</span><br><span class="line">                <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                    logger.debug(</span><br><span class="line">                        <span class="string">"An exception &#123;&#125;"</span> +</span><br><span class="line">                        <span class="string">"was thrown by a user handler's exceptionCaught() "</span> +</span><br><span class="line">                        <span class="string">"method while handling the following exception:"</span>,</span><br><span class="line">                        ThrowableUtil.stackTraceToString(error), cause);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (logger.isWarnEnabled()) &#123;</span><br><span class="line">                    logger.warn(</span><br><span class="line">                        <span class="string">"An exception '&#123;&#125;' [enable DEBUG level for full stacktrace] "</span> +</span><br><span class="line">                        <span class="string">"was thrown by a user handler's exceptionCaught() "</span> +</span><br><span class="line">                        <span class="string">"method while handling the following exception:"</span>, error, cause);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            fireExceptionCaught(cause);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	...</span><br><span class="line">		</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆä¼šè°ƒç”¨åˆ°TailContextèŠ‚ç‚¹çš„exceptionCaughtæ¥å£ï¼Œå¦‚æœæˆ‘ä»¬ä¸­é€”æ²¡æœ‰å¯¹å¼‚å¸¸è¿›è¡Œæ‹¦æˆªå¤„ç†ï¼Œåšä¼šæ‰“å°å‡ºä¸€æ®µè­¦å‘Šä¿¡æ¯ï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultChannelPipeline</span> <span class="keyword">implements</span> <span class="title">ChannelPipeline</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">TailContext</span> <span class="keyword">extends</span> <span class="title">AbstractChannelHandlerContext</span> <span class="keyword">implements</span> <span class="title">ChannelInboundHandler</span> </span>&#123;</span><br><span class="line">       	</span><br><span class="line">        ...</span><br><span class="line">            </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            onUnhandledInboundException(cause);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        ...</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onUnhandledInboundException</span><span class="params">(Throwable cause)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                logger.warn(</span><br><span class="line">                    <span class="string">"An exceptionCaught() event was fired, and it reached at the tail of the pipeline. "</span> +</span><br><span class="line">                    <span class="string">"It usually means the last handler in the pipeline did not handle the exception."</span>,</span><br><span class="line">                    cause);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                ReferenceCountUtil.release(cause);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;    </span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å®é™…çš„åº”ç”¨ä¸­ï¼Œä¸€èˆ¬ä¼šå®šä¸€ä¸ªChannelHandlerï¼Œæ”¾ç½®Pipelineæœ«å°¾ï¼Œä¸“é—¨ç”¨æ¥å¤„ç†ä¸­é€”å‡ºç°çš„å„ç§å¼‚å¸¸ã€‚</p><h4 id="æœ€ä½³å¼‚å¸¸å¤„ç†å®è·µ"><a href="#æœ€ä½³å¼‚å¸¸å¤„ç†å®è·µ" class="headerlink" title="æœ€ä½³å¼‚å¸¸å¤„ç†å®è·µ"></a>æœ€ä½³å¼‚å¸¸å¤„ç†å®è·µ</h4><p>å•ç‹¬å®šä¹‰ExceptionCaughtHandleræ¥å¤„ç†å¼‚å¸¸ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">...</span><br><span class="line">   </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExceptionCaughtHandler</span> <span class="keyword">extends</span> <span class="title">ChannelInboundHandlerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (cause <span class="keyword">instanceof</span> Exception) &#123;</span><br><span class="line">            <span class="comment">// TODO</span></span><br><span class="line">            System.out.println(<span class="string">"Successfully caught exception ! "</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// TODO</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">    </span><br><span class="line">ch.pipeline().addLast(<span class="keyword">new</span> ExceptionCaughtHandler());</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">InboundHandlerB.exceptionCaught:ERROR !!!</span><br><span class="line">InboundHandlerC.exceptionCaught:ERROR !!!</span><br><span class="line">OutboundHandlerA.exceptionCaught:ERROR !!!</span><br><span class="line">OutboundHandlerB.exceptionCaught:ERROR !!!</span><br><span class="line">OutboundHandlerC.exceptionCaught:ERROR !!!</span><br><span class="line">Successfully caught exception !  <span class="comment">// æˆåŠŸæ•è·æ—¥å¿—</span></span><br></pre></td></tr></table></figure><h2 id="Pipelineå›é¡¾ä¸æ€»ç»“"><a href="#Pipelineå›é¡¾ä¸æ€»ç»“" class="headerlink" title="Pipelineå›é¡¾ä¸æ€»ç»“"></a>Pipelineå›é¡¾ä¸æ€»ç»“</h2><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å¯¹Pipelineçš„åŸç†çš„è§£æå°±å®Œæˆäº†ã€‚</p><ul><li>Pipelineæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™åˆ›å»ºçš„ï¼Ÿ</li><li>Pipelineæ·»åŠ ä¸åˆ é™¤èŠ‚ç‚¹çš„é€»è¾‘æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ</li><li>nettyæ˜¯å¦‚ä½•åˆ¤æ–­ChannelHandlerç±»å‹çš„ï¼Ÿ</li><li>å¦‚ä½•å¤„ç†ChannelHandlerä¸­æŠ›å‡ºçš„å¼‚å¸¸ï¼Ÿ</li><li>å¯¹äºChannelHandlerçš„æ·»åŠ åº”éµå¾ªä»€ä¹ˆæ ·çš„é¡ºåºï¼Ÿ</li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://coding.imooc.com/class/230.html" target="_blank" rel="noopener">Javaè¯»æºç ä¹‹Nettyæ·±å…¥å‰–æ</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Netty </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Netty Pipelineæºç åˆ†æ(1)]]></title>
      <url>/posts/netty-pipeline-source-analyse-1.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/pexels-photo-1208949.jpeg?imageslim" alt="pexels-photo-1208949"></p><p>å‰é¢ï¼Œæˆ‘ä»¬åˆ†æäº†Netty EventLoopçš„ <a href="https://wangwei.one/posts/netty-nioeventloop-analyse-for-create.html">åˆ›å»º</a> ä¸ <a href="https://wangwei.one/posts/netty-nioeventloop-analyse-for-startup.html">å¯åŠ¨</a> åŸç†ï¼Œæ¥ä¸‹é‡Œæˆ‘ä»¬æ¥åˆ†æNettyä¸­å¦å¤–ä¸¤ä¸ªé‡è¦ç»„ä»¶â€”â€” <strong><a href="https://netty.io/4.1/api/io/netty/channel/ChannelHandler.html" target="_blank" rel="noopener"><em>ChannelHandler</em></a></strong> ä¸ <strong><a href="https://netty.io/4.1/api/io/netty/channel/ChannelPipeline.html" target="_blank" rel="noopener"><em>Pipeline</em></a></strong>ã€‚Nettyä¸­I/Oäº‹ä»¶çš„ä¼ æ’­æœºåˆ¶å‡ç”±å®ƒè´Ÿè´£ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å®ç°çš„ã€‚</p><a id="more"></a><blockquote><p>Nettyç‰ˆæœ¬ï¼š4.1.30</p></blockquote><p>æˆ‘ä»¬å‰é¢åœ¨è®² <a href="https://wangwei.one/posts/netty-channel-source-analyse.html">Channelåˆ›å»º</a> æ—¶ï¼Œåœ¨AbstractChannelçš„æ„é€ å‡½æ•°ä¸­ï¼Œ ä¸€ç¬”å¸¦è¿‡åœ°æåˆ°äº†Pipelineï¼Œç°åœ¨æˆ‘ä»¬æ¥æ·±å…¥åˆ†æä¸€ä¸‹å®ƒçš„åŸç†ã€‚</p><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><h3 id="Netty-channel-lifecycle"><a href="#Netty-channel-lifecycle" class="headerlink" title="Netty channel lifecycle"></a>Netty channel lifecycle</h3><p>å‰é¢ï¼Œæˆ‘ä»¬åœ¨åˆ†æ <a href="https://wangwei.one/posts/netty-channel-source-analyse.html">Netty channel</a> æºç æ—¶ï¼Œåˆ†æäº†Channelçš„åˆ›å»ºã€åˆå§‹åŒ–ã€æ³¨å†Œã€ç»‘å®šè¿‡ç¨‹ã€‚åœ¨Nettyä¸­ï¼Œchannelçš„ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://img.i7years.com/netty/Channel%20lifecycle.png" alt="Channel lifecycle"></p><ul><li>ChannelRegisteredï¼šChannelæ³¨å†Œåˆ°äº†EventLoopä¸Š</li><li>ChannelActiveï¼šChannelæ¿€æ´»ï¼Œè¿æ¥åˆ°äº†è¿œç¨‹æŸä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå¯ä»¥æ”¶å‘æ•°æ®äº†</li><li>ChannelInactiveï¼šæ–­å¼€è¿æ¥</li><li>ChannelUnregisteredï¼šChannelä»EventLoopä¸Šå–æ¶ˆæ³¨å†Œ</li></ul><h3 id="Netty-channelHandler"><a href="#Netty-channelHandler" class="headerlink" title="Netty channelHandler"></a>Netty channelHandler</h3><p>Channel æ¯ä¸€æ¬¡çŠ¶æ€çš„å˜åŒ–ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªå¯¹åº”çš„äº‹ä»¶ï¼Œå¹¶ä¸”éƒ½ä¼šè§¦å‘ <a href="https://netty.io/4.1/api/io/netty/channel/ChannelHandler.html" target="_blank" rel="noopener"><strong><em>ChannelHandler</em></strong></a> ä¸­å¯¹åº”çš„æ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªChannelæˆåŠŸæ³¨å†Œåˆ°EventLoopä¸Šåï¼Œä¼šæœ‰è§¦å‘channelHanndlerä¸­çš„handlerRegistered(â€¦) æ¥å¤„ç†è¯¥äº‹ä»¶ã€‚</p><p><img src="https://img.i7years.com/netty/ChannelHandlerUML.png" alt="ChannelHandlerUML"></p><p>åœ¨ä¸Šé¢çš„ ChannelHandler UMLä¸­ï¼Œæœ€ä¸ºé‡è¦çš„ä¸¤ä¸ªChannelHandlerï¼š</p><ul><li><a href="https://netty.io/4.1/api/io/netty/channel/ChannelInboundHandler.html" target="_blank" rel="noopener">ChannelInboundHandler</a>ï¼šå¤„ç†å…¥ç«™æ•°æ®ä»¥åŠchannelçš„å„ç§çŠ¶æ€å˜åŒ–</li><li><a href="https://netty.io/4.1/api/io/netty/channel/ChannelOutboundHandler.html" target="_blank" rel="noopener">ChannelOutboundHandler</a>ï¼šå¤„ç†å‡ºç«™æ•°æ®å¹¶å…è®¸æ‹¦æˆªæ‰€æœ‰æ“ä½œ</li></ul><h3 id="Netty-ChannelPipeline"><a href="#Netty-ChannelPipeline" class="headerlink" title="Netty ChannelPipeline"></a>Netty ChannelPipeline</h3><p>å‰é¢æˆ‘ä»¬åœ¨åˆ†æChannelåˆ›å»ºè¿‡ç¨‹æ—¶ï¼Œæ¯ä¸€ä¸ªæ–°åˆ›å»ºçš„Channeléƒ½å°†ä¼šè¢«åˆ†é…ä¸€ä¸ªæ–°çš„ChannelPipelineã€‚ChannelPipelineæ˜¯ä¸€ä¸ªæ‹¦æˆªæµç»Channelçš„å…¥ç«™å’Œå‡ºç«™äº‹ä»¶çš„ChannelHandlerå®ä¾‹é“¾ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://img.i7years.com/netty/Channel-Pipeline.png" alt="Channel-Pipeline"></p><p>ä¸€ä¸ª Channel åŒ…å«äº†ä¸€ä¸ª ChannelPipelineï¼ŒChannelPipelineå†…éƒ¨æ˜¯ä¸€ä¸ªåŒå‘çš„é“¾è¡¨ç»“æ„ï¼Œå†…éƒ¨ç”±ä¸€ä¸ªä¸ªçš„ChannelHandlerContextèŠ‚ç‚¹ç»„æˆï¼ŒChannelPipelineæœ‰å¤´å°¾ä¸¤ä¸ªå›ºå®šçš„èŠ‚ç‚¹HeadContextä¸TailContextã€‚ç”¨æˆ·è‡ªå®šçš„ChannelHandlerå°±æ˜¯ç”±ChannelHandlerContextåŒ…è£…æˆPipelineçš„èŠ‚ç‚¹ï¼Œå‚ä¸Channelæ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­æ‰€è§¦å‘çš„å…¥ç«™äº‹ä»¶ä¸å‡ºç«™äº‹ä»¶ä»¥åŠç›¸åº”æ•°æ®æµçš„æ‹¦æˆªå¤„ç†ã€‚</p><p>æ ¹æ®äº‹ä»¶çš„èµ·æºï¼Œäº‹ä»¶å°†ä¼šè¢«ChannelInboundHandler(å…¥ç«™å¤„ç†å™¨)æˆ–è€…ChannelOutboundHandler(å‡ºç«™å¤„ç†å™¨)å¤„ç†ã€‚éšåï¼Œé€šè¿‡è°ƒç”¨ChannelHandlerContextå®ç°ï¼Œå®ƒå°†è¢«è½¬å‘ç»™åŒä¸€è¶…ç±»å‹çš„ä¸‹ä¸€ä¸ªChannelHandlerï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://img.i7years.com/netty/Channel%20Pipeline%20Event%20Flow.png" alt="Channel Pipeline Event Flow"></p><h2 id="Pipeline-UML"><a href="#Pipeline-UML" class="headerlink" title="Pipeline UML"></a>Pipeline UML</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ <em>ChannelPipeline</em> ä»¥åŠ <em>ChannelHandlerContext</em> çš„ç±»å›¾ç»“æ„ï¼Œå®ƒä»¬éƒ½å®ç°äº†<em>ChannelInboundInvoker</em>ä¸<em>ChannelOutboundInvoker</em>æ¥å£ã€‚</p><p><img src="https://img.i7years.com/netty/Netty%20Pipeline%20UML.png" alt="Netty Pipeline UML"></p><h2 id="Pipelineåˆå§‹åŒ–"><a href="#Pipelineåˆå§‹åŒ–" class="headerlink" title="Pipelineåˆå§‹åŒ–"></a>Pipelineåˆå§‹åŒ–</h2><p>AbstractChannelæ„é€ å‡½æ•°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="title">AbstractChannel</span><span class="params">(Channel parent)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.parent = parent;</span><br><span class="line">    id = newId();</span><br><span class="line">    unsafe = newUnsafe();</span><br><span class="line">    <span class="comment">// åˆ›å»ºé»˜è®¤Pipeline</span></span><br><span class="line">    pipeline = newChannelPipeline();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºé»˜è®¤Pipeline</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> DefaultChannelPipeline <span class="title">newChannelPipeline</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DefaultChannelPipeline(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>DefaultChannelPipeline æ„é€ å‡½æ•°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="title">DefaultChannelPipeline</span><span class="params">(Channel channel)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.channel = ObjectUtil.checkNotNull(channel, <span class="string">"channel"</span>);</span><br><span class="line">    succeededFuture = <span class="keyword">new</span> SucceededChannelFuture(channel, <span class="keyword">null</span>);</span><br><span class="line">    voidPromise =  <span class="keyword">new</span> VoidChannelPromise(channel, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®å°¾éƒ¨èŠ‚ç‚¹</span></span><br><span class="line">    tail = <span class="keyword">new</span> TailContext(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">// è®¾ç½®å¤´éƒ¨èŠ‚ç‚¹</span></span><br><span class="line">    head = <span class="keyword">new</span> HeadContext(<span class="keyword">this</span>);</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// å°†tailä¸headä¸²è”èµ·æ¥</span></span><br><span class="line">    head.next = tail;</span><br><span class="line">    tail.prev = head;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Pipelineå…¶å®æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨çš„ç»“æ„ï¼Œåˆšåˆšåˆå§‹åŒ–çš„æ—¶å€™ï¼ŒPipeline(ç®¡é“)ä¸­åªæœ‰ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå¦‚å›¾ï¼š</p><p><img src="https://img.i7years.com/netty/Pipeline%20Init%20Ctx.png" alt="Pipeline Init Ctx"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹ç»„æˆPipelineèŠ‚ç‚¹çš„å¯¹è±¡â€”â€” ChannelHandlerContextã€‚</p><h3 id="ChannelHandlerContext"><a href="#ChannelHandlerContext" class="headerlink" title="ChannelHandlerContext"></a>ChannelHandlerContext</h3><p>ChannelHandlerContext å®ç°äº†AttributeMapã€ChannelInboundInvokerã€ChannelOutboundInvokeræ¥å£ã€‚Pipelineä¸­çš„äº‹ä»¶ä¼ æ’­ï¼Œéƒ½æ˜¯ç”±ChannelHandlerContextè´Ÿè´£ï¼Œå°†å‘ç”Ÿçš„äº‹ä»¶ä»ä¸€ä¸ªèŠ‚ç‚¹ä¼ åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p><h4 id="ChannelHandlerContextæ¥å£"><a href="#ChannelHandlerContextæ¥å£" class="headerlink" title="ChannelHandlerContextæ¥å£"></a>ChannelHandlerContextæ¥å£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ChannelHandlerContext</span> <span class="keyword">extends</span> <span class="title">AttributeMap</span>, <span class="title">ChannelInboundInvoker</span>, <span class="title">ChannelOutboundInvoker</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›ChannelHandlerContextä¸­ç»‘å®šçš„Channel</span></span><br><span class="line">    <span class="function">Channel <span class="title">channel</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›ä¸“ç”¨äºæ‰§è¡Œä»»åŠ¡çš„ EventExecutor</span></span><br><span class="line">    <span class="function">EventExecutor <span class="title">executor</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›ChannelHandlerContextçš„å”¯ä¸€åç§°ã€‚è¯¥åå­—å°†åœ¨ChannelHandlerè¢«æ·»åŠ åˆ°ChannelPipelineæ—¶ä¼šè¢«ç”¨åˆ°ï¼Œä»ChannelPipelineä¸­è®¿é—®æ³¨å†Œçš„ChannelHandleræ—¶ï¼Œä¹Ÿä¼šè¢«ç”¨åˆ°ã€‚</span></span><br><span class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿”å›ChannelHandlerContextä¸­ç»‘å®šçš„ChannelHandler</span></span><br><span class="line">    <span class="function">ChannelHandler <span class="title">handler</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å±äºè¿™ä¸ªChannelHandlerContextçš„ChannelHandlerä»ChannelPipelineç§»é™¤äº†ï¼Œè¿”å›true</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isRemoved</span><span class="params">()</span></span>;</span><br><span class="line">		</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">ChannelHandlerContext <span class="title">fireChannelRegistered</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">ChannelHandlerContext <span class="title">fireChannelUnregistered</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">ChannelHandlerContext <span class="title">fireChannelActive</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">ChannelHandlerContext <span class="title">fireChannelInactive</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">ChannelHandlerContext <span class="title">fireExceptionCaught</span><span class="params">(Throwable cause)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">ChannelHandlerContext <span class="title">fireUserEventTriggered</span><span class="params">(Object evt)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">ChannelHandlerContext <span class="title">fireChannelRead</span><span class="params">(Object msg)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">ChannelHandlerContext <span class="title">fireChannelReadComplete</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">ChannelHandlerContext <span class="title">fireChannelWritabilityChanged</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">ChannelHandlerContext <span class="title">read</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">ChannelHandlerContext <span class="title">flush</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›åˆ†é…çš„ChannelPipeline</span></span><br><span class="line">    <span class="function">ChannelPipeline <span class="title">pipeline</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›ç”¨äºåˆ†é…ByteBufçš„ByteBufAllocator</span></span><br><span class="line">    <span class="function">ByteBufAllocator <span class="title">alloc</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="AttributeMapæ¥å£"><a href="#AttributeMapæ¥å£" class="headerlink" title="AttributeMapæ¥å£"></a>AttributeMapæ¥å£</h4><p>å®ç° AttributeMap æ¥å£ï¼Œè¡¨ç¤ºChannelHandlerContextèŠ‚ç‚¹å¯ä»¥å­˜å‚¨è‡ªå®šä¹‰çš„å±æ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å±æ€§Mapæ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AttributeMap</span> </span>&#123;</span><br><span class="line">    <span class="comment">// é€šè¿‡Keyè·å–å±æ€§</span></span><br><span class="line">    &lt;T&gt; <span class="function">Attribute&lt;T&gt; <span class="title">attr</span><span class="params">(AttributeKey&lt;T&gt; key)</span></span>;</span><br><span class="line">	<span class="comment">// åˆ¤æ–­å±æ€§æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    &lt;T&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">hasAttr</span><span class="params">(AttributeKey&lt;T&gt; key)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ChannelInboundInvokeræ¥å£"><a href="#ChannelInboundInvokeræ¥å£" class="headerlink" title="ChannelInboundInvokeræ¥å£"></a>ChannelInboundInvokeræ¥å£</h4><p>å®ç°ChannelInboundInvokeræ¥å£ï¼Œè¡¨ç¤ºèŠ‚ç‚¹å¯ä»¥ç”¨äºä¼ æ’­å…¥ç«™ç›¸å…³çš„äº‹ä»¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ChannelInboundInvoker</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å½“Channelæ³¨å†Œåˆ°EventLoopä¸Šæ—¶</span></span><br><span class="line">	<span class="comment">// è°ƒç”¨ChannelPipelineä¸­ä¸‹ä¸€ä¸ªChannelInboundHandlerçš„channelRegistered(ChannelHandlerContext)æ–¹æ³• </span></span><br><span class="line">    <span class="function">ChannelInboundInvoker <span class="title">fireChannelRegistered</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// å½“Channelä»EventLoopä¸Šå–æ¶ˆæ³¨å†Œ</span></span><br><span class="line">    <span class="comment">// è°ƒç”¨ChannelPipelineä¸­ä¸‹ä¸€ä¸ªChannelInboundHandlerçš„channelUnregistered(ChannelHandlerContext)æ–¹æ³• </span></span><br><span class="line">    <span class="function">ChannelInboundInvoker <span class="title">fireChannelUnregistered</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// å½“Channelå¤„ç†æ¿€æ´»çŠ¶æ€ï¼Œæ„å‘³ç€è¿æ¥å·²ç»å»ºç«‹</span></span><br><span class="line">    <span class="comment">// è°ƒç”¨ChannelPipelineä¸­ä¸‹ä¸€ä¸ªChannelInboundHandlerçš„channelActive(ChannelHandlerContext)æ–¹æ³• </span></span><br><span class="line">    <span class="function">ChannelInboundInvoker <span class="title">fireChannelActive</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å½“Channelå¤„ç†å¤±æ•ˆçŠ¶æ€ï¼Œæ„å‘³ç€è¿æ¥å·²ç»æ–­å¼€</span></span><br><span class="line">	<span class="comment">// è°ƒç”¨ChannelPipelineä¸­ä¸‹ä¸€ä¸ªChannelInboundHandlerçš„channelInactive(ChannelHandlerContext)æ–¹æ³• </span></span><br><span class="line">    <span class="function">ChannelInboundInvoker <span class="title">fireChannelInactive</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åœ¨pipelineä¸­æŸä¸ªä¸€ä¸ªå…¥ç«™(inbound)æ“ä½œå‡ºç°äº†å¼‚å¸¸</span></span><br><span class="line">	<span class="comment">// è°ƒç”¨ChannelPipelineä¸­ä¸‹ä¸€ä¸ªChannelInboundHandlerçš„exceptionCaught(ChannelHandlerContext)æ–¹æ³• </span></span><br><span class="line">    <span class="function">ChannelInboundInvoker <span class="title">fireExceptionCaught</span><span class="params">(Throwable cause)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ”¶åˆ°ç”¨æˆ·è‡ªå®šä¹‰çš„äº‹ä»¶</span></span><br><span class="line">	<span class="comment">// è°ƒç”¨ChannelPipelineä¸­ä¸‹ä¸€ä¸ªChannelInboundHandlerçš„userEventTriggered(ChannelHandlerContext)æ–¹æ³•</span></span><br><span class="line">    <span class="function">ChannelInboundInvoker <span class="title">fireUserEventTriggered</span><span class="params">(Object event)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Channelæ¥æ”¶åˆ°äº†æ¶ˆæ¯</span></span><br><span class="line">	<span class="comment">// è°ƒç”¨ChannelPipelineä¸­ä¸‹ä¸€ä¸ªChannelInboundHandlerçš„channelRead(ChannelHandlerContext)æ–¹æ³•</span></span><br><span class="line">    <span class="function">ChannelInboundInvoker <span class="title">fireChannelRead</span><span class="params">(Object msg)</span></span>;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// è°ƒç”¨ChannelPipelineä¸­ä¸‹ä¸€ä¸ªChannelInboundHandlerçš„channelReadComplete(ChannelHandlerContext)æ–¹æ³•</span></span><br><span class="line">    <span class="function">ChannelInboundInvoker <span class="title">fireChannelReadComplete</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// è°ƒç”¨ChannelPipelineä¸­ä¸‹ä¸€ä¸ªChannelInboundHandlerçš„channelWritabilityChanged(ChannelHandlerContext)æ–¹æ³•</span></span><br><span class="line">    <span class="function">ChannelInboundInvoker <span class="title">fireChannelWritabilityChanged</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ChannelOutboundInvokeræ¥å£"><a href="#ChannelOutboundInvokeræ¥å£" class="headerlink" title="ChannelOutboundInvokeræ¥å£"></a>ChannelOutboundInvokeræ¥å£</h4><p>å®ç°ChannelOutboundInvokeræ¥å£ï¼Œæ„å‘³ç€èŠ‚ç‚¹å¯ä»¥ç”¨æ¥å¤„ç†å‡ºç«™ç›¸å…³çš„äº‹ä»¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ChannelOutboundInvoker</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// å°†Channelç»‘å®šåˆ°ä¸€ä¸ªæœ¬åœ°åœ°å€ï¼Œè¿™å°†è°ƒç”¨ChannelPipelineä¸­çš„ä¸‹ä¸€ä¸ªChannelOutboundHandlerçš„bind(ChannelHandlerContext, Socket- Address, ChannelPromise)æ–¹æ³•</span></span><br><span class="line">    <span class="function">ChannelFuture <span class="title">bind</span><span class="params">(SocketAddress localAddress)</span></span>;</span><br><span class="line">	<span class="function">ChannelFuture <span class="title">bind</span><span class="params">(SocketAddress localAddress, ChannelPromise promise)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†Channelè¿æ¥åˆ°ä¸€ä¸ªè¿œç¨‹åœ°å€ï¼Œè¿™å°†è°ƒç”¨ChannelPipelineä¸­çš„ä¸‹ä¸€ä¸ªChannelOutboundHandlerçš„connect(ChannelHandlerContext, Socket- Address, ChannelPromise)æ–¹æ³•</span></span><br><span class="line">    <span class="function">ChannelFuture <span class="title">connect</span><span class="params">(SocketAddress remoteAddress)</span></span>;</span><br><span class="line">    <span class="function">ChannelFuture <span class="title">connect</span><span class="params">(SocketAddress remoteAddress, ChannelPromise promise)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ChannelFuture <span class="title">connect</span><span class="params">(SocketAddress remoteAddress, SocketAddress localAddress)</span></span>;</span><br><span class="line">	<span class="function">ChannelFuture <span class="title">connect</span><span class="params">(SocketAddress remoteAddress, SocketAddress localAddress, ChannelPromise promise)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†Channelæ–­å¼€è¿æ¥ã€‚è¿™å°†è°ƒç”¨ChannelPipelineä¸­çš„ä¸‹ä¸€ä¸ªChannelOutbound- Handlerçš„disconnect(ChannelHandlerContext, Channel Promise)æ–¹æ³•</span></span><br><span class="line">    <span class="function">ChannelFuture <span class="title">disconnect</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">ChannelFuture <span class="title">disconnect</span><span class="params">(ChannelPromise promise)</span></span>;</span><br><span class="line"></span><br><span class="line">   	<span class="comment">// å°†Channelå…³é—­ã€‚è¿™å°†è°ƒç”¨ChannelPipelineä¸­çš„ä¸‹ä¸€ä¸ªChannelOutbound- Handlerçš„close(ChannelHandlerContext, ChannelPromise)æ–¹æ³•</span></span><br><span class="line">    <span class="function">ChannelFuture <span class="title">close</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">ChannelFuture <span class="title">close</span><span class="params">(ChannelPromise promise)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†Channelä»å®ƒå…ˆå‰æ‰€åˆ†é…çš„EventExecutorï¼ˆå³EventLoopï¼‰ä¸­æ³¨é”€ã€‚è¿™å°†è°ƒç”¨ChannelPipelineä¸­çš„ä¸‹ä¸€ä¸ªChannelOutboundHandlerçš„deregister (ChannelHandlerContext, ChannelPromise)æ–¹æ³•</span></span><br><span class="line">    <span class="function">ChannelFuture <span class="title">deregister</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">ChannelFuture <span class="title">deregister</span><span class="params">(ChannelPromise promise)</span></span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// è¯·æ±‚ä»Channelä¸­è¯»å–æ›´å¤šçš„æ•°æ®ã€‚è¿™å°†è°ƒç”¨ChannelPipelineä¸­çš„ä¸‹ä¸€ä¸ªChannelOutboundHandlerçš„read(ChannelHandlerContext)æ–¹æ³•</span></span><br><span class="line">    <span class="function">ChannelOutboundInvoker <span class="title">read</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// å°†æ¶ˆæ¯å†™å…¥Channelã€‚è¿™å°†è°ƒç”¨ChannelPipelineä¸­çš„ä¸‹ä¸€ä¸ªChannel- OutboundHandlerçš„write(ChannelHandlerContext, Object msg, Channel- Promise)æ–¹æ³•ã€‚æ³¨æ„ï¼šè¿™å¹¶ä¸ä¼šå°†æ¶ˆæ¯å†™å…¥åº•å±‚çš„Socketï¼Œè€Œåªä¼šå°†å®ƒæ”¾å…¥é˜Ÿåˆ—ä¸­ã€‚è¦å°†å®ƒå†™å…¥Socketï¼Œéœ€è¦è°ƒç”¨flush()æˆ–è€…writeAndFlush()æ–¹æ³• </span></span><br><span class="line">    <span class="function">ChannelFuture <span class="title">write</span><span class="params">(Object msg)</span></span>;</span><br><span class="line">    <span class="function">ChannelFuture <span class="title">write</span><span class="params">(Object msg, ChannelPromise promise)</span></span>;</span><br><span class="line">	</span><br><span class="line">   <span class="comment">// å†²åˆ·Channelæ‰€æœ‰æŒ‚èµ·çš„å†™å…¥ã€‚è¿™å°†è°ƒç”¨ChannelPipelineä¸­çš„ä¸‹ä¸€ä¸ªChannel- OutboundHandlerçš„flush(ChannelHandlerContext)æ–¹æ³•</span></span><br><span class="line">    <span class="function">ChannelOutboundInvoker <span class="title">flush</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// è¿™æ˜¯ä¸€ä¸ªå…ˆè°ƒç”¨write()æ–¹æ³•å†æ¥ç€è°ƒç”¨flush()æ–¹æ³•çš„ä¾¿åˆ©æ–¹æ³•</span></span><br><span class="line">    <span class="function">ChannelFuture <span class="title">writeAndFlush</span><span class="params">(Object msg, ChannelPromise promise)</span></span>;</span><br><span class="line">    <span class="function">ChannelFuture <span class="title">writeAndFlush</span><span class="params">(Object msg)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ChannelPromise <span class="title">newPromise</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ChannelProgressivePromise <span class="title">newProgressivePromise</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ChannelFuture <span class="title">newSucceededFuture</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ChannelFuture <span class="title">newFailedFuture</span><span class="params">(Throwable cause)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ChannelPromise <span class="title">voidPromise</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="TailContext-amp-HeadContext"><a href="#TailContext-amp-HeadContext" class="headerlink" title="TailContext &amp; HeadContext"></a>TailContext &amp; HeadContext</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹Pipelineä¸­çš„å¤´éƒ¨ä¸å°¾éƒ¨èŠ‚ç‚¹ã€‚</p><h4 id="TailContextèŠ‚ç‚¹"><a href="#TailContextèŠ‚ç‚¹" class="headerlink" title="TailContextèŠ‚ç‚¹"></a>TailContextèŠ‚ç‚¹</h4><p>TailContextæ˜¯å°¾éƒ¨èŠ‚ç‚¹ï¼Œinboundç±»å‹ï¼Œä¸»è¦å¤„ç†Pipelineä¸­æ•°æ®æµçš„æ”¶å°¾å·¥ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">TailContext</span> <span class="keyword">extends</span> <span class="title">AbstractChannelHandlerContext</span> <span class="keyword">implements</span> <span class="title">ChannelInboundHandler</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    TailContext(DefaultChannelPipeline pipeline) &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨AbstractChannelHandlerContextæ„é€ å™¨</span></span><br><span class="line">        <span class="comment">// TailContextæ˜¯ä¸€ä¸ªinbound(å…¥ç«™)èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">super</span>(pipeline, <span class="keyword">null</span>, TAIL_NAME, <span class="keyword">true</span>, <span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">// è®¾ç½®æ·»åŠ å®Œæˆ</span></span><br><span class="line">        setAddComplete();</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// è¿”å›Handlerï¼Œå°±æ˜¯å®ƒè‡ªèº«</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ChannelHandler <span class="title">handler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    ...</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        onUnhandledInboundException(cause);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        onUnhandledInboundMessage(msg);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœpipelineä¸­æœ‰å¼‚å¸¸æ²¡åšå¤„ç†ï¼Œæœ€ç»ˆä¼šç”±TailContextæ‰“èµ¢ä¸€ä¸ªè­¦å‘Šæ—¥å¿—</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onUnhandledInboundException</span><span class="params">(Throwable cause)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        logger.warn(</span><br><span class="line">            <span class="string">"An exceptionCaught() event was fired, and it reached at the tail of the pipeline. "</span> +</span><br><span class="line">            <span class="string">"It usually means the last handler in the pipeline did not handle the exception."</span>,</span><br><span class="line">            cause);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// é‡Šæ”¾å¯¹è±¡</span></span><br><span class="line">        ReferenceCountUtil.release(cause);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœpipelineä¸­æœ‰readæ¶ˆæ¯æ²¡æœ‰å¤„ç†ï¼Œæœ€ç»ˆä¼šç”±TailContextæ‰“èµ¢ä¸€ä¸ªè­¦å‘Šæ—¥å¿—</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onUnhandledInboundMessage</span><span class="params">(Object msg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        logger.debug(</span><br><span class="line">            <span class="string">"Discarded inbound message &#123;&#125; that reached at the tail of the pipeline. "</span> +</span><br><span class="line">            <span class="string">"Please check your pipeline configuration."</span>, msg);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        ReferenceCountUtil.release(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½® ChannelHandlerContext çŠ¶æ€ä¸ºæ·»åŠ å®Œæˆï¼ŒçŠ¶æ€=2</span></span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">setAddComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="keyword">int</span> oldState = handlerState;</span><br><span class="line">        <span class="keyword">if</span> (oldState == REMOVE_COMPLETE || HANDLER_STATE_UPDATER.compareAndSet(<span class="keyword">this</span>, oldState, ADD_COMPLETE)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">       	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="AbstractChannelHandlerContext"><a href="#AbstractChannelHandlerContext" class="headerlink" title="AbstractChannelHandlerContext"></a>AbstractChannelHandlerContext</h4><p>AbstractChannelHandlerContext æ˜¯ ChannelHandlerContext çš„æŠ½è±¡å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractChannelHandlerContext</span> <span class="keyword">extends</span> <span class="title">DefaultAttributeMap</span></span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">ChannelHandlerContext</span>, <span class="title">ResourceLeakHint</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">volatile</span> AbstractChannelHandlerContext next;</span><br><span class="line">    <span class="comment">// ä¸Šä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">volatile</span> AbstractChannelHandlerContext prev;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// æ˜¯å¦ä¸ºinBoundç±»å‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> inbound;</span><br><span class="line">    <span class="comment">// æ˜¯å¦ä¸ºoutboundç±»å‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> outbound;</span><br><span class="line">    <span class="comment">// ç»‘å®šçš„é»˜è®¤pipeline</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DefaultChannelPipeline pipeline;</span><br><span class="line">    <span class="comment">// èŠ‚ç‚¹å</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> ordered;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Will be set to null if no child executor should be used, otherwise it will be set to the</span></span><br><span class="line">    <span class="comment">// child executor.</span></span><br><span class="line">    <span class="keyword">final</span> EventExecutor executor;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    AbstractChannelHandlerContext(DefaultChannelPipeline pipeline, EventExecutor executor, String name,<span class="keyword">boolean</span> inbound, <span class="keyword">boolean</span> outbound) &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®HandlerContextåç§°</span></span><br><span class="line">        <span class="keyword">this</span>.name = ObjectUtil.checkNotNull(name, <span class="string">"name"</span>);</span><br><span class="line">        <span class="comment">// ç»‘å®špipeline</span></span><br><span class="line">        <span class="keyword">this</span>.pipeline = pipeline;</span><br><span class="line">        <span class="comment">// ç»‘å®šexecutor(è¿™é‡Œä¸ºnull)</span></span><br><span class="line">        <span class="keyword">this</span>.executor = executor;</span><br><span class="line">        <span class="comment">// å¦‚æœèŠ‚ç‚¹ä¸ºinboundç±»å‹å°±è®¾ç½®ä¸ºtrue</span></span><br><span class="line">        <span class="keyword">this</span>.inbound = inbound;</span><br><span class="line">        <span class="comment">// å¦‚æœèŠ‚ç‚¹ä¸ºoutboundç±»å‹å°±è®¾ç½®ä¸ºtrue</span></span><br><span class="line">        <span class="keyword">this</span>.outbound = outbound;</span><br><span class="line">        <span class="comment">// Its ordered if its driven by the EventLoop or the given Executor is an instanceof OrderedEventExecutor.</span></span><br><span class="line">        ordered = executor == <span class="keyword">null</span> || executor <span class="keyword">instanceof</span> OrderedEventExecutor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="DefaultChannelHandlerContext"><a href="#DefaultChannelHandlerContext" class="headerlink" title="DefaultChannelHandlerContext"></a>DefaultChannelHandlerContext</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultChannelHandlerContext</span> <span class="keyword">extends</span> <span class="title">AbstractChannelHandlerContext</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChannelHandler handler;</span><br><span class="line">	</span><br><span class="line">    DefaultChannelHandlerContext(</span><br><span class="line">            DefaultChannelPipeline pipeline, EventExecutor executor, String name, ChannelHandler handler) &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨ AbstractChannelHandlerContext æ„é€ å‡½æ•°</span></span><br><span class="line">        <span class="keyword">super</span>(pipeline, executor, name, isInbound(handler), isOutbound(handler));</span><br><span class="line">        <span class="keyword">if</span> (handler == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"handler"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.handler = handler;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ChannelHandler <span class="title">handler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> handler;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ˜¯å¦ä¸ºinBoundç±»å‹</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isInbound</span><span class="params">(ChannelHandler handler)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> handler <span class="keyword">instanceof</span> ChannelInboundHandler;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ˜¯å¦ä¸ºoutBoundç±»å‹</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isOutbound</span><span class="params">(ChannelHandler handler)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> handler <span class="keyword">instanceof</span> ChannelOutboundHandler;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="HeadContext"><a href="#HeadContext" class="headerlink" title="HeadContext"></a>HeadContext</h4><p>HeadContextæ˜¯å¤´éƒ¨èŠ‚ç‚¹ï¼Œoutboundç±»å‹ï¼Œç”¨äºä¼ æ’­äº‹ä»¶å’Œè¿›è¡Œä¸€äº›åº•å±‚socketæ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">HeadContext</span> <span class="keyword">extends</span> <span class="title">AbstractChannelHandlerContext</span></span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">ChannelOutboundHandler</span>, <span class="title">ChannelInboundHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Unsafe unsafe;</span><br><span class="line">	</span><br><span class="line">    HeadContext(DefaultChannelPipeline pipeline) &#123;</span><br><span class="line">		<span class="comment">// è°ƒç”¨AbstractChannelHandlerContextæ„é€ å™¨</span></span><br><span class="line">		<span class="comment">// HeadContextæ˜¯ä¸€ä¸ªoutbound(å‡ºç«™)èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">super</span>(pipeline, <span class="keyword">null</span>, HEAD_NAME, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// è®¾ç½®Unsafeå¯¹è±¡</span></span><br><span class="line">        unsafe = pipeline.channel().unsafe();</span><br><span class="line">        <span class="comment">// è®¾ç½®æ·»åŠ å®Œæˆ</span></span><br><span class="line">        setAddComplete();</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// è¿”å›ChannelHandlerï¼Œå°±åªå®ƒè‡ªèº«</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ChannelHandler <span class="title">handler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bind</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            ChannelHandlerContext ctx, SocketAddress localAddress, ChannelPromise promise)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨ unsafe è¿›è¡Œbindæ“ä½œ    </span></span><br><span class="line">        unsafe.bind(localAddress, promise);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">connect</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            ChannelHandlerContext ctx,</span></span></span><br><span class="line"><span class="function"><span class="params">            SocketAddress remoteAddress, SocketAddress localAddress,</span></span></span><br><span class="line"><span class="function"><span class="params">            ChannelPromise promise)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨ unsafe è¿›è¡Œ connect æ“ä½œ</span></span><br><span class="line">        unsafe.connect(remoteAddress, localAddress, promise);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">disconnect</span><span class="params">(ChannelHandlerContext ctx, ChannelPromise promise)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    	<span class="comment">// è°ƒç”¨ unsafe è¿›è¡Œ disconnect æ“ä½œ</span></span><br><span class="line">        unsafe.disconnect(promise);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(ChannelHandlerContext ctx, ChannelPromise promise)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    	<span class="comment">// è°ƒç”¨ unsafe è¿›è¡Œ close æ“ä½œ</span></span><br><span class="line">        unsafe.close(promise);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deregister</span><span class="params">(ChannelHandlerContext ctx, ChannelPromise promise)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    	<span class="comment">// è°ƒç”¨ unsafe è¿›è¡Œ deregister æ“ä½œ</span></span><br><span class="line">        unsafe.deregister(promise);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(ChannelHandlerContext ctx)</span> </span>&#123;</span><br><span class="line">  	  <span class="comment">// è°ƒç”¨ unsafe è¿›è¡Œ read æ“ä½œ</span></span><br><span class="line">        unsafe.beginRead();</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(ChannelHandlerContext ctx, Object msg, ChannelPromise promise)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    	<span class="comment">// è°ƒç”¨ unsafe è¿›è¡Œ write æ“ä½œ</span></span><br><span class="line">        unsafe.write(msg, promise);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">flush</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    	<span class="comment">// è°ƒç”¨ unsafe è¿›è¡Œ flush æ“ä½œ</span></span><br><span class="line">        unsafe.flush();</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    	<span class="comment">// ä¼ æ’­ExceptionCaughtäº‹ä»¶</span></span><br><span class="line">        ctx.fireExceptionCaught(cause);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRegistered</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        invokeHandlerAddedIfNeeded();</span><br><span class="line">        <span class="comment">// ä¼ æ’­channelRegisteredäº‹ä»¶</span></span><br><span class="line">        ctx.fireChannelRegistered();</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelUnregistered</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// ä¼ æ’­channelUnregisteredäº‹ä»¶</span></span><br><span class="line">        ctx.fireChannelUnregistered();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Remove all handlers sequentially if channel is closed and unregistered.</span></span><br><span class="line">        <span class="keyword">if</span> (!channel.isOpen()) &#123;</span><br><span class="line">            destroy();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelActive</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// ä¼ æ’­ channelActive äº‹ä»¶</span></span><br><span class="line">        ctx.fireChannelActive();</span><br><span class="line">		<span class="comment">// åœ¨ https://wangwei.one/posts/netty-channel-source-analyse.html ä¸­åˆ†æè¿‡äº†</span></span><br><span class="line">		<span class="comment">// ä¸»è¦æ˜¯åœ¨channelæ¿€æ´»ä¹‹åï¼Œå‘åº•å±‚çš„selectoræ³¨å†Œä¸€ä¸ªSelectionKey.OP_ACCEPTç›‘å¬äº‹ä»¶</span></span><br><span class="line">		<span class="comment">// è¿™æ ·channelåœ¨è¿æ¥ä¹‹åï¼Œå°±å¯ä»¥ç›‘å¬åˆ°ä¸€ä¸ªreadäº‹ä»¶</span></span><br><span class="line">        readIfIsAutoRead();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelInactive</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// ä¼ æ’­ channelInactive äº‹ä»¶</span></span><br><span class="line">        ctx.fireChannelInactive();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// ä¼ æ’­ channelRead äº‹ä»¶</span></span><br><span class="line">        ctx.fireChannelRead(msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelReadComplete</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// ä¼ æ’­ channelReadComplete äº‹ä»¶</span></span><br><span class="line">        ctx.fireChannelReadComplete();</span><br><span class="line">		<span class="comment">// </span></span><br><span class="line">        readIfIsAutoRead();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readIfIsAutoRead</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (channel.config().isAutoRead()) &#123;</span><br><span class="line">            channel.read();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">userEventTriggered</span><span class="params">(ChannelHandlerContext ctx, Object evt)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    	<span class="comment">// ä¼ æ’­ userEventTriggered äº‹ä»¶</span></span><br><span class="line">        ctx.fireUserEventTriggered(evt);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelWritabilityChanged</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// ä¼ æ’­ channelWritabilityChanged äº‹ä»¶</span></span><br><span class="line">        ctx.fireChannelWritabilityChanged();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Pipeline-èŠ‚ç‚¹æ·»åŠ "><a href="#Pipeline-èŠ‚ç‚¹æ·»åŠ " class="headerlink" title="Pipeline èŠ‚ç‚¹æ·»åŠ "></a>Pipeline èŠ‚ç‚¹æ·»åŠ </h2><p>ä¸Šé¢æˆ‘ä»¬åˆ†æäº†Pipelineçš„åŸºæœ¬ç»“æ„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹Pipelineæ·»åŠ èŠ‚ç‚¹ï¼ˆä¹Ÿå°±æ˜¯Handlerå¤„ç†å™¨ï¼‰çš„è¿‡ç¨‹ã€‚è¯¥è¿‡ç¨‹ä¸»è¦åˆ†ä¸ºä¸‰æ­¥ï¼š</p><ul><li>åˆ¤æ–­æ˜¯å¦é‡å¤æ·»åŠ </li><li>åˆ›å»ºèŠ‚ç‚¹å¹¶æ·»åŠ è‡³é“¾è¡¨</li><li>å›è°ƒæ·»åŠ å®Œæˆäº‹ä»¶</li></ul><p>ä»¥è¿™æ®µå¸¸è§çš„ä»£ç ä¸ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ServerBootstrap b = <span class="keyword">new</span> ServerBootstrap();</span><br><span class="line">b.group(group)</span><br><span class="line">        .channel(NioServerSocketChannel.class)</span><br><span class="line">        .localAddress(<span class="keyword">new</span> InetSocketAddress(port))</span><br><span class="line">        .option(ChannelOption.SO_KEEPALIVE, Boolean.TRUE)</span><br><span class="line">        .childOption(ChannelOption.CONNECT_TIMEOUT_MILLIS, <span class="number">5000</span>)</span><br><span class="line">        .handler(<span class="keyword">new</span> LoggingHandler(LogLevel.INFO))</span><br><span class="line">        .childHandler(<span class="keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(SocketChannel ch)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="comment">// æ·»åŠ  serverHandler</span></span><br><span class="line">                ch.pipeline().addLast(serverHandler);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">ChannelFuture f = b.bind().sync();</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä» <strong>ChannelPipeline.addLast()</strong> æ–¹æ³•è¿›å»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultChannelPipeline</span> <span class="keyword">implements</span> <span class="title">ChannelPipeline</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    ...</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> ChannelPipeline <span class="title">addLast</span><span class="params">(ChannelHandler... handlers)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> addLast(<span class="keyword">null</span>, handlers);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> ChannelPipeline <span class="title">addLast</span><span class="params">(EventExecutorGroup executor, ChannelHandler... handlers)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (handlers == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"handlers"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¾ªç¯å¤„ç†</span></span><br><span class="line">        <span class="keyword">for</span> (ChannelHandler h: handlers) &#123;</span><br><span class="line">            <span class="keyword">if</span> (h == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            addLast(executor, <span class="keyword">null</span>, h);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> ChannelPipeline <span class="title">addLast</span><span class="params">(EventExecutorGroup group, String name, ChannelHandler handler)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> AbstractChannelHandlerContext newCtx;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">            <span class="comment">// æ£€æŸ¥æ˜¯å¦é‡å¤</span></span><br><span class="line">            checkMultiplicity(handler);</span><br><span class="line">            <span class="comment">// åˆ›å»ºæ–°èŠ‚ç‚¹</span></span><br><span class="line">            newCtx = newContext(group, filterName(name, handler), handler);</span><br><span class="line">            <span class="comment">// æ·»åŠ æ–°èŠ‚ç‚¹</span></span><br><span class="line">            addLast0(newCtx);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å¦‚æœ registered ä¸º false,åˆ™è¡¨ç¤ºè¿™ä¸ªchannelè¿˜æœªæ³¨å†Œåˆ°EventLoopä¸Š.</span></span><br><span class="line">            <span class="comment">// åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªTaskåˆ°PendingHandlerCallbackä¸­ï¼Œ</span></span><br><span class="line">            <span class="comment">// ç­‰åˆ°è¿™ä¸ªchannelæ³¨å†ŒæˆåŠŸä¹‹åï¼Œå°†ä¼šè°ƒç”¨ç«‹å³è°ƒç”¨ ChannelHandler.handlerAdded(...) æ–¹æ³•ï¼Œå·²è¾¾åˆ°channelæ·»åŠ çš„ç›®çš„</span></span><br><span class="line">            <span class="keyword">if</span> (!registered) &#123;</span><br><span class="line">                <span class="comment">// è®¾ç½®ä¸ºå¾…æ·»åŠ çŠ¶æ€</span></span><br><span class="line">                newCtx.setAddPending();</span><br><span class="line">                callHandlerCallbackLater(newCtx, <span class="keyword">true</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">            &#125;</span><br><span class="line">			</span><br><span class="line">            <span class="comment">// è·å–executor</span></span><br><span class="line">            EventExecutor executor = newCtx.executor();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!executor.inEventLoop()) &#123;</span><br><span class="line">                <span class="comment">// è®¾ç½®ä¸ºå¾…æ·»åŠ çŠ¶æ€</span></span><br><span class="line">                newCtx.setAddPending();</span><br><span class="line">                executor.execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        <span class="comment">// å›è°ƒæ·»åŠ å®Œæˆäº‹ä»¶</span></span><br><span class="line">                        callHandlerAdded0(newCtx);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å›è°ƒæ·»åŠ å®Œæˆäº‹ä»¶</span></span><br><span class="line">        callHandlerAdded0(newCtx);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥æ˜¯å¦é‡å¤</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">checkMultiplicity</span><span class="params">(ChannelHandler handler)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// handleræ˜¯å¦ä¸ºChannelHandlerAdapterç±»å‹ï¼Œä¸æ˜¯åˆ™ä¸åšå¤„ç†</span></span><br><span class="line">        <span class="keyword">if</span> (handler <span class="keyword">instanceof</span> ChannelHandlerAdapter) &#123;</span><br><span class="line">            ChannelHandlerAdapter h = (ChannelHandlerAdapter) handler;</span><br><span class="line">            <span class="comment">// åˆ¤æ–­handleræ˜¯å¦æ·»åŠ äº†Sharableæ³¨è§£ &amp;&amp; æ˜¯å¦æ·»åŠ è¿‡äº†</span></span><br><span class="line">            <span class="keyword">if</span> (!h.isSharable() &amp;&amp; h.added) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ChannelPipelineException(</span><br><span class="line">                    h.getClass().getName() +</span><br><span class="line">                    <span class="string">" is not a @Sharable handler, so can't be added or removed multiple times."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            h.added = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºæ–°çš„èŠ‚ç‚¹</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> AbstractChannelHandlerContext <span class="title">newContext</span><span class="params">(EventExecutorGroup group, String name, ChannelHandler handler)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨DefaultChannelHandlerContextçš„æ„é€ å‡½æ•°</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DefaultChannelHandlerContext(<span class="keyword">this</span>, childExecutor(group), name, handler);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨tailèŠ‚ç‚¹ä¹‹å‰æ·»åŠ æ–°èŠ‚ç‚¹</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addLast0</span><span class="params">(AbstractChannelHandlerContext newCtx)</span> </span>&#123;</span><br><span class="line">        AbstractChannelHandlerContext prev = tail.prev;</span><br><span class="line">        newCtx.prev = prev;</span><br><span class="line">        newCtx.next = tail;</span><br><span class="line">        prev.next = newCtx;</span><br><span class="line">        tail.prev = newCtx;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// å›è°ƒChannelHandlerä¸­çš„handlerAddedæ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">callHandlerAdded0</span><span class="params">(<span class="keyword">final</span> AbstractChannelHandlerContext ctx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æˆ‘ä»¬å¿…é¡»åœ¨handlerAddedæ–¹æ³•ä¹‹å‰è°ƒç”¨setAddCompleteæ–¹æ³•ã€‚å¦åˆ™çš„è¯ï¼Œä¸€æ—¦handlerAddedæ–¹æ³•äº§ç”Ÿäº†ä»»ä½•pipelineäº‹ä»¶ï¼Œç”±äºçŠ¶æ€çš„ç¼˜æ•…ï¼Œctx.handler()å°†ä¼šä¸¢å¤±è¿™äº›äº‹ä»¶çš„å¤„ç†ã€‚</span></span><br><span class="line">            <span class="comment">// è®¾ç½®æ–°èŠ‚ç‚¹çš„çŠ¶æ€ä¸ºæ·»åŠ å®ŒæˆçŠ¶æ€</span></span><br><span class="line">            ctx.setAddComplete();</span><br><span class="line">            <span class="comment">// è°ƒç”¨handlerAddedæ¥å£</span></span><br><span class="line">            ctx.handler().handlerAdded(ctx);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            ...</span><br><span class="line">            <span class="comment">// å¦‚æœæ·»åŠ å¤±è´¥ï¼Œåˆ™åˆ é™¤æ–°èŠ‚ç‚¹    </span></span><br><span class="line">            remove0(ctx);</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥çœ‹ä¸‹setAddComplete()æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractChannelHandlerContext</span> <span class="keyword">extends</span> <span class="title">DefaultAttributeMap</span></span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">ChannelHandlerContext</span>, <span class="title">ResourceLeakHint</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// é€šè¿‡è‡ªæ—‹æ“ä½œï¼Œè®¾ç½®çŠ¶æ€ä¸ºADD_COMPLETE</span></span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">setAddComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="keyword">int</span> oldState = handlerState;</span><br><span class="line">            <span class="comment">// Ensure we never update when the handlerState is REMOVE_COMPLETE already.</span></span><br><span class="line">            <span class="comment">// oldState is usually ADD_PENDING but can also be REMOVE_COMPLETE when an EventExecutor is used that is not</span></span><br><span class="line">            <span class="comment">// exposing ordering guarantees.</span></span><br><span class="line">            <span class="keyword">if</span> (oldState == REMOVE_COMPLETE || HANDLER_STATE_UPDATER.compareAndSet(<span class="keyword">this</span>, oldState, ADD_COMPLETE)) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¾ç½®ä¸º ADD_PENDING çŠ¶æ€</span></span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">setAddPending</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> updated = HANDLER_STATE_UPDATER.compareAndSet(<span class="keyword">this</span>, INIT, ADD_PENDING);</span><br><span class="line">        <span class="keyword">assert</span> updated; </span><br><span class="line">        <span class="comment">// This should always be true as it MUST be called before setAddComplete() or setRemoved().</span></span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å›è°ƒç”¨æˆ·è‡ªå®šä¹‰Handlerä¸­çš„handlerAddedæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Sharable</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerHandler</span> <span class="keyword">extends</span> <span class="title">ChannelInboundHandlerAdapter</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">	   </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handlerAdded</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.printf(<span class="string">"ServerHandler added ...."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> 	...</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ChannelInitializer"><a href="#ChannelInitializer" class="headerlink" title="ChannelInitializer"></a>ChannelInitializer</h3><p>å…³äºå›è°ƒChannelHandlerä¸­çš„handlerAdded()æ–¹æ³•ï¼Œæœ€å¸¸è§çš„ä¸€ä¸ªåœºæ™¯å°±æ˜¯ï¼Œä½¿ç”¨ ChannelInitializer æ¥æ·»åŠ æˆ‘ä»¬è‡ªå®šä¹‰çš„ChannelHandlerã€‚ChannelInitializerè¢«æ·»åŠ å®Œæˆä¹‹åï¼Œä¼šå›è°ƒåˆ°å®ƒçš„ initChannel æ–¹æ³•ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹ <strong><em>ChannelInitializer</em></strong> è¿™ä¸ªç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ChannelInboundHandlerï¼Œå®ƒæä¾›äº†ä¸€ç§åœ¨Channelæ³¨å†Œåˆ°EventLoopååˆå§‹åŒ–Channelçš„ç®€ä¾¿æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Sharable</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ChannelInitializer</span>&lt;<span class="title">C</span> <span class="keyword">extends</span> <span class="title">Channel</span>&gt; <span class="keyword">extends</span> <span class="title">ChannelInboundHandlerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> ConcurrentMap&lt;ChannelHandlerContext, Boolean&gt; initMap = PlatformDependent.newConcurrentHashMap();</span><br><span class="line">   </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * å½“ ch æ³¨å†ŒæˆåŠŸä¹‹åï¼Œè¯¥æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ï¼Œè¯¥æ–¹æ³•ç»“æŸè¿”å›ä¹‹åï¼Œæ­¤ChannelInitializerå®ä¾‹å°†ä¼šä»Channelæ‰€ç»‘å®šçš„ChannelPipelineä¸­ç§»é™¤</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> ch æ‰€æ³¨å†Œçš„Channel</span></span><br><span class="line"><span class="comment">    * </span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(C ch)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">   </span><br><span class="line">   ...</span><br><span class="line">   </span><br><span class="line">   <span class="comment">// ChannelInitializer æ·»åŠ æˆåŠŸåï¼Œä¼šå›è°ƒåˆ°handlerAdded()æ¥å£</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handlerAdded</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ctx.channel().isRegistered()) &#123;</span><br><span class="line">            <span class="comment">// This should always be true with our current DefaultChannelPipeline implementation.</span></span><br><span class="line">            <span class="comment">// The good thing about calling initChannel(...) in handlerAdded(...) is that there will be no ordering</span></span><br><span class="line">            <span class="comment">// surprises if a ChannelInitializer will add another ChannelInitializer. This is as all handlers</span></span><br><span class="line">            <span class="comment">// will be added in the expected order.</span></span><br><span class="line">            initChannel(ctx);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;  </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">initChannel</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// æ ‡è®°ctxä¸ºtrue,ä¸”ä¹‹å‰æ²¡æœ‰æ ‡è®°è¿‡ã€‚é˜²æ­¢é‡å¤æ‰§è¡Œ</span></span><br><span class="line">        <span class="keyword">if</span> (initMap.putIfAbsent(ctx, Boolean.TRUE) == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// è°ƒç”¨initChannelæ–¹æ³•</span></span><br><span class="line">                initChannel((C) ctx.channel());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable cause) &#123;</span><br><span class="line">                <span class="comment">// Explicitly call exceptionCaught(...) as we removed the handler before calling initChannel(...).</span></span><br><span class="line">                <span class="comment">// We do so to prevent multiple calls to initChannel(...).</span></span><br><span class="line">                exceptionCaught(ctx, cause);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">// æœ€ç»ˆä¼šåˆ é™¤ ChannelInitializer å®ä¾‹</span></span><br><span class="line">                remove(ctx);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ é™¤ ChannelInitializer å®ä¾‹</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(ChannelHandlerContext ctx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è·å– Pipeline</span></span><br><span class="line">            ChannelPipeline pipeline = ctx.pipeline();</span><br><span class="line">            <span class="comment">// ä» Pipeline ä¸­è¿”å› ChannelInitializer å®ä¾‹</span></span><br><span class="line">            <span class="keyword">if</span> (pipeline.context(<span class="keyword">this</span>) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// åˆ é™¤ ChannelInitializer å®ä¾‹</span></span><br><span class="line">                <span class="comment">// åˆ é™¤é€»è¾‘è¯·çœ‹ä¸‹ä¸€å°èŠ‚</span></span><br><span class="line">                pipeline.remove(<span class="keyword">this</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            initMap.remove(ctx);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éå† ChannelHandlerContext èŠ‚ç‚¹æŸ¥è¯¢å‡ºChannelHandlerå®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultChannelPipeline</span> <span class="keyword">implements</span> <span class="title">ChannelPipeline</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é€šè¿‡handlerè·å–ChannelHandlerContext</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> ChannelHandlerContext <span class="title">context</span><span class="params">(ChannelHandler handler)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (handler == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"handler"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">				</span><br><span class="line">        AbstractChannelHandlerContext ctx = head.next;</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (ctx == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (ctx.handler() == handler) &#123;</span><br><span class="line">                <span class="keyword">return</span> ctx;</span><br><span class="line">            &#125;</span><br><span class="line">            ctx = ctx.next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Pipelineä¸­é™¤äº†addLastæ–¹æ³•å¤–ï¼Œ è¿˜æœ‰addFirstã€addBeforeã€addAfterç­‰æ–¹æ³•ï¼Œé€»è¾‘ç±»ä¼¼ï¼Œå¯ä»¥è‡ªè¡Œç ”ç©¶å­¦ä¹ ã€‚</p><h2 id="Pipeline-èŠ‚ç‚¹åˆ é™¤"><a href="#Pipeline-èŠ‚ç‚¹åˆ é™¤" class="headerlink" title="Pipeline èŠ‚ç‚¹åˆ é™¤"></a>Pipeline èŠ‚ç‚¹åˆ é™¤</h2><p>ä¸Šé¢ï¼Œæˆ‘ä»¬è®²äº†PipelineèŠ‚ç‚¹çš„æ·»åŠ ï¼Œè¿™å°ç»“æˆ‘ä»¬çœ‹çœ‹PipelineèŠ‚ç‚¹çš„åˆ é™¤åŠŸèƒ½ã€‚</p><p>netty æœ‰ä¸ªæœ€å¤§çš„ç‰¹æ€§ä¹‹ä¸€å°±æ˜¯Handlerå¯æ’æ‹”ï¼Œåšåˆ°åŠ¨æ€ç¼–ç»‡pipelineï¼Œæ¯”å¦‚åœ¨é¦–æ¬¡å»ºç«‹è¿æ¥çš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡è¿›è¡Œæƒé™è®¤è¯ï¼Œåœ¨è®¤è¯é€šè¿‡ä¹‹åï¼Œå°±å¯ä»¥å°†æ­¤contextç§»é™¤ï¼Œä¸‹æ¬¡pipelineåœ¨ä¼ æ’­äº‹ä»¶çš„æ—¶å€™å°±å°±ä¸ä¼šè°ƒç”¨åˆ°æƒé™è®¤è¯å¤„ç†å™¨ã€‚</p><p>ä¸‹é¢æ˜¯æƒé™è®¤è¯Handleræœ€ç®€å•çš„å®ç°ï¼Œç¬¬ä¸€ä¸ªæ•°æ®åŒ…ä¼ æ¥çš„æ˜¯è®¤è¯ä¿¡æ¯ï¼Œå¦‚æœæ ¡éªŒé€šè¿‡ï¼Œå°±åˆ é™¤æ­¤Handlerï¼Œå¦åˆ™ï¼Œç›´æ¥å…³é—­è¿æ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é‰´æƒHandler</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthHandler</span> <span class="keyword">extends</span> <span class="title">SimpleChannelInboundHandler</span>&lt;<span class="title">ByteBuf</span>&gt; </span>&#123;</span><br><span class="line">	</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">channelRead0</span><span class="params">(ChannelHandlerContext ctx, ByteBuf data)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (verify(authDataPacket)) &#123;</span><br><span class="line">            ctx.pipeline().remove(<span class="keyword">this</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ctx.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">verify</span><span class="params">(ByteBuf byteBuf)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handlerRemoved</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"AuthHandler has been removed ! "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥çœ‹çœ‹ DefaultChannelPipeline ä¸­çš„ remove æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultChannelPipeline</span> <span class="keyword">implements</span> <span class="title">ChannelPipeline</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    ...</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// ä»Pipelineä¸­åˆ é™¤ChannelHandler</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> ChannelPipeline <span class="title">remove</span><span class="params">(ChannelHandler handler)</span> </span>&#123;</span><br><span class="line">        remove(getContextOrDie(handler));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// è·å– ChannelHandler ï¼Œè·å–ä¸åˆ°å°±æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> AbstractChannelHandlerContext <span class="title">getContextOrDie</span><span class="params">(ChannelHandler handler)</span> </span>&#123;</span><br><span class="line">        AbstractChannelHandlerContext ctx = (AbstractChannelHandlerContext) context(handler);</span><br><span class="line">        <span class="keyword">if</span> (ctx == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException(handler.getClass().getName());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> ctx;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ é™¤</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> AbstractChannelHandlerContext <span class="title">remove</span><span class="params">(<span class="keyword">final</span> AbstractChannelHandlerContext ctx)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ctxä¸èƒ½ä¸ºheandä¸tail</span></span><br><span class="line">        <span class="keyword">assert</span> ctx != head &amp;&amp; ctx != tail;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">            <span class="comment">// ä»pipelineä¸­åˆ é™¤ChannelHandlerContextèŠ‚ç‚¹</span></span><br><span class="line">            remove0(ctx);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å¦‚æœä¸ºfalseï¼Œåˆ™è¡¨æ˜channelè¿˜æ²¡æœ‰æ³¨å†Œåˆ°eventloopä¸Š</span></span><br><span class="line">            <span class="comment">// åœ¨åˆ é™¤è¿™ç§åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å…ˆæ·»åŠ ä¸€ä¸ªTaskï¼Œä¸€æ—¦channelæ³¨å†ŒæˆåŠŸå°±ä¼šè°ƒç”¨è¿™ä¸ªTaskï¼Œè¿™ä¸ªTaskå°±ä¼šç«‹å³è°ƒç”¨ChannelHandler.handlerRemoved(...)æ–¹æ³•ï¼Œæ¥ä»pipelineä¸­åˆ é™¤contextã€‚</span></span><br><span class="line">            <span class="keyword">if</span> (!registered) &#123;</span><br><span class="line">                callHandlerCallbackLater(ctx, <span class="keyword">false</span>);</span><br><span class="line">                <span class="keyword">return</span> ctx;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            EventExecutor executor = ctx.executor();</span><br><span class="line">            <span class="keyword">if</span> (!executor.inEventLoop()) &#123;</span><br><span class="line">                executor.execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        <span class="comment">// å›è°ƒ handlerRemoved æ–¹æ³•</span></span><br><span class="line">                        callHandlerRemoved0(ctx);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">return</span> ctx;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å›è°ƒ handlerRemoved æ–¹æ³•</span></span><br><span class="line">        callHandlerRemoved0(ctx);</span><br><span class="line">        <span class="keyword">return</span> ctx;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"> 	...</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// åˆ é™¤èŠ‚ç‚¹ ChannelHandlerContext</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">remove0</span><span class="params">(AbstractChannelHandlerContext ctx)</span> </span>&#123;</span><br><span class="line">        AbstractChannelHandlerContext prev = ctx.prev;</span><br><span class="line">        AbstractChannelHandlerContext next = ctx.next;</span><br><span class="line">        prev.next = next;</span><br><span class="line">        next.prev = prev;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">callHandlerRemoved0</span><span class="params">(<span class="keyword">final</span> AbstractChannelHandlerContext ctx)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Notify the complete removal.</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// å›è°ƒ handlerRemoved æ–¹æ³•</span></span><br><span class="line">                <span class="comment">// ä¹Ÿå°±æ˜¯æˆ‘ä»¬å‰é¢ä¾‹å­ AuthHandler ä¸­çš„ handlerRemoved() æ–¹æ³•</span></span><br><span class="line">                ctx.handler().handlerRemoved(ctx);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">// è®¾ç½®ä¸ºctx çŠ¶æ€ä¸º REMOVE_COMPLETE </span></span><br><span class="line">                ctx.setRemoved();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            fireExceptionCaught(<span class="keyword">new</span> ChannelPipelineException(</span><br><span class="line">                    ctx.handler().getClass().getName() + <span class="string">".handlerRemoved() has thrown an exception."</span>, t));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½äº†ï¼Œ åˆ é™¤çš„é€»è¾‘å°±åˆ†æåˆ°è¿™é‡Œäº†ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>è¿™ä¸€è®²æˆ‘ä»¬åˆ†æäº†Pipelineçš„åˆ›å»ºè¿‡ç¨‹ï¼Œäº†è§£Pipelineä¸­çš„é“¾è¡¨ç»“æ„ä»¥åŠæ¯ä¸ªèŠ‚ç‚¹çš„æ•°æ®ç»“æ„ã€‚è¿˜åˆ†æäº†Pipelineæ˜¯å¦‚ä½•æ·»åŠ èŠ‚ç‚¹çš„ï¼Œåˆæ˜¯å¦‚ä½•åˆ é™¤èŠ‚ç‚¹çš„ã€‚<a href="https://wangwei.one/posts/netty-pipeline-source-analyse-2.html">æ¥ä¸‹æ¥</a> ï¼Œæˆ‘ä»¬ä¼šåˆ†æPipelineå¦‚ä½•è¿›è¡Œäº‹ä»¶ä¼ æ’­çš„ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://coding.imooc.com/class/230.html" target="_blank" rel="noopener">Javaè¯»æºç ä¹‹Nettyæ·±å…¥å‰–æ</a></li><li><a href="https://github.com/wangweiX/myBooks/blob/master/computer/netty/Netty%20in%20Action.epub" target="_blank" rel="noopener">ã€ŠNetty in actionã€‹</a></li><li><a href="https://www.jianshu.com/p/6efa9c5fa702" target="_blank" rel="noopener">https://www.jianshu.com/p/6efa9c5fa702</a></li><li><a href="https://juejin.im/post/5bda4cc55188257f630dac07" target="_blank" rel="noopener">https://juejin.im/post/5bda4cc55188257f630dac07</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Netty </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Netty NioEventLoop å¯åŠ¨è¿‡ç¨‹æºç åˆ†æ]]></title>
      <url>/posts/netty-nioeventloop-analyse-for-startup.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/pexels-photo-1293125.jpeg?imageslim" alt="pexels-photo-1293125"></p><p><a href="https://wangwei.one/posts/netty-nioeventloop-analyse-for-create.html">å‰é¢</a> ï¼Œæˆ‘ä»¬åˆ†æäº†NioEventLoopçš„åˆ›å»ºè¿‡ç¨‹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹åˆ†æNioEventLoopçš„å¯åŠ¨å’Œæ‰§è¡Œé€»è¾‘ã€‚</p><a id="more"></a><blockquote><p>Nettyç‰ˆæœ¬ï¼š4.1.30</p></blockquote><h2 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h2><p>åœ¨ä¹‹å‰åˆ†æ <a href="https://wangwei.one/posts/netty-channel-create-init-register-bind-process-analyse.html">Channelç»‘å®š</a> çš„æ–‡ç« ä¸­ï¼Œæåˆ°è¿‡ä¸‹é¢è¿™æ®µä»£ç ï¼Œå…ˆå‰åªè®²äº† channel.bind() ç»‘å®šé€»è¾‘ï¼Œè·³è¿‡äº†execute() æ¥å£ï¼Œç°åœ¨æˆ‘ä»¬ä»¥è¿™ä¸ªä¸ºä¾‹ï¼Œå¼€å§‹åˆ†æNioEventLoopçš„execute()æ¥å£ï¼Œä¸»è¦é€»è¾‘å¦‚ä¸‹ï¼š</p><ul><li>æ·»åŠ ä»»åŠ¡é˜Ÿåˆ—</li><li>ç»‘å®šå½“å‰çº¿ç¨‹åˆ°EventLoopä¸Š</li><li>è°ƒç”¨EventLoopçš„run()æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">doBind0</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">final</span> ChannelFuture regFuture, <span class="keyword">final</span> Channel channel,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">final</span> SocketAddress localAddress, <span class="keyword">final</span> ChannelPromise promise)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡eventLoopæ¥æ‰§è¡Œchannelç»‘å®šçš„Task</span></span><br><span class="line">    channel.eventLoop().execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (regFuture.isSuccess()) &#123;</span><br><span class="line">                <span class="comment">// channelç»‘å®š</span></span><br><span class="line">                channel.bind(localAddress, promise).addListener(ChannelFutureListener.CLOSE_ON_FAILURE);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                promise.setFailure(regFuture.cause());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾€ä¸‹è¿½è¸ªåˆ° SingleThreadEventExecutor ä¸­ execute æ¥å£ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable task)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (task == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"task"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­å½“å‰è¿è¡Œæ—¶çº¿ç¨‹æ˜¯å¦ä¸EventLoopä¸­ç»‘å®šçš„çº¿ç¨‹ä¸€è‡´</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œè¿˜æœªç»‘å®šThreadï¼Œæ‰€ä»¥å…ˆè¿”å›false</span></span><br><span class="line">    <span class="keyword">boolean</span> inEventLoop = inEventLoop();</span><br><span class="line">    <span class="comment">// å°†ä»»åŠ¡æ·»åŠ ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å‰é¢è®²EventLoopåˆ›å»ºæ—¶å€™æåˆ°çš„ MpscQueue.</span></span><br><span class="line">    addTask(task);</span><br><span class="line">    <span class="keyword">if</span> (!inEventLoop) &#123;</span><br><span class="line">        <span class="comment">// å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">        startThread();</span><br><span class="line">        <span class="keyword">if</span> (isShutdown() &amp;&amp; removeTask(task)) &#123;</span><br><span class="line">            reject();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!addTaskWakesUp &amp;&amp; wakesUpForTask(task)) &#123;</span><br><span class="line">        wakeup(inEventLoop);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨çº¿ç¨‹æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startThread</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// çŠ¶æ€æ¯”è¾ƒï¼Œæœ€å¼€å§‹æ—¶state = 1 ï¼Œä¸ºtrue</span></span><br><span class="line">    <span class="keyword">if</span> (state == ST_NOT_STARTED) &#123;</span><br><span class="line">        <span class="comment">// csæ“ä½œåï¼ŒstateçŠ¶æ€è®¾ç½®ä¸º 2</span></span><br><span class="line">        <span class="keyword">if</span> (STATE_UPDATER.compareAndSet(<span class="keyword">this</span>, ST_NOT_STARTED, ST_STARTED)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// å¯åŠ¨æ¥å£</span></span><br><span class="line">                doStartThread();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable cause) &#123;</span><br><span class="line">                STATE_UPDATER.set(<span class="keyword">this</span>, ST_NOT_STARTED);</span><br><span class="line">                PlatformDependent.throwException(cause);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œçº¿ç¨‹å¯åŠ¨æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doStartThread</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ–­è¨€åˆ¤æ–­ SingleThreadEventExecutor è¿˜æœªç»‘å®š Thread</span></span><br><span class="line">    <span class="keyword">assert</span> thread == <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">// executor æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">    executor.execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="comment">// å°† SingleThreadEventExecutor(åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­å°±æ˜¯NioEventLoop) ä¸ å½“å‰çº¿ç¨‹è¿›è¡Œç»‘å®š</span></span><br><span class="line">            thread = Thread.currentThread();</span><br><span class="line">            <span class="keyword">if</span> (interrupted) &#123;</span><br><span class="line">                thread.interrupt();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// è®¾ç½®çŠ¶æ€ä¸º false</span></span><br><span class="line">            <span class="keyword">boolean</span> success = <span class="keyword">false</span>;</span><br><span class="line">            <span class="comment">// æ›´æ–°æœ€è¿‘ä¸€æ¬¡ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´</span></span><br><span class="line">            updateLastExecutionTime();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// å¾€ä¸‹è°ƒç”¨ NioEventLoop çš„ run æ–¹æ³•ï¼Œæ‰§è¡Œ</span></span><br><span class="line">                SingleThreadEventExecutor.<span class="keyword">this</span>.run();</span><br><span class="line">                success = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">                logger.warn(<span class="string">"Unexpected exception from an event executor: "</span>, t);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">               </span><br><span class="line">               ...</span><br><span class="line">               </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ‰§è¡Œ"><a href="#æ‰§è¡Œ" class="headerlink" title="æ‰§è¡Œ"></a>æ‰§è¡Œ</h2><p>å¾€ä¸‹è°ƒç”¨åˆ° NioEventLoop ä¸­çš„ run æ–¹æ³•ï¼Œé€šè¿‡æ— é™forå¾ªç¯ï¼Œä¸»è¦åšä»¥ä¸‹ä¸‰ä»¶äº‹æƒ…ï¼š</p><ul><li>è½®å¾ªI/Oäº‹ä»¶ï¼šselect(wakenUp.getAndSet(false))</li><li>å¤„ç†I/Oäº‹ä»¶ï¼šprocessSelectedKeys</li><li>è¿è¡ŒTaskä»»åŠ¡ï¼šrunAllTasks</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">switch</span> (selectStrategy.calculateStrategy(selectNowSupplier, hasTasks())) &#123;</span><br><span class="line">                <span class="keyword">case</span> SelectStrategy.CONTINUE:</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">case</span> SelectStrategy.SELECT:</span><br><span class="line">                    <span class="comment">// è½®è®­æ£€æµ‹I/Oäº‹ä»¶</span></span><br><span class="line">                    <span class="comment">// wakenUpä¸ºäº†æ ‡è®°selectoræ˜¯å¦æ˜¯å”¤é†’çŠ¶æ€ï¼Œæ¯æ¬¡selectæ“ä½œï¼Œéƒ½è®¾ç½®ä¸ºfalseï¼Œä¹Ÿå°±æ˜¯æœªå”¤é†’çŠ¶æ€ã€‚</span></span><br><span class="line">                    select(wakenUp.getAndSet(<span class="keyword">false</span>));</span><br><span class="line">                    <span class="comment">// 'wakenUp.compareAndSet(false, true)' æ€»æ˜¯åœ¨è°ƒç”¨ 'selector.wakeup()' ä¹‹å‰è¿›è¡Œè¯„ä¼°ï¼Œä»¥å‡å°‘å”¤é†’çš„å¼€é”€</span></span><br><span class="line">                    <span class="comment">// (Selector.wakeup() æ˜¯éå¸¸è€—æ€§èƒ½çš„æ“ä½œ.)</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ³•å­˜åœ¨ç«äº‰æ¡ä»¶ã€‚å½“ã€Œwakeupã€å¤ªæ—©è®¾ç½®ä¸ºtrueæ—¶è§¦å‘ç«äº‰æ¡ä»¶</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// åœ¨ä¸‹é¢ä¸¤ç§æƒ…å†µä¸‹ï¼Œã€ŒwakenUpã€ä¼šè¿‡æ—©è®¾ç½®ä¸ºtrueï¼š</span></span><br><span class="line">                    <span class="comment">// 1ï¼‰Selector åœ¨ 'wakenUp.set(false)' ä¸ 'selector.select(...)' ä¹‹é—´è¢«å”¤é†’ã€‚(BAD)</span></span><br><span class="line">                    <span class="comment">// 2ï¼‰Selector åœ¨ 'selector.select(...)' ä¸ 'if (wakenUp.get()) &#123; ... &#125;' ä¹‹é—´è¢«å”¤é†’ã€‚(OK)</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// åœ¨ç¬¬ä¸€ç§æƒ…å†µä¸‹ï¼Œ'wakenUp'è®¾ç½®ä¸ºtrueï¼Œåé¢çš„'selector.selectï¼ˆ...ï¼‰'å°†ç«‹å³å”¤é†’ã€‚ ç›´åˆ°'wakenUp'åœ¨ä¸‹ä¸€è½®ä¸­å†æ¬¡è®¾ç½®ä¸ºfalseï¼Œ'wakenUp.compareAndSetï¼ˆfalseï¼Œtrueï¼‰'å°†å¤±è´¥ï¼Œå› æ­¤ä»»ä½•å”¤é†’é€‰æ‹©å™¨çš„å°è¯•ä¹Ÿå°†å¤±è´¥ï¼Œä»è€Œå¯¼è‡´ä»¥ä¸‹'selector.selectï¼ˆã€‚ ..ï¼‰'å‘¼åé˜»æ­¢ä¸å¿…è¦çš„ã€‚</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¦‚æœåœ¨selector.selectï¼ˆ...ï¼‰æ“ä½œä¹‹åwakenUpç«‹å³ä¸ºtrueï¼Œæˆ‘ä»¬ä¼šå†æ¬¡å”¤é†’selectorã€‚ å®ƒæ˜¯ä½æ•ˆç‡çš„ï¼Œå› ä¸ºå®ƒå”¤é†’äº†ç¬¬ä¸€ç§æƒ…å†µï¼ˆBAD - éœ€è¦å”¤é†’ï¼‰å’Œç¬¬äºŒç§æƒ…å†µï¼ˆOK - ä¸éœ€è¦å”¤é†’ï¼‰çš„é€‰æ‹©å™¨ã€‚</span></span><br><span class="line">                    <span class="keyword">if</span> (wakenUp.get()) &#123;</span><br><span class="line">                        selector.wakeup();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// fall through</span></span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            cancelledKeys = <span class="number">0</span>;</span><br><span class="line">            needsToSelectAgain = <span class="keyword">false</span>;</span><br><span class="line">            <span class="comment">// ioRatio è¡¨ç¤ºå¤„ç†I/Oäº‹ä»¶ä¸æ‰§è¡Œå…·ä½“ä»»åŠ¡äº‹ä»¶ä¹‹é—´æ‰€è€—æ—¶é—´çš„æ¯”å€¼ã€‚</span></span><br><span class="line">            <span class="comment">// ioRatio é»˜è®¤ä¸º50</span></span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> ioRatio = <span class="keyword">this</span>.ioRatio;</span><br><span class="line">            <span class="keyword">if</span> (ioRatio == <span class="number">100</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// å¤„ç†I/Oäº‹ä»¶</span></span><br><span class="line">                    processSelectedKeys();</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="comment">// å¤„ç†ä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line">                    runAllTasks();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// å¤„ç†IOäº‹ä»¶çš„å¼€å§‹æ—¶é—´</span></span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">long</span> ioStartTime = System.nanoTime();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// å¤„ç†I/Oäº‹ä»¶</span></span><br><span class="line">                    processSelectedKeys();</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="comment">// è®°å½•ioæ‰€è€—æ—¶é—´</span></span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">long</span> ioTime = System.nanoTime() - ioStartTime;</span><br><span class="line">                    <span class="comment">// å¤„ç†ä»»åŠ¡é˜Ÿåˆ—ï¼Œè®¾ç½®æœ€å¤§çš„è¶…æ—¶æ—¶é—´</span></span><br><span class="line">                    runAllTasks(ioTime * (<span class="number">100</span> - ioRatio) / ioRatio);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            handleLoopException(t);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Always handle shutdown even if the loop processing threw an exception.</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (isShuttingDown()) &#123;</span><br><span class="line">                closeAll();</span><br><span class="line">                <span class="keyword">if</span> (confirmShutdown()) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            handleLoopException(t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è½®å¾ªæ£€æµ‹I-Oäº‹ä»¶"><a href="#è½®å¾ªæ£€æµ‹I-Oäº‹ä»¶" class="headerlink" title="è½®å¾ªæ£€æµ‹I/Oäº‹ä»¶"></a>è½®å¾ªæ£€æµ‹I/Oäº‹ä»¶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">select</span><span class="params">(<span class="keyword">boolean</span> oldWakenUp)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    Selector selector = <span class="keyword">this</span>.selector;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// selectæ“ä½œè®¡æ•°</span></span><br><span class="line">        <span class="keyword">int</span> selectCnt = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// è®°å½•å½“å‰ç³»ç»Ÿæ—¶é—´</span></span><br><span class="line">        <span class="keyword">long</span> currentTimeNanos = System.nanoTime();</span><br><span class="line">        <span class="comment">// delayNanosæ–¹æ³•ç”¨äºè®¡ç®—å®šæ—¶ä»»åŠ¡é˜Ÿåˆ—ï¼Œæœ€è¿‘ä¸€ä¸ªä»»åŠ¡çš„æˆªæ­¢æ—¶é—´</span></span><br><span class="line">        <span class="comment">// selectDeadLineNanos è¡¨ç¤ºå½“å‰selectæ“ä½œæ‰€ä¸èƒ½è¶…è¿‡çš„æœ€å¤§æˆªæ­¢æ—¶é—´</span></span><br><span class="line">        <span class="keyword">long</span> selectDeadLineNanos = currentTimeNanos + delayNanos(currentTimeNanos);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="comment">// è®¡ç®—è¶…æ—¶æ—¶é—´ï¼Œåˆ¤æ–­æ˜¯å¦è¶…æ—¶</span></span><br><span class="line">            <span class="keyword">long</span> timeoutMillis = (selectDeadLineNanos - currentTimeNanos + <span class="number">500000L</span>) / <span class="number">1000000L</span>;</span><br><span class="line">            <span class="comment">// å¦‚æœ timeoutMillis &lt;= 0ï¼Œ è¡¨ç¤ºè¶…æ—¶ï¼Œè¿›è¡Œä¸€ä¸ªéé˜»å¡çš„ select æ“ä½œã€‚è®¾ç½® selectCnt ä¸º 1. å¹¶ç»ˆæ­¢æœ¬æ¬¡å¾ªç¯ã€‚</span></span><br><span class="line">            <span class="keyword">if</span> (timeoutMillis &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (selectCnt == <span class="number">0</span>) &#123;</span><br><span class="line">                    selector.selectNow();</span><br><span class="line">                    selectCnt = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å½“wakenUpä¸ºtureæ—¶ï¼Œæ°å¥½æœ‰taskè¢«æäº¤ï¼Œè¿™ä¸ªtaskå°†æ— æ³•è·å¾—è°ƒç”¨çš„æœºä¼š</span></span><br><span class="line">            <span class="comment">// Selector#wakeup. å› æ­¤ï¼Œåœ¨æ‰§è¡Œselectæ“ä½œä¹‹å‰ï¼Œéœ€è¦å†æ¬¡æ£€æŸ¥ä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line">            <span class="comment">// å¦‚æœä¸è¿™ä¹ˆåšï¼Œè¿™ä¸ªTaskå°†ä¸€ç›´æŒ‚èµ·ï¼Œç›´åˆ°selectæ“ä½œè¶…æ—¶</span></span><br><span class="line">            <span class="comment">// å¦‚æœ pipeline ä¸­å­˜åœ¨ IdleStateHandler ï¼Œé‚£ä¹ˆTaskå°†ä¸€ç›´æŒ‚èµ·ç›´åˆ° ç©ºé—²è¶…æ—¶ã€‚</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (hasTasks() &amp;&amp; wakenUp.compareAndSet(<span class="keyword">false</span>, <span class="keyword">true</span>)) &#123;</span><br><span class="line">                <span class="comment">// è°ƒç”¨éé˜»å¡æ–¹æ³•</span></span><br><span class="line">                selector.selectNow();</span><br><span class="line">                selectCnt = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¦‚æœå½“å‰ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºï¼Œå¹¶ä¸”è¶…æ—¶æ—¶é—´æœªåˆ°ï¼Œåˆ™è¿›è¡Œä¸€ä¸ªé˜»å¡å¼çš„selectoræ“ä½œã€‚timeoutMillis ä¸ºæœ€å¤§çš„selectæ—¶é—´</span></span><br><span class="line">            <span class="keyword">int</span> selectedKeys = selector.select(timeoutMillis);</span><br><span class="line">            <span class="comment">// æ“ä½œè®¡æ•° +1</span></span><br><span class="line">            selectCnt ++;</span><br><span class="line">			</span><br><span class="line">            <span class="comment">// å­˜åœ¨ä»¥ä¸‹æƒ…å†µï¼Œæœ¬æ¬¡selectoråˆ™ç»ˆæ­¢</span></span><br><span class="line">            <span class="keyword">if</span> (selectedKeys != <span class="number">0</span> || oldWakenUp || wakenUp.get() || hasTasks() || hasScheduledTasks()) &#123;</span><br><span class="line">                <span class="comment">// - è½®è®­åˆ°äº†äº‹ä»¶ï¼ˆSelected something,ï¼‰</span></span><br><span class="line">                <span class="comment">// - è¢«ç”¨æˆ·å”¤é†’ï¼ˆwaken up by user,ï¼‰</span></span><br><span class="line">                <span class="comment">// - å·²æœ‰ä»»åŠ¡é˜Ÿåˆ—ï¼ˆthe task queue has a pending task.ï¼‰</span></span><br><span class="line">                <span class="comment">// - å·²æœ‰å®šæ—¶ä»»åŠ¡ï¼ˆa scheduled task is ready for processingï¼‰</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (Thread.interrupted()) &#123;</span><br><span class="line">                <span class="comment">// Thread was interrupted so reset selected keys and break so we not run into a busy loop.</span></span><br><span class="line">                <span class="comment">// As this is most likely a bug in the handler of the user or it's client library we will</span></span><br><span class="line">                <span class="comment">// also log it.</span></span><br><span class="line">                <span class="comment">//</span></span><br><span class="line">                <span class="comment">// See https://github.com/netty/netty/issues/2426</span></span><br><span class="line">                <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                    logger.debug(<span class="string">"Selector.select() returned prematurely because "</span> +</span><br><span class="line">                            <span class="string">"Thread.currentThread().interrupt() was called. Use "</span> +</span><br><span class="line">                            <span class="string">"NioEventLoop.shutdownGracefully() to shutdown the NioEventLoop."</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                selectCnt = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è®°å½•å½“å‰æ—¶é—´</span></span><br><span class="line">            <span class="keyword">long</span> time = System.nanoTime();</span><br><span class="line">            <span class="comment">// å¦‚æœtime &gt; currentTimeNanos + timeoutMillis(è¶…æ—¶æ—¶é—´)ï¼Œåˆ™è¡¨æ˜å·²ç»æ‰§è¡Œè¿‡ä¸€æ¬¡selectæ“ä½œ</span></span><br><span class="line">            <span class="keyword">if</span> (time - TimeUnit.MILLISECONDS.toNanos(timeoutMillis) &gt;= currentTimeNanos) &#123;</span><br><span class="line">                <span class="comment">// timeoutMillis elapsed without anything selected.</span></span><br><span class="line">                selectCnt = <span class="number">1</span>;</span><br><span class="line">            &#125; </span><br><span class="line">            <span class="comment">// å¦‚æœ time &lt;= currentTimeNanos + timeoutMillisï¼Œè¡¨ç¤ºè§¦å‘äº†ç©ºè½®è®­</span></span><br><span class="line">            <span class="comment">// å¦‚æœç©ºè½®è®­çš„æ¬¡æ•°è¶…è¿‡ SELECTOR_AUTO_REBUILD_THRESHOLD (512)ï¼Œåˆ™é‡å»ºä¸€ä¸ªæ–°çš„selctorï¼Œé¿å…ç©ºè½®è®­</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (SELECTOR_AUTO_REBUILD_THRESHOLD &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">                    selectCnt &gt;= SELECTOR_AUTO_REBUILD_THRESHOLD) &#123;</span><br><span class="line">                <span class="comment">// The selector returned prematurely many times in a row.</span></span><br><span class="line">                <span class="comment">// Rebuild the selector to work around the problem.</span></span><br><span class="line">                logger.warn(</span><br><span class="line">                        <span class="string">"Selector.select() returned prematurely &#123;&#125; times in a row; rebuilding Selector &#123;&#125;."</span>,</span><br><span class="line">                        selectCnt, selector);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// é‡å»ºåˆ›å»ºä¸€ä¸ªæ–°çš„selector</span></span><br><span class="line">                rebuildSelector();</span><br><span class="line">                selector = <span class="keyword">this</span>.selector;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Select again to populate selectedKeys.</span></span><br><span class="line">                <span class="comment">// å¯¹é‡å»ºåçš„selectorè¿›è¡Œä¸€æ¬¡éé˜»å¡è°ƒç”¨ï¼Œç”¨äºè·å–æœ€æ–°çš„selectedKeys</span></span><br><span class="line">                selector.selectNow();</span><br><span class="line">                <span class="comment">// è®¾ç½®selectè®¡æ•°</span></span><br><span class="line">                selectCnt = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            currentTimeNanos = time;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (selectCnt &gt; MIN_PREMATURE_SELECTOR_RETURNS) &#123;</span><br><span class="line">            <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                logger.debug(<span class="string">"Selector.select() returned prematurely &#123;&#125; times in a row for Selector &#123;&#125;."</span>,</span><br><span class="line">                        selectCnt - <span class="number">1</span>, selector);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (CancelledKeyException e) &#123;</span><br><span class="line">        <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">            logger.debug(CancelledKeyException.class.getSimpleName() + <span class="string">" raised by a Selector &#123;&#125; - JDK bug?"</span>,</span><br><span class="line">                    selector, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Harmless exception - log anyway</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„Selector"><a href="#é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„Selector" class="headerlink" title="é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„Selector"></a>é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„Selector</h3><p>è¯¥æ–¹æ³•çš„ä¸»è¦é€»è¾‘å°±æ˜¯ï¼š</p><ul><li>åˆ›å»ºä¸€ä¸ªæ–°çš„selector</li><li>å°†è€çš„selectorä¸Šçš„ selectKeyæ³¨å†Œåˆ°æ–°çš„ selector ä¸Š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rebuildSelector</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!inEventLoop()) &#123;</span><br><span class="line">        execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                rebuildSelector0();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    rebuildSelector0();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡æ–°åˆ›å»ºselector</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rebuildSelector0</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æš‚å­˜è€çš„selector</span></span><br><span class="line">    <span class="keyword">final</span> Selector oldSelector = selector;</span><br><span class="line">    <span class="keyword">final</span> SelectorTuple newSelectorTuple;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (oldSelector == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„ SelectorTuple</span></span><br><span class="line">        <span class="comment">// openSelector()åœ¨ä¹‹å‰åˆ†æè¿‡äº†</span></span><br><span class="line">        newSelectorTuple = openSelector();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        logger.warn(<span class="string">"Failed to create a new Selector."</span>, e);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Register all channels to the new Selector.</span></span><br><span class="line">    <span class="comment">// è®°å½•selectä¸Šæ³¨å†Œçš„channelæ•°é‡</span></span><br><span class="line">    <span class="keyword">int</span> nChannels = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// éå†è€çš„ selector ä¸Šçš„ SelectionKey </span></span><br><span class="line">    <span class="keyword">for</span> (SelectionKey key: oldSelector.keys()) &#123;</span><br><span class="line">        <span class="comment">// è·å– attachmentï¼Œè¿™é‡Œçš„attachmentå°±æ˜¯æˆ‘ä»¬å‰é¢åœ¨è®² Netty Channelæ³¨å†Œæ—¶ï¼Œselectä¼šå°†channelèµ‹å€¼åˆ° attachment å˜é‡ä¸Šã€‚</span></span><br><span class="line">        <span class="comment">// è·å–è€çš„selectorä¸Šæ³¨å†Œçš„channel </span></span><br><span class="line">        Object a = key.attachment();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!key.isValid() || key.channel().keyFor(newSelectorTuple.unwrappedSelector) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">			<span class="comment">// è·å–å…´è¶£é›†</span></span><br><span class="line">            <span class="keyword">int</span> interestOps = key.interestOps();</span><br><span class="line">            <span class="comment">// å–æ¶ˆ SelectionKey</span></span><br><span class="line">            key.cancel();</span><br><span class="line">            <span class="comment">// å°†è€çš„å…´è¶£é›†é‡æ–°æ³¨å†Œåˆ°å‰é¢æ–°åˆ›å»ºçš„selectorä¸Š</span></span><br><span class="line">            SelectionKey newKey = key.channel().register(newSelectorTuple.unwrappedSelector, interestOps, a);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (a <span class="keyword">instanceof</span> AbstractNioChannel) &#123;</span><br><span class="line">                <span class="comment">// Update SelectionKey</span></span><br><span class="line">                ((AbstractNioChannel) a).selectionKey = newKey;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// nChannelsè®¡æ•° + 1</span></span><br><span class="line">            nChannels ++;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.warn(<span class="string">"Failed to re-register a Channel to the new Selector."</span>, e);</span><br><span class="line">            <span class="keyword">if</span> (a <span class="keyword">instanceof</span> AbstractNioChannel) &#123;</span><br><span class="line">                AbstractNioChannel ch = (AbstractNioChannel) a;</span><br><span class="line">                ch.unsafe().close(ch.unsafe().voidPromise());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">                NioTask&lt;SelectableChannel&gt; task = (NioTask&lt;SelectableChannel&gt;) a;</span><br><span class="line">                invokeChannelUnregistered(task, key, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// è®¾ç½®æ–°çš„ selector</span></span><br><span class="line">    selector = newSelectorTuple.selector;</span><br><span class="line">    <span class="comment">// è®¾ç½®æ–°çš„ unwrappedSelector</span></span><br><span class="line">    unwrappedSelector = newSelectorTuple.unwrappedSelector;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// time to close the old selector as everything else is registered to the new one</span></span><br><span class="line">        <span class="comment">// å…³é—­è€çš„seleclor</span></span><br><span class="line">        oldSelector.close();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">        <span class="keyword">if</span> (logger.isWarnEnabled()) &#123;</span><br><span class="line">            logger.warn(<span class="string">"Failed to close the old Selector."</span>, t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (logger.isInfoEnabled()) &#123;</span><br><span class="line">        logger.info(<span class="string">"Migrated "</span> + nChannels + <span class="string">" channel(s) to the new Selector."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¤„ç†I-Oäº‹ä»¶"><a href="#å¤„ç†I-Oäº‹ä»¶" class="headerlink" title="å¤„ç†I/Oäº‹ä»¶"></a>å¤„ç†I/Oäº‹ä»¶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">processSelectedKeysOptimized</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; selectedKeys.size; ++i) &#123;</span><br><span class="line">        <span class="keyword">final</span> SelectionKey k = selectedKeys.keys[i];</span><br><span class="line">        <span class="comment">// null out entry in the array to allow to have it GC'ed once the Channel close</span></span><br><span class="line">        <span class="comment">// See https://github.com/netty/netty/issues/2363</span></span><br><span class="line">        <span class="comment">// è®¾ç½®ä¸ºnullï¼Œæœ‰åˆ©äºGCå›æ”¶</span></span><br><span class="line">        selectedKeys.keys[i] = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">// è·å– SelectionKey ä¸­çš„ attachment, æˆ‘ä»¬è¿™é‡Œå°±æ˜¯ NioChannel</span></span><br><span class="line">        <span class="keyword">final</span> Object a = k.attachment();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (a <span class="keyword">instanceof</span> AbstractNioChannel) &#123;</span><br><span class="line">            <span class="comment">// å¤„ç† SelectedKey</span></span><br><span class="line">            processSelectedKey(k, (AbstractNioChannel) a);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">            NioTask&lt;SelectableChannel&gt; task = (NioTask&lt;SelectableChannel&gt;) a;</span><br><span class="line">            processSelectedKey(k, task);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (needsToSelectAgain) &#123;</span><br><span class="line">            <span class="comment">// null out entries in the array to allow to have it GC'ed once the Channel close</span></span><br><span class="line">            <span class="comment">// See https://github.com/netty/netty/issues/2363</span></span><br><span class="line">            selectedKeys.reset(i + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            selectAgain();</span><br><span class="line">            i = -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç† SelectedKey</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">processSelectedKey</span><span class="params">(SelectionKey k, AbstractNioChannel ch)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è·å–Netty Channelä¸­çš„ NioUnsafe å¯¹è±¡ï¼Œç”¨äºåé¢çš„IOæ“ä½œ</span></span><br><span class="line">    <span class="keyword">final</span> AbstractNioChannel.NioUnsafe unsafe = ch.unsafe();</span><br><span class="line">    <span class="comment">// åˆ¤æ–­ SelectedKey çš„æœ‰æ•ˆæ€§ï¼Œå¦‚æœæ— æ•ˆï¼Œåˆ™ç›´æ¥è¿”å›å¹¶å…³é—­channel</span></span><br><span class="line">    <span class="keyword">if</span> (!k.isValid()) &#123;</span><br><span class="line">        <span class="keyword">final</span> EventLoop eventLoop;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            eventLoop = ch.eventLoop();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable ignored) &#123;</span><br><span class="line">            <span class="comment">// If the channel implementation throws an exception because there is no event loop, we ignore this</span></span><br><span class="line">            <span class="comment">// because we are only trying to determine if ch is registered to this event loop and thus has authority</span></span><br><span class="line">            <span class="comment">// to close ch.</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Only close ch if ch is still registered to this EventLoop. ch could have deregistered from the event loop</span></span><br><span class="line">        <span class="comment">// and thus the SelectionKey could be cancelled as part of the deregistration process, but the channel is</span></span><br><span class="line">        <span class="comment">// still healthy and should not be closed.</span></span><br><span class="line">        <span class="comment">// See https://github.com/netty/netty/issues/5125</span></span><br><span class="line">        <span class="keyword">if</span> (eventLoop != <span class="keyword">this</span> || eventLoop == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// close the channel if the key is not valid anymore</span></span><br><span class="line">        <span class="comment">// å…³é—­channel</span></span><br><span class="line">        unsafe.close(unsafe.voidPromise());</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// è·å– SelectionKey ä¸­æ‰€æœ‰å‡†å¤‡å°±ç»ªçš„æ“ä½œé›†</span></span><br><span class="line">        <span class="keyword">int</span> readyOps = k.readyOps();</span><br><span class="line">        <span class="comment">// We first need to call finishConnect() before try to trigger a read(...) or write(...) as otherwise</span></span><br><span class="line">        <span class="comment">// the NIO JDK channel implementation may throw a NotYetConnectedException.</span></span><br><span class="line">        <span class="comment">// åœ¨è°ƒç”¨å¤„ç†READä¸WRITEäº‹ä»¶ä¹‹é—´ï¼Œå…ˆè°ƒç”¨finishConnect()æ¥å£ï¼Œé¿å…å¼‚å¸¸ NotYetConnectedException å‘ç”Ÿã€‚</span></span><br><span class="line">        <span class="keyword">if</span> ((readyOps &amp; SelectionKey.OP_CONNECT) != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// remove OP_CONNECT as otherwise Selector.select(..) will always return without blocking</span></span><br><span class="line">            <span class="comment">// See https://github.com/netty/netty/issues/924</span></span><br><span class="line">            <span class="keyword">int</span> ops = k.interestOps();</span><br><span class="line">            ops &amp;= ~SelectionKey.OP_CONNECT;</span><br><span class="line">            k.interestOps(ops);</span><br><span class="line"></span><br><span class="line">            unsafe.finishConnect();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Process OP_WRITE first as we may be able to write some queued buffers and so free memory.</span></span><br><span class="line">        <span class="comment">// å¤„ç† WRITE äº‹ä»¶</span></span><br><span class="line">        <span class="keyword">if</span> ((readyOps &amp; SelectionKey.OP_WRITE) != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// Call forceFlush which will also take care of clear the OP_WRITE once there is nothing left to write</span></span><br><span class="line">            ch.unsafe().forceFlush();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Also check for readOps of 0 to workaround possible JDK bug which may otherwise lead</span></span><br><span class="line">        <span class="comment">// to a spin loop</span></span><br><span class="line">        <span class="comment">// å¤„ç† ACCEPT ä¸ READ äº‹ä»¶</span></span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰çš„EventLoopæ˜¯WorkGroupï¼Œåˆ™è¡¨ç¤ºæœ‰ READ äº‹ä»¶</span></span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰çš„EventLoopæ˜¯BossGroupï¼Œåˆ™è¡¨ç¤ºæœ‰ ACCEPT äº‹ä»¶ï¼Œæœ‰æ–°è¿æ¥è¿›æ¥äº†</span></span><br><span class="line">        <span class="keyword">if</span> ((readyOps &amp; (SelectionKey.OP_READ | SelectionKey.OP_ACCEPT)) != <span class="number">0</span> || readyOps == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// è¯»å–æ•°æ®</span></span><br><span class="line">            unsafe.read();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (CancelledKeyException ignored) &#123;</span><br><span class="line">        unsafe.close(unsafe.voidPromise());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å…³äº <code>unsafe.read()</code> çš„åˆ†æï¼Œè¯·çœ‹ <a href="https://wangwei.one/posts/netty-new-connection-acceptor-analyse.html">åæ–‡</a></p></blockquote><h3 id="æ‰§è¡Œæ‰€æœ‰ä»»åŠ¡"><a href="#æ‰§è¡Œæ‰€æœ‰ä»»åŠ¡" class="headerlink" title="æ‰§è¡Œæ‰€æœ‰ä»»åŠ¡"></a>æ‰§è¡Œæ‰€æœ‰ä»»åŠ¡</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬äº†è§£ä¸€ä¸‹æ‰§è¡Œå…·ä½“Taskä»»åŠ¡çš„æ¥å£ï¼šrunAllTasksã€‚åœ¨EventLoopä¸­ï¼Œå¾…æ‰§è¡Œçš„ä»»åŠ¡é˜Ÿåˆ—åˆ†ä¸ºä¸¤ç§ï¼šä¸€ç§æ˜¯æ™®é€šä»»åŠ¡é˜Ÿåˆ—ï¼Œä¸€ç§æ˜¯å®šæ—¶ä»»åŠ¡é˜Ÿåˆ—ã€‚</p><p><a href="https://wangwei.one/posts/netty-nioeventloop-analyse-for-create.html">å‰é¢</a> æˆ‘ä»¬è®² EventLoop åˆ›å»ºæ—¶æåˆ°è¿‡NioEventLoopä¸­ taskQueue çš„åˆ›å»ºï¼Œæ˜¯ä¸€ä¸ªMpscQueueï¼Œå…³äºé«˜æ•ˆç‡çš„MpscQueue åé¢å•ç‹¬å†™æ–‡ç« è¿›è¡Œä»‹ç»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleThreadEventExecutor</span> <span class="keyword">extends</span> <span class="title">AbstractScheduledEventExecutor</span> <span class="keyword">implements</span> <span class="title">OrderedEventExecutor</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// å­˜æ”¾æ™®é€šä»»åŠ¡çš„é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Queue&lt;Runnable&gt; taskQueue;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">SingleThreadEventExecutor</span><span class="params">(EventExecutorGroup parent, Executor executor,</span></span></span><br><span class="line"><span class="function"><span class="params">                                        <span class="keyword">boolean</span> addTaskWakesUp, <span class="keyword">int</span> maxPendingTasks,</span></span></span><br><span class="line"><span class="function"><span class="params">                                        RejectedExecutionHandler rejectedHandler)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(parent);</span><br><span class="line">        <span class="keyword">this</span>.addTaskWakesUp = addTaskWakesUp;</span><br><span class="line">        <span class="keyword">this</span>.maxPendingTasks = Math.max(<span class="number">16</span>, maxPendingTasks);</span><br><span class="line">        <span class="keyword">this</span>.executor = ObjectUtil.checkNotNull(executor, <span class="string">"executor"</span>);</span><br><span class="line">        <span class="comment">// åˆ›å»ºTaskQueue</span></span><br><span class="line">        taskQueue = newTaskQueue(<span class="keyword">this</span>.maxPendingTasks);</span><br><span class="line">        rejectedExecutionHandler = ObjectUtil.checkNotNull(rejectedHandler, <span class="string">"rejectedHandler"</span>);</span><br><span class="line">    &#125;  </span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">NioEventLoop</span> <span class="keyword">extends</span> <span class="title">SingleThreadEventLoop</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// NioEventLoop åˆ›å»ºTaskQueueé˜Ÿåˆ—</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Queue&lt;Runnable&gt; <span class="title">newTaskQueue</span><span class="params">(<span class="keyword">int</span> maxPendingTasks)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// This event loop never calls takeTask()</span></span><br><span class="line">        <span class="keyword">return</span> maxPendingTasks == Integer.MAX_VALUE ? PlatformDependent.&lt;Runnable&gt;newMpscQueue()</span><br><span class="line">                                                    : PlatformDependent.&lt;Runnable&gt;newMpscQueue(maxPendingTasks);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å­˜æ”¾å®šæ—¶ä»»åŠ¡çš„é˜Ÿåˆ—åœ¨ AbstractScheduledEventExecutor ä¸­ï¼Œæˆå‘˜å˜é‡ä¸º scheduledTaskQueueï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractScheduledEventExecutor</span> <span class="keyword">extends</span> <span class="title">AbstractEventExecutor</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// ä¼˜å…ˆçº§é˜Ÿåˆ—çš„æ¯”è¾ƒå™¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Comparator&lt;ScheduledFutureTask&lt;?&gt;&gt; SCHEDULED_FUTURE_TASK_COMPARATOR =</span><br><span class="line">            <span class="keyword">new</span> Comparator&lt;ScheduledFutureTask&lt;?&gt;&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(ScheduledFutureTask&lt;?&gt; o1, ScheduledFutureTask&lt;?&gt; o2)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> o1.compareTo(o2);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// å­˜æ”¾å®šæ—¶ä»»åŠ¡çš„ä¼˜å…ˆçº§é˜Ÿåˆ—</span></span><br><span class="line">    PriorityQueue&lt;ScheduledFutureTask&lt;?&gt;&gt; scheduledTaskQueue;</span><br><span class="line">	<span class="comment">// åˆ›å»ºå®šæ—¶ä»»åŠ¡é˜Ÿåˆ—    </span></span><br><span class="line">    PriorityQueue&lt;ScheduledFutureTask&lt;?&gt;&gt; scheduledTaskQueue() &#123;</span><br><span class="line">        <span class="keyword">if</span> (scheduledTaskQueue == <span class="keyword">null</span>) &#123;</span><br><span class="line">            scheduledTaskQueue = <span class="keyword">new</span> DefaultPriorityQueue&lt;ScheduledFutureTask&lt;?&gt;&gt;(</span><br><span class="line">                    SCHEDULED_FUTURE_TASK_COMPARATOR,</span><br><span class="line">                    <span class="comment">// Use same initial capacity as java.util.PriorityQueue</span></span><br><span class="line">                    <span class="number">11</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> scheduledTaskQueue;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¿å­˜å®šæ—¶ä»»åŠ¡</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ScheduledFuture&lt;?&gt; schedule(Runnable command, <span class="keyword">long</span> delay, TimeUnit unit) &#123;</span><br><span class="line">        ObjectUtil.checkNotNull(command, <span class="string">"command"</span>);</span><br><span class="line">        ObjectUtil.checkNotNull(unit, <span class="string">"unit"</span>);</span><br><span class="line">        <span class="keyword">if</span> (delay &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            delay = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        validateScheduled0(delay, unit);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> schedule(<span class="keyword">new</span> ScheduledFutureTask&lt;Void&gt;(</span><br><span class="line">                <span class="keyword">this</span>, command, <span class="keyword">null</span>, ScheduledFutureTask.deadlineNanos(unit.toNanos(delay))));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¿å­˜å®šæ—¶ä»»åŠ¡</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;V&gt; <span class="function">ScheduledFuture&lt;V&gt; <span class="title">schedule</span><span class="params">(Callable&lt;V&gt; callable, <span class="keyword">long</span> delay, TimeUnit unit)</span> </span>&#123;</span><br><span class="line">        ObjectUtil.checkNotNull(callable, <span class="string">"callable"</span>);</span><br><span class="line">        ObjectUtil.checkNotNull(unit, <span class="string">"unit"</span>);</span><br><span class="line">        <span class="keyword">if</span> (delay &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            delay = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        validateScheduled0(delay, unit);</span><br><span class="line">        <span class="keyword">return</span> schedule(<span class="keyword">new</span> ScheduledFutureTask&lt;V&gt;(</span><br><span class="line">                <span class="keyword">this</span>, callable, ScheduledFutureTask.deadlineNanos(unit.toNanos(delay))));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ä¿å­˜å®šæ—¶ä»»åŠ¡</span></span><br><span class="line"> 	&lt;V&gt; <span class="function">ScheduledFuture&lt;V&gt; <span class="title">schedule</span><span class="params">(<span class="keyword">final</span> ScheduledFutureTask&lt;V&gt; task)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸ºå½“å‰çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">if</span> (inEventLoop()) &#123;</span><br><span class="line">            <span class="comment">// æ·»åŠ å®šæ—¶ä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line">            scheduledTaskQueue().add(task);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="comment">// æ·»åŠ å®šæ—¶ä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line">                    scheduledTaskQueue().add(task);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> task;</span><br><span class="line">  	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Nettyå­˜æ”¾å®šæ—¶ä»»åŠ¡é˜Ÿåˆ—ä¸º <a href="https://netty.io/4.1/xref/io/netty/util/internal/DefaultPriorityQueue.html" target="_blank" rel="noopener">DefaultPriorityQueue</a> ï¼Œå®šæ—¶ä»»åŠ¡çš„å°è£…å¯¹è±¡ä¸º ScheduledFutureTask ï¼Œåœ¨é˜Ÿåˆ—ä¸­çš„ä¼˜å…ˆæŒ‰ç…§å®ƒä»¬çš„æˆªæ­¢æ—¶é—´è¿›è¡Œæ’åºï¼Œå…¶æ¬¡åœ¨æŒ‰ç…§idè¿›è¡Œæ’åºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduledFutureTask</span>&lt;<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">PromiseTask</span>&lt;<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">ScheduledFuture</span>&lt;<span class="title">V</span>&gt;, <span class="title">PriorityQueueNode</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// æ¯”è¾ƒ ScheduledFutureTask ä¹‹é—´çš„æ’åº</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Delayed o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == o) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        ScheduledFutureTask&lt;?&gt; that = (ScheduledFutureTask&lt;?&gt;) o;</span><br><span class="line">        <span class="keyword">long</span> d = deadlineNanos() - that.deadlineNanos();</span><br><span class="line">        <span class="keyword">if</span> (d &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (d &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (id &lt; that.id) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (id == that.id) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Error();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;    </span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æ¥çœ‹çœ‹ä»»åŠ¡çš„æ‰§è¡Œé€»è¾‘ï¼Œé¦–å…ˆå°†å®šæ—¶ä»»åŠ¡å–å‡ºï¼Œèšåˆåˆ°æ™®é€šä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œå†å»forå¾ªç¯è¿è¡Œæ¯ä¸ªTaskã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">runAllTasks</span><span class="params">(<span class="keyword">long</span> timeoutNanos)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å°†å®šæ—¶ä»»åŠ¡ä»å®šæ—¶é˜Ÿåˆ—ä¸­å–å‡ºï¼Œæ”¾å…¥æ™®é€šé˜Ÿåˆ—ä¸­</span></span><br><span class="line">    fetchFromScheduledTaskQueue();</span><br><span class="line">    <span class="comment">// ä»é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡</span></span><br><span class="line">    Runnable task = pollTask();</span><br><span class="line">    <span class="keyword">if</span> (task == <span class="keyword">null</span>) &#123;</span><br><span class="line">        afterRunningAllTasks();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// è®¡ç®—ä»»åŠ¡æ‰§è¡Œçš„æœ€å¤§è¶…æ—¶æ—¶é—´</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">long</span> deadline = ScheduledFutureTask.nanoTime() + timeoutNanos;</span><br><span class="line">    <span class="comment">// ä»»åŠ¡è®¡æ•°</span></span><br><span class="line">    <span class="keyword">long</span> runTasks = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// æœ€è¿‘ä¸€æ¬¡ä»»åŠ¡æ‰§è¡Œçš„æ—¶é—´</span></span><br><span class="line">    <span class="keyword">long</span> lastExecutionTime;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">        safeExecute(task);</span><br><span class="line">		<span class="comment">// ä»»åŠ¡è®¡æ•° +1</span></span><br><span class="line">        runTasks ++;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Check timeout every 64 tasks because nanoTime() is relatively expensive.</span></span><br><span class="line">        <span class="comment">// <span class="doctag">XXX:</span> Hard-coded value - will make it configurable if it is really a problem.</span></span><br><span class="line">        <span class="comment">// ç”±äºnanoTime() æ˜¯éå¸¸å¥½æ€§èƒ½çš„æ“ä½œï¼Œå› æ­¤æ¯64æ¬¡å°±å¯¹æ¯”ä¸€ä¸‹ å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ä¸ deadlineï¼Œ</span></span><br><span class="line">        <span class="comment">// å¦‚æœ lastExecutionTime &gt;= deadlineï¼Œåˆ™è¡¨ç¤ºä»»åŠ¡è¶…æ—¶äº†ï¼Œéœ€è¦ä¸­æ–­é€€å‡º</span></span><br><span class="line">        <span class="keyword">if</span> ((runTasks &amp; <span class="number">0x3F</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            lastExecutionTime = ScheduledFutureTask.nanoTime();</span><br><span class="line">            <span class="keyword">if</span> (lastExecutionTime &gt;= deadline) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">// è·å–ä»»åŠ¡</span></span><br><span class="line">        task = pollTask();</span><br><span class="line">        <span class="keyword">if</span> (task == <span class="keyword">null</span>) &#123;</span><br><span class="line">            lastExecutionTime = ScheduledFutureTask.nanoTime();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    afterRunningAllTasks();</span><br><span class="line">    <span class="comment">// è®°å½•æœ€åä¸€æ¬¡çš„æ‰§è¡Œæ—¶é—´</span></span><br><span class="line">    <span class="keyword">this</span>.lastExecutionTime = lastExecutionTime;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å–å‡ºä»»åŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> Runnable <span class="title">pollTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">assert</span> <span class="title">inEventLoop</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="keyword">return</span> pollTaskFrom(taskQueue);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">static</span> Runnable <span class="title">pollTaskFrom</span><span class="params">(Queue&lt;Runnable&gt; taskQueue)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        Runnable task = taskQueue.poll();</span><br><span class="line">        <span class="keyword">if</span> (task == WAKEUP_TASK) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> task;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†å®šæ—¶ä»»åŠ¡ä»å®šæ—¶é˜Ÿåˆ—ä¸­å–å‡ºï¼Œèšåˆåˆ°æ™®é€šé˜Ÿåˆ—ä¸­ï¼š</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">fetchFromScheduledTaskQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å¾—åˆ°nanoTime = å½“å‰æ—¶é—´ - ScheduledFutureTaskçš„START_TIME(å¼€å§‹æ—¶é—´)</span></span><br><span class="line">    <span class="keyword">long</span> nanoTime = AbstractScheduledEventExecutor.nanoTime();</span><br><span class="line">    <span class="comment">// è·å¾—æˆªæ­¢æ—¶é—´å°äºnanoTimeçš„å®šæ—¶ä»»åŠ¡</span></span><br><span class="line">    Runnable scheduledTask  = pollScheduledTask(nanoTime);</span><br><span class="line">    <span class="keyword">while</span> (scheduledTask != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// å°†å®šæ—¶ä»»åŠ¡æ”¾å…¥æ™®é€šé˜Ÿåˆ—ä¸­ï¼Œä»¥å¤‡è¿è¡Œ</span></span><br><span class="line">        <span class="keyword">if</span> (!taskQueue.offer(scheduledTask)) &#123;</span><br><span class="line">            <span class="comment">// No space left in the task queue add it back to the scheduledTaskQueue so we pick it up again.</span></span><br><span class="line">            <span class="comment">// å¦‚æœ taskQueue æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼Œå¯¼è‡´æ·»åŠ å¤±è´¥ï¼Œåˆ™å°†å…¶è¿”å›å®šæ—¶ä»»åŠ¡é˜Ÿåˆ—ä¸­</span></span><br><span class="line">            scheduledTaskQueue().add((ScheduledFutureTask&lt;?&gt;) scheduledTask);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        scheduledTask  = pollScheduledTask(nanoTime);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å¾—æˆªæ­¢æ—¶é—´å°äºnanoTimeçš„å®šæ—¶ä»»åŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> Runnable <span class="title">pollScheduledTask</span><span class="params">(<span class="keyword">long</span> nanoTime)</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">assert</span> <span class="title">inEventLoop</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">// è·å–å®šæ—¶ä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line">    Queue&lt;ScheduledFutureTask&lt;?&gt;&gt; scheduledTaskQueue = <span class="keyword">this</span>.scheduledTaskQueue;</span><br><span class="line">    <span class="comment">// è·å–ç¬¬ä¸€ä¸ªå®šæ—¶ä»»åŠ¡</span></span><br><span class="line">    ScheduledFutureTask&lt;?&gt; scheduledTask = scheduledTaskQueue == <span class="keyword">null</span> ? <span class="keyword">null</span> : scheduledTaskQueue.peek();</span><br><span class="line">    <span class="keyword">if</span> (scheduledTask == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// å¦‚æœè¯¥å®šæ—¶ä»»åŠ¡çš„æˆªæ­¢æ—¶é—´ &lt;= nanoTime ï¼Œåˆ™è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span> (scheduledTask.deadlineNanos() &lt;= nanoTime) &#123;</span><br><span class="line">        scheduledTaskQueue.remove();</span><br><span class="line">        <span class="keyword">return</span> scheduledTask;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>å¥½äº†ï¼ŒNioEventLoopçš„åŸç†ä»¥åŠå®ƒçš„ <a href="https://wangwei.one/posts/netty-nioeventloop-analyse-for-create.html">åˆ›å»º</a> ä¸ <a href="https://wangwei.one/posts/netty-nioeventloop-analyse-for-startup.html">å¯åŠ¨æ‰§è¡Œ</a> æµç¨‹åˆ°è¿™é‡Œå°±åˆ†æå®Œæ¯•äº†ã€‚å¯åŠ¨æµç¨‹ä¸»è¦æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>å°†å¾…æ‰§è¡Œçš„ä»»åŠ¡æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­</li><li>å°†å½“å‰çº¿ç¨‹ç»‘å®šåˆ°EventLoopä¸Š</li><li>è½®å¾ªI/Oäº‹ä»¶ï¼Œåœ¨è½®å¾ªselectorè¿‡ç¨‹ä¸­ï¼Œä¼šå¯¹JDKçš„ç©ºè½®å¾ªBugåšä¸€ä¸ªå¤„ç†ã€‚</li><li>å¤„ç†I/Oäº‹ä»¶ã€‚</li><li>è¿è¡ŒTaskä»»åŠ¡ã€‚å°†å®šæ—¶ä»»åŠ¡èšåˆåˆ°æ™®é€šä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œç„¶ååœ¨ä¾æ¬¡æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚</li></ul><p>é—®é¢˜ï¼š</p><ul><li>é»˜è®¤æƒ…å†µä¸‹ï¼ŒnettyæœåŠ¡ç«¯å¯åŠ¨å¤šå°‘ä¸ªçº¿ç¨‹ï¼Ÿä½•æ—¶å¯åŠ¨ï¼Ÿ</li><li>nettyæ˜¯å¦‚ä½•è§£å†³ç©ºè½®è®­Bugçš„ï¼Ÿ</li><li>nettyæ˜¯å¦‚ä½•ä¿è¯ä¸²è¡Œæ— é”åŒ–çš„ï¼Ÿ</li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://coding.imooc.com/class/230.html" target="_blank" rel="noopener">Javaè¯»æºç ä¹‹Nettyæ·±å…¥å‰–æ</a></li><li><a href="https://github.com/wangweiX/myBooks/blob/master/computer/netty/Netty%20in%20Action.epub" target="_blank" rel="noopener">ã€ŠNetty in actionã€‹</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Netty </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Netty NioEventLoop åˆ›å»ºè¿‡ç¨‹æºç åˆ†æ]]></title>
      <url>/posts/netty-nioeventloop-analyse-for-create.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/pexels-photo-1266808.jpeg?imageslim" alt="pexels-photo-1266808"></p><p><a href="https://wangwei.one/posts/netty-channel-create-init-register-bind-process-analyse.html">å‰é¢</a> ï¼Œæˆ‘ä»¬åˆ†æäº†Nettyä¸­çš„Channelç»„ä»¶ï¼Œæœ¬ç¯‡æˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹ä¸Channelå…³è”çš„å¦ä¸€ä¸ªæ ¸å¿ƒçš„ç»„ä»¶ â€”â€” <strong>EventLoop</strong>ã€‚</p><a id="more"></a><blockquote><p>Nettyç‰ˆæœ¬ï¼š4.1.30</p></blockquote><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>EventLoopå®šä¹‰äº†Nettyçš„æ ¸å¿ƒæŠ½è±¡ï¼Œç”¨äºå¤„ç†ç½‘ç»œè¿æ¥ç”Ÿå‘½å‘¨æœŸä¸­æ‰€æœ‰å‘ç”Ÿçš„äº‹ä»¶ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥ä»ä¸€ä¸ªæ¯”è¾ƒé«˜çš„è§†è§’æ¥äº†è§£ä¸€ä¸‹Channelsã€Threadã€EventLoopsã€EventLoopGroupsä¹‹é—´çš„å…³ç³»ã€‚</p><p><img src="https://img.i7years.com/netty/Netty%20EventLoop%20Channel.png" alt="Netty-EventLoop-Channel"></p><p>ä¸Šå›¾æ˜¯è¡¨ç¤ºäº†æ‹¥æœ‰4ä¸ªEventLoopçš„EventLoopGroupå¤„ç†IOçš„æµç¨‹å›¾ã€‚å®ƒä»¬ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹ï¼š</p><ul><li>ä¸€ä¸ª EventLoopGroupåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªEventLoop</li><li>ä¸€ä¸ª EventLoopåœ¨å®ƒçš„ç”Ÿå‘½å‘¨æœŸå†…åªå’Œä¸€ä¸ªThreadç»‘å®š</li><li>æ‰€æœ‰ç”±EventLoopå¤„ç†çš„I/Oäº‹ä»¶éƒ½å°†åœ¨å®ƒä¸“æœ‰çš„Threadä¸Šè¢«å¤„ç†</li><li>ä¸€ä¸ªChannelåœ¨å®ƒçš„ç”Ÿå‘½å‘¨æœŸå†…åªæ³¨å†Œäºä¸€ä¸ªEventLoop</li><li>ä¸€ä¸ªEventLoopå¯èƒ½ä¼šè¢«åˆ†é…ç»™ä¸€ä¸ªæˆ–å¤šä¸ªChannel</li></ul><h2 id="EventLoop-åŸç†"><a href="#EventLoop-åŸç†" class="headerlink" title="EventLoop åŸç†"></a>EventLoop åŸç†</h2><p>ä¸‹å›¾æ˜¯Netty EventLoopç›¸å…³ç±»çš„UMLå›¾ã€‚ä»ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°EventLoopç›¸å…³çš„ç±»éƒ½æ˜¯å®ç°äº† <code>java.util.concurrent</code> åŒ…ä¸­çš„ ExecutorService æ¥å£ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥å°†ä»»åŠ¡(Runable æˆ– Callable) æäº¤ç»™EventLoopå»ç«‹å³æ‰§è¡Œæˆ–å®šæ—¶æ‰§è¡Œã€‚</p><p><img src="https://img.i7years.com/netty/Netty%20EventLoop%20UML.png" alt="Netty EventLoop UML"></p><p>ä¾‹å¦‚ï¼Œä½¿ç”¨EventLoopå»æ‰§è¡Œå®šæ—¶ä»»åŠ¡ï¼Œæ ·ä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">scheduleViaEventLoop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Channel ch = <span class="keyword">new</span> NioSocketChannel();</span><br><span class="line">    ScheduledFuture&lt;?&gt; future = ch.eventLoop().schedule(</span><br><span class="line">            () -&gt; System.out.println(<span class="string">"60 seconds later"</span>), <span class="number">60</span>, TimeUnit.SECONDS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Thread-ç®¡ç†"><a href="#Thread-ç®¡ç†" class="headerlink" title="Thread ç®¡ç†"></a>Thread ç®¡ç†</h3><p>Nettyçº¿ç¨‹æ¨¡å‹çš„é«˜æ€§èƒ½ä¸»è¦å–å†³äºå½“å‰æ‰€æ‰§è¡Œçº¿ç¨‹çš„èº«ä»½çš„ç¡®å®šã€‚ä¸€ä¸ªçº¿ç¨‹æäº¤åˆ°EventLoopæ‰§è¡Œçš„æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>å°†Taskä»»åŠ¡æäº¤ç»™EventLoopæ‰§è¡Œ</li><li>åœ¨Taskä¼ é€’åˆ°executeæ–¹æ³•ä¹‹åï¼Œæ£€æŸ¥å½“å‰è¦æ‰§è¡Œçš„Taskçš„çº¿ç¨‹æ˜¯å¦æ˜¯åˆ†é…ç»™EventLoopçš„é‚£ä¸ªçº¿ç¨‹</li><li>å¦‚æœæ˜¯ï¼Œåˆ™è¯¥çº¿ç¨‹ä¼šç«‹å³æ‰§è¡Œ</li><li>å¦‚æœä¸æ˜¯ï¼Œåˆ™å°†çº¿ç¨‹æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡æ‰§è¡Œ</li></ul><p>å…¶ä¸­ï¼ŒNettyä¸­çš„æ¯ä¸€ä¸ªEventLoopéƒ½æœ‰å®ƒè‡ªå·±çš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¹¶ä¸”å’Œå…¶ä»–çš„EventLoopçš„ä»»åŠ¡é˜Ÿåˆ—ç‹¬ç«‹å¼€æ¥ã€‚</p><p><img src="https://img.i7years.com/netty/Netty%20EventLoop%20Thread%20management.png" alt="Nettu EventLoop Thread management"></p><h3 id="Thread-åˆ†é…"><a href="#Thread-åˆ†é…" class="headerlink" title="Thread åˆ†é…"></a>Thread åˆ†é…</h3><p>æœåŠ¡äºChannelçš„I/Oå’Œäº‹ä»¶çš„EventLoopåŒ…å«åœ¨EventLoopGroupä¸­ã€‚æ ¹æ®ä¸åŒçš„ä¼ è¾“å®ç°ï¼ŒEventLoopçš„åˆ›å»ºå’Œåˆ†é…æ–¹å¼ä¹Ÿä¸åŒã€‚</p><h4 id="NIOä¼ è¾“"><a href="#NIOä¼ è¾“" class="headerlink" title="NIOä¼ è¾“"></a>NIOä¼ è¾“</h4><p><img src="https://img.i7years.com/netty/Netty%20EventLoop%20Thread%20allocation%20for%20NIO.png" alt="Netty EventLoop Thread allocation NIO"></p><p>åœ¨NIOä¼ è¾“æ–¹å¼ä¸­ï¼Œä½¿ç”¨å°½å¯èƒ½å°‘çš„EventLoopå°±å¯ä»¥æœåŠ¡å¤šä¸ªChannelã€‚å¦‚å›¾æ‰€ç¤ºï¼ŒEventLoopGroupé‡‡ç”¨é¡ºåºå¾ªç¯çš„æ–¹å¼è´Ÿè´£ä¸ºæ¯ä¸€ä¸ªæ–°åˆ›å»ºçš„Channelåˆ†é…EventLoopï¼Œæ¯ä¸€ä¸ªEventLoopä¼šè¢«åˆ†é…ç»™å¤šä¸ªChannelsã€‚</p><p>ä¸€æ—¦ä¸€ä¸ªChannelè¢«åˆ†é…ç»™äº†ä¸€ä¸ªEventLoopï¼Œåˆ™è¿™ä¸ªChannelçš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œåªä¼šç»‘å®šè¿™ä¸ªEventLoopã€‚è¿™å°±è®©æˆ‘ä»¬åœ¨ChannelHandlerçš„å®ç°çœå»äº†å¯¹çº¿ç¨‹å®‰å…¨å’ŒåŒæ­¥é—®é¢˜çš„æ‹…å¿ƒã€‚</p><h4 id="OIOä¼ è¾“"><a href="#OIOä¼ è¾“" class="headerlink" title="OIOä¼ è¾“"></a>OIOä¼ è¾“</h4><p><img src="https://img.i7years.com/netty/Netty%20EventLoop%20Thread%20allocation%20for%20OIO.png" alt="Netty EventLoop Thread allocation OIO"></p><p>ä¸NIOæ–¹å¼çš„ä¸åŒåœ¨äºï¼Œä¸€ä¸ªEventLoopåªä¼šæœåŠ¡äºä¸€ä¸ªChannelã€‚</p><h2 id="NioEventLoop-amp-NioEventLoopGroup-åˆ›å»º"><a href="#NioEventLoop-amp-NioEventLoopGroup-åˆ›å»º" class="headerlink" title="NioEventLoop &amp; NioEventLoopGroup åˆ›å»º"></a>NioEventLoop &amp; NioEventLoopGroup åˆ›å»º</h2><p>åˆæ­¥äº†è§£äº† EventLoop ä»¥åŠ EventLoopGroup çš„å·¥ä½œæœºåˆ¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä»¥ NioEventLoopGroup ä¸ºä¾‹ï¼Œæ¥æ·±å…¥åˆ†æ NioEventLoopGroup æ˜¯å¦‚ä½•åˆ›å»ºçš„ï¼Œåˆæ˜¯å¦‚ä½•å¯åŠ¨çš„ï¼Œå®ƒçš„å†…éƒ¨æ‰§è¡Œé€»è¾‘åˆæ˜¯æ€æ ·çš„ç­‰ç­‰é—®é¢˜ã€‚</p><h3 id="MultithreadEventExecutorGroup-æ„é€ å™¨"><a href="#MultithreadEventExecutorGroup-æ„é€ å™¨" class="headerlink" title="MultithreadEventExecutorGroup æ„é€ å™¨"></a>MultithreadEventExecutorGroup æ„é€ å™¨</h3><p>æˆ‘ä»¬ä» NioEventLoopGroup çš„æ„é€ å‡½æ•°å¼€å§‹åˆ†æï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EventLoopGroup acceptorEventLoopGroup = <span class="keyword">new</span> NioEventLoopGroup(<span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>NioEventLoopGroupæ„é€ å‡½æ•°ä¼šè°ƒç”¨åˆ°çˆ¶ç±» MultithreadEventLoopGroup çš„æ„é€ å‡½æ•°ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒEventLoopçš„æ•°é‡ = å¤„ç†å™¨æ•°é‡ x 2ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">MultithreadEventLoopGroup</span> <span class="keyword">extends</span> <span class="title">MultithreadEventExecutorGroup</span> <span class="keyword">implements</span> <span class="title">EventLoopGroup</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> InternalLogger logger = InternalLoggerFactory.getInstance(MultithreadEventLoopGroup.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_EVENT_LOOP_THREADS;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é»˜è®¤æƒ…å†µä¸‹ï¼ŒEventLoopçš„æ•°é‡ = å¤„ç†å™¨æ•°é‡ x 2</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        DEFAULT_EVENT_LOOP_THREADS = Math.max(<span class="number">1</span>, SystemPropertyUtil.getInt(</span><br><span class="line">                <span class="string">"io.netty.eventLoopThreads"</span>, NettyRuntime.availableProcessors() * <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">            logger.debug(<span class="string">"-Dio.netty.eventLoopThreads: &#123;&#125;"</span>, DEFAULT_EVENT_LOOP_THREADS);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">MultithreadEventLoopGroup</span><span class="params">(<span class="keyword">int</span> nThreads, Executor executor, Object... args)</span>    </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(nThreads == <span class="number">0</span> ? DEFAULT_EVENT_LOOP_THREADS : nThreads, executor, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­è°ƒç”¨çˆ¶ç±»ï¼Œä¼šè°ƒç”¨åˆ° MultithreadEventExecutorGroup çš„æ„é€ å™¨ï¼Œä¸»è¦åšä¸‰ä»¶äº‹æƒ…ï¼š</p><ul><li>åˆ›å»ºçº¿ç¨‹ä»»åŠ¡æ‰§è¡Œå™¨ ThreadPerTaskExecutor</li><li>é€šè¿‡forå¾ªç¯åˆ›å»ºæ•°é‡ä¸º nThreads ä¸ªçš„ EventLoop</li><li>åˆ›å»º EventLoop é€‰æ‹©å™¨ EventExecutorChooser</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="title">MultithreadEventExecutorGroup</span><span class="params">(<span class="keyword">int</span> nThreads, Executor executor,</span></span></span><br><span class="line"><span class="function"><span class="params">                                        EventExecutorChooserFactory chooserFactory, Object... args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (nThreads &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(String.format(<span class="string">"nThreads: %d (expected: &gt; 0)"</span>, nThreads));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä»»åŠ¡æ‰§è¡Œå™¨ ThreadPerTaskExecutor</span></span><br><span class="line">    <span class="keyword">if</span> (executor == <span class="keyword">null</span>) &#123;</span><br><span class="line">        executor = <span class="keyword">new</span> ThreadPerTaskExecutor(newDefaultThreadFactory());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»º EventExecutor æ•°ç»„</span></span><br><span class="line">    children = <span class="keyword">new</span> EventExecutor[nThreads];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡forå¾ªç¯åˆ›å»ºæ•°é‡ä¸º nThreads ä¸ªçš„ EventLoop</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nThreads; i ++) &#123;</span><br><span class="line">        <span class="keyword">boolean</span> success = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è°ƒç”¨ newChild æ¥å£</span></span><br><span class="line">            children[i] = newChild(executor, args);</span><br><span class="line">            success = <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Think about if this is a good exception type</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"failed to create a child event loop"</span>, e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; i; j ++) &#123;</span><br><span class="line">                    children[j].shutdownGracefully();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; i; j ++) &#123;</span><br><span class="line">                    EventExecutor e = children[j];</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">while</span> (!e.isTerminated()) &#123;</span><br><span class="line">                            e.awaitTermination(Integer.MAX_VALUE, TimeUnit.SECONDS);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException interrupted) &#123;</span><br><span class="line">                        <span class="comment">// Let the caller handle the interruption.</span></span><br><span class="line">                        Thread.currentThread().interrupt();</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// åˆ›å»ºé€‰æ‹©å™¨</span></span><br><span class="line">    chooser = chooserFactory.newChooser(children);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> FutureListener&lt;Object&gt; terminationListener = <span class="keyword">new</span> FutureListener&lt;Object&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operationComplete</span><span class="params">(Future&lt;Object&gt; future)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (terminatedChildren.incrementAndGet() == children.length) &#123;</span><br><span class="line">                terminationFuture.setSuccess(<span class="keyword">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (EventExecutor e: children) &#123;</span><br><span class="line">        e.terminationFuture().addListener(terminationListener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Set&lt;EventExecutor&gt; childrenSet = <span class="keyword">new</span> LinkedHashSet&lt;EventExecutor&gt;(children.length);</span><br><span class="line">    Collections.addAll(childrenSet, children);</span><br><span class="line">    readonlyChildren = Collections.unmodifiableSet(childrenSet);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºçº¿ç¨‹ä»»åŠ¡æ‰§è¡Œå™¨-ThreadPerTaskExecutor"><a href="#åˆ›å»ºçº¿ç¨‹ä»»åŠ¡æ‰§è¡Œå™¨-ThreadPerTaskExecutor" class="headerlink" title="åˆ›å»ºçº¿ç¨‹ä»»åŠ¡æ‰§è¡Œå™¨ ThreadPerTaskExecutor"></a>åˆ›å»ºçº¿ç¨‹ä»»åŠ¡æ‰§è¡Œå™¨ ThreadPerTaskExecutor</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (executor == <span class="keyword">null</span>) &#123;</span><br><span class="line">    executor = <span class="keyword">new</span> ThreadPerTaskExecutor(newDefaultThreadFactory());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çº¿ç¨‹ä»»åŠ¡æ‰§è¡Œå™¨ ThreadPerTaskExecutor æºç å¦‚ä¸‹ï¼Œå…·ä½“çš„ä»»åŠ¡éƒ½ç”± ThreadFactory å»æ‰§è¡Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadPerTaskExecutor</span> <span class="keyword">implements</span> <span class="title">Executor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ThreadFactory threadFactory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThreadPerTaskExecutor</span><span class="params">(ThreadFactory threadFactory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (threadFactory == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"threadFactory"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.threadFactory = threadFactory;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ threadFactory æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable command)</span> </span>&#123;</span><br><span class="line">        threadFactory.newThread(command).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥çœ‹çœ‹ newDefaultThreadFactory æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> ThreadFactory <span class="title">newDefaultThreadFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DefaultThreadFactory(getClass());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="DefaultThreadFactory"><a href="#DefaultThreadFactory" class="headerlink" title="DefaultThreadFactory"></a>DefaultThreadFactory</h4><p>æ¥ä¸‹æ¥çœ‹çœ‹ DefaultThreadFactory è¿™ä¸ªç±»ï¼Œå®ç°äº† ThreadFactory æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ï¼š</p><ul><li>EventLoopGroupçš„å‘½åè§„åˆ™</li><li>å…·ä½“çš„çº¿ç¨‹ä¸º FastThreadLocalThread</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultThreadFactory</span> <span class="keyword">implements</span> <span class="title">ThreadFactory</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// çº¿ç¨‹æ± IDç¼–å·è‡ªå¢å™¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> AtomicInteger poolId = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line">	<span class="comment">// çº¿ç¨‹IDè‡ªå¢å™¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AtomicInteger nextId = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line">    <span class="comment">// çº¿ç¨‹åç§°å‰ç¼€</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String prefix;</span><br><span class="line">    <span class="comment">// æ˜¯å¦ä¸ºå®ˆæŠ¤è¿›ç¨‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> daemon;</span><br><span class="line">    <span class="comment">// çº¿ç¨‹ä¼˜å…ˆçº§</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> priority;</span><br><span class="line">    <span class="comment">// çº¿ç¨‹ç»„</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> ThreadGroup threadGroup;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DefaultThreadFactory</span><span class="params">(Class&lt;?&gt; poolType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(poolType, <span class="keyword">false</span>, Thread.NORM_PRIORITY);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–çº¿ç¨‹åï¼Œè¿”å›ç»“æœï¼šnioEventLoopGroup</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">toPoolName</span><span class="params">(Class&lt;?&gt; poolType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (poolType == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"poolType"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String poolName = StringUtil.simpleClassName(poolType);</span><br><span class="line">        <span class="keyword">switch</span> (poolName.length()) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"unknown"</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> poolName.toLowerCase(Locale.US);</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">if</span> (Character.isUpperCase(poolName.charAt(<span class="number">0</span>)) &amp;&amp; Character.isLowerCase(poolName.charAt(<span class="number">1</span>))) &#123;</span><br><span class="line">                    <span class="keyword">return</span> Character.toLowerCase(poolName.charAt(<span class="number">0</span>)) + poolName.substring(<span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> poolName;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DefaultThreadFactory</span><span class="params">(String poolName, <span class="keyword">boolean</span> daemon, <span class="keyword">int</span> priority, ThreadGroup threadGroup)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (poolName == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"poolName"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (priority &lt; Thread.MIN_PRIORITY || priority &gt; Thread.MAX_PRIORITY) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</span><br><span class="line">                    <span class="string">"priority: "</span> + priority + <span class="string">" (expected: Thread.MIN_PRIORITY &lt;= priority &lt;= Thread.MAX_PRIORITY)"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">// nioEventLoopGroup-2-</span></span><br><span class="line">        prefix = poolName + <span class="string">'-'</span> + poolId.incrementAndGet() + <span class="string">'-'</span>;</span><br><span class="line">        <span class="keyword">this</span>.daemon = daemon;</span><br><span class="line">        <span class="keyword">this</span>.priority = priority;</span><br><span class="line">        <span class="keyword">this</span>.threadGroup = threadGroup;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DefaultThreadFactory</span><span class="params">(String poolName, <span class="keyword">boolean</span> daemon, <span class="keyword">int</span> priority)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(poolName, daemon, priority, System.getSecurityManager() == <span class="keyword">null</span> ?</span><br><span class="line">                Thread.currentThread().getThreadGroup() : System.getSecurityManager().getThreadGroup());</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Thread <span class="title">newThread</span><span class="params">(Runnable r)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºæ–°çº¿ç¨‹ nioEventLoopGroup-2-1</span></span><br><span class="line">        Thread t = newThread(FastThreadLocalRunnable.wrap(r), prefix + nextId.incrementAndGet());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (t.isDaemon() != daemon) &#123;</span><br><span class="line">                t.setDaemon(daemon);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (t.getPriority() != priority) &#123;</span><br><span class="line">                t.setPriority(priority);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ignored) &#123;</span><br><span class="line">            <span class="comment">// Doesn't matter even if failed to set.</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// åˆ›å»ºæ–°çº¿ç¨‹ FastThreadLocalThread</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Thread <span class="title">newThread</span><span class="params">(Runnable r, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FastThreadLocalThread(threadGroup, r, name);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºNioEventLoop"><a href="#åˆ›å»ºNioEventLoop" class="headerlink" title="åˆ›å»ºNioEventLoop"></a>åˆ›å»ºNioEventLoop</h3><p>ç»§ç»­ä» MultithreadEventExecutorGroup æ„é€ å™¨å¼€å§‹ï¼Œåˆ›å»ºå®Œä»»åŠ¡æ‰§è¡Œå™¨ ThreadPerTaskExecutor ä¹‹åï¼Œè¿›å…¥forå¾ªç¯ï¼Œå¼€å§‹åˆ›å»º NioEventLoopï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nThreads; i ++) &#123;</span><br><span class="line">    <span class="keyword">boolean</span> success = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º nioEventLoop</span></span><br><span class="line">        children[i] = newChild(executor, args);</span><br><span class="line">        success = <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Think about if this is a good exception type</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"failed to create a child event loop"</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line"> 	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>NioEventLoopGroupç±»ä¸­çš„ <code>newChild()</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> EventLoop <span class="title">newChild</span><span class="params">(Executor executor, Object... args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> NioEventLoop(<span class="keyword">this</span>, executor, (SelectorProvider) args[<span class="number">0</span>],</span><br><span class="line">        ((SelectStrategyFactory) args[<span class="number">1</span>]).newSelectStrategy(), (RejectedExecutionHandler) args[<span class="number">2</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>NioEventLoop æ„é€ å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">NioEventLoop</span> <span class="keyword">extends</span> <span class="title">SingleThreadEventLoop</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    NioEventLoop(NioEventLoopGroup parent, Executor executor, SelectorProvider selectorProvider, SelectStrategy strategy, RejectedExecutionHandler rejectedExecutionHandler) &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨çˆ¶ç±» SingleThreadEventLoop æ„é€ å™¨</span></span><br><span class="line">        <span class="keyword">super</span>(parent, executor, <span class="keyword">false</span>, DEFAULT_MAX_PENDING_TASKS, rejectedExecutionHandler);</span><br><span class="line">        <span class="keyword">if</span> (selectorProvider == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"selectorProvider"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (strategy == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"selectStrategy"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è®¾ç½® selectorProvider</span></span><br><span class="line">        provider = selectorProvider;</span><br><span class="line">        <span class="comment">// è·å– SelectorTuple å¯¹è±¡ï¼Œé‡Œé¢å°è£…äº†åŸç”Ÿçš„selectorå’Œä¼˜åŒ–è¿‡çš„selector</span></span><br><span class="line">        <span class="keyword">final</span> SelectorTuple selectorTuple = openSelector();</span><br><span class="line">        <span class="comment">// è®¾ç½®ä¼˜åŒ–è¿‡çš„selector</span></span><br><span class="line">        selector = selectorTuple.selector;</span><br><span class="line">        <span class="comment">// è®¾ç½®åŸç”Ÿçš„selector</span></span><br><span class="line">        unwrappedSelector = selectorTuple.unwrappedSelector;</span><br><span class="line">        <span class="comment">// è®¾ç½®selectç­–ç•¥</span></span><br><span class="line">        selectStrategy = strategy;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	...</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹ è·å–å¤šè·¯å¤ç”¨é€‰æ‹©å™¨ æ–¹æ³•â€”â€” openSelector() ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// selectKey ä¼˜åŒ–é€‰é¡¹flag</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">boolean</span> DISABLE_KEYSET_OPTIMIZATION =</span><br><span class="line">    SystemPropertyUtil.getBoolean(<span class="string">"io.netty.noKeySetOptimization"</span>, <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> SelectorTuple <span class="title">openSelector</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// JDKåŸç”Ÿçš„selector</span></span><br><span class="line">    <span class="keyword">final</span> Selector unwrappedSelector;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// é€šè¿‡ SelectorProvider åˆ›å»ºè·å¾—selector</span></span><br><span class="line">        unwrappedSelector = provider.openSelector();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ChannelException(<span class="string">"failed to open a new selector"</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœä¸ä¼˜åŒ–ï¼Œåˆ™ç›´æ¥è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span> (DISABLE_KEYSET_OPTIMIZATION) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SelectorTuple(unwrappedSelector);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡åå°„åˆ›å»º sun.nio.ch.SelectorImpl å¯¹è±¡</span></span><br><span class="line">    Object maybeSelectorImplClass = AccessController.doPrivileged(<span class="keyword">new</span> PrivilegedAction&lt;Object&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> Class.forName(</span><br><span class="line">                        <span class="string">"sun.nio.ch.SelectorImpl"</span>,</span><br><span class="line">                        <span class="keyword">false</span>,</span><br><span class="line">                        PlatformDependent.getSystemClassLoader());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable cause) &#123;</span><br><span class="line">                <span class="keyword">return</span> cause;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœ maybeSelectorImplClass ä¸æ˜¯ selector çš„ä¸€ä¸ªå®ç°ï¼Œåˆ™ç›´æ¥è¿”å›åŸç”Ÿçš„Selector </span></span><br><span class="line">    <span class="keyword">if</span> (!(maybeSelectorImplClass <span class="keyword">instanceof</span> Class) ||</span><br><span class="line">        <span class="comment">// ensure the current selector implementation is what we can instrument.</span></span><br><span class="line">        <span class="comment">// ç¡®ä¿å½“å‰çš„é€‰æ‹©å™¨å®ç°æ˜¯æˆ‘ä»¬å¯ä»¥æ£€æµ‹çš„</span></span><br><span class="line">        !((Class&lt;?&gt;) maybeSelectorImplClass).isAssignableFrom(unwrappedSelector.getClass())) &#123;</span><br><span class="line">        <span class="keyword">if</span> (maybeSelectorImplClass <span class="keyword">instanceof</span> Throwable) &#123;</span><br><span class="line">            Throwable t = (Throwable) maybeSelectorImplClass;</span><br><span class="line">            logger.trace(<span class="string">"failed to instrument a special java.util.Set into: &#123;&#125;"</span>, unwrappedSelector, t);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SelectorTuple(unwrappedSelector);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// maybeSelectorImplClass æ˜¯selectorçš„å®ç°ï¼Œåˆ™è½¬åŒ–ä¸º selector å®ç°ç±»</span></span><br><span class="line">    <span class="keyword">final</span> Class&lt;?&gt; selectorImplClass = (Class&lt;?&gt;) maybeSelectorImplClass;</span><br><span class="line">    <span class="comment">// åˆ›å»ºæ–°çš„ SelectionKey é›†åˆ SelectedSelectionKeySet,å†…éƒ¨é‡‡ç”¨çš„æ˜¯ SelectionKey æ•°ç»„çš„å½¢</span></span><br><span class="line">    <span class="comment">// å¼ï¼Œè€Œé set é›†åˆ</span></span><br><span class="line">    <span class="keyword">final</span> SelectedSelectionKeySet selectedKeySet = <span class="keyword">new</span> SelectedSelectionKeySet();</span><br><span class="line"></span><br><span class="line">    Object maybeException = AccessController.doPrivileged(<span class="keyword">new</span> PrivilegedAction&lt;Object&gt;() &#123;</span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> Object <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// é€šè¿‡åå°„çš„æ–¹å¼è·å– sun.nio.ch.SelectorImpl çš„æˆå‘˜å˜é‡ selectedKeys</span></span><br><span class="line">            Field selectedKeysField = selectorImplClass.getDeclaredField(<span class="string">"selectedKeys"</span>);</span><br><span class="line">            <span class="comment">// é€šè¿‡åå°„çš„æ–¹å¼è·å– sun.nio.ch.SelectorImpl çš„æˆå‘˜å˜é‡ publicSelectedKeys</span></span><br><span class="line">            Field publicSelectedKeysField = selectorImplClass.getDeclaredField(<span class="string">"publicSelectedKeys"</span>);</span><br><span class="line"></span><br><span class="line">             <span class="keyword">if</span> (PlatformDependent.javaVersion() &gt;= <span class="number">9</span> &amp;&amp; PlatformDependent.hasUnsafe()) &#123;</span><br><span class="line">                 <span class="comment">// Let us try to use sun.misc.Unsafe to replace the SelectionKeySet.</span></span><br><span class="line">                 <span class="comment">// This allows us to also do this in Java9+ without any extra flags.</span></span><br><span class="line">           <span class="keyword">long</span> selectedKeysFieldOffset = 	PlatformDependent.objectFieldOffset(selectedKeysField);</span><br><span class="line">           <span class="keyword">long</span> publicSelectedKeysFieldOffset =</span><br><span class="line">                            PlatformDependent.objectFieldOffset(publicSelectedKeysField);</span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span> (selectedKeysFieldOffset != -<span class="number">1</span> &amp;&amp; publicSelectedKeysFieldOffset != -<span class="number">1</span>) &#123;</span><br><span class="line">             PlatformDependent.putObject( unwrappedSelector, selectedKeysFieldOffset, selectedKeySet);</span><br><span class="line">             PlatformDependent.putObject(unwrappedSelector, publicSelectedKeysFieldOffset, selectedKeySet);</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">          &#125;</span><br><span class="line">                    <span class="comment">// We could not retrieve the offset, lets try reflection as last-resort.</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">               <span class="comment">// è®¾ç½®å­—æ®µ selectedKeys  Accessible ä¸ºtrue</span></span><br><span class="line">                Throwable cause = ReflectionUtil.trySetAccessible(selectedKeysField, <span class="keyword">true</span>);</span><br><span class="line">                <span class="keyword">if</span> (cause != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> cause;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// è®¾ç½®å­—æ®µ publicSelectedKeys  Accessible ä¸ºtrue</span></span><br><span class="line">                cause = ReflectionUtil.trySetAccessible(publicSelectedKeysField, <span class="keyword">true</span>);</span><br><span class="line">                <span class="keyword">if</span> (cause != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> cause;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                selectedKeysField.set(unwrappedSelector, selectedKeySet);</span><br><span class="line">                publicSelectedKeysField.set(unwrappedSelector, selectedKeySet);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">                <span class="keyword">return</span> e;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">                <span class="keyword">return</span> e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (maybeException <span class="keyword">instanceof</span> Exception) &#123;</span><br><span class="line">        selectedKeys = <span class="keyword">null</span>;</span><br><span class="line">        Exception e = (Exception) maybeException;</span><br><span class="line">        logger.trace(<span class="string">"failed to instrument a special java.util.Set into: &#123;&#125;"</span>, unwrappedSelector, e);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SelectorTuple(unwrappedSelector);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¾ç½® SelectedSelectionKeySet</span></span><br><span class="line">    selectedKeys = selectedKeySet;</span><br><span class="line">    logger.trace(<span class="string">"instrumented a special java.util.Set into: &#123;&#125;"</span>, unwrappedSelector);</span><br><span class="line">    <span class="comment">// è¿”å›åŒ…å«äº†åŸç”Ÿselectorå’Œä¼˜åŒ–è¿‡çš„selectorçš„SelectorTuple</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SelectorTuple(unwrappedSelector,</span><br><span class="line">                             <span class="keyword">new</span> SelectedSelectionKeySetSelector(unwrappedSelector, selectedKeySet));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼˜åŒ–åçš„ SelectedSelectionKeySet å¯¹è±¡ï¼Œå†…éƒ¨é‡‡ç”¨ SelectionKey æ•°ç»„çš„å½¢å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">SelectedSelectionKeySet</span> <span class="keyword">extends</span> <span class="title">AbstractSet</span>&lt;<span class="title">SelectionKey</span>&gt; </span>&#123;</span><br><span class="line">    SelectionKey[] keys;</span><br><span class="line">    <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    SelectedSelectionKeySet() &#123;</span><br><span class="line">        keys = <span class="keyword">new</span> SelectionKey[<span class="number">1024</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨æ•°ç»„ï¼Œæ¥æ›¿ä»£HashSet,å¯ä»¥é™ä½æ—¶é—´å¤æ‚åº¦ä¸ºO(1)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(SelectionKey o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        keys[size++] = o;</span><br><span class="line">        <span class="keyword">if</span> (size == keys.length) &#123;</span><br><span class="line">            increaseCapacity();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator&lt;SelectionKey&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Iterator&lt;SelectionKey&gt;() &#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">int</span> idx;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> idx &lt; size;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> SelectionKey <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (!hasNext()) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> keys[idx++];</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">reset</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        reset(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">reset</span><span class="params">(<span class="keyword">int</span> start)</span> </span>&#123;</span><br><span class="line">        Arrays.fill(keys, start, size, <span class="keyword">null</span>);</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰©å®¹</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">increaseCapacity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SelectionKey[] newKeys = <span class="keyword">new</span> SelectionKey[keys.length &lt;&lt; <span class="number">1</span>];</span><br><span class="line">        System.arraycopy(keys, <span class="number">0</span>, newKeys, <span class="number">0</span>, size);</span><br><span class="line">        keys = newKeys;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>SingleThreadEventLoop æ„é€ å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleThreadEventLoop</span> <span class="keyword">extends</span> <span class="title">SingleThreadEventExecutor</span> <span class="keyword">implements</span> <span class="title">EventLoop</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="title">SingleThreadEventLoop</span><span class="params">(EventLoopGroup parent, Executor executor,</span></span></span><br><span class="line"><span class="function"><span class="params">                                <span class="keyword">boolean</span> addTaskWakesUp, <span class="keyword">int</span> maxPendingTasks,</span></span></span><br><span class="line"><span class="function"><span class="params">                                RejectedExecutionHandler rejectedExecutionHandler)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨ SingleThreadEventExecutor æ„é€ å™¨</span></span><br><span class="line">        <span class="keyword">super</span>(parent, executor, addTaskWakesUp, maxPendingTasks, rejectedExecutionHandler);</span><br><span class="line">        tailTasks = newTaskQueue(maxPendingTasks);</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>SingleThreadEventExecutor æ„é€ å™¨ï¼Œä¸»è¦åšä¸¤ä»¶äº‹æƒ…ï¼š</p><ul><li>è®¾ç½®çº¿ç¨‹ä»»åŠ¡æ‰§è¡Œå™¨ã€‚</li><li>è®¾ç½®ä»»åŠ¡é˜Ÿåˆ—ã€‚å‰é¢è®²åˆ°EventLoopå¯¹äºä¸èƒ½ç«‹å³æ‰§è¡Œçš„Taskä¼šæ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå°±æ˜¯è¿™é‡Œè®¾ç½®çš„ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleThreadEventExecutor</span> <span class="keyword">extends</span> <span class="title">AbstractScheduledEventExecutor</span> <span class="keyword">implements</span> <span class="title">OrderedEventExecutor</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">SingleThreadEventExecutor</span><span class="params">(EventExecutorGroup parent, Executor executor,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    <span class="keyword">boolean</span> addTaskWakesUp, <span class="keyword">int</span> maxPendingTasks,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    RejectedExecutionHandler rejectedHandler)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(parent);</span><br><span class="line">        <span class="keyword">this</span>.addTaskWakesUp = addTaskWakesUp;</span><br><span class="line">        <span class="keyword">this</span>.maxPendingTasks = Math.max(<span class="number">16</span>, maxPendingTasks);</span><br><span class="line">        <span class="comment">// è®¾ç½®çº¿ç¨‹ä»»åŠ¡æ‰§è¡Œå™¨</span></span><br><span class="line">        <span class="keyword">this</span>.executor = ObjectUtil.checkNotNull(executor, <span class="string">"executor"</span>);</span><br><span class="line">        <span class="comment">// è®¾ç½®ä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line">        taskQueue = newTaskQueue(<span class="keyword">this</span>.maxPendingTasks);</span><br><span class="line">        rejectedExecutionHandler = ObjectUtil.checkNotNull(rejectedHandler, <span class="string">"rejectedHandler"</span>);</span><br><span class="line">    </span><br><span class="line">	&#125;    </span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>NioEventLoop ä¸­å¯¹ newTaskQueue æ¥å£çš„å®ç°ï¼Œè¿”å›çš„æ˜¯ <a href="https://github.com/JCTools/JCTools" target="_blank" rel="noopener">JCTools</a> å·¥å…·åŒ… Mpsc é˜Ÿåˆ—ã€‚åé¢æˆ‘ä»¬å†™æ–‡ç« å•ç‹¬ä»‹ç» JCTools ä¸­çš„ç›¸å…³é˜Ÿåˆ—ã€‚</p><blockquote><p>Mpscï¼šMulti Producer Single Consumer (Lock less, bounded and unbounded)</p><blockquote><p>å¤šä¸ªç”Ÿäº§è€…å¯¹å•ä¸ªæ¶ˆè´¹è€…ï¼ˆæ— é”ã€æœ‰ç•Œå’Œæ— ç•Œéƒ½æœ‰å®ç°ï¼‰</p></blockquote></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">NioEventLoop</span> <span class="keyword">extends</span> <span class="title">SingleThreadEventLoop</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Queue&lt;Runnable&gt; <span class="title">newTaskQueue</span><span class="params">(<span class="keyword">int</span> maxPendingTasks)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// This event loop never calls takeTask()</span></span><br><span class="line">        <span class="keyword">return</span> maxPendingTasks == Integer.MAX_VALUE ? PlatformDependent.&lt;Runnable&gt;newMpscQueue()</span><br><span class="line">                                                    : PlatformDependent.&lt;Runnable&gt;newMpscQueue(maxPendingTasks);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºçº¿ç¨‹æ‰§è¡Œé€‰æ‹©å™¨chooser"><a href="#åˆ›å»ºçº¿ç¨‹æ‰§è¡Œé€‰æ‹©å™¨chooser" class="headerlink" title="åˆ›å»ºçº¿ç¨‹æ‰§è¡Œé€‰æ‹©å™¨chooser"></a>åˆ›å»ºçº¿ç¨‹æ‰§è¡Œé€‰æ‹©å™¨chooser</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹ MultithreadEventExecutorGroup æ„é€ å™¨çš„æœ€åä¸€ä¸ªéƒ¨åˆ†å†…å®¹ï¼Œåˆ›å»ºçº¿ç¨‹æ‰§è¡Œé€‰æ‹©å™¨chooserï¼Œå®ƒçš„ä¸»è¦ä½œç”¨å°±æ˜¯ EventLoopGroup ç”¨äºä» EventLoop æ•°ç»„ä¸­é€‰æ‹©ä¸€ä¸ª EventLoop å»æ‰§è¡Œä»»åŠ¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºé€‰æ‹©å™¨</span></span><br><span class="line">chooser = chooserFactory.newChooser(children);</span><br></pre></td></tr></table></figure><p>EventLoopGroup ä¸­å®šä¹‰çš„ <code>next()</code> æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EventLoopGroup</span> <span class="keyword">extends</span> <span class="title">EventExecutorGroup</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// é€‰æ‹©ä¸‹ä¸€ä¸ª EventLoop ç”¨äºæ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">EventLoop <span class="title">next</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>MultithreadEventExecutorGroup ä¸­å¯¹ next() çš„å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> EventExecutor <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨ DefaultEventExecutorChooserFactory ä¸­çš„next()</span></span><br><span class="line">    <span class="keyword">return</span> chooser.next();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>DefaultEventExecutorChooserFactory å¯¹äºå¦‚ä½•ä»æ•°ç»„ä¸­é€‰æ‹©ä»»åŠ¡æ‰§è¡Œå™¨ï¼Œä¹Ÿåšäº†å·§å¦™çš„ä¼˜åŒ–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultEventExecutorChooserFactory</span> <span class="keyword">implements</span> <span class="title">EventExecutorChooserFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> DefaultEventExecutorChooserFactory INSTANCE = <span class="keyword">new</span> DefaultEventExecutorChooserFactory();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">DefaultEventExecutorChooserFactory</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> EventExecutorChooser <span class="title">newChooser</span><span class="params">(EventExecutor[] executors)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isPowerOfTwo(executors.length)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> PowerOfTwoEventExecutorChooser(executors);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> GenericEventExecutorChooser(executors);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// åˆ¤æ–­çº¿ç¨‹ä»»åŠ¡æ‰§è¡Œçš„ä¸ªæ•°æ˜¯å¦ä¸º 2 çš„å¹‚æ¬¡æ–¹ã€‚e.g: 2ã€4ã€8ã€16</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isPowerOfTwo</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (val &amp; -val) == val;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// å¹‚æ¬¡æ–¹é€‰æ‹©å™¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PowerOfTwoEventExecutorChooser</span> <span class="keyword">implements</span> <span class="title">EventExecutorChooser</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> AtomicInteger idx = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> EventExecutor[] executors;</span><br><span class="line">        </span><br><span class="line">        PowerOfTwoEventExecutorChooser(EventExecutor[] executors) &#123;</span><br><span class="line">            <span class="keyword">this</span>.executors = executors;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> EventExecutor <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="comment">// é€šè¿‡äºŒçº§åˆ¶è¿›è¡Œ &amp; è¿ç®—ï¼Œæ•ˆç‡æ›´é«˜</span></span><br><span class="line">            <span class="keyword">return</span> executors[idx.getAndIncrement() &amp; executors.length - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ™®é€šé€‰æ‹©å™¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericEventExecutorChooser</span> <span class="keyword">implements</span> <span class="title">EventExecutorChooser</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> AtomicInteger idx = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> EventExecutor[] executors;</span><br><span class="line"></span><br><span class="line">        GenericEventExecutorChooser(EventExecutor[] executors) &#123;</span><br><span class="line">            <span class="keyword">this</span>.executors = executors;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> EventExecutor <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="comment">// æŒ‰ç…§æœ€æ™®é€šçš„å–æ¨¡çš„æ–¹å¼ä»index=0å¼€å§‹å‘åå¼€å§‹é€‰æ‹©</span></span><br><span class="line">            <span class="keyword">return</span> executors[Math.abs(idx.getAndIncrement() % executors.length)];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>é€šè¿‡æœ¬èŠ‚å†…å®¹ï¼Œæˆ‘ä»¬äº†è§£åˆ°äº†EventLoopä¸EventLoopGroupçš„åŸºæœ¬åŸç†ï¼ŒEventLoopGroupä¸EventLoopçš„åˆ›å»ºè¿‡ç¨‹ï¼š</p><ul><li>åˆ›å»ºçº¿ç¨‹ä»»åŠ¡æ‰§è¡Œå™¨ ThreadPerTaskExecutor</li><li>åˆ›å»ºEventLoop</li><li>åˆ›å»ºä»»åŠ¡é€‰æ‹©å™¨ EventExecutorChooser</li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://coding.imooc.com/class/230.html" target="_blank" rel="noopener">Javaè¯»æºç ä¹‹Nettyæ·±å…¥å‰–æ</a></li><li><a href="https://github.com/wangweiX/myBooks/blob/master/computer/netty/Netty%20in%20Action.epub" target="_blank" rel="noopener">ã€ŠNetty in actionã€‹</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Netty </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Netty Channelæºç åˆ†æ]]></title>
      <url>/posts/netty-channel-source-analyse.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/pexels-photo-889839.jpeg?imageslim" alt="pexels-photo-889839"></p><p><a href="https://wangwei.one/posts/netty-core-assembly-intro.html">å‰é¢</a>ï¼Œæˆ‘ä»¬å¤§è‡´äº†è§£äº†Nettyä¸­çš„å‡ ä¸ªæ ¸å¿ƒç»„ä»¶ã€‚ä»Šå¤©æˆ‘ä»¬å°±æ¥å…ˆæ¥ä»‹ç»Nettyçš„ç½‘ç»œé€šä¿¡ç»„ä»¶ï¼Œç”¨äºæ‰§è¡Œç½‘ç»œI/Oæ“ä½œ â€”â€” <a href="https://netty.io/4.1/api/io/netty/channel/Channel.html" target="_blank" rel="noopener"><strong><em>Channel</em></strong></a>ã€‚</p><a id="more"></a><blockquote><p>Nettyç‰ˆæœ¬ï¼š4.1.30</p></blockquote><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>æ•°æ®åœ¨ç½‘ç»œä¸­æ€»æ˜¯ä»¥å­—èŠ‚çš„å½¢å¼è¿›è¡Œæµé€šã€‚æˆ‘ä»¬åœ¨è¿›è¡Œç½‘ç»œç¼–ç¨‹æ—¶é€‰ç”¨ä½•ç§ä¼ è¾“æ–¹å¼ç¼–ç ï¼ˆOIOã€NIOç­‰ï¼‰å†³å®šäº†è¿™äº›å­—èŠ‚çš„ä¼ è¾“æ–¹å¼ã€‚</p><p>åœ¨æ²¡æœ‰Nettyä¹‹å‰ï¼Œä¸ºäº†æå‡ç³»ç»Ÿçš„å¹¶å‘èƒ½åŠ›ï¼Œä»OIOåˆ‡æ¢åˆ°NIOæ—¶ï¼Œéœ€è¦å¯¹ä»£ç è¿›è¡Œå¤§é‡çš„é‡æ„ï¼Œå› ä¸ºç›¸åº”çš„Java NIO ä¸ IO APIå¤§ä¸ç›¸åŒã€‚è€ŒNettyåœ¨è¿™äº›JavaåŸç”ŸAPIçš„åŸºç¡€ä¸Šåšäº†ä¸€å±‚å°è£…ï¼Œå¯¹ç”¨æˆ·æä¾›äº†é«˜åº¦æŠ½è±¡è€Œåˆç»Ÿä¸€çš„APIï¼Œä»è€Œè®©ä¼ è¾“æ–¹å¼çš„åˆ‡æ¢ä¸åœ¨å˜å¾—å›°éš¾ï¼Œåªéœ€è¦ç›´æ¥ä½¿ç”¨å³å¯ï¼Œè€Œä¸éœ€è¦å¯¹æ•´ä¸ªä»£ç è¿›è¡Œé‡æ„ã€‚</p><h3 id="Netty-Channel-UML"><a href="#Netty-Channel-UML" class="headerlink" title="Netty Channel UML"></a>Netty Channel UML</h3><p>netty channelæ—å¦‚ä¸‹ï¼š</p><p><img src="https://img.i7years.com/netty/NettyChannelUML.png" alt="NettyChannel"></p><p>æ•´ä¸ªæ—ç¾¤ä¸­ï¼Œ<a href="https://netty.io/4.1/api/io/netty/channel/AbstractChannel.html" target="_blank" rel="noopener">AbstractChannel</a> æ˜¯æœ€ä¸ºå…³é”®çš„ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä»å®ƒç»§æ‰¿å‡ºäº†AbstractNioChannelã€AbstractOioChannelã€AbstractEpollChannelã€LocalChannelã€EmbeddedChannelç­‰ç±»ï¼Œæ¯ä¸ªç±»ä»£è¡¨äº†ä¸åŒçš„åè®®ä»¥åŠç›¸åº”çš„IOæ¨¡å‹ã€‚é™¤äº† TCP åè®®ä»¥å¤–ï¼ŒNetty è¿˜æ”¯æŒå¾ˆå¤šå…¶ä»–çš„è¿æ¥åè®®ï¼Œå¹¶ä¸”æ¯ç§åè®®è¿˜æœ‰ NIO(å¼‚æ­¥ IO) å’Œ OIO(Old-IOï¼Œå³ä¼ ç»Ÿçš„é˜»å¡ IO) ç‰ˆæœ¬çš„åŒºåˆ«. ä¸åŒåè®®ä¸åŒçš„é˜»å¡ç±»å‹çš„è¿æ¥éƒ½æœ‰ä¸åŒçš„ Channel ç±»å‹ä¸ä¹‹å¯¹åº”ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„ Channel ç±»å‹ï¼š</p><ul><li>NioSocketChannelï¼šä»£è¡¨å¼‚æ­¥çš„å®¢æˆ·ç«¯ TCP Socket è¿æ¥</li><li>NioServerSocketChannelï¼šå¼‚æ­¥çš„æœåŠ¡å™¨ç«¯ TCP Socket è¿æ¥</li><li>NioDatagramChannelï¼šå¼‚æ­¥çš„ UDP è¿æ¥</li><li>NioSctpChannelï¼šå¼‚æ­¥çš„å®¢æˆ·ç«¯ Sctp è¿æ¥</li><li>NioSctpServerChannelï¼šå¼‚æ­¥çš„ Sctp æœåŠ¡å™¨ç«¯è¿æ¥</li><li>OioSocketChannelï¼šåŒæ­¥çš„å®¢æˆ·ç«¯ TCP Socket è¿æ¥</li><li>OioServerSocketChannelï¼šåŒæ­¥çš„æœåŠ¡å™¨ç«¯ TCP Socket è¿æ¥</li><li>OioDatagramChannelï¼šåŒæ­¥çš„ UDP è¿æ¥</li><li>OioSctpChannelï¼šåŒæ­¥çš„ Sctp æœåŠ¡å™¨ç«¯è¿æ¥</li><li>OioSctpServerChannelï¼šåŒæ­¥çš„å®¢æˆ·ç«¯ TCP Socket è¿æ¥</li></ul><h3 id="Channel-API"><a href="#Channel-API" class="headerlink" title="Channel API"></a>Channel API</h3><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹æœ€é¡¶å±‚æ¥å£ <a href="https://netty.io/4.1/api/io/netty/channel/Channel.html" target="_blank" rel="noopener">channel</a> ä¸»è¦çš„APIï¼Œå¸¸ç”¨çš„å¦‚ä¸‹ï¼š</p><table><thead><tr><th>æ¥å£å</th><th>æè¿°</th></tr></thead><tbody><tr><td>eventLoop()</td><td>Channeléœ€è¦æ³¨å†Œåˆ°EventLoopçš„å¤šè·¯å¤ç”¨å™¨ä¸Šï¼Œç”¨äºå¤„ç†I/Oäº‹ä»¶ï¼Œé€šè¿‡eventLoop()æ–¹æ³•å¯ä»¥è·å–åˆ°Channelæ³¨å†Œçš„EventLoopã€‚EventLoopæœ¬è´¨ä¸Šå°±æ˜¯å¤„ç†ç½‘ç»œè¯»å†™äº‹ä»¶çš„Reactorçº¿ç¨‹ã€‚åœ¨Nettyä¸­ï¼Œå®ƒä¸ä»…ä»…ç”¨æ¥å¤„ç†ç½‘ç»œäº‹ä»¶ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥æ‰§è¡Œå®šæ—¶ä»»åŠ¡å’Œç”¨æˆ·è‡ªå®šä¹‰NioTaskç­‰ä»»åŠ¡ã€‚</td></tr><tr><td>pipeline()</td><td>è¿”å›channelåˆ†é…çš„ChannelPipeline</td></tr><tr><td>isActive()</td><td>åˆ¤æ–­channelæ˜¯å¦æ¿€æ´»ã€‚æ¿€æ´»çš„æ„ä¹‰å–å†³äºåº•å±‚çš„ä¼ è¾“ç±»å‹ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªSocketä¼ è¾“ä¸€æ—¦è¿æ¥åˆ°äº†è¿œç¨‹èŠ‚ç‚¹ä¾¿æ˜¯æ´»åŠ¨çš„ï¼Œè€Œä¸€ä¸ªDatagramä¼ è¾“ä¸€æ—¦è¢«æ‰“å¼€ä¾¿æ˜¯æ´»åŠ¨çš„</td></tr><tr><td>localAddress()</td><td>è¿”å›æœ¬åœ°çš„socketåœ°å€</td></tr><tr><td>remoteAddress()</td><td>è¿”å›è¿œç¨‹çš„socketåœ°å€</td></tr><tr><td>flush()</td><td>å°†ä¹‹å‰å·²å†™çš„æ•°æ®å†²åˆ·åˆ°åº•å±‚Channelä¸Šå»</td></tr><tr><td>write(Object msg)</td><td>è¯·æ±‚å°†å½“å‰çš„msgé€šè¿‡ChannelPipelineå†™å…¥åˆ°ç›®æ ‡Channelä¸­ã€‚æ³¨æ„ï¼Œwriteæ“ä½œåªæ˜¯å°†æ¶ˆæ¯å­˜å…¥åˆ°æ¶ˆæ¯å‘é€ç¯å½¢æ•°ç»„ä¸­ï¼Œå¹¶æ²¡æœ‰çœŸæ­£è¢«å‘é€ï¼Œåªæœ‰è°ƒç”¨flushæ“ä½œæ‰ä¼šè¢«å†™å…¥åˆ°Channelä¸­ï¼Œå‘é€ç»™å¯¹æ–¹ã€‚</td></tr><tr><td>writeAndFlush()</td><td>ç­‰åŒäºè°ƒç”¨write()å¹¶æ¥ç€è°ƒç”¨flush()</td></tr><tr><td>metadate()</td><td>ç†Ÿæ‚‰TCPåè®®çš„è¯»è€…å¯èƒ½çŸ¥é“ï¼Œå½“åˆ›å»ºSocketçš„æ—¶å€™éœ€è¦æŒ‡å®šTCPå‚æ•°ï¼Œä¾‹å¦‚æ¥æ”¶å’Œå‘é€çš„TCPç¼“å†²åŒºå¤§å°ï¼ŒTCPçš„è¶…æ—¶æ—¶é—´ã€‚æ˜¯å¦é‡ç”¨åœ°å€ç­‰ã€‚åœ¨Nettyä¸­ï¼Œæ¯ä¸ªChannelå¯¹åº”ä¸€ä¸ªç‰©ç†é“¾æ¥ï¼Œæ¯ä¸ªè¿æ¥éƒ½æœ‰è‡ªå·±çš„TCPå‚æ•°é…ç½®ã€‚æ‰€ä»¥ï¼ŒChannelä¼šèšåˆä¸€ä¸ªChannelMetadataç”¨æ¥å¯¹TCPå‚æ•°æä¾›å…ƒæ•°æ®æè¿°ä¿¡æ¯ï¼Œé€šè¿‡metadata()æ–¹æ³•å°±å¯ä»¥è·å–å½“å‰Channelçš„TCPå‚æ•°é…ç½®ã€‚</td></tr><tr><td>read()</td><td>ä»å½“å‰çš„Channelä¸­è¯»å–æ•°æ®åˆ°ç¬¬ä¸€ä¸ªinboundç¼“å†²åŒºä¸­ï¼Œå¦‚æœæ•°æ®è¢«æˆåŠŸè¯»å–ï¼Œè§¦å‘ChannelHandler.channelRead(ChannelHandlerContext,Object)äº‹ä»¶ã€‚è¯»å–æ“ä½œAPIè°ƒç”¨å®Œæˆåï¼Œç´§æ¥ç€ä¼šè§¦å‘ChannelHander.channelReadCompleteï¼ˆChannelHandlerContextï¼‰äº‹ä»¶ï¼Œè¿™æ ·ä¸šåŠ¡çš„ChannelHandlerå¯ä»¥å†³å®šæ˜¯å¦éœ€è¦ç»§ç»­è¯»å–æ•°æ®ã€‚å¦‚æœå·²ç»æœ‰æ“ä½œè¯·æ±‚è¢«æŒ‚èµ·ï¼Œåˆ™åç»­çš„è¯»æ“ä½œä¼šè¢«å¿½ç•¥ã€‚</td></tr><tr><td>close(ChannelPromise promise)</td><td>ä¸»åŠ¨å…³é—­å½“å‰è¿æ¥ï¼Œé€šè¿‡ChannelPromiseè®¾ç½®æ“ä½œç»“æœå¹¶è¿›è¡Œç»“æœé€šçŸ¥ï¼Œæ— è®ºæ“ä½œæ˜¯å¦æˆåŠŸï¼Œéƒ½å¯ä»¥é€šè¿‡ChannelPromiseè·å–æ“ä½œç»“æœã€‚è¯¥æ“ä½œä¼šçº§è”è§¦å‘ChannelPipelineä¸­æ‰€æœ‰ChannelHandlerçš„ChannelHandler.close(ChannelHandlerContextï¼ŒChannelPromise)äº‹ä»¶ã€‚</td></tr><tr><td>parent()</td><td>å¯¹äºæœåŠ¡ç«¯Channelè€Œè¨€ï¼Œå®ƒçš„çˆ¶Channelä¸ºç©ºï¼›å¯¹äºå®¢æˆ·ç«¯Channelï¼Œå®ƒçš„çˆ¶Channelå°±æ˜¯åˆ›å»ºå®ƒçš„ServerSocketChannelã€‚</td></tr><tr><td>id()</td><td>è¿”å›ChannelIdå¯¹è±¡ï¼ŒChannelIdæ˜¯Channelçš„å”¯ä¸€æ ‡è¯†ã€‚</td></tr></tbody></table><h2 id="Channelåˆ›å»º"><a href="#Channelåˆ›å»º" class="headerlink" title="Channelåˆ›å»º"></a>Channelåˆ›å»º</h2><p>å¯¹Netty Channel APIä»¥åŠç›¸å…³çš„ç±»æœ‰äº†ä¸€ä¸ªåˆæ­¥äº†è§£ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥è¯¦ç»†äº†è§£ä¸€ä¸‹åœ¨Nettyçš„å¯åŠ¨è¿‡ç¨‹ä¸­Channelæ˜¯å¦‚ä½•åˆ›å»ºçš„ã€‚æœåŠ¡ç«¯Channelçš„åˆ›å»ºè¿‡ç¨‹ï¼Œä¸»è¦åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼š1ï¼‰Channelåˆ›å»ºï¼›2ï¼‰Channelåˆå§‹åŒ–ï¼›3ï¼‰Channelæ³¨å†Œï¼›4ï¼‰Channelç»‘å®šã€‚</p><p><img src="https://img.i7years.com/blog/Netty%20Channel%20Process.png" alt="Netty Channel Process"></p><p>æˆ‘ä»¬ä»¥ä¸‹é¢çš„ä»£ç ä¸ºä¾‹è¿›è¡Œè§£æï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ç»„,ä¸“é—¨ç”¨äºç½‘ç»œäº‹ä»¶çš„å¤„ç†ï¼ŒReactorçº¿ç¨‹ç»„</span></span><br><span class="line"><span class="comment">// ç”¨æ¥æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œ</span></span><br><span class="line">EventLoopGroup bossGroup = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line"><span class="comment">// ç”¨æ¥è¿›è¡ŒSocketChannelçš„ç½‘ç»œè¯»å†™</span></span><br><span class="line">EventLoopGroup workGroup = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºè¾…åŠ©å¯åŠ¨ç±»ServerBootstrapï¼Œå¹¶è®¾ç½®ç›¸å…³é…ç½®ï¼š</span></span><br><span class="line">ServerBootstrap b = <span class="keyword">new</span> ServerBootstrap();</span><br><span class="line"><span class="comment">// è®¾ç½®å¤„ç†Acceptäº‹ä»¶å’Œè¯»å†™æ“ä½œçš„äº‹ä»¶å¾ªç¯ç»„</span></span><br><span class="line">b.group(bossGroup, workGroup)</span><br><span class="line">         <span class="comment">// é…ç½®Channelç±»å‹</span></span><br><span class="line">        .channel(NioServerSocketChannel.class)</span><br><span class="line">         <span class="comment">// é…ç½®ç›‘å¬åœ°å€</span></span><br><span class="line">        .localAddress(<span class="keyword">new</span> InetSocketAddress(port))</span><br><span class="line">         <span class="comment">// è®¾ç½®æœåŠ¡å™¨é€šé“çš„é€‰é¡¹ï¼Œè®¾ç½®TCPå±æ€§</span></span><br><span class="line">        .option(ChannelOption.SO_KEEPALIVE, Boolean.TRUE)</span><br><span class="line">         <span class="comment">// è®¾ç½®å»ºç«‹è¿æ¥åçš„å®¢æˆ·ç«¯é€šé“çš„é€‰é¡¹</span></span><br><span class="line">        .childOption(ChannelOption.CONNECT_TIMEOUT_MILLIS, <span class="number">5000</span>)</span><br><span class="line">         <span class="comment">// channelå±æ€§ï¼Œä¾¿äºä¿å­˜ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®</span></span><br><span class="line">        .attr(AttributeKey.newInstance(<span class="string">"UserId"</span>), <span class="string">"60293"</span>)</span><br><span class="line">    	.handler(<span class="keyword">new</span> LoggingHandler(LogLevel.INFO))</span><br><span class="line">        <span class="comment">// è®¾ç½®å­å¤„ç†å™¨ï¼Œä¸»è¦æ˜¯ç”¨æˆ·çš„è‡ªå®šä¹‰å¤„ç†å™¨ï¼Œç”¨äºå¤„ç†IOç½‘ç»œäº‹ä»¶</span></span><br><span class="line">        .childHandler(<span class="keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(SocketChannel ch)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                ch.pipeline().addLast(serverHandler);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨bind()æ–¹æ³•ç»‘å®šç«¯å£ï¼Œsync()ä¼šé˜»å¡ç­‰å¾…å¤„ç†è¯·æ±‚ã€‚è¿™æ˜¯å› ä¸ºbind()æ–¹æ³•æ˜¯ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹ï¼Œä¼šç«‹å³è¿”å›ä¸€ä¸ªChannelFutureå¯¹è±¡ï¼Œè°ƒç”¨sync()ä¼šç­‰å¾…æ‰§è¡Œå®Œæˆ</span></span><br><span class="line">ChannelFuture f = b.bind().sync();</span><br><span class="line"><span class="comment">// è·å¾—Channelçš„closeFutureé˜»å¡ç­‰å¾…å…³é—­ï¼ŒæœåŠ¡å™¨Channelå…³é—­æ—¶closeFutureä¼šå®Œæˆ</span></span><br><span class="line">f.channel().closeFuture().sync();</span><br></pre></td></tr></table></figure><p>è°ƒç”¨channel()æ¥å£è®¾ç½® <em>AbstractBootstrap</em> çš„æˆå‘˜å˜é‡ <em>channelFactory</em>ï¼Œè¯¥å˜é‡é¡¾åæ€ä¹‰å°±æ˜¯ç”¨äºåˆ›å»ºchannelçš„å·¥å‚ç±»ã€‚æºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> B <span class="title">channel</span><span class="params">(Class&lt;? extends C&gt; channelClass)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (channelClass == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"channelClass"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åˆ›å»º channelFactory</span></span><br><span class="line">    <span class="keyword">return</span> channelFactory(<span class="keyword">new</span> ReflectiveChannelFactory&lt;C&gt;(channelClass));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> B <span class="title">channelFactory</span><span class="params">(ChannelFactory&lt;? extends C&gt; channelFactory)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (channelFactory == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"channelFactory"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.channelFactory != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"channelFactory set already"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.channelFactory = channelFactory;</span><br><span class="line">    <span class="keyword">return</span> (B) <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><em>channelFactory</em> è®¾ç½®ä¸º <a href="https://netty.io/4.1/api/io/netty/channel/ReflectiveChannelFactory.html" target="_blank" rel="noopener">ReflectiveChannelFactory</a> ï¼Œåœ¨æˆ‘ä»¬è¿™ä¸ªä¾‹å­ä¸­ clazz ä¸º <em>NioServerSocketChannel</em> ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶ä¸­æœ‰ä¸ª newChannel() æ¥å£ï¼Œé€šè¿‡åå°„çš„æ–¹å¼æ¥è°ƒç”¨ï¼Œè¿™ä¸ªæ¥å£çš„è°ƒç”¨å¤„æˆ‘ä»¬åé¢ä¼šä»‹ç»åˆ°ã€‚æºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Channelå·¥å‚ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReflectiveChannelFactory</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Channel</span>&gt; <span class="keyword">implements</span> <span class="title">ChannelFactory</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;? extends T&gt; clazz;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ReflectiveChannelFactory</span><span class="params">(Class&lt;? extends T&gt; clazz)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (clazz == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"clazz"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.clazz = clazz;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">newChannel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// é€šè¿‡åå°„æ¥è¿›è¡Œå¸¸è§Channelå®ä¾‹</span></span><br><span class="line">            <span class="keyword">return</span> clazz.newInstance();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ChannelException(<span class="string">"Unable to create Channel from class "</span> + clazz, t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> StringUtil.simpleClassName(clazz) + <span class="string">".class"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸‹ <em>NioServerSocketChannel</em> çš„æ„é€ å‡½æ•°ï¼Œä¸»è¦å°±æ˜¯ï¼š</p><ul><li>ç”ŸæˆServerSocketChannelå¯¹è±¡ã€‚NioServerSocketChannelåˆ›å»ºæ—¶ï¼Œé¦–å…ˆä½¿ç”¨SelectorProviderçš„openServerSocketChannelæ‰“å¼€æœåŠ¡å™¨å¥—æ¥å­—é€šé“ã€‚SelectorProvideræ˜¯Javaçš„NIOæä¾›çš„æŠ½è±¡ç±»ï¼Œæ˜¯é€‰æ‹©å™¨å’Œå¯é€‰æ‹©é€šé“çš„æœåŠ¡æä¾›è€…ã€‚å…·ä½“çš„å®ç°ç±»æœ‰SelectorProviderImplï¼ŒEPollSelectorProvideï¼ŒPollSelectorProviderã€‚é€‰æ‹©å™¨çš„ä¸»è¦å·¥ä½œæ˜¯æ ¹æ®æ“ä½œç³»ç»Ÿç±»å‹å’Œç‰ˆæœ¬é€‰æ‹©åˆé€‚çš„Providerï¼šå¦‚æœLInuxå†…æ ¸ç‰ˆæœ¬&gt;=2.6åˆ™ï¼Œå…·ä½“çš„SelectorProviderä¸ºEPollSelectorProviderï¼Œå¦åˆ™ä¸ºé»˜è®¤çš„PollSelectorProviderã€‚</li><li>è®¾ç½® ServerSocketChannelConfig æˆå‘˜å˜é‡ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> ServerSocketChannel <span class="title">newSocket</span><span class="params">(SelectorProvider provider)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨JDKåº•å±‚APIç”Ÿæˆ ServerSocketChannel å¯¹è±¡å®ä¾‹</span></span><br><span class="line">        <span class="keyword">return</span> provider.openServerSocketChannel();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ChannelException(<span class="string">"Failed to open a server socket."</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ServerSocketChannelConfig config;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">NioServerSocketChannel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(newSocket(DEFAULT_SELECTOR_PROVIDER));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">NioServerSocketChannel</span><span class="params">(SelectorProvider provider)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(newSocket(provider));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">NioServerSocketChannel</span><span class="params">(ServerSocketChannel channel)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨ AbstractNioChannel æ„é€ å™¨ï¼Œåˆ›å»º NioServerSocketChannelï¼Œè®¾ç½®SelectionKeyä¸ºACCEPT</span></span><br><span class="line">    <span class="keyword">super</span>(<span class="keyword">null</span>, channel, SelectionKey.OP_ACCEPT);</span><br><span class="line">    <span class="comment">// åˆ›å»ºChannleConfigå¯¹è±¡,ä¸»è¦æ˜¯TCPå‚æ•°é…ç½®ç±»</span></span><br><span class="line">    config = <span class="keyword">new</span> NioServerSocketChannelConfig(<span class="keyword">this</span>, javaChannel().socket());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>AbstractNioChannel çš„æ„é€ å™¨å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="title">AbstractNioChannel</span><span class="params">(Channel parent, SelectableChannel ch, <span class="keyword">int</span> readInterestOp)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨ AbstractChannel æ„é€ å™¨</span></span><br><span class="line">    <span class="keyword">super</span>(parent);</span><br><span class="line">    <span class="keyword">this</span>.ch = ch;</span><br><span class="line">    <span class="comment">// ä»ä¸Šä¸€æ­¥è¿‡æ¥ï¼Œè¿™é‡Œè®¾ç½®ä¸º SelectionKey.OP_ACCEPT</span></span><br><span class="line">    <span class="keyword">this</span>.readInterestOp = readInterestOp;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®ä¸ºéé˜»å¡çŠ¶æ€</span></span><br><span class="line">        ch.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ch.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e2) &#123;</span><br><span class="line">            <span class="keyword">if</span> (logger.isWarnEnabled()) &#123;</span><br><span class="line">                logger.warn(<span class="string">"Failed to close a partially initialized socket."</span>, e2);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ChannelException(<span class="string">"Failed to enter non-blocking mode."</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <em>AbstractChannel</em> æ„é€ å™¨ä¸­ï¼Œä¼šè®¾Channelå…³è”çš„ä¸‰ä¸ªæ ¸å¿ƒå¯¹è±¡ï¼šChannelIdã€ChannelPipelineã€Unsafeã€‚</p><ul><li>åˆå§‹åŒ–ChannelIdï¼ŒChannelIdæ˜¯ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„å€¼ï¼›</li><li>åˆ›å»º <em>NioMessageUnsafe</em> å®ä¾‹ï¼Œè¯¥ç±»ä¸ºChannelæä¾›äº†ç”¨äºå®Œæˆç½‘ç»œé€šè®¯ç›¸å…³çš„åº•å±‚æ“ä½œï¼Œå¦‚connect(),read(),register(),bind(),close()ç­‰ï¼›</li><li>ä¸ºChannelåˆ›å»ºDefaultChannelPipelineï¼Œåˆå§‹äº‹ä»¶ä¼ æ’­ç®¡é“ã€‚å…³äºPipelineçš„åˆ†æï¼Œè¯·çœ‹ <a href="https://wangwei.one/posts/netty-pipeline-source-analyse.html">åæ–‡</a> çš„åˆ†æã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="title">AbstractChannel</span><span class="params">(Channel parent)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.parent = parent;</span><br><span class="line">    <span class="comment">// è®¾ç½®ChannelId</span></span><br><span class="line">    id = newId();</span><br><span class="line">    <span class="comment">// è®¾ç½®Unsafe</span></span><br><span class="line">    unsafe = newUnsafe();</span><br><span class="line">    <span class="comment">// è®¾ç½®Pipeline</span></span><br><span class="line">    pipeline = newChannelPipeline();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä» NioServerSocketChannelConfig çš„æ„é€ å‡½æ•°è¿½æº¯ä¸‹å»ï¼Œåœ¨ DefaultChannelConfig ä¼šè®¾ç½®channelæˆå‘˜å˜é‡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">DefaultChannelConfig</span><span class="params">(Channel channel)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(channel, <span class="keyword">new</span> AdaptiveRecvByteBufAllocator());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="title">DefaultChannelConfig</span><span class="params">(Channel channel, RecvByteBufAllocator allocator)</span> </span>&#123;</span><br><span class="line">    setRecvByteBufAllocator(allocator, channel.metadata());</span><br><span class="line">    <span class="comment">// ç»‘å®šchannel</span></span><br><span class="line">    <span class="keyword">this</span>.channel = channel;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå°±æ˜¯channelåˆ›å»ºçš„è¿‡ç¨‹ï¼Œæ€»ç»“ä¸€ä¸‹:</p><ul><li>é€šè¿‡ ReflectiveChannelFactory å·¥å‚ç±»ï¼Œä»¥åå°„çš„æ–¹å¼å¯¹channelè¿›è¡Œåˆ›å»ºï¼›</li><li>channelåˆ›å»ºçš„è¿‡ç¨‹ä¸­ï¼Œä¼šåˆ›å»ºå››ä¸ªé‡è¦çš„å¯¹è±¡ï¼šChannelIdã€ChannelConfigã€ChannelPipelineã€Unsafeã€‚</li></ul><h2 id="Channelåˆå§‹åŒ–"><a href="#Channelåˆå§‹åŒ–" class="headerlink" title="Channelåˆå§‹åŒ–"></a>Channelåˆå§‹åŒ–</h2><p>ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸¤æ­¥ï¼š</p><ul><li>å°†å¯åŠ¨å™¨ï¼ˆBootstrapï¼‰è®¾ç½®çš„é€‰é¡¹å’Œå±æ€§è®¾ç½®åˆ°NettyChannelä¸Šé¢</li><li>å‘Pipelineæ·»åŠ åˆå§‹åŒ–Handlerï¼Œä¾›æ³¨å†Œåä½¿ç”¨</li></ul><p>æˆ‘ä»¬ä» <em>AbstractBootstrap</em> çš„ bind() æ¥å£è¿›å»ï¼Œè°ƒç”¨é“¾ï¼šbind() â€”&gt; doBind(localAddress) â€”&gt; initAndRegister() â€”&gt; init(Channel channel)ï¼Œæˆ‘ä»¬çœ‹ä¸‹ <em>ServerBootstrap</em> ä¸­ init() æ¥å£çš„å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> ChannelFuture <span class="title">initAndRegister</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Channel channel = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨Channelå·¥ç¨‹ç±»çš„newChannel()æ¥å£ï¼Œåˆ›å»ºchannelï¼Œå°±æ˜¯å‰é¢æˆ‘ä»¬è®²çš„éƒ¨åˆ†å†…å®¹</span></span><br><span class="line">        channel = channelFactory.newChannel();</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–channel</span></span><br><span class="line">        init(channel);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">        ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–Channelï¼Œæˆ‘ä»¬æ¥é‡ç‚¹çœ‹ä¸‹ init(channel) æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(Channel channel)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// è·å–å¯åŠ¨å™¨ å¯åŠ¨æ—¶é…ç½®çš„optionå‚æ•°ï¼Œä¸»è¦æ˜¯TCPçš„ä¸€äº›å±æ€§</span></span><br><span class="line">    <span class="keyword">final</span> Map&lt;ChannelOption&lt;?&gt;, Object&gt; options = options0();</span><br><span class="line">    <span class="comment">// å°†è·å¾—åˆ° options é…ç½®åˆ° ChannelConfig ä¸­å»</span></span><br><span class="line">    <span class="keyword">synchronized</span> (options) &#123;</span><br><span class="line">        setChannelOptions(channel, options, logger);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å– ServerBootstrap å¯åŠ¨æ—¶é…ç½®çš„ attr å‚æ•°</span></span><br><span class="line">    <span class="keyword">final</span> Map&lt;AttributeKey&lt;?&gt;, Object&gt; attrs = attrs0();</span><br><span class="line">    <span class="comment">// é…ç½® Channel attrï¼Œä¸»è¦æ˜¯è®¾ç½®ç”¨æˆ·è‡ªå®šä¹‰çš„ä¸€äº›å‚æ•°</span></span><br><span class="line">    <span class="keyword">synchronized</span> (attrs) &#123;</span><br><span class="line">        <span class="keyword">for</span> (Entry&lt;AttributeKey&lt;?&gt;, Object&gt; e: attrs.entrySet()) &#123;</span><br><span class="line">            <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">            AttributeKey&lt;Object&gt; key = (AttributeKey&lt;Object&gt;) e.getKey();</span><br><span class="line">            channel.attr(key).set(e.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// è·å–channelä¸­çš„ pipelineï¼Œè¿™ä¸ªpipelineä½¿æˆ‘ä»¬å‰é¢åœ¨channelåˆ›å»ºè¿‡ç¨‹ä¸­è®¾ç½®çš„ pipeline</span></span><br><span class="line">    ChannelPipeline p = channel.pipeline();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†å¯åŠ¨å™¨ä¸­é…ç½®çš„ childGroup ä¿å­˜åˆ°å±€éƒ¨å˜é‡ currentChildGroup</span></span><br><span class="line">    <span class="keyword">final</span> EventLoopGroup currentChildGroup = childGroup;</span><br><span class="line">    <span class="comment">// å°†å¯åŠ¨å™¨ä¸­é…ç½®çš„ childHandler ä¿å­˜åˆ°å±€éƒ¨å˜é‡ currentChildHandler</span></span><br><span class="line">    <span class="keyword">final</span> ChannelHandler currentChildHandler = childHandler;</span><br><span class="line">    <span class="keyword">final</span> Entry&lt;ChannelOption&lt;?&gt;, Object&gt;[] currentChildOptions;</span><br><span class="line">    <span class="keyword">final</span> Entry&lt;AttributeKey&lt;?&gt;, Object&gt;[] currentChildAttrs;</span><br><span class="line">    <span class="comment">// ä¿å­˜ç”¨æˆ·è®¾ç½®çš„ childOptions åˆ°å±€éƒ¨å˜é‡ currentChildOptions</span></span><br><span class="line">    <span class="keyword">synchronized</span> (childOptions) &#123;</span><br><span class="line">        currentChildOptions = childOptions.entrySet().toArray(newOptionArray(childOptions.size()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¿å­˜ç”¨æˆ·è®¾ç½®çš„ childAttrs åˆ°å±€éƒ¨å˜é‡ currentChildAttrs</span></span><br><span class="line">    <span class="keyword">synchronized</span> (childAttrs) &#123;</span><br><span class="line">        currentChildAttrs = childAttrs.entrySet().toArray(newAttrArray(childAttrs.size()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    p.addLast(<span class="keyword">new</span> ChannelInitializer&lt;Channel&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(<span class="keyword">final</span> Channel ch)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="keyword">final</span> ChannelPipeline pipeline = ch.pipeline();</span><br><span class="line">            <span class="comment">// è·å–å¯åŠ¨å™¨ä¸Šé…ç½®çš„handler</span></span><br><span class="line">            ChannelHandler handler = config.handler();</span><br><span class="line">            <span class="keyword">if</span> (handler != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// æ·»åŠ  handler åˆ° pipeline ä¸­</span></span><br><span class="line">                pipeline.addLast(handler);</span><br><span class="line">            &#125;</span><br><span class="line">            ch.eventLoop().execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="comment">// ç”¨childç›¸å…³çš„å‚æ•°åˆ›å»ºå‡ºä¸€ä¸ªæ–°è¿æ¥æ¥å…¥å™¨ServerBootstrapAcceptor</span></span><br><span class="line">                    <span class="comment">// é€šè¿‡ ServerBootstrapAcceptor å¯ä»¥å°†ä¸€ä¸ªæ–°è¿æ¥ç»‘å®šåˆ°ä¸€ä¸ªçº¿ç¨‹ä¸Šå»</span></span><br><span class="line">                    <span class="comment">// æ¯æ¬¡æœ‰æ–°çš„è¿æ¥è¿›æ¥ ServerBootstrapAcceptor éƒ½ä¼šç”¨childç›¸å…³çš„å±æ€§å¯¹å®ƒä»¬è¿›è¡Œé…ç½®ï¼Œå¹¶æ³¨å†Œåˆ°ChaildGroupä¸Šå»</span></span><br><span class="line">                    pipeline.addLast(<span class="keyword">new</span> ServerBootstrapAcceptor(</span><br><span class="line">                            ch, currentChildGroup, currentChildHandler, currentChildOptions, currentChildAttrs));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¯¹äºæ–°è¿æ¥æ¥å…¥å™¨ ServerBootstrapAcceptor çš„åˆ†æ ï¼Œè¯·æŸ¥çœ‹ <a href="https://wangwei.one/posts/netty-new-connection-acceptor-and-niosocketchannel-analyse.html">åæ–‡</a></p></blockquote><h2 id="Channelæ³¨å†Œ"><a href="#Channelæ³¨å†Œ" class="headerlink" title="Channelæ³¨å†Œ"></a>Channelæ³¨å†Œ</h2><p>åœ¨channelå®Œæˆåˆ›å»ºå’Œåˆå§‹åŒ–ä¹‹åï¼Œæ¥ä¸‹æ¥å°±éœ€è¦å°†å…¶æ³¨å†Œåˆ°äº‹ä»¶è½®å¾ªå™¨Selectorä¸Šå»ã€‚æˆ‘ä»¬å›åˆ° initAndRegister æ¥å£ä¸Šå»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> ChannelFuture <span class="title">initAndRegister</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å– EventLoopGroup ï¼Œå¹¶è°ƒç”¨å®ƒçš„ register æ–¹æ³•æ¥æ³¨å†Œ channel</span></span><br><span class="line">    ChannelFuture regFuture = config().group().register(channel);</span><br><span class="line">    <span class="keyword">if</span> (regFuture.cause() != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (channel.isRegistered()) &#123;</span><br><span class="line">            channel.close();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            channel.unsafe().closeForcibly();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> regFuture;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆä¼šå‘ä¸‹è°ƒç”¨åˆ° SingleThreadEventLoop ä¸­çš„ register æ¥å£ï¼š</p><blockquote><p>å¦‚ä½•è°ƒç”¨åˆ°è¿™é‡Œï¼Œé‡Œé¢çš„ç»†èŠ‚éœ€è¦ç­‰åˆ°åé¢æ–‡ç« è®²åˆ° MultithreadEventExecutorGroup å†è¯¦ç»†è¯´æ˜</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ChannelFuture <span class="title">register</span><span class="params">(<span class="keyword">final</span> ChannelPromise promise)</span> </span>&#123;</span><br><span class="line">    ObjectUtil.checkNotNull(promise, <span class="string">"promise"</span>);</span><br><span class="line">    <span class="comment">// è°ƒç”¨unsafeçš„registeræ¥å£</span></span><br><span class="line">    promise.channel().unsafe().register(<span class="keyword">this</span>, promise);</span><br><span class="line">    <span class="keyword">return</span> promise;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç è·Ÿè¸ªä¸‹å»ï¼Œç›´åˆ° AbstractChannel ä¸­çš„ AbstractUnsafe è¿™ä¸ªç±»ä¸­çš„ register æ¥å£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(EventLoop eventLoop, <span class="keyword">final</span> ChannelPromise promise)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (eventLoop == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"eventLoop"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isRegistered()) &#123;</span><br><span class="line">        promise.setFailure(<span class="keyword">new</span> IllegalStateException(<span class="string">"registered to an event loop already"</span>));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!isCompatible(eventLoop)) &#123;</span><br><span class="line">        promise.setFailure(</span><br><span class="line">                <span class="keyword">new</span> IllegalStateException(<span class="string">"incompatible event loop type: "</span> + eventLoop.getClass().getName()));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†è¯¥Channelä¸eventLoop è¿›è¡Œç»‘å®šï¼Œåç»­ä¸è¯¥channelç›¸å…³çš„IOæ“ä½œéƒ½ç”±eventLoopæ¥å¤„ç†</span></span><br><span class="line">    AbstractChannel.<span class="keyword">this</span>.eventLoop = eventLoop;</span><br><span class="line">	<span class="comment">// åˆæ¬¡æ³¨å†Œæ—¶ eventLoop.inEventLoop() è¿”å›false</span></span><br><span class="line">    <span class="keyword">if</span> (eventLoop.inEventLoop()) &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨å®é™…çš„æ³¨å†Œæ¥å£register0</span></span><br><span class="line">        register0(promise);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            eventLoop.execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="comment">// è°ƒç”¨å®é™…çš„æ³¨å†Œæ¥å£register0</span></span><br><span class="line">                    register0(promise);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            logger.warn(</span><br><span class="line">                    <span class="string">"Force-closing a channel whose registration task was not accepted by an event loop: &#123;&#125;"</span>,</span><br><span class="line">                    AbstractChannel.<span class="keyword">this</span>, t);</span><br><span class="line">            closeForcibly();</span><br><span class="line">            closeFuture.setClosed();</span><br><span class="line">            safeSetFailure(promise, t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>register0æ¥å£ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰æ®µé€»è¾‘ï¼š</p><ul><li><p>doRegister();</p></li><li><p>pipeline.invokeHandlerAddedIfNeeded();</p></li><li>pipeline.fireChannelRegistered();</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">register0</span><span class="params">(ChannelPromise promise)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!promise.setUncancellable() || !ensureOpen(promise)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">boolean</span> firstRegistration = neverRegistered;</span><br><span class="line">        <span class="comment">// è°ƒç”¨ doRegister() æ¥å£</span></span><br><span class="line">        doRegister();</span><br><span class="line">        neverRegistered = <span class="keyword">false</span>;</span><br><span class="line">        registered = <span class="keyword">true</span>;</span><br><span class="line">        </span><br><span class="line">       	<span class="comment">// é€šè¿‡pipelineçš„ä¼ æ’­æœºåˆ¶ï¼Œè§¦å‘handlerAddedäº‹ä»¶</span></span><br><span class="line">        pipeline.invokeHandlerAddedIfNeeded();</span><br><span class="line">        safeSetSuccess(promise);</span><br><span class="line">        <span class="comment">// é€šè¿‡pipelineçš„ä¼ æ’­æœºåˆ¶ï¼Œè§¦å‘channelRegisteredäº‹ä»¶</span></span><br><span class="line">        pipeline.fireChannelRegistered();</span><br><span class="line">        <span class="comment">// è¿˜æ²¡æœ‰ç»‘å®šï¼Œæ‰€ä»¥è¿™é‡Œçš„ isActive() è¿”å›false.</span></span><br><span class="line">        <span class="keyword">if</span> (isActive()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (firstRegistration) &#123;</span><br><span class="line">                pipeline.fireChannelActive();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (config().isAutoRead()) &#123;</span><br><span class="line">                beginRead();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">        closeForcibly();</span><br><span class="line">        closeFuture.setClosed();</span><br><span class="line">        safeSetFailure(promise, t);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥çœ‹ AbstractNioChannel ä¸­çš„ doRegister()æ¥å£ï¼Œæœ€ç»ˆè°ƒç”¨çš„å°±æ˜¯Java JDKåº•å±‚çš„NIO APIæ¥æ³¨å†Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doRegister</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> selected = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// eventLoop().unwrappedSelector()ï¼šè·å–selectorï¼Œå°†åœ¨åé¢ä»‹ç» EventLoop åˆ›å»ºæ—¶ä¼šè®²åˆ°</span></span><br><span class="line">            <span class="comment">// å°†selectoræ³¨å†Œåˆ°Java NIO Channelä¸Š</span></span><br><span class="line">            <span class="comment">// ops è®¾ç½®ä¸º 0ï¼Œè¡¨ç¤ºä¸å…³å¿ƒä»»ä½•äº‹ä»¶</span></span><br><span class="line">            <span class="comment">// att è®¾ç½®ä¸º channelè‡ªèº«ï¼Œè¡¨ç¤ºåé¢è¿˜ä¼šå°†channelå–å‡ºæ¥ç”¨ä½œå®ƒç”¨(åé¢æ–‡ç« ä¼šè®²åˆ°)</span></span><br><span class="line">            selectionKey = javaChannel().register(eventLoop().unwrappedSelector(), <span class="number">0</span>, <span class="keyword">this</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (CancelledKeyException e) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!selected) &#123;</span><br><span class="line">                eventLoop().selectNow();</span><br><span class="line">                selected = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Channelç»‘å®š"><a href="#Channelç»‘å®š" class="headerlink" title="Channelç»‘å®š"></a>Channelç»‘å®š</h2><p>åœ¨å®Œæˆåˆ›å»ºã€åˆå§‹åŒ–ä»¥åŠæ³¨å†Œä¹‹åï¼Œæ¥ä¸‹æ¥å°±æ˜¯Channelç»‘å®šæ“ä½œã€‚</p><blockquote><p>æœ¬å°èŠ‚æ¶‰åŠåˆ°çš„pipelineäº‹ä»¶ä¼ æ’­æœºåˆ¶ï¼Œæˆ‘ä»¬æ”¾åˆ°åé¢çš„æ–‡ç« ä¸­å»è®²è§£ã€‚</p></blockquote><p>ä»å¯åŠ¨å™¨çš„bind()æ¥å£å¼€å§‹ï¼Œå¾€ä¸‹è°ƒç”¨ doBind() æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> ChannelFuture <span class="title">doBind</span><span class="params">(<span class="keyword">final</span> SocketAddress localAddress)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–åŠæ³¨å†Œ</span></span><br><span class="line">    <span class="keyword">final</span> ChannelFuture regFuture = initAndRegister();</span><br><span class="line">    <span class="keyword">final</span> Channel channel = regFuture.channel();</span><br><span class="line">    <span class="keyword">if</span> (regFuture.cause() != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> regFuture;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (regFuture.isDone()) &#123;</span><br><span class="line">        <span class="comment">// At this point we know that the registration was complete and successful.</span></span><br><span class="line">        ChannelPromise promise = channel.newPromise();</span><br><span class="line">        <span class="comment">// è°ƒç”¨ doBind0</span></span><br><span class="line">        doBind0(regFuture, channel, localAddress, promise);</span><br><span class="line">        <span class="keyword">return</span> promise;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ....</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>doBind æ–¹æ³•åˆä¼šè°ƒç”¨ doBind0() æ–¹æ³•ï¼Œåœ¨doBind0()æ–¹æ³•ä¸­ä¼šé€šè¿‡EventLoopå»æ‰§è¡Œchannelçš„bind()ä»»åŠ¡ï¼Œå…³äºEventLoopçš„executeæ¥å£çš„åˆ†æï¼Œè¯·çœ‹åé¢çš„ <a href="https://wangwei.one/posts/netty-nioeventloop-analyse-for-startup.html">æ–‡ç« </a> ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">doBind0</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">final</span> ChannelFuture regFuture, <span class="keyword">final</span> Channel channel,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">final</span> SocketAddress localAddress, <span class="keyword">final</span> ChannelPromise promise)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    channel.eventLoop().execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (regFuture.isSuccess()) &#123;</span><br><span class="line">                <span class="comment">// è°ƒç”¨channel.bindæ¥å£</span></span><br><span class="line">                channel.bind(localAddress, promise).addListener(ChannelFutureListener.CLOSE_ON_FAILURE);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                promise.setFailure(regFuture.cause());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>doBind0() æ–¹æ³•å¾€ä¸‹ä¼šæ¡ç”¨åˆ° <code>pipeline.bind(localAddress, promise);</code> æ–¹æ³•ï¼Œé€šè¿‡pipelineçš„ä¼ æ’­æœºåˆ¶ï¼Œæœ€ç»ˆä¼šè°ƒç”¨åˆ° AbstractChannel.AbstractUnsafe.bind() æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸»è¦åšä¸¤ä»¶äº‹æƒ…ï¼š</p><ul><li>è°ƒç”¨doBind()ï¼šè°ƒç”¨åº•å±‚JDK APIè¿›è¡ŒChannelçš„ç«¯å£ç»‘å®šã€‚</li><li>è°ƒç”¨pipeline.fireChannelActive()ï¼š</li></ul><blockquote><p>å…³äºPipelineçš„ä¼ æ’­æœºåˆ¶ï¼Œè¯·çœ‹ <a href="https://wangwei.one/posts/netty-pipeline-source-analyse-2.html">åæ–‡</a></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">bind</span><span class="params">(<span class="keyword">final</span> SocketAddress localAddress, <span class="keyword">final</span> ChannelPromise promise)</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    ....</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// wasActive åœ¨ç»‘å®šæˆåŠŸå‰ä¸º false</span></span><br><span class="line">    <span class="keyword">boolean</span> wasActive = isActive();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨doBind()è°ƒç”¨JDKåº•å±‚APIè¿›è¡Œç«¯å£ç»‘å®š</span></span><br><span class="line">        doBind(localAddress);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">        safeSetFailure(promise, t);</span><br><span class="line">        closeIfClosed();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// å®Œæˆç»‘å®šä¹‹åï¼ŒisActive() è¿”å›true</span></span><br><span class="line">    <span class="keyword">if</span> (!wasActive &amp;&amp; isActive()) &#123;</span><br><span class="line">        invokeLater(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="comment">// è§¦å‘channelActiveäº‹ä»¶</span></span><br><span class="line">                pipeline.fireChannelActive();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    safeSetSuccess(promise);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿™é‡Œçœ‹æœåŠ¡ç«¯ NioServerSocketChannel å®ç°çš„ doBindæ–¹æ³•ï¼Œæœ€ç»ˆä¼šè°ƒç”¨JDK åº•å±‚ NIO Channelçš„bindæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doBind</span><span class="params">(SocketAddress localAddress)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (PlatformDependent.javaVersion() &gt;= <span class="number">7</span>) &#123;</span><br><span class="line">        javaChannel().bind(localAddress, config.getBacklog());</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        javaChannel().socket().bind(localAddress, config.getBacklog());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨ pipeline.fireChannelActive()ï¼Œå¼€å§‹ä¼ æ’­activeäº‹ä»¶ï¼Œpipelineé¦–å…ˆå°±ä¼šè°ƒç”¨HeadContextèŠ‚ç‚¹è¿›è¡Œäº‹ä»¶ä¼ æ’­ï¼Œä¼šè°ƒç”¨åˆ° DefaultChannelPipeline.HeadContext.channelActive() æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelActive</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// è§¦å‘heanlder çš„ ChannelActive æ–¹æ³•</span></span><br><span class="line">    ctx.fireChannelActive();</span><br><span class="line">    <span class="comment">// è°ƒç”¨æ¥å£readIfIsAutoRead</span></span><br><span class="line">    readIfIsAutoRead();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readIfIsAutoRead</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (channel.config().isAutoRead()) &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨channel.read()</span></span><br><span class="line">        channel.read();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>channel.read() æ–¹æ³•å¾€ä¸‹ä¼šè°ƒç”¨åˆ° AbstractChannelHandlerContext.read() æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ChannelHandlerContext <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è·å–ä¸‹ä¸€ä¸ªChannelHandlerContextèŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">final</span> AbstractChannelHandlerContext next = findContextOutbound();</span><br><span class="line">    <span class="comment">// è·å–EventExecutor</span></span><br><span class="line">    EventExecutor executor = next.executor();</span><br><span class="line">    <span class="keyword">if</span> (executor.inEventLoop()) &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„invokeReadæ¥å£</span></span><br><span class="line">        next.invokeRead();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        Runnable task = next.invokeReadTask;</span><br><span class="line">        <span class="keyword">if</span> (task == <span class="keyword">null</span>) &#123;</span><br><span class="line">            next.invokeReadTask = task = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    next.invokeRead();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        executor.execute(task);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡pipelineçš„äº‹ä»¶ä¼ æ’­æœºåˆ¶ï¼Œæœ€ç»ˆä¼šè°ƒç”¨åˆ° AbstractChannel.AbstractUnsafe.beginRead() æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">beginRead</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertEventLoop();</span><br><span class="line">    <span class="keyword">if</span> (!isActive()) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨ doBeginRead();</span></span><br><span class="line">        doBeginRead();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="keyword">final</span> Exception e) &#123;</span><br><span class="line">        invokeLater(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                pipeline.fireExceptionCaught(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        close(voidPromise());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹ä¸‹ AbstractNioChannel å¯¹doBeginReadæ¥å£çš„å®ç°é€»è¾‘ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨å†Œä¸€ä¸ªOP_ACCEPT</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doBeginRead</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// Channel.read() or ChannelHandlerContext.read() was called</span></span><br><span class="line">    <span class="comment">// è·å–channelæ³¨å†Œæ˜¯çš„è®¾ç½®çš„ selectionKey</span></span><br><span class="line">    <span class="keyword">final</span> SelectionKey selectionKey = <span class="keyword">this</span>.selectionKey;</span><br><span class="line">    <span class="comment">// selectionKeyæ— æ•ˆåˆ™è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span> (!selectionKey.isValid()) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    readPending = <span class="keyword">true</span>;</span><br><span class="line">	<span class="comment">// å‰é¢è®²åˆ°channelåœ¨æ³¨å†Œçš„æ—¶å€™ï¼Œè¿™æ˜¯ interestOps è®¾ç½®çš„æ˜¯ 0</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> interestOps = selectionKey.interestOps();</span><br><span class="line">    <span class="comment">// readInterestOp åœ¨å‰é¢è®²åˆ°channelåˆ›å»ºçš„æ—¶å€™ï¼Œè®¾ç½®å€¼ä¸º SelectionKey.OP_ACCEPT</span></span><br><span class="line">    <span class="keyword">if</span> ((interestOps &amp; readInterestOp) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// æœ€ç»ˆ selectionKey çš„å…´è¶£é›†å°±ä¼šè®¾ç½®ä¸º SelectionKey.OP_ACCEPT</span></span><br><span class="line">        <span class="comment">// è¡¨ç¤ºéšæ—¶å¯ä»¥æ¥æ”¶æ–°è¿æ¥çš„æ¥å…¥</span></span><br><span class="line">        selectionKey.interestOps(interestOps | readInterestOp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å°±åˆ†æå®Œäº†Channelçš„åˆ›å»ºã€åˆå§‹åŒ–ã€æ³¨å†Œã€ç»‘å®šçš„æµç¨‹ã€‚å…¶ä¸­æ¶‰åŠåˆ°çš„EventLoopGroupå’ŒPipelineäº‹ä»¶ä¼ æ’­æœºåˆ¶çš„çŸ¥è¯†ç‚¹ï¼Œæˆ‘ä»¬æ”¾åˆ°åé¢çš„æ–‡ç« ä¸­å»è®²è§£ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://coding.imooc.com/class/230.html" target="_blank" rel="noopener">Javaè¯»æºç ä¹‹Nettyæ·±å…¥å‰–æ</a></li><li><a href="https://www.kancloud.cn/ssj234/netty-source/433213" target="_blank" rel="noopener">https://www.kancloud.cn/ssj234/netty-source/433213</a></li><li><a href="https://segmentfault.com/a/1190000007282789" target="_blank" rel="noopener">https://segmentfault.com/a/1190000007282789</a></li><li><a href="https://segmentfault.com/a/1190000007283053" target="_blank" rel="noopener">https://segmentfault.com/a/1190000007283053</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Netty </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Nettyæ ¸å¿ƒç»„ä»¶ä»‹ç»]]></title>
      <url>/posts/netty-core-assembly-intro.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/pexels-photo-935785.jpeg?imageslim" alt="pexels-photo-935785"></p><p>å‰é¢ï¼Œæˆ‘ä»¬å­¦ä¹ äº†Nettyçš„åŸºæœ¬ <a href="https://wangwei.one/posts/ce42513b.html">åŸç†å’Œæ¶æ„</a> ï¼Œä»Šå¤©æˆ‘ä»¬æ¥å¤§è‡´äº†è§£ä¸€ä¸‹Nettyä¸­çš„å„ä¸ªç»„ä»¶ã€‚</p><a id="more"></a><p>åŒæˆ‘ä»¬ <a href="https://wangwei.one/posts/319e2a29.html">å‰é¢</a> å­¦ä¹ IOä¸NIOä¸€æ ·çš„å¥—è·¯ï¼Œæˆ‘ä»¬å…ˆé€šè¿‡echoæœåŠ¡demoæ¥å­¦ä¹ nettyçš„ä½¿ç”¨ã€‚</p><p><img src="https://img.i7years.com/blog/Netty%20Echo%20Service.png" alt="Netty Echo Service"></p><h2 id="å¼€å‘ç¯å¢ƒ"><a href="#å¼€å‘ç¯å¢ƒ" class="headerlink" title="å¼€å‘ç¯å¢ƒ"></a>å¼€å‘ç¯å¢ƒ</h2><ul><li>JDK &gt;= 8</li><li><a href="https://mvnrepository.com/artifact/io.netty/netty-all/4.1.29.Final" target="_blank" rel="noopener">Netty 4.1.29.Final</a></li></ul><h2 id="ç¼–å†™Echo-Serverä»£ç "><a href="#ç¼–å†™Echo-Serverä»£ç " class="headerlink" title="ç¼–å†™Echo Serverä»£ç "></a>ç¼–å†™Echo Serverä»£ç </h2><p>NettyæœåŠ¡ç«¯çš„å¼€å‘ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªæ­¥éª¤ï¼š</p><ul><li>è‡³å°‘æœ‰ä¸€ä¸ª<strong>ChannelHandler</strong> â€”â€” è¿™ä¸ªä¸»è¦ç”¨äºå¤„ç†ä»clientç«¯æ¥å—åˆ°çš„ä¿¡æ¯ï¼Œæ˜¯ä¸»è¦çš„ä¸šåŠ¡é€»è¾‘å¤„ç†ç±»ã€‚</li><li><strong>Bootstrapping</strong> â€”â€” ç”¨äºé…ç½®æœåŠ¡çš„å¯åŠ¨ä»£ç ã€‚æœ€ç®€å•çš„å°±æ˜¯ï¼Œç›‘å¬ä¸€ä¸ªç«¯å£ã€‚</li></ul><h3 id="å®ç°EchoServerHandleré€»è¾‘"><a href="#å®ç°EchoServerHandleré€»è¾‘" class="headerlink" title="å®ç°EchoServerHandleré€»è¾‘"></a>å®ç°EchoServerHandleré€»è¾‘</h3><p>æœåŠ¡ç«¯ç”¨äºå¤„ç†å…¥ç«™çš„ç½‘ç»œè¯·æ±‚ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å®ç°æ¥å£ç±» <a href="https://netty.io/4.1/api/index.html?io/netty/channel/ChannelInboundHandler.html" target="_blank" rel="noopener">ChannelInboundHandler</a>ï¼Œå®ƒé‡Œé¢å®šä¹‰äº†ç”¨äº</p><p>å¤„ç†å…¥ç«™è¯·æ±‚çš„ä¸€äº›æ¥å£ã€‚ç”±äºæˆ‘ä»¬è¿™ä¸ªä¾‹å­æ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦ç”¨åˆ°å®ƒçš„å‡ ä¸ªæ–¹æ³•å³å¯ï¼Œå› æ­¤æˆ‘ä»¬çš„å®ç°ç±»åªéœ€è¦ç»§æ‰¿å­ç±» <a href="https://netty.io/4.1/api/index.html?io/netty/channel/ChannelInboundHandlerAdapter.html" target="_blank" rel="noopener">ChannelInboundHandlerAdapter</a> å³å¯ï¼Œå®ƒé»˜è®¤å®ç°äº† <a href="https://netty.io/4.1/api/index.html?io/netty/channel/ChannelInboundHandler.html" target="_blank" rel="noopener">ChannelInboundHandler</a> ä¸­çš„æ¥å£ã€‚</p><p>æœ‰å‡ ä¸ªæ–¹æ³•éœ€è¦ç•™æ„ä¸€ä¸‹ï¼š</p><ul><li><strong>channelRead()</strong> â€”â€” æ¯å½“æœ‰å…¥ç«™è¯·æ±‚æ¥ä¸´æ—¶ï¼Œè¯¥æ–¹æ³•éƒ½ä¼šè¢«è°ƒç”¨</li><li><strong>channelReadComplete()</strong> â€”â€” å¯¹channelRead() çš„æœ€åä¸€æ¬¡è°ƒç”¨æ˜¯å½“å‰æ‰¹å¤„ç†ä¸­çš„æœ€åä¸€æ¡æ¶ˆæ¯æ—¶ï¼Œè¯¥æ–¹æ³•ä¼šè¢«è°ƒç”¨</li><li><strong>exceptionCaught()</strong> â€”â€” åœ¨readæ“ä½œæ‰§è¡ŒæœŸé—´ï¼Œå¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œè¯¥æ–¹æ³•åˆ™ä¼šè¢«è°ƒç”¨ã€‚</li></ul><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @Sharableè±¡å¾ç€è¯¥ChannelHandlerå®ä¾‹åœ¨å¤šä¸ªchannelsä¹‹é—´å¯ä»¥è¢«å®‰å…¨åœ°åˆ†äº«</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Sharable</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EchoServerHandler</span> <span class="keyword">extends</span> <span class="title">ChannelInboundHandlerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> </span>&#123;</span><br><span class="line">        ByteBuf in = (ByteBuf) msg;</span><br><span class="line">        <span class="comment">// æ‰“å°æ¶ˆæ¯æ—¥å¿—</span></span><br><span class="line">        System.out.println(<span class="string">"Server received: "</span> + in.toString(CharsetUtil.UTF_8));</span><br><span class="line">        <span class="comment">// å°†å…¥ç«™æ¶ˆæ¯å‘é€ç»™å‘é€è€…ï¼Œä½†ä¸å†²åˆ·å‡ºç«™æ¶ˆæ¯</span></span><br><span class="line">        ctx.write(in);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelReadComplete</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// å°†å¾…å¤„ç†çš„æ¶ˆæ¯å†²åˆ·åˆ°è¿œç¨‹èŠ‚ç‚¹ä¸Šï¼Œå¹¶å…³é—­Channel</span></span><br><span class="line">        ctx.writeAndFlush(Unpooled.EMPTY_BUFFER)</span><br><span class="line">                .addListener(ChannelFutureListener.CLOSE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ‰“å°å †æ ˆä¿¡æ¯</span></span><br><span class="line">        cause.printStackTrace();</span><br><span class="line">        <span class="comment">// å…³é—­channel</span></span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°EchoServeré€»è¾‘"><a href="#å®ç°EchoServeré€»è¾‘" class="headerlink" title="å®ç°EchoServeré€»è¾‘"></a>å®ç°EchoServeré€»è¾‘</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ <a href="https://netty.io/4.1/api/io/netty/bootstrap/ServerBootstrap.html" target="_blank" rel="noopener">ServerBootstrap</a> æ¥å®ç°æœåŠ¡ç«¯çš„å¼€å‘ï¼Œä¸»è¦ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p><ul><li>ç»‘å®šä¸€ä¸ªç›‘å¬ç«¯å£</li><li>é…ç½®Channelsï¼Œå½“æœ‰å…¥ç«™æ¶ˆæ¯åˆ°è¾¾æ—¶ï¼Œé€šçŸ¥ EchoServerHeadler å®ä¾‹ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> nia.chapter2.echoserver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.bootstrap.ServerBootstrap;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelFuture;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInitializer;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.EventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EchoServer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> port;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">EchoServer</span><span class="params">(<span class="keyword">int</span> port)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.port = port;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (args.length != <span class="number">1</span>) &#123;</span><br><span class="line">            System.err.println(<span class="string">"Usage: "</span> + EchoServer.class.getSimpleName() + <span class="string">" &lt;port&gt;"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> port = Integer.parseInt(args[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">new</span> EchoServer(port).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> EchoServerHandler serverHandler = <span class="keyword">new</span> EchoServerHandler();</span><br><span class="line">        <span class="comment">// åˆ›å»º EventLoopGroup å®ä¾‹</span></span><br><span class="line">        EventLoopGroup group = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ›å»º ServerBootstrap å®ä¾‹</span></span><br><span class="line">            ServerBootstrap b = <span class="keyword">new</span> ServerBootstrap();</span><br><span class="line">            b.group(group)</span><br><span class="line">                	<span class="comment">// æ‰§è¡ŒChannelçš„ç±»å‹ä¸ºï¼šNioServerSocketChannel</span></span><br><span class="line">                    .channel(NioServerSocketChannel.class)</span><br><span class="line">                	<span class="comment">// ç»‘å®šç«¯å£</span></span><br><span class="line">                    .localAddress(<span class="keyword">new</span> InetSocketAddress(port))</span><br><span class="line">                	<span class="comment">// å°†EchoServerHandleræ·»åŠ åˆ°ChannelPipelineä¸­å»</span></span><br><span class="line">                    .childHandler(<span class="keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(SocketChannel ch)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                            <span class="comment">// EchoServerHandleræœ‰æ³¨è§£ @Sharableï¼Œå› æ­¤æˆ‘ä»¬æ€»æ˜¯å¯ä»¥ä½¿ç”¨æ”¹å®ä¾‹</span></span><br><span class="line">                            ch.pipeline().addLast(serverHandler);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">			<span class="comment">// å¼‚æ­¥ç»‘å®šæœåŠ¡ï¼Œsync() ç”¨äºç­‰å¾…ç»‘å®šå®Œæˆ</span></span><br><span class="line">            ChannelFuture f = b.bind().sync();</span><br><span class="line">            System.out.println(EchoServer.class.getName() +</span><br><span class="line">                    <span class="string">" started and listening for connections on "</span> + f.channel().localAddress());</span><br><span class="line">            <span class="comment">// è·å–Channelçš„CloseFutrueï¼Œåœ¨å®Œæˆä¹‹å‰ä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€</span></span><br><span class="line">            f.channel().closeFuture().sync();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// å…³é—­æ‰€æœ‰ EventLoopGroupï¼Œå¹¶é‡Šæ”¾æ‰€æœ‰èµ„æº</span></span><br><span class="line">            group.shutdownGracefully().sync();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¼–å†™Echo-Clientä»£ç "><a href="#ç¼–å†™Echo-Clientä»£ç " class="headerlink" title="ç¼–å†™Echo Clientä»£ç "></a>ç¼–å†™Echo Clientä»£ç </h2><p>Echo Clientä»£ç é€»è¾‘ï¼š</p><ol><li>è¿æ¥æœåŠ¡å™¨</li><li>å‘é€ä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆæ¯</li><li>ç­‰å¾…æœåŠ¡ç«¯è¿”å›åŒæ ·çš„æ¶ˆæ¯</li><li>å…³é—­è¿æ¥</li></ol><h3 id="å®ç°EchoClientHandleré€»è¾‘"><a href="#å®ç°EchoClientHandleré€»è¾‘" class="headerlink" title="å®ç°EchoClientHandleré€»è¾‘"></a>å®ç°EchoClientHandleré€»è¾‘</h3><p>åŒæœåŠ¡ç«¯ä¸€æ ·ï¼Œå®¢æˆ·ç«¯ä¹Ÿè¦å®ç° <a href="https://netty.io/4.1/api/index.html?io/netty/channel/ChannelInboundHandler.html" target="_blank" rel="noopener">ChannelInboundHandler</a> æ¥å£ï¼Œå®¢æˆ·ç«¯éœ€è¦ç»§æ‰¿ <a href="https://netty.io/4.1/api/index.html?io/netty/channel/SimpleChannelInboundHandler.html" target="_blank" rel="noopener">SimpleChannelInboundHandler</a> ï¼Œæœ‰ä»¥ä¸‹ä¸‰ä¸ªæ¥å£éœ€è¦é‡å†™ï¼š</p><ul><li><strong>channelActive()</strong> â€”â€” å½“è¿æ¥å»ºç«‹æ—¶ï¼Œè°ƒç”¨è¯¥æ–¹æ³•</li><li><strong>channelRead0()</strong> â€”â€” å½“æ¥æ”¶åˆ°æœåŠ¡ç«¯çš„æ¶ˆæ¯æ—¶ï¼Œè°ƒç”¨è¯¥æ–¹æ³•</li><li><strong>exceptionCaught()</strong> â€”â€” å½“æœ‰å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œæ‰§è¡Œè¯¥æ–¹æ³•</li></ul><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> nia.chapter2.echoclient;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.ByteBuf;</span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.Unpooled;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandler.Sharable;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.SimpleChannelInboundHandler;</span><br><span class="line"><span class="keyword">import</span> io.netty.util.CharsetUtil;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @Sharableç”¨äºæ ‡è®°EchoClientHandlerï¼Œå¯ä»¥åœ¨channelä¸­åˆ†äº«ä½¿ç”¨</span></span><br><span class="line"><span class="meta">@Sharable</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EchoClientHandler</span> <span class="keyword">extends</span> <span class="title">SimpleChannelInboundHandler</span>&lt;<span class="title">ByteBuf</span>&gt; </span>&#123;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelActive</span><span class="params">(ChannelHandlerContext ctx)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä¸€æ—¦è¿æ¥å»ºç«‹ï¼Œå°†ä¼šå‘é€æ¶ˆæ¯</span></span><br><span class="line">        ctx.writeAndFlush(Unpooled.copiedBuffer(<span class="string">"Netty rocks!"</span>,CharsetUtil.UTF_8));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead0</span><span class="params">(ChannelHandlerContext ctx, ByteBuf in)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è®°å½•æ”¶åˆ°çš„æ¶ˆæ¯</span></span><br><span class="line">        System.out.println(<span class="string">"Client received: "</span> + in.toString(CharsetUtil.UTF_8));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ‰“å°å †æ ˆä¿¡æ¯</span></span><br><span class="line">        cause.printStackTrace();</span><br><span class="line">        <span class="comment">// å…³é—­channel</span></span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°-EchoClient-é€»è¾‘"><a href="#å®ç°-EchoClient-é€»è¾‘" class="headerlink" title="å®ç° EchoClient é€»è¾‘"></a>å®ç° EchoClient é€»è¾‘</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> nia.chapter2.echoclient;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.bootstrap.Bootstrap;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelFuture;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInitializer;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.EventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioSocketChannel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EchoClient</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String host;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> port;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">EchoClient</span><span class="params">(String host, <span class="keyword">int</span> port)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.host = host;</span><br><span class="line">        <span class="keyword">this</span>.port = port;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        EventLoopGroup group = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ›å»ºBootstrap</span></span><br><span class="line">            Bootstrap b = <span class="keyword">new</span> Bootstrap();</span><br><span class="line">            <span class="comment">// æŒ‡å®šä½¿ç”¨ NioEventLoopGroup å»å¤„ç†å®¢æˆ·ç«¯äº‹ä»¶</span></span><br><span class="line">            b.group(group)</span><br><span class="line">                <span class="comment">// æŒ‡å®šchannelç±»å‹ä¸ºNIO</span></span><br><span class="line">                .channel(NioSocketChannel.class)</span><br><span class="line">                <span class="comment">// æŒ‡å®šè¦è¿æ¥çš„è¿œç¨‹åœ°å€</span></span><br><span class="line">                .remoteAddress(<span class="keyword">new</span> InetSocketAddress(host, port))</span><br><span class="line">                <span class="comment">// å°† EchoClientHandler æ·»åŠ åˆ° pipelineä¸­</span></span><br><span class="line">                .handler(<span class="keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(SocketChannel ch)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        ch.pipeline().addLast(<span class="keyword">new</span> EchoClientHandler());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            <span class="comment">// è¿æ¥è¿œç¨‹åœ°å€ï¼Œä¸€ç›´ç­‰å¾…ç›´åˆ°è¿æ¥å®Œæˆ</span></span><br><span class="line">            ChannelFuture f = b.connect().sync();</span><br><span class="line">            <span class="comment">// åœ¨channelå…³é—­å‰ä¸€ç›´å¤„äºblockçŠ¶æ€</span></span><br><span class="line">            f.channel().closeFuture().sync();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// å…³é—­çº¿ç¨‹æ± ï¼Œé‡Šæ”¾æ‰€æœ‰èµ„æº</span></span><br><span class="line">            group.shutdownGracefully().sync();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (args.length != <span class="number">2</span>) &#123;</span><br><span class="line">            System.err.println(<span class="string">"Usage: "</span> + EchoClient.class.getSimpleName() +</span><br><span class="line">                    <span class="string">" &lt;host&gt; &lt;port&gt;"</span></span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> String host = args[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> port = Integer.parseInt(args[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">new</span> EchoClient(host, port).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸ºä»€ä¹ˆclientä½¿ç”¨SimpleChannelInboundHandler ï¼Œè€Œserverç«¯ä½¿ç”¨ChannelInboundHandlerAdapter çš„åŒºåˆ« ï¼Ÿ</p><p>åœ¨Clientä¸­ï¼ŒchannelRead0()å®Œæˆæ—¶ï¼Œæ¶ˆæ¯å·²ç»å¤„ç†å®Œã€‚å½“è¯¥æ–¹æ³•è¿”å›æ—¶ï¼ŒSimpleChannelInboundHandler ä¼šé‡Šæ”¾ä¿å­˜è¯¥æ¶ˆæ¯çš„ByteBufçš„å†…å­˜å¼•ç”¨ã€‚</p><p>åœ¨Serverä¸­ï¼Œæ¥æ”¶å®Œæ¶ˆæ¯åï¼Œè¿˜éœ€è¦å°†æ¶ˆæ¯å›ä¼ ç»™å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”wirte()æ˜¯å¼‚æ­¥çš„ï¼Œå½“channelRead() å®Œæˆæ—¶ï¼Œæ¶ˆæ¯å†…å­˜è¿˜æ²¡æœ‰è¢«é‡Šæ”¾ã€‚éœ€è¦ç­‰åˆ°channelReadComplete()ä¸­è°ƒç”¨writeAndFlush()æ‰ä¼šè¢«é‡Šæ”¾ã€‚</p></blockquote><h2 id="Nettyç»„ä»¶"><a href="#Nettyç»„ä»¶" class="headerlink" title="Nettyç»„ä»¶"></a>Nettyç»„ä»¶</h2><p>è¿™é‡Œæˆ‘ä»¬å…ˆç®€è¦äº†è§£ä¸€ä¸‹ä»¥ä¸‹å‡ ä¸ªç»„ä»¶çš„ä½œç”¨ï¼Œç•™ä¸ªæ˜ åƒï¼Œåé¢æˆ‘ä»¬ä¼šå¯¹æ¯ä¸ªç»„ä»¶åšè¯¦ç»†æ·±å…¥ã€‚</p><p><strong>Channel</strong></p><p>åŒæˆ‘ä»¬å‰é¢å­¦ä¹  <a href="https://wangwei.one/posts/d7aa1132.html">Java NIO Channel</a> ç±»ä¼¼ï¼ŒNetty Channelåœ¨æ­¤åŸºç¡€ä¸Šåšäº†é«˜åº¦æŠ½è±¡çš„å°è£…ï¼Œä¸»è¦ç”¨äºç½‘ç»œI/Oæ•°æ®çš„åŸºæœ¬æ“ä½œï¼Œå¦‚bind()ã€connect()ã€read()ã€write()ç­‰ã€‚</p><p><strong>EventLoop</strong></p><p>åœ¨ç½‘ç»œè¿æ¥çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…ï¼Œå‘ç”Ÿçš„æ‰€æœ‰äº‹ä»¶çš„å¤„ç†ä¸»è¦æœ‰EventLoopæ¥å¤„ç†</p><p><strong>ChannelFuture</strong></p><p>åœ¨Nettyä¸­ï¼ŒI/Oæ“ä½œä¸»è¦éƒ½æ˜¯å¼‚æ­¥è¿›è¡Œï¼Œå½“æ“ä½œå‘ç”Ÿæ—¶ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ä¸€ç§æ–¹å¼æ¥çŸ¥é“æ“ä½œåœ¨æœªæ¥çš„æ—¶é—´ç‚¹çš„æ‰§è¡Œç»“æœã€‚ChannelFutrueä¸­çš„addListener()æ–¹æ³•ï¼Œå¯ä»¥æ³¨å†Œç›‘å¬å™¨ChannelFutureListenerï¼Œå½“æ“ä½œå®Œæˆæ—¶ï¼Œç›‘å¬å™¨å¯ä»¥ä¸»åŠ¨é€šçŸ¥æˆ‘ä»¬ã€‚</p><p><strong>ChannelHandler</strong></p><p>channelHandlerä¸»è¦ç”¨äºåº”ç”¨ç¨‹åºä¸­çš„ä¸šåŠ¡é€»è¾‘çš„å¤„ç†ï¼Œç½‘ç»œä¸­çš„è¿›å…¥ä¸å‡ºå»çš„æ•°æ®éƒ½ç»ç”±å®ƒå¤„ç†ï¼Œå½“æœ‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼ŒchannelHandlerä¼šè¢«è§¦å‘æ‰§è¡Œã€‚</p><p><strong>ChannelPipeline</strong></p><p>ChannelPipelineæä¾›äº†ä¸€ç§å®¹å™¨ï¼Œç”¨äºå®šä¹‰æ•°æ®æµå…¥ä¸æµå‡ºè¿‡ç¨‹ä¸­çš„å¤„ç†æµç¨‹ã€‚å¯ä»¥å°†Pipelineçœ‹ä½œæ˜¯ä¸€æ¡æµæ°´çº¿ï¼ŒåŸå§‹çš„åŸæ–™(å­—èŠ‚æµ)è¿›æ¥ï¼Œç»è¿‡åŠ å·¥ï¼Œæœ€åè¾“å‡ºã€‚</p><p><strong>Bootstrapping</strong></p><p>ä¸»è¦ç”¨äºé…ç½®æœåŠ¡ç«¯æˆ–å®¢æˆ·ç«¯çš„Nettyç¨‹åºçš„å¯åŠ¨ä¿¡æ¯ã€‚</p><p><strong>ByteBuf</strong></p><p>å­—èŠ‚æ•°æ®å®¹å™¨ï¼Œæä¾›æ¯” <a href="https://wangwei.one/posts/40e0e28f.html">Java NIO ByteBuffer</a> æ›´å¥½çš„çš„APIã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://github.com/wangweiX/myBooks/blob/master/computer/netty/Netty%20in%20Action.epub" target="_blank" rel="noopener">ã€ŠNetty in actionã€‹</a></li><li><a href="http://tutorials.jenkov.com/netty/overview.html" target="_blank" rel="noopener">http://tutorials.jenkov.com/netty/overview.html</a></li><li><a href="https://github.com/normanmaurer/netty-in-action/tree/2.0-SNAPSHOT/chapter2" target="_blank" rel="noopener">æºä»£ç </a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Netty </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[NettyåŸºæœ¬åŸç†ä»‹ç»]]></title>
      <url>/posts/netty-base-theory-intro.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/pexels-photo-1193743.jpeg?imageslim" alt="pexels-photo-1193743"></p><p>æ­¤å‰ï¼Œæˆ‘ä»¬å­¦ä¹ äº† <a href="https://wangwei.one/tags/NIO/">Java NIO API</a> çš„ä½¿ç”¨ï¼Œä¹Ÿå­¦ä¹ äº†å‡ ç§å¸¸è§çš„ <a href="https://wangwei.one/posts/26906a0d.html">IOæ¨¡å‹</a> ä»¥åŠä¼ ç»Ÿé˜»å¡I/OæœåŠ¡æ¨¡å‹å’Œ <a href="https://wangwei.one/posts/e5250930.html">Reactorçº¿ç¨‹æ¨¡å‹</a> ã€‚ä½ ä½“ä¼šåˆ°ç›´æ¥å»ä½¿ç”¨Java NIO APIå»è¿›è¡Œç½‘ç»œç¼–ç¨‹ä¼šéå¸¸éº»çƒ¦ï¼Œé™¤äº†è¦å¯¹Java NIO APIæŒæ¡çš„éå¸¸ç†Ÿç»ƒä¹‹å¤–ï¼Œè¿˜éœ€è¦æŒæ¡å¤šçº¿ç¨‹ç­‰å…¶ä»–æŠ€æœ¯ã€‚ä¸è¿‡è¿™äº›é—®é¢˜ï¼ŒNettyéƒ½å¯ä»¥å¸®æˆ‘ä»¬è§£å†³ã€‚</p><a id="more"></a><p><a href="http://netty.io/" target="_blank" rel="noopener">Netty</a> æ˜¯ä¸€ä¸ªNIOå®¢æˆ·ç«¯æœåŠ¡å™¨æ¡†æ¶ï¼Œå¯ä»¥å¿«é€Ÿè½»æ¾åœ°å¼€å‘åè®®æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ç­‰ç½‘ç»œåº”ç”¨ç¨‹åºã€‚ å®ƒæå¤§åœ°ç®€åŒ–äº†TCPå’ŒUDPå¥—æ¥å­—æœåŠ¡å™¨ç­‰ç½‘ç»œç¼–ç¨‹çš„å¤æ‚åº¦ã€‚</p><p>ã€å¿«é€Ÿè€Œåˆç®€å•ã€å¹¶ä¸æ„å‘³ç€æœ€ç»ˆçš„åº”ç”¨ç¨‹åºä¼šå—åˆ°å¯ç»´æŠ¤æ€§æˆ–æ€§èƒ½é—®é¢˜çš„å½±å“ã€‚ Nettyç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œå…·æœ‰ä¸°å¯Œçš„åè®®ï¼Œå¦‚FTPï¼ŒSMTPï¼ŒHTTPä»¥åŠå„ç§äºŒè¿›åˆ¶å’ŒåŸºäºæ–‡æœ¬çš„ä¼ ç»Ÿåè®®ã€‚ å› æ­¤ï¼ŒNettyæˆåŠŸåœ°æ‰¾åˆ°äº†ä¸€ç§åœ¨ä¸å¦¥åçš„æƒ…å†µä¸‹å®ç°æ˜“äºå¼€å‘ï¼Œæ€§èƒ½ï¼Œç¨³å®šæ€§å’Œçµæ´»æ€§çš„æ–¹æ³•ã€‚</p><h2 id="æœåŠ¡ç«¯IOç¼–ç¨‹"><a href="#æœåŠ¡ç«¯IOç¼–ç¨‹" class="headerlink" title="æœåŠ¡ç«¯IOç¼–ç¨‹"></a>æœåŠ¡ç«¯IOç¼–ç¨‹</h2><h3 id="ä¼ ç»Ÿçš„BIOç¼–ç¨‹"><a href="#ä¼ ç»Ÿçš„BIOç¼–ç¨‹" class="headerlink" title="ä¼ ç»Ÿçš„BIOç¼–ç¨‹"></a>ä¼ ç»Ÿçš„BIOç¼–ç¨‹</h3><p>ç½‘ç»œç¼–ç¨‹çš„åŸºæœ¬æ¨¡å‹æ˜¯Client/Serveræ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´è¿›è¡Œç›¸äº’é€šä¿¡ï¼Œå…¶ä¸­æœåŠ¡ç«¯æä¾›ä½ç½®ä¿¡æ¯ï¼ˆç»‘å®šçš„IPåœ°å€å’Œç›‘å¬ç«¯å£ï¼‰ï¼Œå®¢æˆ·ç«¯é€šè¿‡è¿æ¥æ“ä½œå‘æœåŠ¡ç«¯ç›‘å¬çš„åœ°å€å‘èµ·è¿æ¥è¯·æ±‚ï¼Œé€šè¿‡ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥ï¼Œå¦‚æœè¿æ¥å»ºç«‹æˆåŠŸï¼ŒåŒæ–¹å°±å¯ä»¥é€šè¿‡ç½‘ç»œå¥—æ¥å­—ï¼ˆSocketï¼‰è¿›è¡Œé€šä¿¡ã€‚</p><p>åœ¨åŸºäºä¼ ç»ŸåŒæ­¥é˜»å¡æ¨¡å‹å¼€å‘ä¸­ï¼ŒServerSocketè´Ÿè´£ç»‘å®šIPåœ°å€ï¼Œå¯åŠ¨ç›‘å¬ç«¯å£ï¼›Socketè´Ÿè´£å‘èµ·è¿æ¥æ“ä½œã€‚è¿æ¥æˆåŠŸä¹‹åï¼ŒåŒæ–¹é€šè¿‡è¾“å…¥å’Œè¾“å‡ºæµè¿›è¡ŒåŒæ­¥é˜»å¡å¼é€šä¿¡ã€‚</p><p><img src="https://img.i7years.com/blog/Server-BIO.png" alt="Server-BIO"></p><p>é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡å¦‚å›¾æ‰€ç¤ºçš„é€šä¿¡æ¨¡å‹å›¾æ¥ç†Ÿæ‚‰ä¸‹BIOçš„æœåŠ¡ç«¯é€šä¿¡æ¨¡å‹ï¼šé‡‡ç”¨BIOé€šä¿¡æ¨¡å‹çš„æœåŠ¡ç«¯ï¼Œé€šå¸¸ç”±ä¸€ä¸ªç‹¬ç«‹çš„Acceptorçº¿ç¨‹è´Ÿè´£ç›‘å¬å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå®ƒæ¥æ”¶åˆ°å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ä¹‹åä¸ºæ¯ä¸ªå®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹è¿›è¡Œé“¾è·¯å¤„ç†ï¼Œå¤„ç†å®Œæˆä¹‹åï¼Œé€šè¿‡è¾“å‡ºæµè¿”å›åº”ç­”ç»™å®¢æˆ·ç«¯ï¼Œçº¿ç¨‹é”€æ¯ã€‚è¿™å°±æ˜¯å…¸å‹çš„ä¸€è¯·æ±‚ä¸€åº”ç­”é€šä¿¡æ¨¡å‹â€</p><p>è¯¥æ¨¡å‹æœ€å¤§çš„é—®é¢˜å°±æ˜¯ç¼ºä¹å¼¹æ€§ä¼¸ç¼©èƒ½åŠ›ï¼Œå½“å®¢æˆ·ç«¯å¹¶å‘è®¿é—®é‡å¢åŠ åï¼ŒæœåŠ¡ç«¯çš„çº¿ç¨‹ä¸ªæ•°å’Œå®¢æˆ·ç«¯å¹¶å‘è®¿é—®æ•°å‘ˆ1ï¼š1çš„æ­£æ¯”å…³ç³»ï¼Œç”±äºçº¿ç¨‹æ˜¯Javaè™šæ‹Ÿæœºéå¸¸å®è´µçš„ç³»ç»Ÿèµ„æºï¼Œå½“çº¿ç¨‹æ•°è†¨èƒ€ä¹‹åï¼Œç³»ç»Ÿçš„æ€§èƒ½å°†æ€¥å‰§ä¸‹é™ï¼Œéšç€å¹¶å‘è®¿é—®é‡çš„ç»§ç»­å¢å¤§ï¼Œç³»ç»Ÿä¼šå‘ç”Ÿçº¿ç¨‹å †æ ˆæº¢å‡ºã€åˆ›å»ºæ–°çº¿ç¨‹å¤±è´¥ç­‰é—®é¢˜ï¼Œå¹¶æœ€ç»ˆå¯¼è‡´è¿›ç¨‹å®•æœºæˆ–è€…åƒµæ­»ï¼Œä¸èƒ½å¯¹å¤–æä¾›æœåŠ¡ã€‚</p><h3 id="ä¼ªå¼‚æ­¥I-Oç¼–ç¨‹"><a href="#ä¼ªå¼‚æ­¥I-Oç¼–ç¨‹" class="headerlink" title="ä¼ªå¼‚æ­¥I/Oç¼–ç¨‹"></a>ä¼ªå¼‚æ­¥I/Oç¼–ç¨‹</h3><p>ä¸ºäº†è§£å†³åŒæ­¥é˜»å¡I/Oé¢ä¸´çš„ä¸€ä¸ªé“¾è·¯éœ€è¦ä¸€ä¸ªçº¿ç¨‹å¤„ç†çš„é—®é¢˜ï¼Œåæ¥æœ‰äººå¯¹å®ƒçš„çº¿ç¨‹æ¨¡å‹è¿›è¡Œäº†ä¼˜åŒ–ï¼Œåç«¯é€šè¿‡ä¸€ä¸ªçº¿ç¨‹æ± æ¥å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚æ¥å…¥ï¼Œå½¢æˆå®¢æˆ·ç«¯ä¸ªæ•°Mï¼šçº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°Nçš„æ¯”ä¾‹å…³ç³»ï¼Œå…¶ä¸­Må¯ä»¥è¿œè¿œå¤§äºNï¼Œé€šè¿‡çº¿ç¨‹æ± å¯ä»¥çµæ´»çš„è°ƒé…çº¿ç¨‹èµ„æºï¼Œè®¾ç½®çº¿ç¨‹çš„æœ€å¤§å€¼ï¼Œé˜²æ­¢ç”±äºæµ·é‡å¹¶å‘æ¥å…¥å¯¼è‡´çº¿ç¨‹è€—å°½ã€‚</p><p>é‡‡ç”¨çº¿ç¨‹æ± å’Œä»»åŠ¡é˜Ÿåˆ—å¯ä»¥å®ç°ä¸€ç§å«åšä¼ªå¼‚æ­¥çš„I/Oé€šä¿¡æ¡†æ¶ï¼Œå®ƒçš„æ¨¡å‹å›¾å¦‚å›¾1-2æ‰€ç¤ºã€‚<br>å½“æœ‰æ–°çš„å®¢æˆ·ç«¯æ¥å…¥çš„æ—¶å€™ï¼Œå°†å®¢æˆ·ç«¯çš„Socketå°è£…æˆä¸€ä¸ªTaskï¼ˆè¯¥ä»»åŠ¡å®ç°java.lang.Runnableæ¥å£ï¼‰æŠ•é€’åˆ°åç«¯çš„çº¿ç¨‹æ± ä¸­è¿›è¡Œå¤„ç†ï¼ŒJDKçš„çº¿ç¨‹æ± ç»´æŠ¤ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—å’ŒNä¸ªæ´»è·ƒçº¿ç¨‹å¯¹æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡è¿›è¡Œå¤„ç†ã€‚ç”±äºçº¿ç¨‹æ± å¯ä»¥è®¾ç½®æ¶ˆæ¯é˜Ÿåˆ—çš„å¤§å°å’Œæœ€å¤§çº¿ç¨‹æ•°ï¼Œå› æ­¤ï¼Œå®ƒçš„èµ„æºå ç”¨æ˜¯å¯æ§çš„ï¼Œæ— è®ºå¤šå°‘ä¸ªå®¢æˆ·ç«¯å¹¶å‘è®¿é—®ï¼Œéƒ½ä¸ä¼šå¯¼è‡´èµ„æºçš„è€—å°½å’Œå®•æœºã€‚</p><p><img src="https://img.i7years.com/blog/Server-BIO-Thread-Pool.png" alt="Server-BIO-Thread-Pool"></p><p>ä¼ªå¼‚æ­¥I/Oå®é™…ä¸Šä»…ä»…åªæ˜¯å¯¹ä¹‹å‰I/Oçº¿ç¨‹æ¨¡å‹çš„ä¸€ä¸ªç®€å•ä¼˜åŒ–ï¼Œå®ƒæ— æ³•ä»æ ¹æœ¬ä¸Šè§£å†³åŒæ­¥I/Oå¯¼è‡´çš„é€šä¿¡çº¿ç¨‹é˜»å¡é—®é¢˜ã€‚ä¸‹é¢æˆ‘ä»¬å°±ç®€å•åˆ†æä¸‹å¦‚æœé€šä¿¡å¯¹æ–¹è¿”å›åº”ç­”æ—¶é—´è¿‡é•¿ï¼Œä¼šå¼•èµ·çš„çº§è”æ•…éšœã€‚</p><ol><li>æœåŠ¡ç«¯å¤„ç†ç¼“æ…¢ï¼Œè¿”å›åº”ç­”æ¶ˆæ¯è€—è´¹60sï¼Œå¹³æ—¶åªéœ€è¦10msã€‚</li><li>é‡‡ç”¨ä¼ªå¼‚æ­¥I/Oçš„çº¿ç¨‹æ­£åœ¨è¯»å–æ•…éšœæœåŠ¡èŠ‚ç‚¹çš„å“åº”ï¼Œç”±äºè¯»å–è¾“å…¥æµæ˜¯é˜»å¡çš„ï¼Œå› æ­¤ï¼Œå®ƒå°†ä¼šè¢«åŒæ­¥é˜»å¡60sã€‚</li><li>å‡å¦‚æ‰€æœ‰çš„å¯ç”¨çº¿ç¨‹éƒ½è¢«æ•…éšœæœåŠ¡å™¨é˜»å¡ï¼Œé‚£åç»­æ‰€æœ‰çš„I/Oæ¶ˆæ¯éƒ½å°†åœ¨é˜Ÿåˆ—ä¸­æ’é˜Ÿã€‚</li><li>ç”±äºçº¿ç¨‹æ± é‡‡ç”¨é˜»å¡é˜Ÿåˆ—å®ç°ï¼Œå½“é˜Ÿåˆ—ç§¯æ»¡ä¹‹åï¼Œåç»­å…¥é˜Ÿåˆ—çš„æ“ä½œå°†è¢«é˜»å¡ã€‚</li><li>ç”±äºå‰ç«¯åªæœ‰ä¸€ä¸ªAccptorçº¿ç¨‹æ¥æ”¶å®¢æˆ·ç«¯æ¥å…¥ï¼Œå®ƒè¢«é˜»å¡åœ¨çº¿ç¨‹æ± çš„åŒæ­¥é˜»å¡é˜Ÿåˆ—ä¹‹åï¼Œæ–°çš„å®¢æˆ·ç«¯è¯·æ±‚æ¶ˆæ¯å°†è¢«æ‹’ç»ï¼Œå®¢æˆ·ç«¯ä¼šå‘ç”Ÿå¤§é‡çš„è¿æ¥è¶…æ—¶ã€‚</li><li>ç”±äºå‡ ä¹æ‰€æœ‰çš„è¿æ¥éƒ½è¶…æ—¶ï¼Œè°ƒç”¨è€…ä¼šè®¤ä¸ºç³»ç»Ÿå·²ç»å´©æºƒï¼Œæ— æ³•æ¥æ”¶æ–°çš„è¯·æ±‚æ¶ˆæ¯ã€‚</li></ol><h3 id="NIOç¼–ç¨‹"><a href="#NIOç¼–ç¨‹" class="headerlink" title="NIOç¼–ç¨‹"></a>NIOç¼–ç¨‹</h3><p>ä¸Socketç±»å’ŒServerSocketç±»ç›¸å¯¹åº”ï¼ŒNIOä¹Ÿæä¾›äº†SocketChannelå’ŒServerSocketChannelä¸¤ç§ä¸åŒçš„å¥—æ¥å­—é€šé“å®ç°ã€‚è¿™ä¸¤ç§æ–°å¢çš„é€šé“éƒ½æ”¯æŒé˜»å¡å’Œéé˜»å¡ä¸¤ç§æ¨¡å¼ã€‚é˜»å¡æ¨¡å¼ä½¿ç”¨éå¸¸ç®€å•ï¼Œä½†æ˜¯æ€§èƒ½å’Œå¯é æ€§éƒ½ä¸å¥½ï¼Œéé˜»å¡æ¨¡å¼åˆ™æ­£å¥½ç›¸åã€‚å¼€å‘äººå‘˜ä¸€èˆ¬å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦æ¥é€‰æ‹©åˆé€‚çš„æ¨¡å¼ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œä½è´Ÿè½½ã€ä½å¹¶å‘çš„åº”ç”¨ç¨‹åºå¯ä»¥é€‰æ‹©åŒæ­¥é˜»å¡I/Oä»¥é™ä½ç¼–ç¨‹å¤æ‚åº¦ï¼Œä½†æ˜¯å¯¹äºé«˜è´Ÿè½½ã€é«˜å¹¶å‘çš„ç½‘ç»œåº”ç”¨ï¼Œéœ€è¦ä½¿ç”¨NIOçš„éé˜»å¡æ¨¡å¼è¿›è¡Œå¼€å‘ã€‚</p><blockquote><p>è¯¦è§ <a href="https://wangwei.one/tags/NIO/">Java NIO API</a></p></blockquote><h3 id="AIOç¼–ç¨‹"><a href="#AIOç¼–ç¨‹" class="headerlink" title="AIOç¼–ç¨‹"></a>AIOç¼–ç¨‹</h3><p>NIO2.0å¼•å…¥äº†æ–°çš„å¼‚æ­¥é€šé“çš„æ¦‚å¿µï¼Œå¹¶æä¾›äº†å¼‚æ­¥æ–‡ä»¶é€šé“å’Œå¼‚æ­¥å¥—æ¥å­—é€šé“çš„å®ç°ã€‚å¼‚æ­¥é€šé“æä¾›ä¸¤ç§æ–¹å¼è·å–è·å–æ“ä½œç»“æœï¼š</p><ol><li>é€šè¿‡java.util.concurrent.Futureç±»æ¥è¡¨ç¤ºå¼‚æ­¥æ“ä½œçš„ç»“æœï¼›</li><li>åœ¨æ‰§è¡Œå¼‚æ­¥æ“ä½œçš„æ—¶å€™ä¼ å…¥ä¸€ä¸ªjava.nio.channelsï¼›</li><li>CompletionHandleræ¥å£çš„å®ç°ç±»ä½œä¸ºæ“ä½œå®Œæˆçš„å›è°ƒã€‚</li></ol><p>NIO2.0çš„å¼‚æ­¥å¥—æ¥å­—é€šé“æ˜¯çœŸæ­£çš„å¼‚æ­¥éé˜»å¡I/Oï¼Œå®ƒå¯¹åº”UNIXç½‘ç»œç¼–ç¨‹ä¸­çš„äº‹ä»¶é©±åŠ¨I/Oï¼ˆAIOï¼‰ï¼Œå®ƒä¸éœ€è¦é€šè¿‡å¤šè·¯å¤ç”¨å™¨ï¼ˆSelectorï¼‰å¯¹æ³¨å†Œçš„é€šé“è¿›è¡Œè½®è¯¢æ“ä½œå³å¯å®ç°å¼‚æ­¥è¯»å†™ï¼Œä»è€Œç®€åŒ–äº†NIOçš„ç¼–ç¨‹æ¨¡å‹ã€‚</p><blockquote><p>è¯¦è§ <a href="https://wangwei.one/posts/f409841b.html">https://wangwei.one/posts/f409841b.html</a></p></blockquote><h3 id="å‡ ç§IOæ¨¡å‹å¯¹æ¯”"><a href="#å‡ ç§IOæ¨¡å‹å¯¹æ¯”" class="headerlink" title="å‡ ç§IOæ¨¡å‹å¯¹æ¯”"></a>å‡ ç§IOæ¨¡å‹å¯¹æ¯”</h3><table><thead><tr><th></th><th>BIO</th><th>ä¼ªå¼‚æ­¥IO</th><th>NIO</th><th>AIO</th></tr></thead><tbody><tr><td>å®¢æˆ·ç«¯ä¸ªæ•°:IOçº¿ç¨‹æ•°</td><td>1:1</td><td>M:N (M &gt; N)</td><td>M:1ï¼ˆ1ä¸ªIOçº¿ç¨‹å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼‰</td><td>M:0ï¼ˆä¸éœ€è¦å¯åŠ¨é¢å¤–çš„I/Oçº¿ç¨‹ï¼Œè¢«åŠ¨å›è°ƒï¼‰</td></tr><tr><td>I/Oç±»å‹ï¼ˆåŒæ­¥ï¼‰</td><td>åŒæ­¥IO</td><td>åŒæ­¥IO</td><td>åŒæ­¥IO</td><td>å¼‚æ­¥IO</td></tr><tr><td>I/Oç±»å‹ ï¼ˆé˜»å¡ï¼‰</td><td>é˜»å¡IO</td><td>é˜»å¡IO</td><td>éé˜»å¡IO</td><td>éé˜»å¡IO</td></tr><tr><td>è°ƒè¯•éš¾åº¦</td><td>ç®€å•</td><td>ç®€å•</td><td>è´Ÿè´£</td><td>å¤æ‚</td></tr><tr><td>å¯é æ€§</td><td>éå¸¸å·®</td><td>éå¸¸å·®</td><td>é«˜</td><td>é«˜</td></tr><tr><td>ååé‡</td><td>ä½</td><td>ä¸­</td><td>é«˜</td><td>é«˜</td></tr><tr><td>APIä½¿ç”¨éš¾åº¦</td><td>ç®€å•</td><td>ç®€å•</td><td>éå¸¸éš¾</td><td>å¤æ‚</td></tr></tbody></table><h2 id="ä¸ºä»€ä¹ˆè¦ç”¨Netty"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨Netty" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨Netty"></a>ä¸ºä»€ä¹ˆè¦ç”¨Netty</h2><p><strong>ä¸ºä»€ä¹ˆä¸å»ºè®®ç›´æ¥ä½¿ç”¨ JDK åŸç”Ÿ NIO æ¡†æ¶å»è¿›è¡Œå¼€å‘ï¼Ÿ</strong></p><ol><li>NIOçš„ç±»åº“å’ŒAPIç¹æ‚ï¼Œä½¿ç”¨éº»çƒ¦ï¼Œä½ éœ€è¦ç†Ÿç»ƒæŒæ¡Selectorã€ServerSocketChannelã€SocketChannelã€ByteBufferç­‰ã€‚</li><li>éœ€è¦å…·å¤‡å…¶ä»–çš„é¢å¤–æŠ€èƒ½åšé“ºå«ï¼Œä¾‹å¦‚ç†Ÿæ‚‰Javaå¤šçº¿ç¨‹ç¼–ç¨‹ã€‚è¿™æ˜¯å› ä¸ºNIOç¼–ç¨‹æ¶‰åŠåˆ°Reactoræ¨¡å¼ï¼Œä½ å¿…é¡»å¯¹å¤šçº¿ç¨‹å’Œç½‘è·¯ç¼–ç¨‹éå¸¸ç†Ÿæ‚‰ï¼Œæ‰èƒ½ç¼–å†™å‡ºé«˜è´¨é‡çš„NIOç¨‹åºã€‚</li><li>å¯é æ€§èƒ½åŠ›è¡¥é½ï¼Œå·¥ä½œé‡å’Œéš¾åº¦éƒ½éå¸¸å¤§ã€‚ä¾‹å¦‚å®¢æˆ·ç«¯é¢ä¸´æ–­è¿é‡è¿ã€ç½‘ç»œé—ªæ–­ã€åŠåŒ…è¯»å†™ã€å¤±è´¥ç¼“å­˜ã€ç½‘ç»œæ‹¥å¡å’Œå¼‚å¸¸ç æµçš„å¤„ç†ç­‰é—®é¢˜ï¼ŒNIOç¼–ç¨‹çš„ç‰¹ç‚¹æ˜¯åŠŸèƒ½å¼€å‘ç›¸å¯¹å®¹æ˜“ï¼Œä½†æ˜¯å¯é æ€§èƒ½åŠ›è¡¥é½çš„å·¥ä½œé‡å’Œéš¾åº¦éƒ½éå¸¸å¤§ã€‚</li><li>JDK NIOçš„BUGï¼Œä¾‹å¦‚è‡­åæ˜­è‘—çš„epoll bugï¼Œå®ƒä¼šå¯¼è‡´Selectorç©ºè½®è¯¢ï¼Œæœ€ç»ˆå¯¼è‡´CPU 100%ã€‚å®˜æ–¹å£°ç§°åœ¨JDK1.6ç‰ˆæœ¬çš„update18ä¿®å¤äº†è¯¥é—®é¢˜ï¼Œä½†æ˜¯ç›´åˆ°JDK1.7ç‰ˆæœ¬è¯¥é—®é¢˜ä»æ—§å­˜åœ¨ï¼Œåªä¸è¿‡è¯¥BUGå‘ç”Ÿæ¦‚ç‡é™ä½äº†ä¸€äº›è€Œå·²ï¼Œå®ƒå¹¶æ²¡æœ‰è¢«æ ¹æœ¬è§£å†³ã€‚è¯¥BUGä»¥åŠä¸è¯¥BUGç›¸å…³çš„é—®é¢˜å•å¯ä»¥å‚è§ä»¥ä¸‹é“¾æ¥å†…å®¹ã€‚<ul><li><a href="https://bugs.java.com/bugdatabase/view_bug.do?bug_id=6403933" target="_blank" rel="noopener">https://bugs.java.com/bugdatabase/view_bug.do?bug_id=6403933</a></li><li><a href="http://bugs.java.com/bugdatabase/view_bug.do?bug_id=2147719" target="_blank" rel="noopener">http://bugs.java.com/bugdatabase/view_bug.do?bug_id=2147719</a></li></ul></li></ol><p><strong>é€‰æ‹©Nettyçš„ç†ç”±</strong></p><p>Nettyæ˜¯ä¸šç•Œæœ€æµè¡Œçš„NIOæ¡†æ¶ä¹‹ä¸€ï¼Œå®ƒçš„å¥å£®æ€§ã€åŠŸèƒ½ã€æ€§èƒ½ã€å¯å®šåˆ¶æ€§å’Œå¯æ‰©å±•æ€§åœ¨åŒç±»æ¡†æ¶ä¸­éƒ½æ˜¯é¦–å±ˆä¸€æŒ‡çš„ï¼Œå®ƒå·²ç»å¾—åˆ°æˆç™¾ä¸Šåƒçš„å•†ç”¨é¡¹ç›®éªŒè¯ï¼Œä¾‹å¦‚ï¼šDubboã€RocketMQã€Sparkã€Spring5ã€Elasticsearchç­‰ï¼Œä»–å…·æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š</p><ul><li>å¼‚æ­¥äº‹ä»¶é€šçŸ¥æ¡†æ¶ï¼Œå¯å¼€å‘å‡ºé«˜æ€§èƒ½çš„æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ï¼›</li><li>å°è£…äº†JDKåº•å±‚BIOã€NIOæ¨¡å‹ï¼Œæé«˜ç®€å•æ˜“ç”¨çš„APIï¼Œå¼€å‘é—¨æ§›ä½ï¼›</li><li>æˆç†Ÿã€ç¨³å®šï¼ŒNettyä¿®å¤äº†å·²ç»å‘ç°çš„æ‰€æœ‰JDK NIO BUGï¼Œä¸šåŠ¡å¼€å‘äººå‘˜ä¸éœ€è¦å†ä¸ºNIOçš„BUGè€Œçƒ¦æ¼ï¼›</li><li>åŠŸèƒ½å¼ºå¤§ï¼Œé¢„ç½®äº†å¤šç§ç¼–è§£ç åŠŸèƒ½ï¼Œè§£å†³äº†æ‹†åŒ…ç²˜åŒ…é—®é¢˜ï¼Œæ”¯æŒå¤šç§ä¸»æµåè®®ï¼›</li><li>å®šåˆ¶èƒ½åŠ›å¼ºï¼Œå¯ä»¥é€šè¿‡ChannelHandlerå¯¹é€šä¿¡æ¡†æ¶è¿›è¡Œçµæ´»åœ°æ‰©å±•ï¼›</li><li>æ€§èƒ½é«˜ï¼Œé€šè¿‡ä¸å…¶ä»–ä¸šç•Œä¸»æµçš„NIOæ¡†æ¶å¯¹æ¯”ï¼ŒNettyçš„ç»¼åˆæ€§èƒ½æœ€ä¼˜ï¼›</li><li>ç¤¾åŒºæ´»è·ƒï¼Œç‰ˆæœ¬è¿­ä»£å‘¨æœŸçŸ­ï¼Œå‘ç°çš„BUGå¯ä»¥è¢«åŠæ—¶ä¿®å¤ï¼ŒåŒæ—¶ï¼Œæ›´å¤šçš„æ–°åŠŸèƒ½ä¼šåŠ å…¥ï¼›</li><li>ç»å†äº†å¤§è§„æ¨¡çš„å•†ä¸šåº”ç”¨è€ƒéªŒï¼Œè´¨é‡å¾—åˆ°éªŒè¯ã€‚åœ¨äº’è”ç½‘ã€å¤§æ•°æ®ã€ç½‘ç»œæ¸¸æˆã€ä¼ä¸šåº”ç”¨ã€ç”µä¿¡è½¯ä»¶ç­‰ä¼—å¤šè¡Œä¸šå¾—åˆ°æˆåŠŸå•†ç”¨ï¼Œè¯æ˜äº†å®ƒå·²ç»å®Œå…¨èƒ½å¤Ÿæ»¡è¶³ä¸åŒè¡Œä¸šçš„å•†ä¸šåº”ç”¨äº†ã€‚</li></ul><h2 id="Nettyæ¶æ„"><a href="#Nettyæ¶æ„" class="headerlink" title="Nettyæ¶æ„"></a>Nettyæ¶æ„</h2><p><strong>åŠŸèƒ½æ¶æ„å›¾</strong></p><p><img src="https://img.i7years.com/blog/Netty%20Functional%20Architecture.png" alt="Netty Functional Architecture"></p><p><strong>é€»è¾‘æ¶æ„å›¾</strong></p><p><img src="https://img.i7years.com/blog/Netty%20Logical%20Architecture.png" alt="Netty Logical architecture"></p><ul><li><strong>Reactor é€šä¿¡è°ƒåº¦å±‚</strong>ï¼šå®ƒç”±ä¸€ç³»åˆ—è¾…åŠ©ç±»å®Œæˆï¼ŒåŒ…æ‹¬Reactorçº¿ç¨‹NioEventLoopåŠå…¶çˆ¶ç±»ï¼ŒNioSocketChannel / NioServerSocketChannel åŠå…¶çˆ¶ç±»ï¼ŒByteBufferä»¥åŠç”±å…¶è¡ç”Ÿå‡ºæ¥çš„å„ç§Bufferï¼ŒUnsafe ä»¥åŠå…¶è¡ç”Ÿå‡ºçš„å„ç§å†…éƒ¨ç±»ç­‰ã€‚è¯¥å±‚çš„ä¸»è¦èŒè´£å°±æ˜¯ç›‘å¬ç½‘ç»œçš„è¯»å†™å’Œè¿æ¥æ“ä½œï¼Œè´Ÿè´£å°†ç½‘ç»œå±‚çš„æ•°æ®è¯»å–åˆ°å†…å­˜ç¼“å†²åŒºä¸­ï¼Œç„¶åè§¦å‘å„ç§ç½‘ç»œäº‹ä»¶ï¼Œä¾‹å¦‚è¿æ¥åˆ›å»ºã€è¿æ¥æ¿€æ´»ã€è¯»äº‹ä»¶ã€å†™äº‹ä»¶ç­‰ï¼Œå°†è¿™äº›äº‹ä»¶è§¦å‘åˆ° PipeLine ä¸­ï¼Œç”± PipeLine ç®¡ç†çš„èŒè´£é“¾æ¥è¿›è¡Œåç»­çš„å¤„ç†ã€‚</li><li><strong>èŒè´£é“¾ ChannelPipeline</strong>ï¼šå®ƒè´Ÿè´£äº‹ä»¶åœ¨èŒè´£é“¾ä¸­çš„æœ‰åºä¼ æ’­ï¼ŒåŒæ—¶è´Ÿè´£åŠ¨æ€åœ°ç¼–æ’èŒè´£é“¾ã€‚èŒè´£é“¾å¯ä»¥é€‰æ‹©ç›‘å¬å’Œå¤„ç†è‡ªå·±å…³å¿ƒçš„äº‹ä»¶ï¼Œå®ƒå¯ä»¥æ‹¦æˆªå¤„ç†å’Œå‘å / å‘å‰ä¼ æ’­äº‹ä»¶ã€‚ä¸åŒåº”ç”¨çš„ Handler èŠ‚ç‚¹çš„åŠŸèƒ½ä¹Ÿä¸åŒï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œå¾€å¾€ä¼šå¼€å‘ç¼–è§£ç  Hanlder ç”¨äºæ¶ˆæ¯çš„ç¼–è§£ç ï¼Œå®ƒå¯ä»¥å°†å¤–éƒ¨çš„åè®®æ¶ˆæ¯è½¬æ¢æˆå†…éƒ¨çš„ POJOå¯¹è±¡ï¼Œè¿™æ ·ä¸Šå±‚ä¸šåŠ¡åˆ™åªéœ€è¦å…³å¿ƒå¤„ç†ä¸šåŠ¡é€»è¾‘å³å¯ï¼Œä¸éœ€è¦æ„ŸçŸ¥åº•å±‚çš„åè®®å·®å¼‚å’Œçº¿ç¨‹æ¨¡å‹å·®å¼‚ï¼Œå®ç°äº†æ¶æ„å±‚é¢çš„åˆ†å±‚éš”ç¦»ã€‚</li><li><strong>ä¸šåŠ¡é€»è¾‘ç¼–æ’å±‚ï¼ˆService ChannelHandlerï¼‰</strong>ï¼šä¸šåŠ¡é€»è¾‘ç¼–æ’å±‚é€šå¸¸æœ‰ä¸¤ç±»ï¼šä¸€ç±»æ˜¯çº¯ç²¹çš„ä¸šåŠ¡é€»è¾‘ç¼–æ’ï¼Œè¿˜æœ‰ä¸€ç±»æ˜¯å…¶ä»–çš„åº”ç”¨å±‚åè®®æ’ä»¶ï¼Œç”¨äºç‰¹å®šåè®®ç›¸å…³çš„ä¼šè¯å’Œé“¾è·¯ç®¡ç†ã€‚</li></ul><h2 id="Netty-Reactoræ¨¡å‹"><a href="#Netty-Reactoræ¨¡å‹" class="headerlink" title="Netty Reactoræ¨¡å‹"></a>Netty Reactoræ¨¡å‹</h2><p>å‰é¢ï¼Œæˆ‘ä»¬ä»‹ç»äº†ä¸‰ç§å¸¸è§çš„ <a href="https://wangwei.one/posts/e5250930.html">Reactorçº¿ç¨‹æ¨¡å‹</a> ï¼ŒNettyæ˜¯å…¸å‹çš„Reactoræ¨¡å‹ç»“æ„ï¼Œä¸‹å›¾æ˜¯Nettyå¸¸è§çš„ä¸»ä»Reactoræ¨¡å‹ç¤ºä¾‹å›¾ã€‚</p><p><img src="https://img.i7years.com/netty/Netty%20Reactor%20Model.png" alt="Netty Reactor Model"></p><p>åœ¨åˆ›å»ºServerBootstrapç±»å®ä¾‹å‰ï¼Œå…ˆåˆ›å»ºä¸¤ä¸ªEventLoopGroupï¼Œä¸€ä¸ªbossGroupï¼Œä¸€ä¸ªworkerGroupã€‚å®ƒä»¬å®é™…ä¸Šæ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„Reactorçº¿ç¨‹æ± ï¼ŒbossGroupè´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥ï¼ŒworkerGroupè´Ÿè´£å¤„ç†IOç›¸å…³çš„è¯»å†™æ“ä½œï¼Œæˆ–è€…æ‰§è¡Œç³»ç»Ÿtaskã€å®šæ—¶taskç­‰ã€‚</p><p>ç”¨äºæ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚çš„çº¿ç¨‹æ± èŒè´£å¦‚ä¸‹ï¼š</p><ol><li>æ¥æ”¶å®¢æˆ·ç«¯TCPè¿æ¥ï¼Œåˆå§‹åŒ–Channelå‚æ•°ï¼›</li><li>å°†é“¾è·¯çŠ¶æ€å˜æ›´äº‹ä»¶é€šçŸ¥ç»™ChannelPipelineï¼›</li></ol><p>å¤„ç†IOæ“ä½œçš„çº¿ç¨‹æ± èŒè´£å¦‚ä¸‹ï¼š</p><ol><li>å¼‚æ­¥è¯»å–è¿œç«¯æ•°æ®ï¼Œå‘é€è¯»äº‹ä»¶åˆ°ChannelPipelineï¼›</li><li>å¼‚æ­¥å‘é€æ•°æ®åˆ°è¿œç«¯ï¼Œè°ƒç”¨ChannelPipelineçš„å‘é€æ¶ˆæ¯æ¥å£ï¼›</li><li>æ‰§è¡Œç³»ç»Ÿè°ƒç”¨Taskï¼›</li><li>æ‰§è¡Œå®šæ—¶ä»»åŠ¡Taskï¼Œå¦‚ç©ºé—²é“¾è·¯æ£€æµ‹å’Œå‘é€å¿ƒè·³æ¶ˆæ¯ç­‰ã€‚</li></ol><p>é€šè¿‡è°ƒæ•´ä¸¤ä¸ªEventLoopGroupçš„çº¿ç¨‹æ•°ã€æ˜¯å¦å…±äº«çº¿ç¨‹æ± ç­‰æ–¹å¼ï¼ŒNettyçš„Reactorçº¿ç¨‹æ¨¡å‹å¯ä»¥åœ¨å•çº¿ç¨‹ã€å¤šçº¿ç¨‹å’Œä¸»ä»å¤šçº¿ç¨‹é—´åˆ‡æ¢ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®å®é™…æƒ…å†µçµæ´»é…ç½®ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://github.com/wangweiX/myBooks/blob/master/computer/netty/Netty%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97.pdf" target="_blank" rel="noopener">ã€ŠNettyæƒå¨æŒ‡å—ã€‹</a></li><li><a href="https://github.com/wangweiX/myBooks/blob/master/computer/netty/Netty-In-Depth.epub" target="_blank" rel="noopener">ã€ŠNetty-In-Depthã€‹</a></li><li><a href="https://github.com/wangweiX/myBooks/blob/master/computer/netty/Netty%20in%20Action.epub" target="_blank" rel="noopener">ã€ŠNetty in actionã€‹</a></li><li><a href="https://github.com/wangweiX/myBooks/blob/master/computer/netty/Netty5.0%20architecture%20analysis%20and%20source%20code%20interpretation.pdf" target="_blank" rel="noopener">ã€ŠNetty5.0 architecture analysis and source code interpretationã€‹</a></li><li><a href="http://www.importnew.com/15656.html" target="_blank" rel="noopener">http://www.importnew.com/15656.html</a></li><li><a href="http://netty.io/wiki/user-guide-for-4.x.html" target="_blank" rel="noopener">http://netty.io/wiki/user-guide-for-4.x.html</a></li><li><a href="http://www.infoq.com/cn/articles/netty-threading-model" target="_blank" rel="noopener">http://www.infoq.com/cn/articles/netty-threading-model</a></li><li><a href="https://juejin.im/post/5bda4cc55188257f630dac07" target="_blank" rel="noopener">https://juejin.im/post/5bda4cc55188257f630dac07</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Netty </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[å¥½ç”¨çš„å·¥å…·æ¸…å•]]></title>
      <url>/posts/good-tool-list.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p align="center"><br><a target="_blank" href="https://wangwei.one/posts/good-tool-list.html"><img src="https://img.i7years.com/blog/garage-hanging-mechanic-162553.jpg?imageslim"></a><br></p><p>å‘ç°å¥½ä¸œè¥¿ï¼Œé‡è§å¥½â€¦â€¦åˆ†äº«è‡ªå·±æ—¥å¸¸å·¥ä½œä¸ç”Ÿæ´»ä¸­ç»å¸¸ä½¿ç”¨çš„å·¥å…·ã€appä»¥åŠç½‘ç«™ã€‚</p><a id="more"></a><h2 id="å®ä½“ç‰©ä»¶"><a href="#å®ä½“ç‰©ä»¶" class="headerlink" title="å®ä½“ç‰©ä»¶"></a>å®ä½“ç‰©ä»¶</h2><table><thead><tr><th>ä¸€çº§</th><th>äºŒçº§</th><th>ç±»ç›®</th></tr></thead><tbody><tr><td>ç”µå­äº§å“</td><td>è‹¹æœ</td><td>MacBook Pro<br>iPhone<br>iPad Pro<br>Apple Watch<br>iMac Pro<br></td></tr><tr><td></td><td>é˜…è¯»</td><td>Kindle Oasis</td></tr></tbody></table><h2 id="åº”ç”¨ç¨‹åº"><a href="#åº”ç”¨ç¨‹åº" class="headerlink" title="åº”ç”¨ç¨‹åº"></a>åº”ç”¨ç¨‹åº</h2><table><thead><tr><th>ä¸€çº§</th><th>äºŒçº§</th><th>ç±»ç›®</th></tr></thead><tbody><tr><td>åˆ¶å›¾</td><td>æµç¨‹å›¾/UML/åŸå‹</td><td><a href="https://www.omnigroup.com/omnigraffle" target="_blank" rel="noopener">OmniGraffle</a><br><a href="http://staruml.io/" target="_blank" rel="noopener">StarUML</a><br><a href="https://www.axure.com/" target="_blank" rel="noopener">Axure RP 8</a></td></tr><tr><td>å›¾ç‰‡å¤„ç†</td><td>æˆªå›¾æ‹¼æ¥</td><td><a href="https://itunes.apple.com/us/app/tailor-screenshot-stitching/id926653095?mt=8" target="_blank" rel="noopener">Tailor</a></td></tr><tr><td>ä¸ªäººç®¡ç†</td><td>æ—¶é—´ç®¡ç†</td><td><a href="http://www.atimelogger.com/" target="_blank" rel="noopener">aTimelogger2</a></td></tr><tr><td></td><td>ä»»åŠ¡ç®¡ç†</td><td><a href="https://www.omnigroup.com/omniFocus" target="_blank" rel="noopener">OmniFocus</a><br><a href="https://culturedcode.com/things/" target="_blank" rel="noopener">Things</a></td></tr><tr><td></td><td>ç²¾åŠ›ç®¡ç†</td><td>å†¥æƒ³ï¼š<a href="https://insighttimer.com/" target="_blank" rel="noopener">Insight Timer</a><br>ä¸“æ³¨ï¼š<a href="https://www.forestapp.cc/en/" target="_blank" rel="noopener">Forest</a><br>ç¡çœ ï¼š<a href="https://sleeptown.seekrtech.com/" target="_blank" rel="noopener">SleepTown</a></td></tr><tr><td></td><td>è¿åŠ¨å¥èº«</td><td><a href="https://www.gotokeep.com/" target="_blank" rel="noopener">Keep</a></td></tr><tr><td>å›¢é˜Ÿåä½œ</td><td>é¡¹ç›®ç®¡ç†</td><td><a href="https://www.omnigroup.com/omniPlan" target="_blank" rel="noopener">OmniPlan</a></td></tr><tr><td></td><td>æ–‡æ¡£åä½œ</td><td><a href="https://www.teambition.com/en" target="_blank" rel="noopener">Teambition</a><br><a href="https://tower.im/" target="_blank" rel="noopener">Tower</a><br><a href="https://shimo.im/" target="_blank" rel="noopener">çŸ³å¢¨æ–‡æ¡£</a></td></tr><tr><td>è®°å½•</td><td>å†™ä½œ</td><td><a href="https://typora.io/" target="_blank" rel="noopener">Typora</a><br><a href="https://www.omnigroup.com/omnioutliner" target="_blank" rel="noopener">OmniOutliner</a><br><a href="https://evernote.com/intl/en/" target="_blank" rel="noopener">evernote</a><br><a href="http://www.bear-writer.com/" target="_blank" rel="noopener">Bear</a><br><a href="https://mindnode.com/" target="_blank" rel="noopener">MindNode</a><br><a href="https://itunes.apple.com/cn/app/%E8%AE%AF%E9%A3%9E%E8%AF%AD%E8%AE%B0-%E8%AF%AD%E9%9F%B3%E5%8F%98%E6%96%87%E5%AD%97%E8%BE%93%E5%85%A5%E7%9A%84%E4%BA%91%E7%AC%94%E8%AE%B0/id931409652?mt=8" target="_blank" rel="noopener">è®¯é£è¯­å½•</a></td></tr><tr><td>é˜…è¯»</td><td>ç”µå­ä¹¦ç±ç®¡ç†</td><td>iBooks<br><a href="https://calibre-ebook.com/" target="_blank" rel="noopener">calibre</a></td></tr><tr><td>å®‰å…¨</td><td>è´¦å·å¯†ç å®‰å…¨</td><td><a href="https://authy.com/" target="_blank" rel="noopener">authy</a><br><a href="https://1password.com/" target="_blank" rel="noopener">1Password</a></td></tr><tr><td></td><td>ç½‘ç»œé˜²ç«å¢™</td><td><a href="https://www.obdev.at/products/littlesnitch/index.html" target="_blank" rel="noopener">Little Snitch</a></td></tr><tr><td>æ•ˆç‡</td><td>è‡ªåŠ¨åŒ–å·¥å…·</td><td><a href="https://ifttt.com/" target="_blank" rel="noopener">IFTT</a><br><a href="https://itunes.apple.com/app/workflow-powerful-automation/id915249334" target="_blank" rel="noopener">Shortcuts</a></td></tr><tr><td>å­¦ä¹ </td><td>æ•™è‚²å­¦ä¹ </td><td><a href="https://www.igetget.com/" target="_blank" rel="noopener">å¾—åˆ°App</a><br><a href="http://www.hundun.cn/" target="_blank" rel="noopener">æ··æ²Œå¤§å­¦</a><br><a href="https://time.geekbang.org/" target="_blank" rel="noopener">æå®¢æ—¶é—´</a></td></tr><tr><td></td><td>å­¦ä¹ ç¤¾åŒº</td><td><a href="https://www.xiaomiquan.com/" target="_blank" rel="noopener">çŸ¥è¯†æ˜Ÿçƒ</a><br><a href="https://www.bcathub.com/" target="_blank" rel="noopener">å¤§çŒ«åŸå ¡</a></td></tr><tr><td></td><td>è‹±è¯­è¯å…¸</td><td><a href="https://itunes.apple.com/ca/app/ldoce-inapp-longman-dictionary-of-english-5th/id600007708?mt=8" target="_blank" rel="noopener">LDOCE</a><br><a href="https://www.eudic.net/v4/en/app/eudic" target="_blank" rel="noopener">Eudic</a></td></tr><tr><td></td><td></td><td></td></tr><tr><td>ç§‘å­¦ä¸Šç½‘</td><td>å³æ—¶é€šè®¯</td><td><a href="https://telegram.org/" target="_blank" rel="noopener">Telegram</a></td></tr><tr><td></td><td>VPN</td><td><a href="https://wangwei.one/posts/build-your-own-vpn-by-shadowsocks-or-rixcloud.html">æ¨èVPN</a></td></tr><tr><td></td><td></td><td></td></tr><tr><td>æ¸¸æˆ</td><td></td><td><a href="http://www.fireproofgames.com/games/the-room" target="_blank" rel="noopener">TheRoom</a></td></tr><tr><td></td><td></td><td></td></tr><tr><td>é’±åŒ…</td><td>åŒºå—é“¾èµ„äº§é’±åŒ…</td><td><a href="https://token.im/" target="_blank" rel="noopener">imToken</a></td></tr><tr><td></td><td></td><td></td></tr><tr><td>macç»´æŠ¤</td><td>ç£ç›˜æ–‡ä»¶æ‰«æ</td><td><a href="https://daisydiskapp.com/index.html" target="_blank" rel="noopener">DaisyDisk</a></td></tr><tr><td></td><td>ç”µè„‘æ¸…ç†</td><td><a href="https://cleanmymac.com/" target="_blank" rel="noopener">CleanMac3</a></td></tr><tr><td></td><td>æ¶æ„æ–‡ä»¶/ç—…æ¯’æ‰«æ</td><td><a href="https://www.totalav.com/" target="_blank" rel="noopener">Antivirus</a></td></tr><tr><td></td><td></td><td></td></tr><tr><td>macæ–‡ä»¶ç®¡ç†</td><td></td><td><a href="https://totalfinder.binaryage.com/" target="_blank" rel="noopener">Totalfinder</a></td></tr><tr><td></td><td></td><td></td></tr><tr><td>è™šæ‹Ÿæœº</td><td></td><td><a href="https://www.parallels.com/" target="_blank" rel="noopener">Parallels Desktop</a></td></tr></tbody></table><blockquote><p>ä¼˜ç§€APPï¼š</p><ul><li><a href="https://github.com/hzlzh/Best-App" target="_blank" rel="noopener">https://github.com/hzlzh/Best-App</a></li><li><a href="https://github.com/Louiszhai/tool" target="_blank" rel="noopener">https://github.com/Louiszhai/tool</a></li></ul></blockquote><h2 id="Chromeæ’ä»¶"><a href="#Chromeæ’ä»¶" class="headerlink" title="Chromeæ’ä»¶"></a>Chromeæ’ä»¶</h2><table><thead><tr><th>Extensions</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><a href="https://chrome.google.com/webstore/detail/google-translate/aapbdbdomjkkjkaonfhkkikfgjllcleb" target="_blank" rel="noopener">Google Translate</a></td><td>Gooleè¯­è¨€ç¿»è¯‘</td></tr><tr><td><a href="https://chrome.google.com/webstore/detail/evernote-web-clipper/pioclpoplcdbaefihamjohnefbikjilc" target="_blank" rel="noopener">Evernote Web Clipper</a></td><td>ç½‘é¡µå†…å®¹æŠ“å–ï¼Œä¿å­˜è‡³Evernote</td></tr><tr><td><a href="https://chrome.google.com/webstore/detail/%E6%8E%98%E9%87%91/lecdifefmmfjnjjinhaennhdlmcaeeeb" target="_blank" rel="noopener">æ˜é‡‘</a></td><td>æ˜é‡‘æŠ€æœ¯ç¤¾åŒº</td></tr><tr><td><a href="https://chrome.google.com/webstore/detail/clickclean/ghgabhipcejejjmhhchfonmamedcbeod" target="_blank" rel="noopener">Click&amp;Clean</a></td><td>æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ã€éšç§æ•°æ®ã€å†å²è®°å½•ï¼Œå®‰å…¨å…³é—­æµè§ˆå™¨</td></tr><tr><td><a href="https://duckduckgo.com/" target="_blank" rel="noopener">Duckduckgo</a></td><td>å®‰å…¨æœç´¢å¼•æ“</td></tr><tr><td><a href="https://chrome.google.com/webstore/detail/adguard-adblocker/bgnkhhnnamicmpeenaelnjfhikgbkllg" target="_blank" rel="noopener">AdGuard AdBlocker</a></td><td>å±è”½ç«™ç‚¹å¹¿å‘Š</td></tr><tr><td><a href="https://chrome.google.com/webstore/detail/1password-extension-deskt/aomjjhallfgjeglblehebfpbcfeobpgk" target="_blank" rel="noopener">1Password</a></td><td>è´¦å·å¯†ç ç®¡ç†</td></tr><tr><td><a href="https://www.getpostman.com/apps" target="_blank" rel="noopener">Postman</a></td><td>APIæ¨¡æ‹Ÿè¯·æ±‚</td></tr><tr><td><a href="https://chrome.google.com/webstore/detail/json-formatter/bcjindcccaagfpapjjmafapmmgkkhgoa" target="_blank" rel="noopener">JSON Formatter</a></td><td>jsonå­—ç¬¦ä¸²æ ¼å¼åŒ–</td></tr><tr><td><a href="https://convertio.co" target="_blank" rel="noopener">convertio</a></td><td>å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ã€ç”µå­ä¹¦ç­‰ç­‰ç±»å‹æ–‡ä»¶è½¬æ¢</td></tr><tr><td><a href="https://chrome.google.com/webstore/detail/the-qr-code-extension/oijdcdmnjjgnnhgljmhkjlablaejfeeb/related?h1=en" target="_blank" rel="noopener">QR Code</a></td><td>äºŒç»´ç ç”Ÿæˆ</td></tr><tr><td><a href="https://github.com/ovity/octotree" target="_blank" rel="noopener">octotree</a></td><td>GitHubä»£ç æ ‘å½¢é˜…è¯»æ’ä»¶</td></tr></tbody></table><blockquote><p>Chromeæ’ä»¶è‹±é›„æ¦œï¼š<a href="https://github.com/zhaoolee/ChromeAppHeroes" target="_blank" rel="noopener">https://github.com/zhaoolee/ChromeAppHeroes</a></p></blockquote><h2 id="ç¨‹åºå‘˜å·¥å…·"><a href="#ç¨‹åºå‘˜å·¥å…·" class="headerlink" title="ç¨‹åºå‘˜å·¥å…·"></a>ç¨‹åºå‘˜å·¥å…·</h2><ul><li><a href="https://wangwei.one/posts/dev-env-config-list-guide.html">https://wangwei.one/posts/dev-env-config-list-guide.html</a></li></ul>]]></content>
      
        <categories>
            
            <category> tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Tool </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Java8æ–°ç‰¹æ€§ä»‹ç»]]></title>
      <url>/posts/java-8-new-feature-base-intro.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>Java 8 äº 2014å¹´3æœˆä»½å‘å¸ƒï¼Œæ–°ç‰ˆæœ¬å¢æ·»å¾ˆå¤šä¸é”™çš„ç‰¹æ€§ï¼Œæœ¬ç¯‡æ–‡ç« æˆ‘ä»¬ä¸€èµ·çºµè§ˆä¸€ä¸‹è¿™äº›æ–°ç‰¹æ€§ï¼Œåé¢çš„æ–‡ç« æˆ‘ä»¬å°†ä¼šä¸€ä¸€è¯¦ç»†è®¨è®ºã€‚</p><a id="more"></a><h2 id="Java8ä»‹ç»"><a href="#Java8ä»‹ç»" class="headerlink" title="Java8ä»‹ç»"></a>Java8ä»‹ç»</h2><p>ä¿ƒä½¿Javaåšå‡ºé‡å¤§æ”¹å˜çš„åŠ¨åŠ›ä¸»è¦æ¥æºäºï¼š</p><ul><li>ä»£ç å¯è¯»æ€§</li><li>å¤šæ ¸è¿è¡Œ</li></ul><h3 id="ä»£ç å¯è¯»æ€§"><a href="#ä»£ç å¯è¯»æ€§" class="headerlink" title="ä»£ç å¯è¯»æ€§"></a>ä»£ç å¯è¯»æ€§</h3><p>Javaä»£ç éå¸¸çš„å•°å—¦å†—é•¿ï¼Œå¯¼è‡´äº†ä»£ç å¯è¯»æ€§çš„ä¸‹é™ï¼Œæ¢å¥è¯è¯´ï¼Œéœ€è¦å¾ˆå¤šé¢å¤–çš„ä»£ç æ¥è§£é‡Šä¸€æ®µå¾ˆå°çš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œç°åœ¨æœ‰ä¸ªéœ€æ±‚ï¼Œè¦æŒ‰ç…§å‘ç¥¨é‡‘é¢çš„æ•°é‡å€’åºæ’åºå‘ç¥¨åˆ—è¡¨ã€‚åœ¨Java 8ä¹‹å‰ï¼Œä½ å¯èƒ½éœ€è¦è¿™ä¹ˆå¤„ç†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Collections.sort(invoices, <span class="keyword">new</span> Comparator&lt;Invoice&gt;() &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Invoice inv1, Invoice inv2)</span> </span>&#123;</span><br><span class="line">    	<span class="keyword">return</span> Double.compare(inv2.getAmount(), inv1.getAmount());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è€Œåœ¨Java8ä¸­ï¼Œä½ åªéœ€è¦è¿™æ ·å³å¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">invoices.sort(comparingDouble(Invoice::getAmount).reversed());</span><br></pre></td></tr></table></figure><blockquote><p>åé¢çš„ç« èŠ‚ä¼šåšè¯¦ç»†ä»‹ç»</p></blockquote><p>æ­¤å¤–ï¼ŒJava 8å¼•å…¥äº†ä¸€ç§åä¸ºStreams APIçš„æ–°APIï¼Œå¯ä»¥è®©ä½ ç¼–å†™å¯è¯»æ€§è‰¯å¥½çš„ä»£ç æ¥å¤„ç†æ•°æ®ã€‚Streams APIæ”¯æŒå¤šç§å†…ç½®æ“ä½œï¼Œä»¥æ›´ç®€å•çš„æ–¹å¼æ¥å¤„ç†æ•°æ®ã€‚åœ¨ä¸šåŠ¡è¿è¥ç¯å¢ƒä¸­ï¼Œä½ å¯èƒ½å¸Œæœ›ç”Ÿæˆä¸€ä¸ªç»“æŸæ—¥æœŸæŠ¥è¡¨ï¼Œä»¥è¿‡æ»¤å’Œæ±‡æ€»æ¥è‡ªå„ä¸ªéƒ¨é—¨çš„å‘ç¥¨ã€‚ å¥½æ¶ˆæ¯æ˜¯ï¼Œä½¿ç”¨Streams APIï¼Œæ‚¨æ— éœ€æ‹…å¿ƒå¦‚ä½•å®ç°æŸ¥è¯¢æœ¬èº«ã€‚<br>è¿™ç§æ–¹æ³•ä¸æ‚¨ä¹ æƒ¯ä½¿ç”¨SQLçš„æ–¹æ³•ç±»ä¼¼ã€‚ äº‹å®ä¸Šï¼Œåœ¨SQLä¸­ï¼Œæ‚¨å¯ä»¥æŒ‡å®šæŸ¥è¯¢è€Œä¸ç”¨æ‹…å¿ƒå…¶å†…éƒ¨å®ç°ã€‚ ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨æƒ³è¦æŸ¥æ‰¾é‡‘é¢å¤§äº1,000çš„å‘ç¥¨çš„æ‰€æœ‰IDï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span> <span class="keyword">FROM</span> invoices <span class="keyword">WHERE</span> amount &gt; <span class="number">1000</span></span><br></pre></td></tr></table></figure><p>è¿™ç§ç¼–å†™æŸ¥è¯¢æ‰€åšçš„é£æ ¼é€šå¸¸è¢«ç§°ä¸º<strong>å£°æ˜å¼ç¼–ç¨‹</strong>ã€‚ ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨Streams APIå¹¶è¡Œåœ°è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; ids = invoices.stream()</span><br><span class="line">                .filter(inv -&gt; inv.getAmount() &gt; <span class="number">1000</span>)</span><br><span class="line">                .map(Invoice::getId)</span><br><span class="line">                .collect(Collectors.toList());</span><br></pre></td></tr></table></figure><blockquote><p>åé¢çš„ç« èŠ‚ä¼šåšè¯¦ç»†ä»‹ç»</p></blockquote><h3 id="å¤šæ ¸"><a href="#å¤šæ ¸" class="headerlink" title="å¤šæ ¸"></a>å¤šæ ¸</h3><p>Java 8çš„ç¬¬äºŒä¸ªé‡å¤§å˜åŒ–æ˜¯å¤šæ ¸å¤„ç†å™¨æ—¶ä»£æ‰€å¿…é¡»çš„ã€‚åœ¨è¿‡å»ï¼Œä½ çš„ç”µè„‘åªæœ‰ä¸€ä¸ªå¤„ç†å•å…ƒã€‚æƒ³è¦æ›´å¿«åœ°è¿è¡Œåº”ç”¨ç¨‹åºé€šå¸¸æ„å‘³ç€æé«˜å¤„ç†å•å…ƒçš„æ€§èƒ½ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œå¤„ç†å•å…ƒçš„æ—¶é’Ÿé€Ÿåº¦ä¸ä¼šå†æ›´å¿«äº†ã€‚ ä»Šå¤©ï¼Œç»å¤§å¤šæ•°è®¡ç®—æœºå’Œç§»åŠ¨è®¾å¤‡éƒ½æœ‰å¤šä¸ªå¤„ç†å•å…ƒï¼ˆç§°ä¸ºæ ¸ï¼‰æ¥ä»¥å¹¶è¡Œçš„æ–¹å¼è¿›è¡Œå·¥ä½œã€‚</p><p>åº”ç”¨ç¨‹åºåº”è¯¥åˆ©ç”¨ä¸åŒçš„å¤„ç†å•å…ƒæ¥æé«˜æ€§èƒ½ã€‚ Javaåº”ç”¨ç¨‹åºé€šå¸¸é€šè¿‡çº¿ç¨‹æ¥å®ç°è¿™ä¸€ç‚¹ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œä¸çº¿ç¨‹ä¸€èµ·å·¥ä½œå¾€å¾€æ˜¯å›°éš¾ä¸”å®¹æ˜“å‡ºé”™çš„ï¼Œå¹¶ä¸”é€šå¸¸ä¸“ä¾›ä¸“å®¶ä½¿ç”¨ã€‚</p><p>Java 8ä¸­çš„Streams API èƒ½å¤Ÿè®©ä½ éå¸¸æ–¹ä¾¿åœ°ä»¥å¹¶è¡Œæ–¹å¼æ¥å¤„ç†æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå°†å‰é¢çš„ä»£ç æ”¹ä¸ºå¹¶è¡Œè¿è¡Œï¼Œåªéœ€è¦ä½¿ç”¨ <em>parallelStream()</em> æ¥å£å³å¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; ids = invoices.parallelStream()</span><br><span class="line">                .filter(inv -&gt; inv.getAmount() &gt; <span class="number">1000</span>)</span><br><span class="line">                .map(Invoice::getId)</span><br><span class="line">                .collect(Collectors.toList());</span><br></pre></td></tr></table></figure><blockquote><p>åé¢çš„ç« èŠ‚ä¼šåšè¯¦ç»†ä»‹ç»</p></blockquote><h2 id="æ–°ç‰¹æ€§çºµè§ˆ"><a href="#æ–°ç‰¹æ€§çºµè§ˆ" class="headerlink" title="æ–°ç‰¹æ€§çºµè§ˆ"></a>æ–°ç‰¹æ€§çºµè§ˆ</h2><h3 id="Lambdaè¡¨è¾¾å¼-Lambda-Expressions"><a href="#Lambdaè¡¨è¾¾å¼-Lambda-Expressions" class="headerlink" title="Lambdaè¡¨è¾¾å¼(Lambda Expressions)"></a>Lambdaè¡¨è¾¾å¼(Lambda Expressions)</h3><p>Lambdaè¡¨è¾¾å¼å¯ä»¥è®©æ‚¨ä»¥ç®€æ´çš„æ–¹å¼ä¼ é€’ä¸€æ®µä»£ç ã€‚ ä¾‹å¦‚ï¼Œå‡è®¾ä½ éœ€è¦è·å¾—ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚ ä½ å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªRunnableå¯¹è±¡æ¥å®ç°ï¼Œç„¶åå°†å…¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™Threadï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Runnable runnable = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Hello world"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">new</span> Thread(runnable).start();</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨lambdaè¡¨è¾¾å¼ï¼Œä½ å¯ä»¥ç”¨å¯è¯»æ€§æ›´å¼ºçš„æ–¹å¼é‡æ„å‰é¢çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Thread(() -&gt; System.out.println(<span class="string">"Hello world"</span>)).start();</span><br></pre></td></tr></table></figure><h3 id="æ–¹æ³•å¼•ç”¨-Method-references"><a href="#æ–¹æ³•å¼•ç”¨-Method-references" class="headerlink" title="æ–¹æ³•å¼•ç”¨(Method references)"></a>æ–¹æ³•å¼•ç”¨(Method references)</h3><p>æ–¹æ³•å¼•ç”¨æ„æˆäº†ä¸€ä¸ªä¸Lambdaè¡¨è¾¾å¼å¯†åˆ‡ç›¸å…³çš„æ–°ç‰¹æ€§ã€‚ä»–ä»¬å¯ä»¥è®©ä½ é€‰æ‹©ä¸€ä¸ªåœ¨ç±»ä¸­å®šä¹‰çš„æ–¹æ³•å¹¶ä¸”ä¼ é€’å®ƒã€‚ ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨éœ€è¦é€šè¿‡å¿½ç•¥å¤§å°å†™æ¥æ¯”è¾ƒå­—ç¬¦ä¸²åˆ—è¡¨ã€‚ ç›®å‰ï¼Œæ‚¨ä¼šç¼–å†™å¦‚ä¸‹æ‰€ç¤ºçš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; strs = Arrays.asList(<span class="string">"C"</span>, <span class="string">"a"</span>, <span class="string">"A"</span>, <span class="string">"b"</span>);</span><br><span class="line">Collections.sort(strs, <span class="keyword">new</span> Comparator&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(String s1, String s2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> s1.compareToIgnoreCase(s2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹æ³•å¼•ç”¨ï¼Œä»£ç ç®€æ´å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Collections.sort(strs, String::compareToIgnoreCase);</span><br></pre></td></tr></table></figure><p><code>String::compareToIgnoreCase</code> å°±æ˜¯æ–¹æ³•å¼•ç”¨ï¼Œå®ƒä½¿ç”¨ä¸€ç§ç‰¹æ®Šçš„è¯­æ³• <code>::</code> .</p><h3 id="æµ-Streams"><a href="#æµ-Streams" class="headerlink" title="æµ(Streams)"></a>æµ(Streams)</h3><p>å‡ ä¹æ¯ä¸€ä¸ªJavaåº”ç”¨ç¨‹åºéƒ½ä¼šå»åˆ›å»ºå’Œå¤„ç†æ•°æ®é›†åˆã€‚å®ƒä»¬æ˜¯è¯¸å¤šåº”ç”¨ç¨‹åºçš„åŸºç¡€ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥è®©ä½ å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ä¸”å¤„ç†æ•°æ®ã€‚ç„¶è€Œï¼Œä½¿ç”¨Javaé›†åˆå»ç¼–å†™ç¨‹åºï¼Œä»£ç å¯èƒ½ä¼šéå¸¸å†—é•¿ï¼Œå¹¶ä¸”éš¾ä»¥å¹¶è¡ŒåŒ–è¿è¡Œã€‚ä¸‹é¢çš„ä¾‹å­ï¼Œå……åˆ†è¯´æ˜äº†ä½¿ç”¨é›†åˆï¼Œå¯¼è‡´å†—ä½™çš„å¯èƒ½æ€§ã€‚</p><p>æ‰¾å‡ºä¸åŸ¹è®­ç›¸å…³çš„å‘ç¥¨çš„IDï¼Œå¹¶ä¸”æŒ‰ç…§å‘ç¥¨çš„é‡‘é¢è¿›è¡Œæ’åºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Invoice&gt; trainingInvoices = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span>(Invoice inv: invoices) &#123;</span><br><span class="line">  <span class="keyword">if</span>(inv.getTitle().contains(<span class="string">"Training"</span>)) &#123;</span><br><span class="line">    trainingInvoices.add(inv);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Collections.sort(trainingInvoices, <span class="keyword">new</span> Comparator() &#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Invoice inv1, Invoice inv2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> inv2.getAmount().compareTo(inv1.getAmount());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">List&lt;Integer&gt; invoiceIds = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(Invoice inv: trainingInvoices) &#123;</span><br><span class="line">  invoiceIds.add(inv.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨Java 8ä¸­çš„Stream APIå°±å¯å°†ä¸Šè¿°ä»£ç ç®€åŒ–ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; invoiceIds = invoices.stream()</span><br><span class="line">                       .filter(inv -&gt; inv.getTitle().contains(<span class="string">"Training"</span>))</span><br><span class="line">                       .sorted(comparingDouble(Invoice::getAmount).reversed())</span><br><span class="line">                       .map(Invoice::getId)</span><br><span class="line">                       .collect(Collectors.toList());</span><br></pre></td></tr></table></figure><h3 id="æ¥å£å¢å¼º-Enhanced-Interfaces"><a href="#æ¥å£å¢å¼º-Enhanced-Interfaces" class="headerlink" title="æ¥å£å¢å¼º(Enhanced Interfaces)"></a>æ¥å£å¢å¼º(Enhanced Interfaces)</h3><p>Java 8ä¸­çš„æ¥å£ç°åœ¨å¯ä»¥é€šè¿‡ä¸¤ä¸ªæ”¹è¿›æ¥å£°æ˜å¸¦æœ‰å®ç°ä»£ç çš„æ–¹æ³•ã€‚</p><h3 id="é»˜è®¤æ–¹æ³•"><a href="#é»˜è®¤æ–¹æ³•" class="headerlink" title="é»˜è®¤æ–¹æ³•"></a>é»˜è®¤æ–¹æ³•</h3><p>é¦–å…ˆï¼ŒJava 8å¼•å…¥äº†é»˜è®¤æ–¹æ³•ï¼Œå®ƒå…è®¸æ‚¨åœ¨æ¥å£ä¸­å£°æ˜å…·æœ‰å®ç°ä»£ç çš„æ–¹æ³•ã€‚å®ƒä»¬æ˜¯ä½œä¸ºä¸€ç§ä»¥å‘åå…¼å®¹çš„æ–¹å¼å‘å±•Java APIçš„æœºåˆ¶è€Œå¼•å…¥çš„ã€‚ä¾‹å¦‚ï¼Œæ‚¨å°†çœ‹åˆ°åœ¨Java 8ä¸­ï¼ŒListæ¥å£ç°åœ¨æ”¯æŒä¸€ç§æ’åºæ–¹æ³•ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(Comparator&lt;? <span class="keyword">super</span> E&gt; c)</span> </span>&#123;</span><br><span class="line">     Object[] a = <span class="keyword">this</span>.toArray();</span><br><span class="line">     Arrays.sort(a, (Comparator) c);</span><br><span class="line">     ListIterator&lt;E&gt; i = <span class="keyword">this</span>.listIterator();</span><br><span class="line">     <span class="keyword">for</span> (Object e : a) &#123;</span><br><span class="line">          i.next();</span><br><span class="line">          i.set((E) e);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é»˜è®¤æ–¹æ³•ä¹Ÿå¯ä»¥ä½œä¸ºè¡Œä¸ºçš„å¤šé‡ç»§æ‰¿æœºåˆ¶ã€‚ äº‹å®ä¸Šï¼Œåœ¨Java 8ä¹‹å‰ï¼Œä¸€ä¸ªç±»å¯èƒ½å·²ç»å®ç°äº†å¤šä¸ªæ¥å£ã€‚ ç°åœ¨ï¼Œæ‚¨å¯ä»¥ä»å¤šä¸ªä¸åŒçš„æ¥å£ç»§æ‰¿é»˜è®¤æ–¹æ³•ã€‚ è¯·æ³¨æ„ï¼ŒJava 8å…·æœ‰æ˜ç¡®çš„è§„åˆ™æ¥é˜²æ­¢C ++ä¸­å¸¸è§çš„ç»§æ‰¿é—®é¢˜ï¼ˆä¾‹å¦‚diamond problemï¼‰ã€‚</p><h4 id="é™æ€æ–¹æ³•"><a href="#é™æ€æ–¹æ³•" class="headerlink" title="é™æ€æ–¹æ³•"></a>é™æ€æ–¹æ³•</h4><p>å…¶æ¬¡ï¼Œæ¥å£ç°åœ¨ä¹Ÿå¯ä»¥æœ‰é™æ€æ–¹æ³•ã€‚ å®šä¹‰ç”¨äºå¤„ç†æ¥å£å®ä¾‹çš„é™æ€æ–¹æ³•çš„æ¥å£å’Œä¼´éšç±»æ˜¯ä¸€ç§å¸¸è§æ¨¡å¼ã€‚ ä¾‹å¦‚ï¼ŒJavaå…·æœ‰Collectionæ¥å£å’ŒCollectionsç±»ï¼Œå®ƒå®šä¹‰äº†å®ç”¨ç¨‹åºçš„é™æ€æ–¹æ³•ã€‚ è¿™ç§å®ç”¨é™æ€æ–¹æ³•ç°åœ¨å¯ä»¥å­˜åœ¨äºæ¥å£ä¸­ã€‚ ä¾‹å¦‚ï¼ŒJava 8ä¸­çš„Streamæ¥å£å£°æ˜äº†ä¸€ä¸ªåƒè¿™æ ·çš„é™æ€æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span>&lt;T&gt; Stream&lt;T&gt; <span class="title">of</span><span class="params">(T... values)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> Arrays.stream(values);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="CompletableFuture"><a href="#CompletableFuture" class="headerlink" title="CompletableFuture"></a>CompletableFuture</h3><p>Java 8 é€šè¿‡ä¸€ä¸ªæ–°çš„Classç±» <em>CompletableFuture</em> æ¥è€ƒè™‘ä¸€ç§æ–°çš„å¼‚æ­¥ç¼–ç¨‹æ–¹å¼ã€‚ è¿™æ˜¯å¯¹æ—§æœ‰çš„Futureç±»çš„æ”¹è¿›ï¼Œå…¶æ“ä½œçµæ„Ÿæ¥æºäºæ–°Streams APIä¸­çš„ç±»ä¼¼è®¾è®¡é€‰æ‹©ï¼ˆå³å£°æ˜å¼é£æ ¼å’Œæµç•…é“¾æ¥æ–¹æ³•çš„èƒ½åŠ›ï¼‰ã€‚ æ¢å¥è¯è¯´ï¼Œæ‚¨å¯ä»¥å£°æ˜å¼åœ°å¤„ç†å’Œç¼–å†™å¤šä¸ªå¼‚æ­¥ä»»åŠ¡ã€‚<br>ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŒæ—¶æŸ¥è¯¢ä¸¤ä¸ªé˜»å¡ä»»åŠ¡çš„ç¤ºä¾‹ï¼šä»·æ ¼æŸ¥æ‰¾æœåŠ¡ä»¥åŠæ±‡ç‡è®¡ç®—å™¨ã€‚ ä¸€æ—¦ä¸¤é¡¹æœåŠ¡çš„ç»“æœå¯ç”¨ï¼Œæ‚¨å¯ä»¥å°†å…¶ç»“æœåˆå¹¶è®¡ç®—å¹¶ä»¥è‹±é•‘æ‰“å°ä»·æ ¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">findBestPrice(<span class="string">"iPhone6"</span>)</span><br><span class="line">    .thenCombine(lookupExchangeRate(Currency.GBP), <span class="keyword">this</span>::exchange)</span><br><span class="line">    .thenAccept(localAmount -&gt; System.out.printf(<span class="string">"It will cost you %f GBP\n"</span>, localAmount));</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> CompletableFuture&lt;Price&gt; <span class="title">findBestPrice</span><span class="params">(String productName)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> CompletableFuture.supplyAsync(() -&gt; priceFinder.findBestPrice(productName));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> CompletableFuture&lt;Double&gt; <span class="title">lookupExchangeRate</span><span class="params">(Currency localCurrency)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> CompletableFuture.supplyAsync(() -&gt; exchangeService.lookupExchangeRate(Currency.USD, localCurrency));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Optional"><a href="#Optional" class="headerlink" title="Optional"></a>Optional</h3><p>Java 8å¼•å…¥äº†ä¸€ä¸ªåä¸ºOptionalçš„æ–°ç±»ã€‚ å—åˆ°å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€çš„å¯å‘ï¼Œå½“å€¼å¯èƒ½å­˜åœ¨æˆ–ç¼ºå¤±æ—¶ï¼Œå…è®¸åœ¨ä»£ç åº“ä¸­æ›´å¥½åœ°å»ºæ¨¡ã€‚ æŠŠå®ƒçœ‹ä½œä¸€ä¸ªå•å€¼å®¹å™¨ï¼Œå› ä¸ºå®ƒåŒ…å«ä¸€ä¸ªå€¼æˆ–æ˜¯ç©ºçš„ã€‚ Optionalå·²ç»åœ¨æ›¿ä»£é›†åˆæ¡†æ¶ï¼ˆå¦‚Guavaï¼‰ä¸­å¯ç”¨ï¼Œä½†ç°åœ¨å¯ä½œä¸ºJava APIçš„ä¸€éƒ¨åˆ†ã€‚ Optionalçš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯å®ƒå¯ä»¥ä¿æŠ¤ä½ å…å—NullPointerExceptionsçš„ä¾µå®³ã€‚ äº‹å®ä¸Šï¼ŒOptionalå®šä¹‰äº†ä¸€äº›æ–¹æ³•æ¥å¼ºåˆ¶ä½ æ˜ç¡®åœ°æ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦å­˜åœ¨ã€‚ ä»¥ä¸‹é¢çš„ä»£ç ä¸ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getEventWithId(<span class="number">10</span>).getLocation().getCity();</span><br></pre></td></tr></table></figure><p>getEventWithId(10)è¿”å›nullï¼Œæˆ–è€…getLocation()è¿”å›nullï¼Œéƒ½ä¼šå¯¼è‡´ç¨‹åºæŠ›å‡ºå¼‚å¸¸ï¼šNullPointerExceptionã€‚ä¸ºäº†é¿å…å¼‚å¸¸å‘ç”Ÿï¼Œéœ€è¦åšä»¥ä¸‹åˆ¤æ–­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getCityForEvent</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">    Event event = getEventWithId(id);</span><br><span class="line">    <span class="keyword">if</span>(event != <span class="keyword">null</span>) &#123;</span><br><span class="line">        Location location = event.getLocation();</span><br><span class="line">        <span class="keyword">if</span>(location != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> location.getCity();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"TBC"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œä¸€ä¸ª <code>Event</code> å¯èƒ½æœ‰ä¸€ä¸ªå…³è”çš„ <code>Location</code>ã€‚ ç„¶è€Œï¼Œä¸€ä¸ª <code>Location</code> æ€»æ˜¯æœ‰ä¸€ä¸ªç›¸å…³çš„ <code>City</code>ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬å¸¸å¸¸å¿˜è®°æ£€æŸ¥nullã€‚ å¦å¤–ï¼Œä»£ç ä¹Ÿä¼šå˜å¾—æ›´åŠ å†—é•¿ã€‚ ä½¿ç”¨Optionalï¼Œæ‚¨å¯ä»¥é‡æ„ä»£ç ï¼Œä½¿å…¶å˜å¾—æ›´åŠ ç®€å•æ˜äº†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getCityForEvent</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">    Optional.ofNullable(getEventWithId(id))</span><br><span class="line">            .flatMap(<span class="keyword">this</span>::getLocation)</span><br><span class="line">            .map(<span class="keyword">this</span>::getCity)</span><br><span class="line">            .orElse(<span class="string">"TBC"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–°Dateå’ŒTime-API"><a href="#æ–°Dateå’ŒTime-API" class="headerlink" title="æ–°Dateå’ŒTime API"></a>æ–°Dateå’ŒTime API</h3><p>java 8å¼•å…¥äº†ä¸€ä¸ªå…¨æ–°çš„<code>Date</code>å’Œ<code>Time</code>çš„APIï¼Œä¿®å¤äº†æ—§<code>Date</code>å’Œ<code>Calendar</code> ä¸­å­˜åœ¨çš„è®¸å¤šé—®é¢˜ã€‚æ–°çš„Dateå’ŒTime APIä¸»è¦æ ¹æ®ä»¥ä¸‹ä¸¤ä¸ªåŸåˆ™è¿›è¡Œè®¾è®¡ï¼š</p><p><strong>é¢†åŸŸé©±åŠ¨è®¾è®¡</strong></p><p>æ–°çš„Dateå’ŒTime APIé€šè¿‡å¼•å…¥æ–°çš„classå¯¹è±¡æ¥ç²¾ç¡®æ¨¡å¼å„ç§æ—¥æœŸå’Œæ—¶é—´çš„æ¦‚å¿µã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Periodç±»æ¥è¡¨ç¤ºç±»ä¼¼â€œ2ä¸ªæœˆå’Œ3å¤©â€çš„å€¼ï¼Œå¹¶ä½¿ç”¨ZonedDateTimeæ¥è¡¨ç¤ºå…·æœ‰æ—¶åŒºçš„æ—¥æœŸæ—¶é—´ã€‚æ¯ä¸ªç±»éƒ½æä¾›äº†åŸºäºæµç•…å¼ç¼–ç é£æ ¼çš„ç‰¹å®šé¢†åŸŸçš„æ–¹æ³•ã€‚ å› æ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ–¹æ³•é“¾æ¥ç¼–å†™æ›´å¤šå¯è¯»æ€§å¼ºçš„ä»£ç ã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç æ˜¾ç¤ºå¦‚ä½•åˆ›å»ºä¸€ä¸ªæ–°çš„LocalDateTimeå¯¹è±¡å¹¶æ·»åŠ 2å°æ—¶30åˆ†é’Ÿï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LocatedDateTime coffeeBreak = LocalDateTime.now()</span><br><span class="line">                                           .plusHours(<span class="number">2</span>)</span><br><span class="line">                                           .plusMinutes(<span class="number">30</span>);</span><br></pre></td></tr></table></figure><p><strong>ä¸å¯å˜æ€§</strong></p><p>Dateå’ŒCalenderç±»çš„å¦ä¸€ä¸ªé—®é¢˜å°±æ˜¯å®ƒä»¬æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚å¦å¤–ï¼Œä½¿ç”¨æ—¥æœŸä½œä¸ºå…¶APIçš„å¼€å‘äººå‘˜å¯èƒ½ä¼šæ„å¤–åœ°æ›´æ–°æ—¶é—´å€¼ã€‚ä¸ºäº†é¢„é˜²è¿™ç§æ½œåœ¨Bugçš„äº§ç”Ÿï¼Œåœ¨æ–°çš„Dateå’ŒTime APIä¸­ï¼Œæ‰€æœ‰çš„ç±»éƒ½æ˜¯ä¸å¯å˜çš„ã€‚æ¢å¥è¯è¯´ï¼Œåœ¨æ–°çš„Dateå’ŒTime APIä¸­ï¼Œä½ æ— æ³•ä¿®æ”¹å¯¹è±¡çš„çŠ¶æ€ï¼Œç›¸åï¼Œä½ éœ€è¦è°ƒç”¨æ–°çš„æ–¹æ³•æ¥æ›´æ–°å€¼ï¼Œå¹¶ä¸”ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ZoneId london = ZoneId.of(<span class="string">"Europe/London"</span>);</span><br><span class="line">LocalDate july4 = LocalDate.of(<span class="number">2014</span>, Month.JULY, <span class="number">4</span>);</span><br><span class="line">LocalTime early = LocalTime.parse(<span class="string">"08:45"</span>);</span><br><span class="line">ZonedDateTime flightDeparture = ZonedDateTime.of(july4, early, london);</span><br><span class="line">System.out.println(flightDeparture);</span><br><span class="line"></span><br><span class="line">LocalTime from = LocalTime.from(flightDeparture);</span><br><span class="line">System.out.println(from);</span><br><span class="line"></span><br><span class="line">ZonedDateTime touchDown = ZonedDateTime.of(july4,</span><br><span class="line">           LocalTime.of(<span class="number">11</span>, <span class="number">35</span>),</span><br><span class="line">           ZoneId.of(<span class="string">"Europe/Stockholm"</span>));</span><br><span class="line">Duration flightLength = Duration.between(flightDeparture, touchDown);</span><br><span class="line">System.out.println(flightLength);</span><br><span class="line"></span><br><span class="line"><span class="comment">// How long have I been in continental Europe?</span></span><br><span class="line">ZonedDateTime now = ZonedDateTime.now();</span><br><span class="line">Duration timeHere = Duration.between(touchDown, now);</span><br><span class="line">System.out.println(timeHere);</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2014-07-04T08:45+01:00[Europe/London]</span><br><span class="line">08:45</span><br><span class="line">PT1H50M</span><br><span class="line">PT33879H12M25.546S</span><br></pre></td></tr></table></figure><h5 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h5><ul><li><a href="https://www.oreilly.com/programming/free/introducing-java-8.csp" target="_blank" rel="noopener">https://www.oreilly.com/programming/free/introducing-java-8.csp</a></li><li><a href="https://javabrains.thinkific.com/courses/take/java-8-lambda-basics/multimedia/2817266-introduction" target="_blank" rel="noopener">https://javabrains.thinkific.com/courses/take/java-8-lambda-basics/multimedia/2817266-introduction</a></li><li><a href="http://ifeve.com/java-8-features-tutorial" target="_blank" rel="noopener">http://ifeve.com/java-8-features-tutorial</a></li><li><a href="http://www.importnew.com/19345.html" target="_blank" rel="noopener">http://www.importnew.com/19345.html</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Java8 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Concurrent Mark Sweep(CMS)]]></title>
      <url>/posts/jvm-gc-concurrent-mark-sweep-cms.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/pexels-photo-1193879.jpeg?imageslim" alt="pexels-photo-1193879"></p><p><a href="https://wangwei.one/posts/4cec9f4f.html">å‰é¢</a> æˆ‘ä»¬ä»‹ç»äº† Serial GC ä¸ Parallel GC çš„ä½¿ç”¨ä¸é…ç½®ï¼Œä»Šå¤©æˆ‘ä»¬æ¥ä»‹ç»CMS GCçš„ä½¿ç”¨ä¸é…ç½®ã€‚</p><a id="more"></a><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>å¹´è½»ä»£é‡‡ç”¨å¹¶è¡ŒSTWæ–¹å¼çš„ <a href="https://wangwei.one/posts/396cfa32.html">mark-copy(æ ‡è®°-å¤åˆ¶)</a> ç®—æ³•ï¼Œå¯¹è€å¹´ä»£ä¸»è¦ä½¿ç”¨ <a href="https://wangwei.one/posts/396cfa32.html">mark-sweep(æ ‡è®°-æ¸…ç†)</a> ç®—æ³•ã€‚</p><p>CMSæ”¶é›†å™¨çš„ä¸»è¦ç›®çš„ï¼šå‡å°‘è€å¹´ä»£åƒåœ¾æ”¶é›†çš„åœé¡¿æ—¶é—´ã€‚ä¸»è¦é€šè¿‡ä¸¤ç§æ‰‹æ®µæ¥è¾¾æˆæ­¤ç›®çš„ï¼š</p><ul><li>ä¸å¯¹è€å¹´ä»£è¿›è¡Œæ•´ç†ï¼Œè€Œæ˜¯ä½¿ç”¨ç©ºé—²åˆ—è¡¨(free-list)æ¥ç®¡ç†å†…å­˜ç©ºé—´çš„å›æ”¶ã€‚</li><li>åœ¨mark-sweepé˜¶æ®µé‡‡ç”¨å¹¶å‘æ–¹å¼ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·æ‰§è¡Œã€‚</li></ul><h2 id="è¿ä½œè¿‡ç¨‹"><a href="#è¿ä½œè¿‡ç¨‹" class="headerlink" title="è¿ä½œè¿‡ç¨‹"></a>è¿ä½œè¿‡ç¨‹</h2><p><img src="https://img.i7years.com/blog/CMS.png" alt="CMS"></p><p>CMSçš„ä¸»è¦åˆ†ä¸º5ä¸ªé˜¶æ®µï¼šåˆå§‹æ ‡è®°ï¼ˆCMS initial markï¼‰ã€å¹¶å‘æ ‡è®°ï¼ˆCMS concurrent markï¼‰ã€é‡æ–°æ ‡è®°ï¼ˆCMS remarkï¼‰ã€å¹¶å‘æ¸…é™¤ï¼ˆCMS concurrent sweepï¼‰ã€é‡ç½®ã€‚</p><h2 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h2><ul><li><strong>å¯¹CPUèµ„æºéå¸¸æ•æ„Ÿ</strong>ã€‚CMSé»˜è®¤å¯åŠ¨çš„å›æ”¶çº¿ç¨‹æ•°æ˜¯(CPUæ•°é‡+3)/4ã€‚CMSåœ¨å¹¶å‘é˜¶æ®µä¼šå ç”¨éƒ¨åˆ†CPUï¼Œå¯¼è‡´ç”¨æˆ·åº”ç”¨ç¨‹åºæ‰§è¡Œé€Ÿåº¦å˜æ…¢ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚</li><li><p><strong>æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼ˆFloating Garbageï¼‰</strong>ã€‚ç”±äºCMSå¹¶å‘æ¸…ç†é˜¶æ®µç”¨æˆ·çº¿ç¨‹è¿˜åœ¨è¿è¡Œç€ï¼Œä¼´éšç¨‹åºè¿è¡Œè‡ªç„¶å°±è¿˜ä¼šæœ‰æ–°çš„åƒåœ¾ä¸æ–­äº§ç”Ÿï¼Œè¿™ä¸€éƒ¨åˆ†åƒåœ¾å‡ºç°åœ¨æ ‡è®°è¿‡ç¨‹ä¹‹åï¼ŒCMSæ— æ³•åœ¨å½“æ¬¡æ”¶é›†ä¸­å¤„ç†æ‰å®ƒä»¬ï¼Œåªå¥½ç•™å¾…ä¸‹ä¸€æ¬¡GCæ—¶å†æ¸…ç†æ‰ã€‚è¦æ˜¯CMSè¿è¡ŒæœŸé—´é¢„ç•™çš„å†…å­˜æ— æ³•æ»¡è¶³ç¨‹åºéœ€è¦ï¼Œå°±ä¼šå‡ºç°ä¸€æ¬¡â€œConcurrent Mode Failureâ€å¤±è´¥ï¼Œè¿™æ—¶è™šæ‹Ÿæœºå°†å¯åŠ¨åå¤‡é¢„æ¡ˆï¼šä¸´æ—¶å¯ç”¨Serial Oldæ”¶é›†å™¨æ¥é‡æ–°è¿›è¡Œè€å¹´ä»£çš„åƒåœ¾æ”¶é›†ï¼Œè¿™æ ·åœé¡¿æ—¶é—´å°±å¾ˆé•¿äº†ã€‚æ‰€ä»¥è¯´å‚æ•°<code>-XX:CMSInitiatingOccupancyFraction</code> è®¾ç½®å¾—å¤ªé«˜å¾ˆå®¹æ˜“å¯¼è‡´å¤§é‡â€œConcurrent Mode Failureâ€å¤±è´¥ï¼Œæ€§èƒ½åè€Œé™ä½ã€‚</p></li><li><p><strong>ä¼šäº§ç”Ÿå¤§é‡çš„å†…å­˜ç¢ç‰‡ç©ºé—´</strong>ã€‚å¯ä»¥é€šè¿‡ <code>-XX:UseCMSCompactAtFullCollection</code> ä¸<code>-XX:CMSFullGCsBeforeCompaction</code> è¿™ä¸ªä¸¤ä¸ªå‚æ•°æ¥è§£å†³é—®é¢˜ã€‚</p></li></ul><h2 id="æ§åˆ¶å‚æ•°"><a href="#æ§åˆ¶å‚æ•°" class="headerlink" title="æ§åˆ¶å‚æ•°"></a>æ§åˆ¶å‚æ•°</h2><ul><li><p><code>-XX:+UseConcMarkSweepGC</code>ï¼šæ–°ç”Ÿä»£ä½¿ç”¨å¹¶è¡Œæ”¶é›†å™¨ï¼Œè€å¹´ä»£ä½¿ç”¨ CMS+ä¸²è¡Œæ”¶é›†å™¨ã€‚</p></li><li><p><code>-XX:+ParallelCMSThreads</code>ï¼šè®¾å®š CMS çš„çº¿ç¨‹æ•°é‡ã€‚</p></li><li><p><code>-XX:+CMSInitiatingOccupancyFraction</code>ï¼šè®¾ç½® CMS æ”¶é›†å™¨åœ¨è€å¹´ä»£ç©ºé—´è¢«ä½¿ç”¨å¤šå°‘åè§¦å‘ï¼Œé»˜è®¤ä¸º 68%ã€‚</p></li><li><p><code>-XX:+UseFullGCsBeforeCompaction</code>ï¼šè®¾å®šè¿›è¡Œå¤šå°‘æ¬¡ CMS åƒåœ¾å›æ”¶åï¼Œè¿›è¡Œä¸€æ¬¡å†…å­˜å‹ç¼©ã€‚</p></li><li><p><code>-XX:+CMSParallelRemarkEndable</code>ï¼š å¯ç”¨å¹¶è¡Œé‡æ ‡è®°ã€‚</p></li><li><p><code>-XX:+CMSClassUnloadingEnabled</code>ï¼šå…è®¸å¯¹ç±»å…ƒæ•°æ®è¿›è¡Œå›æ”¶ã€‚</p></li><li><p><code>-XX:CMSInitatingPermOccupancyFraction</code>ï¼šå½“æ°¸ä¹…åŒºå ç”¨ç‡è¾¾åˆ°è¿™ä¸€ç™¾åˆ†æ¯”åï¼Œå¯åŠ¨ CMS å›æ”¶ ã€‚</p><blockquote><p>å‰ææ¡ä»¶ï¼š <code>-XX:+CMSClassUnloadingEnabled</code></p></blockquote></li><li><p><code>-XX:UseCMSInitatingOccupancyOnly</code>ï¼šè¡¨ç¤ºåªåœ¨åˆ°è¾¾é˜ˆå€¼çš„æ—¶å€™ï¼Œæ‰è¿›è¡Œ CMS å›æ”¶ã€‚</p></li><li><p><code>-XX:+CMSIncrementalMode</code>ï¼šä½¿ç”¨å¢é‡æ¨¡å¼ï¼Œæ¯”è¾ƒé€‚åˆå• CPUã€‚</p></li><li><p><code>-XX:+UseCMSCompactAtFullCollection</code>ï¼šï¼ˆé»˜è®¤å°±æ˜¯å¼€å¯çš„ï¼‰ï¼Œç”¨äºåœ¨CMSæ”¶é›†å™¨é¡¶ä¸ä½è¦è¿›è¡ŒFullGCæ—¶å¼€å¯å†…å­˜ç¢ç‰‡çš„åˆå¹¶æ•´ç†è¿‡ç¨‹ï¼Œå†…å­˜æ•´ç†çš„è¿‡ç¨‹æ˜¯æ— æ³•å¹¶å‘çš„ï¼Œç©ºé—´ç¢ç‰‡é—®é¢˜æ²¡æœ‰äº†ï¼Œä½†åœé¡¿æ—¶é—´ä¸å¾—ä¸å˜é•¿ã€‚</p></li></ul><h2 id="GCæ—¥å¿—åˆ†æ"><a href="#GCæ—¥å¿—åˆ†æ" class="headerlink" title="GCæ—¥å¿—åˆ†æ"></a>GCæ—¥å¿—åˆ†æ</h2><h5 id="VM-å‚æ•°"><a href="#VM-å‚æ•°" class="headerlink" title="VM å‚æ•°"></a>VM å‚æ•°</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-server</span><br><span class="line">-XX:+PrintGCDetails</span><br><span class="line">-XX:+PrintGCTimeStamps</span><br><span class="line">-XX:+PrintGCDateStamps</span><br><span class="line">-XX:+UseConcMarkSweepGC</span><br></pre></td></tr></table></figure><h5 id="Minor-GC"><a href="#Minor-GC" class="headerlink" title="Minor GC"></a>Minor GC</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">33.960</span>-<span class="number">0800</span>: <span class="number">4.118</span>: [GC2016-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">33.961</span>-<span class="number">0800</span>: <span class="number">4.119</span>: [ParNew: <span class="number">52480</span>K-&gt;<span class="number">6528</span>K(<span class="number">59008</span>K), <span class="number">0.0115760</span> secs] <span class="number">52480</span>K-&gt;<span class="number">6679</span>K(<span class="number">255616</span>K), <span class="number">0.0120110</span> secs] [Times: user=<span class="number">0.03</span> sys=<span class="number">0.00</span>, real=<span class="number">0.01</span> secs]</span><br></pre></td></tr></table></figure><blockquote><p>æ—¥å¿—åˆ†æå’Œ <a href="https://wangwei.one/posts/4cec9f4f.html">å‰é¢</a> å·®ä¸å¤šï¼Œè¿™é‡Œä¸ç»†è¯´</p></blockquote><h5 id="Full-GC"><a href="#Full-GC" class="headerlink" title="Full GC"></a>Full GC</h5><p>æ­¤å‰æˆ‘ä»¬ä»‹ç»çš„GCæ—¥å¿—æ ¼å¼éƒ½å·®ä¸å¤šï¼Œè€ŒCMS Full GCçš„æ ¼å¼åˆ™å®Œå…¨ä¸åŒï¼Œå¦‚ä¸‹æ˜¯CMSå¯¹è€å¹´ä»£è¿›è¡Œåƒåœ¾æ”¶é›†å„é˜¶æ®µçš„æ—¥å¿—è¾“å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.197</span>-<span class="number">0800</span>: <span class="number">11.355</span>: [GC [<span class="number">1</span> CMS-initial-mark: <span class="number">98970</span>K(<span class="number">196608</span>K)] <span class="number">106560</span>K(<span class="number">255616</span>K), <span class="number">0.0020160</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs]</span><br><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.199</span>-<span class="number">0800</span>: <span class="number">11.357</span>: [CMS-concurrent-mark-start]</span><br><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.263</span>-<span class="number">0800</span>: <span class="number">11.421</span>: [CMS-concurrent-mark: <span class="number">0.063</span>/<span class="number">0.063</span> secs] [Times: user=<span class="number">0.10</span> sys=<span class="number">0.01</span>, real=<span class="number">0.07</span> secs]</span><br><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.263</span>-<span class="number">0800</span>: <span class="number">11.421</span>: [CMS-concurrent-preclean-start]</span><br><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.264</span>-<span class="number">0800</span>: <span class="number">11.422</span>: [CMS-concurrent-preclean: <span class="number">0.001</span>/<span class="number">0.001</span> secs] [Times: user=<span class="number">0.01</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs]</span><br><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.264</span>-<span class="number">0800</span>: <span class="number">11.422</span>: [CMS-concurrent-abortable-preclean-start]</span><br><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.365</span>-<span class="number">0800</span>: <span class="number">11.523</span>: [GC2016-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.365</span>-<span class="number">0800</span>: <span class="number">11.523</span>: [ParNew2016-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.372</span>-<span class="number">0800</span>: <span class="number">11.530</span>: [CMS-concurrent-abortable-preclean: <span class="number">0.007</span>/<span class="number">0.108</span> secs] [Times: user=<span class="number">0.08</span> sys=<span class="number">0.02</span>, real=<span class="number">0.11</span> secs]</span><br><span class="line">: <span class="number">59008</span>K-&gt;<span class="number">6528</span>K(<span class="number">59008</span>K), <span class="number">0.0084290</span> secs] <span class="number">157978</span>K-&gt;<span class="number">108370</span>K(<span class="number">255616</span>K), <span class="number">0.0085350</span> secs] [Times: user=<span class="number">0.01</span> sys=<span class="number">0.00</span>, real=<span class="number">0.01</span> secs]</span><br><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.374</span>-<span class="number">0800</span>: <span class="number">11.532</span>: [GC[YG occupancy: <span class="number">7578</span> K (<span class="number">59008</span> K)]<span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.374</span>-<span class="number">0800</span>: <span class="number">11.532</span>: [Rescan (parallel) , <span class="number">0.0027870</span> secs]<span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.377</span>-<span class="number">0800</span>: <span class="number">11.535</span>: [weak refs processing, <span class="number">0.0027290</span> secs]<span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.380</span>-<span class="number">0800</span>: <span class="number">11.538</span>: [scrub string table, <span class="number">0.0007810</span> secs] [<span class="number">1</span> CMS-remark: <span class="number">101842</span>K(<span class="number">196608</span>K)] <span class="number">109420</span>K(<span class="number">255616</span>K), <span class="number">0.0066720</span> secs] [Times: user=<span class="number">0.01</span> sys=<span class="number">0.00</span>, real=<span class="number">0.01</span> secs]</span><br><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.382</span>-<span class="number">0800</span>: <span class="number">11.540</span>: [CMS-concurrent-sweep-start]</span><br><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.412</span>-<span class="number">0800</span>: <span class="number">11.570</span>: [CMS-concurrent-sweep: <span class="number">0.031</span>/<span class="number">0.031</span> secs] [Times: user=<span class="number">0.05</span> sys=<span class="number">0.01</span>, real=<span class="number">0.03</span> secs]</span><br><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.413</span>-<span class="number">0800</span>: <span class="number">11.571</span>: [CMS-concurrent-reset-start]</span><br><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.413</span>-<span class="number">0800</span>: <span class="number">11.571</span>: [CMS-concurrent-reset: <span class="number">0.000</span>/<span class="number">0.000</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs]</span><br></pre></td></tr></table></figure><p><strong>é˜¶æ®µ 1: Initial Mark(åˆå§‹æ ‡è®° )</strong>ã€‚è¿™æ˜¯ç¬¬ä¸€æ¬¡STWäº‹ä»¶ã€‚æ­¤é˜¶æ®µçš„ç›®æ ‡æ˜¯æ ‡è®°è€å¹´ä»£ä¸­æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬ GC Roots çš„ç›´æ¥å¼•ç”¨ï¼Œä»¥åŠç”±å¹´è½»ä»£ä¸­å­˜æ´»å¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡ã€‚</p><p><img src="https://img.i7years.com/blog/04_06_g1-06.png" alt="04_06_g1-06"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.197</span>-<span class="number">0800</span>: <span class="number">11.355</span>: [GC [<span class="number">1</span> CMS-initial-mark: <span class="number">98970</span>K(<span class="number">196608</span>K)] <span class="number">106560</span>K(<span class="number">255616</span>K), <span class="number">0.0020160</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs]</span><br></pre></td></tr></table></figure><blockquote><p><code>CMS-initial-mark</code>ï¼šè¡¨ç¤ºCMSåƒåœ¾æ”¶é›†ç¬¬ä¸€ä¸ªé˜¶æ®µâ€”â€”åˆå§‹æ ‡è®°ã€‚</p><p><code>98970K(196608K)</code>ï¼šè¡¨ç¤ºè€å¹´ä»£å½“å‰çš„ä½¿ç”¨æ€»é‡ä¸º 98970Kï¼Œè€å¹´ä»£æ€»çš„å†…å­˜æ•°é‡ä¸ºï¼š196608K</p><p><code>106560K(255616K)</code>ï¼šè¡¨ç¤ºå½“å‰å †çš„ä½¿ç”¨æ€»é‡ä¸º 106560Kï¼Œå †å†…å­˜æ€»é‡ä¸ºï¼š255616K</p></blockquote><p><strong>é˜¶æ®µ 2: Concurrent Mark(å¹¶å‘æ ‡è®° )</strong>ã€‚åœ¨æ­¤é˜¶æ®µï¼Œåƒåœ¾æ”¶é›†å™¨éå†è€å¹´ä»£ï¼Œæ ‡è®°æ‰€æœ‰çš„å­˜æ´»å¯¹è±¡ï¼Œä»å‰ä¸€é˜¶æ®µ â€œInitial Markâ€ æ‰¾åˆ°çš„ root æ ¹å¼€å§‹ç®—èµ·ã€‚ é¡¾åæ€ä¹‰ï¼Œâ€œå¹¶å‘æ ‡è®°â€é˜¶æ®µï¼Œå°±æ˜¯ä¸åº”ç”¨ç¨‹åºåŒæ—¶è¿è¡Œï¼Œä¸ç”¨æš‚åœçš„é˜¶æ®µã€‚ è¯·æ³¨æ„ï¼Œå¹¶éæ‰€æœ‰è€å¹´ä»£ä¸­å­˜æ´»çš„å¯¹è±¡éƒ½åœ¨æ­¤é˜¶æ®µè¢«æ ‡è®°ï¼Œå› ä¸ºåœ¨æ ‡è®°è¿‡ç¨‹ä¸­å¯¹è±¡çš„å¼•ç”¨å…³ç³»è¿˜åœ¨å‘ç”Ÿå˜åŒ–ã€‚</p><p><img src="https://img.i7years.com/blog/04_07_g1-07.png" alt="04_07_g1-07"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.199</span>-<span class="number">0800</span>: <span class="number">11.357</span>: [CMS-concurrent-mark-start]</span><br><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.263</span>-<span class="number">0800</span>: <span class="number">11.421</span>: [CMS-concurrent-mark: <span class="number">0.063</span>/<span class="number">0.063</span> secs] [Times: user=<span class="number">0.10</span> sys=<span class="number">0.01</span>, real=<span class="number">0.07</span> secs]</span><br></pre></td></tr></table></figure><blockquote><p><code>CMS-concurrent-mark-start</code>ï¼šå¹¶å‘æ ‡è®°å¼€å§‹</p><p><code>CMS-concurrent-mark</code>ï¼šCMSåƒåœ¾å›æ”¶çš„å¹¶å‘æ ‡è®°é˜¶æ®µã€‚</p><p><code>0.063/0.063 secs</code>ï¼šæ­¤é˜¶æ®µçš„æŒç»­æ—¶é—´ï¼Œåˆ†åˆ«æ˜¯è¿è¡Œæ—¶é—´å’Œç›¸åº”çš„å®é™…æ—¶é—´ã€‚</p></blockquote><p><strong>é˜¶æ®µ 3: Concurrent Preclean(å¹¶å‘é¢„æ¸…ç†)</strong>ã€‚æ­¤é˜¶æ®µåŒæ ·æ˜¯ä¸åº”ç”¨çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œçš„ï¼Œä¸éœ€è¦åœæ­¢åº”ç”¨çº¿ç¨‹ã€‚ å› ä¸ºå‰ä¸€é˜¶æ®µæ˜¯ä¸ç¨‹åºå¹¶å‘è¿›è¡Œçš„ï¼Œå¯èƒ½æœ‰ä¸€äº›å¼•ç”¨å·²ç»æ”¹å˜ã€‚å¦‚æœåœ¨å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­å‘ç”Ÿäº†å¼•ç”¨å…³ç³»å˜åŒ–ï¼ŒJVMä¼š(é€šè¿‡â€œCardâ€)å°†å‘ç”Ÿäº†æ”¹å˜çš„åŒºåŸŸæ ‡è®°ä¸ºâ€œè„â€åŒº(è¿™å°±æ˜¯æ‰€è°“çš„ <a href="http://psy-lob-saw.blogspot.com/2014/10/the-jvm-write-barrier-card-marking.html" target="_blank" rel="noopener">å¡ç‰‡æ ‡è®°Card Marking</a> )ã€‚</p><p><img src="https://img.i7years.com/blog/04_08_g1-08.png" alt="04_08_g1-08"></p><p>åœ¨é¢„æ¸…ç†é˜¶æ®µï¼Œè¿™äº›è„å¯¹è±¡ä¼šè¢«ç»Ÿè®¡å‡ºæ¥ï¼Œä»ä»–ä»¬å¯è¾¾çš„å¯¹è±¡ä¹Ÿè¢«æ ‡è®°ä¸‹æ¥ã€‚æ­¤é˜¶æ®µå®Œæˆå, ç”¨ä»¥æ ‡è®°çš„ card ä¹Ÿå°±è¢«æ¸…ç©ºäº†ã€‚</p><p><img src="https://img.i7years.com/blog/04_09_g1-09.png" alt="04_09_g1-09"></p><p>æ­¤å¤–ï¼Œæœ¬é˜¶æ®µä¹Ÿä¼šæ‰§è¡Œä¸€äº›å¿…è¦çš„ç»†èŠ‚å¤„ç†ï¼Œå¹¶ä¸º Final Remark é˜¶æ®µåšä¸€äº›å‡†å¤‡å·¥ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.263</span>-<span class="number">0800</span>: <span class="number">11.421</span>: [CMS-concurrent-preclean-start]</span><br><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.264</span>-<span class="number">0800</span>: <span class="number">11.422</span>: [CMS-concurrent-preclean: <span class="number">0.001</span>/<span class="number">0.001</span> secs] [Times: user=<span class="number">0.01</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs]</span><br></pre></td></tr></table></figure><blockquote><p><code>CMS-concurrent-preclean</code>ï¼šå¹¶å‘é¢„æ¸…ç†é˜¶æ®µï¼Œç»Ÿè®¡æ­¤å‰çš„æ ‡è®°é˜¶æ®µä¸­å‘ç”Ÿäº†æ”¹å˜çš„å¯¹è±¡ã€‚</p><p><code>0.001/0.001 secs</code>ï¼šæ­¤é˜¶æ®µçš„æŒç»­æ—¶é—´ï¼Œåˆ†åˆ«æ˜¯è¿è¡Œæ—¶é—´å’Œå¯¹åº”çš„å®é™…æ—¶é—´ã€‚</p></blockquote><p><strong>é˜¶æ®µ 4: Concurrent Abortable Preclean(å¹¶å‘å¯å–æ¶ˆçš„é¢„æ¸…ç†)</strong>ã€‚ æ­¤é˜¶æ®µä¹Ÿä¸åœæ­¢åº”ç”¨çº¿ç¨‹ã€‚æœ¬é˜¶æ®µå°è¯•åœ¨ STWçš„ Final Remark ä¹‹å‰å°½å¯èƒ½åœ°å¤šåšä¸€äº›å·¥ä½œã€‚æœ¬é˜¶æ®µçš„å…·ä½“æ—¶é—´å–å†³äºå¤šç§å› ç´ ï¼Œå› ä¸ºå®ƒå¾ªç¯åšåŒæ ·çš„äº‹æƒ…ï¼Œç›´åˆ°æ»¡è¶³æŸä¸ªé€€å‡ºæ¡ä»¶( å¦‚è¿­ä»£æ¬¡æ•°ã€æœ‰ç”¨å·¥ä½œé‡ã€æ¶ˆè€—çš„ç³»ç»Ÿæ—¶é—´ç­‰ç­‰)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.264</span>-<span class="number">0800</span>: <span class="number">11.422</span>: [CMS-concurrent-abortable-preclean-start]</span><br><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.365</span>-<span class="number">0800</span>: <span class="number">11.523</span>: [GC2016-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.365</span>-<span class="number">0800</span>: <span class="number">11.523</span>: [ParNew2016-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.372</span>-<span class="number">0800</span>: <span class="number">11.530</span>: [CMS-concurrent-abortable-preclean: <span class="number">0.007</span>/<span class="number">0.108</span> secs] [Times: user=<span class="number">0.08</span> sys=<span class="number">0.02</span>, real=<span class="number">0.11</span> secs]</span><br><span class="line">: <span class="number">59008</span>K-&gt;<span class="number">6528</span>K(<span class="number">59008</span>K), <span class="number">0.0084290</span> secs] <span class="number">157978</span>K-&gt;<span class="number">108370</span>K(<span class="number">255616</span>K), <span class="number">0.0085350</span> secs] [Times: user=<span class="number">0.01</span> sys=<span class="number">0.00</span>, real=<span class="number">0.01</span> secs]</span><br></pre></td></tr></table></figure><blockquote><p><code>CMS-concurrent-abortable-preclean</code>ï¼šå¹¶å‘å¯å–æ¶ˆçš„é¢„æ¸…ç†ã€‚</p></blockquote><p><strong>é˜¶æ®µ 5: Final Remark(æœ€ç»ˆæ ‡è®°)</strong>ã€‚è¿™æ˜¯æ­¤æ¬¡GCäº‹ä»¶ä¸­ç¬¬äºŒæ¬¡(ä¹Ÿæ˜¯æœ€åä¸€æ¬¡)STWé˜¶æ®µã€‚æœ¬é˜¶æ®µçš„ç›®æ ‡æ˜¯å®Œæˆè€å¹´ä»£ä¸­æ‰€æœ‰å­˜æ´»å¯¹è±¡çš„æ ‡è®°ã€‚å› ä¸ºä¹‹å‰çš„ preclean é˜¶æ®µæ˜¯å¹¶å‘çš„ï¼Œæœ‰å¯èƒ½æ— æ³•è·Ÿä¸Šåº”ç”¨ç¨‹åºçš„å˜åŒ–é€Ÿåº¦ã€‚æ‰€ä»¥éœ€è¦ STWæš‚åœæ¥å¤„ç†å¤æ‚æƒ…å†µã€‚</p><p>é€šå¸¸CMSä¼šå°è¯•åœ¨å¹´è½»ä»£å°½å¯èƒ½ç©ºçš„æƒ…å†µè¿è¡Œ final remark é˜¶æ®µï¼Œä»¥å…æ¥è¿å¤šæ¬¡å‘ç”Ÿ STW äº‹ä»¶ã€‚</p><p><strong>Java7çš„æ—¥å¿—å¦‚ä¸‹</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.374</span>-<span class="number">0800</span>: <span class="number">11.532</span>: [GC[YG occupancy: <span class="number">7578</span> K (<span class="number">59008</span> K)]<span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.374</span>-<span class="number">0800</span>: <span class="number">11.532</span>: [Rescan (parallel) , <span class="number">0.0027870</span> secs]<span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.377</span>-<span class="number">0800</span>: <span class="number">11.535</span>: [weak refs processing, <span class="number">0.0027290</span> secs]<span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.380</span>-<span class="number">0800</span>: <span class="number">11.538</span>: [scrub string table, <span class="number">0.0007810</span> secs] [<span class="number">1</span> CMS-remark: <span class="number">101842</span>K(<span class="number">196608</span>K)] <span class="number">109420</span>K(<span class="number">255616</span>K), <span class="number">0.0066720</span> secs] [Times: user=<span class="number">0.01</span> sys=<span class="number">0.00</span>, real=<span class="number">0.01</span> secs]</span><br></pre></td></tr></table></figure><p><strong>Java8çš„æ—¥å¿—å¦‚ä¸‹</strong>ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2016-06-18T16:10:41.353-0800: 11.046: [GC (CMS Final Remark) [YG occupancy: 7576 K (59008 K)]11.046: [Rescan (parallel) , 0.0048835 secs]11.051: [weak refs processing, 0.0007074 secs]11.052: [class unloading, 0.0145890 secs]11.067: [scrub symbol table, 0.0027903 secs]11.069: [scrub string table, 0.0023910 secs][1 CMS-remark: 104562K(196608K)] 112139K(255616K), 0.0303861 secs] [Times: user=0.05 sys=0.01, real=0.03 secs]</span><br></pre></td></tr></table></figure><blockquote><p><code>[YG occupancy: 7578 K (59008 K)]</code>ï¼šå¹´è½»ä»£ä½¿ç”¨é‡7578Kï¼Œæ€»é‡ä¸º 59008 Kã€‚</p><p><code>[Rescan (parallel) , 0.0027870 secs]</code>ï¼šåº”ç”¨ç¨‹åºæš‚å®šï¼Œé‡æ–°æ‰«æï¼Œå®Œæˆæ‰€æœ‰å­˜æ´»å¯¹è±¡çš„æ ‡è®°ã€‚è€—æ—¶ï¼š0.0027870ç§’</p><p><code>[weak refs processing, 0.0027290 secs]</code>ï¼šç¬¬ä¸€ä¸ªå­é˜¶æ®µï¼Œå¤„ç†å¼±å¼•ç”¨çš„</p><p><code>[class unloading, 0.0145890 secs]</code>ï¼šç¬¬äºŒä¸ªå­é˜¶æ®µï¼Œå¸è½½ä¸ä½¿ç”¨çš„ç±»ã€‚ï¼ˆJava8å¤šå‡ºäº†çš„ä¸€æ­¥ï¼‰</p><p><code>[scrub string table, 0.0007810 secs]</code>ï¼šç¬¬ä¸‰ä¸ªå­é˜¶æ®µï¼Œæ¸…æ´—å†…éƒ¨åŒ–å­—ç¬¦ä¸²å¯¹åº”çš„ string tables</p><p><code>101842K(196608K)</code>ï¼šæ­¤é˜¶æ®µå®Œæˆåè€å¹´ä»£çš„ä½¿ç”¨é‡å’Œæ€»é‡</p><p><code>109420K(255616K)</code>ï¼šæ­¤é˜¶æ®µå®Œæˆåæ•´ä¸ªå †å†…å­˜çš„ä½¿ç”¨é‡å’Œæ€»é‡</p></blockquote><p><strong>é˜¶æ®µ 6: Concurrent Sweep(å¹¶å‘æ¸…é™¤ )</strong> ã€‚æ­¤é˜¶æ®µä¸åº”ç”¨ç¨‹åºå¹¶å‘æ‰§è¡Œï¼Œ ä¸éœ€è¦STWåœé¡¿ã€‚ç›®çš„æ˜¯åˆ é™¤æœªä½¿ç”¨çš„å¯¹è±¡ï¼Œå¹¶æ”¶å›ä»–ä»¬å ç”¨çš„ç©ºé—´ã€‚</p><p><img src="https://img.i7years.com/blog/04_10_g1-10.png" alt="04_10_g1-10"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.382</span>-<span class="number">0800</span>: <span class="number">11.540</span>: [CMS-concurrent-sweep-start]</span><br><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.412</span>-<span class="number">0800</span>: <span class="number">11.570</span>: [CMS-concurrent-sweep: <span class="number">0.031</span>/<span class="number">0.031</span> secs] [Times: user=<span class="number">0.05</span> sys=<span class="number">0.01</span>, real=<span class="number">0.03</span> secs]</span><br></pre></td></tr></table></figure><blockquote><p><code>CMS-concurrent-sweep: 0.031/0.031 secs</code> ï¼šå¹¶å‘æ¸…ç†é˜¶æ®µï¼Œæ¸…ç†æ‰ä¸å†ä½¿ç”¨çš„åƒåœ¾å¯¹è±¡ã€‚</p></blockquote><p><strong>é˜¶æ®µ 7: Concurrent Reset(å¹¶å‘é‡ç½®)</strong> ã€‚æ­¤é˜¶æ®µä¸åº”ç”¨ç¨‹åºå¹¶å‘æ‰§è¡Œï¼Œé‡ç½®CMSç®—æ³•ç›¸å…³çš„å†…éƒ¨æ•°æ®ï¼Œä¸ºä¸‹ä¸€æ¬¡GCå¾ªç¯åšå‡†å¤‡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.413</span>-<span class="number">0800</span>: <span class="number">11.571</span>: [CMS-concurrent-reset-start]</span><br><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">18</span>T11:<span class="number">20</span>:<span class="number">41.413</span>-<span class="number">0800</span>: <span class="number">11.571</span>: [CMS-concurrent-reset: <span class="number">0.000</span>/<span class="number">0.000</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs]</span><br></pre></td></tr></table></figure><blockquote><p><code>CMS-concurrent-reset: 0.000/0.000 secs</code>ï¼šå¹¶å‘é‡ç½®é˜¶æ®µï¼Œä»¥åŠä½¿ç”¨æ—¶é—´ã€‚</p></blockquote><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://book.douban.com/subject/24722612/" target="_blank" rel="noopener">ã€ŠJVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ[ç¬¬2ç‰ˆ]ã€‹ç¬¬3ç« èŠ‚ã€Œåƒåœ¾æ”¶é›†å™¨ä¸å†…å­˜åˆ†é…ç­–ç•¥ã€</a></li><li><a href="https://github.com/cncounter/gc-handbook" target="_blank" rel="noopener">https://github.com/cncounter/gc-handbook</a></li><li><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/cms.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/cms.html</a></li><li><a href="https://plumbr.io/handbook/garbage-collection-algorithms-implementations/concurrent-mark-and-sweep" target="_blank" rel="noopener">https://plumbr.io/handbook/garbage-collection-algorithms-implementations/concurrent-mark-and-sweep</a></li><li><a href="http://www.oracle.com/technetwork/tutorials/tutorials-1876574.html" target="_blank" rel="noopener">http://www.oracle.com/technetwork/tutorials/tutorials-1876574.html</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> GC </tag>
            
            <tag> JVM </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Serial GC ä¸ Parallel GC]]></title>
      <url>/posts/jvm-gc-serial-and-parallel.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/pexels-photo-1451567.jpeg?imageslim" alt="pexels-photo-1451567"></p><p><a href="https://wangwei.one/posts/396cfa32.html">å‰é¢</a> æˆ‘ä»¬å­¦ä¹ äº†JVMä¸­å‡ ç§å¸¸ç”¨çš„GCç®—æ³•ï¼Œä»Šå¤©æˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹JVMä¸­å®ç°è¿™äº›ç®—æ³•çš„åƒåœ¾æ”¶é›†å™¨ã€‚å¤§å¤šæ•°JVMéƒ½éœ€è¦ä½¿ç”¨ä¸¤ç§ä¸åŒçš„GCç®—æ³• â€”â€” ä¸€ç§ç”¨æ¥æ¸…ç†å¹´è½»ä»£ï¼Œå¦ä¸€ç§ç”¨æ¥æ¸…ç†è€å¹´ä»£ã€‚</p><a id="more"></a><h2 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h2><p>æˆ‘ä»¬å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªä¸åŒçš„è§’åº¦æ¥å¯¹GCæ”¶é›†å™¨è¿›è¡Œåˆ†ç±»ï¼š</p><ol><li>æŒ‰çº¿ç¨‹æ•°åˆ†ï¼Œå¯ä»¥åˆ†ä¸ºä¸²è¡Œåƒåœ¾å›æ”¶å™¨å’Œå¹¶è¡Œåƒåœ¾å›æ”¶å™¨ã€‚<ul><li>ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ä¸€æ¬¡åªä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œåƒåœ¾å›æ”¶ï¼›</li><li>å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ä¸€æ¬¡å°†å¼€å¯å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œåƒåœ¾å›æ”¶ã€‚åœ¨å¹¶è¡Œèƒ½åŠ›è¾ƒå¼ºçš„ CPU ä¸Šï¼Œä½¿ç”¨å¹¶è¡Œåƒåœ¾å›æ”¶å™¨å¯ä»¥ç¼©çŸ­ GC çš„åœé¡¿æ—¶é—´ã€‚</li></ul></li><li>æŒ‰ç…§å·¥ä½œæ¨¡å¼åˆ†ï¼Œå¯ä»¥åˆ†ä¸ºå¹¶å‘å¼åƒåœ¾å›æ”¶å™¨å’Œç‹¬å å¼åƒåœ¾å›æ”¶å™¨ã€‚<ul><li>å¹¶å‘å¼åƒåœ¾å›æ”¶å™¨ä¸åº”ç”¨ç¨‹åºçº¿ç¨‹äº¤æ›¿å·¥ä½œï¼Œä»¥å°½å¯èƒ½å‡å°‘åº”ç”¨ç¨‹åºçš„åœé¡¿æ—¶é—´ï¼›</li><li>ç‹¬å å¼åƒåœ¾å›æ”¶å™¨ (Stop the world) ä¸€æ—¦è¿è¡Œï¼Œå°±åœæ­¢åº”ç”¨ç¨‹åºä¸­çš„å…¶ä»–æ‰€æœ‰çº¿ç¨‹ï¼Œç›´åˆ°åƒåœ¾å›æ”¶è¿‡ç¨‹å®Œå…¨ç»“æŸã€‚</li></ul></li><li>æŒ‰ç¢ç‰‡å¤„ç†æ–¹å¼å¯åˆ†ä¸ºå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨å’Œéå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ã€‚<ul><li>å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ä¼šåœ¨å›æ”¶å®Œæˆåï¼Œå¯¹å­˜æ´»å¯¹è±¡è¿›è¡Œå‹ç¼©æ•´ç†ï¼Œæ¶ˆé™¤å›æ”¶åçš„ç¢ç‰‡ï¼›</li><li>éå‹ç¼©å¼çš„åƒåœ¾å›æ”¶å™¨ä¸è¿›è¡Œè¿™æ­¥æ“ä½œã€‚</li></ul></li><li>æŒ‰å·¥ä½œçš„å†…å­˜åŒºé—´ï¼Œåˆå¯åˆ†ä¸ºæ–°ç”Ÿä»£åƒåœ¾å›æ”¶å™¨å’Œè€å¹´ä»£åƒåœ¾å›æ”¶å™¨ã€‚</li></ol><h2 id="ç»„åˆ"><a href="#ç»„åˆ" class="headerlink" title="ç»„åˆ"></a>ç»„åˆ</h2><p>ç”±äºæ–°ç”Ÿä»£ä¸è€å¹´ä»£å„è‡ªå¯ä»¥ä½¿ç”¨ä¸åŒçš„åƒåœ¾æ”¶é›†å™¨ï¼Œå› æ­¤ä¸¤ä¸¤åœ¨æ­é…ä½¿ç”¨æ—¶ï¼Œä¼šæœ‰è®¸å¤šç§ä¸åŒçš„ç»„åˆã€‚</p><table><thead><tr><th>VMå‚æ•°</th><th>ç»„åˆç»“æœ</th></tr></thead><tbody><tr><td><strong>-XX:+UseSerialGC</strong></td><td>young <strong>Copy</strong> and old <strong>MarkSweepCompact</strong></td></tr><tr><td><strong>-XX:+UseG1GC</strong></td><td>young <strong>G1 Young</strong> and old <strong>G1 Mixed</strong></td></tr><tr><td><strong>-XX:+UseParallelGC -XX:+UseParallelOldGC -XX:+UseAdaptiveSizePolicy</strong></td><td>young <strong>PS Scavenge</strong> old <strong>PS MarkSweep</strong> ï¼ˆè‡ªé€‚åº”è°ƒæ•´ï¼‰</td></tr><tr><td><strong>-XX:+UseParallelGC -XX:+UseParallelOldGC -XX:-UseAdaptiveSizePolicy</strong></td><td>young <strong>PS Scavenge</strong> old <strong>PS MarkSweep</strong>, ï¼ˆéè‡ªé€‚åº”è°ƒæ•´ï¼‰</td></tr><tr><td><strong>-XX:+UseParNewGC (Java8ä¸­ç¦ç”¨ï¼ŒJava9å·²ç§»é™¤)</strong></td><td>young <strong>ParNew</strong> old <strong>MarkSweepCompact</strong></td></tr><tr><td><strong>-XX:+UseParNewGC -XX:+UseConcMarkSweepGC</strong></td><td>young <strong>ParNew</strong> old <strong>ConcurrentMarkSweep</strong></td></tr><tr><td><strong>-XX:-UseParNewGC -XX:+UseConcMarkSweepGC (Java8ä¸­ç¦ç”¨ï¼ŒJava9å·²ç§»é™¤)</strong></td><td>young <strong>Copy</strong> old <strong>ConcurrentMarkSweep</strong></td></tr></tbody></table><p>å…¶å®ï¼Œæˆ‘ä»¬åªéœ€è¦é‡ç‚¹å…³æ³¨ä»¥ä¸‹4ç§ç»„åˆï¼Œå…¶ä»–çš„åœ¨Java8ä¹‹åçš„ç‰ˆæœ¬ä¸­å·²æ¸æ¸è¢«æŠ›å¼ƒâ€¦â€¦</p><ul><li>å¹´è½»ä»£å’Œè€å¹´ä»£çš„ä¸²è¡ŒGC(Serial GC)</li><li>å¹´è½»ä»£å’Œè€å¹´ä»£çš„å¹¶è¡ŒGC(Parallel GC)</li><li>å¹´è½»ä»£çš„å¹¶è¡ŒGC(Parallel New) + è€å¹´ä»£çš„CMS(Concurrent Mark and Sweep)</li><li>G1è´Ÿè´£å›æ”¶å¹´è½»ä»£å’Œè€å¹´ä»£</li></ul><h2 id="Serial-Serial-Oldï¼ˆä¸²è¡ŒGCï¼‰"><a href="#Serial-Serial-Oldï¼ˆä¸²è¡ŒGCï¼‰" class="headerlink" title="Serial / Serial Oldï¼ˆä¸²è¡ŒGCï¼‰"></a>Serial / Serial Oldï¼ˆä¸²è¡ŒGCï¼‰</h2><p>Serial GC å¯¹å¹´è½»ä»£ä½¿ç”¨ <a href="https://wangwei.one/posts/396cfa32.html">markÂ­-copy(æ ‡è®°Â­å¤åˆ¶)</a> ç®—æ³•ï¼Œå¯¹è€å¹´ä»£ä½¿ç”¨ <a href="https://wangwei.one/posts/396cfa32.html">markÂ­-sweepÂ­-compact(æ ‡è®°Â­æ¸…é™¤Â­æ•´ç†)</a> ç®—æ³•ã€‚</p><p><img src="https://img.i7years.com/blog/Serial%20GC.png?2" alt="Serial GC"></p><h4 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><p>ä¸¤è€…éƒ½æ˜¯<strong>å•çº¿ç¨‹</strong>çš„åƒåœ¾æ”¶é›†å™¨ï¼Œä¸èƒ½è¿›è¡Œå¹¶è¡Œå¤„ç†ã€‚ä¸¤è€…éƒ½ä¼šè§¦å‘<strong>å…¨çº¿æš‚åœ(STW)</strong>ï¼Œåœæ­¢æ‰€æœ‰çš„åº”ç”¨çº¿ç¨‹ã€‚</p><p>å› æ­¤è¿™ç§GCç®—æ³•ä¸èƒ½å……åˆ†åˆ©ç”¨å¤šæ ¸CPUã€‚ä¸ç®¡æœ‰å¤šå°‘CPUå†…æ ¸ï¼ŒJVM åœ¨åƒåœ¾æ”¶é›†æ—¶éƒ½åªèƒ½ä½¿ç”¨å•ä¸ªæ ¸å¿ƒã€‚</p><h4 id="é€‚ç”¨åœºåˆ"><a href="#é€‚ç”¨åœºåˆ" class="headerlink" title="é€‚ç”¨åœºåˆ"></a>é€‚ç”¨åœºåˆ</h4><p>è¯¥é€‰é¡¹åªé€‚åˆå‡ ç™¾MBå †å†…å­˜çš„JVMï¼Œè€Œä¸”æ˜¯å•æ ¸CPUæ—¶æ¯”è¾ƒæœ‰ç”¨ã€‚ å¯¹äºæœåŠ¡å™¨ç«¯æ¥è¯´ï¼Œå› ä¸ºä¸€èˆ¬æ˜¯å¤šä¸ªCPUå†…æ ¸ï¼Œå¹¶ä¸æ¨èä½¿ç”¨ï¼Œé™¤éç¡®å®éœ€è¦é™åˆ¶JVMæ‰€ä½¿ç”¨çš„èµ„æºã€‚å¤§å¤šæ•°æœåŠ¡å™¨ç«¯åº”ç”¨éƒ¨ç½²åœ¨å¤šæ ¸å¹³å°ä¸Šï¼Œé€‰æ‹© Serial GC å°±è¡¨ç¤ºäººä¸ºçš„é™åˆ¶ç³»ç»Ÿèµ„æºçš„ä½¿ç”¨ã€‚ å¯¼è‡´çš„å°±æ˜¯èµ„æºé—²ç½®ï¼Œå¤šçš„CPUèµ„æºä¹Ÿä¸èƒ½ç”¨æ¥é™ä½å»¶è¿Ÿï¼Œä¹Ÿä¸èƒ½ç”¨æ¥å¢åŠ ååé‡ã€‚</p><p>Serialæ”¶é›†å™¨å¯¹äºè¿è¡Œåœ¨Clientæ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºæ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚</p><h4 id="æ§åˆ¶å‚æ•°"><a href="#æ§åˆ¶å‚æ•°" class="headerlink" title="æ§åˆ¶å‚æ•°"></a>æ§åˆ¶å‚æ•°</h4><ul><li><code>-XX:+UseSerialGC</code>ï¼šåœ¨æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä½¿ç”¨ä¸²è¡Œå›æ”¶å™¨ã€‚</li><li><code>-XX:+SurvivorRatio</code>ï¼šè®¾ç½® eden åŒºå¤§å°å’Œ survivor åŒºå¤§å°çš„æ¯”ä¾‹ã€‚</li><li><code>-XX:+PretenureSizeThreshold</code>ï¼šè®¾ç½®å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£çš„é˜ˆå€¼ã€‚å½“å¯¹è±¡çš„å¤§å°è¶…è¿‡è¿™ä¸ªå€¼æ—¶ï¼Œå°†ç›´æ¥åœ¨è€å¹´ä»£åˆ†é…ã€‚</li><li><code>-XX:MaxTenuringThreshold</code>ï¼šè®¾ç½®å¯¹è±¡è¿›å…¥è€å¹´ä»£çš„å¹´é¾„çš„æœ€å¤§å€¼ã€‚æ¯ä¸€æ¬¡ Minor GC åï¼Œå¯¹è±¡å¹´é¾„å°±åŠ  1ã€‚ä»»ä½•å¤§äºè¿™ä¸ªå¹´é¾„çš„å¯¹è±¡ï¼Œä¸€å®šä¼šè¿›å…¥è€å¹´ä»£ã€‚</li></ul><h4 id="GCæ—¥å¿—åˆ†æ"><a href="#GCæ—¥å¿—åˆ†æ" class="headerlink" title="GCæ—¥å¿—åˆ†æ"></a>GCæ—¥å¿—åˆ†æ</h4><h5 id="VMå‚æ•°"><a href="#VMå‚æ•°" class="headerlink" title="VMå‚æ•°"></a>VMå‚æ•°</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-client</span><br><span class="line">-XX:+PrintGCDetails</span><br><span class="line">-XX:+PrintGCTimeStamps</span><br><span class="line">-XX:+PrintGCDateStamps</span><br><span class="line">â€XX:+UseSerialGC</span><br></pre></td></tr></table></figure><h5 id="Minor-GC"><a href="#Minor-GC" class="headerlink" title="Minor GC"></a>Minor GC</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">15</span>T16:<span class="number">05</span>:<span class="number">03.173</span>-<span class="number">0800</span>: <span class="number">196.835</span>: [GC2016-<span class="number">06</span>-<span class="number">15</span>T16:<span class="number">05</span>:<span class="number">03.173</span>-<span class="number">0800</span>: <span class="number">196.836</span>: [DefNew: <span class="number">59007</span>K-&gt;<span class="number">435</span>K(<span class="number">59008</span>K), <span class="number">0.0103200</span> secs] <span class="number">114651</span>K-&gt;<span class="number">61875</span>K(<span class="number">124544</span>K), <span class="number">0.0118620</span> secs] [Times: user=<span class="number">0.01</span> sys=<span class="number">0.00</span>, real=<span class="number">0.01</span> secs]</span><br></pre></td></tr></table></figure><blockquote><p><code>2016-06-15T16:05:03.173-0800</code>ï¼šGCäº‹ä»¶å¼€å§‹çš„æ—¶é—´. å…¶ä¸­ â€0800 è¡¨ç¤ºä¸œ8æ—¶åŒºã€‚</p><p><code>196.835</code>ï¼šGCäº‹ä»¶å¼€å§‹æ—¶ï¼Œç›¸å¯¹äºJVMå¯åŠ¨æ—¶çš„é—´éš”æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ã€‚</p><p><code>GC</code> ï¼šç”¨æ¥åŒºåˆ† Minor GC è¿˜æ˜¯ Full GC çš„æ ‡å¿—ã€‚ GC è¡¨æ˜è¿™æ˜¯ä¸€æ¬¡ GC(Minor GC)</p><p><code>DefNew</code>ï¼šåƒåœ¾æ”¶é›†å™¨çš„åç§°ã€‚è¡¨ç¤ºçš„æ˜¯åœ¨å¹´è½»ä»£ä¸­ä½¿ç”¨çš„: å•çº¿ç¨‹ï¼Œæ ‡è®°Â­å¤åˆ¶(markÂ­-copy)ï¼Œå…¨çº¿æš‚åœ(STW) åƒåœ¾æ”¶é›†å™¨ã€‚</p><p><code>59007K-&gt;435K</code>ï¼šåœ¨åƒåœ¾æ”¶é›†ä¹‹å‰å’Œä¹‹åå¹´è½»ä»£çš„ä½¿ç”¨é‡ã€‚</p><p><code>(59008K)</code>ï¼šå¹´è½»ä»£æ€»ç©ºé—´å¤§å°</p><p><code>114651K-&gt;61875K</code>ï¼šåœ¨åƒåœ¾æ”¶é›†ä¹‹å‰å’Œä¹‹åæ•´ä¸ªå †å†…å­˜çš„ä½¿ç”¨æƒ…å†µã€‚</p><p><code>(124544K)</code>ï¼šå¯ç”¨å †çš„æ€»ç©ºé—´å¤§å°ã€‚</p><p><code>0.0118620 secs</code>ï¼šGCäº‹ä»¶æŒç»­çš„æ—¶é—´,ä»¥ç§’ä¸ºå•ä½ã€‚</p><p><code>[Times: user=0.01 sys=0.00, real=0.01 secs]</code>ï¼šGCäº‹ä»¶çš„æŒç»­æ—¶é—´, é€šè¿‡ä¸‰ä¸ªéƒ¨åˆ†æ¥è¡¡é‡:</p><ul><li>user â€“ åœ¨æ­¤æ¬¡åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­, æ‰€æœ‰GCçº¿ç¨‹æ‰€æ¶ˆè€—çš„CPUæ—¶é—´ä¹‹å’Œã€‚</li><li>sys â€“ GCè¿‡ç¨‹ä¸­æ“ä½œç³»ç»Ÿè°ƒç”¨å’Œç³»ç»Ÿç­‰å¾…äº‹ä»¶æ‰€æ¶ˆè€—çš„æ—¶é—´ã€‚</li><li>real â€“ åº”ç”¨ç¨‹åºæš‚åœçš„æ—¶é—´ã€‚å› ä¸ºä¸²è¡Œåƒåœ¾æ”¶é›†å™¨(Serial Garbage Collector)åªä½¿ç”¨å•çº¿ç¨‹, å› æ­¤ real time ç­‰ äº user å’Œ system æ—¶é—´çš„æ€»å’Œã€‚</li></ul></blockquote><p>ä»ä¸Šé¢çš„æ—¥å¿—æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ï¼š</p><ul><li>GCä¹‹å‰ï¼Œå †å†…å­˜ä½¿ç”¨æ€»é‡ä¸º<strong>114651K</strong>ï¼Œå¹´è½»ä»£ä½¿ç”¨æ€»é‡ä¸º<strong>59007K</strong>ï¼Œé‚£ä¹ˆè€å¹´ä»£ä½¿ç”¨é‡ä¸ºï¼š<strong>55644K</strong>ã€‚</li><li>GCä¹‹åï¼Œå †å†…å­˜å‡å°‘äº†<strong>52776K</strong>ï¼Œå¹´è½»ä»£å‡å°‘äº†<strong>58572K</strong>ï¼Œé‚£ä¹ˆè¡¨ç¤ºæœ‰ <strong>5796K</strong> çš„å¯¹è±¡æå‡åˆ°äº†è€å¹´ä»£ã€‚</li></ul><h5 id="Full-GC"><a href="#Full-GC" class="headerlink" title="Full GC"></a>Full GC</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">15</span>T16:<span class="number">10</span>:<span class="number">31.467</span>-<span class="number">0800</span>: <span class="number">525.130</span>: [Full GC2016-<span class="number">06</span>-<span class="number">15</span>T16:<span class="number">10</span>:<span class="number">31.467</span>-<span class="number">0800</span>: <span class="number">525.130</span>: [Tenured: <span class="number">65536</span>K-&gt;<span class="number">65535</span>K(<span class="number">65536</span>K), <span class="number">0.2080570</span> secs] <span class="number">124544</span>K-&gt;<span class="number">111862</span>K(<span class="number">124544</span>K), [Perm : <span class="number">31291</span>K-&gt;<span class="number">31291</span>K(<span class="number">131072</span>K)], <span class="number">0.2081880</span> secs] [Times: user=<span class="number">0.20</span> sys=<span class="number">0.00</span>, real=<span class="number">0.21</span> secs]</span><br></pre></td></tr></table></figure><blockquote><p><code>Full GC</code>ï¼šè¡¨ç¤ºè¿™ä¸€æ¬¡æ˜¯å¯¹æ•´ä¸ªå †ç©ºé—´è¿›è¡Œæ¸…ç†ã€‚</p><p><code>[Tenured: 65536K-&gt;65535K(65536K), 0.2080570 secs]</code>ï¼šè€å¹´ä»£GCå‰ä¸ºä½¿ç”¨é‡ä¸º65536Kï¼ŒGCåä½¿ç”¨é‡ä¸º65535Kï¼Œæ€»ç©ºé—´ä¸º65536Kï¼Œä½¿ç”¨0.2080570ç§’ï¼›</p><p><code>124544K-&gt;111862K(124544K)</code>ï¼šGCå‰åæ•´ä¸ªå †å†…å­˜ä½¿ç”¨é‡ä» 124544K å‡å°‘ä¸º 111862Kï¼Œæ€»ç©ºé—´ä¸º124544K</p><p><code>[Perm : 31291K-&gt;31291K(131072K)], 0.2081880 secs]</code>ï¼šæŒä¹…åŒºGCå‰åä½¿ç”¨å†…å­˜ç©ºé—´éƒ½ä¸º31291Kï¼Œæ²¡æœ‰å˜åŒ–ã€‚</p></blockquote><h2 id="Parallel-Scavenge-Parallel-Old-GCï¼ˆå¹¶è¡ŒGCï¼‰"><a href="#Parallel-Scavenge-Parallel-Old-GCï¼ˆå¹¶è¡ŒGCï¼‰" class="headerlink" title="Parallel Scavenge / Parallel Old GCï¼ˆå¹¶è¡ŒGCï¼‰"></a>Parallel Scavenge / Parallel Old GCï¼ˆå¹¶è¡ŒGCï¼‰</h2><p>Parallel GC å¯¹å¹´è½»ä»£ä½¿ç”¨ <a href="https://wangwei.one/posts/396cfa32.html">markÂ­-copy(æ ‡è®°Â­å¤åˆ¶)</a> ç®—æ³•ï¼Œå¯¹è€å¹´ä»£ä½¿ç”¨ <a href="https://wangwei.one/posts/396cfa32.html">markÂ­-sweepÂ­-compact(æ ‡è®°Â­æ¸…é™¤Â­æ•´ç†)</a> ç®—æ³•ã€‚</p><p><img src="https://img.i7years.com/blog/Parallel%20GC.png?1" alt="Parallel GC"></p><h4 id="ç‰¹ç‚¹-1"><a href="#ç‰¹ç‚¹-1" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><p>ä¸¤è€…éƒ½æ˜¯<strong>å¤šçº¿ç¨‹</strong>çš„åƒåœ¾æ”¶é›†å™¨ï¼Œä¸¤è€…éƒ½ä¼šè§¦å‘<strong>å…¨çº¿æš‚åœ(STW)</strong>ï¼Œåœæ­¢æ‰€æœ‰çš„åº”ç”¨çº¿ç¨‹ã€‚ç”±äºæ˜¯å¤šçº¿ç¨‹ï¼Œæ‰€ä»¥ç›¸æ¯”äºSerial GCï¼Œåƒåœ¾æ”¶é›†æ—¶é—´å°†å¤§å¤§å‡å°‘ã€‚</p><p>Parallel Scavengeæ”¶é›†å™¨çš„ç›®æ ‡åˆ™æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡ï¼ˆThroughputï¼‰ã€‚</p><blockquote><p>æ‰€è°“ååé‡å°±æ˜¯CPUç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´ä¸CPUæ€»æ¶ˆè€—æ—¶é—´çš„æ¯”å€¼ï¼Œå³ååé‡=è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´/ï¼ˆè¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´+åƒåœ¾æ”¶é›†æ—¶é—´ï¼‰ï¼Œè™šæ‹Ÿæœºæ€»å…±è¿è¡Œäº†100åˆ†é’Ÿï¼Œå…¶ä¸­åƒåœ¾æ”¶é›†èŠ±æ‰1åˆ†é’Ÿï¼Œé‚£ååé‡å°±æ˜¯99%ã€‚</p></blockquote><h4 id="é€‚ç”¨åœºåˆ-1"><a href="#é€‚ç”¨åœºåˆ-1" class="headerlink" title="é€‚ç”¨åœºåˆ"></a>é€‚ç”¨åœºåˆ</h4><p>å¹¶è¡Œåƒåœ¾æ”¶é›†å™¨é€‚ç”¨äºå¤šæ ¸æœåŠ¡å™¨ï¼Œä¸»è¦ç›®æ ‡æ˜¯å¢åŠ ååé‡ã€‚å› ä¸ºå¯¹ç³»ç»Ÿèµ„æºçš„æœ‰æ•ˆä½¿ç”¨,èƒ½è¾¾åˆ°æ›´é«˜çš„ååé‡:</p><ul><li>åœ¨GCæœŸé—´ï¼Œæ‰€æœ‰ CPU å†…æ ¸éƒ½åœ¨å¹¶è¡Œæ¸…ç†åƒåœ¾ï¼Œæ‰€ä»¥æš‚åœæ—¶é—´æ›´çŸ­</li><li>åœ¨ä¸¤æ¬¡GCå‘¨æœŸçš„é—´éš”æœŸï¼Œæ²¡æœ‰GCçº¿ç¨‹åœ¨è¿è¡Œï¼Œä¸ä¼šæ¶ˆè€—ä»»ä½•ç³»ç»Ÿèµ„æº</li></ul><p>å¦ä¸€æ–¹é¢ï¼Œå› ä¸ºæ­¤GCçš„æ‰€æœ‰é˜¶æ®µéƒ½ä¸èƒ½ä¸­æ–­ï¼Œæ‰€ä»¥å¹¶è¡ŒGCå¾ˆå®¹æ˜“å‡ºç°é•¿æ—¶é—´çš„å¡é¡¿ã€‚å¦‚æœå»¶è¿Ÿæ˜¯ç³»ç»Ÿçš„ä¸»è¦ç›®æ ‡ï¼Œé‚£ä¹ˆå°±åº”è¯¥é€‰æ‹©å…¶ä»–åƒåœ¾æ”¶é›†å™¨ç»„åˆã€‚</p><blockquote><p>é•¿æ—¶é—´å¡é¡¿çš„æ„æ€æ˜¯ï¼Œæ­¤GCå¯åŠ¨ä¹‹åï¼Œå±äºä¸€æ¬¡æ€§å®Œæˆæ‰€æœ‰æ“ä½œï¼Œäºæ˜¯å•æ¬¡ pause çš„æ—¶é—´ä¼šè¾ƒé•¿ã€‚</p></blockquote><h4 id="æ§åˆ¶å‚æ•°-1"><a href="#æ§åˆ¶å‚æ•°-1" class="headerlink" title="æ§åˆ¶å‚æ•°"></a>æ§åˆ¶å‚æ•°</h4><ul><li><p><code>â€XX:ParallelGCThreads</code>ï¼šæŒ‡å®šGCçº¿ç¨‹æ•°ï¼Œé»˜è®¤å€¼ä¸ºCPUå†…æ ¸æ•°ã€‚</p></li><li><p><code>-XX:MaxGCPauseMillis</code>ï¼šæœ€å¤§åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´ã€‚ä¸èƒ½è®¾ç½®è¿‡å°ï¼Œå¦åˆ™ä¼šé™ä½ç³»ç»Ÿååé‡ã€‚</p></li><li><code>-XX:GCTimeRatio</code>ï¼šè®¾ç½®ååé‡å¤§å°ã€‚æ˜¯ä¸€ä¸ªå¤§äº0ä¸”å°äº100çš„æ•´æ•°ã€‚å‡å¦‚è®¾ç½®ä¸º99ï¼Œåˆ™åƒåœ¾æ”¶é›†æ—¶é—´çš„æ¯”ç‡ä¸ºï¼š1 / (1 + 99)ã€‚</li><li><code>-XX:+UseAdaptiveSizePolicy</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå¼€å…³å‚æ•°ï¼Œå½“è¿™ä¸ªå‚æ•°æ‰“å¼€ä¹‹åï¼Œå°±ä¸éœ€è¦æ‰‹å·¥æŒ‡å®šæ–°ç”Ÿä»£çš„å¤§å°(-Xmn)ã€Edenä¸SurvivoråŒºçš„æ¯”ä¾‹(-XX:SurvivorRati)ã€æ™‹å‡è€å¹´ä»£å¯¹è±¡å¹´é¾„(-XX:PretenureSizeThreshold)ç­‰ç»†èŠ‚å‚æ•°äº†ï¼Œè™šæ‹Ÿæœºä¼šæ ¹æ®å½“å‰ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µæ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼ŒåŠ¨æ€è°ƒæ•´è¿™äº›å‚æ•°ä»¥æä¾›æœ€åˆé€‚çš„åœé¡¿æ—¶é—´æˆ–è€…æœ€å¤§çš„ååé‡ï¼Œè¿™ç§è°ƒèŠ‚æ–¹å¼ç§°ä¸ºGCè‡ªé€‚åº”çš„è°ƒèŠ‚ç­–ç•¥ï¼ˆ <a href="https://docs.oracle.com/javase/7/docs/technotes/guides/vm/gc-ergonomics.html" target="_blank" rel="noopener">GC Ergonomics</a> ï¼‰ã€‚</li></ul><h4 id="GC-æ—¥å¿—åˆ†æ"><a href="#GC-æ—¥å¿—åˆ†æ" class="headerlink" title="GC æ—¥å¿—åˆ†æ"></a>GC æ—¥å¿—åˆ†æ</h4><h5 id="VMå‚æ•°-1"><a href="#VMå‚æ•°-1" class="headerlink" title="VMå‚æ•°"></a>VMå‚æ•°</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-server</span><br><span class="line">-XX:+PrintGCDetails</span><br><span class="line">-XX:+PrintGCTimeStamps</span><br><span class="line">-XX:+PrintGCDateStamps</span><br><span class="line">-XX:+UseParallelGC -XX:+UseParallelOldGC</span><br></pre></td></tr></table></figure><blockquote><p>å…¶ä¸­ <code>-XX:+UseParallelGC -XX:+UseParallelOldGC</code> ä¸ä½¿ç”¨ <code>-XX:+UseParallelGC</code> æˆ– <code>-XX:+UseParallelOldGC</code> ç­‰ä»·ã€‚</p></blockquote><h5 id="Minor-GC-1"><a href="#Minor-GC-1" class="headerlink" title="Minor GC"></a>Minor GC</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">15</span>T21:<span class="number">41</span>:<span class="number">01.947</span>-<span class="number">0800</span>: <span class="number">11.726</span>: [GC [PSYoungGen: <span class="number">51636</span>K-&gt;<span class="number">8281</span>K(<span class="number">54784</span>K)] <span class="number">112923</span>K-&gt;<span class="number">72238</span>K(<span class="number">120320</span>K), <span class="number">0.0062430</span> secs] [Times: user=<span class="number">0.01</span> sys=<span class="number">0.00</span>, real=<span class="number">0.01</span> secs]</span><br></pre></td></tr></table></figure><blockquote><p><code>GC</code>ï¼šå°å‹GCã€‚</p><p><code>PSYoungGen</code>ï¼šæ”¶é›†å™¨åç§°ï¼Œè¡¨ç¤ºå¹´è½»ä»£ä½¿ç”¨çš„æ˜¯ Parallel Scavenge æ”¶é›†å™¨ã€‚</p><p><code>51636K-&gt;8281K(54784K)</code>ï¼šå¹´è½»ä»£ä» 51636K å‡å°‘åˆ°äº† 8281Kï¼Œå¹´è½»ä»£ç©ºé—´æ€»é‡ä¸ºï¼š54784Kã€‚</p><p><code>112923K-&gt; 72238K(120320K)</code>ï¼šæ•´ä¸ªå †ç©ºé—´ä» 112923K å‡å°‘åˆ°äº† 72238Kï¼Œå †ç©ºé—´æ€»é‡ä¸ºï¼š120320Kã€‚</p></blockquote><p>å¹´è½»ä»£å‡å°‘äº† <strong>43355K</strong>ï¼Œå †ç©ºé—´å‡å°‘äº†<strong>40685K</strong>ï¼Œè¡¨æ˜æœ‰ <strong>2670K</strong> çš„å¯¹è±¡ä»å¹´è½»ä»£æå‡åˆ°äº†è€å¹´ä»£ã€‚</p><h5 id="Full-GC-1"><a href="#Full-GC-1" class="headerlink" title="Full GC"></a>Full GC</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">15</span>T21:<span class="number">41</span>:<span class="number">01.953</span>-<span class="number">0800</span>: <span class="number">11.732</span>: [Full GC [PSYoungGen: <span class="number">8281</span>K-&gt;<span class="number">0</span>K(<span class="number">54784</span>K)] [ParOldGen: <span class="number">63956</span>K-&gt;<span class="number">59231</span>K(<span class="number">65536</span>K)] <span class="number">72238</span>K-&gt;<span class="number">59231</span>K(<span class="number">120320</span>K) [PSPermGen: <span class="number">14462</span>K-&gt;<span class="number">14462</span>K(<span class="number">131072</span>K)], <span class="number">0.1389900</span> secs] [Times: user=<span class="number">0.44</span> sys=<span class="number">0.01</span>, real=<span class="number">0.14</span> secs]</span><br></pre></td></tr></table></figure><blockquote><p><code>Full GC</code>ï¼Œè¡¨æ˜è¿™æ¬¡æ¸…ç†äº†å¹´è½»ä»£å’Œè€å¹´ä»£ã€‚</p><p><code>PSYoungGen: 8281K-&gt;0K(54784K)</code>ï¼šå¹´è½»ä»£åƒåœ¾æ”¶é›†å™¨ä¸ºParallel Scavengeï¼Œä½¿ç”¨é‡ä»8281Kå˜ä¸ºäº†0Kã€‚å¹´è½»ä»£ç©ºé—´æ€»é‡ä¸º54784Kã€‚</p><p><code>ParOldGen: 63956K-&gt;59231K(65536K)</code>ï¼šè€å¹´ä»£æ”¶é›†å™¨ä¸ºParallel Oldï¼Œä½¿ç”¨é‡ä»63956Kå˜ä¸ºäº†59231Kã€‚è€å¹´ä»£ç©ºé—´æ€»é‡ä¸ºï¼š65536Kã€‚</p><p><code>72238K-&gt;59231K(120320K)</code>ï¼šæ•´ä¸ªå †ç©ºé—´ä»72238Kå˜ä¸ºäº†59231Kã€‚å †ç©ºé—´æ€»é‡ä¸ºï¼š120320Kã€‚</p><p><code>PSPermGen: 14462K-&gt;14462K(131072K)</code>ï¼šæŒä¹…å»å‰åéƒ½ä¸º14462Kï¼Œæ²¡æœ‰å˜åŒ–ã€‚æŒä¹…å»ç©ºé—´æ€»é‡ä¸ºï¼š131072Kã€‚</p></blockquote><h2 id="ParNewæ”¶é›†å™¨"><a href="#ParNewæ”¶é›†å™¨" class="headerlink" title="ParNewæ”¶é›†å™¨"></a>ParNewæ”¶é›†å™¨</h2><p>ParNewæ”¶é›†å™¨æœ¬è´¨ä¸Šå°±æ˜¯ Serial æ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œå…¶ä½™è¡Œä¸ºåŒ…æ‹¬æ§åˆ¶å‚æ•°ï¼ˆä¾‹å¦‚ï¼š-XXï¼šSurvivorRatioã€-XXï¼šPretenureSizeThresholdã€-XXï¼šHandlePromotionFailureç­‰ï¼‰ã€æ”¶é›†ç®—æ³•ã€Stop The Worldã€å¯¹è±¡åˆ†é…è§„åˆ™ã€å›æ”¶ç­–ç•¥ç­‰éƒ½ä¸Serialæ”¶é›†å™¨å®Œå…¨ä¸€æ ·ã€‚</p><p><img src="https://img.i7years.com/blog/ParNew%20GC.png?1" alt="ParNew"></p><h4 id="æ§åˆ¶å‚æ•°-2"><a href="#æ§åˆ¶å‚æ•°-2" class="headerlink" title="æ§åˆ¶å‚æ•°"></a>æ§åˆ¶å‚æ•°</h4><ul><li><code>â€XX:ParallelGCThreads</code>ï¼šæŒ‡å®šGCçº¿ç¨‹æ•°ï¼Œé»˜è®¤å€¼ä¸ºCPUå†…æ ¸æ•°ã€‚</li></ul><h4 id="GC-æ—¥å¿—åˆ†æ-1"><a href="#GC-æ—¥å¿—åˆ†æ-1" class="headerlink" title="GC æ—¥å¿—åˆ†æ"></a>GC æ—¥å¿—åˆ†æ</h4><h5 id="VM-å‚æ•°"><a href="#VM-å‚æ•°" class="headerlink" title="VM å‚æ•°"></a>VM å‚æ•°</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-server</span><br><span class="line">-XX:+PrintGCDetails</span><br><span class="line">-XX:+PrintGCTimeStamps</span><br><span class="line">-XX:+PrintGCDateStamps</span><br><span class="line">-XX:+UseParNewGC</span><br></pre></td></tr></table></figure><h5 id="Minor-GC-2"><a href="#Minor-GC-2" class="headerlink" title="Minor GC"></a>Minor GC</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">16</span>T10:<span class="number">52</span>:<span class="number">24.846</span>-<span class="number">0800</span>: <span class="number">1.690</span>: [GC2018-<span class="number">08</span>-<span class="number">21</span>T10:<span class="number">52</span>:<span class="number">24.846</span>-<span class="number">0800</span>: <span class="number">1.690</span>: [ParNew: <span class="number">52480</span>K-&gt;<span class="number">6527</span>K(<span class="number">59008</span>K), <span class="number">0.0143120</span> secs] <span class="number">52480</span>K-&gt;<span class="number">6683</span>K(<span class="number">124544</span>K), <span class="number">0.0144440</span> secs] [Times: user=<span class="number">0.03</span> sys=<span class="number">0.00</span>, real=<span class="number">0.02</span> secs]</span><br></pre></td></tr></table></figure><blockquote><p><code>ParNew</code>ï¼šè¡¨æ˜å¹´è½»ä»£ä½¿ç”¨çš„æ˜¯ ParNew æ”¶é›†å™¨</p><p>å…¶ä»–æ•°æ®åˆ†æï¼Œä¸å‰é¢çš„æ—¥å¿—åˆ†æä¸€æ ·</p></blockquote><h5 id="Full-GC-2"><a href="#Full-GC-2" class="headerlink" title="Full GC"></a>Full GC</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016</span>-<span class="number">06</span>-<span class="number">16</span>T10:<span class="number">52</span>:<span class="number">34.709</span>-<span class="number">0800</span>: <span class="number">11.552</span>: [Full GC2018-<span class="number">08</span>-<span class="number">21</span>T10:<span class="number">52</span>:<span class="number">34.709</span>-<span class="number">0800</span>: <span class="number">11.552</span>: [Tenured: <span class="number">65533</span>K-&gt;<span class="number">65535</span>K(<span class="number">65536</span>K), <span class="number">0.1024680</span> secs] <span class="number">124534</span>K-&gt;<span class="number">70147</span>K(<span class="number">124544</span>K), [Perm : <span class="number">14425</span>K-&gt;<span class="number">14425</span>K(<span class="number">21248</span>K)], <span class="number">0.1025780</span> secs] [Times: user=<span class="number">0.10</span> sys=<span class="number">0.00</span>, real=<span class="number">0.11</span> secs]</span><br></pre></td></tr></table></figure><blockquote><p>æ•°æ®åˆ†æä¸å‰é¢çš„ä¸€æ ·</p></blockquote><h4 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h4><p>è¯¥ç§ <code>-XX:+UseParNewGC</code> é…ç½®ï¼Œåœ¨Java8ä¸­å·²ä¸æ¨èä½¿ç”¨ï¼ŒJava9ä¸­å·²ç»å®Œå…¨åˆ é™¤äº†ã€‚åœ¨æ­¤åçš„ç‰ˆæœ¬ä¸­ï¼Œåªèƒ½ä¸ CMS æ”¶é›†å™¨æ­é…ä½¿ç”¨ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬ç¯‡æ–‡ç« æˆ‘ä»¬è®²äº† Serialã€Parallelã€ParNew çš„ä½¿ç”¨ä¸é…ç½®ï¼Œä¸‹ç¯‡æ–‡ç« æˆ‘ä»¬å°†é‡ç‚¹ä»‹ç» <a href="https://wangwei.one/posts/6489a27.html">CMS</a> ä¸ G1 æ”¶é›†å™¨çš„ä½¿ç”¨ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://book.douban.com/subject/24722612/" target="_blank" rel="noopener">ã€ŠJVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ[ç¬¬2ç‰ˆ]ã€‹ç¬¬3ç« èŠ‚ã€Œåƒåœ¾æ”¶é›†å™¨ä¸å†…å­˜åˆ†é…ç­–ç•¥ã€</a></li><li><a href="https://www.ibm.com/developerworks/cn/java/j-lo-JVMGarbageCollection/index.html" target="_blank" rel="noopener">https://www.ibm.com/developerworks/cn/java/j-lo-JVMGarbageCollection/index.html</a></li><li><a href="http://www.fasterj.com/articles/oraclecollectors1.shtml" target="_blank" rel="noopener">http://www.fasterj.com/articles/oraclecollectors1.shtml</a></li><li><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/index.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/index.html</a></li><li><a href="http://java-latte.blogspot.com/2013/08/garbage-collection-in-java.html" target="_blank" rel="noopener">http://java-latte.blogspot.com/2013/08/garbage-collection-in-java.html</a></li><li><a href="http://www.cnblogs.com/iceAeterNa/p/4877549.html" target="_blank" rel="noopener">http://www.cnblogs.com/iceAeterNa/p/4877549.html</a></li><li><a href="https://www.cnblogs.com/iceAeterNa/p/4877741.html" target="_blank" rel="noopener">https://www.cnblogs.com/iceAeterNa/p/4877741.html</a></li><li><a href="https://github.com/cncounter/gc-handbook" target="_blank" rel="noopener">https://github.com/cncounter/gc-handbook</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> GC </tag>
            
            <tag> JVM </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[GCç®—æ³•ä»‹ç»]]></title>
      <url>/posts/jvm-gc-arithmetic-intro.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/pexels-photo-1686293.jpeg?imageslim" alt="pexels-photo-1686293"></p><p>å‰é¢æˆ‘ä»¬äº†è§£äº† <a href="https://wangwei.one/posts/71c1df10.html">Java7</a> ä¸ <a href="https://wangwei.one/posts/fcc298ef.html">Java8</a> çš„å†…å­˜æ¨¡å‹ï¼Œæ¥ä¸‹é‡Œæˆ‘ä»¬è¦å­¦ä¹ JVMæ˜¯å¦‚ä½•å›æ”¶å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜çš„ï¼Œæœ¬æ–‡å…ˆä¸ºä½ ä»‹ç»ä¸‰ç§å¸¸ç”¨çš„GCç®—æ³•ã€‚</p><a id="more"></a><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>å¸¸ç”¨çš„GCç®—æ³•ä¸»è¦æœ‰ä¸‰ç§ï¼š<code>æ ‡è®°-æ¸…é™¤ç®—æ³•</code>ã€<code>æ ‡è®°-æ•´ç†ç®—æ³•</code>ã€<code>å¤åˆ¶ç®—æ³•</code>ã€‚è¿˜æœ‰ä¸€ç§<code>åˆ†ä»£æ”¶é›†ç®—æ³•</code>ï¼Œè¿™ç§ç®—æ³•æ— éå°±æ˜¯å¯¹å†…å­˜çš„ä¸åŒåŒºåŸŸä½¿ç”¨å‰é¢ä¸‰ç§ä¸åŒçš„ç®—æ³•ã€‚</p><p>è¿™ä¸‰ç§GCç®—æ³•æ€»ä½“è€Œè¨€ï¼Œéƒ½ä¸“æ³¨äºå¹²ä¸¤ä»¶äº‹æƒ…ï¼š</p><ul><li>æ ‡è®°æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡ã€‚åœ¨åƒåœ¾æ”¶é›†ä¸­æœ‰ä¸€ä¸ªå«åš <strong>æ ‡è®°(Marking)</strong> çš„è¿‡ç¨‹ä¸“é—¨å¹²è¿™ä»¶äº‹ã€‚</li><li>æ¸…é™¤æ‰€æœ‰æ­»å¯¹è±¡ã€‚è¿™ä¸‰ç§ç®—æ³•çš„åŒºåˆ«å°±åœ¨äºæ¸…ç†æ­»å¯¹è±¡çš„å®ç°æ–¹å¼ä¸Šã€‚</li></ul><h2 id="æ ‡è®°å¯è¾¾å¯¹è±¡-Marking-Reachable-Objects"><a href="#æ ‡è®°å¯è¾¾å¯¹è±¡-Marking-Reachable-Objects" class="headerlink" title="æ ‡è®°å¯è¾¾å¯¹è±¡(Marking Reachable Objects)"></a>æ ‡è®°å¯è¾¾å¯¹è±¡(Marking Reachable Objects)</h2><p>ç°ä»£JVMä¸­æ‰€æœ‰çš„GCç®—æ³•ï¼Œç¬¬ä¸€æ­¥éƒ½æ˜¯æ‰¾å‡ºæ‰€æœ‰å­˜æ´»çš„å¯¹è±¡ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://img.i7years.com/blog/03_01_Java-GC-mark-and-sweep.png" alt="Java-GC-mark-and-sweep"></p><h4 id="GC-Roots"><a href="#GC-Roots" class="headerlink" title="GC Roots"></a>GC Roots</h4><p><a href="https://wangwei.one/posts/95492bf7.html">å‰é¢</a> è®²äº† GCä¸­ <strong>æ ¹(GC Roots)</strong> çš„æ¦‚å¿µï¼š</p><blockquote><p>æŒ‡çš„æ˜¯æŒ‡å‘å¯¹è±¡æŒ‡é’ˆçš„â€èµ·ç‚¹â€ã€‚</p></blockquote><p>å¯ä½œä¸ºGC Rootsçš„èŠ‚ç‚¹ä¸»è¦åœ¨å…¨å±€æ€§çš„å¼•ç”¨ï¼ˆä¾‹å¦‚å¸¸é‡æˆ–ç±»é™æ€å±æ€§ï¼‰ä¸æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆä¾‹å¦‚æ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­ï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p><ul><li>å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•é‡Œçš„å±€éƒ¨å˜é‡å’Œè¾“å…¥å‚æ•°</li><li>æ´»åŠ¨çº¿ç¨‹(Active threads)</li><li>å†…å­˜ä¸­æ‰€æœ‰ç±»çš„é™æ€å­—æ®µ(static field)</li><li>JNIå¼•ç”¨</li></ul><p>GCéå†(traverses)å†…å­˜ä¸­æ•´ä½“çš„å¯¹è±¡å…³ç³»å›¾(object graph)ï¼Œä»GCæ ¹å…ƒç´ å¼€å§‹æ‰«æï¼Œåˆ°ç›´æ¥å¼•ç”¨ä»¥åŠé—´æ¥å¼•ç”¨(é€šè¿‡å¯¹è±¡çš„ <a href="https://wangwei.one/posts/95492bf7.html">å±æ€§åŸŸ</a> )ã€‚æ‰€æœ‰GCè®¿é—®åˆ°çš„å¯¹è±¡éƒ½è¢« (marked)ä¸º <a href="https://wangwei.one/posts/95492bf7.html">å­˜æ´»å¯¹è±¡</a> ï¼ˆä¸Šå›¾ä¸­çš„è“è‰²æ ‡è®°ï¼‰ã€‚è€Œä»GCæ ¹æ— æ³•ç›´æ¥æˆ–é—´æ¥è®¿é—®åˆ°çš„å¯¹è±¡ç§°ä¸º <a href="https://wangwei.one/posts/95492bf7.html">ä¸å¯è¾¾çš„å¯¹è±¡</a> (unreachable object) (ä¸Šå›¾ä¸­çš„ç°è‰²æ ‡è®°)ï¼ŒGCä¼šåœ¨æ¥ä¸‹æ¥çš„é˜¶æ®µä¸­æ¸…é™¤æ‰è¿™äº›ä¸å¯è¾¾çš„å¯¹è±¡ã€‚</p><p>åœ¨æ ‡è®°é˜¶æ®µï¼Œéœ€è¦æ³¨æ„å‡ ç‚¹ï¼š</p><h4 id="Stop-The-World-STW"><a href="#Stop-The-World-STW" class="headerlink" title="Stop The World(STW)"></a>Stop The World(STW)</h4><p>åœ¨æ ‡è®°é˜¶æ®µï¼Œéœ€è¦æš‚åœæ‰€æœ‰åº”ç”¨çº¿ç¨‹ï¼Œä»¥éå†æ‰€æœ‰å¯¹è±¡çš„å¼•ç”¨å…³ç³»ã€‚å› ä¸ºè¿™é¡¹åˆ†æå·¥ä½œå¿…é¡»åœ¨ä¸€ä¸ªèƒ½ç¡®ä¿ä¸€è‡´æ€§çš„å¿«ç…§ä¸­è¿›è¡Œâ€”â€”è¿™é‡Œâ€œä¸€è‡´æ€§â€çš„æ„æ€æ˜¯æŒ‡åœ¨æ•´ä¸ªåˆ†ææœŸé—´æ•´ä¸ªæ‰§è¡Œç³»ç»Ÿçœ‹èµ·æ¥å°±åƒè¢«å†»ç»“åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œä¸å¯ä»¥å‡ºç°åˆ†æè¿‡ç¨‹ä¸­å¯¹è±¡å¼•ç”¨å…³ç³»è¿˜åœ¨ä¸æ–­å˜åŒ–çš„æƒ…å†µï¼Œè¯¥ç‚¹ä¸æ»¡è¶³çš„è¯åˆ†æç»“æœå‡†ç¡®æ€§å°±æ— æ³•å¾—åˆ°ä¿è¯ã€‚è¿™ç§æƒ…æ™¯å«åš <strong>Stop The World pause</strong> (å…¨çº¿åœé¡¿)ã€‚</p><p>æš‚åœçš„æ—¶é—´ï¼Œä¸å †å†…å­˜çš„å¤§å°ï¼Œå¯¹è±¡çš„æ€»æ•°æ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œè€Œæ˜¯æœ‰å­˜æ´»å¯¹è±¡ï¼ˆalive objectsï¼‰çš„æ•°é‡æ¥å†³å®šã€‚æ‰€ä»¥ï¼Œå¢åŠ å †å†…å­˜çš„å¤§å°å¹¶ä¸ä¼šç›´æ¥å½±å“æ ‡è®°é˜¶æ®µå ç”¨çš„æ—¶é—´ã€‚</p><h4 id="OopMap"><a href="#OopMap" class="headerlink" title="OopMap"></a>OopMap</h4><p>ç›®å‰çš„ä¸»æµJavaè™šæ‹Ÿæœºä½¿ç”¨çš„éƒ½æ˜¯å‡†ç¡®å¼GCï¼ˆExact VMï¼‰ï¼Œæ‰€ä»¥å½“æ‰§è¡Œç³»ç»Ÿåœé¡¿ä¸‹æ¥åï¼Œå¹¶ä¸éœ€è¦ä¸€ä¸ªä¸æ¼åœ°æ£€æŸ¥å®Œæ‰€æœ‰æ‰§è¡Œä¸Šä¸‹æ–‡å’Œå…¨å±€çš„å¼•ç”¨ä½ç½®ï¼Œè™šæ‹Ÿæœºåº”å½“æ˜¯æœ‰åŠæ³•ç›´æ¥å¾—çŸ¥å“ªäº›åœ°æ–¹å­˜æ”¾ç€å¯¹è±¡å¼•ç”¨ã€‚åœ¨HotSpotçš„å®ç°ä¸­ï¼Œæ˜¯ä½¿ç”¨ä¸€ç»„ç§°ä¸º<strong>OopMap</strong>çš„æ•°æ®ç»“æ„æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„çš„ï¼Œåœ¨ç±»åŠ è½½å®Œæˆçš„æ—¶å€™ï¼ŒHotSpotå°±æŠŠå¯¹è±¡å†…ä»€ä¹ˆåç§»é‡ä¸Šæ˜¯ä»€ä¹ˆç±»å‹çš„æ•°æ®è®¡ç®—å‡ºæ¥ï¼Œåœ¨JITç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šåœ¨ç‰¹å®šçš„ä½ç½®è®°å½•ä¸‹æ ˆå’Œå¯„å­˜å™¨ä¸­å“ªäº›ä½ç½®æ˜¯å¼•ç”¨ã€‚è¿™æ ·ï¼ŒGCåœ¨æ‰«ææ—¶å°±å¯ä»¥ç›´æ¥å¾—çŸ¥è¿™äº›ä¿¡æ¯äº†ã€‚</p><blockquote><p>OopMap æ˜¯ä¸€ç§ç”¨äºè®°å½•ä½äºJavaæ ˆä¸Šçš„å¯¹è±¡å¼•ç”¨çš„æ•°æ®ç»“æ„ã€‚ å…¶ä¸»è¦ç›®çš„æ˜¯æŸ¥æ‰¾ä½äºJavaæ ˆä¸Šçš„ GC Rootsï¼Œå½“Heapä¸­å¯¹è±¡ç§»åŠ¨æ—¶ï¼Œä¼šå»æ›´æ–°å¯¹åº”çš„å¯¹è±¡å¼•ç”¨ä¿¡æ¯ã€‚</p><p><a href="https://github.com/openjdk-mirror/jdk7u-hotspot/blob/master/src/share/vm/compiler/oopMap.cpp" target="_blank" rel="noopener">oopMap.cpp</a> ã€ <a href="https://github.com/openjdk-mirror/jdk7u-hotspot/blob/master/src/share/vm/oops/generateOopMap.cpp" target="_blank" rel="noopener">generateOopMap.cpp</a> ã€ <a href="https://github.com/openjdk-mirror/jdk7u-hotspot/blob/master/src/share/vm/interpreter/oopMapCache.cpp" target="_blank" rel="noopener">oopMapCache.hpp</a></p></blockquote><h4 id="Safe-Point"><a href="#Safe-Point" class="headerlink" title="Safe Point"></a>Safe Point</h4><p>ç¨‹åºå¹¶éåœ¨æ‰€æœ‰çš„åœ°æ–¹éƒ½èƒ½åœé¡¿ä¸‹æ¥å¼€å§‹GCï¼Œåªæœ‰è¾¾åˆ°<strong>å®‰å…¨ç‚¹</strong>(Safe Point)æ‰èƒ½æš‚å®šã€‚å¦‚ä½•åœ¨GCå‘ç”Ÿæ—¶ï¼Œè®©æ‰€æœ‰çº¿ç¨‹éƒ½â€è·‘â€åˆ°å®‰å…¨ç‚¹ä¸Šå†åœé¡¿ä¸‹æ¥ï¼Œè¿™é‡Œæœ‰ä¸¤ç§æ–¹æ¡ˆï¼š</p><h5 id="æŠ¢å…ˆå¼ä¸­æ–­ï¼ˆPreemptive-Suspensionï¼‰"><a href="#æŠ¢å…ˆå¼ä¸­æ–­ï¼ˆPreemptive-Suspensionï¼‰" class="headerlink" title="æŠ¢å…ˆå¼ä¸­æ–­ï¼ˆPreemptive Suspensionï¼‰"></a>æŠ¢å…ˆå¼ä¸­æ–­ï¼ˆPreemptive Suspensionï¼‰</h5><p>ä¸éœ€è¦çº¿ç¨‹çš„æ‰§è¡Œä»£ç ä¸»åŠ¨é…åˆï¼Œåœ¨GCå‘ç”Ÿæ—¶ï¼Œé¦–å…ˆæŠŠæ‰€æœ‰çº¿ç¨‹å…¨éƒ¨ä¸­æ–­ï¼Œå¦‚æœå‘ç°æœ‰çº¿ç¨‹ä¸­æ–­çš„åœ°æ–¹ä¸åœ¨å®‰å…¨ç‚¹ä¸Šï¼Œå°±æ¢å¤çº¿ç¨‹ï¼Œè®©å®ƒâ€è·‘â€åˆ°å®‰å…¨ç‚¹ä¸Šã€‚ï¼ˆè¿™ç§æ–¹å¼å‡ ä¹æ²¡æœ‰è™šæ‹Ÿæœºä½¿ç”¨äº†ï¼‰</p><h5 id="ä¸»åŠ¨å¼ä¸­æ–­ï¼ˆVoluntary-Suspensionï¼‰"><a href="#ä¸»åŠ¨å¼ä¸­æ–­ï¼ˆVoluntary-Suspensionï¼‰" class="headerlink" title="ä¸»åŠ¨å¼ä¸­æ–­ï¼ˆVoluntary Suspensionï¼‰"></a>ä¸»åŠ¨å¼ä¸­æ–­ï¼ˆVoluntary Suspensionï¼‰</h5><p>å½“GCéœ€è¦ä¸­æ–­çº¿ç¨‹çš„æ—¶å€™ï¼Œä¸ç›´æ¥å¯¹çº¿ç¨‹æ“ä½œï¼Œä»…ä»…ç®€å•åœ°è®¾ç½®ä¸€ä¸ªæ ‡å¿—ï¼Œå„ä¸ªçº¿ç¨‹æ‰§è¡Œæ—¶ä¸»åŠ¨å»è½®è¯¢è¿™ä¸ªæ ‡å¿—ï¼Œå‘ç°ä¸­æ–­æ ‡å¿—ä¸ºçœŸæ—¶å°±è‡ªå·±ä¸­æ–­æŒ‚èµ·ã€‚</p><h4 id="Safe-Region"><a href="#Safe-Region" class="headerlink" title="Safe Region"></a>Safe Region</h4><p>å½“çº¿ç¨‹å¤„ç†SleepçŠ¶æ€æˆ–è€…BlockedçŠ¶æ€ï¼Œè¿™æ—¶çº¿ç¨‹æ— æ³•å“åº”JVMçš„ä¸­æ–­è¯·æ±‚ï¼Œä¹Ÿå°±æ— æ³•â€è·‘â€åˆ°å®‰å…¨çš„åœ°æ–¹å»ä¸­æ–­æŒ‚èµ·ï¼ŒJVMä¹Ÿä¸å¯èƒ½ç­‰åˆ°çº¿ç¨‹é‡æ–°è¢«åˆ†é…CPUæ—¶é—´ã€‚è¿™å°±éœ€è¦å®‰å…¨åŒºåŸŸæ¥è§£å†³ã€‚</p><p><strong>å®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰</strong>æ˜¯æŒ‡åœ¨ä¸€æ®µä»£ç ç‰‡æ®µä¹‹ä¸­ï¼Œå¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚åœ¨è¿™ä¸ªåŒºåŸŸä¸­çš„ä»»æ„åœ°æ–¹å¼€å§‹GCéƒ½æ˜¯å®‰å…¨çš„ã€‚</p><p>åœ¨çº¿ç¨‹æ‰§è¡Œåˆ°Safe Regionä¸­çš„ä»£ç æ—¶ï¼Œé¦–å…ˆæ ‡è¯†è‡ªå·±å·²ç»è¿›å…¥äº†Safe Regionï¼Œé‚£æ ·ï¼Œå½“åœ¨è¿™æ®µæ—¶é—´é‡ŒJVMè¦å‘èµ·GCæ—¶ï¼Œå°±ä¸ç”¨ç®¡æ ‡è¯†è‡ªå·±ä¸ºSafe RegionçŠ¶æ€çš„çº¿ç¨‹äº†ã€‚åœ¨çº¿ç¨‹è¦ç¦»å¼€Safe Regionæ—¶ï¼Œå®ƒè¦æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å·²ç»å®Œæˆäº†æ ¹èŠ‚ç‚¹æšä¸¾ï¼ˆæˆ–è€…æ˜¯æ•´ä¸ªGCè¿‡ç¨‹ï¼‰ï¼Œå¦‚æœå®Œæˆäº†ï¼Œé‚£çº¿ç¨‹å°±ç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™å®ƒå°±å¿…é¡»ç­‰å¾…ç›´åˆ°æ”¶åˆ°å¯ä»¥å®‰å…¨ç¦»å¼€Safe Regionçš„ä¿¡å·ä¸ºæ­¢ã€‚</p><h2 id="åˆ é™¤ä¸å¯è¾¾å¯¹è±¡-Removing-Unused-Objects"><a href="#åˆ é™¤ä¸å¯è¾¾å¯¹è±¡-Removing-Unused-Objects" class="headerlink" title="åˆ é™¤ä¸å¯è¾¾å¯¹è±¡(Removing Unused Objects)"></a>åˆ é™¤ä¸å¯è¾¾å¯¹è±¡(Removing Unused Objects)</h2><p>å„ç§GCç®—æ³•åœ¨åˆ é™¤ä¸å¯è¾¾å¯¹è±¡æ—¶ç•¥æœ‰ä¸åŒ, ä½†æ€»ä½“å¯åˆ†ä¸ºä¸‰ç±»: æ¸…é™¤(sweeping)ã€æ•´ç†(compacting)å’Œå¤åˆ¶ (copying)ã€‚</p><h3 id="Sweep-æ¸…é™¤"><a href="#Sweep-æ¸…é™¤" class="headerlink" title="Sweep(æ¸…é™¤)"></a>Sweep(æ¸…é™¤)</h3><p><strong>Mark-Sweep</strong>(æ ‡è®°-æ¸…é™¤)ç®—æ³•æ˜¯æœ€åŸºç¡€çš„æ”¶é›†ç®—æ³•ã€‚åœ¨æ ‡è®°é˜¶æ®µå®Œæˆä¹‹åï¼Œæ‰€æœ‰ä¸å¯è¾¾çš„å¯¹è±¡å ç”¨çš„ç©ºé—´éƒ½ä¼šè¢«å›æ”¶ï¼Œç”¨äºä¸‹ä¸€æ¬¡æ–°å¯¹è±¡çš„åˆ†é…ã€‚</p><p><img src="https://img.i7years.com/blog/03_02_GC-sweep.png" alt="GC-sweep"></p><h4 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h4><ul><li>ç®—æ³•ç®€å•ï¼Œå®ç°å®¹æ˜“</li></ul><h4 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h4><ul><li><strong>ç¢ç‰‡åŒ–ï¼ˆfragmentationï¼‰</strong>ã€‚åœ¨ GC æ ‡è®° - æ¸…é™¤ç®—æ³•çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šé€æ¸äº§ç”Ÿè¢«ç»†åŒ–çš„åˆ†å—ï¼Œä¸ä¹…åå°±ä¼šå¯¼è‡´æ— æ•°çš„ å°åˆ†å—æ•£å¸ƒåœ¨å †çš„å„å¤„ã€‚å¦‚æœå‘ç”Ÿç¢ç‰‡åŒ–ï¼Œé‚£ä¹ˆå³ä½¿å †ä¸­åˆ†å—çš„æ€»å¤§å°å¤Ÿç”¨ï¼Œä¹Ÿä¼šå› ä¸ºä¸€ä¸ªä¸ªçš„åˆ†å—éƒ½å¤ªå°è€Œä¸ èƒ½æ‰§è¡Œåˆ†é…ã€‚</li><li>éœ€è¦ä½¿ç”¨<strong>ç©ºé—²é“¾è¡¨</strong> (freeÂ­list)ï¼Œæ¥è®°å½•æ‰€æœ‰çš„ç©ºé—²åŒºåŸŸï¼Œä»¥åŠæ¯ä¸ªåŒºåŸŸçš„å¤§å°ã€‚ç»´æŠ¤ç©ºé—²è¡¨å¢åŠ äº†å¯¹è±¡åˆ†é…æ—¶çš„å¼€é”€ã€‚</li><li><strong>åˆ†é…é€Ÿåº¦ä½ä¸‹</strong>ã€‚GC æ ‡è®° - æ¸…é™¤ç®—æ³•ä¸­åˆ†å—ä¸æ˜¯è¿ç»­çš„ï¼Œå› æ­¤æ¯æ¬¡åˆ†é…éƒ½å¿…é¡»éå†ç©ºé—²é“¾è¡¨ï¼Œæ‰¾åˆ°è¶³å¤Ÿå¤§çš„åˆ†å—ã€‚æœ€ç³Ÿçš„æƒ…å†µå°±æ˜¯æ¯æ¬¡è¿›è¡Œåˆ†é…éƒ½å¾—æŠŠç©ºé—²é“¾è¡¨éå†åˆ°æœ€åã€‚</li></ul><h3 id="Copy-å¤åˆ¶"><a href="#Copy-å¤åˆ¶" class="headerlink" title="Copy(å¤åˆ¶)"></a>Copy(å¤åˆ¶)</h3><p>ä¸ºäº†è§£å†³æ•ˆç‡é—®é¢˜ï¼Œä¸€ç§ç§°ä¸ºâ€œå¤åˆ¶â€ï¼ˆCopyingï¼‰çš„æ”¶é›†ç®—æ³•å‡ºç°äº†ï¼Œå®ƒå°†å¯ç”¨å†…å­˜æŒ‰å®¹é‡åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„ä¸€å—ã€‚å½“è¿™ä¸€å—çš„å†…å­˜ç”¨å®Œäº†ï¼Œå°±å°†è¿˜å­˜æ´»ç€çš„å¯¹è±¡å¤åˆ¶åˆ°å¦å¤–ä¸€å—ä¸Šé¢ï¼Œç„¶åå†æŠŠå·²ä½¿ç”¨è¿‡çš„å†…å­˜ç©ºé—´ä¸€æ¬¡æ¸…ç†æ‰ã€‚è¿™æ ·ä½¿å¾—æ¯æ¬¡éƒ½æ˜¯å¯¹æ•´ä¸ªåŠåŒºè¿›è¡Œå†…å­˜å›æ”¶ï¼Œå†…å­˜åˆ†é…æ—¶ä¹Ÿå°±ä¸ç”¨è€ƒè™‘å†…å­˜ç¢ç‰‡ç­‰å¤æ‚æƒ…å†µï¼Œåªè¦ç§»åŠ¨å †é¡¶æŒ‡é’ˆï¼ŒæŒ‰é¡ºåºåˆ†é…å†…å­˜å³å¯ï¼Œå®ç°ç®€å•ï¼Œè¿è¡Œé«˜æ•ˆã€‚</p><p><img src="https://img.i7years.com/blog/03_04_GC-mark-and-copy-in-Java.png" alt="GC-mark-and-copy-in-Java"></p><h4 id="ä¼˜ç‚¹-1"><a href="#ä¼˜ç‚¹-1" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h4><h5 id="ä¼˜ç§€çš„ååé‡"><a href="#ä¼˜ç§€çš„ååé‡" class="headerlink" title="ä¼˜ç§€çš„ååé‡"></a>ä¼˜ç§€çš„ååé‡</h5><p>GC æ ‡è®° - æ¸…é™¤ç®—æ³•æ¶ˆè€—çš„ååé‡æ˜¯æœç´¢æ´»åŠ¨å¯¹è±¡ï¼ˆæ ‡è®°é˜¶æ®µï¼‰æ‰€èŠ±è´¹çš„æ—¶é—´å’Œæœç´¢æ•´ä½“å †ï¼ˆæ¸…é™¤é˜¶æ®µï¼‰æ‰€èŠ±è´¹çš„æ—¶é—´ä¹‹å’Œã€‚</p><p>è€Œ GC å¤åˆ¶ç®—æ³•åªæœç´¢å¹¶å¤åˆ¶æ´»åŠ¨å¯¹è±¡ï¼Œæ‰€ä»¥è·Ÿä¸€èˆ¬çš„ GC æ ‡è®° - æ¸…é™¤ç®— æ³•ç›¸æ¯”ï¼Œå®ƒèƒ½åœ¨è¾ƒçŸ­æ—¶é—´å†…å®Œæˆ GCã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå…¶ååé‡ä¼˜ç§€ã€‚</p><p>å°¤å…¶æ˜¯å †è¶Šå¤§ï¼Œå·®è·è¶Šæ˜æ˜¾ã€‚GC æ ‡è®° - æ¸…é™¤ç®—æ³•åœ¨æ¸…é™¤é˜¶æ®µæ‰€èŠ±è´¹çš„æ—¶é—´ä¼šä¸æ–­å¢åŠ ï¼Œ ä½† GC å¤åˆ¶ç®—æ³•å°±ä¸ä¼šäº§ç”Ÿè¿™ç§æ¶ˆè€—ã€‚æ¯•ç«Ÿå®ƒæ¶ˆè€—çš„æ—¶é—´æ˜¯ä¸æ´»åŠ¨å¯¹è±¡çš„æ•°é‡æˆæ¯”ä¾‹çš„ã€‚</p><h5 id="å¯å®ç°é«˜é€Ÿåˆ†é…"><a href="#å¯å®ç°é«˜é€Ÿåˆ†é…" class="headerlink" title="å¯å®ç°é«˜é€Ÿåˆ†é…"></a>å¯å®ç°é«˜é€Ÿåˆ†é…</h5><p>GC å¤åˆ¶ç®—æ³•ä¸ä½¿ç”¨ç©ºé—²é“¾è¡¨ã€‚è¿™æ˜¯å› ä¸ºåˆ†å—æ˜¯ä¸€ä¸ªè¿ç»­çš„å†…å­˜ç©ºé—´ã€‚å› æ­¤ï¼Œåªè¦è¿™ä¸ªåˆ†å—å¤§å°ä¸å°äºæ‰€ç”³è¯·çš„å¤§å°ï¼Œé‚£ä¹ˆç§»åŠ¨ <code>$free</code> æŒ‡é’ˆå°±å¯ä»¥è¿›è¡Œåˆ†é…äº†ã€‚ä¸åƒ GC æ ‡è®° - æ¸…é™¤ç®—æ³•é‚£æ ·æ¯æ¬¡åˆ†é…å†…å­˜ç©ºé—´æ—¶ï¼Œéƒ½è¦éå†ç©ºé—²é“¾è¡¨ï¼Œè€Œä¸”æ¯æ¬¡éƒ½è¦éå†åˆ°æœ€åä¸€ä¸ªåˆ†å—ã€‚</p><h5 id="ä¸ä¼šå‘ç”Ÿç¢ç‰‡åŒ–"><a href="#ä¸ä¼šå‘ç”Ÿç¢ç‰‡åŒ–" class="headerlink" title="ä¸ä¼šå‘ç”Ÿç¢ç‰‡åŒ–"></a>ä¸ä¼šå‘ç”Ÿç¢ç‰‡åŒ–</h5><p>GC å¤åˆ¶ç®—æ³•æ¯æ¬¡å›æ”¶åƒåœ¾å¯¹è±¡æ˜¯ï¼Œéƒ½æ˜¯å¯¹æ•´ä¸ªä¸€åŠçš„ç©ºé—´è¿›è¡Œå›æ”¶ï¼Œä¸åƒ GC æ ‡è®° - æ¸…é™¤ç®—æ³•é‚£æ ·ï¼Œä¼šç•™ä¸‹ç¢ç‰‡åŒ–çš„å†…å­˜ç©ºé—´ã€‚</p><h4 id="ç¼ºç‚¹-1"><a href="#ç¼ºç‚¹-1" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h4><h5 id="å †ä½¿ç”¨æ•ˆç‡ä½ä¸‹"><a href="#å †ä½¿ç”¨æ•ˆç‡ä½ä¸‹" class="headerlink" title="å †ä½¿ç”¨æ•ˆç‡ä½ä¸‹"></a>å †ä½¿ç”¨æ•ˆç‡ä½ä¸‹</h5><p>GC å¤åˆ¶ç®—æ³•æŠŠå †äºŒç­‰åˆ†ï¼Œé€šå¸¸åªèƒ½åˆ©ç”¨å…¶ä¸­çš„ä¸€åŠæ¥å®‰æ’å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰ä¸€åŠ å †èƒ½è¢«ä½¿ç”¨ã€‚ç›¸æ¯”å…¶ä»–èƒ½ä½¿ç”¨æ•´ä¸ªå †çš„ GC ç®—æ³•è€Œè¨€ï¼Œå¯ä»¥è¯´è¿™æ˜¯ GC å¤åˆ¶ç®—æ³•çš„ä¸€ä¸ªé‡å¤§ çš„ç¼ºé™·ã€‚</p><h3 id="Compact-æ•´ç†"><a href="#Compact-æ•´ç†" class="headerlink" title="Compact(æ•´ç†)"></a>Compact(æ•´ç†)</h3><p>æ ‡è®°-æ¸…é™¤-Â­æ•´ç†ç®—æ³• (Mark-Â­SweepÂ­-Compact)ã€‚æ ‡è®°è¿‡ç¨‹ä»ç„¶ä¸â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¸€æ ·ï¼Œä½†åç»­æ­¥éª¤ä¸æ˜¯ç›´æ¥å¯¹å¯å›æ”¶å¯¹è±¡è¿›è¡Œæ¸…ç†ï¼Œè€Œæ˜¯è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚</p><p><img src="https://img.i7years.com/blog/03_03_GC-mark-sweep-compact.png" alt="03_03_GC-mark-sweep-compact"></p><h4 id="ä¼˜ç‚¹-2"><a href="#ä¼˜ç‚¹-2" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h4><p>æ ‡è®°-æ¸…é™¤-Â­æ•´ç†ç®—æ³• (MarkÂ­SweepÂ­Compact)ï¼Œå°†æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡(å­˜æ´»å¯¹è±¡)ï¼Œè¿ç§»åˆ°å†…å­˜ç©ºé—´çš„èµ·å§‹å¤„, æ¶ˆé™¤äº†æ ‡è®°Â­æ¸…é™¤ç®—æ³•çš„ç¼ºç‚¹ã€‚</p><h4 id="ç¼ºç‚¹-2"><a href="#ç¼ºç‚¹-2" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h4><p>GCæš‚åœæ—¶é—´ä¼šå¢åŠ ã€‚å› ä¸ºéœ€è¦å°†æ‰€æœ‰å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€ä¸ªåœ°æ–¹, ç„¶åä¿®æ”¹æŒ‡å‘è¿™äº›å¯¹è±¡çš„å¼•ç”¨ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://book.douban.com/subject/24722612/" target="_blank" rel="noopener">ã€ŠJVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ[ç¬¬2ç‰ˆ]ã€‹ç¬¬3ç« èŠ‚ã€Œåƒåœ¾æ”¶é›†å™¨ä¸å†…å­˜åˆ†é…ç­–ç•¥ã€</a></li><li><a href="https://github.com/cncounter/gc-handbook" target="_blank" rel="noopener">https://github.com/cncounter/gc-handbook</a></li><li><a href="https://book.douban.com/subject/26821357/" target="_blank" rel="noopener">ã€Šåƒåœ¾å›æ”¶çš„ç®—æ³•ä¸å®ç°ã€‹</a></li><li><a href="https://stackoverflow.com/questions/26029764/what-does-oop-maps-means-in-hotspot-vm-exactly" target="_blank" rel="noopener">what-does-oop-maps-means-in-hotspot-vm-exactly</a></li><li><a href="http://java-latte.blogspot.com/2013/08/garbage-collection-in-java.html" target="_blank" rel="noopener">http://java-latte.blogspot.com/2013/08/garbage-collection-in-java.html</a></li><li><a href="https://www.ibm.com/developerworks/cn/java/j-lo-JVMGarbageCollection/index.html" target="_blank" rel="noopener">https://www.ibm.com/developerworks/cn/java/j-lo-JVMGarbageCollection/index.html</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> GC </tag>
            
            <tag> JVM </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[GCåŸºæœ¬æ¦‚å¿µ]]></title>
      <url>/posts/jvm-gc-base-concept.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/pexels-photo-1269968.jpeg?imageslim" alt="pexels-photo-1269968"></p><p>åœ¨äº†è§£ <a href="https://wangwei.one/posts/396cfa32.html">GCç®—æ³•</a> ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ¥äº†è§£ä¸€äº›ä¸ç®—æ³•æœ‰å…³çš„åŸºæœ¬æ¦‚å¿µã€‚</p><a id="more"></a><h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><ul><li>GCçš„å®šä¹‰</li><li>å¯¹è±¡/å¤´/åŸŸ</li><li>æŒ‡é’ˆ</li><li>mutator</li><li>å †</li><li>æ´»åŠ¨å¯¹è±¡/éæ´»åŠ¨å¯¹è±¡</li><li>åˆ†é…(allocation)</li><li>åˆ†å—(chunk)</li><li>æ ¹(root)</li><li>ååé‡(throughput)</li><li>æœ€å¤§æš‚åœæ—¶é—´</li><li>å †ä½¿ç”¨æ•ˆç‡</li><li>è®¿é—®å±€éƒ¨æ€§</li></ul><h2 id="GCçš„å®šä¹‰"><a href="#GCçš„å®šä¹‰" class="headerlink" title="GCçš„å®šä¹‰"></a>GCçš„å®šä¹‰</h2><p>GC æ˜¯ <code>Garbage Collection</code> çš„ç®€ç§°ï¼Œä¹Ÿå°±æ˜¯åƒåœ¾æ”¶é›†</p><p><code>Garbage Collector</code>ï¼šåƒåœ¾æ”¶é›†å™¨</p><p><code>Minor GC</code>ï¼šå°å‹GC</p><p><code>Major GC</code>ï¼šå¤§å‹GC</p><p><code>Full GC</code>ï¼šå®Œå…¨GCï¼ˆä¸ºäº†æ¸…æ™°èµ·è§ï¼Œä¸€èˆ¬ç›´æ¥è¯‘ä¸º Full GCï¼‰</p><h2 id="å¯¹è±¡-å¤´-åŸŸ"><a href="#å¯¹è±¡-å¤´-åŸŸ" class="headerlink" title="å¯¹è±¡/å¤´/åŸŸ"></a>å¯¹è±¡/å¤´/åŸŸ</h2><h3 id="å¯¹è±¡"><a href="#å¯¹è±¡" class="headerlink" title="å¯¹è±¡"></a>å¯¹è±¡</h3><p>åœ¨ GC çš„ä¸–ç•Œä¸­ï¼Œå¯¹è±¡è¡¨ç¤ºçš„æ˜¯â€œé€šè¿‡åº”ç”¨ç¨‹åºåˆ©ç”¨çš„<strong>æ•°æ®çš„é›†åˆ</strong>â€ã€‚å¯¹è±¡é…ç½®åœ¨å†…å­˜ç©ºé—´é‡Œã€‚GC æ ¹æ®æƒ…å†µå°†é…ç½®å¥½çš„å¯¹è±¡è¿›è¡Œç§»åŠ¨æˆ–é”€æ¯æ“ä½œã€‚å› æ­¤ï¼Œå¯¹è±¡æ˜¯ GC çš„åŸºæœ¬å•ä½ã€‚</p><p>å¯¹è±¡ç”±å¤´ï¼ˆheaderï¼‰å’ŒåŸŸï¼ˆfieldï¼‰æ„æˆã€‚åœ¨å¯¹è±¡å†…éƒ¨ï¼Œå¤´ä¹‹åå­˜åœ¨ 1 ä¸ªåŠ 1 ä¸ªä»¥ä¸Šçš„åŸŸã€‚å¦‚å›¾1.1æ‰€ç¤ºï¼š</p><p><img src="https://img.i7years.com/blog/GC_Object.png" alt="GC_Object"></p><h4 id="å¤´"><a href="#å¤´" class="headerlink" title="å¤´"></a>å¤´</h4><p>ç”¨äºä¿å­˜å¯¹è±¡æœ¬èº«ä¿¡æ¯ï¼Œä¸»è¦å«æœ‰ä»¥ä¸‹ä¿¡æ¯ï¼š</p><ul><li>å¯¹è±¡çš„å¤§å°</li><li>å¯¹è±¡çš„ç§ç±»</li></ul><h4 id="åŸŸ"><a href="#åŸŸ" class="headerlink" title="åŸŸ"></a>åŸŸ</h4><p>å¯¹è±¡ä½¿ç”¨è€…åœ¨å¯¹è±¡ä¸­å¯è®¿é—®çš„éƒ¨åˆ†ç§°ä¸ºâ€œåŸŸâ€ã€‚</p><p>åŸŸä¸­çš„æ•°æ®ç±»å‹å¤§è‡´åˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li>æŒ‡é’ˆï¼šæŒ‡é’ˆæ˜¯æŒ‡å‘å†…å­˜ç©ºé—´ä¸­æŸå—åŒºåŸŸçš„å€¼ã€‚</li><li>éæŒ‡é’ˆï¼šæŒ‡çš„æ˜¯åœ¨ç¼–ç¨‹ä¸­ç›´æ¥ä½¿ç”¨å€¼æœ¬èº«ã€‚ä¾‹å¦‚ï¼šæ•°å€¼ã€å­—ç¬¦ä»¥åŠçœŸå‡å€¼ã€‚</li></ul><h2 id="æŒ‡é’ˆ"><a href="#æŒ‡é’ˆ" class="headerlink" title="æŒ‡é’ˆ"></a>æŒ‡é’ˆ</h2><p>é€šè¿‡GCï¼Œå¯¹è±¡ä¼šè¢«é”€æ¯æˆ–ä¿ç•™ï¼Œè¿™æ—¶å€™èµ·åˆ°å…³é”®ä½œç”¨çš„å°±æ˜¯æŒ‡é’ˆï¼Œå› ä¸ºGCæ˜¯æ ¹æ®å¯¹è±¡çš„æŒ‡é’ˆæŒ‡å‘å»æœå¯»å…¶ä»–å¯¹è±¡çš„ï¼ŒGCå¯¹äºéæŒ‡é’ˆä¸è¿›è¡Œä»»ä½•æ“ä½œã€‚</p><p>æˆ‘ä»¬æŠŠå›¾ 1.2 ä¸­çš„ B å’Œ C ç§°ä¸º A çš„å­å¯¹è±¡ã€‚å¯¹æŸä¸ªå¯¹è±¡çš„å­å¯¹è±¡è¿›è¡ŒæŸé¡¹å¤„ç†æ˜¯ GC çš„åŸºæœ¬æ“ä½œã€‚</p><p><img src="https://img.i7years.com/blog/GC_Pointer.png" alt="GC_Pointer"></p><h2 id="mutator"><a href="#mutator" class="headerlink" title="mutator"></a>mutator</h2><p>mutatorï¼Œæ˜¯â€œæ”¹å˜æŸç‰©â€çš„æ„æ€ï¼Œé‚£è¦æ”¹å˜ä»€ä¹ˆå‘¢ï¼Ÿ é‚£å°±æ˜¯GCå¯¹è±¡é—´çš„å¼•ç”¨å…³ç³»ï¼Œå®ƒçš„å®ä½“å°±æ˜¯â€œåº”ç”¨ç¨‹åºâ€ã€‚<br>mutatorè¿›è¡Œçš„å®é™…æ“ä½œï¼š</p><ul><li>ç”Ÿæˆå¯¹è±¡</li><li>æ›´æ–°æŒ‡é’ˆ</li></ul><p>mutatoråœ¨è¿›è¡Œè¿™äº›æ“ä½œæ—¶ï¼Œä¼šåŒæ—¶ä¸ºåº”ç”¨ç¨‹åºçš„ç”¨æˆ·è¿›è¡Œä¸€äº›å¤„ç†ï¼Œéšç€è¿™äº›å¤„ç†çš„å¢åŠ ï¼Œå¯¹è±¡é—´çš„å¼•ç”¨å…³ç³»ä¹Ÿä¼šå‘ç”Ÿâ€œæ”¹å˜â€ï¼Œéšä¹‹ï¼Œä¹Ÿä¼šäº§ç”Ÿåƒåœ¾ï¼Œè´Ÿè´£å›æ”¶è¿™äº›åƒåœ¾çš„æœºåˆ¶å°±æ˜¯GCã€‚</p><h2 id="å †"><a href="#å †" class="headerlink" title="å †"></a>å †</h2><p><a href="https://wangwei.one/posts/71c1df10.html">å †</a> æŒ‡çš„æ˜¯ç”¨äºåŠ¨æ€ï¼ˆä¹Ÿå°±æ˜¯æ‰§è¡Œç¨‹åºæ—¶ï¼‰å­˜æ”¾å¯¹è±¡çš„å†…å­˜ç©ºé—´ã€‚å½“ mutator ç”³è¯·å­˜æ”¾å¯¹è±¡æ—¶ï¼Œ æ‰€éœ€çš„å†…å­˜ç©ºé—´å°±ä¼šä»è¿™ä¸ªå †ä¸­è¢«åˆ†é…ç»™ mutatorã€‚</p><p>GC æ˜¯ç®¡ç†å †ä¸­å·²åˆ†é…å¯¹è±¡çš„æœºåˆ¶ã€‚åœ¨å¼€å§‹æ‰§è¡Œ mutator å‰ï¼ŒGC è¦åˆ†é…ç”¨äºå †çš„å†…å­˜ç©ºé—´ã€‚ ä¸€æ—¦å¼€å§‹æ‰§è¡Œ mutatorï¼Œç¨‹åºå°±ä¼šæŒ‰ç…§ mutator çš„è¦æ±‚åœ¨å †ä¸­å­˜æ”¾å¯¹è±¡ã€‚ç­‰åˆ°å †è¢«å¯¹è±¡å æ»¡åï¼Œ GC å°±ä¼šå¯åŠ¨ï¼Œä»è€Œåˆ†é…å¯ç”¨ç©ºé—´ã€‚å¦‚æœä¸èƒ½åˆ†é…è¶³å¤Ÿçš„å¯ç”¨ç©ºé—´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬å°±è¦æ‰©å¤§å †ã€‚</p><p>æˆ‘ä»¬æŠŠ <code>$heap_start</code> å®šä¸ºæŒ‡å‘å †é¦–åœ°å€çš„æŒ‡é’ˆï¼ŒæŠŠ <code>$heap_end</code> å®šä¸ºæŒ‡å‘å †æœ«å°¾ä¸‹ä¸€ä¸ªåœ°å€çš„æŒ‡é’ˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ <code>$heap_end</code> ç­‰äº <code>$heap_start</code> + <code>HEAP_SIZE</code>ã€‚</p><p><img src="https://img.i7years.com/blog/GC_Heap.png" alt="GC_Heap"></p><h2 id="æ´»åŠ¨å¯¹è±¡-éæ´»åŠ¨å¯¹è±¡"><a href="#æ´»åŠ¨å¯¹è±¡-éæ´»åŠ¨å¯¹è±¡" class="headerlink" title="æ´»åŠ¨å¯¹è±¡/éæ´»åŠ¨å¯¹è±¡"></a>æ´»åŠ¨å¯¹è±¡/éæ´»åŠ¨å¯¹è±¡</h2><p>åˆ†é…åˆ°å†…å­˜ç©ºé—´ä¸­çš„å¯¹è±¡ä¸­é‚£äº›èƒ½é€šè¿‡ mutator å¼•ç”¨çš„å¯¹è±¡ç§°ä¸ºâ€œæ´»åŠ¨å¯¹è±¡â€ã€‚åä¹‹ï¼Œé‚£äº›ä¸èƒ½é€šè¿‡ç¨‹åºå¼•ç”¨çš„å¯¹è±¡ç§°ä¸ºâ€œéæ´»åŠ¨å¯¹è±¡â€ã€‚</p><p>GC ä¼šä¿ç•™æ´»åŠ¨å¯¹è±¡ï¼Œé”€æ¯éæ´»åŠ¨å¯¹è±¡ã€‚å½“é”€æ¯éæ´»åŠ¨å¯¹è±¡æ—¶ï¼Œå…¶åŸæœ¬å æ®çš„å†… å­˜ç©ºé—´ä¼šå¾—åˆ°è§£æ”¾ï¼Œä¾›ä¸‹ä¸€ä¸ªè¦åˆ†é…çš„æ–°å¯¹è±¡ä½¿ç”¨ã€‚</p><p><img src="https://img.i7years.com/blog/GC_Live_Dead.png" alt="GC_Live_Dead"></p><h2 id="åˆ†é…-allocation"><a href="#åˆ†é…-allocation" class="headerlink" title="åˆ†é…(allocation)"></a>åˆ†é…(allocation)</h2><p>åˆ†é…ï¼ˆallocationï¼‰æŒ‡çš„æ˜¯åœ¨å†…å­˜ç©ºé—´ä¸­åˆ†é…å¯¹è±¡ã€‚å½“ mutator éœ€è¦æ–°å¯¹è±¡æ—¶ï¼Œå°±ä¼šå‘åˆ†é…å™¨ï¼ˆallocatorï¼‰ç”³è¯·ä¸€ä¸ªå¤§å°åˆé€‚çš„ç©ºé—´ã€‚åˆ†é…å™¨åˆ™åœ¨å †çš„å¯ç”¨ç©ºé—´ä¸­æ‰¾å¯»æ»¡è¶³è¦æ±‚çš„ç©ºé—´ï¼Œ è¿”å›ç»™ mutatorã€‚</p><h2 id="åˆ†å—-chunk"><a href="#åˆ†å—-chunk" class="headerlink" title="åˆ†å—(chunk)"></a>åˆ†å—(chunk)</h2><p>åˆå§‹çŠ¶æ€ä¸‹ï¼Œå †è¢«ä¸€ä¸ªå¤§çš„åˆ†å—æ‰€å æ®ã€‚</p><p>ç„¶åï¼Œç¨‹åºä¼šæ ¹æ® mutator çš„è¦æ±‚æŠŠè¿™ä¸ªåˆ†å—åˆ†å‰²æˆåˆé€‚çš„å¤§å°ï¼Œä½œä¸ºï¼ˆæ´»åŠ¨ï¼‰å¯¹è±¡ä½¿ç”¨ã€‚ æ´»åŠ¨å¯¹è±¡ä¸ä¹…åä¼šè½¬åŒ–ä¸ºåƒåœ¾è¢«å›æ”¶ã€‚æ­¤æ—¶ï¼Œè¿™éƒ¨åˆ†è¢«å›æ”¶çš„å†…å­˜ç©ºé—´å†æ¬¡æˆä¸ºåˆ†å—ï¼Œä¸ºä¸‹æ¬¡ è¢«åˆ©ç”¨åšå‡†å¤‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå†…å­˜é‡Œçš„å„ä¸ªåŒºå—éƒ½é‡å¤ç€åˆ†å—â†’æ´»åŠ¨å¯¹è±¡â†’åƒåœ¾ï¼ˆéæ´»åŠ¨å¯¹è±¡ï¼‰â†’ åˆ†å—â†’â€¦â€¦è¿™æ ·çš„è¿‡ç¨‹ã€‚</p><h2 id="æ ¹-root"><a href="#æ ¹-root" class="headerlink" title="æ ¹(root)"></a>æ ¹(root)</h2><p>åœ¨GCçš„ä¸–ç•Œé‡Œï¼ŒæŒ‡çš„æ˜¯æŒ‡å‘å¯¹è±¡æŒ‡é’ˆçš„â€èµ·ç‚¹â€ã€‚</p><p><img src="https://img.i7years.com/blog/GC_Root.png" alt="GC_Root"></p><h2 id="è¯„ä»·æ ‡å‡†"><a href="#è¯„ä»·æ ‡å‡†" class="headerlink" title="è¯„ä»·æ ‡å‡†"></a>è¯„ä»·æ ‡å‡†</h2><h3 id="ååé‡-throughput"><a href="#ååé‡-throughput" class="headerlink" title="ååé‡(throughput)"></a>ååé‡(throughput)</h3><p>ååé‡ï¼ˆthroughputï¼‰æŒ‡çš„æ˜¯â€œåœ¨å•ä½æ—¶é—´å†…çš„å¤„ç†èƒ½åŠ›â€ã€‚</p><p><img src="https://img.i7years.com/blog/GC_Throughput.png" alt="GC_Throughput"></p><p>åœ¨ mutator æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒGC ä¸€å…±å¯åŠ¨äº† 3 æ¬¡ï¼Œæˆ‘ä»¬æŠŠèŠ±è´¹çš„æ—¶é—´åˆ†åˆ«è®¾ä¸º Aã€Bã€Cã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼ŒGC æ€»å…±èŠ±è´¹çš„æ—¶é—´ä¸ºï¼ˆA ï¼‹ B ï¼‹ Cï¼‰ã€‚å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å‰é¢æåˆ°è¿‡ï¼Œä»¥ GC ä¸ºå¯¹è±¡ çš„å †å¤§å°æ˜¯ HEAP_SIZEã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å¤§å°ä¸º HEAP_SIZE çš„å †è¿›è¡Œå†…å­˜ç®¡ç†ï¼Œè¦èŠ±è´¹çš„æ—¶é•¿ ä¸ºï¼ˆA ï¼‹ B ï¼‹ Cï¼‰ã€‚</p><p>å› æ­¤ï¼Œè¿™ç§æƒ…å†µä¸‹ GC çš„ååé‡ä¸º <code>HEAP_SIZE /ï¼ˆA ï¼‹ B ï¼‹ Cï¼‰</code>ã€‚</p><h3 id="æœ€å¤§æš‚åœæ—¶é—´"><a href="#æœ€å¤§æš‚åœæ—¶é—´" class="headerlink" title="æœ€å¤§æš‚åœæ—¶é—´"></a>æœ€å¤§æš‚åœæ—¶é—´</h3><p>æœ€å¤§æš‚åœæ—¶é—´æŒ‡çš„æ˜¯â€œå› æ‰§è¡Œ GC è€Œæš‚åœæ‰§è¡Œ mutator çš„æœ€é•¿æ—¶é—´â€ã€‚å›¾ 1.7ä¸­æœ€å¤§æš‚åœæ—¶é—´æ˜¯ Aï½C çš„æœ€å¤§å€¼ï¼Œä¹Ÿå°±æ˜¯ Bã€‚</p><p>ä¸ç®¡å°è¯•å“ªç§ GC ç®—æ³•ï¼Œæˆ‘ä»¬éƒ½ä¼šå‘ç°è¾ƒå¤§ çš„ååé‡å’Œè¾ƒçŸ­çš„æœ€å¤§æš‚åœæ—¶é—´ä¸å¯å…¼å¾—ã€‚æ‰€ä»¥åº”æ ¹æ®æ‰§è¡Œçš„åº”ç”¨æ‰€é‡è§†çš„æŒ‡æ ‡çš„ä¸åŒï¼Œæ¥ åˆ†åˆ«é‡‡ç”¨ä¸åŒçš„ GC ç®—æ³•ã€‚</p><h3 id="å †ä½¿ç”¨æ•ˆç‡"><a href="#å †ä½¿ç”¨æ•ˆç‡" class="headerlink" title="å †ä½¿ç”¨æ•ˆç‡"></a>å †ä½¿ç”¨æ•ˆç‡</h3><p>å·¦å³å †ä½¿ç”¨æ•ˆç‡çš„å› ç´ æœ‰ä¸¤ä¸ªï¼šå¤´çš„å¤§å° å’Œ å †çš„ç”¨æ³•ã€‚</p><h4 id="å¤´çš„å¤§å°"><a href="#å¤´çš„å¤§å°" class="headerlink" title="å¤´çš„å¤§å°"></a>å¤´çš„å¤§å°</h4><p>åœ¨å †ä¸­å †æ”¾çš„ä¿¡æ¯è¶Šå¤šï¼ŒGC çš„æ•ˆç‡ä¹Ÿå°±è¶Šé«˜ï¼Œååé‡ä¹Ÿå°±éšä¹‹å¾—åˆ°æ”¹å–„ã€‚ ä½†æ¯‹åº¸ç½®ç–‘ï¼Œå¤´è¶Šå°è¶Šå¥½ã€‚å› æ­¤ä¸ºäº†æ‰§è¡Œ GCï¼Œéœ€è¦æŠŠåœ¨å¤´ä¸­å †æ”¾çš„ä¿¡æ¯æ§åˆ¶åœ¨æœ€å°é™åº¦ã€‚</p><h4 id="å †çš„ç”¨æ³•"><a href="#å †çš„ç”¨æ³•" class="headerlink" title="å †çš„ç”¨æ³•"></a>å †çš„ç”¨æ³•</h4><p>æ ¹æ®å †çš„ç”¨æ³•ï¼Œå †ä½¿ç”¨æ•ˆç‡ä¹Ÿä¼šå‡ºç°å·¨å¤§çš„å·®å¼‚ã€‚ä¸¾ä¸ªä¾‹å­ï¼ŒGC å¤åˆ¶ç®—æ³•ä¸­å°† å †äºŒç­‰åˆ†ï¼Œæ¯æ¬¡åªä½¿ç”¨ä¸€åŠï¼Œäº¤æ›¿è¿›è¡Œï¼Œå› æ­¤æ€»æ˜¯åªèƒ½åˆ©ç”¨å †çš„ä¸€åŠã€‚ç›¸å¯¹è€Œè¨€ï¼ŒGC æ ‡è®° -æ¸…é™¤ç®—æ³•å’Œå¼•ç”¨è®¡æ•°æ³•å°±èƒ½åˆ©ç”¨æ•´ä¸ªå †ã€‚</p><blockquote><p>å †ä½¿ç”¨æ•ˆç‡å’Œååé‡ï¼Œä»¥åŠæœ€å¤§æš‚åœæ—¶é—´ä¸å¯å…¼å¾—ã€‚</p><p>å¯ç”¨çš„å †è¶Šå¤§ï¼ŒGC è¿è¡Œè¶Šå¿«ï¼›ç›¸åï¼Œè¶Šæƒ³æœ‰æ•ˆåœ°åˆ©ç”¨æœ‰é™çš„å †ï¼ŒGC èŠ±è´¹çš„æ—¶é—´å°±è¶Šé•¿ã€‚</p></blockquote><h3 id="è®¿é—®å±€éƒ¨æ€§"><a href="#è®¿é—®å±€éƒ¨æ€§" class="headerlink" title="è®¿é—®å±€éƒ¨æ€§"></a>è®¿é—®å±€éƒ¨æ€§</h3><p>PC ä¸Šæœ‰ 4 ç§å­˜å‚¨å™¨ï¼Œåˆ†åˆ«æ˜¯å¯„å­˜å™¨ã€ç¼“å­˜ã€å†…å­˜ã€è¾…åŠ©å­˜å‚¨å™¨ã€‚</p><p><img src="https://img.i7years.com/blog/GC_Storage.png" alt="GC_Storage"></p><p>ä¸€èˆ¬æˆ‘ä»¬ä¼šæŠŠæ‰€æœ‰çš„æ•°æ®éƒ½æ”¾åœ¨å†…å­˜é‡Œï¼Œå½“ CPU è®¿é—®æ•°æ®æ—¶ï¼Œä»…æŠŠ è¦ä½¿ç”¨çš„æ•°æ®ä»å†…å­˜è¯»å–åˆ°ç¼“å­˜ã€‚ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜å°†å®ƒé™„è¿‘çš„æ‰€æœ‰æ•°æ®éƒ½è¯»å–åˆ°ç¼“å­˜ä¸­ï¼Œ ä»è€Œå‹ç¼©è¯»å–æ•°æ®æ‰€éœ€è¦çš„æ—¶é—´ã€‚</p><p>å…·æœ‰å¼•ç”¨å…³ç³»çš„å¯¹è±¡ä¹‹é—´é€šå¸¸å¾ˆå¯èƒ½å­˜åœ¨è¿ç»­è®¿é—®çš„æƒ…å†µã€‚è¿™åœ¨å¤šæ•°ç¨‹åºä¸­ éƒ½å¾ˆå¸¸è§ï¼Œç§°ä¸ºâ€œè®¿é—®çš„å±€éƒ¨æ€§â€ã€‚è€ƒè™‘åˆ°è®¿é—®çš„å±€éƒ¨æ€§ï¼ŒæŠŠå…·æœ‰å¼•ç”¨å…³ç³»çš„å¯¹è±¡å®‰æ’åœ¨å † ä¸­è¾ƒè¿‘çš„ä½ç½®ï¼Œå°±èƒ½æé«˜åœ¨ç¼“å­˜ä¸­è¯»å–åˆ°æƒ³åˆ©ç”¨çš„æ•°æ®çš„æ¦‚ç‡ï¼Œä»¤ mutator é«˜é€Ÿè¿è¡Œã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://book.douban.com/subject/26821357/" target="_blank" rel="noopener">ã€Šåƒåœ¾å›æ”¶çš„ç®—æ³•ä¸å®ç°ã€‹</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> GC </tag>
            
            <tag> JVM </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Java8 MetaSpaceä»‹ç»]]></title>
      <url>/posts/java8-jvm-metaSpace.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/pexels-photo-1143758.jpeg" alt="pexels-photo-1143758"></p><p><a href="https://wangwei.one/posts/71c1df10.html">å‰é¢</a> æˆ‘ä»¬å­¦ä¹ äº†Java7çš„å†…å­˜æ¨¡å‹ï¼Œé‡ç‚¹äº†è§£äº†å®ƒçš„Runtime Data Areaï¼Œä»Šå¤©æˆ‘ä»¬è¦æ¥å­¦ä¹ ä¸€ä¸‹Java8 HotSpot(TM) VMå†…å­˜æ¨¡å‹ï¼Œçœ‹çœ‹å®ƒä¸Java7 VMå­˜åœ¨å“ªäº›å·®å¼‚ã€‚</p><a id="more"></a><p>ä¸Java7ç›¸æ¯”è¾ƒï¼ŒJava8 VMçš„ä¸€ä¸ªé‡å¤§æ›´æ–°ï¼š<strong>å®Œå…¨ç§»é™¤æ°¸ä¹…ä»£ï¼ˆPermGenï¼‰ï¼Œå–è€Œä»£ä¹‹çš„ä¸ºå…ƒç©ºé—´ï¼ˆMetaspaceï¼‰</strong>ã€‚</p><p><img src="https://img.i7years.com/blog/Java8 VM MetaSpace.png" alt="Java8 VM MetaSpace"></p><h2 id="ä¸ºä»€ä¹ˆè¦ç§»é™¤PermGen"><a href="#ä¸ºä»€ä¹ˆè¦ç§»é™¤PermGen" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç§»é™¤PermGen"></a>ä¸ºä»€ä¹ˆè¦ç§»é™¤PermGen</h2><blockquote><p>æ¥æºï¼š<a href="http://openjdk.java.net/jeps/122" target="_blank" rel="noopener">http://openjdk.java.net/jeps/122</a></p></blockquote><p>Jon Masamitsu å¯¹æ­¤çš„è§£é‡Šå¦‚ä¸‹ï¼š</p><blockquote><p>A goal for removing perm gen was so that users do not have to think about correctly sizing it.</p><p>Set MetaspaceSize to a value larger than the default, if you know that your applications needs more space for class data. Setting it to a larger size will avoid some number of GCâ€™s at startup. It is not necessary and I do not particularly recommend it unless you want to avoid as many GCâ€™s as possible.</p><p>Set MaxMetaspaceSize if you want to limit the space for class data. You might want to do this if you suspect you are leaking classloaders and want the application to stop before it uses up too much native memory. Another case might be where you have multiple applications running on a server and you want to limit how much space each uses for class data.</p></blockquote><p>PermGenç©ºé—´çš„å¤§å°åœ¨JVMå¯åŠ¨æ—¶å°±å·²ç»åˆ†é…å¥½äº†ï¼Œä½†æ˜¯éšç€åŠ¨æ€ç±»åŠ è½½çš„æƒ…å†µè¶Šæ¥è¶Šå¤šï¼Œå¦‚æœè®¾ç½®çš„å¤ªå°ï¼Œåˆ™å®¹æ˜“å‡ºç°OOMçš„å¼‚å¸¸ï¼Œè®¾ç½®çš„å¤ªå¤§ï¼Œåˆ™å®¹æ˜“é€ æˆç©ºé—´æµªè´¹ã€‚</p><p>è€ŒMetaspaceç©ºé—´çš„å®¹é‡åˆ™ä¼šæ ¹æ®åº”ç”¨ç¨‹åºåœ¨è¿è¡Œæ—¶çš„éœ€æ±‚åŠ¨æ€è°ƒæ•´å¤§å°ï¼Œçœå¾—ä¸ºPermGençš„å¤§å°åˆ†é…æ“ç¢äº†å¿ƒã€‚</p><h2 id="æœ‰å“ªäº›å˜åŒ–"><a href="#æœ‰å“ªäº›å˜åŒ–" class="headerlink" title="æœ‰å“ªäº›å˜åŒ–"></a>æœ‰å“ªäº›å˜åŒ–</h2><blockquote><p>æ¥æºï¼š<a href="http://mail.openjdk.java.net/pipermail/hotspot-dev/2012-September/006679.html" target="_blank" rel="noopener">http://mail.openjdk.java.net/pipermail/hotspot-dev/2012-September/006679.html</a></p></blockquote><h5 id="PermGen-æƒ…å†µ"><a href="#PermGen-æƒ…å†µ" class="headerlink" title="PermGen æƒ…å†µ"></a>PermGen æƒ…å†µ</h5><ul><li>PermGen è¢«å®Œå…¨ç§»é™¤ï¼Œå¯¹åº”çš„æ§åˆ¶å‚æ•° <code>PermSize</code> å’Œ <code>MaxPermSize</code> ä¹Ÿå˜å¾—æ— æ•ˆã€‚</li></ul><h5 id="Metaspaceå†…å­˜åˆ†é…æ¨¡å‹"><a href="#Metaspaceå†…å­˜åˆ†é…æ¨¡å‹" class="headerlink" title="Metaspaceå†…å­˜åˆ†é…æ¨¡å‹"></a>Metaspaceå†…å­˜åˆ†é…æ¨¡å‹</h5><ul><li><p>ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ï¼ˆmetadataï¼‰ä¸å†æ˜¯å­˜å‚¨åœ¨è¿ç»­çš„å †ç©ºé—´ä¸Šï¼Œè€Œæ˜¯ç§»åŠ¨åˆ°å«åšâ€œMetaspaceâ€çš„æœ¬åœ°å†…å­˜ï¼ˆNative memoryï¼‰ä¸­ã€‚PermGenä¸­å‰©ä¸‹çš„ä¸€äº›æ‚é¡¹æ•°æ®å·²ç§»è‡³Java Heapä¸­ã€‚</p></li><li><p>ç”¨äºæè¿°ç±»å…ƒæ•°æ®çš„ç±»(klasses)å·²è¢«åˆ é™¤ï¼ˆklassKlassåŠå…¶æ´¾ç”Ÿç±»ï¼‰ã€‚</p></li></ul><h5 id="Metaspaceç©ºé—´å®¹é‡"><a href="#Metaspaceç©ºé—´å®¹é‡" class="headerlink" title="Metaspaceç©ºé—´å®¹é‡"></a>Metaspaceç©ºé—´å®¹é‡</h5><ul><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œç±»å…ƒæ•°æ®åˆ†é…å—åˆ°å¯ç”¨çš„æœ¬æœºå†…å­˜æ€»å®¹é‡çš„é™åˆ¶ï¼ˆå®¹é‡ä¾ç„¶å–å†³äºä½ ä½¿ç”¨32ä½JVMè¿˜æ˜¯64ä½æ“ä½œç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜çš„å¯ç”¨æ€§ï¼‰ã€‚</li><li>å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ–°çš„å‚æ•° (<code>MaxMetaspaceSize</code>)æ¥é™åˆ¶ç”¨äºç±»å…ƒæ•°æ®çš„æœ¬åœ°å†…å­˜ã€‚å¦‚æœæ²¡æœ‰ç‰¹åˆ«æŒ‡å®šï¼Œå…ƒç©ºé—´å°†ä¼šæ ¹æ®åº”ç”¨ç¨‹åºåœ¨è¿è¡Œæ—¶çš„éœ€æ±‚åŠ¨æ€è°ƒæ•´å¤§å°ã€‚</li></ul><h5 id="Metaspaceåƒåœ¾å›æ”¶"><a href="#Metaspaceåƒåœ¾å›æ”¶" class="headerlink" title="Metaspaceåƒåœ¾å›æ”¶"></a>Metaspaceåƒåœ¾å›æ”¶</h5><ul><li>å½“class metadataçš„ä½¿ç”¨çš„å†…å­˜è¾¾åˆ°<code>MetaspaceSize</code>(32ä½clientVMé»˜è®¤12Mbytesï¼Œ32ä½ServerVMé»˜è®¤æ˜¯16Mbytes)æ—¶å°±ä¼šå¯¹æ­»äº¡çš„ç±»åŠ è½½å™¨å’Œç±»è¿›è¡Œåƒåœ¾æ”¶é›†ã€‚ è®¾ç½®<code>MetaspaceSize</code>ä¸ºä¸€ä¸ªè¾ƒé«˜çš„å€¼å¯ä»¥æ¨è¿Ÿåƒåœ¾æ”¶é›†çš„å‘ç”Ÿã€‚</li><li>ä¸ºäº†é™åˆ¶åƒåœ¾å›æ”¶çš„é¢‘ç‡å’Œå»¶è¿Ÿï¼Œé€‚å½“çš„ç›‘æ§å’Œè°ƒä¼˜å…ƒç©ºé—´æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚å…ƒç©ºé—´è¿‡å¤šçš„åƒåœ¾æ”¶é›†å¯èƒ½è¡¨ç¤ºç±»åŠ è½½å™¨å†…å­˜æ³„æ¼æˆ–å¯¹ä½ çš„åº”ç”¨ç¨‹åºæ¥è¯´ç©ºé—´å¤ªå°äº†ã€‚</li></ul><h5 id="Java-Heapå½±å“"><a href="#Java-Heapå½±å“" class="headerlink" title="Java Heapå½±å“"></a>Java Heapå½±å“</h5><ul><li>ä¸€äº›æ‚ä¹±çš„æ•°æ®ä»PermGenç§»åˆ°äº†Java Heapï¼Œè¿™æ„å‘³ç€å‡çº§åˆ°JDK8ä¹‹åï¼ŒJava Heapçš„å¤§å°ä¼šæœ‰æ˜æ˜¾çš„å¢åŠ ã€‚</li></ul><h2 id="Metaspaceçš„ç»„æˆ"><a href="#Metaspaceçš„ç»„æˆ" class="headerlink" title="Metaspaceçš„ç»„æˆ"></a>Metaspaceçš„ç»„æˆ</h2><blockquote><p>æ¥æºï¼š<a href="http://lovestblog.cn/blog/2016/10/29/metaspace/" target="_blank" rel="noopener">http://lovestblog.cn/blog/2016/10/29/metaspace/</a></p></blockquote><h3 id="ç»„æˆ"><a href="#ç»„æˆ" class="headerlink" title="ç»„æˆ"></a>ç»„æˆ</h3><ul><li>Klass Metaspace</li><li>NoKlass Metaspace</li></ul><h3 id="ç»„æˆè¯´æ˜"><a href="#ç»„æˆè¯´æ˜" class="headerlink" title="ç»„æˆè¯´æ˜"></a>ç»„æˆè¯´æ˜</h3><ul><li>Klass Metaspaceå°±æ˜¯ç”¨æ¥å­˜klassçš„ï¼Œklassæ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„classæ–‡ä»¶åœ¨jvmé‡Œçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ï¼Œä¸è¿‡æœ‰ç‚¹è¦æçš„æ˜¯æˆ‘ä»¬çœ‹åˆ°çš„ç±»ä¼¼A.classå…¶å®æ˜¯å­˜åœ¨heapé‡Œçš„ï¼Œæ˜¯java.lang.Classçš„ä¸€ä¸ªå¯¹è±¡å®ä¾‹ã€‚è¿™å—å†…å­˜æ˜¯ç´§æ¥ç€Heapçš„ï¼Œå’Œæˆ‘ä»¬ä¹‹å‰çš„permä¸€æ ·ï¼Œè¿™å—å†…å­˜å¤§å°å¯é€šè¿‡<code>-XX:CompressedClassSpaceSize</code>å‚æ•°æ¥æ§åˆ¶ï¼Œè¿™ä¸ªå‚æ•°é»˜è®¤æ˜¯1Gï¼Œä½†æ˜¯è¿™å—å†…å­˜ä¹Ÿå¯ä»¥æ²¡æœ‰ï¼Œå‡å¦‚æ²¡æœ‰å¼€å¯å‹ç¼©æŒ‡é’ˆå°±ä¸ä¼šæœ‰è¿™å—å†…å­˜ï¼Œè¿™ç§æƒ…å†µä¸‹klasséƒ½ä¼šå­˜åœ¨NoKlass Metaspaceé‡Œï¼Œå¦å¤–å¦‚æœæˆ‘ä»¬æŠŠ-Xmxè®¾ç½®å¤§äº32Gçš„è¯ï¼Œå…¶å®ä¹Ÿæ˜¯æ²¡æœ‰è¿™å—å†…å­˜çš„ï¼Œå› ä¸ºä¼šè¿™ä¹ˆå¤§å†…å­˜ä¼šå…³é—­å‹ç¼©æŒ‡é’ˆå¼€å…³ã€‚è¿˜æœ‰å°±æ˜¯è¿™å—å†…å­˜æœ€å¤šåªä¼šå­˜åœ¨ä¸€å—ã€‚</li><li>NoKlass Metaspaceä¸“é—¨æ¥å­˜klassç›¸å…³çš„å…¶ä»–çš„å†…å®¹ï¼Œæ¯”å¦‚methodï¼ŒconstantPoolç­‰ï¼Œè¿™å—å†…å­˜æ˜¯ç”±å¤šå—å†…å­˜ç»„åˆèµ·æ¥çš„ï¼Œæ‰€ä»¥å¯ä»¥è®¤ä¸ºæ˜¯ä¸è¿ç»­çš„å†…å­˜å—ç»„æˆçš„ã€‚è¿™å—å†…å­˜æ˜¯å¿…é¡»çš„ï¼Œè™½ç„¶å«åšNoKlass Metaspaceï¼Œä½†æ˜¯ä¹Ÿå…¶å®å¯ä»¥å­˜klassçš„å†…å®¹ï¼Œä¸Šé¢å·²ç»æåˆ°äº†å¯¹åº”åœºæ™¯ã€‚</li><li>Klass Metaspaceå’ŒNoKlass Mestaspaceéƒ½æ˜¯æ‰€æœ‰classloaderå…±äº«çš„ï¼Œæ‰€ä»¥ç±»åŠ è½½å™¨è¦åˆ†é…å†…å­˜ï¼Œä½†æ˜¯æ¯ä¸ªç±»åŠ è½½å™¨éƒ½æœ‰ä¸€ä¸ªSpaceManagerï¼Œæ¥ç®¡ç†å±äºè¿™ä¸ªç±»åŠ è½½çš„å†…å­˜å°å—ã€‚å¦‚æœKlass Metaspaceç”¨å®Œäº†ï¼Œé‚£å°±ä¼šOOMäº†ï¼Œä¸è¿‡ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šï¼ŒNoKlass Mestaspaceæ˜¯ç”±ä¸€å—å—å†…å­˜æ…¢æ…¢ç»„åˆèµ·æ¥çš„ï¼Œåœ¨æ²¡æœ‰è¾¾åˆ°é™åˆ¶æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œä¼šä¸æ–­åŠ é•¿è¿™æ¡é“¾ï¼Œè®©å®ƒå¯ä»¥æŒç»­å·¥ä½œã€‚</li></ul><h2 id="Metaspaceçš„å‡ ä¸ªå‚æ•°"><a href="#Metaspaceçš„å‡ ä¸ªå‚æ•°" class="headerlink" title="Metaspaceçš„å‡ ä¸ªå‚æ•°"></a>Metaspaceçš„å‡ ä¸ªå‚æ•°</h2><p>å¦‚æœæˆ‘ä»¬è¦æ”¹å˜metaspaceçš„ä¸€äº›è¡Œä¸ºï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šå¯¹å…¶ç›¸å…³çš„ä¸€äº›å‚æ•°åšè°ƒæ•´ï¼Œå› ä¸ºmetaspaceçš„å‚æ•°æœ¬èº«ä¸æ˜¯å¾ˆå¤šï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œå°†æ¶‰åŠåˆ°çš„æ‰€æœ‰å‚æ•°éƒ½åšä¸€ä¸ªä»‹ç»ï¼Œä¹Ÿè®¸å¥½äº›å‚æ•°å¤§å®¶éƒ½æ˜¯æœ‰è¯¯è§£çš„</p><ul><li>UseLargePagesInMetaspace</li><li>InitialBootClassLoaderMetaspaceSize</li><li>MetaspaceSize</li><li>MaxMetaspaceSize</li><li>CompressedClassSpaceSize</li><li>MinMetaspaceExpansion</li><li>MaxMetaspaceExpansion</li><li>MinMetaspaceFreeRatio</li><li>MaxMetaspaceFreeRatio</li></ul><p><strong>UseLargePagesInMetaspace</strong></p><p>é»˜è®¤falseï¼Œè¿™ä¸ªå‚æ•°æ˜¯è¯´æ˜¯å¦åœ¨metaspaceé‡Œä½¿ç”¨LargePageï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä½¿ç”¨4KBçš„page sizeï¼Œè¿™ä¸ªå‚æ•°ä¾èµ–äºUseLargePagesè¿™ä¸ªå‚æ•°å¼€å¯ï¼Œä¸è¿‡è¿™ä¸ªå‚æ•°æˆ‘ä»¬ä¸€èˆ¬ä¸å¼€ã€‚</p><p><strong>InitialBootClassLoaderMetaspaceSize</strong></p><p>64ä½ä¸‹é»˜è®¤4Mï¼Œ32ä½ä¸‹é»˜è®¤2200Kï¼Œmetasapceå‰é¢å·²ç»æåˆ°ä¸»è¦åˆ†äº†ä¸¤å¤§å—ï¼ŒKlass Metaspaceä»¥åŠNoKlass Metaspaceï¼Œè€ŒNoKlass Metaspaceæ˜¯ç”±ä¸€å—å—å†…å­˜ç»„åˆèµ·æ¥çš„ï¼Œè¿™ä¸ªå‚æ•°å†³å®šäº†NoKlass Metaspaceçš„ç¬¬ä¸€ä¸ªå†…å­˜Blockçš„å¤§å°ï¼Œå³2*InitialBootClassLoaderMetaspaceSizeï¼ŒåŒæ—¶ä¸ºbootstrapClassLoaderçš„ç¬¬ä¸€å—å†…å­˜chunkåˆ†é…äº†InitialBootClassLoaderMetaspaceSizeçš„å¤§å°</p><p><strong>MetaspaceSize</strong></p><p>é»˜è®¤20.8Må·¦å³(x86ä¸‹å¼€å¯c2æ¨¡å¼)ï¼Œä¸»è¦æ˜¯æ§åˆ¶metaspaceGCå‘ç”Ÿçš„åˆå§‹é˜ˆå€¼ï¼Œä¹Ÿæ˜¯æœ€å°é˜ˆå€¼ï¼Œä½†æ˜¯è§¦å‘metaspaceGCçš„é˜ˆå€¼æ˜¯ä¸æ–­å˜åŒ–çš„ï¼Œä¸ä¹‹å¯¹æ¯”çš„ä¸»è¦æ˜¯æŒ‡Klass Metaspaceä¸NoKlass Metaspaceä¸¤å—committedçš„å†…å­˜å’Œã€‚</p><p><strong>MaxMetaspaceSize</strong></p><p>é»˜è®¤åŸºæœ¬æ˜¯æ— ç©·å¤§ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯å»ºè®®å¤§å®¶è®¾ç½®è¿™ä¸ªå‚æ•°ï¼Œå› ä¸ºå¾ˆå¯èƒ½ä¼šå› ä¸ºæ²¡æœ‰é™åˆ¶è€Œå¯¼è‡´metaspaceè¢«æ— æ­¢å¢ƒä½¿ç”¨(ä¸€èˆ¬æ˜¯å†…å­˜æ³„æ¼)è€Œè¢«OS Killã€‚è¿™ä¸ªå‚æ•°ä¼šé™åˆ¶metaspace(åŒ…æ‹¬äº†Klass Metaspaceä»¥åŠNoKlass Metaspace)è¢«committedçš„å†…å­˜å¤§å°ï¼Œä¼šä¿è¯committedçš„å†…å­˜ä¸ä¼šè¶…è¿‡è¿™ä¸ªå€¼ï¼Œä¸€æ—¦è¶…è¿‡å°±ä¼šè§¦å‘GCï¼Œè¿™é‡Œè¦æ³¨æ„å’ŒMaxPermSizeçš„åŒºåˆ«ï¼ŒMaxMetaspaceSizeå¹¶ä¸ä¼šåœ¨jvmå¯åŠ¨çš„æ—¶å€™åˆ†é…ä¸€å—è¿™ä¹ˆå¤§çš„å†…å­˜å‡ºæ¥ï¼Œè€ŒMaxPermSizeæ˜¯ä¼šåˆ†é…ä¸€å—è¿™ä¹ˆå¤§çš„å†…å­˜çš„ã€‚</p><p><strong>CompressedClassSpaceSize</strong></p><p>é»˜è®¤1Gï¼Œè¿™ä¸ªå‚æ•°ä¸»è¦æ˜¯è®¾ç½®Klass Metaspaceçš„å¤§å°ï¼Œä¸è¿‡è¿™ä¸ªå‚æ•°è®¾ç½®äº†ä¹Ÿä¸ä¸€å®šèµ·ä½œç”¨ï¼Œå‰ææ˜¯èƒ½å¼€å¯å‹ç¼©æŒ‡é’ˆï¼Œå‡å¦‚-Xmxè¶…è¿‡äº†32Gï¼Œå‹ç¼©æŒ‡é’ˆæ˜¯å¼€å¯ä¸æ¥çš„ã€‚å¦‚æœæœ‰Klass Metaspaceï¼Œé‚£è¿™å—å†…å­˜æ˜¯å’ŒHeapè¿ç€çš„ã€‚</p><p><strong>MinMetaspaceExpansion</strong></p><p>MinMetaspaceExpansionå’ŒMaxMetaspaceExpansionè¿™ä¸¤ä¸ªå‚æ•°æˆ–è®¸å’Œå¤§å®¶è®¤è¯†çš„å¹¶ä¸ä¸€æ ·ï¼Œä¹Ÿè®¸å¾ˆå¤šäººä¼šè®¤ä¸ºè¿™ä¸¤ä¸ªå‚æ•°ä¸å°±æ˜¯å†…å­˜ä¸å¤Ÿçš„æ—¶å€™ï¼Œç„¶åæ‰©å®¹çš„æœ€å°å¤§å°å—ï¼Ÿå…¶å®ä¸ç„¶</p><p>è¿™ä¸¤ä¸ªå‚æ•°å’Œæ‰©å®¹å…¶å®å¹¶æ²¡æœ‰ç›´æ¥çš„å…³ç³»ï¼Œä¹Ÿå°±æ˜¯å¹¶ä¸æ˜¯ä¸ºäº†å¢å¤§committedçš„å†…å­˜ï¼Œè€Œæ˜¯ä¸ºäº†å¢å¤§è§¦å‘metaspace GCçš„é˜ˆå€¼</p><p>è¿™ä¸¤ä¸ªå‚æ•°ä¸»è¦æ˜¯åœ¨æ¯”è¾ƒç‰¹æ®Šçš„åœºæ™¯ä¸‹æ•‘æ€¥ä½¿ç”¨ï¼Œæ¯”å¦‚gcLockeræˆ–è€…<code>should_concurrent_collect</code>çš„ä¸€äº›åœºæ™¯ï¼Œå› ä¸ºè¿™äº›åœºæ™¯ä¸‹æ¥ä¸‹æ¥ä¼šåšä¸€æ¬¡GCï¼Œç›¸ä¿¡åœ¨æ¥ä¸‹æ¥çš„GCä¸­å¯èƒ½ä¼šé‡Šæ”¾ä¸€äº›metaspaceçš„å†…å­˜ï¼Œäºæ˜¯å…ˆä¸´æ—¶æ‰©å¤§ä¸‹metaspaceè§¦å‘GCçš„é˜ˆå€¼ï¼Œè€Œæœ‰äº›å†…å­˜åˆ†é…å¤±è´¥å…¶å®æ­£å¥½æ˜¯å› ä¸ºè¿™ä¸ªé˜ˆå€¼è§¦é¡¶å¯¼è‡´çš„ï¼Œäºæ˜¯å¯ä»¥é€šè¿‡å¢å¤§é˜ˆå€¼æš‚æ—¶ç»•è¿‡å»</p><p>é»˜è®¤332.8Kï¼Œå¢å¤§è§¦å‘metaspace GCé˜ˆå€¼çš„æœ€å°è¦æ±‚ã€‚å‡å¦‚æˆ‘ä»¬è¦æ•‘æ€¥åˆ†é…çš„å†…å­˜å¾ˆå°ï¼Œæ²¡æœ‰è¾¾åˆ°MinMetaspaceExpansionï¼Œä½†æ˜¯æˆ‘ä»¬ä¼šå°†è¿™æ¬¡è§¦å‘metaspace GCçš„é˜ˆå€¼æå‡MinMetaspaceExpansionï¼Œä¹‹æ‰€ä»¥è¦å¤§äºè¿™æ¬¡è¦åˆ†é…çš„å†…å­˜å¤§å°ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢åˆ«çš„çº¿ç¨‹ä¹Ÿæœ‰ç±»ä¼¼çš„è¯·æ±‚è€Œé¢‘ç¹è§¦å‘ç›¸å…³çš„æ“ä½œï¼Œä¸è¿‡å¦‚æœè¦åˆ†é…çš„å†…å­˜è¶…è¿‡äº†MaxMetaspaceExpansionï¼Œé‚£MinMetaspaceExpansionå°†ä¼šæ˜¯è¦åˆ†é…çš„å†…å­˜å¤§å°åŸºç¡€ä¸Šçš„ä¸€ä¸ªå¢é‡</p><p><strong>MaxMetaspaceExpansion</strong></p><p>é»˜è®¤5.2Mï¼Œå¢å¤§è§¦å‘metaspace GCé˜ˆå€¼çš„æœ€å¤§è¦æ±‚ã€‚å‡å¦‚è¯´æˆ‘ä»¬è¦åˆ†é…çš„å†…å­˜è¶…è¿‡äº†MinMetaspaceExpansionä½†æ˜¯ä½äºMaxMetaspaceExpansionï¼Œé‚£å¢é‡æ˜¯MaxMetaspaceExpansionï¼Œå¦‚æœè¶…è¿‡äº†MaxMetaspaceExpansionï¼Œé‚£å¢é‡æ˜¯MinMetaspaceExpansionåŠ ä¸Šè¦åˆ†é…çš„å†…å­˜å¤§å°</p><p>æ³¨ï¼šæ¯æ¬¡åˆ†é…åªä¼šç»™å¯¹åº”çš„çº¿ç¨‹ä¸€æ¬¡æ‰©å±•è§¦å‘metaspace GCé˜ˆå€¼çš„æœºä¼šï¼Œå¦‚æœæ‰©å±•äº†ï¼Œä½†æ˜¯è¿˜ä¸èƒ½åˆ†é…ï¼Œé‚£å°±åªèƒ½ç­‰ç€åšGCäº†</p><p><strong>MinMetaspaceFreeRatio</strong></p><p>MinMetaspaceFreeRatioå’Œä¸‹é¢çš„MaxMetaspaceFreeRatioï¼Œä¸»è¦æ˜¯å½±å“è§¦å‘metaspaceGCçš„é˜ˆå€¼</p><p>é»˜è®¤40ï¼Œè¡¨ç¤ºæ¯æ¬¡GCå®Œä¹‹åï¼Œå‡è®¾æˆ‘ä»¬å…è®¸æ¥ä¸‹æ¥metaspaceå¯ä»¥ç»§ç»­è¢«commitçš„å†…å­˜å åˆ°äº†è¢«commitä¹‹åæ€»å…±committedçš„å†…å­˜é‡çš„MinMetaspaceFreeRatio%ï¼Œå¦‚æœè¿™ä¸ªæ€»å…±è¢«committedçš„é‡æ¯”å½“å‰è§¦å‘metaspaceGCçš„é˜ˆå€¼è¦å¤§ï¼Œé‚£ä¹ˆå°†å°è¯•åšæ‰©å®¹ï¼Œä¹Ÿå°±æ˜¯å¢å¤§è§¦å‘metaspaceGCçš„é˜ˆå€¼ï¼Œä¸è¿‡è¿™ä¸ªå¢é‡è‡³å°‘æ˜¯MinMetaspaceExpansionæ‰ä¼šåšï¼Œä¸ç„¶ä¸ä¼šå¢åŠ è¿™ä¸ªé˜ˆå€¼</p><p>è¿™ä¸ªå‚æ•°ä¸»è¦æ˜¯ä¸ºäº†é¿å…è§¦å‘metaspaceGCçš„é˜ˆå€¼å’Œgcä¹‹åcommittedçš„å†…å­˜çš„é‡æ¯”è¾ƒæ¥è¿‘ï¼Œäºæ˜¯å°†è¿™ä¸ªé˜ˆå€¼è¿›è¡Œæ‰©å¤§</p><p>ä¸€èˆ¬æƒ…å†µä¸‹åœ¨gcå®Œä¹‹åï¼Œå¦‚æœè¢«committedçš„é‡è¿˜æ˜¯æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œæ¢ä¸ªè¯´æ³•å°±æ˜¯ç¦»è§¦å‘metaspaceGCçš„é˜ˆå€¼æ¯”è¾ƒæ¥è¿‘çš„æ—¶å€™ï¼Œè¿™ä¸ªè°ƒæ•´ä¼šæ¯”è¾ƒæ˜æ˜¾</p><p>æ³¨ï¼šè¿™é‡Œä¸ç”¨gcä¹‹åusedçš„é‡æ¥ç®—ï¼Œä¸»è¦æ˜¯æ‹…å¿ƒå¯èƒ½å‡ºç°committedçš„é‡è¶…è¿‡äº†è§¦å‘metaspaceGCçš„é˜ˆå€¼ï¼Œè¿™ç§æƒ…å†µä¸€æ—¦å‘ç”Ÿä¼šå¾ˆå±é™©ï¼Œä¼šä¸æ–­åšgcï¼Œè¿™åº”è¯¥æ˜¯jdk8åœ¨æŸä¸ªç‰ˆæœ¬ä¹‹åæ‰ä¿®å¤çš„bug</p><p><strong>MaxMetaspaceFreeRatio</strong></p><p>é»˜è®¤70ï¼Œè¿™ä¸ªå‚æ•°å’Œä¸Šé¢çš„å‚æ•°åŸºæœ¬æ˜¯ç›¸åçš„ï¼Œæ˜¯ä¸ºäº†é¿å…è§¦å‘metaspaceGCçš„é˜ˆå€¼è¿‡å¤§ï¼Œè€Œæƒ³å¯¹è¿™ä¸ªå€¼è¿›è¡Œç¼©å°ã€‚è¿™ä¸ªå‚æ•°åœ¨gcä¹‹åcommittedçš„å†…å­˜æ¯”è¾ƒå°çš„æ—¶å€™å¹¶ä¸”ç¦»è§¦å‘metaspaceGCçš„é˜ˆå€¼æ¯”è¾ƒè¿œçš„æ—¶å€™ï¼Œè°ƒæ•´ä¼šæ¯”è¾ƒæ˜æ˜¾</p><h2 id="MetaSpace-ä¸-PermGen-è¿è¡Œæ—¶æ¯”è¾ƒ"><a href="#MetaSpace-ä¸-PermGen-è¿è¡Œæ—¶æ¯”è¾ƒ" class="headerlink" title="MetaSpace ä¸ PermGen è¿è¡Œæ—¶æ¯”è¾ƒ"></a>MetaSpace ä¸ PermGen è¿è¡Œæ—¶æ¯”è¾ƒ</h2><p>å‰é¢æåˆ°è¿‡ï¼ŒMetaSpaceä¸PermGenæœ€ä¸»è¦çš„åŒºåˆ«å°±åœ¨äºï¼Œå†…å­˜ç©ºé—´çš„æ˜¯å¦èƒ½å¤Ÿè‡ªåŠ¨æ‰©å®¹ä¸Šï¼Œä¸‹é¢æˆ‘ä»¬æ¥åˆ†åˆ«æ¼”ç¤ºä¸€ä¸‹MetaSpaceä¸PermGençš„GCçš„è¡¨ç°å½¢å¼ä¹‹é—´çš„åŒºåˆ«ã€‚ç¤ºä¾‹ä»£ç  <a href="https://attach.i7years.com/code/Java8_Metaspace.zip" target="_blank" rel="noopener">ä¸‹è½½</a></p><h4 id="JDK-1-7-64-bit-â€“-PermGen-depletion"><a href="#JDK-1-7-64-bit-â€“-PermGen-depletion" class="headerlink" title="JDK 1.7 @64-bit â€“ PermGen depletion"></a>JDK 1.7 @64-bit â€“ PermGen depletion</h4><blockquote><p>æ¼”ç¤ºå¼‚å¸¸ï¼šERROR: java.lang.OutOfMemoryError: PermGen space</p></blockquote><p>VM å‚æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-verbose:gc -Xms1024M -Xmx1024M -XX:MaxPermSize=<span class="number">128</span>m -XX:PermSize=<span class="number">128</span>m -XX:+PrintGCDetails -Xloggc:~/Desktop/gc.log</span><br></pre></td></tr></table></figure><p>JVisualVMç›‘æ§æ˜¾ç¤ºï¼š</p><p><img src="https://img.i7years.com/blog/JVisualVM_1.png" alt="Java8_MetaSpace_1"></p><p>GCæ—¥å¿—ï¼š</p><p><img src="https://img.i7years.com/blog/gc_1.png" alt="gc_1"></p><h4 id="JDK-1-8-64-bit-â€“-Metaspace-dynamic-re-size"><a href="#JDK-1-8-64-bit-â€“-Metaspace-dynamic-re-size" class="headerlink" title="JDK 1.8 @64-bit â€“ Metaspace dynamic re-size"></a>JDK 1.8 @64-bit â€“ Metaspace dynamic re-size</h4><blockquote><p>æ¼”ç¤º metaspace ç©ºé—´ä¸æ–­åŠ¨æ€è°ƒæ•´çš„è¿‡ç¨‹</p></blockquote><p>VM å‚æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-verbose:gc -Xms1024M -Xmx1024M -XX:+PrintGCDetails -Xloggc:~/Desktop/gc.log</span><br></pre></td></tr></table></figure><p>JVisualVMç›‘æ§æ˜¾ç¤ºï¼š</p><p><img src="https://img.i7years.com/blog/JVisualVM_2.png" alt="JVisualVM_2"></p><p>GCæ—¥å¿—ï¼š</p><p><img src="https://img.i7years.com/blog/gc_2.png" alt="gc_2"></p><h4 id="JDK-1-8-64-bit-â€“-Metaspace-depletion"><a href="#JDK-1-8-64-bit-â€“-Metaspace-depletion" class="headerlink" title="JDK 1.8 @64-bit â€“ Metaspace depletion"></a>JDK 1.8 @64-bit â€“ Metaspace depletion</h4><blockquote><p>æ¼”ç¤ºå¼‚å¸¸ï¼šERROR: java.lang.OutOfMemoryError: Metadata space</p></blockquote><p>VM å‚æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-verbose:gc -Xms1024M -Xmx1024M -XX:MaxMetaspaceSize=<span class="number">128</span>m -XX:+PrintGCDetails -Xloggc:~/Desktop/gc.log</span><br></pre></td></tr></table></figure><p>JVisualVMç›‘æ§æ˜¾ç¤ºï¼š</p><p><img src="https://img.i7years.com/blog/JVisualVM_3.png" alt="JVisualVM_3"></p><p>GCæ—¥å¿—ï¼š</p><p><img src="https://img.i7years.com/blog/gc_3.png" alt="gc_3"></p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><p><a href="http://openjdk.java.net/jeps/122" target="_blank" rel="noopener">http://openjdk.java.net/jeps/122</a></p></li><li><p><a href="https://www.infoq.com/news/2013/03/java-8-permgen-metaspace" target="_blank" rel="noopener">https://www.infoq.com/news/2013/03/java-8-permgen-metaspace</a></p></li><li><a href="http://javaeesupportpatterns.blogspot.com/2013/02/java-8-from-permgen-to-metaspace.html" target="_blank" rel="noopener">http://javaeesupportpatterns.blogspot.com/2013/02/java-8-from-permgen-to-metaspace.html</a></li><li><a href="https://dzone.com/articles/java-8-permgen-metaspace" target="_blank" rel="noopener">https://dzone.com/articles/java-8-permgen-metaspace</a></li><li><a href="http://www.infoq.com/cn/articles/Java-PERMGEN-Removed" target="_blank" rel="noopener">http://www.infoq.com/cn/articles/Java-PERMGEN-Removed</a></li><li><a href="http://java-latte.blogspot.com/2014/03/metaspace-in-java-8.html" target="_blank" rel="noopener">http://java-latte.blogspot.com/2014/03/metaspace-in-java-8.html</a></li><li><a href="http://m.www.cnblogs.com/duanxz/p/3520829.html" target="_blank" rel="noopener">http://m.www.cnblogs.com/duanxz/p/3520829.html</a></li><li><a href="https://stackoverflow.com/questions/27131165/what-is-the-difference-between-permgen-and-metaspace" target="_blank" rel="noopener">https://stackoverflow.com/questions/27131165/what-is-the-difference-between-permgen-and-metaspace</a></li><li><a href="http://lovestblog.cn/blog/2016/10/29/metaspace/" target="_blank" rel="noopener">http://lovestblog.cn/blog/2016/10/29/metaspace/</a></li><li><a href="https://juejin.im/entry/5b74fcbf6fb9a0097f0c2a95" target="_blank" rel="noopener">https://juejin.im/entry/5b74fcbf6fb9a0097f0c2a95</a></li><li><a href="https://dzone.com/articles/understanding-the-java-memory-model-and-the-garbag" target="_blank" rel="noopener">https://dzone.com/articles/understanding-the-java-memory-model-and-the-garbag</a></li><li><a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html</a></li><li><a href="http://www.importnew.com/14933.html" target="_blank" rel="noopener">http://www.importnew.com/14933.html</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> JVM </tag>
            
            <tag> Java8 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Java7 HotSpot(TM) VMå†…å­˜æ¨¡å‹]]></title>
      <url>/posts/java7-jvm-memory-model.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/pexels-photo-1532704.jpeg" alt="pexels-photo-1532704"></p><p>æœ¬æ–‡æˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹ Java7 HotSpot(TM) VM å†…å­˜æ¨¡å‹ã€‚</p><a id="more"></a><h2 id="JVM-Architecture"><a href="#JVM-Architecture" class="headerlink" title="JVM Architecture"></a>JVM Architecture</h2><p><img src="https://img.i7years.com/blog/JVM%20Architecture.png" alt="JVM Architecture"></p><p>æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹JVMçš„æ•´ä½“æ¶æ„ä½“ç³»ï¼ŒJVMä¸»è¦åˆ†ä¸‰å¤§å­ç³»ç»Ÿï¼šClass Loader SubSystemã€Runtime Data Areaã€Execution Engine ã€‚</p><h4 id="Class-Loader-SubSystem"><a href="#Class-Loader-SubSystem" class="headerlink" title="Class Loader SubSystem"></a>Class Loader SubSystem</h4><p>Javaçš„åŠ¨æ€ç±»åŠ è½½åŠŸèƒ½ç”±ç±»åŠ è½½å™¨å­ç³»ç»Ÿå¤„ç†ã€‚ å®ƒåœ¨<strong>è¿è¡Œæ—¶</strong>ç¬¬ä¸€æ¬¡å¼•ç”¨ç±»æ—¶åŠ è½½ï¼Œé“¾æ¥å’Œåˆå§‹åŒ–ç±»ï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶å¼•ç”¨ã€‚ å®ƒæ‰§è¡Œä¸‰ä¸ªä¸»è¦åŠŸèƒ½ï¼Œå¦‚åŠ è½½ï¼Œé“¾æ¥å’Œåˆå§‹åŒ–ã€‚</p><h4 id="Execution-Engine"><a href="#Execution-Engine" class="headerlink" title="Execution Engine"></a>Execution Engine</h4><p>è¢«åˆ†é…ç»™è¿è¡Œæ—¶æ•°æ®åŒºåŸŸä¸­çš„å­—èŠ‚ç å°†è¢«æ‰§è¡Œå¼•æ“æ¥æ‰§è¡Œã€‚ æ‰§è¡Œå¼•æ“è¯»å–å­—èŠ‚ä»£ç å¹¶æŒ¨ä¸ªæŒ¨ä¸ªæ‰§è¡Œã€‚</p><p>æœ¬ç¯‡å°†é‡ç‚¹ä»‹ç» Rumtime Date Areaï¼Œè‡³äºClass Loader SubSystemå’ŒExecution Engineå°†æ”¾åœ¨åæœŸçš„æ–‡ç« ä¸­å»è®²è§£ã€‚</p><h2 id="Runtime-Data-Area"><a href="#Runtime-Data-Area" class="headerlink" title="Runtime Data Area"></a>Runtime Data Area</h2><p>Javaè™šæ‹Ÿæœºå®šä¹‰äº†åœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´ä½¿ç”¨çš„å„ç§è¿è¡Œæ—¶æ•°æ®åŒºåŸŸã€‚ å…¶ä¸­ä¸€äº›æ•°æ®åŒºåŸŸæ˜¯éšç€Javaè™šæ‹Ÿæœºå¯åŠ¨è€Œåˆ›å»ºï¼Œéšç€Javaè™šæ‹Ÿæœºé€€å‡ºè€Œé”€æ¯ã€‚å…¶ä»–æ•°æ®åŒºåŸŸåˆ™æ˜¯ä¾é™„äºæ¯ä¸ªå•ç‹¬çš„çº¿ç¨‹ï¼Œå®ƒä»¬éšç€çº¿ç¨‹åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹ çš„é€€å‡ºè€Œé”€æ¯ã€‚</p><p>è¿è¡Œæ—¶æ•°æ®åŒºï¼Œæ˜¯JVMå†…å­˜ç®¡ç†çš„ä¸»è¦åŒºåŸŸã€‚Javaè™šæ‹Ÿæœºåœ¨ç¨‹åºæ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¼šæŠŠå®ƒæ‰€ç®¡ç†çš„å†…å­˜åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªä¸åŒçš„æ•°æ®åŒºåŸŸã€‚ä¸»è¦åˆ†ä¸ºï¼š</p><ul><li>Program Counter Registerï¼šç¨‹åºè®¡æ•°å™¨</li><li>Java Virtual Machine Stacksï¼šJavaè™šæ‹Ÿæœºæ ˆ</li><li>Native Method Stackï¼šæœ¬åœ°æ–¹æ³•æ ˆ</li><li>Java Heapï¼šJavaå †</li><li>Method Areaï¼šæ–¹æ³•åŒº</li></ul><p><img src="https://img.i7years.com/blog/JVM_Internal_Architecture.png" alt="Runtime Data Area"></p><h3 id="æ§åˆ¶å‚æ•°"><a href="#æ§åˆ¶å‚æ•°" class="headerlink" title="æ§åˆ¶å‚æ•°"></a>æ§åˆ¶å‚æ•°</h3><p>æ¯ä¸ªåŒºåŸŸçš„å†…å­˜å¤§å°å¯ä»¥é€šè¿‡ä»¥ä¸‹å‚æ•°è¿›è¡Œåˆ†é…</p><p><img src="https://img.i7years.com/blog/Runtime%20Date%20Area%20Allocation.png" alt="Runtime data area allocation"></p><p>æ§åˆ¶å‚æ•°ï¼š</p><ul><li><code>-Xms</code> è®¾ç½®å †çš„æœ€å°ç©ºé—´å¤§å°ã€‚</li><li><code>-Xmx</code> è®¾ç½®å †çš„æœ€å¤§ç©ºé—´å¤§å°ã€‚</li><li><code>-XX:NewSize</code> è®¾ç½®æ–°ç”Ÿä»£æœ€å°ç©ºé—´å¤§å°ã€‚</li><li><code>-XX:MaxNewSize</code> è®¾ç½®æ–°ç”Ÿä»£æœ€å¤§ç©ºé—´å¤§å°ã€‚</li><li><code>-XX:PermSize</code> è®¾ç½®æ°¸ä¹…ä»£æœ€å°ç©ºé—´å¤§å°ã€‚</li><li><code>-XX:MaxPermSize</code> è®¾ç½®æ°¸ä¹…ä»£æœ€å¤§ç©ºé—´å¤§å°ã€‚</li><li><code>-Xss</code> è®¾ç½®æ¯ä¸ªçº¿ç¨‹çš„å †æ ˆå¤§å°ã€‚</li></ul><h3 id="å†…å­˜åˆ†é…æŸ¥è¯¢"><a href="#å†…å­˜åˆ†é…æŸ¥è¯¢" class="headerlink" title="å†…å­˜åˆ†é…æŸ¥è¯¢"></a>å†…å­˜åˆ†é…æŸ¥è¯¢</h3><p>å¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥è¯¢å„ä¸ªæ“ä½œç³»ç»Ÿé»˜è®¤åˆ†é…çš„å†…å­˜å¤§å°ï¼š</p><p><strong>Ubuntu &amp; RedHat</strong>ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -XX:+PrintFlagsFinal -version | grep -iE <span class="string">'HeapSize|PermSize|ThreadStackSize'</span></span><br></pre></td></tr></table></figure><p><strong>Windows</strong>ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; java -XX:+PrintFlagsFinal -version | findstr /i <span class="string">"HeapSize PermSize ThreadStackSize"</span></span><br></pre></td></tr></table></figure><p><strong>MacOS</strong>ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -XX:+PrintFlagsFinal -version | grep -iE <span class="string">'heapsize|permsize|threadstacksize'</span></span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œæˆ‘çš„Macè¿”å›ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    uintx AdaptivePermSizeWeight                    = <span class="number">20</span>              &#123;product&#125;</span><br><span class="line">     intx CompilerThreadStackSize                   = <span class="number">0</span>               &#123;pd product&#125;</span><br><span class="line">    uintx ErgoHeapSizeLimit                         = <span class="number">0</span>               &#123;product&#125;</span><br><span class="line">    uintx HeapSizePerGCThread                       = <span class="number">87241520</span>        &#123;product&#125;</span><br><span class="line">    uintx InitialHeapSize                          := <span class="number">134217728</span>       &#123;product&#125;</span><br><span class="line">    uintx LargePageHeapSizeThreshold                = <span class="number">134217728</span>       &#123;product&#125;</span><br><span class="line">    uintx MaxHeapSize                              := <span class="number">2147483648</span>      &#123;product&#125;</span><br><span class="line">    uintx MaxPermSize                               = <span class="number">85983232</span>        &#123;pd product&#125;</span><br><span class="line">    uintx PermSize                                  = <span class="number">21757952</span>        &#123;pd product&#125;</span><br><span class="line">     intx ThreadStackSize                           = <span class="number">1024</span>            &#123;pd product&#125;</span><br><span class="line">     intx VMThreadStackSize                         = <span class="number">1024</span>            &#123;pd product&#125;</span><br><span class="line">java version <span class="string">"1.7.0_72"</span></span><br><span class="line">Java(TM) SE Runtime Environment (build <span class="number">1.7</span>.<span class="number">0</span>_72-b14)</span><br><span class="line">Java HotSpot(TM) <span class="number">64</span>-Bit Server VM (build <span class="number">24.72</span>-b04, mixed mode)</span><br></pre></td></tr></table></figure><h2 id="Program-Counter-Register"><a href="#Program-Counter-Register" class="headerlink" title="Program Counter Register"></a>Program Counter Register</h2><ul><li>å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·è§£é‡Šå™¨ã€‚å­—èŠ‚ç è§£é‡Šå™¨å·¥ä½œæ—¶å°±æ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŸºç¡€åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆã€‚</li><li>æ­¤ä¸ºçº¿ç¨‹çš„ç§æœ‰å†…å­˜åŒºåŸŸã€‚ä»»ä½•ä¸€ä¸ªç¡®å®šçš„æ—¶åˆ»ï¼Œä¸€ä¸ªå¤„ç†å™¨æˆ–è€…å†…æ ¸ï¼Œéƒ½åªä¼šæ‰§è¡Œä¸€æ¡çº¿ç¨‹ä¸­çš„æŒ‡ä»¤ï¼Œä¸ºäº†ç¡®ä¿çº¿ç¨‹åˆ‡æ¢åè¿˜èƒ½å›åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ï¼Œå„ä¸ªçº¿ç¨‹ä¹‹é—´è®¡æ•°å™¨äº’ä¸å½±å“ï¼Œç‹¬ç«‹å­˜å‚¨ã€‚</li><li>æ­¤å†…å­˜åŒºåŸŸæ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­æ²¡æœ‰è§„å®šä»»ä½•OutOfMemoryErroræƒ…å†µçš„åŒºåŸŸã€‚</li></ul><h2 id="Java-Virtual-Machine-Stack"><a href="#Java-Virtual-Machine-Stack" class="headerlink" title="Java Virtual Machine Stack"></a>Java Virtual Machine Stack</h2><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><ul><li>çº¿ç¨‹ç§æœ‰ï¼Œç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹çš„ä¸€è‡´ã€‚</li><li>è™šæ‹Ÿæœºæ ˆæè¿°çš„æ˜¯Javaæ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ï¼šæ¯ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œçš„åŒæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ª<strong>æ ˆå¸§ï¼ˆStack Frameï¼‰</strong>ç”¨äºå­˜å‚¨<strong>å±€éƒ¨å˜é‡è¡¨</strong>ã€<strong>æ“ä½œæ•°æ ˆ</strong>ã€<strong>åŠ¨æ€é“¾æ¥</strong>ã€<strong>æ–¹æ³•å‡ºå£</strong>ç­‰ä¿¡æ¯ã€‚æ¯ä¸€ä¸ªæ–¹æ³•ä»è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆä¸­å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹ã€‚</li><li><strong>å±€éƒ¨å˜é‡è¡¨</strong>å­˜æ”¾äº†ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆbooleanã€byteã€charã€shortã€intã€floatã€longã€doubleï¼‰ã€å¯¹è±¡å¼•ç”¨ï¼ˆreferenceç±»å‹ï¼Œå®ƒä¸ç­‰åŒäºå¯¹è±¡æœ¬èº«ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡èµ·å§‹åœ°å€çš„å¼•ç”¨æŒ‡é’ˆï¼Œä¹Ÿå¯èƒ½æ˜¯æŒ‡å‘ä¸€ä¸ªä»£è¡¨å¯¹è±¡çš„å¥æŸ„æˆ–å…¶ä»–ä¸æ­¤å¯¹è±¡ç›¸å…³çš„ä½ç½®ï¼‰å’ŒreturnAddressç±»å‹ï¼ˆæŒ‡å‘äº†ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼‰ã€‚</li><li>å±€éƒ¨å˜é‡è¡¨æ‰€éœ€çš„å†…å­˜ç©ºé—´åœ¨<strong>ç¼–è¯‘æœŸé—´å®Œæˆåˆ†é…</strong>ï¼Œå½“è¿›å…¥ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•éœ€è¦åœ¨å¸§ä¸­åˆ†é…å¤šå¤§çš„å±€éƒ¨å˜é‡ç©ºé—´æ˜¯å®Œå…¨ç¡®å®šçš„ï¼Œåœ¨æ–¹æ³•è¿è¡ŒæœŸé—´ä¸ä¼šæ”¹å˜å±€éƒ¨å˜é‡è¡¨çš„å¤§å°ã€‚</li></ul><h4 id="å¤§å°è®¾ç½®"><a href="#å¤§å°è®¾ç½®" class="headerlink" title="å¤§å°è®¾ç½®"></a>å¤§å°è®¾ç½®</h4><p>Javaè™šæ‹Ÿæœºæ ˆçš„é»˜è®¤å¤§å°ä¸è¿è¡Œçš„æ“ä½œç³»ç»Ÿæœ‰å…³ï¼š</p><table><thead><tr><th>Platform</th><th>Default</th></tr></thead><tbody><tr><td>Windows IA32</td><td>64 KB</td></tr><tr><td>Linux IA32</td><td>128 KB</td></tr><tr><td>Windows x86_64</td><td>128 KB</td></tr><tr><td>Linux x86_64</td><td>256 KB</td></tr><tr><td>Windows IA64</td><td>320 KB</td></tr><tr><td>Linux IA64</td><td>1024 KB (1 MB)</td></tr><tr><td>Solaris Sparc</td><td>512 KB</td></tr></tbody></table><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>-Xss&lt;size&gt;</code> æ¥è®¾ç½®Javaè™šæ‹Ÿæœºæ ˆå¤§å°ï¼Œä¾‹å¦‚ï¼š-Xss128kï¼Œåˆ™å¤§å°ä¸º128kã€‚</p><h4 id="å¼‚å¸¸"><a href="#å¼‚å¸¸" class="headerlink" title="å¼‚å¸¸"></a>å¼‚å¸¸</h4><h5 id="StackOverflowError"><a href="#StackOverflowError" class="headerlink" title="StackOverflowError"></a>StackOverflowError</h5><p>å¦‚æœçº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„æ·±åº¦ï¼Œå°†æŠ›å‡ºStackOverflowErrorå¼‚å¸¸ã€‚</p><p>å¦‚ä¸‹ä¾‹å­ï¼Œé€šè¿‡é™åˆ¶è™šæ‹Ÿæœºæ ˆçš„å¤§å°ï¼Œå¹¶äº§ç”Ÿå¤§é‡çš„å±€éƒ¨å˜é‡ï¼Œä»¥æ­¤æ¥å¢åŠ æ­¤æ–¹æ³•å¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨é•¿åº¦ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.thinkingjava;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * VM args: -Xss:200k</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaVMStackSOF</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> stackLength = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stackLeak</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        stackLength++;</span><br><span class="line">        stackLeak();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        JavaVMStackSOF oom = <span class="keyword">new</span> JavaVMStackSOF();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            oom.stackLeak();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"stack length:"</span> + oom.stackLength);</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†…å®¹è¾“å‡ºï¼š</span></span><br><span class="line">Exception in thread <span class="string">"main"</span> java.lang.StackOverflowError</span><br><span class="line">stack length:<span class="number">1239</span></span><br><span class="line">	at com.thinkingjava.JavaVMStackSOF.stackLeak(JavaVMStackSOF.java:<span class="number">11</span>)</span><br><span class="line">	at com.thinkingjava.JavaVMStackSOF.stackLeak(JavaVMStackSOF.java:<span class="number">12</span>)</span><br><span class="line"></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>åœ¨å•çº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œæ— è®ºæ˜¯æ ˆå®¹é‡å¤ªå¤§ï¼Œè¿˜æ˜¯è™šæ‹Ÿæœºå†…å­˜å¤ªå°ï¼Œå½“å†…å­˜æ— æ³•åˆ†é…æ—¶ï¼Œéƒ½ä¼šæŠ›å‡ºStackOverflowErrorå¼‚å¸¸ã€‚</p><h5 id="OutOfMemoryError"><a href="#OutOfMemoryError" class="headerlink" title="OutOfMemoryError"></a>OutOfMemoryError</h5><p>å¦‚æœè™šæ‹Ÿæœºæ ˆå¯ä»¥åŠ¨æ€æ‰©å±•ï¼ˆå½“å‰å¤§éƒ¨åˆ†çš„Javaè™šæ‹Ÿæœºéƒ½å¯åŠ¨æ€æ‰©å±•ï¼Œåªä¸è¿‡Javaè™šæ‹Ÿæœºè§„èŒƒä¸­ä¹Ÿå…è®¸å›ºå®šé•¿åº¦çš„è™šæ‹Ÿæœºæ ˆï¼‰ï¼Œå¦‚æœæ‰©å±•æ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ï¼Œå°±ä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ ˆå†…å­˜å¤§å° = è¿›ç¨‹çš„å†…å­˜å¤§å° - å †å†…å­˜å¤§å°(-Xmx) - æ–¹æ³•åŒºå†…å­˜å¤§å°(-XX:MaxPermSize)</span><br></pre></td></tr></table></figure><p>ç”±äºæ“ä½œç³»ç»Ÿç»™æ¯ä¸€ä¸ªè¿›ç¨‹çš„å†…å­˜æ˜¯æœ‰é™åˆ¶ï¼Œé™¤å»Javaå †å†…å­˜å¤§å°ï¼ˆXmxï¼‰å’Œæ–¹æ³•åŒºçš„å†…å­˜å¤§å°ï¼ˆMaxPermSizeï¼‰ï¼Œå‰©ä½™çš„å†…å®¹å°±å½’Javaè™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆåˆ†é…äº†ï¼Œæ¯ä¸ªçº¿ç¨‹å¯åˆ†é…çš„æ ˆå®¹é‡è¶Šå¤§ï¼Œé‚£ä¹ˆæ‰€èƒ½å¤Ÿäº§ç”Ÿçš„çº¿ç¨‹æ•°åˆ™è¶Šå°‘ã€‚å»ºç«‹çº¿ç¨‹è¶Šå¤šï¼Œåˆ™è¶Šå®¹æ˜“æŠŠå†…å­˜æ¶ˆè€—æ‰ã€‚</p><p>å¦‚æœæ˜¯å»ºç«‹è¿‡å¤šçº¿ç¨‹å¯¼è‡´çš„å†…å­˜æº¢å‡ºï¼Œåœ¨ä¸èƒ½å‡å°‘çº¿ç¨‹æ•°æˆ–è€…æ›´æ¢64ä½è™šæ‹Ÿæœºçš„æƒ…å†µä¸‹ï¼Œå°±åªèƒ½é€šè¿‡å‡å°‘æœ€å¤§å †å’Œå‡å°‘æ ˆå®¹é‡æ¥æ¢å–æ›´å¤šçš„çº¿ç¨‹ã€‚</p><p>å¦‚ä¸‹ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.thinkingjava;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaVMStackOOM</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            System.out.println(++count);</span><br><span class="line">            <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">10000000</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="number">2032</span></span><br><span class="line">    </span><br><span class="line">Exception in thread <span class="string">"main"</span> java.lang.OutOfMemoryError: unable to create <span class="keyword">new</span> <span class="keyword">native</span> thread</span><br><span class="line">	at java.lang.Thread.start0(Native Method)</span><br><span class="line">	at java.lang.Thread.start(Thread.java:<span class="number">714</span>)</span><br><span class="line">	at com.thinkingjava.JavaVMStackOOM.main(JavaVMStackOOM.java:<span class="number">12</span>)</span><br></pre></td></tr></table></figure><h2 id="Native-Method-Stack"><a href="#Native-Method-Stack" class="headerlink" title="Native Method Stack"></a>Native Method Stack</h2><ul><li>æœ¬åœ°æ–¹æ³•æ ˆä¸Javaè™šæ‹Ÿæœºæ ˆç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äº Javaè™šæ‹Ÿæœºæ ˆä¸ºJavaæ–¹æ³•æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆä¸ºNativeæ–¹æ³•æœåŠ¡ã€‚</li><li>ä¸è™šæ‹Ÿæœºæ ˆä¸€æ ·ï¼Œæœ¬åœ°æ–¹æ³•æ ˆåŒºåŸŸä¹Ÿä¼šæŠ›å‡ºStackOverflowErrorå’ŒOutOfMemoryErrorå¼‚å¸¸ã€‚</li></ul><h2 id="Java-Heap"><a href="#Java-Heap" class="headerlink" title="Java Heap"></a>Java Heap</h2><p>Javaå †ï¼ˆJava Heapï¼‰ä¸»è¦ç”¨äºæ‰€æœ‰<strong>å¯¹è±¡å®ä¾‹ä¸æ•°ç»„</strong>çš„åˆ†é…ï¼Œæ˜¯Javaè™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜å½“ä¸­æœ€å¤§çš„ä¸€å—ã€‚</p><blockquote><p>éšç€JITç¼–è¯‘å™¨çš„å‘å±•ä¸é€ƒé€¸åˆ†ææŠ€æœ¯é€æ¸æˆç†Ÿï¼Œæ ˆä¸Šåˆ†é…ã€æ ‡é‡æ›¿æ¢ä¼˜åŒ–æŠ€æœ¯å°†ä¼šå¯¼è‡´ä¸€äº›å¾®å¦™çš„å˜åŒ–å‘ç”Ÿï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½åˆ†é…åœ¨å †ä¸Šä¹Ÿæ¸æ¸å˜å¾—ä¸æ˜¯é‚£ä¹ˆâ€œç»å¯¹â€äº†ã€‚</p></blockquote><p>Javaå †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œå› æ­¤å¾ˆå¤šæ—¶å€™ä¹Ÿè¢«ç§°åšâ€œGCå †â€ï¼ˆGarbage Collected Heapï¼‰ã€‚</p><p>Javaå †ç©ºé—´å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><strong>Young Generation</strong>ï¼ˆæ–°ç”Ÿä»£ï¼‰ï¼šæ˜¯æ‰€æœ‰æ–°å¯¹è±¡åˆ†é…å’Œè€åŒ–çš„åœ°æ–¹<ul><li><strong>Eden Space</strong>ï¼ˆä¼Šç”¸åŒºï¼‰ï¼šæœ€åˆä¸ºå¤§å¤šæ•°å¯¹è±¡åˆ†é…å†…å­˜çš„åœ°æ–¹</li><li><strong>Survivor Space</strong>ï¼ˆå¹¸å­˜è€…åŒºï¼‰ï¼šEden Spaceè¿›è¡ŒMinor GCåå¹¸å­˜ä¸‹æ¥çš„å¯¹è±¡å­˜æ”¾çš„åœ°æ–¹</li></ul></li><li><strong>Tenured/Old Generation</strong>ï¼ˆè€å¹´ä»£ï¼‰ï¼šSurvivor Spaceè¿›è¡ŒMajor GCåå¹¸å­˜ä¸‹æ¥çš„å¯¹è±¡å­˜æ”¾çš„åœ°æ–¹</li></ul><p><img src="https://img.i7years.com/blog/Java_Heap.png" alt="Java_Heap"></p><h3 id="å¼‚å¸¸-1"><a href="#å¼‚å¸¸-1" class="headerlink" title="å¼‚å¸¸"></a>å¼‚å¸¸</h3><p>å¦‚æœåœ¨å †ä¸­æ²¡æœ‰å†…å­˜å®Œæˆå®ä¾‹åˆ†é…æ—¶ï¼Œå¹¶ä¸”å †å†ä¹Ÿæ— æ³•æ‰©å±•æ—¶ï¼Œå°†ä¼šæŠ›å‡º OOM å¼‚å¸¸ã€‚</p><blockquote><p>å°†å †çš„æœ€å°å€¼-Xmså‚æ•°ä¸æœ€å¤§å€¼-Xmxå‚æ•°è®¾ç½®ä¸ºä¸€æ ·å³å¯é¿å…å †è‡ªåŠ¨æ‰©å±•</p></blockquote><p>å¦‚ä¸‹ä¾‹å­ï¼Œä¸æ–­åœ°åˆ›é€ å¯¹è±¡ï¼Œæœ€ç»ˆå¯¼è‡´Javaå †å†…å­˜æº¢å‡ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.thinkingjava;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * VM Argsï¼š-Xms20m -Xmx20m -XX:+HeapDumpOnOutOfMemoryError</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeapOOM</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">HeapObject</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;HeapObject&gt; heapObjectList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            heapObjectList.add(<span class="keyword">new</span> HeapObject());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ—¥å¿—è¾“å‡ºï¼š</span></span><br><span class="line">java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">Dumping heap to java_pid22301.hprof ...</span><br><span class="line">Heap dump file created [<span class="number">27600189</span> bytes in <span class="number">0.203</span> secs]</span><br><span class="line">Exception in thread <span class="string">"main"</span> java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">	at java.util.Arrays.copyOf(Arrays.java:<span class="number">2245</span>)</span><br><span class="line">	at java.util.Arrays.copyOf(Arrays.java:<span class="number">2219</span>)</span><br><span class="line">	at java.util.ArrayList.grow(ArrayList.java:<span class="number">242</span>)</span><br><span class="line">	at java.util.ArrayList.ensureExplicitCapacity(ArrayList.java:<span class="number">216</span>)</span><br><span class="line">	at java.util.ArrayList.ensureCapacityInternal(ArrayList.java:<span class="number">208</span>)</span><br><span class="line">	at java.util.ArrayList.add(ArrayList.java:<span class="number">440</span>)</span><br><span class="line">	at com.thinkingjava.HeapOOM.main(HeapOOM.java:<span class="number">18</span>)</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="Method-Area-Non-Heap"><a href="#Method-Area-Non-Heap" class="headerlink" title="Method Area(Non-Heap)"></a>Method Area(Non-Heap)</h2><p>ç”±äºè¯¥åŒºåŸŸä½¿ç”¨çš„æ˜¯æ°¸ä¹…ä»£GCæ”¶é›†æ–¹æ³•æ¥å®ç°ï¼Œæ‰€ä»¥ä¹Ÿç§°ä¸ºâ€æ°¸ä¹…ä»£â€ï¼ˆPermanent Generationï¼‰ï¼Œç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„<strong>ç±»ä¿¡æ¯</strong>ã€<strong>å¸¸é‡</strong>ã€<strong>é™æ€å˜é‡</strong>ã€<strong>å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç </strong>ç­‰æ•°æ®ã€‚</p><p>åƒåœ¾å›æ”¶åœ¨è¿™ä¸ªåŒºåŸŸè¾ƒå°‘å‡ºç°ï¼Œä½†è¿™ä¸ªåŒºåŸŸçš„æ•°æ®å¹¶éæ°¸ä¹…å­˜åœ¨ï¼Œè¿™ä¸ªåŒºåŸŸçš„å†…å­˜å›æ”¶ä¸»è¦ç›®æ ‡æ˜¯é’ˆå¯¹å¸¸é‡æ± çš„å›æ”¶å’Œå¯¹ç±»å‹çš„å¸è½½ã€‚</p><h3 id="å¼‚å¸¸-2"><a href="#å¼‚å¸¸-2" class="headerlink" title="å¼‚å¸¸"></a>å¼‚å¸¸</h3><p>å½“æ–¹æ³•åŒºæ— æ³•æ»¡è¶³å†…å­˜åˆ†é…çš„éœ€æ±‚æ—¶ï¼Œå°†ä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚ä¸‹é¢ä¾‹å­ï¼Œè¿ç”¨cblibåŠ¨æ€ä»£ç†æŠ€æœ¯ï¼Œäº§ç”Ÿå¤§é‡çš„ç±»å‹ï¼Œå¯¼è‡´OOMå¼‚å¸¸ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.java;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.Enhancer;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodInterceptor;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodProxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaMethodOOM</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">OOMObject</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            Enhancer enhancer = <span class="keyword">new</span> Enhancer();</span><br><span class="line">            enhancer.setSuperclass(OOMObject.class);</span><br><span class="line">            enhancer.setUseCache(<span class="keyword">false</span>);</span><br><span class="line">            enhancer.setCallback(<span class="keyword">new</span> MethodInterceptor() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object o, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> methodProxy.invoke(o, objects);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            enhancer.create();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼‚å¸¸è¾“å‡ºï¼š</span></span><br><span class="line">Exception in thread <span class="string">"main"</span> </span><br><span class="line">Exception: java.lang.OutOfMemoryError thrown from the UncaughtExceptionHandler in thread <span class="string">"main"</span></span><br></pre></td></tr></table></figure><h2 id="è¿è¡Œæ—¶å¸¸é‡æ± "><a href="#è¿è¡Œæ—¶å¸¸é‡æ± " class="headerlink" title="è¿è¡Œæ—¶å¸¸é‡æ± "></a>è¿è¡Œæ—¶å¸¸é‡æ± </h2><p>è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚Classæ–‡ä»¶é™¤äº†æœ‰ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰ä¸€é¡¹ä¿¡æ¯æ˜¯å¸¸é‡æ± ï¼ˆConstant Pool Tableï¼‰ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§<strong>å­—é¢é‡</strong>å’Œ<strong>ç¬¦å·å¼•ç”¨</strong>ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ç±»åŠ è½½è¿›æ–¹æ³•åŒºåè¿›å…¥å¸¸é‡æ± å­˜æ”¾ã€‚</p><p>è¿è¡Œæ—¶å¸¸é‡æ± ç›¸å¯¹äºClassæ–‡ä»¶å¸¸é‡æ± çš„å¦ä¸€ä¸ªé‡è¦ç‰¹å¾ï¼Œæ˜¯å…·å¤‡åŠ¨æ€æ€§ã€‚Javaè¯­è¨€å¹¶ä¸è¦æ±‚å¸¸é‡ä¸€å®šåªæœ‰ç¼–è¯‘æœŸæ‰èƒ½äº§ç”Ÿï¼Œä¹Ÿå°±æ˜¯å¹¶éé¢„ç½®å…¥Classæ–‡ä»¶ä¸­å¸¸é‡æ± çš„å†…å®¹æ‰èƒ½è¿›å…¥æ–¹æ³•åŒºè¿è¡Œæ—¶å¸¸é‡æ± ï¼Œè¿è¡ŒæœŸé—´ä¹Ÿå¯èƒ½å°†æ–°çš„å¸¸é‡æ”¾å…¥æ± ä¸­ï¼Œè¿™ç§ç‰¹æ€§è¢«å¼€å‘äººå‘˜åˆ©ç”¨å¾—æ¯”è¾ƒå¤šçš„ä¾¿æ˜¯Stringç±»çš„internï¼ˆï¼‰æ–¹æ³•ã€‚</p><h5 id="å­—ç¬¦ä¸²å¸¸é‡æ± "><a href="#å­—ç¬¦ä¸²å¸¸é‡æ± " class="headerlink" title="å­—ç¬¦ä¸²å¸¸é‡æ± "></a>å­—ç¬¦ä¸²å¸¸é‡æ± </h5><p>å­—ç¬¦ä¸²å¸¸é‡æ±  åœ¨JDK 1.7çš„HotSpotä¸­å·²ç»ä»è¿è¡Œæ—¶å¸¸é‡æ± è½¬ç§»åˆ°Heapä¸­ã€‚<a href="http://www.oracle.com/technetwork/java/javase/jdk7-relnotes-418459.html#jdk7changes" target="_blank" rel="noopener">å‚è§</a></p><blockquote><p><strong>Area</strong>: HotSpot</p><p><strong>Synopsis</strong>: In JDK 7, interned strings are no longer allocated in the permanent generation of the Java heap, but <strong>are instead allocated in the main part of the Java heap</strong> (known as the young and old generations), along with the other objects created by the application. This change will result in more data residing in the main Java heap, and less data in the permanent generation, and thus may require heap sizes to be adjusted. Most applications will see only relatively small differences in heap usage due to this change, but larger applications that load many classes or make heavy use of the String.intern() method will see more significant differences. RFE: 6962931</p></blockquote><h3 id="å¼‚å¸¸-3"><a href="#å¼‚å¸¸-3" class="headerlink" title="å¼‚å¸¸"></a>å¼‚å¸¸</h3><p>æ—¢ç„¶è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œè‡ªç„¶å—åˆ°æ–¹æ³•åŒºå†…å­˜çš„é™åˆ¶ï¼Œå½“å¸¸é‡æ± æ— æ³•å†ç”³è¯·åˆ°å†…å­˜æ—¶ä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚</p><p>String.intern()æ˜¯ä¸€ä¸ªNativeæ–¹æ³•ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼šå¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å·²ç»åŒ…å«ä¸€ä¸ªç­‰äºæ­¤Stringå¯¹è±¡çš„å­—ç¬¦ä¸²ï¼Œåˆ™è¿”å›ä»£è¡¨æ± ä¸­è¿™ä¸ªå­—ç¬¦ä¸²çš„Stringå¯¹è±¡ï¼›å¦åˆ™ï¼Œå°†æ­¤Stringå¯¹è±¡åŒ…å«çš„å­—ç¬¦ä¸²æ·»åŠ åˆ°å¸¸é‡æ± ä¸­ï¼Œå¹¶ä¸”è¿”å›æ­¤Stringå¯¹è±¡çš„å¼•ç”¨ã€‚åœ¨JDK 1.6åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œç”±äºå¸¸é‡æ± åˆ†é…åœ¨æ°¸ä¹…ä»£å†…ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡-XX:PermSizeå’Œ-XX:MaxPermSizeé™åˆ¶æ–¹æ³•åŒºå¤§å°ï¼Œä»è€Œé—´æ¥é™åˆ¶å…¶ä¸­å¸¸é‡æ± çš„å®¹é‡ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.java;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JVM VM: -XX:PermSize=10M -XX:MaxPermSize=10M</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConstantPoolOOM</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; stringList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            i++;</span><br><span class="line">            stringList.add(String.valueOf(i).intern());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line">Exception in thread <span class="string">"main"</span> java.lang.OutOfMemoryError: PermGen space</span><br><span class="line">	at java.lang.String.intern(Native Method)</span><br><span class="line">	at one.wangwei.java.App.main(App.java:<span class="number">15</span>)</span><br></pre></td></tr></table></figure><h2 id="Direct-Memory"><a href="#Direct-Memory" class="headerlink" title="Direct Memory"></a>Direct Memory</h2><p>ç›´æ¥å†…å­˜ï¼ˆDirect Memoryï¼‰å¹¶ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸã€‚</p><p>åœ¨JDK 1.4ä¸­æ–°åŠ å…¥äº†NIOï¼ˆNew Input/Outputï¼‰ç±»ï¼Œå¼•å…¥äº†ä¸€ç§åŸºäºé€šé“ï¼ˆChannelï¼‰ä¸ç¼“å†²åŒºï¼ˆBufferï¼‰çš„I/Oæ–¹å¼ï¼Œå®ƒå¯ä»¥ä½¿ç”¨Nativeå‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå­˜å‚¨åœ¨Javaå †ä¸­çš„DirectByteBufferå¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œã€‚è¿™æ ·èƒ½åœ¨ä¸€äº›åœºæ™¯ä¸­æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå› ä¸ºé¿å…äº†åœ¨Javaå †å’ŒNativeå †ä¸­æ¥å›å¤åˆ¶æ•°æ®ã€‚</p><h3 id="å¼‚å¸¸-4"><a href="#å¼‚å¸¸-4" class="headerlink" title="å¼‚å¸¸"></a>å¼‚å¸¸</h3><p>æœ¬æœºç›´æ¥å†…å­˜çš„åˆ†é…ä¸ä¼šå—åˆ°Javaå †å¤§å°çš„é™åˆ¶ï¼Œä½†æ˜¯ï¼Œæ—¢ç„¶æ˜¯å†…å­˜ï¼Œè‚¯å®šè¿˜æ˜¯ä¼šå—åˆ°æœ¬æœºæ€»å†…å­˜ï¼ˆåŒ…æ‹¬RAMä»¥åŠSWAPåŒºæˆ–è€…åˆ†é¡µæ–‡ä»¶ï¼‰å¤§å°ä»¥åŠå¤„ç†å™¨å¯»å€ç©ºé—´çš„é™åˆ¶ã€‚æœåŠ¡å™¨ç®¡ç†å‘˜åœ¨é…ç½®è™šæ‹Ÿæœºå‚æ•°æ—¶ï¼Œä¼šæ ¹æ®å®é™…å†…å­˜è®¾ç½®-Xmxç­‰å‚æ•°ä¿¡æ¯ï¼Œä½†ç»å¸¸å¿½ç•¥ç›´æ¥å†…å­˜ï¼Œä½¿å¾—å„ä¸ªå†…å­˜åŒºåŸŸæ€»å’Œå¤§äºç‰©ç†å†…å­˜é™åˆ¶ï¼ˆåŒ…æ‹¬ç‰©ç†çš„å’Œæ“ä½œç³»ç»Ÿçº§çš„é™åˆ¶ï¼‰ï¼Œä»è€Œå¯¼è‡´åŠ¨æ€æ‰©å±•æ—¶å‡ºç°OutOfMemoryErrorå¼‚å¸¸ã€‚</p><p>DirectMemoryå®¹é‡å¯é€šè¿‡ <code>-XX:MaxDirectMemorySize</code> æŒ‡å®šï¼Œä¸‹é¢çš„ä»£ç è¶Šè¿‡äº†DirectByteBufferç±»ï¼Œç›´æ¥é€šè¿‡åå°„è·å–Unsafeå®ä¾‹è¿›è¡Œå†…å­˜åˆ†é…ï¼ˆUnsafeç±»çš„getUnsafe()æ–¹æ³•é™åˆ¶äº†åªæœ‰å¼•å¯¼ç±»åŠ è½½å™¨æ‰ä¼šè¿”å›å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯è®¾è®¡è€…å¸Œæœ›åªæœ‰rt.jarä¸­çš„ç±»æ‰èƒ½ä½¿ç”¨Unsafeçš„åŠŸèƒ½ï¼‰ã€‚å› ä¸ºï¼Œè™½ç„¶ä½¿ç”¨DirectByteBufferåˆ†é…å†…å­˜ä¹Ÿä¼šæŠ›å‡ºå†…å­˜æº¢å‡ºå¼‚å¸¸ï¼Œä½†å®ƒæŠ›å‡ºå¼‚å¸¸æ—¶å¹¶æ²¡æœ‰çœŸæ­£å‘æ“ä½œç³»ç»Ÿç”³è¯·åˆ†é…å†…å­˜ï¼Œè€Œæ˜¯é€šè¿‡è®¡ç®—å¾—çŸ¥å†…å­˜æ— æ³•åˆ†é…ï¼Œäºæ˜¯æ‰‹åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼ŒçœŸæ­£ç”³è¯·åˆ†é…å†…å­˜çš„æ–¹æ³•æ˜¯unsafe.allocateMemory()ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.java;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sun.misc.Unsafe;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * VM Argsï¼š-Xmx20M -XX:MaxDirectMemorySize=10M</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DirectMemory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ALLOCATE_MEMORY = <span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Field unsafeField = Unsafe.class.getDeclaredFields()[<span class="number">0</span>];</span><br><span class="line">            unsafeField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            Unsafe unsafe = (Unsafe) unsafeField.get(<span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                unsafe.allocateMemory(ALLOCATE_MEMORY);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºï¼š</span></span><br><span class="line"></span><br><span class="line">java(<span class="number">45961</span>,<span class="number">0x70000a70c000</span>) malloc: *** mach_vm_map(size=<span class="number">10485760</span>) failed (error code=<span class="number">3</span>)</span><br><span class="line">*** error: can<span class="string">'t allocate region</span></span><br><span class="line"><span class="string">*** set a breakpoint in malloc_error_break to debug</span></span><br><span class="line"><span class="string">Exception in thread "main" java.lang.OutOfMemoryError</span></span><br><span class="line"><span class="string">	at sun.misc.Unsafe.allocateMemory(Native Method)</span></span><br><span class="line"><span class="string">	at one.wangwei.java.DirectMemory.main(DirectMemory.java:20)</span></span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://book.douban.com/subject/24722612/" target="_blank" rel="noopener">ã€ŠJVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ[ç¬¬2ç‰ˆ]ã€‹ç¬¬2ç« èŠ‚ã€ŒJavaå†…å­˜åŒºåŸŸä¸å†…å­˜æº¢å‡ºå¼‚å¸¸ã€</a></li><li><a href="https://docs.oracle.com/javase/specs/jvms/se7/html/index.html" target="_blank" rel="noopener">The JavaÂ® Virtual Machine Specification Java SE 7 Edition</a></li><li><a href="http://www.javainterviewpoint.com/java-virtual-machine-architecture-in-java/" target="_blank" rel="noopener">http://www.javainterviewpoint.com/java-virtual-machine-architecture-in-java/</a></li><li><a href="http://blog.jamesdbloom.com/JVMInternals.html" target="_blank" rel="noopener">http://blog.jamesdbloom.com/JVMInternals.html</a></li><li><a href="https://www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html" target="_blank" rel="noopener">https://www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html</a></li></ul><blockquote><p><a href="https://press.one/file/v?s=6f3d70c29a9ccc4fd57898e95ca6b76ff82541dffa7198d4e05a6cf172f09627e9cd2261f63d7a9ccd73e1e829e03ed53363f67b313ae4b340728ad060650dd91&amp;h=4b82cb88322a4072133c5388a10f69a6a10b5b85faf4dcd993b62d4549a94463&amp;a=23fe9bfd7ceef4b44c2ce44dcac8e4a49caf8026&amp;f=P1&amp;v=2" target="_blank" rel="noopener">https://press.one/file/v?s=6f3d70c29a9ccc4fd57898e95ca6b76ff82541dffa7198d4e05a6cf172f09627e9cd2261f63d7a9ccd73e1e829e03ed53363f67b313ae4b340728ad060650dd91&amp;h=4b82cb88322a4072133c5388a10f69a6a10b5b85faf4dcd993b62d4549a94463&amp;a=23fe9bfd7ceef4b44c2ce44dcac8e4a49caf8026&amp;f=P1&amp;v=2</a></p></blockquote>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[è®¾è®¡æ¨¡å¼ | æ¨¡æ¿æ–¹æ³•(Template Method)]]></title>
      <url>/posts/design-patterns-template-method.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="What"><a href="#What" class="headerlink" title="What"></a>What</h1><ul><li>çˆ¶ç±»å®šä¹‰å¤„ç†æµç¨‹çš„æ¡†æ¶ï¼Œå­ç±»å®ç°æµç¨‹ä¸­å„ä¸ªåŠŸèƒ½çš„å…·ä½“ç»†èŠ‚ã€‚</li><li>è®¾è®¡åŸåˆ™ï¼šDo not call me, I will call you.</li></ul><a id="more"></a><h1 id="How"><a href="#How" class="headerlink" title="How"></a>How</h1><h4 id="UMLå›¾"><a href="#UMLå›¾" class="headerlink" title="UMLå›¾"></a>UMLå›¾</h4><p><img src="https://img.i7years.com/blog/Template_Method-2x.png" alt="Template_Method"></p><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><blockquote><p>ä»¥æˆ‘ä»¬æ—¥å¸¸å·¥ä½œçš„æ—¥ç¨‹å®‰æ’ä¸ºä¾‹</p></blockquote><ol><li><p>å®šä¹‰çˆ¶ç±» <strong>Worker</strong>ï¼Œé‡Œé¢å®šä¹‰äº†æ¡†æ¶æµç¨‹æ–¹æ³• <strong><em>dailyRountine</em></strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.designpatterns.templatemethod;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Worker</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¯æ—¥æ—¥ç¨‹å®‰æ’</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dailyRountine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String name = getName();</span><br><span class="line">        getUp(name);</span><br><span class="line">        eatBreakfast(name);</span><br><span class="line">        goToWork(name);</span><br><span class="line">        work(name);</span><br><span class="line">        goBackHome(name);</span><br><span class="line">        relax(name);</span><br><span class="line">        sleep(name);</span><br><span class="line">        System.out.println(<span class="string">"\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å§“å</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> String <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * èµ·åºŠ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getUp</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"&#123;&#125; èµ·åºŠäº†"</span>, name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åƒæ—©é¤</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eatBreakfast</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"&#123;&#125; åƒæ—©é¤"</span>, name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å»ä¸Šç­</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">goToWork</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"&#123;&#125; è¦å»ä¸Šç­äº†"</span>, name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å·¥ä½œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">work</span><span class="params">(String name)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸‹ç­å›å®¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">goBackHome</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"&#123;&#125; å¿™å®Œå·¥ä½œï¼Œä¸‹ç­å›å®¶äº†"</span>, name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ”¾æ¾ä¼‘æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">relax</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"&#123;&#125; çœ‹ç¾å‰§ï¼Œæ”¾æ¾ä¸€ä¸‹"</span>, name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…¥ç¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sleep</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"&#123;&#125; å¼€å§‹ç¡è§‰äº†"</span>, name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å®šä¹‰å­ç±» <strong>ProductManager</strong>ï¼Œå®ç°æŠ½è±¡æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.designpatterns.templatemethod;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * äº§å“ç»ç†</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/05/08</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductManager</span> <span class="keyword">extends</span> <span class="title">Worker</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å§“å</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"å°ä¼Ÿ"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å·¥ä½œ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">work</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"&#123;&#125; æ˜¯ä½äº§å“ç»ç†ï¼Œä¸»è¦çš„å·¥ä½œå°±æ˜¯ç”»äº§å“åŸå‹"</span>, name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å®šä¹‰å­ç±» <strong>Programmer</strong>ï¼Œå®ç°æŠ½è±¡æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.designpatterns.templatemethod;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç¨‹åºå‘˜</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/05/08</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Programmer</span> <span class="keyword">extends</span> <span class="title">Worker</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å§“å</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"å°æ˜"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å·¥ä½œ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">work</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"&#123;&#125; æ˜¯åç¨‹åºçŒ¿ï¼Œä¸»è¦çš„å·¥ä½œæ˜¯ç¼–å†™ç¨‹åº"</span>, name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ”¾æ¾ä¼‘æ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">relax</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"&#123;&#125; å–œæ¬¢è·‘æ­¥æ¥æ”¾æ¾å¿ƒæƒ…"</span>, name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å®šä¹‰å­ç±» <strong>UIDesigner</strong>ï¼Œå®ç°æŠ½è±¡æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.designpatterns.templatemethod;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * UI è®¾è®¡å¸ˆ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/05/08</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UIDesigner</span> <span class="keyword">extends</span> <span class="title">Worker</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å§“å</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"å°ç¾"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å·¥ä½œ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">work</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"&#123;&#125; æ˜¯ä½UIè®¾è®¡å¸ˆï¼Œæ¯å¤©çš„å·¥ä½œä¸»è¦æ˜¯è®¾è®¡UIç•Œé¢"</span>, name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ”¾æ¾ä¼‘æ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">relax</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"&#123;&#125; å–œæ¬¢çœ‹éŸ©å‰§æ¥æ”¾æ¾å¿ƒæƒ…"</span>, name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å®šä¹‰è°ƒç”¨ç±» WorkerHelper</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.designpatterns.templatemethod;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WorkerHelper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Worker worker;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WorkerHelper</span><span class="params">(Worker worker)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.worker = worker;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">changeWorker</span><span class="params">(Worker worker)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.worker = worker;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dailyRountine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.worker.dailyRountine();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>è¿è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.designpatterns.templatemethod;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        WorkerHelper workerHelper = <span class="keyword">new</span> WorkerHelper(<span class="keyword">new</span> ProductManager());</span><br><span class="line">        workerHelper.dailyRountine();</span><br><span class="line"></span><br><span class="line">        workerHelper.changeWorker(<span class="keyword">new</span> Programmer());</span><br><span class="line">        workerHelper.dailyRountine();</span><br><span class="line"></span><br><span class="line">        workerHelper.changeWorker(<span class="keyword">new</span> UIDesigner());</span><br><span class="line">        workerHelper.dailyRountine();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼š</span></span><br><span class="line"></span><br><span class="line"><span class="number">14</span>:<span class="number">58</span>:<span class="number">27.835</span> [main] INFO one.wangwei.designpatterns.templatemethod.Worker - å°ä¼Ÿ èµ·åºŠäº†</span><br><span class="line"><span class="number">14</span>:<span class="number">58</span>:<span class="number">27.842</span> [main] INFO one.wangwei.designpatterns.templatemethod.Worker - å°ä¼Ÿ åƒæ—©é¤</span><br><span class="line"><span class="number">14</span>:<span class="number">58</span>:<span class="number">27.842</span> [main] INFO one.wangwei.designpatterns.templatemethod.Worker - å°ä¼Ÿ è¦å»ä¸Šç­äº†</span><br><span class="line"><span class="number">14</span>:<span class="number">58</span>:<span class="number">27.842</span> [main] INFO one.wangwei.designpatterns.templatemethod.ProductManager - å°ä¼Ÿ æ˜¯ä½äº§å“ç»ç†ï¼Œä¸»è¦çš„å·¥ä½œå°±æ˜¯ç”»äº§å“åŸå‹</span><br><span class="line"><span class="number">14</span>:<span class="number">58</span>:<span class="number">27.842</span> [main] INFO one.wangwei.designpatterns.templatemethod.Worker - å°ä¼Ÿ å¿™å®Œå·¥ä½œï¼Œä¸‹ç­å›å®¶äº†</span><br><span class="line"><span class="number">14</span>:<span class="number">58</span>:<span class="number">27.842</span> [main] INFO one.wangwei.designpatterns.templatemethod.Worker - å°ä¼Ÿ çœ‹ç¾å‰§ï¼Œæ”¾æ¾ä¸€ä¸‹</span><br><span class="line"><span class="number">14</span>:<span class="number">58</span>:<span class="number">27.842</span> [main] INFO one.wangwei.designpatterns.templatemethod.Worker - å°ä¼Ÿ å¼€å§‹ç¡è§‰äº†</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">14</span>:<span class="number">58</span>:<span class="number">27.842</span> [main] INFO one.wangwei.designpatterns.templatemethod.Worker - å°æ˜ èµ·åºŠäº†</span><br><span class="line"><span class="number">14</span>:<span class="number">58</span>:<span class="number">27.843</span> [main] INFO one.wangwei.designpatterns.templatemethod.Worker - å°æ˜ åƒæ—©é¤</span><br><span class="line"><span class="number">14</span>:<span class="number">58</span>:<span class="number">27.843</span> [main] INFO one.wangwei.designpatterns.templatemethod.Worker - å°æ˜ è¦å»ä¸Šç­äº†</span><br><span class="line"><span class="number">14</span>:<span class="number">58</span>:<span class="number">27.843</span> [main] INFO one.wangwei.designpatterns.templatemethod.Programmer - å°æ˜ æ˜¯åç¨‹åºçŒ¿ï¼Œä¸»è¦çš„å·¥ä½œæ˜¯ç¼–å†™ç¨‹åº</span><br><span class="line"><span class="number">14</span>:<span class="number">58</span>:<span class="number">27.843</span> [main] INFO one.wangwei.designpatterns.templatemethod.Worker - å°æ˜ å¿™å®Œå·¥ä½œï¼Œä¸‹ç­å›å®¶äº†</span><br><span class="line"><span class="number">14</span>:<span class="number">58</span>:<span class="number">27.843</span> [main] INFO one.wangwei.designpatterns.templatemethod.Programmer - å°æ˜ å–œæ¬¢è·‘æ­¥æ¥æ”¾æ¾å¿ƒæƒ…</span><br><span class="line"><span class="number">14</span>:<span class="number">58</span>:<span class="number">27.843</span> [main] INFO one.wangwei.designpatterns.templatemethod.Worker - å°æ˜ å¼€å§‹ç¡è§‰äº†</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">14</span>:<span class="number">58</span>:<span class="number">27.843</span> [main] INFO one.wangwei.designpatterns.templatemethod.Worker - å°ç¾ èµ·åºŠäº†</span><br><span class="line"><span class="number">14</span>:<span class="number">58</span>:<span class="number">27.843</span> [main] INFO one.wangwei.designpatterns.templatemethod.Worker - å°ç¾ åƒæ—©é¤</span><br><span class="line"><span class="number">14</span>:<span class="number">58</span>:<span class="number">27.843</span> [main] INFO one.wangwei.designpatterns.templatemethod.Worker - å°ç¾ è¦å»ä¸Šç­äº†</span><br><span class="line"><span class="number">14</span>:<span class="number">58</span>:<span class="number">27.843</span> [main] INFO one.wangwei.designpatterns.templatemethod.UIDesigner - å°ç¾ æ˜¯ä½UIè®¾è®¡å¸ˆï¼Œæ¯å¤©çš„å·¥ä½œä¸»è¦æ˜¯è®¾è®¡UIç•Œé¢</span><br><span class="line"><span class="number">14</span>:<span class="number">58</span>:<span class="number">27.843</span> [main] INFO one.wangwei.designpatterns.templatemethod.Worker - å°ç¾ å¿™å®Œå·¥ä½œï¼Œä¸‹ç­å›å®¶äº†</span><br><span class="line"><span class="number">14</span>:<span class="number">58</span>:<span class="number">27.843</span> [main] INFO one.wangwei.designpatterns.templatemethod.UIDesigner - å°ç¾ å–œæ¬¢çœ‹éŸ©å‰§æ¥æ”¾æ¾å¿ƒæƒ…</span><br><span class="line"><span class="number">14</span>:<span class="number">58</span>:<span class="number">27.843</span> [main] INFO one.wangwei.designpatterns.templatemethod.Worker - å°ç¾ å¼€å§‹ç¡è§‰äº†</span><br></pre></td></tr></table></figure></li></ol><h1 id="JDKä¸­çš„è¿ç”¨"><a href="#JDKä¸­çš„è¿ç”¨" class="headerlink" title="JDKä¸­çš„è¿ç”¨"></a>JDKä¸­çš„è¿ç”¨</h1><ul><li><a href="https://docs.oracle.com/javase/8/docs/api/java/io/InputStream.html" target="_blank" rel="noopener">java.io.InputStream</a> , <a href="https://docs.oracle.com/javase/8/docs/api/java/io/OutputStream.html" target="_blank" rel="noopener">java.io.OutputStream</a> , <a href="https://docs.oracle.com/javase/8/docs/api/java/io/Reader.html" target="_blank" rel="noopener">java.io.Reader</a> ä»¥åŠ <a href="https://docs.oracle.com/javase/8/docs/api/java/io/Writer.html" target="_blank" rel="noopener">java.io.Writer</a> ä¸­æ‰€æœ‰éæŠ½è±¡æ–¹æ³•ï¼›</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/AbstractList.html" target="_blank" rel="noopener">java.util.AbstractList</a> , <a href="https://docs.oracle.com/javase/8/docs/api/java/util/AbstractSet.html" target="_blank" rel="noopener">java.util.AbstractSet</a> ä»¥åŠ <a href="https://docs.oracle.com/javase/8/docs/api/java/util/AbstractMap.html" target="_blank" rel="noopener">java.util.AbstractMap</a> ä¸­æ‰€æœ‰éæŠ½è±¡æ–¹æ³•ï¼›</li><li><a href="http://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServlet.html" target="_blank" rel="noopener">javax.servlet.http.HttpServlet</a> ä¸­ é»˜è®¤å‘é€ Http 405 â€œMethod Not Allowedâ€ é”™è¯¯å“åº”ä¿¡æ¯çš„ doXXX() çš„æ–¹æ³•ï¼›</li></ul><h4 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h4><ul><li><a href="https://github.com/wangweiX/design-patterns/blob/master/src/main/java/one/wangwei/designpatterns/templatemethod" target="_blank" rel="noopener">æºç </a></li><li><a href="https://sourcemaking.com/design_patterns/template_method" target="_blank" rel="noopener">https://sourcemaking.com/design_patterns/template_method</a></li><li><a href="https://refactoring.guru/design-patterns/template-method/java/example" target="_blank" rel="noopener">https://refactoring.guru/design-patterns/template-method/java/example</a></li><li><p><a href="http://ifeve.com/template-method-design-pattern" target="_blank" rel="noopener">http://ifeve.com/template-method-design-pattern</a></p></li><li><p>ã€Šå›¾è§£è®¾è®¡æ¨¡å¼ã€‹</p></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Design Patterns </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[è®¾è®¡æ¨¡å¼ | æŠ½è±¡å·¥å‚(Abstract Factory)]]></title>
      <url>/posts/design-patterns-abstract-factory.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/abstract-factory-mini-2x.png" alt=""></p><h1 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h1><p><strong>æŠ½è±¡å·¥å‚</strong>æ˜¯ä¸€ç§åˆ›é€ æ€§è®¾è®¡æ¨¡å¼ï¼Œå¯è®©æ‚¨ç”Ÿæˆç›¸å…³å¯¹è±¡çš„å®¶æ—ï¼Œè€Œæ— éœ€æŒ‡å®šå…·ä½“çš„ç±»ã€‚</p><a id="more"></a><h1 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h1><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªå®¶å…·åº—çš„æ¨¡æ‹Ÿå™¨ã€‚ ä½ çš„ä»£ç åŒ…æ‹¬ï¼š</p><ol><li>å®¶åº­ç›¸å…³çš„äº§å“ï¼š<code>Chair</code> + <code>Sofa</code> + <code>CoffeeTable</code>.</li><li>è¿™äº›å®¶å…·åœ¨é£æ ¼ä¸Šä¼šå­˜åœ¨ä¸€äº›å˜åŒ–ï¼Œæ¯”å¦‚ï¼šIKEA(å®œå®¶)ï¼ŒVictorianStyle(ç»´å¤šåˆ©äºšé£æ ¼)ï¼ŒArtDeco(è‰ºæœ¯è£…é¥°)ç­‰ç­‰ã€‚</li></ol><p>æ‚¨éœ€è¦ä¸€ç§æ–¹æ³•æ¥åˆ›å»ºå„ä¸ªå®¶å…·å¯¹è±¡ï¼Œä»¥ä¾¿å®ƒä»¬ä¸åŒä¸€ç³»åˆ—çš„å…¶ä»–å®¶å…·å¯¹è±¡åœ¨é£æ ¼ä¸Šç›¸åŒ¹é…ã€‚å¦åˆ™ï¼Œ å®¢æˆ·åœ¨æ”¶åˆ°ä¸åŒ¹é…çš„å®¶å…·æ—¶ä¼šæ„Ÿåˆ°éå¸¸æ²®ä¸§ã€‚</p><p>æ­¤å¤–ï¼Œåœ¨å‘ç¨‹åºæ·»åŠ æ–°äº§å“æˆ–äº§å“ç³»åˆ—æ—¶ï¼Œæ‚¨ä¸å¸Œæœ›æ›´æ”¹ç°æœ‰çš„ä»£ç ã€‚ å®¶å…·ä¾›åº”å•†ç»å¸¸æ›´æ–°ä»–ä»¬çš„äº§å“ç›®å½•ï¼Œæˆ‘ä»¬å¹¶ä¸æƒ³æ¯æ¬¡éƒ½å»æ›´æ”¹æ ¸å¿ƒä»£ç ã€‚</p><h2 id="æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h2><p><em>æŠ½è±¡å·¥å‚</em> æ¨¡å¼å»ºè®®è¦åšçš„ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯æµè§ˆä¸€ä¸‹æ‰€æœ‰çš„ä¸åŒç§ç±»çš„äº§å“ï¼Œå¹¶ä¸”å¼ºåˆ¶ç»Ÿä¸€å®ƒä»¬çš„å˜ç§ï¼Œä»¥ä¾¿è®©å®ƒä»¬å®ç°ç›¸åŒçš„æ¥å£ã€‚ä¾‹å¦‚ï¼Œæ‰€æœ‰ä¸åŒç§ç±»çš„çš„ Chair éƒ½è¦å®ç° <code>Chair</code> æ¥å£ï¼›æ‰€æœ‰çš„ coffee table å¿…é¡»å®ç° <code>CoffeeTable</code> æ¥å£ï¼Œç­‰ç­‰ã€‚</p><p>ç¬¬äºŒæ­¥å°±æ˜¯åˆ›å»º <code>AbstractFactory</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºç¡€æ¥å£ï¼Œå®ƒå£°æ˜åˆ›å»ºæ„æˆäº§å“ç³»åˆ—çš„æ‰€æœ‰äº§å“çš„æ–¹æ³•ã€‚ï¼ˆä¾‹å¦‚ï¼š<code>createChair</code>, <code>createSofa</code> and <code>createCoffeeTable</code>ï¼‰ã€‚è¿™é‡Œé‡è¦çš„æ˜¯ä¿è¯è¿™äº›æ–¹æ³•è¿”å›å…ˆå‰æå–çš„æ¥å£æ‰€è¡¨ç¤ºçš„æŠ½è±¡äº§å“ç±»å‹ï¼š<code>Chair</code> ã€ <code>Sofa</code> ã€ <code>CoffeeTable</code>ã€‚</p><p>ç¬¬ä¸‰æ­¥è¦åšçš„äº‹æƒ…å°±æ˜¯å»å®ç°å…·ä½“çš„å·¥å‚ã€‚è¿™äº›å·¥å‚ç±»è¦è¿”å›å…·ä½“çš„äº§å“ç±»å‹ã€‚ä¾‹å¦‚ï¼Œ<code>IKEAFactory</code>åªèƒ½è¿”å›<code>IKEAChair</code>ï¼Œ<code>IKEASofa</code>ä»¥åŠ<code>IKEACoffeeTable</code>å¯¹è±¡ã€‚æ‰€æœ‰çš„å·¥å‚å¿…é¡»éµå¾ª <code>AbstractFactory</code> æ¥å£ï¼ŒåŒæ—¶åˆ›å»ºç›¸åŒçš„å„ç§äº§å“ã€‚</p><p>å®¢æˆ·ç«¯ä»£ç åªèƒ½é€šè¿‡æŠ½è±¡æ¥å£ä¸å·¥å‚å’Œäº§å“ååŒå·¥ä½œã€‚ é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä¼ é€’ä¸åŒçš„å·¥å‚å¯¹è±¡æ¥æ›´æ”¹å®¢æˆ·ç«¯ä»£ç ä¸­ä½¿ç”¨çš„äº§å“ç±»å‹ã€‚</p><p>å› æ­¤ï¼Œå½“å®¢æˆ·ç«¯çš„ä»£ç è¦æ±‚å·¥å‚ç”Ÿäº§æ¤…å­æ—¶ï¼Œå®ƒä»¬ä¸€å®šä¸èƒ½çŸ¥é“å…·ä½“çš„å·¥å‚å®ç°ç±»ã€‚ä¹Ÿä¸èƒ½å¤ŸçŸ¥é“æ¤…å­çš„å…·ä½“å®ç°ç±»ã€‚æ— è®ºå®ƒä»¬å°†æ˜¯ IKEA è¿˜æ˜¯ Victorian é£æ ¼çš„æ¤…å­ï¼Œå¿…é¡»ä¿è¯ç”¨æŠ½è±¡ç±»<code>Chair</code> ï¼Œå¹¶ä¸”ä»¥ç›¸åŒçš„æ–¹å¼æ¥ä¸æ‰€æœ‰çš„æ¤…å­ä¸€èµ·æ­£å¸¸è¿è¡Œã€‚å®¢æˆ·ç«¯ä»£ç å°†ä¼šçŸ¥é“è¿™ä¸ªç»“æœï¼Œæ¤…å­å®ç°äº†åœ¨æ¥å£ä¸­å£°æ˜çš„ <code>sit</code> æ–¹æ³•ã€‚å®ƒä¹ŸçŸ¥é“æ— è®ºè¿”å›å“ªç§ç±»å‹çš„æ¤…å­ï¼Œå®ƒå°†ä¸åŒä¸€å·¥å‚ç”Ÿäº§çš„æ²™å‘å’Œå’–å•¡æ¡Œçš„ç±»å‹ç›¸åŒ¹é…ã€‚</p><p>å¥½äº†ï¼Œé‚£è°æ¥åˆ›å»ºå…·ä½“çš„å·¥å‚å¯¹è±¡å‘¢ï¼Ÿé€šå¸¸æ¥è®²ï¼Œç¨‹åºåœ¨åˆå§‹åŒ–é˜¶æ®µåˆ›å»ºä¸€ä¸ªå…·ä½“çš„å·¥å‚å¯¹è±¡ï¼Œå¹¶æ ¹æ®é…ç½®æˆ–ç¯å¢ƒé€‰æ‹©å·¥å‚ç±»å‹ã€‚</p><h2 id="æ„é€ "><a href="#æ„é€ " class="headerlink" title="æ„é€ "></a>æ„é€ </h2><p><img src="https://img.i7years.com/blog/abstract-factory-structure-indexed-2x.png" alt=""></p><h2 id="ä¼ªä»£ç "><a href="#ä¼ªä»£ç " class="headerlink" title="ä¼ªä»£ç "></a>ä¼ªä»£ç </h2><p>æˆ‘ä»¬ç”¨ MacOS ä¸ Windows ä¸Šçš„ <code>Button</code> å’Œ <code>Checkbox</code> ä¸ºç¤ºä¾‹ï¼š</p><p>äº§å“ <code>Button</code> æŠ½è±¡ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.designpatterns.abstractfactory;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The type Button.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Button</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Paint.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">paint</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°ç±» <code>WindowsButton</code> ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.designpatterns.abstractfactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WindowsButton</span> <span class="keyword">extends</span> <span class="title">Button</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">paint</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"This is a window button. "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°ç±» <code>MacOSButton</code> ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.designpatterns.abstractfactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MacOSButton</span> <span class="keyword">extends</span> <span class="title">Button</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">paint</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"This is a mac os button. "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº§å“ <code>Checkbox</code> æŠ½è±¡ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.designpatterns.abstractfactory;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The type Checkbox.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Checkbox</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Paint.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">paint</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç° <code>WindowsCheckbox</code> ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.designpatterns.abstractfactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WindowsCheckbox</span> <span class="keyword">extends</span> <span class="title">Checkbox</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">paint</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"You had created windows checkbox. "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº§å“å­ç±» <code>MacOSCheckbox</code> ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.designpatterns.abstractfactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MacOSCheckbox</span> <span class="keyword">extends</span> <span class="title">Checkbox</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">paint</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"You had created mac os checkbox"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰æŠ½è±¡å·¥å‚ <code>GUIFactory</code> ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.designpatterns.abstractfactory;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The interface Gui factory.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GUIFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create button button.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the button</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Button <span class="title">createButton</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create checkbox checkbox.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the checkbox</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Checkbox <span class="title">createCheckbox</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ä¾‹å·¥å‚ <code>MacOSGUIFactory</code> ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.designpatterns.abstractfactory;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The type Mac osgui factory.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MacOSGUIFactory</span> <span class="keyword">implements</span> <span class="title">GUIFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Button <span class="title">createButton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MacOSButton();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Checkbox <span class="title">createCheckbox</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MacOSCheckbox();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ä¾‹å·¥å‚ <code>WindowsGUIFactory</code> ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.designpatterns.abstractfactory;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The type Windows gui factory.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WindowsGUIFactory</span> <span class="keyword">implements</span> <span class="title">GUIFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Button <span class="title">createButton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WindowsButton();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Checkbox <span class="title">createCheckbox</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WindowsCheckbox();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ç¨‹åºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.designpatterns.abstractfactory;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The type Application.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Button button;</span><br><span class="line">    <span class="keyword">private</span> Checkbox checkbox;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Instantiates a new Application.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> factory the factory</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Client</span><span class="params">(GUIFactory factory)</span> </span>&#123;</span><br><span class="line">        button = factory.createButton();</span><br><span class="line">        checkbox = factory.createCheckbox();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Paint.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">paint</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        button.paint();</span><br><span class="line">        checkbox.paint();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åº”ç”¨ç¨‹åºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.designpatterns.abstractfactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Client application;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        configure();</span><br><span class="line">        application.paint();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String osName = System.getProperty(<span class="string">"os.name"</span>);</span><br><span class="line">        <span class="keyword">if</span> (!osName.equalsIgnoreCase(<span class="string">"Mac OS X"</span>)) &#123;</span><br><span class="line">            application = <span class="keyword">new</span> Client(<span class="keyword">new</span> MacOSGUIFactory());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            application = <span class="keyword">new</span> Client(<span class="keyword">new</span> WindowsGUIFactory());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h2><ul><li><p><strong>é—®é¢˜</strong>ï¼šå½“ä¸šåŠ¡é€»è¾‘å¿…é¡»ä¸æ¥è‡ªæŸä¸ªäº§å“ç³»åˆ—çš„ä¸åŒäº§å“å˜ä½“ä¸€èµ·è¿è¡Œæ—¶ï¼Œä½†ä½ ä¸å¸Œæœ›å®ƒä¾èµ–æŸä¸ªå…·ä½“çš„äº§å“ç±»åˆ«ï¼ˆæˆ–è€…è¯´å¦‚æœå®ƒä»¬äº‹å…ˆæœªçŸ¥ï¼‰ã€‚</p><p><strong>æ–¹æ¡ˆ</strong>ï¼šæŠ½è±¡å·¥å‚èƒ½å¤Ÿå¯¹å®¢æˆ·ç«¯ä»£ç éšè—å®ƒåˆ›å»ºå…·ä½“äº§å“ç»†èŠ‚ã€‚å®¢æˆ·ç«¯ä»£ç å¯ä»¥ä¸ä»»ä½•å·¥å‚æ‰€ç”Ÿäº§çš„ä»»ä½•äº§å“ä¸€èµ·æ­£å¸¸è¿è¡Œï¼Œåªè¦ä¿è¯å®ƒä»¬ä½¿ç”¨çš„æŠ½è±¡æ¥å£ã€‚</p></li><li><p><strong>é—®é¢˜</strong>ï¼šå½“ä¸€ä¸ªç±»æœ‰å¤šä¸ªFactory Method æ—¶ï¼Œå¯¼è‡´å®ƒè‡ªèº«çš„ä¸»è¦èŒè´£æ¨¡ç³Šä¸æ¸…</p><p><strong>æ–¹æ¡ˆ</strong>ï¼šåœ¨è®¾è®¡è‰¯å¥½çš„ä»£ç é‡Œé¢ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡å¿…é¡»ä¿è¯å•ä¸€èŒè´£åŸåˆ™ã€‚å½“ä¸€ä¸ªç±»å¤„ç†å¤šä¸ªä¸åŒåŒç±»çš„äº§å“ç±»å‹æ—¶ï¼Œå¯èƒ½éœ€è¦ç”¨ç‹¬ç«‹çš„æŠ½è±¡å·¥å‚æ›¿æ¢å¤šä¸ªå·¥å‚æ–¹æ³•ã€‚</p></li></ul><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><ul><li>ç»˜åˆ¶ä¸åŒäº§å“çš„çŸ©é˜µä¸åŒä¸€äº§å“çš„å˜ä½“ã€‚</li><li>ä¸ºæ‰€æœ‰ä¸åŒç±»å‹çš„äº§å“åˆ›å»ºæŠ½è±¡æ¥å£ï¼Œå¹¶ä½¿æ‰€æœ‰å…·ä½“äº§å“éƒ½éµå¾ªè¿™äº›æ¥å£ã€‚</li><li>å£°æ˜æŠ½è±¡å·¥å‚æ¥å£ã€‚ è¯¥æ¥å£åº”åˆ—å‡ºæ‰€æœ‰ä¸åŒç±»å‹äº§å“çš„åˆ›å»ºæ–¹æ³•ã€‚</li><li>é’ˆå¯¹äº§å“ç³»åˆ—çš„æ¯ä¸ªå˜ä½“å®æ–½å•ç‹¬çš„å·¥å‚ç±»åˆ«ã€‚</li><li>åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­åˆ›å»ºä¸€ä¸ªå·¥å‚åˆå§‹åŒ–ä»£ç ã€‚ åº”æ ¹æ®é…ç½®æˆ–å½“å‰ç¯å¢ƒé€‰æ‹©ç±»å‹å¹¶åˆ›å»ºä¸€ä¸ªå…·ä½“çš„å·¥å‚ã€‚</li><li>åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ï¼Œå°†æ‰€æœ‰äº§å“æ„é€ å‡½æ•°è°ƒç”¨æ›¿æ¢ä¸ºå¯¹å·¥å‚å¯¹è±¡ä¸­çš„åˆ›å»ºæ–¹æ³•çš„è°ƒç”¨ã€‚</li></ul><h2 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h2><h4 id="Pros"><a href="#Pros" class="headerlink" title="Pros"></a>Pros</h4><ul><li>éµå¾ªå¼€é—­åŸåˆ™</li><li>å…è®¸æ„å»ºäº§å“å¯¹è±¡ç³»åˆ—å¹¶ä¿è¯å…¶å…¼å®¹æ€§</li><li>é¿å…äº†å…·ä½“äº§å“çš„ä»£ç ä¸ä½¿ç”¨å®ƒä»¬çš„ä»£ç ç›¸äº’æ··æ·†</li><li>å°†å¤šä¸ªç±»å¯¹è±¡é—´çš„èŒè´£åˆ’åˆ†å¼€æ¥</li></ul><h4 id="Cons"><a href="#Cons" class="headerlink" title="Cons"></a>Cons</h4><ul><li>é€šè¿‡åˆ›å»ºå¤šä¸ªé™„åŠ ç±»æ¥å¢åŠ æ•´ä½“ä»£ç çš„å¤æ‚æ€§ã€‚</li></ul><h2 id="JDK-ä¸­çš„è¿ç”¨"><a href="#JDK-ä¸­çš„è¿ç”¨" class="headerlink" title="JDK ä¸­çš„è¿ç”¨"></a>JDK ä¸­çš„è¿ç”¨</h2><ul><li><a href="http://docs.oracle.com/javase/8/docs/api/javax/xml/parsers/DocumentBuilderFactory.html#newInstance--" target="_blank" rel="noopener"><code>javax.xml.parsers.DocumentBuilderFactory#newInstance()</code></a></li><li><a href="http://docs.oracle.com/javase/8/docs/api/javax/xml/transform/TransformerFactory.html#newInstance--" target="_blank" rel="noopener"><code>javax.xml.transform.TransformerFactory#newInstance()</code></a></li><li><a href="http://docs.oracle.com/javase/8/docs/api/javax/xml/xpath/XPathFactory.html#newInstance--" target="_blank" rel="noopener"><code>javax.xml.xpath.XPathFactory#newInstance()</code></a></li></ul><h4 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h4><ul><li><a href="https://github.com/wangweiX/design-patterns/tree/master/src/main/java/one/wangwei/designpatterns/abstractfactory" target="_blank" rel="noopener">æºç </a></li><li><a href="https://refactoring.guru/design-patterns/abstract-factory" target="_blank" rel="noopener">https://refactoring.guru/design-patterns/abstract-factory</a></li><li><a href="https://sourcemaking.com/design_patterns/abstract_factory" target="_blank" rel="noopener">https://sourcemaking.com/design_patterns/abstract_factory</a></li><li>ã€Šå›¾è§£è®¾è®¡æ¨¡å¼ã€‹</li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Design Patterns </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[è®¾è®¡æ¨¡å¼ | å·¥å‚æ–¹æ³•(Factory Method)]]></title>
      <url>/posts/design-patterns-factory-method.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/factory-method-mini-2x.png" alt=""></p><h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p><strong>å·¥å‚æ–¹æ³•</strong>æ˜¯ä¸€ç§åˆ›å»ºå¼è®¾è®¡æ¨¡å¼ï¼Œå®ƒæä¾›äº†ç”¨äºåœ¨è¶…ç±»ä¸­åˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œä½†å…è®¸å­ç±»æ”¹å˜å°†è¦åˆ›å»ºçš„å¯¹è±¡çš„ç±»å‹ã€‚</p><a id="more"></a><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªç‰©æµç®¡ç†åº”ç”¨ç¨‹åºã€‚ æ‚¨çš„åº”ç”¨ç¨‹åºçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬åªèƒ½å¤„ç†å¡è½¦è¿è¾“ï¼Œå› æ­¤å¤§éƒ¨åˆ†ä»£ç éƒ½åœ¨Truckç±»ä¸­ã€‚</p><p>è¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºå˜å¾—éå¸¸æµè¡Œï¼Œä»¥è‡³äºæ‚¨ä¼šæ”¶åˆ°å¤§é‡åŒ…å«æµ·è¿çš„è¯·æ±‚ã€‚</p><p><img src="https://img.i7years.com/blog/factory-method-problem1-2x.png" alt=""></p><p>å¥½æ¶ˆæ¯ï¼Œå¯¹å§ï¼Ÿï¼ ä½†æ˜¯ä»£ç å¦‚ä½•ï¼Ÿ å®ƒçœ‹èµ·æ¥å¤§éƒ¨åˆ†ä»£ç éƒ½ä¸Truckç±»ç›¸å…³è”ã€‚ æ·»åŠ èˆ¹åªéœ€è¦æ›´æ”¹æ•´ä¸ªä»£ç åº“ã€‚ æ­¤å¤–ï¼Œå¦‚æœæ‚¨å†³å®šä¸ºåº”ç”¨ç¨‹åºæ·»åŠ å…¶ä»–ç±»å‹çš„äº¤é€šå·¥å…·ï¼Œåˆ™å¯èƒ½éœ€è¦å†æ¬¡è¿›è¡Œæ‰€æœ‰è¿™äº›æ›´æ”¹ã€‚</p><p>ä½ æœ€ç»ˆä¼šé‡åˆ°ä¸€äº›ä»¤äººè®¨åŒçš„ä»£ç ï¼Œå®ƒä»¬ä¼šæ ¹æ®ä¼ è¾“å¯¹è±¡çš„ç±»åˆ«é€‰æ‹©è¡Œä¸ºã€‚</p><h2 id="æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h2><p>å·¥å‚æ–¹æ³•è®¾è®¡æ¨¡å¼å»ºè®®ä½¿ç”¨ä¸€ä¸ªå«â€å·¥å‚â€çš„æ–¹æ³•æ¥æ›¿ä»£ç›´æ¥é€šè¿‡ new æ¥åˆ›å»ºå¯¹è±¡ã€‚æ„é€ å‡½æ•°è°ƒç”¨åº”è¯¥åœ¨è¯¥æ–¹æ³•å†…ç§»åŠ¨ã€‚ å·¥å‚æ–¹æ³•è¿”å›çš„å¯¹è±¡é€šå¸¸è¢«ç§°ä¸ºâ€œäº§å“â€ã€‚</p><p>å’‹ä¸€çœ‹ä¸Šå»ï¼Œè¿™ä¸€ä¸¾åŠ¨è²Œä¼¼æ¯«æ— æ„ä¹‰ã€‚ä½†æ˜¯ä½ å¯ä»¥åœ¨å­ç±»ä¸­é‡å†™å·¥å‚æ–¹æ³•ï¼Œå¹¶ä¸”æ”¹å˜å°†è¦åˆ›å»ºçš„ç±»å¯¹è±¡ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š</p><p><img src="https://img.i7years.com/blog/factory-method-solution1-2x.png" alt=""></p><p>å½“ç„¶ï¼Œæœ‰ä¸€äº›å°å°çš„é™åˆ¶ï¼šæ‰€æœ‰çš„äº§å“éƒ½å¿…é¡»æœ‰ä¸€ä¸ªé€šç”¨çš„æ¥å£ï¼ˆæ¯”å¦‚Transportï¼‰ã€‚ åŸºç±»ä¸­çš„Factoryæ–¹æ³•åº”è¯¥è¿”å›è¿™ä¸ªé€šç”¨æ¥å£ã€‚</p><p><img src="https://img.i7years.com/blog/fatory-methond-solution2-en-2x.png" alt=""></p><p>åªè¦è¿™äº›äº§å“å…·æœ‰å…±åŒçš„åŸºç±»æˆ–æ¥å£ï¼ˆä¾‹å¦‚å¡è½¦å’Œèˆ¹èˆ¶å®ç°ä¼ è¾“æ¥å£ï¼‰ï¼Œå­ç±»å°±å¯ä»¥è¿”å›ä¸åŒçš„å…·ä½“äº§å“ã€‚</p><p><img src="https://img.i7years.com/blog/fatory-method-solution3-2x.png" alt=""></p><p>å·¥å‚æ–¹æ³•çš„å®¢æˆ·ç«¯å¹¶ä¸å…³å¿ƒå®ƒä»¬æ¥æ”¶åˆ°çš„å…·ä½“äº§å“ç±»å‹ï¼Œå®ƒä»¬é€šè¿‡ä¸€ä¸ªå…±åŒçš„äº§å“æ¥å£æ¥ä¸æ‰€æœ‰çš„å…·ä½“äº§å“ååŒå·¥ä½œã€‚</p><h2 id="æ„é€ "><a href="#æ„é€ " class="headerlink" title="æ„é€ "></a>æ„é€ </h2><p><img src="https://img.i7years.com/blog/fatory-method-structure-2x.png" alt=""></p><h2 id="ä¼ªä»£ç "><a href="#ä¼ªä»£ç " class="headerlink" title="ä¼ªä»£ç "></a>ä¼ªä»£ç </h2><h4 id="åˆ›å»ºäº§å“æ¥å£åŠå…¶å®ç°ç±»"><a href="#åˆ›å»ºäº§å“æ¥å£åŠå…¶å®ç°ç±»" class="headerlink" title="åˆ›å»ºäº§å“æ¥å£åŠå…¶å®ç°ç±»"></a>åˆ›å»ºäº§å“æ¥å£åŠå…¶å®ç°ç±»</h4><p>è¿è¾“æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.designpatterns.factorymethod;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿è¾“</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/05/10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Transport</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€å¿«é€’</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deliver</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¡è½¦è¿è¾“å­ç±»:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.designpatterns.factorymethod;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¡è½¦è¿è¾“</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/05/10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Truck</span> <span class="keyword">implements</span> <span class="title">Transport</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deliver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"Deliver by land in a box. "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ°´è·¯è¿è¾“å­ç±»:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.designpatterns.factorymethod;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ°´è·¯è¿è¾“</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/05/10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Ship</span> <span class="keyword">implements</span> <span class="title">Transport</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deliver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"Deliver by sea in a container. "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºå·¥å‚åŠå…¶å­ç±»"><a href="#åˆ›å»ºå·¥å‚åŠå…¶å­ç±»" class="headerlink" title="åˆ›å»ºå·¥å‚åŠå…¶å­ç±»"></a>åˆ›å»ºå·¥å‚åŠå…¶å­ç±»</h4><p>ç‰©æµæŠ½è±¡ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.designpatterns.factorymethod;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç‰©æµ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/05/10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseLogistics</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">planDelivery</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Transport transport = createTransport();</span><br><span class="line">        transport.deliver();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> Transport <span class="title">createTransport</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é“è·¯è¿è¾“ï¼Œé‡‡ç”¨å¡è½¦</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.designpatterns.factorymethod;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é“è·¯ç‰©æµ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/05/10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RoadLogistics</span> <span class="keyword">extends</span> <span class="title">BaseLogistics</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Transport <span class="title">createTransport</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Truck();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ·è¿ï¼Œé‡‡ç”¨èˆ¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.designpatterns.factorymethod;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ·è¿</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/05/10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SeaLogistics</span> <span class="keyword">extends</span> <span class="title">BaseLogistics</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Transport <span class="title">createTransport</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Ship();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.designpatterns.factorymethod;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wangwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/05/10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        BaseLogistics logistics = <span class="keyword">new</span> RoadLogistics();</span><br><span class="line">        logistics.planDelivery();</span><br><span class="line"></span><br><span class="line">        BaseLogistics logistics1 = <span class="keyword">new</span> SeaLogistics();</span><br><span class="line">        logistics1.planDelivery();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h2><ol><li><p><strong>é—®é¢˜</strong>ï¼šå½“ä½ ä¸çŸ¥é“å¯¹è±¡çš„ç¡®åˆ‡ç±»å‹å’Œä¾èµ–å…³ç³»æ—¶ï¼Œä½ çš„ä»£ç éœ€è¦ä¿è¯å¯ä»¥æ­£å¸¸å·¥ä½œã€‚</p><p>ä¾‹å¦‚ï¼Œä»å¤šä¸ªæ•°æ®æºå»è¯»å’Œå†™å…¥æ•°æ®â€”â€”æ–‡ä»¶ç³»ç»Ÿã€æ•°æ®åº“å’Œç½‘ç»œã€‚è¿™äº›èµ„æºéƒ½æœ‰ä¸åŒçš„ç±»å‹ï¼Œä¾èµ–å…³ç³»å’Œåˆå§‹åŒ–ä»£ç ã€‚</p><p><strong>æ–¹æ¡ˆ</strong></p><p>å·¥å‚æ–¹æ³•å¯ä»¥ä¸€ä¸ªäº§å“çš„å…·ä½“å®ç°ç»†èŠ‚ã€‚ ä¸ºäº†æ”¯æŒæ–°çš„äº§å“ç±»å‹ï¼Œæ‚¨åªéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„å­ç±»å¹¶è¦†ç›–å…¶ä¸­çš„å·¥å‚æ–¹æ³•å³å¯ã€‚</p></li><li><p><strong>é—®é¢˜</strong>ï¼šå½“ä½ æƒ³è¦ä¸ºä½ çš„ç±»åº“æˆ–æ¡†æ¶çš„ç”¨æˆ·æä¾›ä¸€ç§æ–¹å¼ï¼Œå¥½è®©ä»–ä»¬èƒ½å¤Ÿæ‰©å±•è¿™äº›åº“æˆ–æ¡†æ¶çš„å†…éƒ¨ç»„ä»¶ã€‚</p><p><strong>æ–¹æ¡ˆ</strong></p><p>ç”¨æˆ·å¯ä»¥è½»æ¾åœ°å¯¹æŸäº›ç‰¹å®šç»„ä»¶è¿›è¡Œå­ç±»åŒ–ã€‚ ä½†æ˜¯ï¼Œæ¡†æ¶å°†å¦‚ä½•è¯†åˆ«è¯¥å­ç±»å¹¶ä½¿ç”¨å®ƒè€Œä¸æ˜¯æ ‡å‡†ç»„ä»¶å‘¢ï¼Ÿ ç”¨æˆ·å¿…é¡»é‡å†™æ¯ä¸ªåˆ›å»ºæ ‡å‡†ç»„ä»¶å®ä¾‹çš„æ–¹æ³•ï¼Œå¹¶å°†å…¶æ›´æ”¹ä¸ºåˆ›å»ºè‡ªå®šä¹‰å­ç±»çš„å¯¹è±¡ã€‚ è¿™å¾ˆå°´å°¬ï¼Œä¸æ˜¯å—ï¼Ÿ</p><p>æ›´å¥½çš„è§£å†³æ–¹æ¡ˆä¸ä»…æ˜¯ç»™ç”¨æˆ·æä¾›æ‰©å±•ç‰¹å®šç±»çš„æ‰‹æ®µï¼Œè€Œä¸”è¿˜å°†ç”Ÿäº§ç»„ä»¶çš„ä»£ç å‡å°‘åˆ°å•ä¸ªåˆ›å»ºæ–¹æ³•ä¸­ã€‚ æ¢å¥è¯è¯´ï¼Œæä¾›å·¥å‚æ–¹æ³•ã€‚</p><p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨ä½¿ç”¨ä¸€ä¸ªå¼€æºçš„UIæ¡†æ¶å¼€å‘APPï¼Œä½ çš„APPéœ€è¦ä¸€ä¸ªåœ†å‹æŒ‰é’®ï¼Œä½†æ˜¯è¿™ä¸ªæ¡†æ¶åªæä¾›çš„æ–¹å½¢æŒ‰é’®ã€‚</p><p>ä½ è¦åšçš„ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯å®ç° <code>RoundButton</code> ç±»ã€‚ä½†æ˜¯ç°åœ¨ä½ éœ€è¦å‘Šè¯‰ <code>UIFramework</code> ç±»å»ä½¿ç”¨æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯é»˜è®¤å¯¹è±¡ã€‚</p><p>ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªå­ç±» <code>UIWithRoundButtons</code> å¹¶ä¸”é‡å†™ <code>createButton</code> æ–¹æ³•. è¿™ä¸ªæ–¹æ³•ä»ç„¶è¿”å› <code>Button</code> ç±»ï¼Œä½†æ˜¯ä½ çš„æ–°å­ç±»å°†ä¼šæä¾› <code>RoundButton</code> å¯¹è±¡ã€‚ç°åœ¨ï¼Œåœ¨ä½ çš„Appä¸­ï¼Œä½ éœ€è¦ä½¿ç”¨ <code>UIWithRoundButtons</code> è€Œä¸æ˜¯ <code>UIFramework</code> æ¥åˆå§‹åŒ–è¿™ä¸ªæ¡†æ¶ã€‚</p></li><li><p><strong>é—®é¢˜</strong>ï¼šå½“ä½ æƒ³è¦ä¿å­˜ç³»ç»Ÿèµ„æºå¹¶ä¸”é‡ç”¨å·²ç»å­˜åœ¨çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚</p><p>ä¾‹å¦‚ï¼Œå½“å¤„ç†å¤§çš„æˆ–è€…èµ„æºå¯†é›†æ€§çš„å¯¹è±¡ï¼Œä¾‹å¦‚æ•°æ®åº“è¿æ¥ï¼Œç­‰ç­‰ã€‚</p><p>æ–¹æ¡ˆï¼š</p><p>æƒ³è±¡ä¸€ä¸‹ï¼Œé‡å¤ä½¿ç”¨ç°æœ‰å¯¹è±¡éœ€è¦åšå¤šå°‘å·¥ä½œï¼š</p><ul><li>é¦–å…ˆï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªæ± æ¥ä¿ç•™ç°æœ‰çš„å¯¹è±¡ã€‚</li><li>å½“æœ‰äººè¯·æ±‚ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä½ ä¼šåœ¨è¯¥æ± å†…å¯»æ‰¾ä¸€ä¸ªç©ºé—²å¯¹è±¡ã€‚</li><li>â€¦å¹¶å°†å…¶è¿”å›ç»™å®¢æˆ·ç«¯ä»£ç ã€‚</li><li>åªæœ‰åœ¨æ²¡æœ‰ç©ºé—²å¯¹è±¡æ—¶ï¼Œæ‰ä¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼ˆå¹¶å°†å…¶æ·»åŠ åˆ°æ± ä¸­ï¼‰ã€‚</li></ul><p>æ­¤ä»£ç å¿…é¡»æ”¾ç½®åœ¨æŸå¤„ã€‚ æœ€æ–¹ä¾¿çš„åœ°æ–¹æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚ è¿™æ ·ï¼Œåªè¦æœ‰äººè¯•å›¾åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€æœ‰è¿™äº›æ£€æŸ¥éƒ½ä¼šè¢«æ‰§è¡Œã€‚ ä½†æ˜¯ï¼Œå”‰ï¼Œæ„é€ å‡½æ•°å¿…é¡»æŒ‰ç…§å®šä¹‰è¿”å›æ–°å¯¹è±¡ï¼Œæ‰€ä»¥å®ƒä»¬ä¸èƒ½è¿”å›ç°æœ‰çš„å®ä¾‹ã€‚</p></li></ol><h2 id="å¦‚ä½•åš"><a href="#å¦‚ä½•åš" class="headerlink" title="å¦‚ä½•åš"></a>å¦‚ä½•åš</h2><ol><li><p>æå–æ‰€æœ‰äº§å“çš„é€šç”¨æ¥å£ã€‚ è¿™ä¸ªæ¥å£åº”è¯¥å£°æ˜å¯¹æ¯ä¸ªäº§å“éƒ½æœ‰æ„ä¹‰çš„æ–¹æ³•ã€‚</p></li><li><p>åœ¨åˆ›å»ºè€…ç±»ä¸­æ·»åŠ ä¸€ä¸ªç©ºçš„å·¥å‚æ–¹æ³•ã€‚ å…¶æ–¹æ³•ç­¾ååº”è¿”å›äº§å“æ¥å£ç±»å‹ã€‚</p></li><li><p>æŸ¥çœ‹åˆ›å»ºè€…çš„ä»£ç å¹¶æŸ¥æ‰¾å¯¹äº§å“æ„é€ å‡½æ•°çš„æ‰€æœ‰å¼•ç”¨ã€‚ ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°å°†å®ƒä»¬æ›¿æ¢ä¸ºå¯¹å·¥å‚æ–¹æ³•çš„è°ƒç”¨ï¼Œä½†å°†äº§å“åˆ›å»ºä»£ç æå–åˆ°å·¥å‚æ–¹æ³•ã€‚</p><p>æ‚¨å¯èƒ½éœ€è¦å‘å·¥å‚æ–¹æ³•æ·»åŠ ä¸€ä¸ªä¸´æ—¶å‚æ•°ï¼Œè¯¥å‚æ•°å°†ç”¨äºæ§åˆ¶å°†åˆ›å»ºå“ªä¸ªäº§å“ã€‚</p><p>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œå·¥å‚æ–¹æ³•çš„ä»£ç å¯èƒ½çœ‹èµ·æ¥å¾ˆä¸‘é™‹ã€‚ å®ƒå¯èƒ½æœ‰ä¸€ä¸ªå¤§çš„å¼€å…³æ“ä½œå‘˜ï¼Œå¯ä»¥é€‰æ‹©è¦å®ä¾‹åŒ–çš„äº§å“ç±»åˆ«ã€‚ ä½†åˆ«æ‹…å¿ƒï¼Œæˆ‘ä»¬ä¼šé©¬ä¸Šä¿®å¤å®ƒã€‚</p></li><li><p>ç°åœ¨ï¼Œåœ¨å­ç±»ä¸­è¦†ç›–å·¥å‚æ–¹æ³•ï¼Œå¹¶åœ¨baseæ–¹æ³•ä¸­ä»switchæ“ä½œç¬¦ä¸­ç§»å‡ºç›¸åº”çš„æ¡ä»¶ã€‚</p></li><li><p>åœ¨åŸºç¡€åˆ›å»ºè€…ç±»ä¸­ç”¨åˆ°çš„æ§åˆ¶å‚æ•°ä¹Ÿèƒ½å¤Ÿç”¨åˆ°å­ç±»å½“ä¸­</p><p>ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½æ‹¥æœ‰ä¸€ä¸ªåˆ›å»ºè€…çš„å±‚æ¬¡ç»“æ„ï¼Œå…¶ä¸­åŒ…å«åŸºç±» <code>Mail</code> ä»¥åŠ<code>Air</code>å’Œ<code>Ground</code>ç±»ä»¥åŠäº§å“ç±»ï¼š<code>Plane</code>ï¼Œ<code>Truck</code>å’Œ<code>Train</code>ã€‚ <code>Air</code>ä¸<code>Plane</code> ç›¸åŒ¹é…ï¼ŒåŒæ—¶<code>Ground</code>ä¸<code>Truck</code>å’Œ<code>Train</code>åŒæ—¶åŒ¹é…ã€‚ æ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„å­ç±»æ¥å¤„ç†è¿™ä¸¤ç§æƒ…å†µï¼Œä½†è¿˜æœ‰å¦ä¸€ç§é€‰æ‹©ã€‚ å®¢æˆ·ç«¯ä»£ç å¯ä»¥å°†å‚æ•°ä¼ é€’ç»™Groundç±»çš„å·¥å‚æ–¹æ³•ï¼Œä»¥æ§åˆ¶å®ƒæ¥æ”¶çš„äº§å“ã€‚</p></li><li><p>å¦‚æœåŸºç¡€å·¥å‚æ–¹æ³•åœ¨å®Œæˆä»£ç çš„è¿ç§»åå˜æˆäº†ç©ºå£³ï¼Œåˆ™å¯ä»¥å°†å…¶æŠ½è±¡åŒ–ã€‚</p></li></ol><h2 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h2><h4 id="Pros"><a href="#Pros" class="headerlink" title="Pros"></a>Pros</h4><ul><li>éµå¾ªäº†å¼€é—­åŸåˆ™ã€‚</li><li>é¿å…äº†å…·ä½“äº§å“å’Œä½¿ç”¨å®ƒä»¬çš„ä»£ç ä¹‹é—´çš„ç´§å¯†è€¦åˆã€‚</li><li>ç”±äºå°†æ‰€æœ‰åˆ›å»ºä»£ç ç§»åŠ¨åˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œå› æ­¤ç®€åŒ–äº†ä»£ç ã€‚</li><li>å‘ç¨‹åºæ·»åŠ ä¸€ä¸ªæ–°çš„äº§å“å˜å¾—éå¸¸æ–¹ä¾¿ã€‚</li></ul><h4 id="Cons"><a href="#Cons" class="headerlink" title="Cons"></a>Cons</h4><ul><li>éœ€è¦é¢å¤–çš„å­ç±»ã€‚</li></ul><h2 id="JDKä¸­çš„è¿ç”¨"><a href="#JDKä¸­çš„è¿ç”¨" class="headerlink" title="JDKä¸­çš„è¿ç”¨"></a>JDKä¸­çš„è¿ç”¨</h2><ul><li><a href="http://docs.oracle.com/javase/8/docs/api/java/util/Calendar.html#getInstance--" target="_blank" rel="noopener"><code>java.util.Calendar#getInstance()</code></a></li><li><a href="http://docs.oracle.com/javase/8/docs/api/java/util/ResourceBundle.html#getBundle-java.lang.String-" target="_blank" rel="noopener"><code>java.util.ResourceBundle#getBundle()</code></a></li><li><a href="http://docs.oracle.com/javase/8/docs/api/java/text/NumberFormat.html#getInstance--" target="_blank" rel="noopener"><code>java.text.NumberFormat#getInstance()</code></a></li><li><a href="http://docs.oracle.com/javase/8/docs/api/java/nio/charset/Charset.html#forName-java.lang.String-" target="_blank" rel="noopener"><code>java.nio.charset.Charset#forName()</code></a></li><li><a href="http://docs.oracle.com/javase/8/docs/api/java/net/URLStreamHandlerFactory.html" target="_blank" rel="noopener"><code>java.net.URLStreamHandlerFactory#createURLStreamHandler(String)</code></a> (Returns different singleton objects, depending on a protocol)</li><li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/EnumSet.html#of(E" target="_blank" rel="noopener"><code>java.util.EnumSet#of()</code></a>)</li><li><a href="https://docs.oracle.com/javase/8/docs/api/javax/xml/bind/JAXBContext.html#createMarshaller--" target="_blank" rel="noopener"><code>javax.xml.bind.JAXBContext#createMarshaller()</code></a> and other similar methods.</li></ul><h4 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h4><ul><li><a href="https://github.com/wangweiX/design-patterns/blob/master/src/main/java/one/wangwei/designpatterns/factorymethod" target="_blank" rel="noopener">æºç </a></li><li><a href="https://github.com/wangweiX/java-design-patterns/tree/master/factory-method" target="_blank" rel="noopener">https://github.com/wangweiX/java-design-patterns/tree/master/factory-method</a></li><li><a href="https://refactoring.guru/design-patterns/factory-method" target="_blank" rel="noopener">https://refactoring.guru/design-patterns/factory-method</a></li><li><a href="https://sourcemaking.com/design_patterns/factory_method" target="_blank" rel="noopener">https://sourcemaking.com/design_patterns/factory_method</a></li><li>ã€Šå›¾è§£è®¾è®¡æ¨¡å¼ã€‹</li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Design Patterns </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[çº¿ç¨‹IOæ¨¡å‹ä»‹ç»]]></title>
      <url>/posts/server-thread-io-model-reactor-proactor.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼š<a href="https://juejin.im/post/5b8f23b96fb9a019ec6a133d" target="_blank" rel="noopener">https://juejin.im/post/5b8f23b96fb9a019ec6a133d</a></p></blockquote><p>å‰é¢ï¼Œæˆ‘ä»¬äº†è§£åˆ°äº†æœåŠ¡å™¨å¦‚ä½•åŸºäºI/Oæ¨¡å‹ç®¡ç†è¿æ¥ï¼Œè·å–è¾“å…¥æ•°æ®ï¼Œä¸‹é¢ä»‹ç»åŸºäºè¿›ç¨‹/çº¿ç¨‹æ¨¡å‹ï¼ŒæœåŠ¡å™¨å¦‚ä½•å¤„ç†è¯·æ±‚ã€‚</p><a id="more"></a><p>å€¼å¾—è¯´æ˜çš„æ˜¯ï¼Œå…·ä½“é€‰æ‹©çº¿ç¨‹è¿˜æ˜¯è¿›ç¨‹ï¼Œæ›´å¤šæ˜¯ä¸å¹³å°åŠç¼–ç¨‹è¯­è¨€ç›¸å…³ï¼Œä¾‹å¦‚Cè¯­è¨€ä½¿ç”¨çº¿ç¨‹å’Œè¿›ç¨‹éƒ½å¯ä»¥(ä¾‹å¦‚Nginxä½¿ç”¨è¿›ç¨‹ï¼ŒMemcachedä½¿ç”¨çº¿ç¨‹)ï¼ŒJavaè¯­è¨€ä¸€èˆ¬ä½¿ç”¨çº¿ç¨‹(ä¾‹å¦‚Netty)ï¼Œä¸ºäº†æè¿°æ–¹ä¾¿ï¼Œä¸‹é¢éƒ½ä½¿ç”¨çº¿ç¨‹æ¥è¿›ç¨‹æè¿°ã€‚</p><h3 id="ä¼ ç»Ÿé˜»å¡I-OæœåŠ¡æ¨¡å‹"><a href="#ä¼ ç»Ÿé˜»å¡I-OæœåŠ¡æ¨¡å‹" class="headerlink" title="ä¼ ç»Ÿé˜»å¡I/OæœåŠ¡æ¨¡å‹"></a>ä¼ ç»Ÿé˜»å¡I/OæœåŠ¡æ¨¡å‹</h3><p><img src="https://img.i7years.com/blog/Blocking IO Server.png" alt="Blocking IO Server"></p><p><strong>ç‰¹ç‚¹</strong></p><ul><li>é‡‡ç”¨é˜»å¡å¼I/Oæ¨¡å‹è·å–è¾“å…¥æ•°æ®</li><li>æ¯ä¸ªè¿æ¥éƒ½éœ€è¦ç‹¬ç«‹çš„çº¿ç¨‹å®Œæˆæ•°æ®è¾“å…¥ï¼Œä¸šåŠ¡å¤„ç†ï¼Œæ•°æ®è¿”å›çš„å®Œæ•´æ“ä½œ</li></ul><p><strong>å­˜åœ¨é—®é¢˜</strong></p><ul><li>å½“å¹¶å‘æ•°è¾ƒå¤§æ—¶ï¼Œéœ€è¦åˆ›å»ºå¤§é‡çº¿ç¨‹æ¥å¤„ç†è¿æ¥ï¼Œç³»ç»Ÿèµ„æºå ç”¨è¾ƒå¤§</li><li>è¿æ¥å»ºç«‹åï¼Œå¦‚æœå½“å‰çº¿ç¨‹æš‚æ—¶æ²¡æœ‰æ•°æ®å¯è¯»ï¼Œåˆ™çº¿ç¨‹å°±é˜»å¡åœ¨readæ“ä½œä¸Šï¼Œé€ æˆçº¿ç¨‹èµ„æºæµªè´¹</li></ul><h3 id="Reactoræ¨¡å¼"><a href="#Reactoræ¨¡å¼" class="headerlink" title="Reactoræ¨¡å¼"></a>Reactoræ¨¡å¼</h3><p>é’ˆå¯¹ä¼ ç»Ÿé˜»å¡I/OæœåŠ¡æ¨¡å‹çš„2ä¸ªç¼ºç‚¹ï¼Œæ¯”è¾ƒå¸¸è§çš„è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><ul><li>åŸºäºI/Oå¤ç”¨æ¨¡å‹ï¼Œå¤šä¸ªè¿æ¥å…±ç”¨ä¸€ä¸ªé˜»å¡å¯¹è±¡ï¼Œåº”ç”¨ç¨‹åºåªéœ€è¦åœ¨ä¸€ä¸ªé˜»å¡å¯¹è±¡ä¸Šç­‰å¾…ï¼Œæ— éœ€é˜»å¡ç­‰å¾…æ‰€æœ‰è¿æ¥ã€‚å½“æŸæ¡è¿æ¥æœ‰æ–°çš„æ•°æ®å¯ä»¥å¤„ç†æ—¶ï¼Œæ“ä½œç³»ç»Ÿé€šçŸ¥åº”ç”¨ç¨‹åºï¼Œçº¿ç¨‹ä»é˜»å¡çŠ¶æ€è¿”å›ï¼Œå¼€å§‹è¿›è¡Œä¸šåŠ¡å¤„ç†</li><li>åŸºäºçº¿ç¨‹æ± å¤ç”¨çº¿ç¨‹èµ„æºï¼Œä¸å¿…å†ä¸ºæ¯ä¸ªè¿æ¥åˆ›å»ºçº¿ç¨‹ï¼Œå°†è¿æ¥å®Œæˆåçš„ä¸šåŠ¡å¤„ç†ä»»åŠ¡åˆ†é…ç»™çº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤„ç†å¤šä¸ªè¿æ¥çš„ä¸šåŠ¡ã€‚</li></ul><p>I/Oå¤ç”¨ + çº¿ç¨‹æ± ï¼Œè¿™å°±æ˜¯Reactoræ¨¡å¼çš„åŸºæœ¬è®¾è®¡æ€æƒ³</p><p><img src="https://img.i7years.com/blog/Reactor.png" alt="Reactor"></p><p><strong>Reactoræ¨¡å¼</strong>ï¼šæŒ‡é€šè¿‡ä¸€ä¸ªæˆ–å¤šä¸ªè¾“å…¥åŒæ—¶ä¼ é€’ç»™æœåŠ¡å¤„ç†å™¨çš„æœåŠ¡è¯·æ±‚çš„äº‹ä»¶é©±åŠ¨å¤„ç†æ¨¡å¼ã€‚æœåŠ¡ç«¯ç¨‹åºå¤„ç†ä¼ å…¥å¤šè·¯è¯·æ±‚ï¼Œå¹¶å°†å®ƒä»¬åŒæ­¥åˆ†æ´¾ç»™è¯·æ±‚å¯¹åº”çš„å¤„ç†çº¿ç¨‹ï¼ŒReactoræ¨¡å¼ä¹Ÿå«Dispatcheræ¨¡å¼ï¼Œå³ I/Oå¤šè·¯å¤ç”¨ç»Ÿä¸€ç›‘å¬äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶ååˆ†å‘ï¼ˆDispatchç»™æŸè¿›ç¨‹ï¼‰ã€‚</p><p>Reactoræ¨¡å¼ä¸­çš„2ä¸ªå…³é”®ç»„æˆï¼š</p><ul><li><strong>Reactor</strong>ã€‚Reactoråœ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ä¸­è¿è¡Œï¼Œè´Ÿè´£ç›‘å¬å’Œåˆ†å‘äº‹ä»¶ï¼Œåˆ†å‘ç»™é€‚å½“çš„å¤„ç†ç¨‹åºæ¥å¯¹IOäº‹ä»¶ä½œå‡ºååº”ã€‚å®ƒå°±åƒå…¬å¸çš„ç”µè¯æ¥çº¿å‘˜ï¼Œå®ƒæ¥å¬æ¥è‡ªå®¢æˆ·çš„ç”µè¯å¹¶å°†çº¿è·¯è½¬ç§»åˆ°é€‚å½“çš„è”ç³»äºº</li><li><strong>Handlers</strong>ã€‚å¤„ç†ç¨‹åºæ‰§è¡ŒI/Oäº‹ä»¶è¦å®Œæˆçš„å®é™…äº‹ä»¶ï¼Œç±»ä¼¼äºå®¢æˆ·æƒ³è¦ä¸ä¹‹äº¤è°ˆçš„å…¬å¸ä¸­å®é™…è´Ÿè´£äººã€‚Reactoré€šè¿‡é€‚åº¦é€‚å½“çš„å¤„ç†ç¨‹åºæ¥å“åº”I/Oäº‹ä»¶ï¼Œå¤„ç†ç¨‹åºæ‰§è¡Œéé˜»å¡æ“ä½œ</li></ul><p>æ ¹æ®Reactorçš„æ•°é‡å’Œå¤„ç†èµ„æºæ± çº¿ç¨‹æ•°é‡çš„ä¸åŒï¼Œæœ‰3ç§å…¸å‹çš„å®ç°ï¼š</p><ul><li>å• Reactor å•çº¿ç¨‹</li><li>å• Reactor å¤šçº¿ç¨‹</li><li>ä¸»ä» Reactor å¤šçº¿ç¨‹</li></ul><h4 id="å•Reactorå•çº¿ç¨‹"><a href="#å•Reactorå•çº¿ç¨‹" class="headerlink" title="å•Reactorå•çº¿ç¨‹"></a>å•Reactorå•çº¿ç¨‹</h4><p><img src="https://img.i7years.com/blog/Single Reactor Thread.png" alt="Single Reactor Thread"></p><p>å…¶ä¸­ï¼Œselectæ˜¯å‰é¢<strong>I/Oå¤ç”¨æ¨¡å‹</strong>ä»‹ç»çš„æ ‡å‡†ç½‘ç»œç¼–ç¨‹APIï¼Œå¯ä»¥å®ç°åº”ç”¨ç¨‹åºé€šè¿‡ä¸€ä¸ªé˜»å¡å¯¹è±¡ç›‘å¬å¤šè·¯è¿æ¥è¯·æ±‚ï¼Œå…¶ä»–æ–¹æ¡ˆç¤ºæ„å›¾ç±»ä¼¼</p><p><strong>æ–¹æ¡ˆè¯´æ˜</strong></p><ul><li>Reactorå¯¹è±¡é€šè¿‡selectç›‘æ§å®¢æˆ·ç«¯è¯·æ±‚äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åé€šè¿‡dispatchè¿›è¡Œåˆ†å‘</li><li>å¦‚æœæ˜¯å»ºç«‹è¿æ¥è¯·æ±‚äº‹ä»¶ï¼Œåˆ™ç”±Acceptoré€šè¿‡acceptå¤„ç†è¿æ¥è¯·æ±‚ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªHandlerå¯¹è±¡å¤„ç†è¿æ¥å®Œæˆåçš„åç»­ä¸šåŠ¡å¤„ç†</li><li>å¦‚æœä¸æ˜¯å»ºç«‹è¿æ¥äº‹ä»¶ï¼Œåˆ™Reactorä¼šåˆ†å‘è°ƒç”¨è¿æ¥å¯¹åº”çš„Handleræ¥å“åº”</li><li>Handlerä¼šå®Œæˆread-&gt;ä¸šåŠ¡å¤„ç†-&gt;sendçš„å®Œæ•´ä¸šåŠ¡æµç¨‹</li></ul><p><strong>ä¼˜ç‚¹</strong> æ¨¡å‹ç®€å•ï¼Œæ²¡æœ‰å¤šçº¿ç¨‹ã€è¿›ç¨‹é€šä¿¡ã€ç«äº‰çš„é—®é¢˜ï¼Œå…¨éƒ¨éƒ½åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å®Œæˆ</p><p><strong>ç¼ºç‚¹</strong></p><ul><li>æ€§èƒ½é—®é¢˜ï¼šåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œæ— æ³•å®Œå…¨å‘æŒ¥å¤šæ ¸CPUçš„æ€§èƒ½ Handleråœ¨å¤„ç†æŸä¸ªè¿æ¥ä¸Šçš„ä¸šåŠ¡æ—¶ï¼Œæ•´ä¸ªè¿›ç¨‹æ— æ³•å¤„ç†å…¶ä»–è¿æ¥äº‹ä»¶ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´æ€§èƒ½ç“¶é¢ˆ</li><li>å¯é æ€§é—®é¢˜ï¼šçº¿ç¨‹æ„å¤–è·‘é£ï¼Œæˆ–è€…è¿›å…¥æ­»å¾ªç¯ï¼Œä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿé€šä¿¡æ¨¡å—ä¸å¯ç”¨ï¼Œä¸èƒ½æ¥æ”¶å’Œå¤„ç†å¤–éƒ¨æ¶ˆæ¯ï¼Œé€ æˆèŠ‚ç‚¹æ•…éšœ</li></ul><p><strong>ä½¿ç”¨åœºæ™¯</strong> å®¢æˆ·ç«¯çš„æ•°é‡æœ‰é™ï¼Œä¸šåŠ¡å¤„ç†éå¸¸å¿«é€Ÿï¼Œæ¯”å¦‚Redisï¼Œä¸šåŠ¡å¤„ç†çš„æ—¶é—´å¤æ‚åº¦O(1)</p><h4 id="å•Reactorå¤šçº¿ç¨‹"><a href="#å•Reactorå¤šçº¿ç¨‹" class="headerlink" title="å•Reactorå¤šçº¿ç¨‹"></a>å•Reactorå¤šçº¿ç¨‹</h4><p><img src="https://img.i7years.com/blog/Single Reactor Mutil Thread.png" alt="Single Reactor Mutil Thread"></p><p><strong>æ–¹æ¡ˆè¯´æ˜</strong></p><ul><li>Reactorå¯¹è±¡é€šè¿‡selectç›‘æ§å®¢æˆ·ç«¯è¯·æ±‚äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åé€šè¿‡dispatchè¿›è¡Œåˆ†å‘</li><li>å¦‚æœæ˜¯å»ºç«‹è¿æ¥è¯·æ±‚äº‹ä»¶ï¼Œåˆ™ç”±Acceptoré€šè¿‡acceptå¤„ç†è¿æ¥è¯·æ±‚ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªHandlerå¯¹è±¡å¤„ç†è¿æ¥å®Œæˆåçš„ç»­å„ç§äº‹ä»¶</li><li>å¦‚æœä¸æ˜¯å»ºç«‹è¿æ¥äº‹ä»¶ï¼Œåˆ™Reactorä¼šåˆ†å‘è°ƒç”¨è¿æ¥å¯¹åº”çš„Handleræ¥å“åº”</li><li>Handleråªè´Ÿè´£å“åº”äº‹ä»¶ï¼Œä¸åšå…·ä½“ä¸šåŠ¡å¤„ç†ï¼Œé€šè¿‡readè¯»å–æ•°æ®åï¼Œä¼šåˆ†å‘ç»™åé¢çš„Workerçº¿ç¨‹æ± è¿›è¡Œä¸šåŠ¡å¤„ç†</li><li>Workerçº¿ç¨‹æ± ä¼šåˆ†é…ç‹¬ç«‹çš„çº¿ç¨‹å®ŒæˆçœŸæ­£çš„ä¸šåŠ¡å¤„ç†ï¼Œå¦‚ä½•å°†å“åº”ç»“æœå‘ç»™Handlerè¿›è¡Œå¤„ç†</li><li>Handleræ”¶åˆ°å“åº”ç»“æœåé€šè¿‡sendå°†å“åº”ç»“æœè¿”å›ç»™client</li></ul><p><strong>ä¼˜ç‚¹</strong> å¯ä»¥å……åˆ†åˆ©ç”¨å¤šæ ¸CPUçš„å¤„ç†èƒ½åŠ›</p><p><strong>ç¼ºç‚¹</strong></p><ul><li>å¤šçº¿ç¨‹æ•°æ®å…±äº«å’Œè®¿é—®æ¯”è¾ƒå¤æ‚</li><li>Reactoræ‰¿æ‹…æ‰€æœ‰äº‹ä»¶çš„ç›‘å¬å’Œå“åº”ï¼Œåœ¨å•çº¿ç¨‹ä¸­è¿è¡Œï¼Œé«˜å¹¶å‘åœºæ™¯ä¸‹å®¹æ˜“æˆä¸ºæ€§èƒ½ç“¶é¢ˆ</li></ul><h4 id="ä¸»ä»Reactorå¤šçº¿ç¨‹"><a href="#ä¸»ä»Reactorå¤šçº¿ç¨‹" class="headerlink" title="ä¸»ä»Reactorå¤šçº¿ç¨‹"></a>ä¸»ä»Reactorå¤šçº¿ç¨‹</h4><p>é’ˆå¯¹å•Reactorå¤šçº¿ç¨‹æ¨¡å‹ä¸­ï¼ŒReactoråœ¨å•çº¿ç¨‹ä¸­è¿è¡Œï¼Œé«˜å¹¶å‘åœºæ™¯ä¸‹å®¹æ˜“æˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼Œå¯ä»¥è®©Reactoråœ¨å¤šçº¿ç¨‹ä¸­è¿è¡Œ</p><p><img src="https://img.i7years.com/blog/Master-slave Reactor Mutil Thread.png" alt="Master-slave Reactor Mutil Thread"></p><p><strong>æ–¹æ¡ˆè¯´æ˜</strong></p><ul><li>Reactorä¸»çº¿ç¨‹MainReactorå¯¹è±¡é€šè¿‡selectç›‘æ§å»ºç«‹è¿æ¥äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åé€šè¿‡Acceptoræ¥æ”¶ï¼Œå¤„ç†å»ºç«‹è¿æ¥äº‹ä»¶</li><li>Acceptorå¤„ç†å»ºç«‹è¿æ¥äº‹ä»¶åï¼ŒMainReactorå°†è¿æ¥åˆ†é…Reactorå­çº¿ç¨‹ç»™SubReactorè¿›è¡Œå¤„ç†</li><li>SubReactorå°†è¿æ¥åŠ å…¥è¿æ¥é˜Ÿåˆ—è¿›è¡Œç›‘å¬ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªHandlerç”¨äºå¤„ç†å„ç§è¿æ¥äº‹ä»¶</li><li>å½“æœ‰æ–°çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼ŒSubReactorä¼šè°ƒç”¨è¿æ¥å¯¹åº”çš„Handlerè¿›è¡Œå“åº”</li><li>Handleré€šè¿‡readè¯»å–æ•°æ®åï¼Œä¼šåˆ†å‘ç»™åé¢çš„Workerçº¿ç¨‹æ± è¿›è¡Œä¸šåŠ¡å¤„ç†</li><li>Workerçº¿ç¨‹æ± ä¼šåˆ†é…ç‹¬ç«‹çš„çº¿ç¨‹å®ŒæˆçœŸæ­£çš„ä¸šåŠ¡å¤„ç†ï¼Œå¦‚ä½•å°†å“åº”ç»“æœå‘ç»™Handlerè¿›è¡Œå¤„ç†</li><li>Handleræ”¶åˆ°å“åº”ç»“æœåé€šè¿‡sendå°†å“åº”ç»“æœè¿”å›ç»™client</li></ul><p><strong>ä¼˜ç‚¹</strong></p><ul><li>çˆ¶çº¿ç¨‹ä¸å­çº¿ç¨‹çš„æ•°æ®äº¤äº’ç®€å•èŒè´£æ˜ç¡®ï¼Œçˆ¶çº¿ç¨‹åªéœ€è¦æ¥æ”¶æ–°è¿æ¥ï¼Œå­çº¿ç¨‹å®Œæˆåç»­çš„ä¸šåŠ¡å¤„ç†</li><li>çˆ¶çº¿ç¨‹ä¸å­çº¿ç¨‹çš„æ•°æ®äº¤äº’ç®€å•ï¼ŒReactorä¸»çº¿ç¨‹åªéœ€è¦æŠŠæ–°è¿æ¥ä¼ ç»™å­çº¿ç¨‹ï¼Œå­çº¿ç¨‹æ— éœ€è¿”å›æ•°æ®</li></ul><p>è¿™ç§æ¨¡å‹åœ¨è®¸å¤šé¡¹ç›®ä¸­å¹¿æ³›ä½¿ç”¨ï¼ŒåŒ…æ‹¬Nginxä¸»ä»Reactorå¤šè¿›ç¨‹æ¨¡å‹ï¼ŒMemcachedä¸»ä»å¤šçº¿ç¨‹ï¼ŒNettyä¸»ä»å¤šçº¿ç¨‹æ¨¡å‹çš„æ”¯æŒã€‚</p><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>3ç§æ¨¡å¼å¯ä»¥ç”¨ä¸ªæ¯”å–»æ¥ç†è§£ï¼š é¤å…å¸¸å¸¸é›‡ä½£æ¥å¾…å‘˜è´Ÿè´£è¿æ¥é¡¾å®¢ï¼Œå½“é¡¾å®¢å…¥ååï¼Œä¾åº”ç”Ÿä¸“é—¨ä¸ºè¿™å¼ æ¡Œå­æœåŠ¡</p><ul><li>å•Reactorå•çº¿ç¨‹ï¼šæ¥å¾…å‘˜å’Œä¾åº”ç”Ÿæ˜¯åŒä¸€ä¸ªäººï¼Œå…¨ç¨‹ä¸ºé¡¾å®¢æœåŠ¡</li><li>å•Reactorå¤šçº¿ç¨‹ï¼š1ä¸ªæ¥å¾…å‘˜ï¼Œå¤šä¸ªä¾åº”ç”Ÿï¼Œæ¥å¾…å‘˜åªè´Ÿè´£æ¥å¾…</li><li>ä¸»ä»Reactorå¤šçº¿ç¨‹ï¼šå¤šä¸ªæ¥å¾…å‘˜ï¼Œå¤šä¸ªä¾åº”ç”Ÿ</li></ul><p>Reactoræ¨¡å¼å…·æœ‰å¦‚ä¸‹çš„ä¼˜ç‚¹ï¼š</p><ul><li>å“åº”å¿«ï¼Œä¸å¿…ä¸ºå•ä¸ªåŒæ­¥æ—¶é—´æ‰€é˜»å¡ï¼Œè™½ç„¶Reactoræœ¬èº«ä¾ç„¶æ˜¯åŒæ­¥çš„</li><li>ç¼–ç¨‹ç›¸å¯¹ç®€å•ï¼Œå¯ä»¥æœ€å¤§ç¨‹åº¦çš„é¿å…å¤æ‚çš„å¤šçº¿ç¨‹åŠåŒæ­¥é—®é¢˜ï¼Œå¹¶ä¸”é¿å…äº†å¤šçº¿ç¨‹/è¿›ç¨‹çš„åˆ‡æ¢å¼€é”€ï¼›</li><li>å¯æ‰©å±•æ€§ï¼Œå¯ä»¥æ–¹ä¾¿çš„é€šè¿‡å¢åŠ Reactorå®ä¾‹ä¸ªæ•°æ¥å……åˆ†åˆ©ç”¨CPUèµ„æº</li><li>å¯å¤ç”¨æ€§ï¼ŒReactoræ¨¡å‹æœ¬èº«ä¸å…·ä½“äº‹ä»¶å¤„ç†é€»è¾‘æ— å…³ï¼Œå…·æœ‰å¾ˆé«˜çš„å¤ç”¨æ€§</li></ul><h3 id="Proactoræ¨¡å‹"><a href="#Proactoræ¨¡å‹" class="headerlink" title="Proactoræ¨¡å‹"></a>Proactoræ¨¡å‹</h3><p>åœ¨Reactoræ¨¡å¼ä¸­ï¼ŒReactorç­‰å¾…æŸä¸ªäº‹ä»¶æˆ–è€…å¯åº”ç”¨æˆ–ä¸ªæ“ä½œçš„çŠ¶æ€å‘ç”Ÿï¼ˆæ¯”å¦‚æ–‡ä»¶æè¿°ç¬¦å¯è¯»å†™ï¼Œæˆ–è€…æ˜¯socketå¯è¯»å†™ï¼‰ï¼Œç„¶åæŠŠè¿™ä¸ªäº‹ä»¶ä¼ ç»™äº‹å…ˆæ³¨å†Œçš„Handlerï¼ˆäº‹ä»¶å¤„ç†å‡½æ•°æˆ–è€…å›è°ƒå‡½æ•°ï¼‰ï¼Œç”±åè€…æ¥åšå®é™…çš„è¯»å†™æ“ä½œï¼Œå…¶ä¸­çš„è¯»å†™æ“ä½œéƒ½éœ€è¦åº”ç”¨ç¨‹åºåŒæ­¥æ“ä½œï¼Œæ‰€ä»¥Reactoræ˜¯éé˜»å¡åŒæ­¥ç½‘ç»œæ¨¡å‹ã€‚å¦‚æœæŠŠI/Oæ“ä½œæ”¹ä¸ºå¼‚æ­¥ï¼Œå³äº¤ç»™æ“ä½œç³»ç»Ÿæ¥å®Œæˆå°±èƒ½è¿›ä¸€æ­¥æå‡æ€§èƒ½ï¼Œè¿™å°±æ˜¯å¼‚æ­¥ç½‘ç»œæ¨¡å‹Proactorã€‚</p><p><img src="https://img.i7years.com/blog/Proactor.png" alt="Proactor"></p><p>Proactoræ˜¯å’Œå¼‚æ­¥I/Oç›¸å…³çš„ï¼Œ<strong>è¯¦ç»†æ–¹æ¡ˆ</strong>å¦‚ä¸‹ï¼š</p><ul><li>ProactorInitiatoråˆ›å»ºProactorå’ŒHandlerå¯¹è±¡ï¼Œå¹¶å°†Proactorå’ŒHandleréƒ½é€šè¿‡AsyOptProcessorï¼ˆAsynchronous Operation Processorï¼‰æ³¨å†Œåˆ°å†…æ ¸</li><li>AsyOptProcessorå¤„ç†æ³¨å†Œè¯·æ±‚ï¼Œå¹¶å¤„ç†I/Oæ“ä½œ</li><li>AsyOptProcessorå®ŒæˆI/Oæ“ä½œåé€šçŸ¥Proactor</li><li>Proactoræ ¹æ®ä¸åŒçš„äº‹ä»¶ç±»å‹å›è°ƒä¸åŒçš„Handlerè¿›è¡Œä¸šåŠ¡å¤„ç†</li><li>Handlerå®Œæˆä¸šåŠ¡å¤„ç†</li></ul><p>å¯ä»¥çœ‹å‡ºProactorå’ŒReactorçš„åŒºåˆ«ï¼šReactoræ˜¯åœ¨äº‹ä»¶å‘ç”Ÿæ—¶å°±é€šçŸ¥äº‹å…ˆæ³¨å†Œçš„äº‹ä»¶ï¼ˆè¯»å†™åœ¨åº”ç”¨ç¨‹åºçº¿ç¨‹ä¸­å¤„ç†å®Œæˆï¼‰ï¼›Proactoræ˜¯åœ¨äº‹ä»¶å‘ç”Ÿæ—¶åŸºäºå¼‚æ­¥I/Oå®Œæˆè¯»å†™æ“ä½œï¼ˆç”±å†…æ ¸å®Œæˆï¼‰ï¼Œå¾…I/Oæ“ä½œå®Œæˆåæ‰å›è°ƒåº”ç”¨ç¨‹åºçš„å¤„ç†å™¨æ¥å¤„ç†è¿›è¡Œä¸šåŠ¡å¤„ç†</p><p>ç†è®ºä¸ŠProactoræ¯”Reactoræ•ˆç‡æ›´é«˜ï¼Œå¼‚æ­¥I/Oæ›´åŠ å……åˆ†å‘æŒ¥DMA(Direct Memory Accessï¼Œç›´æ¥å†…å­˜å­˜å–)çš„ä¼˜åŠ¿ï¼Œä½†æ˜¯æœ‰å¦‚ä¸‹ç¼ºç‚¹ï¼š</p><ul><li>ç¼–ç¨‹å¤æ‚æ€§ ç”±äºå¼‚æ­¥æ“ä½œæµç¨‹çš„äº‹ä»¶çš„åˆå§‹åŒ–å’Œäº‹ä»¶å®Œæˆåœ¨æ—¶é—´å’Œç©ºé—´ä¸Šéƒ½æ˜¯ç›¸äº’åˆ†ç¦»çš„ï¼Œå› æ­¤å¼€å‘å¼‚æ­¥åº”ç”¨ç¨‹åºæ›´åŠ å¤æ‚ã€‚åº”ç”¨ç¨‹åºè¿˜å¯èƒ½å› ä¸ºåå‘çš„æµæ§è€Œå˜å¾—æ›´åŠ éš¾ä»¥Debug</li><li>å†…å­˜ä½¿ç”¨ ç¼“å†²åŒºåœ¨è¯»æˆ–å†™æ“ä½œçš„æ—¶é—´æ®µå†…å¿…é¡»ä¿æŒä½ï¼Œå¯èƒ½é€ æˆæŒç»­çš„ä¸ç¡®å®šæ€§ï¼Œå¹¶ä¸”æ¯ä¸ªå¹¶å‘æ“ä½œéƒ½è¦æ±‚æœ‰ç‹¬ç«‹çš„ç¼“å­˜ï¼Œç›¸æ¯”Reactoræ¨¡å¼ï¼Œåœ¨socketå·²ç»å‡†å¤‡å¥½è¯»æˆ–å†™å‰ï¼Œæ˜¯ä¸è¦æ±‚å¼€è¾Ÿç¼“å­˜çš„</li><li>æ“ä½œç³»ç»Ÿæ”¯æŒ Windows ä¸‹é€šè¿‡ IOCP å®ç°äº†çœŸæ­£çš„å¼‚æ­¥ I/Oï¼Œè€Œåœ¨ Linux ç³»ç»Ÿä¸‹ï¼ŒLinux2.6æ‰å¼•å…¥ï¼Œç›®å‰å¼‚æ­¥I/Oè¿˜ä¸å®Œå–„</li></ul><p>å› æ­¤åœ¨Linuxä¸‹å®ç°é«˜å¹¶å‘ç½‘ç»œç¼–ç¨‹éƒ½æ˜¯ä»¥Reactoræ¨¡å‹ä¸ºä¸»ã€‚</p>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> NIO </tag>
            
            <tag> IO </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æ•°æ®ç§»æ°‘æ¼‚æµè®°â€”â€”å¸¦ä½ çœ‹çœ‹å¤–é¢çš„ä¸–ç•Œ]]></title>
      <url>/posts/build-your-own-vpn-by-shadowsocks-or-rixcloud.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/pexels-photo-755385.jpeg?imageslim" alt="freedom"></p><p>å¸¦ä½ å»çœ‹çœ‹å¤–é¢çš„ä¸–ç•Œâ€¦â€¦</p><a id="more"></a><h2 id="è´­ä¹°ç°æˆçš„æœåŠ¡"><a href="#è´­ä¹°ç°æˆçš„æœåŠ¡" class="headerlink" title="è´­ä¹°ç°æˆçš„æœåŠ¡"></a>è´­ä¹°ç°æˆçš„æœåŠ¡</h2><p>ä»˜è´¹å°±æ˜¯æ¡ä¾¿å®œï¼Œçœå»è‡ªå·±ç»´æŠ¤çš„æˆæœ¬ã€‚è¿™é‡Œæˆ‘å¼ºçƒˆæ¨è <strong><a href="https://portal.rixcloud.me/aff.php?aff=1491" target="_blank" rel="noopener">rixcloud</a></strong>ï¼Œç”¨äº†ä¸€å¹´å¤šäº†ï¼Œæ²¡æœ‰å‡ºç°è¿‡å•¥é—®é¢˜ï¼Œæ¯å¹´çš„ä¸¤ä¼šæ—¶æœŸä¹Ÿç…§æ ·ç¨³å®šè¿è¡Œï¼Œrixcloudæœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜åŠ¿ï¼š</p><ul><li><p>æœ‰å¤šè¾¾57ä¸ªå…¨çƒåˆ†å¸ƒçš„æ¥å…¥ç‚¹å¯ä¾›é€‰æ‹©ï¼Œå½“ä¸€ä¸ªæ¥å…¥ç‚¹ä¸ç¨³å®šæ—¶ï¼Œä½ å¯ä»¥è‡ªç”±åˆ‡æ¢åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚</p><p><img src="https://img.i7years.com/blog/how-to-build-own-vpn-01.png" alt=""></p></li><li><p>è§£é”äº†ä¸€ç³»åˆ—æµåª’ä½“æœåŠ¡ï¼š<code>Netflix</code>ã€<code>Spotify</code>ã€<code>Hulu</code>ã€<code>HBO Now</code>ã€<code>TVB</code>ã€<code>Amazon Prime Video</code>ï¼Œå¯¹äºåƒæˆ‘è¿™æ ·çš„Netflixçˆ±å¥½è€…æ¥è¯´ï¼Œç®€ç›´å°±æ˜¯ç¦éŸ³ã€‚</p></li><li><p>è®¿é—®é€Ÿåº¦è¿˜ç®—å¯ä»¥ï¼Œå¶å°”ä¼šæœ‰æ‰€æ³¢åŠ¨ï¼Œä¸è¿‡å¤§ä½“ä¸Šéƒ½è¿˜æ­£å¸¸ã€‚</p><p><img src="https://img.i7years.com/blog/build-vpn-12.png" alt=""></p></li></ul><h3 id="è·å–rixcloud"><a href="#è·å–rixcloud" class="headerlink" title="è·å–rixcloud"></a>è·å–rixcloud</h3><ul><li><a href="https://portal.rixcloud.me/aff.php?aff=1491" target="_blank" rel="noopener">æ³¨å†Œé“¾æ¥</a></li><li><a href="https://support.rixcloud.me/" target="_blank" rel="noopener">é…ç½®æ•™ç¨‹</a></li></ul><h2 id="è‡ªå·±æ­å»ºVPN"><a href="#è‡ªå·±æ­å»ºVPN" class="headerlink" title="è‡ªå·±æ­å»ºVPN"></a>è‡ªå·±æ­å»ºVPN</h2><p>ä½¿ç”¨ <code>shadowsocks</code> æ­å»ºVPNã€‚è‡ªå»ºVPNä¸å¥½çš„ä¸€ç‚¹å°±æ˜¯ï¼ŒèŠ‚ç‚¹å•ä¸€ï¼Œä¸€æ—¦è¢«å°ï¼Œä½ å¾—å¦ä¹°VPSé‡æ–°æ­å»ºï¼Œä¹‹å‰çš„è´¹ç”¨å°±ç›¸å½“äºæ‰“æ°´æ¼‚äº†ï¼Œé™¤éèƒ½å¤Ÿæ¢æœºæˆ¿ï¼ˆIPï¼‰ã€‚</p><h3 id="å‡†å¤‡äº‘æœåŠ¡å™¨"><a href="#å‡†å¤‡äº‘æœåŠ¡å™¨" class="headerlink" title="å‡†å¤‡äº‘æœåŠ¡å™¨"></a>å‡†å¤‡äº‘æœåŠ¡å™¨</h3><p>æ¨èï¼š<a href="https://bwh88.net/" target="_blank" rel="noopener">æ¬ç“¦å·¥</a> æˆ– <a href="https://my.vultr.com/" target="_blank" rel="noopener">Vultr</a> ã€‚</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><ol><li><p>ç™»å½•æœåŠ¡å™¨ï¼›</p></li><li><p>ä½¿ç”¨rootæƒé™æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /tmp</span></span><br><span class="line"><span class="comment"># wget --no-check-certificate -O shadowsocks-libev.sh https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks-libev.sh</span></span><br><span class="line"><span class="comment"># chmod +x shadowsocks-libev.sh</span></span><br><span class="line"><span class="comment"># ./shadowsocks-libev.sh 2&gt;&amp;1 | tee shadowsocks-libev.log</span></span><br></pre></td></tr></table></figure></li><li><p>å®‰è£…è¿‡ç¨‹ä¸­ï¼ŒæŒ‰ç…§æç¤ºè®¾ç½®å¯†ç ã€ç«¯å£å·ä»¥åŠåŠ å¯†æ–¹å¼ï¼›</p><blockquote><p>ç«¯å£å·ã€åŠ å¯†æ–¹å¼é€‰æ‹©é»˜è®¤å³å¯</p></blockquote></li><li><p>å®‰è£…å®Œæˆï¼Œæç¤ºä¿¡æ¯å¦‚ä¸‹ï¼š</p><p><img src="https://img.i7years.com/blog/shadowsocks_confg1.png" alt=""></p></li><li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶<code>/etc/shadowsocks-libev/config.json</code></p><ul><li>è®¾ç½®<code>server</code>ä¸º<code>0.0.0.0</code>ï¼Œä¸æ˜¯æœåŠ¡å™¨çš„å…¬ç½‘IPï¼›</li><li>è®¾ç½®<code>local_address</code>ä¸ºè™šæ‹ŸæœåŠ¡å™¨çš„å†…ç½‘IPï¼Œä¸è¦è®¾ç½®ä¸º<code>127.0.0.1</code>ï¼›</li></ul></li><li><p>é‡å¯</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CentOS <span class="number">7</span> å‘½ä»¤</span><br><span class="line"><span class="comment"># systemctl restart shadowsocks</span></span><br><span class="line"></span><br><span class="line">CentOS <span class="number">6</span> å‘½ä»¤</span><br><span class="line"><span class="comment"># service shadowsocks restart</span></span><br></pre></td></tr></table></figure></li><li><p>æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CentOS <span class="number">7</span> å‘½ä»¤</span><br><span class="line"><span class="comment"># systemctl status shadowsocks </span></span><br><span class="line"></span><br><span class="line">CentOS <span class="number">6</span> å‘½ä»¤</span><br><span class="line"><span class="comment"># service shadowsocks status</span></span><br></pre></td></tr></table></figure><p><img src="https://img.i7years.com/blog/shaw_install.png" alt="WX20171008-132153@2x"></p></li><li><p>æ£€æŸ¥ç«¯å£è¿è¡ŒçŠ¶æ€</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># netstat -anp | grep 8379</span></span><br></pre></td></tr></table></figure><p><img src="https://img.i7years.com/netstat_shawsocks.png" alt="WX20171008-132153@2x"></p></li><li><p>æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦å¼€æ”¾äº†å¼€æ”¾shadowsocksç«¯å£ã€‚</p></li></ol><h3 id="å¸è½½"><a href="#å¸è½½" class="headerlink" title="å¸è½½"></a>å¸è½½</h3><p>å¦‚æœè¦é‡æ–°å®‰è£…ï¼Œå¸è½½å‘½ä»¤ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ./shadowsocks-libev.sh uninstall</span></span><br></pre></td></tr></table></figure><h2 id="å®¢æˆ·ç«¯é…ç½®"><a href="#å®¢æˆ·ç«¯é…ç½®" class="headerlink" title="å®¢æˆ·ç«¯é…ç½®"></a>å®¢æˆ·ç«¯é…ç½®</h2><p>å®¢æˆ·ç«¯ä¸‹è½½ï¼š<a href="https://support.rixcloud.me/kb/client-application-download/" target="_blank" rel="noopener">https://support.rixcloud.me/kb/client-application-download/</a></p><p>è¿æ¥é…ç½®å‚è€ƒï¼š<a href="https://support.rixcloud.me/" target="_blank" rel="noopener">https://support.rixcloud.me/</a></p><p>æœ‰æ¶‰åŠåˆ°éœ€è¦ç¾åŒºAppleIDè¿›è¡Œä¸‹è½½çš„ï¼Œå¯ä»¥æŸ¥çœ‹ <a href="https://wangwei.one/posts/How-to-register-and-use-the-US-Apple-ID.html">å¦‚ä½•æ³¨å†Œå¹¶ä½¿ç”¨ç¾åŒºAppleID</a> ã€‚</p><p>æˆ‘ä¸ªäººç”¨çš„æ˜¯ Surge 3 iOSä¸MacOSç‰ˆï¼Œç¨å¾®è´µäº†ç‚¹ï¼Œä¸è¿‡ç”¨èµ·æ¥ä½“éªŒå¾ˆå¥½ã€‚</p><p><img src="https://img.i7years.com/blog/build-vpn-01.png" alt="Surge 3 MacOS"></p><h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><p>ğŸš«ä¸è¦ä½¿ç”¨aliyunéƒ¨ç½²ï¼Œæµ·å¤–çš„ä¹Ÿä¸è¡Œï¼Œå¦åˆ™ä¼šæ”¶åˆ°å¦‚ä¸‹ç¦ä»¤ï¼š</p><p><img src="https://img.i7years.com/blog/WX20181229-154945.png" alt=""></p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://github.com/shadowsocks" target="_blank" rel="noopener">https://github.com/shadowsocks</a></li><li><a href="https://github.com/teddysun/shadowsocks_install" target="_blank" rel="noopener">https://github.com/teddysun/shadowsocks_install</a></li><li><a href="https://teddysun.com/357.html" target="_blank" rel="noopener">https://teddysun.com/357.html</a></li></ul>]]></content>
      
        <categories>
            
            <category> tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> freedom </tag>
            
            <tag> vpn </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Unix IOæ¨¡å‹ä»‹ç»]]></title>
      <url>/posts/5-unix-io-model-intro.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>éšç€äº’è”ç½‘çš„å‘å±•ï¼Œé¢å¯¹æµ·é‡ç”¨æˆ·çš„é«˜å¹¶å‘ä¸šåŠ¡åœºæ™¯ï¼Œä¼ ç»Ÿçš„é˜»å¡å¼çš„æœåŠ¡ç«¯æ¶æ„æ¨¡å¼å·²ç»æ— èƒ½ä¸ºåŠ›ï¼Œ<a href="https://en.wikipedia.org/wiki/C10k_problem" target="_blank" rel="noopener">C10K</a> é—®é¢˜è¶Šæ¥è¶Šå‡¸æ˜¾ï¼Œéœ€è¦ä¸€ç§æ–°å‹çš„IOæ¨¡å‹æ¥è§£å†³æ­¤ç±»é—®é¢˜ã€‚æœ¬æ–‡æˆ‘ä»¬å…ˆæ¥ä¸€èµ·å­¦ä¹ ä¸€ä¸‹å‡ ç§å¸¸è§çš„I/Oæ¨¡å‹ã€‚</p><a id="more"></a><blockquote><p>æœ¬æ–‡è®¨è®ºçš„èƒŒæ™¯æ˜¯Linuxç¯å¢ƒä¸‹çš„Network IO</p></blockquote><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><h3 id="ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´"><a href="#ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´" class="headerlink" title="ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´"></a>ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´</h3><p>ç°åœ¨æ“ä½œç³»ç»Ÿéƒ½æ˜¯é‡‡ç”¨è™šæ‹Ÿå­˜å‚¨å™¨ï¼Œé‚£ä¹ˆå¯¹32ä½æ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œå®ƒçš„å¯»å€ç©ºé—´ï¼ˆè™šæ‹Ÿå­˜å‚¨ç©ºé—´ï¼‰ä¸º4Gï¼ˆ2çš„32æ¬¡æ–¹ï¼‰ã€‚æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒæ˜¯å†…æ ¸ï¼Œç‹¬ç«‹äºæ™®é€šçš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥è®¿é—®å—ä¿æŠ¤çš„å†…å­˜ç©ºé—´ï¼Œä¹Ÿæœ‰è®¿é—®åº•å±‚ç¡¬ä»¶è®¾å¤‡çš„æ‰€æœ‰æƒé™ã€‚ä¸ºäº†ä¿è¯ç”¨æˆ·è¿›ç¨‹ä¸èƒ½ç›´æ¥æ“ä½œå†…æ ¸ï¼ˆkernelï¼‰ï¼Œä¿è¯å†…æ ¸çš„å®‰å…¨ï¼Œæ“å¿ƒç³»ç»Ÿå°†è™šæ‹Ÿç©ºé—´åˆ’åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†ä¸ºå†…æ ¸ç©ºé—´ï¼Œä¸€éƒ¨åˆ†ä¸ºç”¨æˆ·ç©ºé—´ã€‚é’ˆå¯¹linuxæ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œå°†æœ€é«˜çš„1Gå­—èŠ‚ï¼ˆä»è™šæ‹Ÿåœ°å€0xC0000000åˆ°0xFFFFFFFFï¼‰ï¼Œä¾›å†…æ ¸ä½¿ç”¨ï¼Œç§°ä¸º<strong>å†…æ ¸ç©ºé—´</strong>ï¼Œè€Œå°†è¾ƒä½çš„3Gå­—èŠ‚ï¼ˆä»è™šæ‹Ÿåœ°å€0x00000000åˆ°0xBFFFFFFFï¼‰ï¼Œä¾›å„ä¸ªè¿›ç¨‹ä½¿ç”¨ï¼Œç§°ä¸º<strong>ç”¨æˆ·ç©ºé—´</strong>ã€‚</p><h2 id="ç½‘ç»œè¯·æ±‚å¤„ç†æµç¨‹"><a href="#ç½‘ç»œè¯·æ±‚å¤„ç†æµç¨‹" class="headerlink" title="ç½‘ç»œè¯·æ±‚å¤„ç†æµç¨‹"></a>ç½‘ç»œè¯·æ±‚å¤„ç†æµç¨‹</h2><p>æœåŠ¡ç«¯å¤„ç†ç½‘ç»œè¯·æ±‚çš„å¤§è‡´æµç¨‹ä¸ºï¼š</p><p><img src="https://img.i7years.com/blog/Network process flow.png" alt="Network process flow"></p><p>ä¸»è¦å¤„ç†æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>è·å–è¯·æ±‚æ•°æ®ã€‚å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥å‘å‡ºç½‘ç»œè¯·æ±‚ï¼ŒæœåŠ¡å™¨æ¥å—è¯·æ±‚ï¼ˆ1-3ï¼‰</li><li>æ„å»ºå“åº”ã€‚å½“æœåŠ¡å™¨æ¥æ”¶å®Œè¯·æ±‚ï¼Œå¹¶åœ¨ç”¨æˆ·ç©ºé—´å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç›´åˆ°æ„å»ºå“åº”å®Œæˆï¼ˆ4ï¼‰</li><li>è¿”å›æ•°æ®ã€‚æœåŠ¡å™¨å°†å·²æ„å»ºå¥½çš„å“åº”å†é€šè¿‡å†…æ ¸ç©ºé—´çš„ç½‘ç»œI/Oè¿”è¿˜ç»™å®¢æˆ·ç«¯ï¼ˆ5-7ï¼‰</li></ul><p>è®¾è®¡æœåŠ¡ç«¯å¹¶å‘æ¨¡å‹æ—¶ï¼Œä¸»è¦æœ‰å¦‚ä¸‹ä¸¤ä¸ªå…³é”®ç‚¹ï¼š</p><ul><li>æœåŠ¡å™¨å¦‚ä½•ç®¡ç†è¿æ¥ï¼Œè·å–è¾“å…¥æ•°æ®</li><li>æœåŠ¡å™¨å¦‚ä½•å¤„ç†è¯·æ±‚</li></ul><p>ä»¥ä¸Šä¸¤ä¸ªå…³é”®ç‚¹æœ€ç»ˆéƒ½ä¸æ“ä½œç³»ç»Ÿçš„I/Oæ¨¡å‹ä»¥åŠçº¿ç¨‹(è¿›ç¨‹)æ¨¡å‹ç›¸å…³ï¼Œä¸‹é¢è¯¦ç»†ä»‹ç»è¿™ä¸¤ä¸ªæ¨¡å‹</p><h2 id="Unix-IOæ¨¡å‹"><a href="#Unix-IOæ¨¡å‹" class="headerlink" title="Unix IOæ¨¡å‹"></a>Unix IOæ¨¡å‹</h2><p>Unixå¯ç”¨çš„I/Oæ¨¡å‹æœ‰5ç§ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p><ul><li>é˜»å¡å¼I/O</li><li>éé˜»å¡å¼I/O</li><li>I/Oå¤ç”¨ï¼ˆselectã€pollå’Œepollï¼‰</li><li>ä¿¡å·é©±åŠ¨å¼I/Oï¼ˆSIGIOï¼‰</li><li>å¼‚æ­¥I/Oï¼ˆPOSIXçš„aio_ç³»åˆ—å‡½æ•°ï¼‰</li></ul><p>åœ¨ä»‹ç»è¿™5ä¸­I/Oæ¨¡å‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥ç†è§£ä¸€äº›çš„æ¦‚å¿µï¼š</p><h3 id="æ¦‚å¿µç†è§£"><a href="#æ¦‚å¿µç†è§£" class="headerlink" title="æ¦‚å¿µç†è§£"></a>æ¦‚å¿µç†è§£</h3><h4 id="é˜»å¡è°ƒç”¨ä¸éé˜»å¡è°ƒç”¨"><a href="#é˜»å¡è°ƒç”¨ä¸éé˜»å¡è°ƒç”¨" class="headerlink" title="é˜»å¡è°ƒç”¨ä¸éé˜»å¡è°ƒç”¨"></a>é˜»å¡è°ƒç”¨ä¸éé˜»å¡è°ƒç”¨</h4><ol><li>é˜»å¡è°ƒç”¨æ˜¯æŒ‡è°ƒç”¨ç»“æœè¿”å›ä¹‹å‰ï¼Œå½“å‰çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ã€‚è°ƒç”¨çº¿ç¨‹åªæœ‰åœ¨å¾—åˆ°ç»“æœä¹‹åæ‰ä¼šè¿”å›ã€‚</li><li>éé˜»å¡è°ƒç”¨æŒ‡åœ¨ä¸èƒ½ç«‹åˆ»å¾—åˆ°ç»“æœä¹‹å‰ï¼Œè¯¥è°ƒç”¨ä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹ã€‚</li></ol><p>ä¸¤è€…çš„æœ€å¤§åŒºåˆ«åœ¨äºè¢«è°ƒç”¨æ–¹åœ¨æ”¶åˆ°è¯·æ±‚åˆ°è¿”å›ç»“æœä¹‹å‰çš„è¿™æ®µæ—¶é—´å†…ï¼Œè°ƒç”¨æ–¹æ˜¯å¦ä¸€ç›´åœ¨ç­‰å¾…ã€‚é˜»å¡æ˜¯æŒ‡è°ƒç”¨æ–¹ä¸€ç›´åœ¨ç­‰å¾…è€Œä¸”åˆ«çš„äº‹æƒ…ä»€ä¹ˆéƒ½ä¸åšã€‚éé˜»å¡æ˜¯æŒ‡è°ƒç”¨æ–¹åœ¨ç»“æœè¿”å›ä¹‹å‰å…ˆå»å¤„ç†å…¶ä»–ä»»åŠ¡ã€‚</p><h4 id="åŒæ­¥å¤„ç†ä¸å¼‚æ­¥å¤„ç†"><a href="#åŒæ­¥å¤„ç†ä¸å¼‚æ­¥å¤„ç†" class="headerlink" title="åŒæ­¥å¤„ç†ä¸å¼‚æ­¥å¤„ç†"></a>åŒæ­¥å¤„ç†ä¸å¼‚æ­¥å¤„ç†</h4><ol><li><p>åŒæ­¥å¤„ç†æ˜¯æŒ‡è¢«è°ƒç”¨æ–¹å¾—åˆ°æœ€ç»ˆç»“æœä¹‹åæ‰è¿”å›ç»™è°ƒç”¨æ–¹ã€‚</p></li><li><p>å¼‚æ­¥å¤„ç†æ˜¯æŒ‡è¢«è°ƒç”¨æ–¹å…ˆè¿”å›åº”ç­”ï¼Œç„¶åå†è®¡ç®—è°ƒç”¨ç»“æœï¼Œè®¡ç®—å®Œæœ€ç»ˆç»“æœåå†é€šçŸ¥å¹¶è¿”å›ç»™è°ƒç”¨æ–¹</p></li></ol><blockquote><p><strong>é˜»å¡ã€éé˜»å¡çš„è®¨è®ºå¯¹è±¡æ˜¯è°ƒç”¨è€…</strong></p><p><strong>åŒæ­¥ã€å¼‚æ­¥çš„è®¨è®ºå¯¹è±¡æ˜¯è¢«è°ƒç”¨è€…</strong></p></blockquote><h4 id="recvfromå‡½æ•°"><a href="#recvfromå‡½æ•°" class="headerlink" title="recvfromå‡½æ•°"></a>recvfromå‡½æ•°</h4><p>å®šä¹‰å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">recvfrom</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">void</span> *buf, <span class="keyword">int</span> len, <span class="keyword">unsigned</span> <span class="keyword">int</span> flags, struct sockaddr *from,<span class="keyword">int</span> *fromlen)</span></span>;</span><br></pre></td></tr></table></figure><p>å‡½æ•°è¯´æ˜ï¼š</p><blockquote><p>recv()ç”¨æ¥æ¥æ”¶è¿œç¨‹ä¸»æœºç»æŒ‡å®šçš„socket ä¼ æ¥çš„æ•°æ®, å¹¶æŠŠæ•°æ®å­˜åˆ°ç”±å‚æ•°bufæŒ‡å‘çš„å†…å­˜ç©ºé—´ï¼Œå‚æ•°len ä¸ºå¯æ¥æ”¶æ•°æ®çš„æœ€å¤§é•¿åº¦ã€‚å‚æ•°flags ä¸€èˆ¬è®¾0ï¼Œå…¶ä»–æ•°å€¼å®šä¹‰è¯·å‚è€ƒrecv()ã€‚å‚æ•°from ç”¨æ¥æŒ‡å®šæ¬²ä¼ é€çš„ç½‘ç»œåœ°å€ï¼Œç»“æ„sockaddr è¯·å‚è€ƒbind()ã€‚å‚æ•°fromlen ä¸ºsockaddr çš„ç»“æ„é•¿åº¦ã€‚</p><p>è¿”å›å€¼ï¼šæˆåŠŸåˆ™è¿”å›æ¥æ”¶åˆ°çš„å­—ç¬¦æ•°ï¼Œå¤±è´¥åˆ™è¿”å›-1ï¼Œé”™è¯¯åŸå› å­˜äºerrno ä¸­ã€‚</p></blockquote><p>ä»‹ç»Unix IOæ¨¡å‹ï¼Œæˆ‘ä»¬ä½¿ç”¨UDPè€Œä¸æ˜¯TCPä½œä¸ºä¾‹å­çš„åŸå› åœ¨äºå°±UDPè€Œè¨€ï¼Œæ•°æ®å‡†å¤‡å¥½è¯»å–çš„æ¦‚å¿µæ¯”è¾ƒç®€å•ï¼šè¦ä¹ˆæ•´ä¸ªæ•°æ®æŠ¥å·²ç»æ”¶åˆ°ï¼Œè¦ä¹ˆè¿˜æ²¡æœ‰ã€‚ç„¶è€Œå¯¹äºTCPæ¥è¯´ï¼Œè¯¸å¦‚å¥—æ¥å­—ä½æ°´ä½æ ‡è®°ï¼ˆlow-water markï¼‰ç­‰é¢å¤–å˜é‡å¼€å§‹èµ·ä½œç”¨ï¼Œå¯¼è‡´è¿™ä¸ªæ¦‚å¿µå˜å¾—å¤æ‚ã€‚</p><p>æˆ‘ä»¬æŠŠrecvfromå‡½æ•°è§†ä½œç³»ç»Ÿè°ƒç”¨ã€‚</p><h3 id="5ç§I-Oæ¨¡å‹"><a href="#5ç§I-Oæ¨¡å‹" class="headerlink" title="5ç§I/Oæ¨¡å‹"></a>5ç§I/Oæ¨¡å‹</h3><p>å‰é¢æåˆ°è¿‡ï¼Œå¯¹äºä¸€æ¬¡IOè®¿é—®ï¼ˆä»¥readä¸¾ä¾‹ï¼‰ï¼Œæ•°æ®ä¼šå…ˆè¢«æ‹·è´åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å†²åŒºä¸­ï¼Œç„¶åæ‰ä¼šä»æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å†²åŒºæ‹·è´åˆ°åº”ç”¨ç¨‹åºçš„åœ°å€ç©ºé—´ã€‚æ‰€ä»¥è¯´ï¼Œå½“ä¸€ä¸ªreadæ“ä½œå‘ç”Ÿæ—¶ï¼Œå®ƒä¼šç»å†ä¸¤ä¸ªé˜¶æ®µï¼š</p><ol><li>ç­‰å¾…æ•°æ®å‡†å¤‡ (Waiting for the data to be ready)</li><li>å°†æ•°æ®ä»å†…æ ¸æ‹·è´åˆ°è¿›ç¨‹ä¸­ (Copying the data from the kernel to the process)</li></ol><p>å¯¹äºä¸€ä¸ªå¥—æ¥å­—ä¸Šçš„è¾“å…¥æ“ä½œï¼Œç¬¬ä¸€æ­¥é€šå¸¸æ¶‰åŠç­‰å¾…æ•°æ®ä»ç½‘ç»œä¸­åˆ°è¾¾ã€‚å½“æ•°æ®åŒ…åˆ°è¾¾æ—¶ï¼Œå®ƒè¢«å¤åˆ¶åˆ°å†…æ ¸ä¸­çš„æŸä¸ªç¼“å†²åŒºã€‚ç¬¬äºŒæ­¥å°±æ˜¯æŠŠæ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºã€‚</p><h4 id="é˜»å¡å¼I-Oæ¨¡å‹"><a href="#é˜»å¡å¼I-Oæ¨¡å‹" class="headerlink" title="é˜»å¡å¼I/Oæ¨¡å‹"></a>é˜»å¡å¼I/Oæ¨¡å‹</h4><p><img src="https://img.i7years.com/blog/Blocking I:O Model.png" alt="Blocking I:O Model"></p><p>å½“ç”¨æˆ·è¿›ç¨‹è°ƒç”¨äº†recvfromè¿™ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œkernelå°±å¼€å§‹äº†IOçš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼šå‡†å¤‡æ•°æ®ï¼ˆå¯¹äºç½‘ç»œIOæ¥è¯´ï¼Œå¾ˆå¤šæ—¶å€™æ•°æ®åœ¨ä¸€å¼€å§‹è¿˜æ²¡æœ‰åˆ°è¾¾ã€‚æ¯”å¦‚ï¼Œè¿˜æ²¡æœ‰æ”¶åˆ°ä¸€ä¸ªå®Œæ•´çš„UDPåŒ…ã€‚è¿™ä¸ªæ—¶å€™kernelå°±è¦ç­‰å¾…è¶³å¤Ÿçš„æ•°æ®åˆ°æ¥ï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹éœ€è¦ç­‰å¾…ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®è¢«æ‹·è´åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å†²åŒºä¸­æ˜¯éœ€è¦ä¸€ä¸ªè¿‡ç¨‹çš„ã€‚è€Œåœ¨ç”¨æˆ·è¿›ç¨‹è¿™è¾¹ï¼Œæ•´ä¸ªè¿›ç¨‹ä¼šè¢«é˜»å¡ï¼ˆå½“ç„¶ï¼Œæ˜¯è¿›ç¨‹è‡ªå·±é€‰æ‹©çš„é˜»å¡ï¼‰ã€‚å½“kernelä¸€ç›´ç­‰åˆ°æ•°æ®å‡†å¤‡å¥½äº†ï¼Œå®ƒå°±ä¼šå°†æ•°æ®ä»kernelä¸­æ‹·è´åˆ°ç”¨æˆ·å†…å­˜ï¼Œç„¶åkernelè¿”å›ç»“æœï¼Œç”¨æˆ·è¿›ç¨‹æ‰è§£é™¤blockçš„çŠ¶æ€ï¼Œé‡æ–°è¿è¡Œèµ·æ¥ã€‚</p><blockquote><p>æ‰€ä»¥ï¼Œblocking IOçš„ç‰¹ç‚¹å°±æ˜¯åœ¨IOæ‰§è¡Œçš„ä¸¤ä¸ªé˜¶æ®µéƒ½è¢«blockäº†ã€‚</p></blockquote><p><strong>ä¼˜ç‚¹</strong>ï¼šç¨‹åºç®€å•ï¼Œåœ¨é˜»å¡ç­‰å¾…æ•°æ®æœŸé—´è¿›ç¨‹/çº¿ç¨‹æŒ‚èµ·ï¼ŒåŸºæœ¬ä¸ä¼šå ç”¨CPUèµ„æºã€‚</p><p><strong>ç¼ºç‚¹</strong>ï¼šæ¯ä¸ªè¿æ¥éœ€è¦ç‹¬ç«‹çš„è¿›ç¨‹/çº¿ç¨‹å•ç‹¬å¤„ç†ï¼Œå½“å¹¶å‘è¯·æ±‚é‡å¤§æ—¶ä¸ºäº†ç»´æŠ¤ç¨‹åºï¼Œå†…å­˜ã€çº¿ç¨‹åˆ‡æ¢å¼€é”€è¾ƒå¤§ï¼Œè¿™ç§æ¨¡å‹åœ¨å®é™…ç”Ÿäº§ä¸­å¾ˆå°‘ä½¿ç”¨ã€‚</p><h4 id="éé˜»å¡å¼I-Oæ¨¡å‹"><a href="#éé˜»å¡å¼I-Oæ¨¡å‹" class="headerlink" title="éé˜»å¡å¼I/Oæ¨¡å‹"></a>éé˜»å¡å¼I/Oæ¨¡å‹</h4><p>linuxä¸‹ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®socketä½¿å…¶å˜ä¸ºnon-blockingã€‚å½“å¯¹ä¸€ä¸ªnon-blocking socketæ‰§è¡Œè¯»æ“ä½œæ—¶ï¼Œæµç¨‹æ˜¯è¿™ä¸ªæ ·å­ï¼š</p><p><img src="https://img.i7years.com/blog/Nonblocking I:O Model.png" alt="Nonblocking I:O Model"></p><p>å½“ç”¨æˆ·è¿›ç¨‹å‘å‡ºreadæ“ä½œæ—¶ï¼Œå¦‚æœkernelä¸­çš„æ•°æ®è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œé‚£ä¹ˆå®ƒå¹¶ä¸ä¼šblockç”¨æˆ·è¿›ç¨‹ï¼Œè€Œæ˜¯ç«‹åˆ»è¿”å›ä¸€ä¸ªerrorã€‚ä»ç”¨æˆ·è¿›ç¨‹è§’åº¦è®² ï¼Œå®ƒå‘èµ·ä¸€ä¸ªreadæ“ä½œåï¼Œå¹¶ä¸éœ€è¦ç­‰å¾…ï¼Œè€Œæ˜¯é©¬ä¸Šå°±å¾—åˆ°äº†ä¸€ä¸ªç»“æœã€‚ç”¨æˆ·è¿›ç¨‹åˆ¤æ–­ç»“æœæ˜¯ä¸€ä¸ªerroræ—¶ï¼Œå®ƒå°±çŸ¥é“æ•°æ®è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œäºæ˜¯å®ƒå¯ä»¥å†æ¬¡å‘é€readæ“ä½œã€‚ä¸€æ—¦kernelä¸­çš„æ•°æ®å‡†å¤‡å¥½äº†ï¼Œå¹¶ä¸”åˆå†æ¬¡æ”¶åˆ°äº†ç”¨æˆ·è¿›ç¨‹çš„system callï¼Œé‚£ä¹ˆå®ƒé©¬ä¸Šå°±å°†æ•°æ®æ‹·è´åˆ°äº†ç”¨æˆ·å†…å­˜ï¼Œç„¶åè¿”å›ã€‚</p><blockquote><p>æ‰€ä»¥ï¼Œnonblocking IOçš„ç‰¹ç‚¹æ˜¯ç”¨æˆ·è¿›ç¨‹éœ€è¦<strong>ä¸æ–­çš„ä¸»åŠ¨è¯¢é—®</strong>kernelæ•°æ®å¥½äº†æ²¡æœ‰ã€‚</p></blockquote><p><strong>ä¼˜ç‚¹</strong>ï¼šä¸ä¼šé˜»å¡åœ¨å†…æ ¸çš„ç­‰å¾…æ•°æ®è¿‡ç¨‹ï¼Œæ¯æ¬¡å‘èµ·çš„I/Oè¯·æ±‚å¯ä»¥ç«‹å³è¿”å›ï¼Œä¸ç”¨é˜»å¡ç­‰å¾…ï¼Œå®æ—¶æ€§è¾ƒå¥½ã€‚</p><p><strong>ç¼ºç‚¹</strong>ï¼šè½®è¯¢å°†ä¼šä¸æ–­åœ°è¯¢é—®å†…æ ¸ï¼Œè¿™å°†å ç”¨å¤§é‡çš„CPUæ—¶é—´ï¼Œç³»ç»Ÿèµ„æºåˆ©ç”¨ç‡è¾ƒä½ï¼Œæ‰€ä»¥ä¸€èˆ¬WebæœåŠ¡å™¨ä¸ä½¿ç”¨è¿™ç§I/Oæ¨¡å‹ã€‚</p><h4 id="I-Oå¤ç”¨"><a href="#I-Oå¤ç”¨" class="headerlink" title="I/Oå¤ç”¨"></a>I/Oå¤ç”¨</h4><p>IO multiplexingå°±æ˜¯æˆ‘ä»¬è¯´çš„selectï¼Œpollï¼Œepollï¼Œæœ‰äº›åœ°æ–¹ä¹Ÿç§°è¿™ç§IOæ–¹å¼ä¸ºevent driven IOã€‚select/epollçš„å¥½å¤„å°±åœ¨äºå•ä¸ªprocesså°±å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªç½‘ç»œè¿æ¥çš„IOã€‚å®ƒçš„åŸºæœ¬åŸç†å°±æ˜¯selectï¼Œpollï¼Œepollè¿™ä¸ªfunctionä¼šä¸æ–­çš„è½®è¯¢æ‰€è´Ÿè´£çš„æ‰€æœ‰socketï¼Œå½“æŸä¸ªsocketæœ‰æ•°æ®åˆ°è¾¾äº†ï¼Œå°±é€šçŸ¥ç”¨æˆ·è¿›ç¨‹ã€‚</p><p><img src="https://img.i7years.com/blog/I:O Multiplexing Model.png" alt="I:O Multiplexing Model"></p><p>å½“ç”¨æˆ·è¿›ç¨‹è°ƒç”¨äº†selectï¼Œé‚£ä¹ˆæ•´ä¸ªè¿›ç¨‹ä¼šè¢«blockï¼Œè€ŒåŒæ—¶ï¼Œkernelä¼šâ€œç›‘è§†â€æ‰€æœ‰selectè´Ÿè´£çš„socketï¼Œå½“ä»»ä½•ä¸€ä¸ªsocketä¸­çš„æ•°æ®å‡†å¤‡å¥½äº†ï¼Œselectå°±ä¼šè¿”å›ã€‚è¿™ä¸ªæ—¶å€™ç”¨æˆ·è¿›ç¨‹å†è°ƒç”¨readæ“ä½œï¼Œå°†æ•°æ®ä»kernelæ‹·è´åˆ°ç”¨æˆ·è¿›ç¨‹ã€‚</p><blockquote><p>æ‰€ä»¥ï¼ŒI/O å¤šè·¯å¤ç”¨çš„ç‰¹ç‚¹æ˜¯é€šè¿‡ä¸€ç§æœºåˆ¶ä¸€ä¸ªè¿›ç¨‹èƒ½åŒæ—¶ç­‰å¾…å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè€Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦ï¼ˆå¥—æ¥å­—æè¿°ç¬¦ï¼‰å…¶ä¸­çš„ä»»æ„ä¸€ä¸ªè¿›å…¥è¯»å°±ç»ªçŠ¶æ€ï¼Œselect()å‡½æ•°å°±å¯ä»¥è¿”å›ã€‚</p></blockquote><p>è¿™ä¸ªå›¾å’Œblocking IOçš„å›¾å…¶å®å¹¶æ²¡æœ‰å¤ªå¤§çš„ä¸åŒï¼Œäº‹å®ä¸Šï¼Œè¿˜æ›´å·®ä¸€äº›ã€‚å› ä¸ºè¿™é‡Œéœ€è¦ä½¿ç”¨ä¸¤ä¸ªsystem call (select å’Œ recvfrom)ï¼Œè€Œblocking IOåªè°ƒç”¨äº†ä¸€ä¸ªsystem call (recvfrom)ã€‚ä½†æ˜¯ï¼Œç”¨selectçš„ä¼˜åŠ¿åœ¨äºå®ƒå¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªconnectionã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœå¤„ç†çš„è¿æ¥æ•°ä¸æ˜¯å¾ˆé«˜çš„è¯ï¼Œä½¿ç”¨select/epollçš„web serverä¸ä¸€å®šæ¯”ä½¿ç”¨multi-threading + blocking IOçš„web serveræ€§èƒ½æ›´å¥½ï¼Œå¯èƒ½å»¶è¿Ÿè¿˜æ›´å¤§ã€‚select/epollçš„ä¼˜åŠ¿å¹¶ä¸æ˜¯å¯¹äºå•ä¸ªè¿æ¥èƒ½å¤„ç†å¾—æ›´å¿«ï¼Œè€Œæ˜¯åœ¨äºèƒ½å¤„ç†æ›´å¤šçš„è¿æ¥ã€‚</p><p>åœ¨IO multiplexing Modelä¸­ï¼Œå®é™…ä¸­ï¼Œå¯¹äºæ¯ä¸€ä¸ªsocketï¼Œä¸€èˆ¬éƒ½è®¾ç½®æˆä¸ºnon-blockingï¼Œä½†æ˜¯ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ•´ä¸ªç”¨æˆ·çš„processå…¶å®æ˜¯ä¸€ç›´è¢«blockçš„ã€‚åªä¸è¿‡processæ˜¯è¢«selectè¿™ä¸ªå‡½æ•°blockï¼Œè€Œä¸æ˜¯è¢«socket IOç»™blockã€‚</p><p><strong>ä¼˜ç‚¹</strong>ï¼šå¯ä»¥åŸºäºä¸€ä¸ªé˜»å¡å¯¹è±¡ï¼ŒåŒæ—¶åœ¨å¤šä¸ªæè¿°ç¬¦ä¸Šç­‰å¾…å°±ç»ªï¼Œè€Œä¸æ˜¯ä½¿ç”¨å¤šä¸ªçº¿ç¨‹(æ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸€ä¸ªçº¿ç¨‹)ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§èŠ‚çœç³»ç»Ÿèµ„æº</p><p><strong>ç¼ºç‚¹</strong>ï¼šå½“è¿æ¥æ•°è¾ƒå°‘æ—¶æ•ˆç‡ç›¸æ¯”å¤šçº¿ç¨‹+é˜»å¡I/Oæ¨¡å‹æ•ˆç‡è¾ƒä½ï¼Œå¯èƒ½å»¶è¿Ÿæ›´å¤§ï¼Œå› ä¸ºå•ä¸ªè¿æ¥å¤„ç†éœ€è¦2æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼Œå ç”¨æ—¶é—´ä¼šæœ‰å¢åŠ </p><h4 id="ä¿¡å·é©±åŠ¨å¼I-O"><a href="#ä¿¡å·é©±åŠ¨å¼I-O" class="headerlink" title="ä¿¡å·é©±åŠ¨å¼I/O"></a>ä¿¡å·é©±åŠ¨å¼I/O</h4><p><img src="https://img.i7years.com/blog/Signal-Driven IO Model.png" alt="Signal-Driven IO Model"></p><p><strong>ç®€ä»‹</strong>ï¼šåœ¨ä¿¡å·é©±åŠ¨å¼I/Oæ¨¡å‹ä¸­ï¼Œåº”ç”¨ç¨‹åºä½¿ç”¨å¥—æ¥å£è¿›è¡Œä¿¡å·é©±åŠ¨I/Oï¼Œå¹¶å®‰è£…ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼Œè¿›ç¨‹ç»§ç»­è¿è¡Œå¹¶ä¸é˜»å¡ã€‚å½“æ•°æ®å‡†å¤‡å¥½æ—¶ï¼Œè¿›ç¨‹ä¼šæ”¶åˆ°ä¸€ä¸ªSIGIOä¿¡å·ï¼Œå¯ä»¥åœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­è°ƒç”¨I/Oæ“ä½œå‡½æ•°å¤„ç†æ•°æ®</p><p><strong>ä¼˜ç‚¹</strong>ï¼šçº¿ç¨‹å¹¶æ²¡æœ‰åœ¨ç­‰å¾…æ•°æ®æ—¶è¢«é˜»å¡ï¼Œå¯ä»¥æé«˜èµ„æºçš„åˆ©ç”¨ç‡</p><p><strong>ç¼ºç‚¹</strong></p><ul><li>ä¿¡å·I/Oåœ¨å¤§é‡IOæ“ä½œæ—¶å¯èƒ½ä¼šå› ä¸ºä¿¡å·é˜Ÿåˆ—æº¢å‡ºå¯¼è‡´æ²¡æ³•é€šçŸ¥</li><li>ä¿¡å·é©±åŠ¨I/Oå°½ç®¡å¯¹äºå¤„ç†UDPå¥—æ¥å­—æ¥è¯´æœ‰ç”¨ï¼Œå³è¿™ç§ä¿¡å·é€šçŸ¥æ„å‘³ç€åˆ°è¾¾ä¸€ä¸ªæ•°æ®æŠ¥ï¼Œæˆ–è€…è¿”å›ä¸€ä¸ªå¼‚æ­¥é”™è¯¯ã€‚ä½†æ˜¯ï¼Œå¯¹äºTCPè€Œè¨€ï¼Œä¿¡å·é©±åŠ¨çš„I/Oæ–¹å¼è¿‘ä¹æ— ç”¨ï¼Œå› ä¸ºå¯¼è‡´è¿™ç§é€šçŸ¥çš„æ¡ä»¶ä¸ºæ•°ä¼—å¤šï¼Œæ¯ä¸€ä¸ªæ¥è¿›è¡Œåˆ¤åˆ«ä¼šæ¶ˆè€—å¾ˆå¤§èµ„æºï¼Œä¸å‰å‡ ç§æ–¹å¼ç›¸æ¯”ä¼˜åŠ¿å°½å¤±</li></ul><h4 id="å¼‚æ­¥I-O"><a href="#å¼‚æ­¥I-O" class="headerlink" title="å¼‚æ­¥I/O"></a>å¼‚æ­¥I/O</h4><p><img src="https://img.i7years.com/blog/Asynchronous I:O Model.png" alt="Asynchronous I:O Model"></p><p>ç”¨æˆ·è¿›ç¨‹å‘èµ·readæ“ä½œä¹‹åï¼Œç«‹åˆ»å°±å¯ä»¥å¼€å§‹å»åšå…¶å®ƒçš„äº‹ã€‚è€Œå¦ä¸€æ–¹é¢ï¼Œä»kernelçš„è§’åº¦ï¼Œå½“å®ƒå—åˆ°ä¸€ä¸ªasynchronous readä¹‹åï¼Œé¦–å…ˆå®ƒä¼šç«‹åˆ»è¿”å›ï¼Œæ‰€ä»¥ä¸ä¼šå¯¹ç”¨æˆ·è¿›ç¨‹äº§ç”Ÿä»»ä½•blockã€‚ç„¶åï¼Œkernelä¼šç­‰å¾…æ•°æ®å‡†å¤‡å®Œæˆï¼Œç„¶åå°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·å†…å­˜ï¼Œå½“è¿™ä¸€åˆ‡éƒ½å®Œæˆä¹‹åï¼Œkernelä¼šç»™ç”¨æˆ·è¿›ç¨‹å‘é€ä¸€ä¸ªsignalï¼Œå‘Šè¯‰å®ƒreadæ“ä½œå®Œæˆäº†ã€‚</p><p><strong>ä¼˜ç‚¹</strong>ï¼šå¼‚æ­¥ I/O èƒ½å¤Ÿå……åˆ†åˆ©ç”¨ DMA ç‰¹æ€§ï¼Œè®© I/O æ“ä½œä¸è®¡ç®—é‡å </p><p><strong>ç¼ºç‚¹</strong>ï¼šè¦å®ç°çœŸæ­£çš„å¼‚æ­¥ I/Oï¼Œæ“ä½œç³»ç»Ÿéœ€è¦åšå¤§é‡çš„å·¥ä½œã€‚ç›®å‰ Windows ä¸‹é€šè¿‡ IOCP å®ç°äº†çœŸæ­£çš„å¼‚æ­¥ I/Oï¼Œè€Œåœ¨ Linux ç³»ç»Ÿä¸‹ï¼ŒLinux2.6æ‰å¼•å…¥ï¼Œç›®å‰ AIO å¹¶ä¸å®Œå–„ï¼Œå› æ­¤åœ¨ Linux ä¸‹å®ç°é«˜å¹¶å‘ç½‘ç»œç¼–ç¨‹æ—¶éƒ½æ˜¯ä»¥ IOå¤ç”¨æ¨¡å‹æ¨¡å¼ä¸ºä¸»</p><h4 id="åŒæ­¥I-Oå’Œå¼‚æ­¥I-Oå¯¹æ¯”"><a href="#åŒæ­¥I-Oå’Œå¼‚æ­¥I-Oå¯¹æ¯”" class="headerlink" title="åŒæ­¥I/Oå’Œå¼‚æ­¥I/Oå¯¹æ¯”"></a>åŒæ­¥I/Oå’Œå¼‚æ­¥I/Oå¯¹æ¯”</h4><p><img src="https://img.i7years.com/blog/Comparison of the I:O Models.png" alt="Comparison of the I:O Models"></p><p>å¯ä»¥çœ‹å‡ºï¼Œå‰4ç§æ¨¡å‹çš„ä¸»è¦åŒºåˆ«åœ¨äºç¬¬ä¸€é˜¶æ®µï¼Œå› ä¸ºå®ƒä»¬çš„ç¬¬äºŒé˜¶æ®µæ˜¯ä¸€æ ·çš„ï¼šåœ¨æ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°è°ƒç”¨è€…çš„ç¼“å†²åŒºæœŸé—´ï¼Œè¿›ç¨‹é˜»å¡äºrecvfromè°ƒç”¨ã€‚ç›¸åï¼Œå¼‚æ­¥I/Oæ¨¡å‹åœ¨è¿™ä¸¤ä¸ªé˜¶æ®µéƒ½è¦å¤„ç†ï¼Œä»è€Œä¸åŒäºå…¶ä»–4ç§æ¨¡å‹ã€‚</p><p>POSIXæŠŠè¿™ä¸¤ä¸ªæœ¯è¯­å®šä¹‰å¦‚ä¸‹ï¼š<br>åŒæ­¥I/Oæ“ä½œï¼ˆsynchronous I/O opetationï¼‰å¯¼è‡´è¯·æ±‚è¿›ç¨‹é˜»å¡ï¼Œç›´åˆ°I/Oæ“ä½œå®Œæˆï¼›<br>å¼‚æ­¥I/Oæ“ä½œï¼ˆasynchronous I/O opetationï¼‰ä¸å¯¼è‡´è¯·æ±‚è¿›ç¨‹é˜»å¡ã€‚</p><p>æ ¹æ®ä¸Šè¿°å®šä¹‰ï¼Œæˆ‘ä»¬çš„å‰4ç§æ¨¡å‹â€”â€”é˜»å¡å¼I/Oæ¨¡å‹ã€éé˜»å¡å¼I/Oæ¨¡å‹ã€I/Oå¤ç”¨æ¨¡å‹å’Œä¿¡å·é©±åŠ¨å¼I/Oæ¨¡å‹éƒ½æ˜¯åŒæ­¥I/Oæ¨¡å‹ï¼Œå› ä¸ºå…¶ä¸­çœŸæ­£çš„I/Oæ“ä½œï¼ˆrecvfromï¼‰å°†é˜»å¡è¿›ç¨‹ã€‚åªæœ‰å¼‚æ­¥I/Oæ¨¡å‹ä¸POSIXå®šä¹‰çš„å¼‚æ­¥I/Oç›¸åŒ¹é…ã€‚</p><blockquote><p>recvfrom æ‰æ˜¯çœŸæ­£çš„ I/O æ“ä½œï¼Œrecvfromæ˜¯å¦é˜»å¡æ˜¯åŒæ­¥å¼‚æ­¥çš„åŒºåˆ†æ ‡è¯†</p></blockquote><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://book.douban.com/subject/4859464/" target="_blank" rel="noopener">ã€ŠUnixç½‘ç»œç¼–ç¨‹ã€‹</a></li><li><a href="https://segmentfault.com/a/1190000003063859" target="_blank" rel="noopener">https://segmentfault.com/a/1190000003063859</a></li><li><a href="https://blog.csdn.net/historyasamirror/article/details/5778378" target="_blank" rel="noopener">https://blog.csdn.net/historyasamirror/article/details/5778378</a></li><li><a href="https://www.ibm.com/developerworks/cn/linux/l-async/" target="_blank" rel="noopener">https://www.ibm.com/developerworks/cn/linux/l-async/</a></li><li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/Socket.md" target="_blank" rel="noopener">https://github.com/CyC2018/CS-Notes/blob/master/notes/Socket.md</a></li><li><a href="https://tech.youzan.com/yi-bu-wang-luo-mo-xing/" target="_blank" rel="noopener">https://tech.youzan.com/yi-bu-wang-luo-mo-xing/</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> NIO </tag>
            
            <tag> IO </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Java IO vs NIO]]></title>
      <url>/posts/java-io-vs-nio.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>å‰é¢æˆ‘ä»¬ä»‹ç»äº†ä¸€ç³»åˆ—çš„NIO Channelçš„ä½¿ç”¨ï¼Œå‘ç°å®ƒä¸æ ‡å‡†çš„IOæœ‰å¾ˆå¤§çš„ä¸åŒï¼Œæœ¬ç¯‡æˆ‘ä»¬å°±æ¥æ€»ç»“ä¸€ä¸‹ NIO ä¸ IO ä¹‹é—´çš„å·®å¼‚ã€‚</p><a id="more"></a><h2 id="ä¸»è¦åŒºåˆ«"><a href="#ä¸»è¦åŒºåˆ«" class="headerlink" title="ä¸»è¦åŒºåˆ«"></a>ä¸»è¦åŒºåˆ«</h2><p>å¯¹æ¯”å¦‚ä¸‹ï¼š</p><table><thead><tr><th>IO</th><th>NIO</th></tr></thead><tbody><tr><td>é¢å‘æµ(Stream)</td><td>é¢å‘ç¼“å†²(Buffer)</td></tr><tr><td>é˜»å¡IO(Blocking IO)</td><td>éé˜»å¡IO(Non Blocking IO)</td></tr><tr><td>\</td><td>é€‰æ‹©å™¨(Selectors)</td></tr></tbody></table><h3 id="æµ-vs-ç¼“å†²åŒº"><a href="#æµ-vs-ç¼“å†²åŒº" class="headerlink" title="æµ vs ç¼“å†²åŒº"></a>æµ vs ç¼“å†²åŒº</h3><p>Java NIOå’ŒIOä¹‹é—´çš„ç¬¬ä¸€ä¸ªé‡è¦åŒºåˆ«æ˜¯IOæ˜¯é¢å‘æµçš„ï¼Œè€ŒNIOæ˜¯é¢å‘ç¼“å†²åŒºçš„ã€‚</p><p>IO ä»¥é¢å‘æµä¸ºä¸»ï¼Œæ„å‘³ç€ä½ å¯ä»¥ä»æµä¸­ä¸€æ¬¡æ€§è¯»å–ä¸€ä¸ªæˆ–å¤šä¸ªå­—èŠ‚ã€‚å¦‚ä½•æ“ä½œè¯»å–åˆ°çš„å­—èŠ‚å–å†³äºä½ è‡ªå·±ã€‚è¿™äº›æµä¸­çš„å­—èŠ‚æ²¡æœ‰åšä»»ä½•ç¼“å­˜ã€‚æ­¤å¤–ï¼Œä½ æ— æ³•åœ¨æµä¸­çš„æ•°æ®åšå‰åç§»åŠ¨æ“ä½œã€‚å¦‚æœä½ æƒ³è¦å¯¹è¯»å–åˆ°æ•°æ®åšå‰åç§»åŠ¨æ“ä½œï¼Œåˆ™å¿…é¡»å°†å…¶ç¼“å­˜åˆ° Buffer ä¸­ã€‚</p><p>Java NIOçš„é¢å‘ç¼“å†²åŒºçš„æ–¹æ³•ç•¥æœ‰ä¸åŒã€‚æ•°æ®è¯»å…¥ç¼“å†²åŒºï¼Œç„¶ååœ¨å¤„ç†è¯¥ç¼“å†²åŒºã€‚ ä½ å¯ä»¥æ ¹æ®ä½ çš„éœ€è¦åœ¨ç¼“å†²åŒºä¸­åšå‰åç§»åŠ¨æ“ä½œã€‚è¿™æ ·å¯ä»¥æé«˜å¤„ç†æ•°æ®æ—¶çš„çµæ´»æ€§ã€‚ä¸è¿‡ï¼Œåœ¨å¤„ç†æ•°æ®ä¹‹å‰ï¼Œè¿˜éœ€è¦æ£€æŸ¥ç¼“å†²åŒºæ˜¯å¦åŒ…å«äº†å®Œæ•´çš„æ•°æ®ï¼Œå¹¶ä¸”ï¼Œè¦ç¡®ä¿ç¼“å†²åŒºåœ¨è¯»å…¥æ›´å¤šçš„æ•°æ®æ—¶ï¼Œä¸èƒ½è¦†ç›–æ‰å°šæœªå¤„ç†çš„æ•°æ®ã€‚</p><h3 id="é˜»å¡-vs-éé˜»å¡"><a href="#é˜»å¡-vs-éé˜»å¡" class="headerlink" title="é˜»å¡ vs éé˜»å¡"></a>é˜»å¡ vs éé˜»å¡</h3><p>Java IO ä¸­çš„å„ç§æµéƒ½æ˜¯é˜»å¡çš„ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ read() æˆ– write() æ–¹æ³•æ—¶ï¼Œåœ¨æ•°æ®è¢«å®Œæ•´è¯»å–æˆ–å†™å…¥ä¹‹å‰ï¼Œè¯¥çº¿ç¨‹ä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œå…¶é—´å®ƒä¸èƒ½å¤„ç†ä»»ä½•å…¶ä»–çš„ä»»åŠ¡ã€‚</p><p><img src="https://img.i7years.com/blog/Selector-NIO.png" alt="Selector-NIO"></p><p>Java NIO éé˜»å¡æ¨¡å¼èƒ½å…è®¸çº¿ç¨‹ä»é€šé“ä¸­è¯»å–æ•°æ®ï¼Œé€šé“ä¸­æœ‰å¤šå°‘æ•°æ®å°±è¯»å¤šå°‘æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰å¯è¯»çš„æ•°æ®ï¼Œé‚£å°±ä»€ä¹ˆä¹Ÿä¸è¯»å–ã€‚åœ¨æœ‰æ•°æ®å¯ä»¥è¯»å–ä¹‹å‰ï¼Œçº¿ç¨‹å¯ä»¥å»å¹²å…¶ä»–çš„äº‹æƒ…ï¼Œè€Œä¸ç”¨ä¸€ç›´é˜»å¡ç­‰å¾…ã€‚</p><p>Java NIO å†™æ“ä½œä¹Ÿæ˜¯ç±»ä¼¼ã€‚ä¸ªçº¿ç¨‹è¯·æ±‚å†™å…¥ä¸€äº›æ•°æ®åˆ°æŸé€šé“ï¼Œä½†ä¸éœ€è¦ç­‰å¾…å®ƒå®Œå…¨å†™å…¥ï¼Œè¿™ä¸ªçº¿ç¨‹åŒæ—¶å¯ä»¥å»åšåˆ«çš„äº‹æƒ…ã€‚</p><p>çº¿ç¨‹é€šå¸¸å°†éé˜»å¡IOçš„ç©ºé—²æ—¶é—´ç”¨äºåœ¨å…¶å®ƒé€šé“ä¸Šæ‰§è¡ŒIOæ“ä½œï¼Œæ‰€ä»¥ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ç°åœ¨å¯ä»¥ç®¡ç†å¤šä¸ªè¾“å…¥å’Œè¾“å‡ºé€šé“ï¼ˆchannelï¼‰ã€‚</p><p><img src="https://img.i7years.com/blog/Socket-BIO.png" alt="Socket-BIO"></p><h3 id="é€‰æ‹©å™¨"><a href="#é€‰æ‹©å™¨" class="headerlink" title="é€‰æ‹©å™¨"></a>é€‰æ‹©å™¨</h3><p>Java NIO é€‰æ‹©å™¨å…è®¸ä¸€ä¸ªçº¿ç¨‹å»ç›‘æ§å¤šä¸ªè¾“å…¥é€šé“ã€‚ä½ å¯ä»¥ç”¨ä¸€ä¸ªé€‰æ‹©å™¨å»æ³¨å†Œå¤šä¸ªé€šé“ï¼Œç„¶åçº¿ç¨‹å°±å¯ä»¥â€é€‰æ‹©â€å‡ºå“ªäº›é€šé“å·²ç»å‡†å¤‡å¥½äº†è¯»å–æˆ–å†™å…¥æ“ä½œã€‚è¿™ç§é€‰æ‹©å™¨æœºåˆ¶è®©å•ä¸ªçº¿ç¨‹åŒæ—¶ç®¡ç†å¤šä¸ªé€šé“å˜å¾—æ›´åŠ å®¹æ˜“ã€‚</p><h2 id="NIO-ä¸-IO-å½±å“åº”ç”¨ç¨‹åºè®¾è®¡"><a href="#NIO-ä¸-IO-å½±å“åº”ç”¨ç¨‹åºè®¾è®¡" class="headerlink" title="NIO ä¸ IO å½±å“åº”ç”¨ç¨‹åºè®¾è®¡"></a>NIO ä¸ IO å½±å“åº”ç”¨ç¨‹åºè®¾è®¡</h2><p>é€‰æ‹©ç”¨NIO è¿˜æ˜¯ IO ä½œä¸ºä½ ç¨‹åºçš„IOå·¥å…·åŒ…ï¼Œå°†ä¼šå½±å“åº”ç”¨ç¨‹åºçš„ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><ul><li>NIO æˆ– IO ç±»çš„APIè°ƒç”¨</li><li>æ•°æ®çš„å¤„ç†æ–¹å¼</li><li>å¤„ç†æ•°æ®çš„çº¿ç¨‹æ•°é‡</li></ul><h3 id="APIè°ƒç”¨"><a href="#APIè°ƒç”¨" class="headerlink" title="APIè°ƒç”¨"></a>APIè°ƒç”¨</h3><p>å½“ç„¶ï¼Œä½¿ç”¨NIOæ—¶çš„APIè°ƒç”¨çœ‹èµ·æ¥ä¸ä½¿ç”¨IOæ—¶ä¸åŒã€‚ è¿™å¹¶ä¸å¥‡æ€ªã€‚ è€Œä¸æ˜¯ä»…ä»…ä»ä¾‹å¦‚å­—èŠ‚è¯»å–æ•°æ®å­—èŠ‚ã€‚ åœ¨InputStreamä¸­ï¼Œå¿…é¡»é¦–å…ˆå°†æ•°æ®è¯»å…¥ç¼“å†²åŒºï¼Œç„¶åä»é‚£é‡Œè¿›è¡Œå¤„ç†ã€‚</p><h3 id="æ•°æ®å¤„ç†"><a href="#æ•°æ®å¤„ç†" class="headerlink" title="æ•°æ®å¤„ç†"></a>æ•°æ®å¤„ç†</h3><p>ä½¿ç”¨çº¯NIOè®¾è®¡ä¸IOè®¾è®¡æ—¶ï¼Œæ•°æ®å¤„ç†ä¹Ÿä¼šå—åˆ°å½±å“ã€‚</p><p>åœ¨IOè®¾è®¡ä¸­ï¼Œä½ ä»InputStreamæˆ–Readerä¸­ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚åœ°è¯»å–æ•°æ®ã€‚ æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å¤„ç†åŸºäºè¡Œçš„æ–‡æœ¬æ•°æ®æµã€‚ ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Name: Anna</span><br><span class="line">Age: 25</span><br><span class="line">Email: anna@mailserver.com</span><br><span class="line">Phone: 1234567890</span><br></pre></td></tr></table></figure><p>é€è¡Œé€è¡Œåœ°å¤„ç†è¯¥æ•°æ®ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">InputStream input = ... ; <span class="comment">// get the InputStream from the client socket</span></span><br><span class="line"></span><br><span class="line">BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(input));</span><br><span class="line"></span><br><span class="line">String nameLine   = reader.readLine();</span><br><span class="line">String ageLine    = reader.readLine();</span><br><span class="line">String emailLine  = reader.readLine();</span><br><span class="line">String phoneLine  = reader.readLine();</span><br></pre></td></tr></table></figure><p>ä»ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°ï¼Œç¨‹åºå½“å‰çš„çŠ¶æ€å–å†³äºç¨‹åºå·²ç»è¿è¡Œåˆ°å“ªä¸€è¡Œäº†ã€‚æ¢å¥è¯è¯´ï¼Œå½“ç¬¬ä¸€ä¸ª readLine() æ–¹æ³•è¿”å›æ—¶ï¼Œæˆ‘ä»¬å°±çŸ¥é“æ–‡æœ¬ä¸­çš„ç¬¬ä¸€è¡Œå®Œæ•´çš„å†…å®¹å·²ç»è¢«è¯»å–å‡ºæ¥äº†ï¼Œå› ä¸ºåœ¨readLine()è¯»å–å®Œä¸€æ•´è¡Œçš„å†…å®¹ä¹‹å‰ï¼Œå®ƒä¸€ç›´å¤„äºBlockçŠ¶æ€ã€‚è€Œä¸”ï¼Œä½ ä¹ŸçŸ¥é“ç¬¬ä¸€è¡Œè¯»å–å‡ºæ¥çš„å†…å®¹å°±æ˜¯åå­—ï¼Œç¬¬äºŒè¡Œåˆ™æ˜¯å¹´é¾„ï¼Œç¬¬ä¸‰ã€å››è¡Œç­‰ç­‰ã€‚</p><p>æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œåªæœ‰å½“æœ‰æ–°æ•°æ®è¦è¯»å–æ—¶ï¼Œç¨‹åºæ‰ä¼šè¿›è¡Œï¼Œå¹¶ä¸”å¯¹äºæ¯ä¸ªæ­¥éª¤ï¼Œä½ éƒ½çŸ¥é“è¯¥æ•°æ®æ˜¯ä»€ä¹ˆã€‚ ä¸€æ—¦æ‰§è¡Œçš„çº¿ç¨‹å·²ç»è¶…è¿‡è¯»å–ä»£ç ä¸­çš„æŸä¸ªæ•°æ®ç‰‡æ®µï¼Œè¯¥çº¿ç¨‹å°±ä¸ä¼šåœ¨æ•°æ®ä¸­å‘åç§»åŠ¨ï¼ˆé€šå¸¸ä¸ä¼šï¼‰ã€‚ å¦‚å›¾ï¼š</p><p><img src="https://img.i7years.com/blog/nio-vs-io-1.png" alt=""></p><p>NIO çš„å®ç°å°±å®Œå…¨ä¸ä¸€æ ·äº†ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ByteBuffer buffer = ByteBuffer.allocate(<span class="number">48</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> bytesRead = inChannel.read(buffer);</span><br></pre></td></tr></table></figure><p>æ³¨æ„ç¬¬äºŒè¡Œä»£ç ï¼Œä»channelä¸­è¯»å–å­—èŠ‚ä¿å­˜åˆ°Bufferä¸­ã€‚å½“ä½ è¿™ä¸ªread()æ–¹æ³•è¿”å›æ—¶ï¼Œä½ æ— æ³•çŸ¥é“ä½ æ‰€éœ€è¦çš„æ•°æ®æ˜¯å¦å·²ç»å…¨éƒ¨å­˜å‚¨åœ¨äº†Bufferä¸­ï¼Œä½ ä»…ä»…åªæ˜¯çŸ¥é“Bufferä¸­å­˜å‚¨ä¸€äº›å­—èŠ‚æ•°æ®ã€‚è¿™æ ·å°±è®©æ•°æ®å¤„ç†å˜å¾—ç¨å¾®å›°éš¾äº†ç‚¹ã€‚</p><p>æƒ³è±¡ä¸€ä¸‹ï¼Œåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ <code>read(buffer)</code> ä¹‹å ï¼Œbufferä¸­åªè¯»å–åˆ°äº†ä¸€åŠçš„æ•°æ®ï¼Œä¾‹å¦‚ï¼šâ€Name: Anâ€ã€‚ä½ èƒ½å¤„ç†è¿™æ ·ä¸å®Œæ•´çš„æ•°æ®å—ï¼Ÿå½“ç„¶ä¸èƒ½ï¼å› æ­¤ï¼Œåœ¨å¤„ç†ä»»ä½•æ•°æ®ä¹‹å‰ï¼Œä½ éœ€è¦ç­‰å¾…è‡³å°‘ä¸€æ•´è¡Œæ•°æ®è¿›å…¥ç¼“å†²åŒºã€‚</p><p>é‚£ä¹ˆï¼Œä½ æ€ä¹ˆçŸ¥é“Bufferä¸­åŒ…å«äº†ä½ æƒ³è¦å¤„ç†çš„æ•°æ®å‘¢ï¼Ÿå¾ˆæ˜¾ç„¶ï¼Œä¸èƒ½ã€‚å”¯ä¸€çš„åŠæ³•å°±æ˜¯å»æ£€æŸ¥Bufferä¸­çš„æ•°æ®ã€‚è¿™æ ·ä¸€æ¥ï¼Œåœ¨ä½ çŸ¥é“æ‰€æœ‰æ•°æ®æ˜¯å¦å­˜åœ¨ä¹‹å‰ï¼Œä½ å¯èƒ½éœ€è¦å¤šæ¬¡æ£€æŸ¥ç¼“å†²åŒºä¸­çš„æ•°æ®ã€‚è¿™æ ·å°±ä¼šå¯¼è‡´ç¨‹åºå˜å¾—ä½æ•ˆï¼Œè€Œä¸”ä»£ç å˜å¾—æœ‰ç‚¹æ··ä¹±ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ByteBuffer buffer = ByteBuffer.allocate(<span class="number">48</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> bytesRead = inChannel.read(buffer);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(! bufferFull(bytesRead) ) &#123;</span><br><span class="line">    bytesRead = inChannel.read(buffer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª <code>bufferFull()</code> æ–¹æ³•å¿…é¡»å»è·Ÿè¸ªæœ‰å¤šå°‘å­—èŠ‚å·²ç»è¯»å–åˆ°äº†Bufferä¸­ã€‚å½“Bufferä¸­çš„æ•°æ®å·²ç»å‡†å¤‡å¥½äº†çš„æ—¶å€™ï¼Œéœ€è¦è¿”å›tureï¼Œå¦åˆ™è¿”å›falseã€‚</p><p><code>bufferFull()</code> æ–¹æ³•æ‰«æç¼“å†²åŒºï¼Œä½†å¿…é¡»ä½¿ç¼“å†²åŒºä¿æŒä¸è°ƒç”¨ bufferFull() æ–¹æ³•ä¹‹å‰ç›¸åŒçš„çŠ¶æ€ã€‚å¦åˆ™ï¼Œä¸‹ä¸€ä¸ªå°†è¦è¯»å–åˆ°ç¼“å†²åŒºçš„æ•°æ®å¯èƒ½æ— æ³•åœ¨æ­£ç¡®çš„position(ä½ç½®)ä¸Šè¢«è¯»å–ã€‚ è¿™ä¸æ˜¯ä¸å¯èƒ½çš„ï¼Œä½†è¿™æ˜¯å¦ä¸€ä¸ªéœ€è¦æ³¨æ„çš„é—®é¢˜ã€‚</p><p>å¦‚æœç¼“å†²åŒºå·²æ»¡ï¼Œåˆ™å¯ä»¥å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚ å¦‚æœå®ƒä¸æ»¡ï¼Œä½ å¯ä»¥å¯¹ç¼“å†²åŒºä¸­çš„éƒ¨åˆ†æ•°æ®è¿›è¡Œå¤„ç†ï¼Œä½†è¿™æ ·å¤„ç†çš„å‰ææ˜¯å¯¹ä½ æ‰€æ„ä¹‰ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œä¸€èˆ¬æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚</p><p>è¯·çœ‹ç¼“å†²åŒºå¤„ç†æ•°æ®çš„ç¤ºæ„å›¾ï¼š</p><p><img src="https://img.i7years.com/blog/nio-vs-io-2.png" alt=""></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>NIOå…è®¸ä½ ä»…ä½¿ç”¨ä¸€ä¸ªï¼ˆæˆ–å‡ ä¸ªï¼‰çº¿ç¨‹æ¥ç®¡ç†å¤šä¸ªé€šé“ï¼ˆç½‘ç»œè¿æ¥æˆ–æ–‡ä»¶ï¼‰ï¼Œä½†æˆæœ¬æ˜¯è§£ææ•°æ®å¯èƒ½æ¯”ä»é˜»å¡æµä¸­è¯»å–æ•°æ®æ—¶è¦å¤æ‚ä¸€äº›ã€‚</p><p>å¦‚æœä½ éœ€è¦åŒæ—¶ç®¡ç†æ•°ä»¥åƒè®¡çš„æ´»è·ƒè¿æ¥ï¼Œæ¯ä¸ªåªå‘é€ä¸€äº›æ•°æ®ï¼Œä¾‹å¦‚èŠå¤©æœåŠ¡å™¨ï¼Œç”¨NIOæ¥å®ç°æœåŠ¡å™¨å¯èƒ½æ˜¯æ˜æ™ºçš„é€‰æ‹©ã€‚ åŒæ ·ï¼Œå¦‚æœä½ éœ€è¦ä¸å…¶ä»–è®¡ç®—æœºä¿æŒå¤§é‡çš„å¼€æ”¾è¿æ¥ï¼Œä¾‹å¦‚åœ¨P2Pç½‘ç»œä¸­ï¼Œä½¿ç”¨å•ä¸ªçº¿ç¨‹æ¥ç®¡ç†æ‰€æœ‰å‡ºç«™è¿æ¥å¯èƒ½æ˜¯æ¯”è¾ƒå¥½çš„é€‰æ‹©ã€‚ æ­¤å›¾ä¸­è¯´æ˜äº†ä¸€ä¸ªçº¿ç¨‹ç®¡ç†å¤šä¸ªè¿æ¥çš„è®¾è®¡ï¼š</p><p><img src="https://img.i7years.com/blog/nio-vs-io-3.png" alt=""></p><p>å¦‚æœæ‚¨æ‹¥æœ‰è¾ƒå°‘çš„ä¸”å¸¦å®½é«˜çš„è¿æ¥ï¼Œä¸€æ¬¡éœ€è¦å‘é€å¤§é‡æ•°æ®ï¼Œé‚£ä¹ˆç»å…¸çš„IOæœåŠ¡å™¨å®ç°å¯èƒ½æ˜¯æœ€åˆé€‚çš„ã€‚æ­¤å›¾è¯´æ˜äº†å…¸å‹çš„IOæœåŠ¡å™¨è®¾è®¡ï¼š</p><p><img src="https://img.i7years.com/blog/nio-vs-io-4.png" alt=""></p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="http://tutorials.jenkov.com/java-nio/nio-vs-io.html" target="_blank" rel="noopener">http://tutorials.jenkov.com/java-nio/nio-vs-io.html</a></li><li><a href="http://www.studytrails.com/java-io/io-vs-nio/" target="_blank" rel="noopener">http://www.studytrails.com/java-io/io-vs-nio/</a></li><li><a href="https://web.archive.org/web/20140528182031/https://blogs.oracle.com/slc/entry/javanio_vs_javaio" target="_blank" rel="noopener">https://web.archive.org/web/20140528182031/https://blogs.oracle.com/slc/entry/javanio_vs_javaio</a></li><li><a href="http://www.importnew.com/1178.html" target="_blank" rel="noopener">http://www.importnew.com/1178.html</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> NIO </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Java NIO2 Asynchronous Channel APIs]]></title>
      <url>/posts/java-nio2-asynchronous-channel.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><a href="https://wangwei.one/posts/319e2a29.html">å‰é¢</a> æˆ‘ä»¬ä»‹ç»äº†NIOä¸­ä¸€ç³»åˆ—åŒæ­¥éé˜»å¡APIçš„ç”¨æ³•ã€‚åœ¨Java 7ä¸­å¼•å…¥äº†NIOçš„æ”¹è¿›ç‰ˆNIO 2ï¼ŒNIO 2 ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ AIOï¼Œå®ƒæ˜¯<strong>å¼‚æ­¥éé˜»å¡</strong>çš„IOæ–¹å¼ã€‚</p><p>AIOçš„æ ¸å¿ƒæ¦‚å¿µå°±æ˜¯å‘èµ·éé˜»å¡æ–¹å¼çš„I/Oæ“ä½œï¼Œç«‹å³å“åº”ï¼Œå´ä¸ç«‹å³è¿”å›ç»“æœï¼Œå½“I/Oæ“ä½œå®Œæˆæ—¶é€šçŸ¥ã€‚</p><a id="more"></a><h2 id="Asynchronous-Channel-APIs-å·¥ä½œåŸç†"><a href="#Asynchronous-Channel-APIs-å·¥ä½œåŸç†" class="headerlink" title="Asynchronous Channel APIs å·¥ä½œåŸç†"></a>Asynchronous Channel APIs å·¥ä½œåŸç†</h2><p>ä»Java 7å¼€å§‹ï¼Œjava.nio.channelåŒ…ä¸­æ–°å¢åŠ 4ä¸ªå¼‚æ­¥Channelï¼š</p><ul><li><em>AsynchronousFileChannel</em></li><li><em>AsynchronousSocketChannel</em></li><li><em>AsynchronousServerSocketChannel</em></li><li><em>AsynchronousDatagramChannel</em></li></ul><p>ä»åå­—ä¸Šï¼Œä½ å¯ä»¥æ„Ÿå—åˆ°å®ƒä»¬ä¸åŒæ­¥éé˜»å¡Channel APIåœ¨é£æ ¼ä¸Šæœ‰äº›ç±»ä¼¼ã€‚è€Œä¸”ï¼ŒåŒæ­¥éé˜»å¡Channel APIä¸­çš„è¯¸å¤šç”¨æ³•åœ¨æ–°çš„å¼‚æ­¥éé˜»å¡Channelä¸­ä¾ç„¶é€‚ç”¨ï¼Œä¸åŒä¹‹å¤„åœ¨äºï¼Œ<strong>æ–°çš„å¼‚æ­¥Channelèƒ½å¤Ÿå…è®¸ä¸€äº›æ“ä½œå¼‚æ­¥æ‰§è¡Œ</strong>ã€‚</p><p>å½“æ“ä½œå¯åŠ¨æ—¶ï¼Œå¼‚æ­¥é€šé“APIä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§ç”¨äºç›‘è§†å’Œæ§åˆ¶æŒ‚èµ·æ“ä½œçš„å¤‡é€‰æ–¹æ¡ˆã€‚</p><ul><li>ç¬¬ä¸€ç§é€šè¿‡è¿”å›ä¸€ä¸ª <strong>java.util.concurrent.Futureå¯¹è±¡</strong>æ¥è¡¨ç¤ºå¼‚æ­¥æ“ä½œçš„ç»“æœ</li><li>ç¬¬äºŒç§æ˜¯é€šè¿‡ä¼ é€’ç»™æ“ä½œä¸€ä¸ªæ–°ç±»çš„å¯¹è±¡ <strong>java.nio.channels.CompletionHandler</strong>æ¥å®Œæˆï¼Œå®ƒä¼šå®šä¹‰åœ¨æ“ä½œå®Œæˆåæ‰€æ‰§è¡Œçš„å¤„ç†æ–¹æ³•ã€‚</li></ul><h2 id="Futureæ–¹å¼"><a href="#Futureæ–¹å¼" class="headerlink" title="Futureæ–¹å¼"></a>Futureæ–¹å¼</h2><p><strong>Future</strong> å¯¹è±¡ä»£è¡¨äº†å¼‚æ­¥æ“ä½œæ‰§è¡Œçš„ç»“æœã€‚å‡è®¾æˆ‘ä»¬æƒ³è¦åˆ›å»ºä¸€ä¸ªæœåŠ¡æ¥ç›‘å¬å®¢æœç«¯çš„è¿æ¥ï¼Œæˆ‘ä»¬è°ƒç”¨ <em>AsynchronousServerSocketChannel</em> çš„é™æ€æ–¹æ³• open()ï¼Œå¹¶ç»‘åˆ°åˆ°ä¸€ä¸ªç«¯å£ä¸Šï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">AsynchronousServerSocketChannel serverSocketChannel = AsynchronousServerSocketChannel</span><br><span class="line">                    .open()</span><br><span class="line">                    .bind(<span class="keyword">new</span> InetSocketAddress(<span class="string">"127.0.0.1"</span>, <span class="number">8899</span>));</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œè°ƒç”¨ accept() æ–¹æ³•ï¼Œè¿”å› SocketChannelï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;AsynchronousSocketChannel&gt; future = serverSocketChannel.accept();</span><br></pre></td></tr></table></figure><p>åœ¨æ ‡å‡†çš„NIOä¸­ï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨ServerSocketChannelä¸­çš„ accept() æ–¹æ³•ï¼Œåœ¨è®¾ç½®äº†block modeä¸ºtrueçš„æƒ…å†µä¸‹ï¼Œå®ƒå°†ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°æœ‰å®¢æˆ·ç«¯çš„è¿æ¥è¿›æ¥ã€‚ä½†æ˜¯ AsynchronousSocketChannelçš„accept()æ–¹æ³•ï¼Œåˆ™ä¼šç«‹å³è¿”å›ä¸€ä¸ª Future å¯¹è±¡ã€‚</p><p>Futureå¯¹è±¡çš„æ³›å‹ç±»å‹æ˜¯æ“ä½œçš„è¿”å›ç±»å‹ã€‚ åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå®ƒæ˜¯AsynchronousSocketChannelï¼Œä½†å®ƒä¹Ÿå¯ä»¥æ˜¯Integeræˆ–Stringï¼Œå…·ä½“å–å†³äºæ“ä½œçš„æœ€ç»ˆè¿”å›ç±»å‹ã€‚</p><h5 id="æ£€æŸ¥æ˜¯å¦å®Œæˆ"><a href="#æ£€æŸ¥æ˜¯å¦å®Œæˆ" class="headerlink" title="æ£€æŸ¥æ˜¯å¦å®Œæˆ"></a>æ£€æŸ¥æ˜¯å¦å®Œæˆ</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">future.isDone();</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœåº•å±‚çš„æ“ä½œå·²ç»å®Œæˆï¼Œåˆ™è¿”å› trueã€‚ è¯·æ³¨æ„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®Œæˆå¯èƒ½æ„å‘³ç€æ­£å¸¸ç»ˆæ­¢ã€å¼‚å¸¸æˆ–å–æ¶ˆã€‚</p></blockquote><h5 id="æ£€æŸ¥æ“ä½œæ˜¯å¦å–æ¶ˆ"><a href="#æ£€æŸ¥æ“ä½œæ˜¯å¦å–æ¶ˆ" class="headerlink" title="æ£€æŸ¥æ“ä½œæ˜¯å¦å–æ¶ˆ"></a>æ£€æŸ¥æ“ä½œæ˜¯å¦å–æ¶ˆ</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">future.isCancelled();</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœæ“ä½œåœ¨æ­£å¸¸å®Œæˆä¹‹å‰è¢«å–æ¶ˆï¼Œåˆ™è¿”å› trueã€‚</p></blockquote><h5 id="å°è¯•å–æ¶ˆæ“ä½œ"><a href="#å°è¯•å–æ¶ˆæ“ä½œ" class="headerlink" title="å°è¯•å–æ¶ˆæ“ä½œ"></a>å°è¯•å–æ¶ˆæ“ä½œ</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">future.cancel(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure><p>å¦‚æœä»»åŠ¡å·²å®Œæˆï¼Œå·²å–æ¶ˆæˆ–ç”±äºæŸäº›å…¶ä»–åŸå› æ— æ³•å–æ¶ˆï¼Œåˆ™æ­¤å°è¯•å°†å¤±è´¥ï¼Œè¿”å›falseã€‚ å¦‚æœæˆåŠŸï¼Œå¹¶ä¸”åœ¨è°ƒç”¨canel()æ¥å£æ—¶æ­¤ä»»åŠ¡å°šæœªå¯åŠ¨ï¼Œåˆ™æ­¤ä»»åŠ¡æ°¸è¿œä¸ä¼šè¿è¡Œã€‚ å¦‚æœä»»åŠ¡å·²ç»å¼€å§‹ï¼Œåˆ™ç”± <code>mayInterruptIfRunning</code> å‚æ•°ç¡®å®šæ˜¯å¦åº”è¯¥åœ¨å°è¯•åœæ­¢ä»»åŠ¡æ—¶ä¸­æ–­æ‰§è¡Œæ­¤ä»»åŠ¡çš„çº¿ç¨‹ã€‚</p><h5 id="è·å–æ“ä½œç»“æœ"><a href="#è·å–æ“ä½œç»“æœ" class="headerlink" title="è·å–æ“ä½œç»“æœ"></a>è·å–æ“ä½œç»“æœ</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">AsynchronousSocketChannel client= future.get();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®10sçš„é˜»å¡æ—¶é—´</span></span><br><span class="line">AsynchronousSocketChannel worker = future.get(<span class="number">10</span>, TimeUnit.SECONDS);</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬åœ¨æ“ä½œå®Œæˆå‰è°ƒç”¨æ­¤APIï¼Œå®ƒå°†ä¸€ç›´é˜»å¡ï¼Œç›´åˆ°æ“ä½œå®Œæˆå¹¶è¿”å›æ“ä½œç»“æœã€‚</p><h2 id="CompletionHandler-æ–¹å¼"><a href="#CompletionHandler-æ–¹å¼" class="headerlink" title="CompletionHandler æ–¹å¼"></a>CompletionHandler æ–¹å¼</h2><p>ä½¿ç”¨Futureæ¥å¤„ç†æ“ä½œçš„æ›¿ä»£æ–¹æ³•æ˜¯ä½¿ç”¨CompletionHandlerç±»çš„å›è°ƒæœºåˆ¶ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">AsynchronousServerSocketChannel listener = AsynchronousServerSocketChannel.open().bind(<span class="keyword">null</span>);</span><br><span class="line"> </span><br><span class="line">listener.accept(</span><br><span class="line">  attachment, <span class="keyword">new</span> CompletionHandler&lt;AsynchronousSocketChannel, Object&gt;() &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">completed</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      AsynchronousSocketChannel client, Object attachment)</span> </span>&#123;</span><br><span class="line">          <span class="comment">// do whatever with client</span></span><br><span class="line">      &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">failed</span><span class="params">(Throwable exc, Object attachment)</span> </span>&#123;</span><br><span class="line">          <span class="comment">// handle failure</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p>å½“ I/O æ“ä½œå®Œå…¨æˆåŠŸæ—¶ï¼Œ<code>completed()</code> æ¥å£å°†ä¼šè¢«è°ƒç”¨ã€‚å¦‚æœæ“ä½œå¤±è´¥ï¼Œåˆ™è°ƒç”¨ <code>failed()</code> æ¥å£ã€‚</p><h2 id="AsynchronousFileChannel"><a href="#AsynchronousFileChannel" class="headerlink" title="AsynchronousFileChannel"></a>AsynchronousFileChannel</h2><p>ç†è§£äº†å‰é¢æˆ‘ä»¬è®²çš„ Asynchronous Channel API çš„ä½¿ç”¨æ–¹æ³•ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥ä»‹ç»AsynchronousFileChannelçš„ä½¿ç”¨ã€‚</p><h3 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Path path = Paths.get(<span class="string">"/Users/wangwei/Desktop/test.txt"</span>);</span><br><span class="line">AsynchronousFileChannel fileChannel = AsynchronousFileChannel.open(path,</span><br><span class="line">       StandardOpenOption.READ,</span><br><span class="line">       StandardOpenOption.WRITE,</span><br><span class="line">       StandardOpenOption.CREATE);</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šæ–‡ä»¶çš„è·¯å¾„ï¼Œç¬¬äºŒå‚æ•°æŒ‡å®šæ–‡ä»¶æ‰“å¼€ä¹‹åçš„æ“ä½œæ–¹å¼ï¼Œ<code>java.nio.file.StandardOpenOption</code> æšä¸¾ä¸­å®šä¹‰äº†ä¸€äº›åˆ—çš„æ“ä½œæ–¹å¼ã€‚</p><h3 id="è¯»å–æ–‡ä»¶"><a href="#è¯»å–æ–‡ä»¶" class="headerlink" title="è¯»å–æ–‡ä»¶"></a>è¯»å–æ–‡ä»¶</h3><h4 id="Future-æ–¹å¼"><a href="#Future-æ–¹å¼" class="headerlink" title="Future æ–¹å¼"></a>Future æ–¹å¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">AsynchronousFileChannel fileChannel =</span><br><span class="line">    AsynchronousFileChannel.open(path, StandardOpenOption.READ);</span><br><span class="line"></span><br><span class="line">ByteBuffer buffer = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">Future&lt;Integer&gt; operation = fileChannel.read(buffer, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//run other code as operation continues in background</span></span><br><span class="line"></span><br><span class="line">operation.get();</span><br><span class="line"></span><br><span class="line">String fileContent = <span class="keyword">new</span> String(buffer.array()).trim();</span><br><span class="line">buffer.clear();</span><br><span class="line">System.out.println(fileContent);</span><br></pre></td></tr></table></figure><p>fileChannel.read() æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•° byteBuffer ç”¨äºå­˜å‚¨è¯»å–çš„æ–‡ä»¶å†…å®¹ï¼Œç¬¬äºŒå‚æ•°æŒ‡å®šèµ·å§‹çš„è¯»å–ä½ç½®ã€‚è¯¥æ–¹æ³•å°†ä¼šç«‹å³è¿”å›ï¼Œä¸ç®¡æ–‡ä»¶æ˜¯å¦è¯»å–å®Œæ¯•ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œä»£ç å°†ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œè€Œä¸æ­¤åŒæ—¶read()æ“ä½œè¿˜ä¾æ—§åœ¨åå°è¿è¡Œã€‚å½“æˆ‘ä»¬æ‰§è¡Œå®Œå…¶å®ƒä»£ç ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ get() æ¥å£ï¼Œå¦‚æœè¯»å–æ“ä½œå·²ç»å®Œæˆï¼Œåˆ™get() æ¥å£ä¼šç«‹å³è¿”å›ç»“æœï¼Œå¦åˆ™ä¼šä¸€ç›´é˜»å¡ç›´åˆ°æ“ä½œå®Œæˆã€‚</p><h4 id="CompletionHandler-æ–¹å¼-1"><a href="#CompletionHandler-æ–¹å¼-1" class="headerlink" title="CompletionHandler æ–¹å¼"></a>CompletionHandler æ–¹å¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Path path = Paths.get(<span class="string">"//Users/wangwei/VirtualBox VMs/Win10_1803_English_x64.iso"</span>);</span><br><span class="line">AsynchronousFileChannel fileChannel = AsynchronousFileChannel.open(path, StandardOpenOption.READ);</span><br><span class="line"></span><br><span class="line">ByteBuffer buffer = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">fileChannel.read(buffer, <span class="number">0</span>, buffer,</span><br><span class="line">      <span class="keyword">new</span> CompletionHandler&lt;Integer, ByteBuffer&gt;() &#123;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">completed</span><span class="params">(Integer result, ByteBuffer attachment)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO</span></span><br><span class="line">        <span class="comment">// result is number of bytes read</span></span><br><span class="line">        <span class="comment">// attachment is the buffer containing content</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">failed</span><span class="params">(Throwable exc, ByteBuffer attachment)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO</span></span><br><span class="line">      &#125;</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç æˆ‘ä»¬ç”¨åˆ°äº†å¦ä¸€ä¸ª read() æ¥å£ï¼Œä½¿ç”¨äº† <em>CompletionHandler</em> ç±»ã€‚å®ƒçš„ç¬¬ä¸€ä¸ªæ³›å‹å‚æ•°è¡¨ç¤ºæ“ä½œçš„è¿”å›ç±»å‹ï¼Œåœ¨ AsynchronousFileChannel è¿™ä¸ªä¾‹å­åˆ™è¿”å› Integer ç±»å‹ï¼Œè¡¨ç¤ºè¯»å–çš„å­—èŠ‚æ•°ã€‚</p><p>ç¬¬äºŒä¸ªæ³›å‹å‚æ•°è¡¨ç¤ºçš„æ˜¯é™„åŠ å¯¹è±¡ç±»å‹ï¼Œ è¿™é‡Œæˆ‘ä»¬é€‰æ‹©é™„åŠ ç¼“å†²åŒºï¼Œä»¥ä¾¿åœ¨è¯»å–å®Œæˆæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <em>completed</em> å›è°ƒAPIä¸­ä½¿ç”¨æ–‡ä»¶ä¸­çš„å†…å®¹ã€‚</p><h3 id="å†™å…¥æ–‡ä»¶"><a href="#å†™å…¥æ–‡ä»¶" class="headerlink" title="å†™å…¥æ–‡ä»¶"></a>å†™å…¥æ–‡ä»¶</h3><p>åŒè¯»å–ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹å¼æ¥å†™å…¥æ–‡ä»¶å†…å®¹ï¼Œå…ˆæ¥åˆ›å»º AsynchronousFileChannelï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AsynchronousFileChannel fileChannel</span><br><span class="line">  = AsynchronousFileChannel.open(path, StandardOpenOption.WRITE);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„æ“ä½œç±»å‹è®¾ç½®ä¸ºäº† <code>StandardOpenOption.WRITE</code> ã€‚</p><h4 id="Future-æ–¹å¼-1"><a href="#Future-æ–¹å¼-1" class="headerlink" title="Future æ–¹å¼"></a>Future æ–¹å¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">AsynchronousFileChannel fileChannel =</span><br><span class="line">    AsynchronousFileChannel.open(path, StandardOpenOption.READ);</span><br><span class="line"></span><br><span class="line">ByteBuffer buffer = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">buffer.put(<span class="string">"hello world"</span>.getBytes());</span><br><span class="line">buffer.flip();</span><br><span class="line"></span><br><span class="line">Future&lt;Integer&gt; operation = fileChannel.write(buffer, <span class="number">0</span>);</span><br><span class="line">buffer.clear();</span><br><span class="line"> </span><br><span class="line"><span class="comment">//run other code as operation continues in background</span></span><br><span class="line"></span><br><span class="line">operation.get();</span><br></pre></td></tr></table></figure><h4 id="CompletionHandler-æ–¹å¼-2"><a href="#CompletionHandler-æ–¹å¼-2" class="headerlink" title="CompletionHandler æ–¹å¼"></a>CompletionHandler æ–¹å¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">AsynchronousFileChannel fileChannel =</span><br><span class="line">    AsynchronousFileChannel.open(path, StandardOpenOption.READ);</span><br><span class="line"></span><br><span class="line">ByteBuffer buffer = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">buffer.put(<span class="string">"hello world"</span>.getBytes());</span><br><span class="line">buffer.flip();</span><br><span class="line"></span><br><span class="line">fileChannel.write(</span><br><span class="line">      buffer, <span class="number">0</span>, buffer, <span class="keyword">new</span> CompletionHandler&lt;Integer, ByteBuffer&gt;() &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">completed</span><span class="params">(Integer result, ByteBuffer attachment)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// result is number of bytes written</span></span><br><span class="line">            <span class="comment">// attachment is the buffer</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">failed</span><span class="params">(Throwable exc, ByteBuffer attachment)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="http://tutorials.jenkov.com/java-nio/asynchronousfilechannel.html" target="_blank" rel="noopener">http://tutorials.jenkov.com/java-nio/asynchronousfilechannel.html</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> NIO </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Java NIO Pipe]]></title>
      <url>/posts/java-nio-pipe.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>Java NIO Pipeæ˜¯ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´çš„å•å‘æ•°æ®è¿æ¥ã€‚ Pipe(ç®¡é“)å…·æœ‰ source channel(æºé€šé“) å’Œ sink channel(æ¥æ”¶å™¨é€šé“) ã€‚ ä½ å°†æ•°æ®å†™å…¥æ¥æ”¶å™¨é€šé“ï¼Œç„¶åå¯ä»¥ä»æºé€šé“è¯»å–è¯¥æ•°æ®ã€‚</p><a id="more"></a><p>ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://img.i7years.com/blog/pipe-internals.png" alt="pipe-internals"></p><h2 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h2><h3 id="åˆ›å»ºPipe"><a href="#åˆ›å»ºPipe" class="headerlink" title="åˆ›å»ºPipe"></a>åˆ›å»ºPipe</h3><p>ç›´æ¥è°ƒç”¨ <code>open()</code> æ–¹æ³•åˆ›å»º Pipe. å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pipe pipe = Pipe.open();</span><br></pre></td></tr></table></figure><h3 id="å†™å…¥Pipe"><a href="#å†™å…¥Pipe" class="headerlink" title="å†™å…¥Pipe"></a>å†™å…¥Pipe</h3><p>æ•°æ®å…ˆè¦å†™å…¥åˆ°sink channelï¼Œå› æ­¤å…ˆè¦è·å–sink channel.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pipe.SinkChannel sinkChannel = pipe.sink();</span><br></pre></td></tr></table></figure><p>å†™å…¥ sinkChannel()ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">String newData = <span class="string">"New String to write to file..."</span> + System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">ByteBuffer buf = ByteBuffer.allocate(<span class="number">48</span>);</span><br><span class="line">buf.clear();</span><br><span class="line">buf.put(newData.getBytes());</span><br><span class="line"></span><br><span class="line">buf.flip();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(buf.hasRemaining()) &#123;</span><br><span class="line">    sinkChannel.write(buf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è¯»å–Pipe"><a href="#è¯»å–Pipe" class="headerlink" title="è¯»å–Pipe"></a>è¯»å–Pipe</h3><p>ä»Pipeä¸­è¯»å–æ•°æ®ï¼Œå…ˆè¦è·å– soucechannelã€‚å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pipe.SourceChannel sourceChannel = pipe.source();</span><br></pre></td></tr></table></figure><p>è°ƒç”¨ read() æ–¹æ³•ä» sorce channel ä¸­è¯»å–æ•°æ®ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ByteBuffer buf = ByteBuffer.allocate(<span class="number">48</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> bytesRead = inChannel.read(buf);</span><br></pre></td></tr></table></figure><p>è¿”å›çš„ int æ•°æ®ï¼Œè¡¨ç¤ºå·²æœ‰å¤šå°‘bytesè¯»åˆ°bufferä¸­å»äº†ã€‚</p><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.java.nio;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.Pipe;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PipeExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//The Pipe is created</span></span><br><span class="line">            Pipe pipe = Pipe.open();</span><br><span class="line">            <span class="comment">//For accessing the pipe sink channel</span></span><br><span class="line">            Pipe.SinkChannel skChannel = pipe.sink();</span><br><span class="line">            String td = <span class="string">"Data is successfully sent for checking the java NIO Channel Pipe."</span>;</span><br><span class="line">            ByteBuffer bb = ByteBuffer.allocate(<span class="number">512</span>);</span><br><span class="line">            bb.clear();</span><br><span class="line">            bb.put(td.getBytes());</span><br><span class="line">            bb.flip();</span><br><span class="line">            <span class="comment">//write the data into a sink channel.</span></span><br><span class="line">            <span class="keyword">while</span> (bb.hasRemaining()) &#123;</span><br><span class="line">                skChannel.write(bb);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//For accessing the pipe source channel</span></span><br><span class="line">            Pipe.SourceChannel sourceChannel = pipe.source();</span><br><span class="line">            bb = ByteBuffer.allocate(<span class="number">512</span>);</span><br><span class="line">            <span class="comment">//The data is write to the console</span></span><br><span class="line">            <span class="keyword">while</span> (sourceChannel.read(bb) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                bb.flip();</span><br><span class="line">                <span class="keyword">while</span> (bb.hasRemaining()) &#123;</span><br><span class="line">                    <span class="keyword">char</span> TestData = (<span class="keyword">char</span>) bb.get();</span><br><span class="line">                    System.out.print(TestData);</span><br><span class="line">                &#125;</span><br><span class="line">                bb.clear();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="http://tutorials.jenkov.com/java-nio/pipe.html" target="_blank" rel="noopener">http://tutorials.jenkov.com/java-nio/pipe.html</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> NIO </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Java NIO ServerSocketChannelã€SocketChannelã€DatagramChannel]]></title>
      <url>/posts/java-nio-server-socket-datagram-channel.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><a href="https://wangwei.one/posts/d7aa1132.html">å‰é¢</a> æˆ‘ä»¬ä»‹ç»äº† FileChannelï¼Œæœ¬ç¯‡æˆ‘ä»¬æ¥ä¸€èµ·å­¦ä¹  SocketChannel, ServerSocketChannelä¸DatagramChannelã€‚</p><a id="more"></a><h2 id="ServerSocketChannel"><a href="#ServerSocketChannel" class="headerlink" title="ServerSocketChannel"></a>ServerSocketChannel</h2><p>Java NIO ServerSocketChannel æ˜¯ç”¨äºç›‘å¬TCPç«¯å£è¿æ¥çš„é€šé“ï¼Œä¸ Javaæ ‡å‡†IOä¸­çš„ServerSocketä¸€æ ·ã€‚ServerSocketChannel ä½äº <code>java.nio.channels</code> åŒ…ä¸‹ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();</span><br><span class="line">serverSocketChannel.socket().bind(<span class="keyword">new</span> InetSocketAddress(<span class="number">9999</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">    SocketChannel socketChannel = serverSocketChannel.accept();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//do something with socketChannel...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ‰“å¼€-ServerSocketChannel"><a href="#æ‰“å¼€-ServerSocketChannel" class="headerlink" title="æ‰“å¼€ ServerSocketChannel"></a>æ‰“å¼€ ServerSocketChannel</h3><p>é€šè¿‡è°ƒç”¨ <code>ServerSocketChannel.open()</code> æ–¹æ³•ï¼Œå³å¯æ‰“å¡ä¸€ä¸ªServerSocketChannelï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();</span><br></pre></td></tr></table></figure><h3 id="å…³é—­-ServerSocketChannel"><a href="#å…³é—­-ServerSocketChannel" class="headerlink" title="å…³é—­ ServerSocketChannel"></a>å…³é—­ ServerSocketChannel</h3><p>è°ƒç”¨ serverSocketChannel ä¸­çš„ <code>close()</code> æ–¹æ³•ï¼Œå³å¯å…³é—­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">serverSocket.close();</span><br></pre></td></tr></table></figure><h3 id="ç›‘å¬ä¼ å…¥è¿æ¥"><a href="#ç›‘å¬ä¼ å…¥è¿æ¥" class="headerlink" title="ç›‘å¬ä¼ å…¥è¿æ¥"></a>ç›‘å¬ä¼ å…¥è¿æ¥</h3><p>é€šè¿‡è°ƒç”¨ <code>ServerSocketChannel.accept()</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æ¥ç›‘å¬TCPç«¯å£ä¸Šçš„è¿æ¥ã€‚å½“ accept() è¿”å›æ—¶ï¼Œå®ƒå°†è¿”å›å¸¦æœ‰ä¼ å…¥è¿æ¥çš„SocketChannelã€‚å› æ­¤ï¼Œaccept() æ–¹æ³•ä¼šä¸€ç›´é˜»å¡åˆ°æœ‰ä¼ å…¥è¿æ¥åˆ°è¾¾ä½ç½®ã€‚</p><p>ç”±äºæ‚¨é€šå¸¸ä¸æƒ³åªå¬ä¸€ä¸ªè¿æ¥ï¼Œæ‰€ä»¥åœ¨whileå¾ªç¯ä¸­è°ƒç”¨accept()ã€‚å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">    SocketChannel socketChannel = serverSocketChannel.accept();</span><br><span class="line">    <span class="comment">//do something with socketChannel...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Non-blocking-æ¨¡å¼"><a href="#Non-blocking-æ¨¡å¼" class="headerlink" title="Non-blocking æ¨¡å¼"></a>Non-blocking æ¨¡å¼</h3><p>ServerSocketChannel å¯ä»¥è®¾ç½®ä¸º non-blocking æ¨¡å¼ï¼Œå³ä½¿æ²¡æœ‰ä¼ å…¥è¿æ¥è¾¾åˆ°ï¼Œaccept() æ–¹æ³•ä¹Ÿä¼šç«‹å³è¿”å›ã€‚å› æ­¤ï¼Œä½ éœ€è¦æ£€æŸ¥è¿”å›çš„SocketChannelæ˜¯å¦ä¸ºnullã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();</span><br><span class="line">serverSocketChannel.socket().bind(<span class="keyword">new</span> InetSocketAddress(<span class="number">9999</span>));</span><br><span class="line">serverSocketChannel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">    SocketChannel socketChannel = serverSocketChannel.accept();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(socketChannel != <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="comment">//do something with socketChannel...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="SocketChannel"><a href="#SocketChannel" class="headerlink" title="SocketChannel"></a>SocketChannel</h2><p>Java NIO SocketChannel æ˜¯ç”¨äºè¿æ¥TCPç½‘ç»œSocketçš„é€šé“ã€‚æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥æ¥åˆ›å»º SocketChannelï¼š</p><ol><li>æ‰“å¼€ä¸€ä¸ªSocketChannelï¼Œå¹¶è¿æ¥åˆ°ç½‘ç»œä¸Šçš„æŸä¸ªæœåŠ¡çš„TCPç«¯å£ä¸Šã€‚</li><li>åœ¨ServerSocketChannelä¸­æåˆ°è¿‡ï¼Œå½“æœ‰ä¼ å…¥è¿æ¥è¿›æ¥æ˜¯ï¼ŒServerSocketChannelçš„accpet()æ–¹æ³•å¯ä»¥è·å¾—SocketChannel.</li></ol><h3 id="æ‰“å¼€SocketChannel"><a href="#æ‰“å¼€SocketChannel" class="headerlink" title="æ‰“å¼€SocketChannel"></a>æ‰“å¼€SocketChannel</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SocketChannel socketChannel = SocketChannel.open();</span><br><span class="line">socketChannel.connect(<span class="keyword">new</span> InetSocketAddress(<span class="string">"127.0.0.1"</span>, <span class="number">80</span>));</span><br></pre></td></tr></table></figure><h3 id="å…³é—­SocketChannel"><a href="#å…³é—­SocketChannel" class="headerlink" title="å…³é—­SocketChannel"></a>å…³é—­SocketChannel</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socketChannel.close();</span><br></pre></td></tr></table></figure><h3 id="è¯»å–æ•°æ®"><a href="#è¯»å–æ•°æ®" class="headerlink" title="è¯»å–æ•°æ®"></a>è¯»å–æ•°æ®</h3><p>ä»socketchannelä¸­è¯»å–æ•°æ®åˆ°byteBufferä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ByteBuffer buf = ByteBuffer.allocate(<span class="number">48</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> bytesRead = socketChannel.read(buf);</span><br></pre></td></tr></table></figure><h3 id="å†™å…¥æ•°æ®"><a href="#å†™å…¥æ•°æ®" class="headerlink" title="å†™å…¥æ•°æ®"></a>å†™å…¥æ•°æ®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">String newData = <span class="string">"New String to write to file..."</span> + System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">ByteBuffer buf = ByteBuffer.allocate(<span class="number">48</span>);</span><br><span class="line">buf.clear();</span><br><span class="line">buf.put(newData.getBytes());</span><br><span class="line"></span><br><span class="line">buf.flip();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(buf.hasRemaining()) &#123;</span><br><span class="line">    channel.write(buf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Non-blockingæ¨¡å¼"><a href="#Non-blockingæ¨¡å¼" class="headerlink" title="Non-blockingæ¨¡å¼"></a>Non-blockingæ¨¡å¼</h3><p>æˆ‘ä»¬å¯ä»¥è®¾ç½® SocketChannel ä¸º éé˜»å¡æ¨¡å¼ï¼Œè¿™æ ·çš„è¯ï¼Œ ä½ å°±å¯ä»¥ç”¨å¼‚æ­¥æ¨¡å¼æ¥è°ƒç”¨ <code>connect()</code>, <code>read()</code> å’Œ <code>write()</code> æ–¹æ³•ã€‚</p><h4 id="connect"><a href="#connect" class="headerlink" title="connect()"></a>connect()</h4><p>å¦‚æœ SocketChannel å¤„äº éé˜»å¡æ¨¡å¼ï¼Œå¹¶ä¸”è°ƒç”¨äº† connect() æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåœ¨è¿æ¥å»ºç«‹ä¹‹å‰è¿”å›ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨ finishConnect() æ¥åˆ¤æ–­è¿æ¥æ˜¯å¦å»ºç«‹ã€‚åƒè¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">socketChannel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">socketChannel.connect(<span class="keyword">new</span> InetSocketAddress(<span class="string">"127.0.0.1"</span>, <span class="number">80</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(! socketChannel.finishConnect() )&#123;</span><br><span class="line">    <span class="comment">//wait, or do something else...    </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="write"><a href="#write" class="headerlink" title="write()"></a>write()</h4><p>åœ¨éé˜»å¡æ¨¡å¼ä¸‹ï¼Œwrite() æ–¹æ³•å¯èƒ½åœ¨æ²¡æœ‰å†™å…¥ä»»ä½•å†…å®¹çš„æƒ…å†µä¸‹å°±è¿”å›äº†ã€‚ å› æ­¤ï¼Œæ‚¨éœ€è¦åœ¨å¾ªç¯ä¸­è°ƒç”¨write()æ–¹æ³•ã€‚</p><h4 id="read"><a href="#read" class="headerlink" title="read()"></a>read()</h4><p>åœ¨éé˜»å¡æ¨¡å¼ä¸‹ï¼Œ<code>read()</code> æ–¹æ³•å¯èƒ½åœ¨æ²¡æœ‰è¯»å–ä»»ä½•æ•°æ®çš„æƒ…å†µä¸‹å°±è¿”å›äº†ã€‚å› æ­¤ï¼Œæ‚¨éœ€è¦æ³¨æ„è¿”å›çš„intï¼Œå®ƒä¼šå‘Šè¯‰è¯»å–äº†å¤šå°‘å­—èŠ‚ã€‚</p><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>è§ <a href="https://wangwei.one/posts/2477be9a.html">å‰é¢</a> æ–‡ç« ä¸­çš„ç¤ºä¾‹ä»£ç ã€‚</p><h2 id="DatagramChannel"><a href="#DatagramChannel" class="headerlink" title="DatagramChannel"></a>DatagramChannel</h2><p>DatagramChannleæ˜¯ä¸€ä¸ªå¯ä»¥ç”¨äºå‘é€å’Œæ¥æ”¶UDPæ•°æ®åŒ…çš„é€šé“ã€‚ç”±äºUDPæ˜¯ä¸€ç§æ— è¿æ¥çš„ç½‘ç»œåè®®ï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½åƒåœ¨å…¶ä»–é€šé“ä¸­é‚£æ ·é»˜è®¤è¯»å–å’Œå†™å…¥DatagramChannelï¼Œè€Œæ˜¯å‘é€å’Œæ¥æ”¶æ•°æ®åŒ…ã€‚</p><h3 id="æ‰“å¼€DatagramChannel"><a href="#æ‰“å¼€DatagramChannel" class="headerlink" title="æ‰“å¼€DatagramChannel"></a>æ‰“å¼€DatagramChannel</h3><p>åœ¨UDPç«¯å£9999ä¸Šæ¥æ”¶æ•°æ®åŒ…ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DatagramChannel channel = DatagramChannel.open();</span><br><span class="line">channel.socket().bind(<span class="keyword">new</span> InetSocketAddress(<span class="number">9999</span>));</span><br></pre></td></tr></table></figure><h3 id="æ¥æ”¶æ•°æ®"><a href="#æ¥æ”¶æ•°æ®" class="headerlink" title="æ¥æ”¶æ•°æ®"></a>æ¥æ”¶æ•°æ®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ByteBuffer buf = ByteBuffer.allocate(<span class="number">48</span>);</span><br><span class="line">buf.clear();</span><br><span class="line"></span><br><span class="line">channel.receive(buf);</span><br></pre></td></tr></table></figure><p><code>receive()</code> æ–¹æ³•å°†ä¼šæŠŠæ”¶åˆ°çš„æ•°æ®åŒ…ä¸­çš„å†…å®¹å¤åˆ¶åˆ°Bufferä¸­ã€‚å¦‚æœæ¥æ”¶åˆ°çš„æ•°æ®æ¯”Bufferçš„å®¹é‡è¿˜å¤§ï¼Œå¤šä½™çš„æ•°æ®ä¼šé»˜è®¤ä¸¢å¼ƒæ‰ã€‚</p><h3 id="å‘é€æ•°æ®"><a href="#å‘é€æ•°æ®" class="headerlink" title="å‘é€æ•°æ®"></a>å‘é€æ•°æ®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">String newData = <span class="string">"New String to write to file..."</span> + System.currentTimeMillis();</span><br><span class="line">    </span><br><span class="line">ByteBuffer buf = ByteBuffer.allocate(<span class="number">48</span>);</span><br><span class="line">buf.clear();</span><br><span class="line">buf.put(newData.getBytes());</span><br><span class="line">buf.flip();</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> bytesSent = channel.send(buf, <span class="keyword">new</span> InetSocketAddress(<span class="string">"127.0.0.1"</span>, <span class="number">80</span>));</span><br></pre></td></tr></table></figure><p>æ­¤ç¤ºä¾‹å°†å­—ç¬¦ä¸²å‘é€åˆ°UDPç«¯å£80ä¸Šçš„â€œ127.0.0.1â€æœåŠ¡å™¨ã€‚ä½†æ˜¯æ²¡æœ‰ä»»ä½•å†…å®¹æ­£åœ¨ä¾¦å¬è¯¥ç«¯å£ï¼Œå› æ­¤ä¸ä¼šå‘ç”Ÿä»»ä½•äº‹æƒ…ã€‚ ç”±äºUDPä¸å¯¹æ•°æ®ä¼ é€åšå‡ºä»»ä½•ä¿è¯ï¼Œå› æ­¤ä¸ä¼šé€šçŸ¥ä½ æ˜¯å¦æ”¶åˆ°äº†å‘é€æ•°æ®åŒ…ã€‚</p><h3 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>æˆ‘ä»¬ç”¨ DatagramChannel æ¥å®ç°ä¸€ä¸‹ EchoServerã€‚</p><h4 id="DatagramSocketEchoServer"><a href="#DatagramSocketEchoServer" class="headerlink" title="DatagramSocketEchoServer"></a>DatagramSocketEchoServer</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.java.nio;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.SocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.DatagramChannel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatagramSocketEchoServer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            DatagramChannel server = DatagramChannel.open();</span><br><span class="line">            InetSocketAddress sAddr = <span class="keyword">new</span> InetSocketAddress(<span class="string">"127.0.0.1"</span>, <span class="number">8989</span>);</span><br><span class="line">            server.bind(sAddr);</span><br><span class="line">            ByteBuffer byteBuffer = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">"Waiting for a message from a remote host at "</span> + sAddr);</span><br><span class="line">                SocketAddress remoteAddr = server.receive(byteBuffer);</span><br><span class="line">                byteBuffer.flip();</span><br><span class="line">                <span class="keyword">int</span> limits = byteBuffer.limit();</span><br><span class="line">                <span class="keyword">byte</span>[] bytess = <span class="keyword">new</span> <span class="keyword">byte</span>[limits];</span><br><span class="line">                byteBuffer.get(bytess, <span class="number">0</span>, limits);</span><br><span class="line">                String msg = <span class="keyword">new</span> String(bytess);</span><br><span class="line"></span><br><span class="line">                System.out.println(<span class="string">"Client at "</span> + remoteAddr + <span class="string">" says: "</span> + msg);</span><br><span class="line">                byteBuffer.rewind();</span><br><span class="line">                server.send(byteBuffer, remoteAddr);</span><br><span class="line">                byteBuffer.clear();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="DatagramSocketEchoClient"><a href="#DatagramSocketEchoClient" class="headerlink" title="DatagramSocketEchoClient"></a>DatagramSocketEchoClient</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.java.nio;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.DatagramChannel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatagramSocketEchoClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            DatagramChannel client = DatagramChannel.open();</span><br><span class="line">            client.bind(<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">            String msg = <span class="string">"hello"</span>;</span><br><span class="line">            ByteBuffer buffer = ByteBuffer.wrap(msg.getBytes());</span><br><span class="line">            InetSocketAddress serverAddress = <span class="keyword">new</span> InetSocketAddress(<span class="string">"127.0.0.1"</span>, <span class="number">8989</span>);</span><br><span class="line"></span><br><span class="line">            client.send(buffer, serverAddress);</span><br><span class="line">            buffer.clear();</span><br><span class="line">            client.receive(buffer);</span><br><span class="line">            buffer.flip();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> limits = buffer.limit();</span><br><span class="line">            <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[limits];</span><br><span class="line">            buffer.get(bytes, <span class="number">0</span>, limits);</span><br><span class="line">            String response = <span class="keyword">new</span> String(bytes);</span><br><span class="line">            System.out.println(<span class="string">"Server response: "</span> + response);</span><br><span class="line">            client.close();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="http://tutorials.jenkov.com/java-nio/datagram-channel.html" target="_blank" rel="noopener">http://tutorials.jenkov.com/java-nio/datagram-channel.html</a></li><li><a href="http://tutorials.jenkov.com/java-nio/socketchannel.html" target="_blank" rel="noopener">http://tutorials.jenkov.com/java-nio/socketchannel.html</a></li><li><a href="http://tutorials.jenkov.com/java-nio/server-socket-channel.html" target="_blank" rel="noopener">http://tutorials.jenkov.com/java-nio/server-socket-channel.html</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> NIO </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Java NIO Selector]]></title>
      <url>/posts/java-nio-selector.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>Selector(é€‰æ‹©å™¨)æ˜¯ä¸€ä¸ªJava NIOç»„ä»¶ï¼Œå®ƒå¯ä»¥æ£€æŸ¥ä¸€ä¸ªæˆ–å¤šä¸ªNIOé€šé“ï¼Œå¹¶ç¡®å®šå“ªäº›é€šé“å·²ç»å‡†å¤‡å¥½äº†ç›¸åº”çš„æ“ä½œ(ä¾‹å¦‚ï¼Œè¯»å†™æ“ä½œï¼‰ã€‚ è¿™å°±æ˜¯å•ä¸ªçº¿ç¨‹å¯ä»¥ç®¡ç†å¤šä¸ªé€šé“ï¼Œä»è€Œç®¡ç†å¤šä¸ªè¿æ¥çš„åŸå› ã€‚</p><a id="more"></a><h2 id="ä¸ºä»€ä¹ˆè¦ç”¨Selector"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨Selector" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨Selector"></a>ä¸ºä»€ä¹ˆè¦ç”¨Selector</h2><p>å•ä¸ªçº¿ç¨‹èƒ½å¤Ÿå¤„ç†å¤šä¸ªé€šé“çš„ä¼˜åŠ¿åœ¨äºä½ åªéœ€è¦å°‘æ•°çš„çº¿ç¨‹å°±å¯ä»¥å¤„ç†è®¸å¤šçš„é€šé“ã€‚ å®é™…ä¸Šï¼Œä½ åªéœ€ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥å¤„ç†æ‰€æœ‰é€šé“ã€‚å¯¹äºæ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œåœ¨çº¿ç¨‹ä¹‹é—´åˆ‡æ¢æ˜¯éå¸¸æ¶ˆè€—èµ„æºçš„ï¼Œå¹¶ä¸”æ¯ä¸ªçº¿ç¨‹ä¹Ÿå ç”¨æ“ä½œç³»ç»Ÿä¸­çš„ä¸€äº›èµ„æºï¼ˆä¾‹å¦‚ï¼šå†…å­˜ï¼‰ã€‚ å› æ­¤ï¼Œä½¿ç”¨çš„çº¿ç¨‹è¶Šå°‘è¶Šå¥½ã€‚</p><p>ä½†æ˜¯æœ‰ä¸€ç‚¹è¦è®°ä½ï¼Œç°ä»£æ“ä½œç³»ç»Ÿå’Œå¤šæ ¸CPUåœ¨å¤šä»»åŠ¡å¤„ç†æ–¹é¢è¡¨ç°çš„è¶Šæ¥è¶Šå¥½äº†ï¼Œå› æ­¤éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå¤šçº¿ç¨‹çš„å¼€é”€ä¼šå˜å¾—è¶Šæ¥è¶Šå°ã€‚ å®é™…ä¸Šï¼Œå¦‚æœCPUæœ‰å¤šä¸ªå†…æ ¸ï¼Œå¦‚æœä¸ä½¿ç”¨ä»»åŠ¡å¤„ç†æœºåˆ¶ï¼Œå°±ä¼šå¯¼è‡´CPUèµ„æºçš„æµªè´¹ã€‚ä¸ç®¡æ€ä¹ˆè¯´ï¼Œæœ‰å…³ç¨‹åºè®¾è®¡çš„è®¨è®ºå±äºå¦å¤–çš„èŒƒç•´äº†ï¼Œä½†åœ¨æˆ‘ä»¬è¿™é‡Œå¯ä»¥ç¡®åˆ‡åœ°è¯´ï¼Œä½ å¯ä»¥é€šè¿‡Selectorä½¿ç”¨å•ä¸ªçº¿ç¨‹æ¥å¤„ç†å¤šä¸ªChannelsã€‚ç¤ºæ„å›¾ï¼š</p><p><img src="https://img.i7years.com/blog/selectors.png" alt="selector"></p><p>è¦ä½¿ç”¨é€‰æ‹©å™¨ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä»»ä½•ç‰¹æ®Šè®¾ç½®ã€‚ æˆ‘ä»¬éœ€è¦çš„æ‰€æœ‰ç±»éƒ½æ˜¯æ ¸å¿ƒçš„java.nioåŒ…ï¼Œæˆ‘ä»¬åªéœ€è¦å¯¼å…¥æˆ‘ä»¬éœ€è¦çš„ç±»å³å¯ã€‚</p><p>ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Selectoræ³¨å†Œå¤šä¸ªé€šé“ã€‚ å½“ä»»ä½•é€šé“ä¸Šå‘ç”ŸI / Oæ´»åŠ¨æ—¶ï¼Œé€‰æ‹©å™¨ä¼šé€šçŸ¥æˆ‘ä»¬ã€‚è¿™å°±æ˜¯æˆ‘ä»¬ä»å•ä¸ªçº¿ç¨‹ä¸­è¯»å–å¤§é‡æ•°æ®æºçš„æ–¹å¼ã€‚</p><p>æˆ‘ä»¬å‘Selectoræ³¨å†Œçš„ä»»ä½•Channelå¿…é¡»æ˜¯ <strong><em>SelectableChannel</em></strong> çš„å­ç±»ã€‚ è¿™äº›æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„é€šé“ï¼Œå¯ä»¥è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ã€‚</p><h2 id="åˆ›å»ºSelector"><a href="#åˆ›å»ºSelector" class="headerlink" title="åˆ›å»ºSelector"></a>åˆ›å»ºSelector</h2><p>ç›´æ¥è°ƒç”¨ <code>open()</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Selector selector = Selector.open();</span><br></pre></td></tr></table></figure><h2 id="Selectoræ³¨å†ŒChannel"><a href="#Selectoræ³¨å†ŒChannel" class="headerlink" title="Selectoræ³¨å†ŒChannel"></a>Selectoræ³¨å†ŒChannel</h2><p>ä¸€ä¸ªselectoræƒ³è¦ç›‘æ§å¤šä¸ªchannelï¼Œæˆ‘ä»¬å¿…é¡»å°†è¿™äº›channelsæ³¨å†Œåˆ°selectorä¸Šã€‚è°ƒç”¨ SelectableChannel ä¸€ç±»çš„ <code>register()</code> æ–¹æ³•å°±å¯ä»¥å®è¡Œæ³¨å†Œæœºåˆ¶ã€‚</p><p>åœ¨æ³¨å†Œchannelä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å¤„ç†éé˜»å¡ï¼ˆnon-blockingï¼‰æ¨¡å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">channel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">SelectionKey key = channel.register(selector, SelectionKey.OP_READ);</span><br></pre></td></tr></table></figure><p>è¿™æ„å‘³ç€æˆ‘ä»¬ä¸èƒ½å°†FileChannelä¸é€‰æ‹©å™¨ä¸€èµ·ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä»¬ä¸èƒ½åƒæˆ‘ä»¬ä½¿ç”¨å¥—æ¥å­—é€šé“é‚£æ ·åˆ‡æ¢åˆ°éé˜»å¡æ¨¡å¼ã€‚</p><p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„Selectorå¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°å®šä¹‰äº†ä¸€ä¸ªâ€interest setâ€ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬æ„Ÿå…´è¶£çš„Event(äº‹ä»¶)æ˜¯é€šè¿‡Selector(é€‰æ‹©å™¨)åœ¨è¢«ç›‘è§†çš„Channel(é€šé“)ä¸­ç›‘å¬çš„ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç›‘å¬å››ç§ä¸åŒçš„Eventï¼Œæ¯ç§Eventéƒ½ç”±<em>SelectionKey</em>ç±»ä¸­çš„å¸¸é‡è¡¨ç¤ºï¼š</p><ul><li><code>Connect</code> â€” å½“ä¸€ä¸ªå®¢æˆ·ç«¯å°è¯•å»è¿æ¥æœåŠ¡ç«¯æ—¶ã€‚å¸¸é‡å®šä¹‰ï¼š <em>SelectionKey.OP_CONNECT</em></li><li><code>Accept</code> â€” å½“æœåŠ¡ç«¯æ¥å—æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚æ—¶ã€‚å¸¸é‡å®šä¹‰ï¼š<em>SelectionKey.OP_ACCEPT</em></li><li><code>Read</code> â€” å½“æœåŠ¡ç«¯å‡†å¤‡è¯»å–channelä¸­çš„æ•°æ®æ—¶ã€‚å¸¸é‡å®šä¹‰ï¼š<em>SelectionKey.OP_READ</em></li><li><code>Write</code> â€” å½“æœåŠ¡ç«¯å‡†å¤‡å†™å…¥æ•°æ®åˆ°channelä¸­æ—¶ã€‚å¸¸é‡å®šä¹‰ï¼š<em>SelectionKey.OP_WRITE</em></li></ul><p>å¦‚æœå¯¹å¤šä¸ªEventæ„Ÿå…´è¶£æ—¶ï¼Œå¯¹è¿™äº›å¸¸é‡è¿›è¡Œ OR æ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> interestSet = SelectionKey.OP_READ | SelectionKey.OP_WRITE;</span><br></pre></td></tr></table></figure><h2 id="SelectionKeyâ€™s"><a href="#SelectionKeyâ€™s" class="headerlink" title="SelectionKeyâ€™s"></a>SelectionKeyâ€™s</h2><p>å½“æˆ‘ä»¬ä½¿ç”¨é€‰æ‹©å™¨æ³¨å†Œä¸€ä¸ªé€šé“æ—¶ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ª <strong><em>SelectionKey</em></strong> å¯¹è±¡ã€‚ è¯¥å¯¹è±¡ä¸­åŒ…å«äº†Channelæ³¨å†Œçš„ç›¸å…³æ•°æ®ã€‚</p><p>å®ƒåŒ…å«ä¸€äº›é‡è¦çš„å±æ€§ï¼Œæˆ‘ä»¬å¿…é¡»å¾ˆå¥½åœ°ç†è§£å®ƒä»¬æ‰èƒ½åœ¨Channelä¸Šä½¿ç”¨Selectorã€‚ æˆ‘ä»¬å°†åœ¨ä»¥ä¸‹å°èŠ‚ä¸­è¯¦è§£è¿™äº›å±æ€§ã€‚</p><h3 id="The-Interest-Set"><a href="#The-Interest-Set" class="headerlink" title="The Interest Set"></a>The Interest Set</h3><p>Interset Set(å…´è¶£é›†)å®šä¹‰äº†æˆ‘ä»¬å¸Œæœ›Selectoråœ¨Channelä¸Šç›‘å¬çš„äº‹ä»¶é›†ã€‚å®ƒæ˜¯ä¸€ä¸ªæ•´æ•°å€¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–æ­¤ä¿¡æ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> interestSet = selectionKey.interestOps();</span><br><span class="line"></span><br><span class="line"><span class="keyword">boolean</span> isInterestedInAccept  = interestSet &amp; SelectionKey.OP_ACCEPT;</span><br><span class="line"><span class="keyword">boolean</span> isInterestedInConnect = interestSet &amp; SelectionKey.OP_CONNECT;</span><br><span class="line"><span class="keyword">boolean</span> isInterestedInRead    = interestSet &amp; SelectionKey.OP_READ;</span><br><span class="line"><span class="keyword">boolean</span> isInterestedInWrite   = interestSet &amp; SelectionKey.OP_WRITE;</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥é€šè¿‡ <em>interestSet</em> ä¸ SelectionKey ä¸­æŸä¸ªäº‹ä»¶çš„å¸¸é‡è¿›è¡Œ AND æ“ä½œï¼Œæ¥åˆ¤æ–­æŸä¸ªEventæ˜¯å¦å¤„äºInterset Setä¸­ã€‚</p><h3 id="The-Ready-Set"><a href="#The-Ready-Set" class="headerlink" title="The Ready Set"></a>The Ready Set</h3><p>Ready Setå®šä¹‰äº†Channelå‡†å¤‡å¥½çš„ä¸€ç»„æ“ä½œã€‚ä¸»è¦æ˜¯åœ¨Selectionåè®¿é—® Ready Setã€‚Selection å°†åœ¨åé¢è§£é‡Šã€‚ ä½ å¯ä»¥åƒè¿™æ ·è®¿é—®ready setï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> readySet = selectionKey.readyOps();</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥ä½¿ç”¨ä¸Interest Setç›¸åŒçš„æ–¹å¼ï¼Œæ¥åˆ¤æ–­Channelå‡†å¤‡å¥½äº†å“ªäº›Events/Operationsã€‚ä½†æ˜¯ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢å››ç§æ–¹å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">selectionKey.isAcceptable();</span><br><span class="line">selectionKey.isConnectable();</span><br><span class="line">selectionKey.isReadable();</span><br><span class="line">selectionKey.isWritable();</span><br></pre></td></tr></table></figure><h3 id="The-Channel"><a href="#The-Channel" class="headerlink" title="The Channel"></a>The Channel</h3><p>ä»<em>SelectionKey</em> è·å–è¢«ç›‘è§†çš„Channeléå¸¸ç®€å•ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SelectableChannel channel = selectionKey.channel();</span><br></pre></td></tr></table></figure><h3 id="The-Selector"><a href="#The-Selector" class="headerlink" title="The Selector"></a>The Selector</h3><p>åŒChannelä¸€æ ·ï¼Œè·å–Selectorä¹Ÿéå¸¸ç®€å•ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Selector selector = selectionKey.selector();</span><br></pre></td></tr></table></figure><h3 id="Attaching-Objects"><a href="#Attaching-Objects" class="headerlink" title="Attaching Objects"></a>Attaching Objects</h3><p>æˆ‘ä»¬å¯ä»¥é™„åŠ ä¸€ä¸ªå¯¹è±¡åˆ°SelectionKeyä¸Šå»ã€‚æœ‰æ—¶å€™æˆ‘ä»¬æƒ³è¦ç»™Channelä¸€ä¸ªè‡ªå®šä¹‰IDæˆ–è€…é™„åŠ æˆ‘ä»¬æƒ³è¦è¿½è¸ªçš„ä»»ä½•ç±»å‹çš„Javaå¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">key.attach(Object);</span><br><span class="line"></span><br><span class="line">Object object = key.attachment();</span><br></pre></td></tr></table></figure><p>æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©åœ¨Channleæ³¨å†ŒæœŸé—´é™„åŠ å¯¹è±¡ã€‚ æˆ‘ä»¬å°†å®ƒä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°æ·»åŠ åˆ°Channelçš„ <em>register()</em> æ–¹æ³•ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SelectionKey key = channel.register(selector, SelectionKey.OP_ACCEPT, object);</span><br></pre></td></tr></table></figure><h2 id="Selecting-Channels-via-a-Selector"><a href="#Selecting-Channels-via-a-Selector" class="headerlink" title="Selecting Channels via a Selector"></a>Selecting Channels via a Selector</h2><p>ä½¿ç”¨Selectoræ³¨å†Œä¸€ä¸ªæˆ–å¤šä¸ªChannelåï¼Œä½ å¯ä»¥è°ƒç”¨ <em>Selector.select()</em> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›é‚£äº›å·²ç»ä¸ºç›‘å¬ä½ æ„Ÿå…´è¶£çš„äº‹ä»¶ï¼ˆconnectã€acceptã€readã€writeï¼‰åšå¥½å‡†å¤‡çš„Channelçš„æ•°é‡ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœä½ å¯¹ä¸ºreadingäº‹ä»¶åšå¥½å‡†å¤‡çš„Channelæ„Ÿå…´è¶£ï¼Œä½ å°†ä¼šä» <em>select()</em> æ–¹æ³•ä¸­æ”¶åˆ°ä¸ºreadingäº‹ä»¶åšå¥½å‡†å¤‡çš„channelçš„æ•°é‡ã€‚</p><p><em>select()</em> ç›¸å…³çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><ul><li><p>int select()</p><blockquote><p>è¯¥æ–¹æ³•ä¼šä¸€ç›´é˜»å¡åˆ°è‡³å°‘ä¸€ä¸ªé€šé“å‡†å¤‡å¥½è¿›è¡Œæ“ä½œã€‚ è¿”å›çš„æ•´æ•°è¡¨ç¤ºå…¶é€šé“å·²å‡†å¤‡å¥½è¿›è¡Œæ“ä½œçš„é”®çš„æ•°é‡ã€‚</p></blockquote></li><li><p>int select(long timeout)</p><blockquote><p>ä¸select()ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºå®ƒè®¾ç½®äº†æœ€å¤§çš„é˜»å¡æ—¶é—´ã€‚</p></blockquote></li><li><p>int selectNow()</p><blockquote><p>ç«‹å³è¿”å›å·²ç»å‡†å¤‡å¥½çš„channelæ•°é‡ï¼Œæ²¡æœ‰åˆ™è¿”å›0ã€‚</p></blockquote></li></ul><p><em>select()</em> è¿”å›çš„intå€¼è¡¨ç¤ºäº†å‡†å¤‡å¥½äº†çš„Channelæ•°é‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè‡ªä¸Šæ¬¡è°ƒç”¨<em>select()</em> ä»¥æ¥å·²å‡†å¤‡å¥½å¤šå°‘ä¸ªChannelã€‚å¦‚æœæ‚¨è°ƒç”¨ <em>select()</em> å¹¶ä¸”è¿”å›1ï¼Œè¡¨ç¤ºä¸€ä¸ªChannelå·²å‡†å¤‡å°±ç»ªï¼Œå¹¶ä¸”å†æ¬¡è°ƒç”¨ <em>select()</em>ï¼Œå¹¶ä¸”å¦ä¸€ä¸ªChannel å·²å‡†å¤‡å¥½ï¼Œå®ƒå°†å†æ¬¡è¿”å›1ã€‚å¦‚æœä½ æ²¡æœ‰å¯¹ç¬¬ä¸€ä¸ªå‡†å¤‡å¥½çš„Channelåšä»»ä½•æ“ä½œï¼Œé‚£ä½ ç°åœ¨æœ‰2ä¸ªå°±ç»ªçš„Channelï¼Œä½†åœ¨æ¯æ¬¡ <em>select()</em> è°ƒç”¨ä¹‹é—´åªæœ‰ä¸€ä¸ªChannnelå·²å‡†å¤‡å°±ç»ªã€‚</p><h3 id="selectedKeys"><a href="#selectedKeys" class="headerlink" title="selectedKeys()"></a>selectedKeys()</h3><p>ä¸€æ—¦è°ƒç”¨äº†å…¶ä¸­ä¸€ç§ <code>select()</code> æ–¹æ³•ï¼Œå¹¶ä¸”è¿”å›äº†intå€¼ï¼Œè¡¨ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªChannelå·²å‡†å¤‡å°±ç»ªã€‚ä½ å¯ä»¥é€šè¿‡â€selected key setâ€æ¥è®¿é—®åˆ°è¿™äº›å·²ç»å‡†å¤‡å°±ç»ªçš„Channelã€‚è€Œâ€selected key setâ€å¯ä»¥é€šè¿‡è°ƒç”¨ <code>selector.selectedKeys()</code> æ–¹æ³•è·å¾—ã€‚å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;SelectionKey&gt; selectedKeys = selector.selectedKeys();</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥é€šè¿‡è¿­ä»£çš„æ–¹å¼è·å–å·²ç»å‡†å¤‡å¥½çš„Channelï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;SelectionKey&gt; selectedKeys = selector.selectedKeys();</span><br><span class="line"></span><br><span class="line">Iterator&lt;SelectionKey&gt; keyIterator = selectedKeys.iterator();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(keyIterator.hasNext()) &#123;</span><br><span class="line">    </span><br><span class="line">    SelectionKey key = keyIterator.next();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(key.isAcceptable()) &#123;</span><br><span class="line">        <span class="comment">// a connection was accepted by a ServerSocketChannel.</span></span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isConnectable()) &#123;</span><br><span class="line">        <span class="comment">// a connection was established with a remote server.</span></span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isReadable()) &#123;</span><br><span class="line">        <span class="comment">// a channel is ready for reading</span></span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isWritable()) &#123;</span><br><span class="line">        <span class="comment">// a channel is ready for writing</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    keyIterator.remove();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°æ¯æ¬¡è¿­ä»£åé¢çš„ä¸€ä¸ªæ–¹æ³•ï¼š<code>keyIterator.remove();</code>ã€‚Selector å¹¶ä¸ä¼šä» SelectionKey Set ä¸­ä¸»åŠ¨åˆ é™¤ SelectionKey å®ä¾‹ã€‚å½“æˆ‘ä»¬å¤„ç†å®ŒChannelä¹‹åï¼Œæˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨å°†å…¶åˆ é™¤ã€‚ç­‰åˆ°Channelå†ä¸€æ¬¡å‡†å¤‡å°±ç»ªæ—¶ï¼ŒSelectoråˆä¼šå°†å…¶æ·»åŠ è¿› SelectionKey Set ä¸­å»ã€‚</p><p><code>SelectionKey.channel()</code> æ–¹æ³•è¿”å›çš„Channelå¯¹è±¡éœ€è¦è¿›è¡Œå¼ºåˆ¶è½¬æ¢ä¸ºä½ éœ€è¦çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼š<strong><em>ServerSocketChannel</em></strong>ã€<strong><em>SocketChannel</em></strong>ç­‰ç­‰ã€‚</p><h3 id="Close"><a href="#Close" class="headerlink" title="Close()"></a>Close()</h3><p>å½“ä½ ç”¨å®Œselectorä¹‹åï¼Œéœ€è¦è°ƒç”¨ <code>selector.close();</code> å°†ä¼šè¯¥selectorå¹¶è®©æ‰€æœ‰æ³¨å†Œçš„SelectionKeyå˜å¾—æ— æ•ˆã€‚</p><p>ä¸è¿‡ï¼ŒChannelå¹¶ä¸ä¼šå…³é—­ã€‚</p><h2 id="å®Œæ•´ç¤ºä¾‹"><a href="#å®Œæ•´ç¤ºä¾‹" class="headerlink" title="å®Œæ•´ç¤ºä¾‹"></a>å®Œæ•´ç¤ºä¾‹</h2><p>æˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªEchoæœåŠ¡ã€‚</p><h3 id="EchoServer"><a href="#EchoServer" class="headerlink" title="EchoServer"></a>EchoServer</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.java.nio;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SelectionKey;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.Selector;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.ServerSocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EchoServer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        ServerSocketChannel serverSocket = ServerSocketChannel.open();</span><br><span class="line">        serverSocket.bind(<span class="keyword">new</span> InetSocketAddress(<span class="string">"127.0.0.1"</span>, <span class="number">8900</span>));</span><br><span class="line">        serverSocket.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">        Selector selector = Selector.open();</span><br><span class="line">        serverSocket.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line"></span><br><span class="line">        ByteBuffer byteBuffer = ByteBuffer.allocate(<span class="number">256</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            selector.select();</span><br><span class="line">            Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys();</span><br><span class="line">            Iterator&lt;SelectionKey&gt; iterator = selectionKeys.iterator();</span><br><span class="line">            <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                SelectionKey selectionKey = iterator.next();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (selectionKey.isAcceptable()) &#123;</span><br><span class="line">                    register(selector, serverSocket);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (selectionKey.isReadable()) &#123;</span><br><span class="line">                    answerWithEcho(byteBuffer, selectionKey);</span><br><span class="line">                &#125;</span><br><span class="line">                iterator.remove();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(Selector selector, ServerSocketChannel socketChannel)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        SocketChannel client = socketChannel.accept();</span><br><span class="line">        client.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">        client.register(selector, SelectionKey.OP_READ);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">answerWithEcho</span><span class="params">(ByteBuffer buffer, SelectionKey key)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        SocketChannel client = (SocketChannel) key.channel();</span><br><span class="line">        client.read(buffer);</span><br><span class="line">        buffer.flip();</span><br><span class="line">        client.write(buffer);</span><br><span class="line">        buffer.clear();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Process <span class="title">start</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String javaHome = System.getProperty(<span class="string">"java.home"</span>);</span><br><span class="line">        String javaBin = javaHome + File.separator + <span class="string">"bin"</span> + File.separator + <span class="string">"java"</span>;</span><br><span class="line">        String classpath = System.getProperty(<span class="string">"java.class.path"</span>);</span><br><span class="line">        String className = EchoServer.class.getCanonicalName();</span><br><span class="line">        ProcessBuilder processBuilder = <span class="keyword">new</span> ProcessBuilder(javaBin, <span class="string">"-cp"</span>, classpath, className);</span><br><span class="line">        <span class="keyword">return</span> processBuilder.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="EchoClient"><a href="#EchoClient" class="headerlink" title="EchoClient"></a>EchoClient</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> one.wangwei.java.nio;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EchoClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SocketChannel client;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ByteBuffer buffer;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> EchoClient instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">EchoClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            client = SocketChannel.open(<span class="keyword">new</span> InetSocketAddress(<span class="string">"127.0.0.1"</span>, <span class="number">8900</span>));</span><br><span class="line">            buffer = ByteBuffer.allocate(<span class="number">256</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> EchoClient <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> EchoClient();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        buffer = <span class="keyword">null</span>;</span><br><span class="line">        client.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sendMessage</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        buffer = ByteBuffer.wrap(msg.getBytes());</span><br><span class="line">        String response = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            client.write(buffer);</span><br><span class="line">            buffer.clear();</span><br><span class="line">            client.read(buffer);</span><br><span class="line">            response = <span class="keyword">new</span> String(buffer.array()).trim();</span><br><span class="line">            System.out.println(<span class="string">"response="</span> + response);</span><br><span class="line">            buffer.clear();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        EchoClient client = EchoClient.start();</span><br><span class="line">        System.out.println(<span class="string">"Enter your message:"</span>);</span><br><span class="line">        Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        client.sendMessage(scanner.nextLine());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="http://tutorials.jenkov.com/java-nio/selectors.html" target="_blank" rel="noopener">http://tutorials.jenkov.com/java-nio/selectors.html</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> NIO </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Java NIO Buffer]]></title>
      <url>/posts/java-nio-buffer.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>Java NIO Bufferï¼ˆç¼“å†²åŒºï¼‰é€šå¸¸ä¸NIO Channelsï¼ˆé€šé“ï¼‰ä¸€èµ·ä½¿ç”¨ã€‚å¦‚æˆ‘ä»¬ <a href="https://wangwei.one/posts/d7aa1132.html">å‰é¢</a> æ‰€æåˆ°çš„é‚£æ ·ï¼Œæ•°æ®ä»channelä¸­è¯»å–åˆ°bufferä¸­ï¼Œä¹Ÿå¯ä»¥ä»bufferå†™å…¥åˆ°channel ä¸­ã€‚</p><p>Buffer æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¯ä»¥å†™å…¥æ•°æ®çš„å†…å­˜å—ï¼Œå¹¶ä¸”ä¹‹åä½ åˆå¯ä»¥ä»ä¸­å†æ¬¡è¯»å–æ•°æ®ã€‚ æ­¤å†…å­˜å—åŒ…å«åœ¨NIO Bufferå¯¹è±¡ä¸­ï¼Œè¯¥å¯¹è±¡æä¾›äº†ä¸€ç»„æ–¹æ³•ï¼Œå¯ä»¥æ›´è½»æ¾åœ°ä½¿ç”¨å†…å­˜å—ã€‚</p><a id="more"></a><h2 id="BufferåŸºæœ¬ç”¨æ³•"><a href="#BufferåŸºæœ¬ç”¨æ³•" class="headerlink" title="BufferåŸºæœ¬ç”¨æ³•"></a>BufferåŸºæœ¬ç”¨æ³•</h2><p>ä½¿ç”¨Bufferå»è¯»å–å’Œå†™å…¥æ•°æ®æ—¶ï¼Œé€šå¸¸è¦éµå¾ªä»¥ä¸‹4ä¸ªæ­¥éª¤ï¼š</p><ol><li>å†™å…¥æ•°æ®åˆ°Bufferä¸­</li><li>è°ƒç”¨ <code>buffer.flip()</code></li><li>ä»Bufferä¸­è¯»å–æ•°æ®</li><li>è°ƒç”¨ <code>buffer.clear()</code> æˆ– <code>buffer.compact()</code> æ–¹æ³•</li></ol><p>å°†æ•°æ®å†™å…¥ç¼“å†²åŒºæ—¶ï¼Œç¼“å†²åŒºä¼šè·Ÿè¸ªä½ å†™å…¥çš„æ•°æ®é‡ã€‚ä¸€æ—¦ä½ éœ€è¦ä»ä¸­è¯»å–æ•°æ®æ—¶ï¼Œä½ éœ€è¦è°ƒç”¨ <code>flip()</code> æ–¹æ³•ï¼Œå°†ç¼“å†²åŒºä»å†™å…¥æ¨¡å¼åˆ‡æ¢æˆè¯»å–æ¨¡å¼ã€‚åœ¨è¯»å–æ¨¡å¼ä¸‹ï¼Œä½ å¯ä»¥è¯»å–åˆ°æ‰€æœ‰å†™å…¥åˆ°ç¼“å†²åŒºçš„æ•°æ®ã€‚</p><p>ä¸€æ—¦ä½ è¯»å–åˆ°äº†æ‰€æœ‰çš„æ•°æ®ï¼Œä½ éœ€è¦å¯¹ç¼“å†²åŒºåšä¸€æ¬¡æ¸…ç†ï¼ˆclearï¼‰ï¼Œè®©å…¶ä¸ºä¸‹ä¸€æ¬¡å†™å…¥æ•°æ®åšå¥½å‡†å¤‡ã€‚ä½ å¯ä»¥é‡‡ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼šä¸€æ˜¯è°ƒç”¨ <code>clear()</code> æ–¹æ³•ï¼ŒäºŒæ˜¯è°ƒç”¨ <code>compact()</code> æ–¹æ³•ã€‚<code>clear()</code> æ–¹æ³•æ˜¯å¯¹æ•´ä¸ªç¼“å†²åŒºåšæ¸…ç†ã€‚<code>compcat()</code> æ–¹æ³•åªæ˜¯æ¸…ç†æ‰ä½ å·²ç»è¯»å–è¿‡çš„æ•°æ®ï¼Œä»»ä½•æœªè¯»å–è¿‡çš„æ•°æ®ä¼šè¢«ç§»åŠ¨åˆ°ç¼“å†²åŒºçš„èµ·å§‹ä½ç½®ï¼Œæ–°å†™å…¥è¿›æ¥çš„æ•°æ®å°†ä¼šæ”¾åˆ°è¿™äº›æœªè¯»å–çš„æ•°æ®åé¢ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">RandomAccessFile fromFile = <span class="keyword">new</span> RandomAccessFile(<span class="string">"/Users/wangwei/Desktop/fromFile.txt"</span>, <span class="string">"rw"</span>);</span><br><span class="line">FileChannel fromChannel = fromFile.getChannel();</span><br><span class="line"></span><br><span class="line"><span class="comment">// create buffer with capacity of 48 bytes</span></span><br><span class="line">ByteBuffer buf = ByteBuffer.allocate(<span class="number">48</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// read data from channel into buffer</span></span><br><span class="line"><span class="keyword">int</span> bytesRead = fromChannel.read(buf);</span><br><span class="line"><span class="keyword">while</span> (bytesRead != -<span class="number">1</span>) &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// switch to read mode</span></span><br><span class="line">	buf.flip();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (buf.hasRemaining()) &#123;</span><br><span class="line">    	System.out.println((<span class="keyword">char</span>) buf.get());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// make buffer ready for writing</span></span><br><span class="line">	buf.clear();</span><br><span class="line">	bytesRead = fromChannel.read(buf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fromChannel.close();</span><br><span class="line">fromFile.close();</span><br></pre></td></tr></table></figure><h2 id="Bufferå®¹é‡ã€ä½ç½®ä¸é™åˆ¶"><a href="#Bufferå®¹é‡ã€ä½ç½®ä¸é™åˆ¶" class="headerlink" title="Bufferå®¹é‡ã€ä½ç½®ä¸é™åˆ¶"></a>Bufferå®¹é‡ã€ä½ç½®ä¸é™åˆ¶</h2><p>Buffer æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¯ä»¥å†™å…¥æ•°æ®çš„å†…å­˜å—ï¼Œå¹¶ä¸”ä¹‹åä½ åˆå¯ä»¥ä»ä¸­å†æ¬¡è¯»å–æ•°æ®ã€‚ æ­¤å†…å­˜å—åŒ…å«åœ¨NIO Bufferå¯¹è±¡ä¸­ï¼Œè¯¥å¯¹è±¡æä¾›äº†ä¸€ç»„æ–¹æ³•ï¼Œå¯ä»¥æ›´è½»æ¾åœ°ä½¿ç”¨å†…å­˜å—ã€‚</p><p>ä¸ºäº†ç†è§£Bufferçš„å·¥ä½œåŸç†ï¼Œä½ éœ€è¦å»ç†Ÿæ‚‰Bufferçš„ä¸‰ä¸ªå±æ€§ï¼š</p><ul><li>capacityï¼ˆå®¹é‡ï¼‰</li><li>positionï¼ˆä½ç½®ï¼‰</li><li>limitï¼ˆé™åˆ¶ï¼‰</li></ul><p>positionä¸limitçš„å…·ä½“å«ä¹‰å–å†³äºBufferå¤„äºå“ªç§æ¨¡å¼ï¼Œè€Œcapacityåˆ™ä¸Bufferçš„æ¨¡å¼æ— å…³ã€‚ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://img.i7years.com/blog/JavaNIOBuffer.png" alt="JavaNIOBuffer"></p><h3 id="Capacity"><a href="#Capacity" class="headerlink" title="Capacity"></a>Capacity</h3><p>ä½œä¸ºä¸€ä¸ªå†…å­˜å—ï¼Œç¼“å†²åŒºå…·æœ‰ä¸€å®šçš„å›ºå®šå¤§å°ï¼Œä¹Ÿç§°ä¸ºâ€œå®¹é‡â€ã€‚ ä½ æœ€å¤šåªèƒ½å†™å…¥å®¹é‡å¤§å°çš„å­—èŠ‚(bytes)ã€é•¿æ•´å‹(longs)ã€å­—ç¬¦(chars)ç­‰æ•°æ®ã€‚ä¸€æ—¦ç¼“å†²åŒºæ»¡äº†ï¼Œä½ éœ€è¦æ¸…ç©ºå®ƒï¼Œæ‰èƒ½ç»§ç»­å†™å…¥æ•°æ®ã€‚</p><h3 id="Position"><a href="#Position" class="headerlink" title="Position"></a>Position</h3><p>å½“ä½ å†™å…¥æ•°æ®æ—¶ï¼Œä½ éœ€è¦åœ¨æŸä¸ªpositionå¤„æ‰èƒ½æ‰§è¡Œæ­¤æ“ä½œã€‚åˆå§‹ä½ç½®ä¸º0ï¼Œå½“ä¸€ä¸ªå­—èŠ‚ã€é•¿æ•´æ•°ç­‰å·²å†™å…¥ç¼“å†²åŒºæ—¶ï¼Œpositionè¢«æå‰æŒ‡å‘ç¼“å†²åŒºä¸­çš„ä¸‹ä¸€ä¸ªå•å…ƒä»¥å¤‡æ’å…¥æ–°çš„æ•°æ®ã€‚ Positionçš„æœ€å¤§å€¼ä¸º capacity - 1.</p><p>å½“ä½ ä»ç¼“å†²åŒºè¯»å–æ•°æ®æ—¶ï¼Œä¹Ÿéœ€è¦ä»ç»™å®šä½ç½®å¼€å§‹è¯»å–æ•°æ®ã€‚å½“ä½ å°†ç¼“å†²åŒºä»å†™å…¥æ¨¡å¼åˆ‡æ¢åˆ°è¯»å–æ¨¡å¼æ—¶ï¼Œpositionå°†é‡ç½®ä¸º0ã€‚å½“ä½ ä»ç¼“å†²åŒºè¯»å–æ•°æ®æ—¶ï¼Œå°†ä»positionæ‰€æŒ‡å®šçš„ä½ç½®å¼€å§‹è¯»å–æ•°æ®ï¼Œå¹¶å°†positionæå‰è®¾ç½®åˆ°ä¸‹ä¸€ä¸ªè¦è¯»å–çš„ä½ç½®ã€‚</p><h3 id="Limit"><a href="#Limit" class="headerlink" title="Limit"></a>Limit</h3><p>åœ¨å†™å…¥æ¨¡å¼ä¸‹ï¼ŒBufferçš„é™åˆ¶æ˜¯ä½ å¯ä»¥å†™å…¥ç¼“å†²åŒºçš„æ•°æ®é‡çš„é™åˆ¶ï¼Œlimitå°±ç­‰äºcapacityã€‚</p><p>å°†bufferåˆ‡æ¢ä¸ºè¯»å–æ¨¡å¼æ—¶ï¼Œlimitå°±å˜æˆäº†ä½ å¯ä»¥ä»ä¸­è¯»å–åˆ°çš„æœ€å¤§æ•°æ®é‡ã€‚ å› æ­¤ï¼Œå½“Bufferåˆ‡æ¢ä¸ºè¯»å–æ¨¡å¼æ—¶ï¼Œlimitè¢«è®¾ç½®ä¸ºå†™å…¥æ¨¡å¼çš„å†™å…¥ä½ç½®ã€‚ æ¢å¥è¯è¯´ï¼Œå°±æ˜¯ä½ å¯ä»¥è¯»å–åˆ°çš„å†™å…¥å­—èŠ‚æ•°ã€‚</p><h2 id="Bufferç±»å‹"><a href="#Bufferç±»å‹" class="headerlink" title="Bufferç±»å‹"></a>Bufferç±»å‹</h2><p>Java NIOæœ‰ä»¥ä¸‹å‡ ç§Bufferç±»å‹ï¼š</p><p><img src="https://img.i7years.com/blog/IO_NioBuffer.png" alt="IO_NioBuffer"></p><p>å¦‚ä½ æ‰€è§ï¼Œè¿™äº›Bufferç±»å‹åˆ†åˆ«ä»£è¡¨äº†ä¸åŒçš„æ•°æ®ç±»å‹ã€‚ æ¢å¥è¯è¯´ï¼Œå®ƒä»¬å…è®¸ä½ ä½¿ç”¨charï¼Œshortï¼Œintï¼Œlongï¼Œfloatæˆ–doubleæ¥å¤„ç†ç¼“å†²åŒºä¸­çš„å­—èŠ‚ã€‚</p><p>MappedByteBufferæœ‰ç‚¹ç‰¹æ®Šï¼Œä»¥åå•ç‹¬ä»‹ç»ã€‚</p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><h3 id="Allocating-a-Buffer"><a href="#Allocating-a-Buffer" class="headerlink" title="Allocating a Buffer"></a>Allocating a Buffer</h3><p>ç›´æ¥è°ƒé€š <code>Buffer.allocate()</code> å°±å¯ä»¥è·å–ä¸€ä¸ªBufferå¯¹è±¡ï¼Œç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 48 bytes</span></span><br><span class="line">ByteBuffer buffer = ByteBuffer.allocate(<span class="number">48</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1024 characters</span></span><br><span class="line">CharBuffer charBuffer = CharBuffer.allocate(<span class="number">1024</span>);</span><br></pre></td></tr></table></figure><h3 id="å†™å…¥æ•°æ®"><a href="#å†™å…¥æ•°æ®" class="headerlink" title="å†™å…¥æ•°æ®"></a>å†™å…¥æ•°æ®</h3><p>Bufferæœ‰ä¸¤ç§å†™å…¥æ•°æ®çš„æ–¹å¼ï¼š</p><ol><li><p>ä»Channelå†™å…¥åˆ°Buffer</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> bytesRead = inChannel.read(buf); <span class="comment">//read into buffer.</span></span><br></pre></td></tr></table></figure></li><li><p>ç›´æ¥è°ƒç”¨ buffer.put() æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buf.put(<span class="number">127</span>);</span><br></pre></td></tr></table></figure><blockquote><p>æœ‰å…³put()çš„æ›´å¤šç”¨æ³•ï¼Œå…·ä½“å‚è§JavaDocæ–‡æ¡£.</p></blockquote></li></ol><h3 id="flip"><a href="#flip" class="headerlink" title="flip()"></a>flip()</h3><p>å‰é¢è¯´è¿‡ï¼Œflip()ç”¨äºåˆ‡æ¢Bufferçš„è¿è¡Œæ¨¡å¼ï¼Œå¹¶ç›¸åº”åœ°æ”¹å˜positionä¸limitçš„å€¼ã€‚</p><p><img src="https://img.i7years.com/blog/buffer_lifecycle.png" alt="buffer_lifecycle"></p><h3 id="è¯»å–æ•°æ®"><a href="#è¯»å–æ•°æ®" class="headerlink" title="è¯»å–æ•°æ®"></a>è¯»å–æ•°æ®</h3><p>Bufferæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥è¯»å–æ•°æ®ï¼š</p><ol><li><p>ä»Bufferè¯»å–æ•°æ®åˆ°Channelä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//read from buffer into channel.</span></span><br><span class="line"><span class="keyword">int</span> bytesWritten = inChannel.write(buf);</span><br></pre></td></tr></table></figure></li><li><p>ç›´æ¥è°ƒç”¨get()æ–¹æ³•è·å–æ•°æ®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">byte</span> aByte = buf.get();</span><br></pre></td></tr></table></figure><blockquote><p>æœ‰å…³get()çš„æ›´å¤šç”¨æ³•ï¼Œå…·ä½“å‚è§JavaDocæ–‡æ¡£.</p></blockquote></li></ol><h3 id="rewind"><a href="#rewind" class="headerlink" title="rewind()"></a>rewind()</h3><p>Buffer.rewind()æ–¹æ³•ä¼šå°† position é‡ç½®ä¸º0ï¼Œè¿™æ ·å°±å¯ä»¥é‡æ–°è¯»å–æ‰€æœ‰çš„æ•°æ®ã€‚ä½†limitçš„å€¼ä¸å—å½±å“ï¼Œå› æ­¤è¿™å°±å¯¼è‡´ä¼šè¯»å–å‡ºå¾ˆå¤šç©ºçš„å…ƒç´ æ•°æ®ã€‚</p><h3 id="clear-å’Œ-compcat"><a href="#clear-å’Œ-compcat" class="headerlink" title="clear() å’Œ compcat()"></a>clear() å’Œ compcat()</h3><p>å®Œæˆä»ç¼“å†²åŒºè¯»å–æ•°æ®åï¼Œå¿…é¡»ä½¿ç¼“å†²åŒºå‡†å¤‡å¥½å†æ¬¡å†™å…¥ã€‚ ä½ å¯ä»¥é€šè¿‡è°ƒç”¨<code>clear()</code>æˆ–è°ƒç”¨<code>compact()</code>æ¥å®Œæˆæ­¤æ“ä½œã€‚</p><p>å¦‚æœä½ è°ƒç”¨ <code>clear()</code> æ–¹æ³•ï¼Œpositionä¼šè®¾ç½®ä¸º0ï¼Œlimitä¼šè®¾ç½®ä¸ºcapacity ï¼Œä½†æ˜¯Bufferä¸­çš„æ•°æ®å¹¶æ²¡è¢«çœŸæ­£åˆ é™¤æ‰ã€‚åªæœ‰æ ‡è®°å‘Šè¯‰ä½ å¯ä»¥å°†æ•°æ®å†™å…¥ç¼“å†²åŒºçš„ä½ç½®ã€‚</p><p>å¦‚æœåœ¨è°ƒç”¨ <code>clear()</code> æ—¶ç¼“å†²åŒºä¸­æœ‰ä»»ä½•æœªè¯»æ•°æ®ï¼Œæ•°æ®å°†è¢«â€œé—å¿˜â€ï¼Œè¿™æ„å‘³ç€ä½ ä¸å†æœ‰ä»»ä½•æ ‡è®°å‘Šè¯‰è¯»å–äº†å“ªäº›æ•°æ®ï¼Œä»¥åŠæœªè¯»å–çš„æ•°æ®ã€‚</p><p>å¦‚æœç¼“å†²åŒºä¸­ä»æœ‰æœªè¯»æ•°æ®ï¼Œå¹¶ä¸”ä½ æƒ³ç¨åè¯»å–å®ƒï¼Œä½†ä½ éœ€è¦å…ˆè¿›è¡Œä¸€äº›å†™å…¥ï¼Œè¯·è°ƒç”¨ <code>compact()</code> è€Œä¸æ˜¯<code>clear()</code>ã€‚</p><p><code>compact()</code> å°†æ‰€æœ‰æœªè¯»æ•°æ®å¤åˆ¶åˆ°Bufferçš„å¼€å¤´ã€‚ç„¶åå®ƒå°†ä½ç½®è®¾ç½®åœ¨æœ€åä¸€ä¸ªæœªè¯»å…ƒç´ ä¹‹åã€‚ limitå±æ€§ä»è®¾ç½®ä¸ºcapacityï¼Œå°±åƒ <code>clear()</code> ä¸€æ ·ã€‚ç°åœ¨ç¼“å†²åŒºå·²å‡†å¤‡å¥½å†™å…¥ï¼Œä½†ä½ ä¸ä¼šè¦†ç›–æœªè¯»æ•°æ®ã€‚</p><h3 id="mark-å’Œ-reset"><a href="#mark-å’Œ-reset" class="headerlink" title="mark() å’Œ reset()"></a>mark() å’Œ reset()</h3><p>ä½ å¯ä»¥é€šè¿‡è°ƒç”¨ <code>Buffer.mark()</code> æ–¹æ³•åœ¨Bufferä¸­æ ‡è®°ç»™å®šä½ç½®ã€‚ ç„¶åï¼Œä½ å¯ä»¥é€šè¿‡è°ƒç”¨ <code>Buffer.reset()</code> æ–¹æ³•å°†ä½ç½®é‡ç½®å›æ ‡è®°ä½ç½®ã€‚ ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½® mark å€¼ç­‰äº position</span></span><br><span class="line">buffer.mark();</span><br><span class="line"></span><br><span class="line"><span class="comment">//call buffer.get() a couple of times, e.g. during parsing.</span></span><br><span class="line"><span class="comment">//set position back to mark.   </span></span><br><span class="line">buffer.reset();</span><br></pre></td></tr></table></figure><h3 id="equals-å’Œ-comareTo"><a href="#equals-å’Œ-comareTo" class="headerlink" title="equals() å’Œ comareTo()"></a>equals() å’Œ comareTo()</h3><p>å¯ä»¥ä½¿ç”¨ <code>equals()</code> å’Œ <code>compareTo()</code> è¿™ä¸¤ä¸ªæ–¹æ³•æ¥æ¯”è¾ƒä¸¤ä¸ªç¼“å†²åŒºã€‚</p><h4 id="equals"><a href="#equals" class="headerlink" title="equals()"></a>equals()</h4><p>ä¸¤ä¸ªBufferå¦‚æœæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼Œåˆ™è¡¨ç¤ºç›¸ç­‰ï¼š</p><ul><li>ç±»å‹ä¸€è‡´</li><li>å‰©ä½™çš„å­—èŠ‚ã€å­—ç¬¦ç­‰æ•°é‡ç›¸åŒ</li><li>å‰©ä½™çš„å­—èŠ‚ã€å­—ç¬¦å†…å®¹éƒ½ç›¸åŒ</li></ul><p>å¦‚ä½ æ‰€è§ï¼Œequalsä»…æ¯”è¾ƒç¼“å†²åŒºçš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯å®ƒå†…éƒ¨çš„æ¯ä¸ªå…ƒç´ ã€‚ å®é™…ä¸Šï¼Œå®ƒåªæ˜¯æ¯”è¾ƒç¼“å†²åŒºä¸­çš„å‰©ä½™å…ƒç´ ã€‚</p><h4 id="compareTo"><a href="#compareTo" class="headerlink" title="compareTo()"></a>compareTo()</h4><p><code>compareTo()</code> æ–¹æ³•æ¯”è¾ƒä¸¤ä¸ªç¼“å†²åŒºçš„å‰©ä½™å…ƒç´ ï¼ˆå­—èŠ‚ï¼Œå­—ç¬¦ç­‰ï¼‰çš„å¤§å°ã€‚ åœ¨ä¸‹åˆ—æƒ…å†µä¸‹ï¼Œç¼“å†²åŒºè¢«è§†ä¸ºâ€œå°äºâ€å¦ä¸€ä¸ªç¼“å†²åŒºï¼š</p><ul><li>ä¸å¦ä¸€ä¸ªç¼“å†²åŒºä¸­çš„å¯¹åº”å…ƒç´ ç›¸ç­‰çš„ç¬¬ä¸€ä¸ªå…ƒç´ å°äºå¦ä¸€ä¸ªç¼“å†²åŒºä¸­çš„å…ƒç´ ã€‚</li><li>æ‰€æœ‰å…ƒç´ éƒ½ç›¸ç­‰ï¼Œä½†ç¬¬ä¸€ä¸ªç¼“å†²åŒºåœ¨ç¬¬äºŒä¸ªç¼“å†²åŒºä¹‹å‰è€—å°½äº†å…ƒç´ ï¼ˆå®ƒåªæœ‰æ›´å°‘çš„å…ƒç´ ï¼‰ã€‚</li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="http://tutorials.jenkov.com/java-nio/buffers.html" target="_blank" rel="noopener">http://tutorials.jenkov.com/java-nio/buffers.html</a></li><li><a href="http://actimem.com/java/nio/buffer/" target="_blank" rel="noopener">http://actimem.com/java/nio/buffer/</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> NIO </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[å¼€å‘ç¯å¢ƒæ­å»ºæ¸…å•]]></title>
      <url>/posts/dev-env-config-list-guide.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ï¼</p><a id="more"></a><p>å›½å¤–æœ‰ä½ <a href="https://github.com/sb2nov" target="_blank" rel="noopener">å·¥ç¨‹å¸ˆ</a> åœ¨Githubä¸Šæ•´ç†äº†ä¸€ä»½Macä¸Šå„ç§å·¥å…·çš„å®‰è£…æŒ‡å—ï¼Œå¾ˆæ˜¯ä¸é”™ï¼Œå¼ºçƒˆæ¨èï¼š</p><blockquote><p><a href="https://github.com/sb2nov/mac-setup" target="_blank" rel="noopener">https://github.com/sb2nov/mac-setup</a></p></blockquote><p>æˆ‘forkäº†ä¸€ä¸ªè‡ªå·±ä»“åº“ï¼Œæ·»åŠ äº†ä¸€äº›å…¶å®ƒå·¥å…·çš„å®‰è£…æŒ‡å—ï¼š</p><blockquote><p><a href="https://github.com/wangweiX/mac-setup" target="_blank" rel="noopener">https://github.com/wangweiX/mac-setup</a></p></blockquote><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><ul><li>macOS High Sierra</li><li>version 10.13.6</li></ul><h2 id="é€‚ç”¨äººç¾¤"><a href="#é€‚ç”¨äººç¾¤" class="headerlink" title="é€‚ç”¨äººç¾¤"></a>é€‚ç”¨äººç¾¤</h2><ul><li>ç¨‹åºå‘˜</li></ul><h2 id="VPNé…ç½®"><a href="#VPNé…ç½®" class="headerlink" title="VPNé…ç½®"></a>VPNé…ç½®</h2><blockquote><p>ç¿»å¢™ï¼Œæ˜¯æ¯ä¸€ä½æœ‰è¿½æ±‚çš„ç¨‹åºå‘˜çš„å¿…å¤‡æŠ€èƒ½</p></blockquote><p>æŒ‡å—ï¼š<a href="https://wangwei.one/posts/build-your-own-vpn-by-shadowsocks-or-rixcloud.html">https://wangwei.one/posts/build-your-own-vpn-by-shadowsocks-or-rixcloud.html</a></p><h2 id="å¼€å‘ç¯å¢ƒ"><a href="#å¼€å‘ç¯å¢ƒ" class="headerlink" title="å¼€å‘ç¯å¢ƒ"></a>å¼€å‘ç¯å¢ƒ</h2><h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><blockquote><p>æŒ‡å—ï¼š<a href="https://github.com/wangweiX/mac-setup/tree/master/Java" target="_blank" rel="noopener">https://github.com/wangweiX/mac-setup/tree/master/Java</a></p></blockquote><h3 id="Scala"><a href="#Scala" class="headerlink" title="Scala"></a>Scala</h3><blockquote><p>æŒ‡å—ï¼š<a href="https://github.com/wangweiX/mac-setup/tree/master/Scala" target="_blank" rel="noopener">https://github.com/wangweiX/mac-setup/tree/master/Scala</a></p></blockquote><h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><blockquote><p>æŒ‡å—ï¼š<a href="https://github.com/wangweiX/mac-setup/tree/master/Python" target="_blank" rel="noopener">https://github.com/wangweiX/mac-setup/tree/master/Python</a></p></blockquote><h3 id="Go"><a href="#Go" class="headerlink" title="Go"></a>Go</h3><blockquote><p>æŒ‡å—ï¼š<a href="https://github.com/wangweiX/mac-setup/tree/master/Go" target="_blank" rel="noopener">https://github.com/wangweiX/mac-setup/tree/master/Go</a></p></blockquote><h3 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h3><blockquote><p>æŒ‡å—ï¼š<a href="https://github.com/wangweiX/mac-setup/tree/master/Node.js" target="_blank" rel="noopener">https://github.com/wangweiX/mac-setup/tree/master/Node.js</a></p></blockquote><h3 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h3><blockquote><ol><li>æŒ‡å—ï¼š<a href="https://github.com/wangweiX/mac-setup/tree/master/Git" target="_blank" rel="noopener">https://github.com/wangweiX/mac-setup/tree/master/Git</a></li><li>Gitå®¢æˆ·ç«¯ä¸‹è½½ï¼š<a href="https://www.sourcetreeapp.com/" target="_blank" rel="noopener">https://www.sourcetreeapp.com/</a></li><li>Gitå‘½ä»¤å­¦ä¹ <ul><li><a href="http://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html</a></li><li><a href="http://rogerdudler.github.io/git-guide/index.zh.html" target="_blank" rel="noopener">http://rogerdudler.github.io/git-guide/index.zh.html</a></li></ul></li></ol></blockquote><h3 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h3><h5 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install maven</span><br></pre></td></tr></table></figure><h5 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h5><ul><li><p><code>settings.xml</code> è·¯åŠ²ï¼š<code>/usr/local/Cellar/maven/3.5.4/libexec/conf</code></p></li><li><p>ä¿®æ”¹ <code>settings.xml</code> é…ç½®</p><blockquote><ul><li>é»˜è®¤çš„é…ç½®ä¸‹è½½jaråŒ…æ—¶ï¼Œæ˜¯ä» <a href="http://search.maven.org/" target="_blank" rel="noopener">å›½å¤–ä¸­å¤®åº“</a>ä¸‹è½½çš„ï¼Œé€Ÿåº¦æ¯”è¾ƒæ…¢ã€‚</li><li>å»ºè®®æ”¹ä¸ºå›½å†…é˜¿é‡Œäº‘ä»“åº“ï¼Œé…ç½®æ–‡ä»¶ä¸‹è½½ï¼š<a href="http://attach.i7years.com/attach/settings.xml" target="_blank" rel="noopener">http://attach.i7years.com/attach/settings.xml</a></li></ul></blockquote></li></ul><h3 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h3><h5 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install tomcat</span><br></pre></td></tr></table></figure><h5 id="ç®¡ç†"><a href="#ç®¡ç†" class="headerlink" title="ç®¡ç†"></a>ç®¡ç†</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew services start|stop tomcat</span><br></pre></td></tr></table></figure><h2 id="IDEå®‰è£…"><a href="#IDEå®‰è£…" class="headerlink" title="IDEå®‰è£…"></a>IDEå®‰è£…</h2><blockquote><p>æŒ‡å—ï¼š<a href="https://github.com/wangweiX/mac-setup/tree/master/JetBrains%20IDEs" target="_blank" rel="noopener">https://github.com/wangweiX/mac-setup/tree/master/JetBrains%20IDEs</a></p></blockquote><h3 id="å®‰è£…-2"><a href="#å®‰è£…-2" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><ol><li><p>è¿™é‡Œç»Ÿä¸€æ¨è <a href="https://www.jetbrains.com/" target="_blank" rel="noopener">jetbrains</a> ç³»åˆ—çš„äº§å“ï¼Œæ”¯æŒå„ç§ç¼–ç¨‹è¯­è¨€çš„IDEä»¥åŠæ•°æ®åº“æ“ä½œã€‚</p></li><li><p>è¿™é‡Œæ¨èä½¿ç”¨ <a href="https://www.jetbrains.com/toolbox/download/#section=mac" target="_blank" rel="noopener">toolbox</a> å®‰è£…ä¸­IDEï¼Œä¾¿äºå®‰è£…ã€å¸è½½ä»¥åŠç‰ˆæœ¬ç®¡ç†ã€‚</p><p><img src="https://img.i7years.com/blog/WX20171120-233139@3x.png" alt=""></p></li><li><p>è°ƒæ•´IDEAå·¥å…·ï¼Œæ‰“å¼€view â€”&gt; å‹¾é€‰ Toolbarï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://img.i7years.com/blog/WX20171120-234109@3x.png" alt=""></p></li><li><p>å­¦ä¹ å¹¶æŒæ¡IDEAçš„å¸¸ç”¨å¿«æ·é”®ï¼Œæé«˜ç¼–ç æ•ˆç‡ã€‚</p></li></ol><h3 id="IDEæ’ä»¶æ¨è"><a href="#IDEæ’ä»¶æ¨è" class="headerlink" title="IDEæ’ä»¶æ¨è"></a>IDEæ’ä»¶æ¨è</h3><ol><li><a href="https://plugins.jetbrains.com/plugin/6317-lombok-plugin" target="_blank" rel="noopener">Lombok</a></li><li><a href="https://plugins.jetbrains.com/plugin/7315-git-flow-integration" target="_blank" rel="noopener">Git Flow Intergration</a></li><li><a href="https://plugins.jetbrains.com/plugin/10046-alibaba-java-coding-guidelines" target="_blank" rel="noopener">Alibaba Java Coding Guidelines</a></li><li><a href="https://www.sonarlint.org/" target="_blank" rel="noopener">SonarLint</a></li></ol><h2 id="å¼€å‘å·¥å…·"><a href="#å¼€å‘å·¥å…·" class="headerlink" title="å¼€å‘å·¥å…·"></a>å¼€å‘å·¥å…·</h2><h3 id="iTerm"><a href="#iTerm" class="headerlink" title="iTerm"></a>iTerm</h3><blockquote><p>æŒ‡å—ï¼š<a href="https://github.com/wangweiX/mac-setup/tree/master/iTerm" target="_blank" rel="noopener">https://github.com/wangweiX/mac-setup/tree/master/iTerm</a></p></blockquote><h3 id="Zsh"><a href="#Zsh" class="headerlink" title="Zsh"></a>Zsh</h3><blockquote><p>æŒ‡å—ï¼š<a href="https://github.com/robbyrussell/oh-my-zsh" target="_blank" rel="noopener">https://github.com/robbyrussell/oh-my-zsh</a></p></blockquote><h3 id="Postman"><a href="#Postman" class="headerlink" title="Postman"></a>Postman</h3><blockquote><p>éå¸¸ä¸é”™çš„httpè¯·æ±‚è°ƒè¯•ç¥å™¨ï¼Œä¾¿äºAPIæ¥å£è°ƒè¯•</p></blockquote><p>åœ°å€ï¼š<a href="https://www.getpostman.com/" target="_blank" rel="noopener">https://www.getpostman.com/</a></p><h3 id="SwitchHosts"><a href="#SwitchHosts" class="headerlink" title="SwitchHosts"></a>SwitchHosts</h3><blockquote><p>æŒ‡å—ï¼š<a href="https://github.com/oldj/SwitchHosts" target="_blank" rel="noopener">https://github.com/oldj/SwitchHosts</a></p></blockquote><h2 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h2><h3 id="Mysql"><a href="#Mysql" class="headerlink" title="Mysql"></a>Mysql</h3><blockquote><p>æŒ‡å—ï¼š<a href="https://github.com/wangweiX/mac-setup/tree/master/MySQL" target="_blank" rel="noopener">https://github.com/wangweiX/mac-setup/tree/master/MySQL</a></p></blockquote><h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><h5 id="å®‰è£…-3"><a href="#å®‰è£…-3" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install redis</span><br></pre></td></tr></table></figure><h5 id="é…ç½®-1"><a href="#é…ç½®-1" class="headerlink" title="é…ç½®"></a>é…ç½®</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/etc/redis.conf</span><br></pre></td></tr></table></figure><h5 id="ç®¡ç†-1"><a href="#ç®¡ç†-1" class="headerlink" title="ç®¡ç†"></a>ç®¡ç†</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew services start|stop redis</span><br></pre></td></tr></table></figure><h3 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h3><ul><li>redisï¼š<a href="https://github.com/uglide/RedisDesktopManager" target="_blank" rel="noopener">https://github.com/uglide/RedisDesktopManager</a></li><li>mysqlï¼š[<strong>æ¨è</strong>]DataGrip: ä½¿ç”¨<code>Jetbrains toolbox</code>è¿›è¡Œå®‰è£…</li></ul><h1 id="ç½‘ç»œåˆ†æ"><a href="#ç½‘ç»œåˆ†æ" class="headerlink" title="ç½‘ç»œåˆ†æ"></a>ç½‘ç»œåˆ†æ</h1><ul><li><a href="https://www.charlesproxy.com/" target="_blank" rel="noopener">charles</a></li><li><a href="https://www.wireshark.org/" target="_blank" rel="noopener">wireshark</a></li><li><a href="https://github.com/trimstray/htrace.sh" target="_blank" rel="noopener">htrace.sh</a></li></ul><h2 id="æ–‡æœ¬ç¼–è¾‘å™¨"><a href="#æ–‡æœ¬ç¼–è¾‘å™¨" class="headerlink" title="æ–‡æœ¬ç¼–è¾‘å™¨"></a>æ–‡æœ¬ç¼–è¾‘å™¨</h2><h3 id="SublimeText"><a href="#SublimeText" class="headerlink" title="SublimeText"></a>SublimeText</h3><blockquote><p>æŒ‡å—ï¼š<a href="https://github.com/wangweiX/mac-setup/tree/master/SublimeText" target="_blank" rel="noopener">https://github.com/wangweiX/mac-setup/tree/master/SublimeText</a></p></blockquote><h3 id="MarkDown"><a href="#MarkDown" class="headerlink" title="MarkDown"></a>MarkDown</h3><ol><li>å·¥å…·<ul><li>å…è´¹ï¼š<a href="http://typora.io" target="_blank" rel="noopener">typora</a></li><li>ä»˜è´¹ï¼š<a href="https://itunes.apple.com/us/app/bear/id1016366447?mt=8" target="_blank" rel="noopener">Bear</a></li></ul></li><li><p>è¯­æ³•æ•™å­¦</p><ul><li><a href="http://wowubuntu.com/markdown/basic.html" target="_blank" rel="noopener">http://wowubuntu.com/markdown/basic.html</a></li><li><a href="http://www.maxiang.info/" target="_blank" rel="noopener">http://www.maxiang.info/</a></li></ul></li></ol><h3 id="Atom"><a href="#Atom" class="headerlink" title="Atom"></a>Atom</h3><ul><li>ä¸‹è½½åœ°å€ï¼š<a href="https://atom.io/" target="_blank" rel="noopener">https://atom.io/</a></li></ul><h2 id="æµè§ˆå™¨"><a href="#æµè§ˆå™¨" class="headerlink" title="æµè§ˆå™¨"></a>æµè§ˆå™¨</h2><ul><li>æœç»ä½¿ç”¨ä»»ä½•å›½äº§æµè§ˆå™¨ï¼ˆå‰ç«¯|æµ‹è¯•å°ä¼™ä¼´é™¤å¤–ï¼‰</li><li>åŠ¡å¿…ä½¿ç”¨è¿™ä¸ªæ˜Ÿçƒä¸Šæœ€å¥½çš„æµè§ˆå™¨â€”â€”Googleæµè§ˆå™¨</li><li>æ’ä»¶æ¨èï¼š<a href="https://wangwei.one/posts/4c3b6bcb.html">https://wangwei.one/posts/4c3b6bcb.html</a></li></ul><h2 id="Popular-macOS-cli"><a href="#Popular-macOS-cli" class="headerlink" title="Popular macOS cli"></a>Popular macOS cli</h2><table><thead><tr><th>è½¯ä»¶</th><th>è¯´æ˜</th><th>å®‰è£…</th></tr></thead><tbody><tr><td><a href="https://www.gnu.org/software/wget/" target="_blank" rel="noopener">wget</a></td><td>ä¸‹è½½</td><td><code>brew install wget</code></td></tr><tr><td><a href="https://hisham.hm/htop/" target="_blank" rel="noopener">htop</a></td><td>è¿›ç¨‹æŸ¥çœ‹ç®¡ç†</td><td><code>brew install htop</code></td></tr><tr><td><a href="https://ytdl-org.github.io/youtube-dl/index.html" target="_blank" rel="noopener">youtube-dl</a></td><td>youtubeä¸‹è½½</td><td><code>brew install youtube-dl</code></td></tr><tr><td><a href="https://github.com/BurntSushi/ripgrep" target="_blank" rel="noopener">ripgrep</a></td><td>æ–‡ä»¶æ£€ç´¢</td><td><code>brew install ripgrep</code></td></tr><tr><td><a href="https://www.imagemagick.org/" target="_blank" rel="noopener">imagemagisk</a></td><td>å›¾ç‰‡å¤„ç†</td><td><code>brew install imagemagisk</code></td></tr><tr><td><a href="https://www.vim.org/" target="_blank" rel="noopener">vim</a></td><td>ç¼–è¾‘å™¨</td><td><code>brew install vim</code></td></tr><tr><td><a href="https://ohmyz.sh/" target="_blank" rel="noopener">zsh</a></td><td>å‘½ä»¤ç»ˆç«¯</td><td><code>brew install zsh</code></td></tr><tr><td><a href="https://www.rarlab.com/rar_add.htm" target="_blank" rel="noopener">unrar</a></td><td>å‹ç¼©/è§£å‹</td><td><code>brew install unrar</code></td></tr><tr><td><a href="https://www.jduck.net/blog/2014/09/30/gnu-paralell/" target="_blank" rel="noopener">parallel</a></td><td>å¹¶è¡Œå¤„ç†</td><td><code>brew install parallel</code></td></tr><tr><td><a href="https://github.com/sivel/speedtest-cli" target="_blank" rel="noopener">speedtest-cli</a></td><td>é€Ÿåº¦æµ‹è¯•</td><td><code>brew install speedtest-cli</code></td></tr></tbody></table><blockquote><p><a href="https://picocoder.io/best-homebrew-packages-for-mac/" target="_blank" rel="noopener">https://picocoder.io/best-homebrew-packages-for-mac/</a></p></blockquote>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> å·¥å…· </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Java NIO Channel]]></title>
      <url>/posts/java-nio-channel.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>Java NIOï¼ˆNew IOï¼‰æ˜¯Javaçš„æ›¿ä»£IO APIï¼ˆæ¥è‡ªJava 1.4ï¼‰ï¼Œæ„å‘³ç€æ›¿ä»£æ ‡å‡†Java IOå’ŒJava Networking APIã€‚ Java NIOæä¾›äº†ä¸æ ‡å‡†IO APIä¸åŒçš„ä½¿ç”¨IOçš„æ–¹å¼ã€‚</p><a id="more"></a><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>Java NIO ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š</p><ul><li>Channels</li><li>Buffers</li><li>Selectors</li></ul><p>é™¤æ­¤ä¹‹å¤–ï¼ŒJava NIOè¿˜æœ‰è®¸å¤šç±»å’Œç»„ä»¶ï¼Œä½†æ˜¯NIOçš„æ ¸å¿ƒAPIä¸»è¦è¿˜æ˜¯ç”± <code>channel</code>,<code>buffer</code>å’Œ<code>selector</code> æ„æˆã€‚å…¶ä½™çš„ç»„ä»¶ï¼Œå¦‚<code>Pipe</code>å’Œ<code>FileLock</code>ï¼Œåªæ˜¯ä¸è¿™ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ä¸€èµ·ä½¿ç”¨çš„å®ç”¨ç¨‹åºç±»ï¼Œæœ¬ç¯‡æ–‡ç« å…ˆæ¥æ¥ä»‹ç»Channelã€‚</p><p>é€šå¸¸ï¼ŒNIOä¸­çš„æ‰€æœ‰IOéƒ½ä»¥Channelå¼€å§‹ï¼ŒChannelï¼ˆé€šé“ï¼‰æœ‰ç‚¹åƒStreamï¼ˆæµï¼‰ï¼Œä½†æ˜¯å®ƒåˆæœ‰ä¸€äº›åŒºåˆ«ï¼š</p><ul><li>ä½ æ—¢å¯ä»¥ä»Channleä¸­è¯»å–æ•°æ®ï¼Œä¹Ÿå¯ä»¥å‘å…¶å†™å…¥æ•°æ®ã€‚è€ŒStreamé€šå¸¸åªèƒ½å•å‘æ“ä½œï¼Œè¦ä¹ˆè¯»ï¼Œè¦ä¹ˆå†™ï¼›</li><li>Channelæ”¯æŒå¼‚æ­¥è¯»å–æˆ–å†™å…¥æ•°æ®ï¼›</li><li>æ•°æ®ä»Channelä¸­è¯»å–åˆ°Bufferä¸­ï¼Œä»Bufferå†™å…¥åˆ°Channelä¸­ã€‚</li></ul><p>ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://img.i7years.com/blog/channels-buffers.png" alt="channels-buffers"></p><h3 id="Channel-å®ç°ç±»"><a href="#Channel-å®ç°ç±»" class="headerlink" title="Channel å®ç°ç±»"></a>Channel å®ç°ç±»</h3><p>ä»¥ä¸‹æ˜¯Java NIOä¸­æœ€é‡è¦çš„Channelå®ç°ç±»ï¼š</p><ul><li>FileChannelï¼šä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œæˆ–å†™å…¥æ•°æ®åˆ°æ–‡ä»¶ä¸­</li><li>DatagramChannelï¼šå¯ä»¥é€šè¿‡UDPåè®®åœ¨ç½‘ç»œä¸Šè¯»å†™æ•°æ®ã€‚</li><li>SocketChannelï¼šå¯ä»¥é€šè¿‡TCPåè®®åœ¨ç½‘ç»œä¸Šè¯»å†™æ•°æ®ã€‚</li><li>ServerSocketChannelï¼šç›‘å¬ä¼ å…¥çš„TCPè¿æ¥ï¼Œå°±åƒWebæœåŠ¡å™¨ä¸€æ ·ã€‚ å¯¹äºæ¯ä¸ªä¼ å…¥è¿æ¥ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªSocketChannelã€‚</li></ul><p>æœ¬ç¯‡æ–‡ç« å…ˆæ¥ä»‹ç»FileChannelï¼Œå…¶ä½™çš„åé¢å†æ¥ä»‹ç»ã€‚</p><h2 id="FileChannel"><a href="#FileChannel" class="headerlink" title="FileChannel"></a>FileChannel</h2><p>Java NIO FileChannel æ˜¯ä¸€ä¸ªä¸æ–‡ä»¶ç›¸è¿æ¥çš„é€šé“ã€‚é€šè¿‡FileChannelä½ å¯ä»¥ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œä»¥åŠå†™å…¥æ•°æ®åˆ°æ–‡ä»¶ä¸­ã€‚FileChannelå¯ä»¥çœ‹ä½œæ˜¯æ ‡å‡†Java IO APIçš„æ›¿ä»£æ–¹æ¡ˆã€‚</p><p>FileChannelåªèƒ½ä»¥é˜»å¡æ¨¡å¼æ¥ä½¿ç”¨ï¼Œä¸èƒ½ä½¿ç”¨éé˜»å¡æ¨¡å¼ã€‚</p><h4 id="Opening-a-FileChannel"><a href="#Opening-a-FileChannel" class="headerlink" title="Opening a FileChannel"></a>Opening a FileChannel</h4><p>åœ¨ä½¿ç”¨FileChannelä¹‹å‰ï¼Œä½ å¿…é¡»å…ˆæ‰“å¼€å®ƒã€‚ä½ ä¸èƒ½ç›´æ¥æ‰“å¼€ä¸€ä¸ªFileChannelï¼Œä½ éœ€è¦é€šè¿‡InputStream,OutputStreamæˆ–RandomAccessFileæ¥è·å–FileChannelï¼Œè°ƒç”¨ <code>getChannel()</code>ã€‚</p><p>ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">FileOutputStream outputStream = <span class="keyword">new</span> FileOutputStream(<span class="string">"file.txt"</span>);</span><br><span class="line">FileChannel fileChannel = outputStream.getChannel();</span><br><span class="line"></span><br><span class="line">FileInputStream inputStream = <span class="keyword">new</span> FileInputStream(<span class="string">"file.txt"</span>);</span><br><span class="line">FileChannel fileChannel = inputStream.getChannel();</span><br><span class="line"></span><br><span class="line">RandomAccessFile accessFile = <span class="keyword">new</span> RandomAccessFile(<span class="string">"file.txt"</span>, <span class="string">"rw"</span>);</span><br><span class="line">FileChannel fileChannel = accessFile.getChannel();</span><br></pre></td></tr></table></figure><h4 id="Reading-Data-from-a-FileChannel"><a href="#Reading-Data-from-a-FileChannel" class="headerlink" title="Reading Data from a FileChannel"></a>Reading Data from a FileChannel</h4><p>è°ƒç”¨ <code>read()</code> æ–¹æ³•å¯ä»¥ä»FileChannelä¸­è¯»å–ç›¸åº”çš„æ•°æ®ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ByteBuffer buf = ByteBuffer.allocate(<span class="number">48</span>);</span><br><span class="line"><span class="keyword">int</span> bytesRead = fileChannel.read(buf);</span><br></pre></td></tr></table></figure><p>é¦–å…ˆéœ€è¦å…ˆåˆ†é…ä¸€ä¸ªBufferï¼Œç„¶åè°ƒç”¨ read() æ–¹æ³• ï¼Œä»Channelä¸­è¯»å–æ•°æ®åˆ°Bufferä¸­ã€‚</p><p>è¿”å›çš„ int æ•°æ®ï¼Œå‘Šè¯‰æˆ‘ä»¬æœ‰å¤šå°‘æ•°æ®å·²è¢«å†™å…¥åˆ°äº† buffer ä¸­ï¼Œå¦‚æœè¿”å› -1 ï¼Œåˆ™è¡¨ç¤ºåˆ°è¾¾äº†EOF (end-of-file)ã€‚</p><h4 id="Writing-Data-to-a-FileChannel"><a href="#Writing-Data-to-a-FileChannel" class="headerlink" title="Writing Data to a FileChannel"></a>Writing Data to a FileChannel</h4><p>å†™å…¥æ•°æ®éœ€è¦è°ƒç”¨ FileChannel.write() æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">String newData = <span class="string">"New String to wirte to file...."</span> + System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">ByteBuffer buffer = ByteBuffer.allocate(<span class="number">48</span>);</span><br><span class="line">buffer.clear();</span><br><span class="line">buffer.put(newData.getBytes());</span><br><span class="line">buffer.flip(); </span><br><span class="line"></span><br><span class="line">RandomAccessFile accessFile = <span class="keyword">new</span> RandomAccessFile(<span class="string">"file.txt"</span>, <span class="string">"rw"</span>);</span><br><span class="line">FileChannel fileChannel = accessFile.getChannel();</span><br><span class="line"><span class="keyword">while</span> (buffer.hasRemaining()) &#123;</span><br><span class="line">    fileChannel.write(buffer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºæ²¡æ³•ä¿è¯æœ‰å¤šå°‘byteså°†ä¼šè¢«å†™å…¥åˆ°FileChannelä¸­ï¼Œå› æ­¤éœ€è¦å°†FileChannle.write() æ–¹æ³•åœ¨whileå¾ªç¯ä¸­è°ƒç”¨ï¼ŒæŒ‡å¯¼Bufferä¸­æ²¡æœ‰å¯å†™å…¥çš„æ•°æ®ä¸ºæ­¢ã€‚</p><h4 id="Closing-a-FileChannel"><a href="#Closing-a-FileChannel" class="headerlink" title="Closing a FileChannel"></a>Closing a FileChannel</h4><p>ç”¨å®ŒFileChannelä¹‹åï¼Œå¿…é¡»å°†å…¶å…³é—­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">channel.close();</span><br></pre></td></tr></table></figure><h4 id="FileChannel-Position"><a href="#FileChannel-Position" class="headerlink" title="FileChannel Position"></a>FileChannel Position</h4><p>åœ¨è¯»å–æˆ–å†™å…¥FileChannelæ—¶ï¼Œä½ å¯ä»¥åœ¨ç‰¹å®šä½ç½®æ‰§è¡Œæ­¤æ“ä½œã€‚</p><p>å¯ä»¥é€šè¿‡è°ƒç”¨ <code>position()</code> æ–¹æ³•è·å–FileChannelå¯¹è±¡çš„å½“å‰ä½ç½®ã€‚ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨ <code>position(long pos)</code> æ–¹æ³•æ¥è®¾ç½®FileChannelçš„ä½ç½®ã€‚ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> pos = fileChannel.position();</span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> newPos = <span class="number">12</span>;</span><br><span class="line">fileChannel.position(newPos);</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ åœ¨æ–‡ä»¶EOFä¹‹åè®¾ç½®positionï¼Œå¹¶å°è¯•ä»Channelä¸­è¯»å–æ•°æ®ï¼Œå°†ä¼šè¿”å› <code>-1</code> çš„ç»“æŸæ ‡å¿—ã€‚</p><p>å¦‚æœä½ åœ¨æ–‡ä»¶EOFä¹‹åè®¾ç½®positionï¼Œå¹¶å°è¯•å†™å…¥æ•°æ®åˆ°Channelä¸­ï¼Œæ–‡ä»¶å°†ä¼šæ‰©å±•å·²ç¬¦åˆè®¾ç½®çš„positionï¼Œå¹¶å®¹çº³æ–°çš„å­—èŠ‚ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´â€œæ–‡ä»¶æ¼æ´â€ï¼Œç£ç›˜ä¸Šçš„ç‰©ç†æ–‡ä»¶åœ¨å†™å…¥æ•°æ®ä¸­ä¼šå­˜åœ¨é—´éš™ã€‚</p><h4 id="FileChannel-Size"><a href="#FileChannel-Size" class="headerlink" title="FileChannel Size"></a>FileChannel Size</h4><p>æ–¹æ³• <code>size()</code> è¿”å›channelæ‰€è¿æ¥çš„æ–‡ä»¶çš„å­—èŠ‚å¤§å°ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> fileSize = channel.size();</span><br></pre></td></tr></table></figure><h4 id="FileChannel-Truncate"><a href="#FileChannel-Truncate" class="headerlink" title="FileChannel Truncate"></a>FileChannel Truncate</h4><p>é€šè¿‡<code>FileChannel.truncate()</code>æ–¹æ³•ï¼Œä½ å¯ä»¥æˆªå–æ–‡ä»¶ï¼Œä¾‹å¦‚æˆªå–æŸä¸ªFileChannel 1024ä¸ªå­—èŠ‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">channel.truncate(<span class="number">1024</span>);</span><br></pre></td></tr></table></figure><h4 id="FileChannel-Force"><a href="#FileChannel-Force" class="headerlink" title="FileChannel Force"></a>FileChannel Force</h4><p><code>FileChannel.force()</code> æ–¹æ³•ä¼šå°†æ‰€æœ‰æœªå†™å…¥çš„æ•°æ®å¼ºåˆ¶ä»channelåˆ·åˆ°ç£ç›˜ä¸Šã€‚å‡ºäºæ€§èƒ½åŸå› ï¼Œæ“ä½œç³»ç»Ÿå¯èƒ½ä¼šå°†æ•°æ®ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤åœ¨è°ƒç”¨force()æ–¹æ³•ä¹‹å‰ï¼Œæ— æ³•ä¿è¯å†™å…¥Channelçš„æ•°æ®æ˜¯å¦å†™å…¥åˆ°äº†ç£ç›˜ä¸­ã€‚</p><p><code>force()</code>æœ‰ä¸ªbooleanå‚æ•°ï¼Œè¡¨ç¤ºæ˜¯å¦éœ€è¦åˆ·æ–°æ–‡ä»¶çš„mete dataï¼ˆå…ƒæ•°æ®ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">channel.force(<span class="keyword">true</span>)</span><br></pre></td></tr></table></figure><h3 id="Channel-to-Channel-Transfers"><a href="#Channel-to-Channel-Transfers" class="headerlink" title="Channel to Channel Transfers"></a>Channel to Channel Transfers</h3><p>ä½ å¯ä»¥ä½¿ç”¨Java NIOå°†æ•°æ®ä»ä¸€ä¸ªChannelç›´æ¥è½¬ç§»åˆ°å¦ä¸€ä¸ªChannelä¸Šã€‚å‡å¦‚è¿™ä¸ªChannel æ˜¯ FileChannelï¼Œé‚£ä¹ˆä½ å¯ä»¥é€šè¿‡ transferTo() å’Œ transferFrom() æ¥å®ç°ã€‚</p><p><img src="https://img.i7years.com/blog/channel-transfer.png" alt="channel-transfer"></p><h4 id="transferFrom"><a href="#transferFrom" class="headerlink" title="transferFrom()"></a>transferFrom()</h4><p>FileChannel.transferFrom() ï¼šå°†æ•°æ®ä»æºChannelè½¬ç§»åˆ°ç›®æ ‡Channelä¸­ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">RandomAccessFile fromFile = <span class="keyword">new</span> RandomAccessFile(<span class="string">"fromFile.txt"</span>, <span class="string">"rw"</span>);</span><br><span class="line">FileChannel fromChannel = fromFile.getChannel();</span><br><span class="line"></span><br><span class="line">RandomAccessFile toFile = <span class="keyword">new</span> RandomAccessFile(<span class="string">"toFile.txt"</span>, <span class="string">"rw"</span>);</span><br><span class="line">FileChannel toChannel = toFile.getChannel();</span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> position = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">long</span> count = fromChannel.size();</span><br><span class="line"></span><br><span class="line">toChannel.transferFrom(fromChannel, position, count);</span><br></pre></td></tr></table></figure><p>positionï¼šæŒ‡å®šæ•°æ®ä¼ è¾“çš„èµ·å§‹ä½ç½®ã€‚</p><p>countï¼šæŒ‡å®šæœ€å¤§çš„ä¼ è¾“çš„å­—èŠ‚æ•°ã€‚</p><h4 id="transferTo"><a href="#transferTo" class="headerlink" title="transferTo()"></a>transferTo()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">RandomAccessFile fromFile = <span class="keyword">new</span> RandomAccessFile(<span class="string">"fromFile.txt"</span>, <span class="string">"rw"</span>);</span><br><span class="line">FileChannel fromChannel = fromFile.getChannel();</span><br><span class="line"></span><br><span class="line">RandomAccessFile toFile = <span class="keyword">new</span> RandomAccessFile(<span class="string">"toFile.txt"</span>, <span class="string">"rw"</span>);</span><br><span class="line">FileChannel toChannel = toFile.getChannel();</span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> position = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">long</span> count = fromChannel.size();</span><br><span class="line"></span><br><span class="line">fromChannel.transferTo(position,count,toChannel);</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="http://tutorials.jenkov.com/java-nio/index.html" target="_blank" rel="noopener">http://tutorials.jenkov.com/java-nio/index.html</a></li><li><a href="http://tutorials.jenkov.com/java-nio/overview.html" target="_blank" rel="noopener">http://tutorials.jenkov.com/java-nio/overview.html</a></li><li><a href="http://tutorials.jenkov.com/java-nio/channels.html" target="_blank" rel="noopener">http://tutorials.jenkov.com/java-nio/channels.html</a></li><li><a href="http://tutorials.jenkov.com/java-nio/file-channel.html" target="_blank" rel="noopener">http://tutorials.jenkov.com/java-nio/file-channel.html</a></li><li><a href="http://tutorials.jenkov.com/java-nio/channel-to-channel-transfers.html" target="_blank" rel="noopener">http://tutorials.jenkov.com/java-nio/channel-to-channel-transfers.html</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> NIO </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Linuxã€Macå‘½ä»¤æ¸…å•]]></title>
      <url>/posts/list-of-common-linux-and-mac-commands.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>æ•´ç†ä¸€ä¸‹è‡ªå·±å¹³æ—¶ç”¨çš„æ¯”è¾ƒå¤šçš„ä¸€äº›å·¥å…·å’Œå‘½ä»¤ï¼Œä¾¿äºåæœŸæŸ¥é˜…ã€‚</p><a id="more"></a><h2 id="Linuxç³»ç»Ÿ"><a href="#Linuxç³»ç»Ÿ" class="headerlink" title="Linuxç³»ç»Ÿ"></a>Linuxç³»ç»Ÿ</h2><p>å¼ºçƒˆæ¨èä¸€ä¸ªç½‘ç«™ï¼š<a href="http://cheat.sh/ï¼Œèƒ½å¤ŸæŸ¥è¯¢æ‰€æœ‰linuxç³»ç»Ÿç›¸å…³çš„å‘½ä»¤ã€‚" target="_blank" rel="noopener">http://cheat.sh/ï¼Œèƒ½å¤ŸæŸ¥è¯¢æ‰€æœ‰linuxç³»ç»Ÿç›¸å…³çš„å‘½ä»¤ã€‚</a></p><h3 id="ç£ç›˜ç±»"><a href="#ç£ç›˜ç±»" class="headerlink" title="ç£ç›˜ç±»"></a>ç£ç›˜ç±»</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢ç³»ç»Ÿç£ç›˜å‰©ä½™ç©ºé—´</span></span><br><span class="line">df -h</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰ç©ºé—´æ–‡ä»¶çš„å¤§å°</span></span><br><span class="line">du -h</span><br></pre></td></tr></table></figure><h3 id="æ–‡ä»¶æ“ä½œç±»"><a href="#æ–‡ä»¶æ“ä½œç±»" class="headerlink" title="æ–‡ä»¶æ“ä½œç±»"></a>æ–‡ä»¶æ“ä½œç±»</h3><h4 id="æœ¬åœ°æ“ä½œ"><a href="#æœ¬åœ°æ“ä½œ" class="headerlink" title="æœ¬åœ°æ“ä½œ"></a>æœ¬åœ°æ“ä½œ</h4><ol><li><p>æŸ¥è¯¢ <code>path1</code>ç›®å½•ä¸­çš„javaæ–‡ä»¶ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ find path1 -type f -name <span class="string">"*.java"</span></span><br></pre></td></tr></table></figure></li><li><p>ä» <code>path1</code> ç›®å½•åŒæ­¥ java æ–‡ä»¶åˆ° <code>path2</code> ä¸­ï¼Œå¹¶ä¸”: 1)åŒæ­¥ç›®å½•ç»“æ„;2)åˆ é™¤æºæ–‡ä»¶;3)åˆ é™¤path2ä¸­çš„ç©ºæ–‡ä»¶å¤¹</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rsync -arv --prune-empty-dirs --remove-source-files --include=<span class="string">'*/'</span> --include=<span class="string">'*.java'</span> --exclude=<span class="string">'*'</span> path1 path2</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤ <code>path1</code> ç›®å½•ä¸­æ‰€æœ‰çš„ç©ºæ–‡ä»¶å¤¹ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ find path1 -type d -depth -empty -exec rmdir <span class="string">"&#123;&#125;"</span> \;</span><br></pre></td></tr></table></figure></li></ol><h4 id="è¿œç¨‹æ“ä½œ"><a href="#è¿œç¨‹æ“ä½œ" class="headerlink" title="è¿œç¨‹æ“ä½œ"></a>è¿œç¨‹æ“ä½œ</h4><ol><li><p>åŒæ­¥è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶åˆ°æœ¬åœ°</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rsync -avz --progress -e <span class="string">"ssh -p <span class="variable">$portNumber</span>"</span> user@remoteip:/path/to/files/ /local/path/</span><br></pre></td></tr></table></figure></li></ol><h3 id="è¿›ç¨‹-amp-ç«¯å£"><a href="#è¿›ç¨‹-amp-ç«¯å£" class="headerlink" title="è¿›ç¨‹&amp;ç«¯å£"></a>è¿›ç¨‹&amp;ç«¯å£</h3><ol><li><p>æ£€æŸ¥ç«¯å£è¿è¡Œ</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ netstat -vanp tcp | grep <span class="variable">$port</span></span><br></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo lsof -i tcp:<span class="variable">$port</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="ç»Ÿè®¡åˆ†æ"><a href="#ç»Ÿè®¡åˆ†æ" class="headerlink" title="ç»Ÿè®¡åˆ†æ"></a>ç»Ÿè®¡åˆ†æ</h3><p>ç»Ÿè®¡æ—¥å¿—ä¸­çš„å¹³å‡å“åº”æ—¶é—´ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> cat witness.log | grep latency | \awk '&#123;sum+=$14&#125; END &#123;print "Count: ",NR;print "Avg :",sum/NR&#125;'</span><br></pre></td></tr></table></figure><hr><h2 id="Macç³»ç»Ÿ"><a href="#Macç³»ç»Ÿ" class="headerlink" title="Macç³»ç»Ÿ"></a>Macç³»ç»Ÿ</h2><h3 id="brew"><a href="#brew" class="headerlink" title="brew"></a>brew</h3><blockquote><p>å®˜ç½‘ï¼š<a href="https://brew.sh/" target="_blank" rel="noopener">https://brew.sh/</a></p></blockquote><h5 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ruby -e <span class="string">"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"</span></span><br></pre></td></tr></table></figure><h5 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ brew update <span class="comment">#æ›´æ–°brew</span></span><br><span class="line">$ brew doctor <span class="comment"># è¯Šæ–­</span></span><br><span class="line">$ brew upgrade <span class="comment"># å‡çº§macä¸Šçš„è½¯ä»¶åŒ…</span></span><br><span class="line">$ brew cleanup <span class="comment"># æ¸…é™¤è¿‡æ—¶çš„å°±ç‰ˆæœ¬è½¯ä»¶</span></span><br><span class="line">$ brew list  <span class="comment"># åˆ—å‡ºæœ¬æœºé€šè¿‡brewå®‰è£…çš„æ‰€æœ‰è½¯ä»¶</span></span><br></pre></td></tr></table></figure><blockquote><p>ä»¥å®‰è£… nginx ä¸ºä¾‹</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ brew search nginx <span class="comment">#æ¨¡ç³Šæœç´¢å…³é”®å­—openssl</span></span><br><span class="line">$ brew install nginx  <span class="comment">#å®‰è£…openssl</span></span><br><span class="line">$ brew info nginx <span class="comment">#æŸ¥è¯¢opensslçš„å®‰è£…ä¿¡æ¯</span></span><br><span class="line">$ brew uninstall nginx <span class="comment">#å¸è½½openssl</span></span><br><span class="line">$ brew uninstall --ignore-dependencies nginx <span class="comment">#å¼ºè¡Œå¸è½½openssl</span></span><br><span class="line">$ brew upgrade nginx <span class="comment"># å‡çº§opensslï¼Œå¦‚æœä¸åŠ è½¯ä»¶åï¼Œå°±æ›´æ–°æ‰€æœ‰å¯ä»¥æ›´æ–°çš„è½¯ä»¶</span></span><br><span class="line">$ brew service start|stop|restart nginx <span class="comment"># å¯åŠ¨/åœæ­¢/é‡å¯ nginxæœåŠ¡</span></span><br></pre></td></tr></table></figure><h3 id="Jenv"><a href="#Jenv" class="headerlink" title="Jenv"></a>Jenv</h3><blockquote><p>å®˜ç½‘ï¼š<a href="http://www.jenv.be/" target="_blank" rel="noopener">http://www.jenv.be/</a></p></blockquote><h3 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h3><h5 id="æ¸…é™¤å‰ªåˆ‡æ¿å†…å®¹"><a href="#æ¸…é™¤å‰ªåˆ‡æ¿å†…å®¹" class="headerlink" title="æ¸…é™¤å‰ªåˆ‡æ¿å†…å®¹"></a>æ¸…é™¤å‰ªåˆ‡æ¿å†…å®¹</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pbcopy &lt; /dev/null</span><br></pre></td></tr></table></figure><h5 id="æ¸…ç†DNSç¼“å­˜"><a href="#æ¸…ç†DNSç¼“å­˜" class="headerlink" title="æ¸…ç†DNSç¼“å­˜"></a>æ¸…ç†DNSç¼“å­˜</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo killall -HUP mDNSResponder;sudo killall mDNSResponderHelper;sudo dscacheutil -flushcache</span><br></pre></td></tr></table></figure><h2 id="æ¨è"><a href="#æ¨è" class="headerlink" title="æ¨è"></a>æ¨è</h2><ul><li><a href="http://cheat.sh/" target="_blank" rel="noopener">http://cheat.sh/</a></li><li><a href="https://www.cyberciti.biz/" target="_blank" rel="noopener">https://www.cyberciti.biz/</a></li><li><a href="https://www.digitalocean.com/" target="_blank" rel="noopener">https://www.digitalocean.com/</a></li></ul>]]></content>
      
        <categories>
            
            <category> tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Mac </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[è¿ç»´èµ„æ–™æ•´ç†]]></title>
      <url>/posts/devops-article-collection.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>æ”¶é›†æ•´ç†ä¸€äº›æœ‰å…³è¿ç»´ç›¸å…³çš„æ“ä½œæŒ‡å—</p><a id="more"></a><h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h1><ul><li>Linuxé€†å‘ç›¸å…³çš„å­¦ä¹ èµ„æ–™ï¼š<a href="http://www.cis.syr.edu/~wedu/seed/" target="_blank" rel="noopener">SEED LABs</a></li><li><a href="https://www.cyberciti.biz/" target="_blank" rel="noopener">cyberciti</a></li><li><a href="http://linux.vbird.org/" target="_blank" rel="noopener">Linuxç§æˆ¿èœ</a></li></ul><h1 id="CentOS"><a href="#CentOS" class="headerlink" title="CentOS"></a>CentOS</h1><ul><li><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-using-firewalld-on-centos-7" target="_blank" rel="noopener">é˜²ç«å¢™é…ç½®</a></li><li><a href="https://www.cyberciti.biz/faq/unix-linux-check-if-port-is-in-use-command/" target="_blank" rel="noopener">ç«¯å£è¿è¡Œæ£€æŸ¥</a></li></ul><h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><ul><li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-centos-7" target="_blank" rel="noopener">Nginxå®‰è£…</a></li><li><a href="https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-centos-7" target="_blank" rel="noopener">Letâ€™s Encrypt å®‰è£…</a></li><li><a href="https://www.cyberciti.biz/tips/linux-unix-bsd-nginx-webserver-security.html" target="_blank" rel="noopener">Nginxå®‰å…¨è®¾ç½®</a></li><li><a href="https://github.com/denji/nginx-tuning" target="_blank" rel="noopener">Nginxæ€§èƒ½ä¼˜åŒ–</a></li></ul><h1 id="Gitå¸¸ç”¨å‘½ä»¤"><a href="#Gitå¸¸ç”¨å‘½ä»¤" class="headerlink" title="Gitå¸¸ç”¨å‘½ä»¤"></a>Gitå¸¸ç”¨å‘½ä»¤</h1><ul><li><a href="http://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html</a></li></ul>]]></content>
      
        <categories>
            
            <category> tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> DevOps </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Kindleç”µå­ä¹¦è½¬Epub]]></title>
      <url>/posts/kindle-eBook-to-epub.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="https://img.i7years.com/blog/blue-background-blue-sky-close-up-1864189.jpg" alt="blue-background-blue-sky-close-up"></p><p>è¶ç€äº”ä¸€å°é•¿æœŸï¼ŒæŠŠè‡ªå·±çš„ç”µå­ä¹¦åº“æ•´ç†äº†ä¸€ç•ªï¼Œæœ€ä¸»è¦çš„å·¥ä½œæ˜¯å°†Kindleç”µå­ä¹¦åˆå¹¶åˆ°äº†iBooksï¼Œå®ç°äº†ç”µå­ä¹¦çš„ç»Ÿä¸€ç®¡ç†ï¼Œæ–¹ä¾¿Spotlightæ£€ç´¢ã€‚ç”¨è¿‡Kindleå’ŒiBooksçš„åŒå­¦ï¼Œéƒ½åº”è¯¥æ¸…æ¥šï¼Œè¿™ä¸¤è€…åœ¨é˜…è¯»ä½“éªŒä¸Šæ²¡å¤šå¤§å·®åˆ«ï¼Œä½†iBooksåœ¨åšè¯»ä¹¦ç¬”è®°ï¼Œæ–‡å­—æ£€ç´¢ï¼Œç»ˆç«¯æ•°æ®åŒæ­¥ç­‰æ–¹é¢ç”©Kindleå¥½å‡ æ¡è¡—ã€‚</p><p>è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰æ£€ç´¢åŠŸèƒ½ï¼Œæƒ³è¦åœ¨å‡ ç™¾æœ¬ç”šè‡³æ˜¯ä¸Šåƒæœ¬ä¹¦ä¸­ï¼Œæ‰¾åˆ°è‡ªå·±æƒ³è¦çš„ä¿¡æ¯ï¼Œå ªæ¯”å¤§æµ·æé’ˆï¼Œä¿¡æ¯æ£€ç´¢ä¿¨ç„¶å·²æˆä¸ºæˆ‘ä»¬è¿™ä¸ªæ—¶ä»£çš„åˆšæ€§éœ€æ±‚ï¼Œå¿«é€Ÿå®šä½è‡ªå·±æƒ³è¦çš„çŸ¥è¯†å’Œç´ æï¼Œå°†æ›´å¤šçš„æ³¨æ„åŠ›ã€æ›´å¤šçš„æ—¶é—´ç•™ç»™å¤§è„‘å»æ€è€ƒã€å»å†™ä½œï¼Œæ‰æ˜¯æœ€é‡è¦çš„äº‹æƒ…ã€‚</p><a id="more"></a><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ä¸»è¦æ•™ä½ å¦‚ä½•é€šè¿‡Calibreå°†Kindle for Macä¸­çš„ç”µå­ä¹¦è‡ªåŠ¨å¯¼å…¥åˆ°iBooksä¸­å»ã€‚</p><blockquote><ol><li>ä½¿ç”¨ Kindle for Mac å°†ä½ åœ¨ amazon ä¸Šè´­ä¹°çš„ç”µå­ä¹¦åŒæ­¥åˆ°æœ¬åœ°ç›®å½•ï¼ˆæš‚ä¸”å‘½åä¸ºpathï¼‰ï¼›</li><li>ä½¿ç”¨ Mac è‡ªå¸¦çš„ Automator è‡ªåŠ¨ Copy ä¸Šä¸€æ­¥pathä¸‹çš„ç”µå­ä¹¦åˆ°å¦å¤–ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ˆæš‚ä¸”å‘½åä¸ºforderï¼‰ï¼›</li><li>ä½¿ç”¨ Calibre è‡ªåŠ¨åŠ è½½ä¸Šä¸€æ­¥forderä¸­çš„Kindleç”µå­ä¹¦ï¼Œå¹¶è‡ªåŠ¨è½¬åŒ–ä¸ºePubæ ¼å¼ï¼›</li><li>å°†ä¸Šä¸€æ­¥è½¬åŒ–å¥½çš„ePubç”µå­ä¹¦åˆ°æ‰‹åŠ¨å¯¼å…¥åˆ°iBooksä¸­å»ï¼ˆå”¯ä¸€ä¸€ä¸ªéœ€è¦æ‰‹åŠ¨æ“ä½œçš„æ­¥éª¤ï¼‰</li></ol></blockquote><hr><h3 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><ul><li>macOS ç³»ç»Ÿ</li></ul><h3 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h3><ul><li>ä¸‹è½½å¹¶å®‰è£…<a href="https://mac.filehorse.com/download-kindle-for-mac/" target="_blank" rel="noopener">Kindle for Mac</a> ï¼Œä¸‹è½½ <code>1.17.0</code> ç‰ˆæœ¬ï¼Œ<strong>ä¸è¦å®‰è£…æœ€æ–°ç‰ˆæœ¬</strong>ï¼›</li><li>ä¸‹è½½å¹¶å®‰è£…<a href="https://calibre-ebook.com/download" target="_blank" rel="noopener">Calibre</a>ï¼›</li></ul><h3 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><h4 id="Step-1-åŒæ­¥Kindleç”µå­ä¹¦åˆ°æœ¬åœ°"><a href="#Step-1-åŒæ­¥Kindleç”µå­ä¹¦åˆ°æœ¬åœ°" class="headerlink" title="Step 1. åŒæ­¥Kindleç”µå­ä¹¦åˆ°æœ¬åœ°"></a>Step 1. åŒæ­¥Kindleç”µå­ä¹¦åˆ°æœ¬åœ°</h4><h5 id="ç™»å½•Kindle-for-Mac"><a href="#ç™»å½•Kindle-for-Mac" class="headerlink" title="ç™»å½•Kindle for Mac"></a>ç™»å½•Kindle for Mac</h5><blockquote><p>æ³¨æ„ï¼šç”±äºamazonä¸åŒå›½å®¶é—´è´¦å·çš„æ•°æ®äº’ä¸ç›¸é€šï¼Œæ‰€ä»¥ç™»å½•æ—¶è¯·é€‰æ‹©æ­£ç¡®çš„ç™»å½•åŸŸåï¼Œå›½å†…ç”¨æˆ·è¯·é€‰æ‹©amazon.cn</p></blockquote><p><img src="https://img.i7years.com/bolgReg_kindle4Mac.png" alt="register"></p><h5 id="åŒæ­¥ç”µå­ä¹¦åˆ°æœ¬åœ°"><a href="#åŒæ­¥ç”µå­ä¹¦åˆ°æœ¬åœ°" class="headerlink" title="åŒæ­¥ç”µå­ä¹¦åˆ°æœ¬åœ°"></a>åŒæ­¥ç”µå­ä¹¦åˆ°æœ¬åœ°</h5><ul><li><p>ç™»å½•æˆåŠŸåï¼Œä½¿ç”¨ âŒ˜ + R åŒæ­¥ç”µå­ä¹¦</p></li><li><p>åœ¨Kindle for Macæ“ä½œåŒºå¤–ï¼Œä½¿ç”¨ âŒ˜ + Shift + G æ‰“å¼€ Go to Folderï¼Œè¾“å…¥ä»¥ä¸‹è·¯åŠ²ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/Library/Containers/com.amazon.Kindle/<span class="keyword">Data</span>/Library/Application Support/Kindle/My Kindle Content/</span><br></pre></td></tr></table></figure><p><img src="https://img.i7years.com/bolgGo2Folder.png" alt="gotofolder"></p></li><li><p>ä»¥ .azw æˆ– .mobi ç»“å°¾çš„æ–‡ä»¶å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„Kindleç”µå­ä¹¦</p><p><img src="https://img.i7years.com/bolgKindleItems.png" alt="MyKindleContent"></p></li></ul><h4 id="Step-2-è®¾ç½®Automatorè‡ªåŠ¨å¤åˆ¶Kindle-Books"><a href="#Step-2-è®¾ç½®Automatorè‡ªåŠ¨å¤åˆ¶Kindle-Books" class="headerlink" title="Step 2. è®¾ç½®Automatorè‡ªåŠ¨å¤åˆ¶Kindle Books"></a>Step 2. è®¾ç½®Automatorè‡ªåŠ¨å¤åˆ¶Kindle Books</h4><ul><li><p>æ‰“å¼€Mac è‡ªå¸¦çš„åº”ç”¨è½¯ä»¶ Automatorï¼›</p></li><li><p>é€‰æ‹©â€Folder Actionâ€</p><p><img src="https://img.i7years.com/bolg/automator1.png" alt=""></p></li><li><p>ç‚¹å‡»å³ä¾§ä¸‹æ‹‰é€‰æ¡† â€œChoose folderâ€ï¼Œé€‰æ‹©otherï¼Œé€šè¿‡ âŒ˜ + Shift + G å¯ä»¥å¿«é€Ÿå®šä½åˆ°å‰é¢æ‰€è¯´çš„Kindleç”µå­ä¹¦ç›®å½•ï¼šMy Kindle Content</p><p><img src="https://img.i7years.com/bolg/automator2.png" alt=""></p></li><li><p>é€‰æ‹© â€œFiles &amp; Foldersâ€ â€”â€”&gt; é€‰æ‹© â€œCopy Finder Itemsâ€ â€”â€”&gt; æŒ‡å®šæ–‡ä»¶Copyçš„ç›®æ ‡æ–‡ä»¶å¤¹ï¼Œæˆ‘çš„è·¯åŠ²ä¸º ~/Documents/003-Books/Kindle4MacItemsï¼Œè¿™ä¸ªçœ‹ä¸ªäººå–œå¥½</p><p><img src="https://img.i7years.com/bolg/automator3.png" alt=""></p></li><li><p>æŒ‰ä½ âŒ˜ + S ä¿å­˜ä¸Šé¢è®¾ç½®çš„ folder action.</p><p><img src="https://img.i7years.com/bolg/automator4.png" alt=""></p></li></ul><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥åšä¸ªæµ‹è¯•çœ‹çœ‹Automatoræ˜¯å¦ç”Ÿæ•ˆ</p><ul><li><p>æ‰“å¼€Kindle for Macï¼Œä»Downloaded Itemsä¸­åˆ é™¤ä¸€æœ¬ä¹¦</p></li><li><p>åŒå‡» Archived Items ä¸‹åˆšåˆšåˆ è¢«é™¤çš„ä¹¦ç±ï¼Œä¸‹è½½å®Œæˆåï¼Œä¼šå‡ºç°Automatorçš„æç¤ºå¼¹æ¡†ï¼Œè¯æ˜Automator copyè®¾ç½®æˆåŠŸï¼Œç‚¹å‡»Continueå³å¯ã€‚</p><blockquote><p>åœ¨Step 2ä¸­è®¾ç½®çš„Automatorè„šæœ¬ï¼Œä¼šéšæ—¶ç›‘å¬My Kindle Contentç›®å½•ä¸‹çš„å˜åŒ–ï¼Œä¸€æ—¦æœ‰æ–°å¢ä¹¦ç±ï¼Œ Automatorä¼šè‡ªåŠ¨Copyä¹¦ç±åˆ°Kindle4MacItemsç›®å½•ä¸‹</p></blockquote><p><img src="https://img.i7years.com/blog/automator7.png" alt=""></p></li></ul><h4 id="Step-3-å®‰è£…Calibre-DeDRMæ’ä»¶"><a href="#Step-3-å®‰è£…Calibre-DeDRMæ’ä»¶" class="headerlink" title="Step 3. å®‰è£…Calibre DeDRMæ’ä»¶"></a>Step 3. å®‰è£…Calibre DeDRMæ’ä»¶</h4><blockquote><p>DeDRM å¯ä»¥ç§»é™¤Kindleç”µå­ä¹¦ä¸Šçš„DRMä¿æŠ¤ï¼Œè®©Calibreè‡ªç”±è½¬åŒ–Kindleç”µå­ä¹¦ä¸ºä½ æƒ³è¦çš„æ ¼å¼</p></blockquote><ul><li><p>å®‰è£…<a href="https://calibre-ebook.com/download" target="_blank" rel="noopener">Calibre</a>ï¼Œè®¾ç½®å·¥å…·æ ä¸Šçš„ <code>Calibre Library</code> åœ°å€ï¼Œè¿™ä¸ªåœ°å€ä¸ºCalibreçš„ä¹¦åº“åœ°å€ï¼›</p></li><li><p>ä¸‹è½½<a href="https://github.com/apprenticeharper/DeDRM_tools/archive/v6.5.3.zip" target="_blank" rel="noopener">DeDRM Tools</a>å¹¶è§£å‹ï¼Œæ‰¾åˆ° DeDRM_plugin.zip æ–‡ä»¶ï¼Œç›¸å¯¹è·¯åŠ²DeDRM_tools-6.5.3/DeDRM_calibre_plugin/DeDRM_plugin.zip</p></li><li><p>å®‰è£…DeDRM_plugin.zip</p><p>Calibre â†’ Preferences â€”â€”&gt; Plugins â€”â€”&gt; Load plugin from file â€”â€”&gt; é€‰å– DeDRM_plugin.zip â€”â€”&gt; é‡å¯ Calibre.</p></li></ul><p><img src="https://img.i7years.com/bolg/calibre1.png" alt=""></p><p><img src="https://img.i7years.com/bolg/calibre2.png" alt=""></p><h4 id="Step-4-è®¾ç½®Calibreè‡ªåŠ¨åŠ è½½Kindleç”µå­ä¹¦å¹¶è‡ªåŠ¨è½¬åŒ–ä¸ºePubæ ¼å¼"><a href="#Step-4-è®¾ç½®Calibreè‡ªåŠ¨åŠ è½½Kindleç”µå­ä¹¦å¹¶è‡ªåŠ¨è½¬åŒ–ä¸ºePubæ ¼å¼" class="headerlink" title="Step 4. è®¾ç½®Calibreè‡ªåŠ¨åŠ è½½Kindleç”µå­ä¹¦å¹¶è‡ªåŠ¨è½¬åŒ–ä¸ºePubæ ¼å¼"></a>Step 4. è®¾ç½®Calibreè‡ªåŠ¨åŠ è½½Kindleç”µå­ä¹¦å¹¶è‡ªåŠ¨è½¬åŒ–ä¸ºePubæ ¼å¼</h4><h5 id="è®¾ç½®è¾“å‡ºæ ¼å¼ä¸ºePub"><a href="#è®¾ç½®è¾“å‡ºæ ¼å¼ä¸ºePub" class="headerlink" title="è®¾ç½®è¾“å‡ºæ ¼å¼ä¸ºePub"></a>è®¾ç½®è¾“å‡ºæ ¼å¼ä¸ºePub</h5><ul><li><p>Cabler â€”â€”&gt; Preferences â€”â€”&gt; Behavior</p><p><img src="https://img.i7years.com/bolg/calibre6.png" alt=""></p></li></ul><h5 id="è®¾ç½®è‡ªåŠ¨åŠ è½½Kindleç”µå­ä¹¦å¹¶è‡ªåŠ¨è½¬åŒ–"><a href="#è®¾ç½®è‡ªåŠ¨åŠ è½½Kindleç”µå­ä¹¦å¹¶è‡ªåŠ¨è½¬åŒ–" class="headerlink" title="è®¾ç½®è‡ªåŠ¨åŠ è½½Kindleç”µå­ä¹¦å¹¶è‡ªåŠ¨è½¬åŒ–"></a>è®¾ç½®è‡ªåŠ¨åŠ è½½Kindleç”µå­ä¹¦å¹¶è‡ªåŠ¨è½¬åŒ–</h5><ul><li><p>Calibre â€”â€”&gt; Preferences â€”â€”&gt; Adding books â€”â€”&gt; The Add Process</p><p><img src="https://img.i7years.com/bolg/calibre3.png" alt=""></p><p><img src="https://img.i7years.com/bolg/calibre4.png" alt=""></p></li><li><p>Calibre â€”â€”&gt; Preferences â€”â€”&gt; Adding books â€”â€”&gt; Automatic Adding</p><p>é€‰æ‹©Calibreè¦è‡ªåŠ¨åŠ è½½Kindleç”µå­ä¹¦ç›®å½•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨ <strong>Step2</strong> ä¸­è®¾ç½®çš„å¤åˆ¶ç›®å½• Kindle4MacItmes</p><blockquote><p>CalibreåŠ è½½Kindleç”µå­ä¹¦åä¼šè‡ªåŠ¨åˆ é™¤æºç›®å½•ä¸‹çš„ç”µå­ä¹¦ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ä½¿ç”¨Automatorå°†Kindle for Mac ä¸‹çš„ç”µå­ä¹¦å¤åˆ¶åˆ°ä¸€ä¸ªæ–°çš„ç›®å½• Kindle4MacItems ä¸‹çš„åŸå› </p></blockquote><p><img src="https://img.i7years.com/bolg/calibre5.png" alt=""></p></li></ul><h4 id="Step-5-ä½¿ç”¨iBooksæ‰“å¼€-Calibre-Library-ä¸‹ePubç”µå­ä¹¦"><a href="#Step-5-ä½¿ç”¨iBooksæ‰“å¼€-Calibre-Library-ä¸‹ePubç”µå­ä¹¦" class="headerlink" title="Step 5. ä½¿ç”¨iBooksæ‰“å¼€ Calibre Library ä¸‹ePubç”µå­ä¹¦"></a>Step 5. ä½¿ç”¨iBooksæ‰“å¼€ Calibre Library ä¸‹ePubç”µå­ä¹¦</h4><p>åªæœ‰è¿™ä¸€æ­¥æ˜¯éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»å®Œæˆçš„ï¼Œä½¿ç”¨ iBooks æ‰“å¼€è½¬åŒ–åçš„ePubï¼Œä½ ä¼šå‘ç°æ–‡å­—æ’ç‰ˆã€å›¾ç‰‡ã€è¡¨æ ¼ç­‰æ ¼å¼éƒ½ä¸Kindleç”µå­ä¹¦ä¸€æ¨¡ä¸€æ ·ã€‚</p><p>å—¯ï¼Œå°±è¿™æ ·ï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚</p><h3 id="å£°æ˜"><a href="#å£°æ˜" class="headerlink" title="å£°æ˜"></a>å£°æ˜</h3><p>DeDRM æ˜¯ä¸ºäº†ä¹°æ¥ä¹¦åè‡ªå·±ç”¨çš„æ›´æ–¹ä¾¿ï¼Œè¯·ä¸è¦ä¼ æ’­ç›—ç‰ˆâ€¦â€¦</p><blockquote><p>å‚è€ƒï¼š<a href="http://j4n.co/blog/kindle_to_ibooks" target="_blank" rel="noopener">http://j4n.co/blog/kindle_to_ibooks</a></p></blockquote>]]></content>
      
        <categories>
            
            <category> tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Kindle </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[DockeråŒ–Javaåº”ç”¨ç¨‹åº]]></title>
      <url>/posts/dockerized-your-java-application.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>å½“ä½ å¯¹Javaåº”ç”¨ç¨‹åºè¿›è¡Œå®¹å™¨åŒ–æ“ä½œæ—¶ï¼ŒDockerfile æ–‡ä»¶æ˜¯ä½ è¦ç”¨åˆ°çš„åŸºç¡€ç»„ä»¶ã€‚</p><a id="more"></a><h2 id="DockerfileæŒ‡ä»¤ä»‹ç»"><a href="#DockerfileæŒ‡ä»¤ä»‹ç»" class="headerlink" title="DockerfileæŒ‡ä»¤ä»‹ç»"></a>DockerfileæŒ‡ä»¤ä»‹ç»</h2><p>è¿™éƒ¨åˆ†å†…å®¹è¯·æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/builder/</a></p><h2 id="ä¸ºç®€å•çš„Javaå·¥ç¨‹ç¼–å†™Dockerfile"><a href="#ä¸ºç®€å•çš„Javaå·¥ç¨‹ç¼–å†™Dockerfile" class="headerlink" title="ä¸ºç®€å•çš„Javaå·¥ç¨‹ç¼–å†™Dockerfile"></a>ä¸ºç®€å•çš„Javaå·¥ç¨‹ç¼–å†™Dockerfile</h2><p>ç”±äº <a href="https://hub.docker.com/_/openjdk/" target="_blank" rel="noopener">å®˜æ–¹</a> å·²ç»æœ‰äº†OpenJDK é•œåƒï¼Œå› æ­¤æˆ‘ä»¬ä¸éœ€è¦ä¸º OpenJDK å†å†™ä¸€ä¸ªDockerfileã€‚</p><p>æˆ‘ä»¬è¿™é‡Œæ¥ä¸º OracleJDK åˆ›å»ºä¸€ä¸ªDockerfileï¼Œè¿™ä¸ªå®˜æ–¹å¹¶æœªæä¾›ã€‚</p><h3 id="ç¼–å†™Dockerfile"><a href="#ç¼–å†™Dockerfile" class="headerlink" title="ç¼–å†™Dockerfile"></a>ç¼–å†™Dockerfile</h3><p>æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸­æ–°å»ºä¸€ä¸ªåä¸º Dockerfile çš„æ–‡ä»¶ï¼Œé‡Œé¢å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Dockerfile</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span>  phusion/baseimage:<span class="number">0.9</span>.<span class="number">17</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">MAINTAINER</span>  Author Name &lt;author@email.com&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span> echo "deb http://archive.ubuntu.com/ubuntu trusty main universe" &gt; /etc/apt/sources.list</span><br><span class="line"></span><br><span class="line">RUN apt-get -y update</span><br><span class="line"></span><br><span class="line">RUN DEBIAN_FRONTEND=noninteractive apt-get install -y -q python-software-properties software-properties-common</span><br><span class="line"></span><br><span class="line">ENV JAVA_VER 8</span><br><span class="line">ENV JAVA_HOME /usr/lib/jvm/java-8-oracle</span><br><span class="line"></span><br><span class="line">RUN echo 'deb http://ppa.launchpad.net/webupd8team/java/ubuntu trusty main' &gt;&gt; /etc/apt/sources.list &amp;&amp; \</span><br><span class="line">    echo 'deb-src http://ppa.launchpad.net/webupd8team/java/ubuntu trusty main' &gt;&gt; /etc/apt/sources.list &amp;&amp; \</span><br><span class="line">    apt-key adv --keyserver keyserver.ubuntu.com --recv-keys C2518248EEA14886 &amp;&amp; \</span><br><span class="line">    apt-get update &amp;&amp; \</span><br><span class="line">    echo oracle-java$&#123;JAVA_VER&#125;-installer shared/accepted-oracle-license-v1-1 select true | sudo /usr/bin/debconf-set-selections &amp;&amp; \</span><br><span class="line">    apt-get install -y --force-yes --no-install-recommends oracle-java$&#123;JAVA_VER&#125;-installer oracle-java$&#123;JAVA_VER&#125;-set-default &amp;&amp; \</span><br><span class="line">    apt-get clean &amp;&amp; \</span><br><span class="line">    rm -rf /var/cache/oracle-jdk$&#123;JAVA_VER&#125;-installer</span><br><span class="line"></span><br><span class="line">RUN update-java-alternatives -s java-8-oracle</span><br><span class="line"></span><br><span class="line">RUN echo "export JAVA_HOME=/usr/lib/jvm/java-8-oracle" &gt;&gt; ~/.bashrc</span><br><span class="line"></span><br><span class="line">RUN apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*</span><br><span class="line"></span><br><span class="line">CMD ["/sbin/my_init"]</span><br></pre></td></tr></table></figure><h4 id="è®¾ç½®åŸºç¡€é•œåƒä¸ä½œè€…"><a href="#è®¾ç½®åŸºç¡€é•œåƒä¸ä½œè€…" class="headerlink" title="è®¾ç½®åŸºç¡€é•œåƒä¸ä½œè€…"></a>è®¾ç½®åŸºç¡€é•œåƒä¸ä½œè€…</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Dockerfile</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span>  phusion/baseimage:<span class="number">0.9</span>.<span class="number">17</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">MAINTAINER</span>  Author Name &lt;author@email.com&gt;</span><br></pre></td></tr></table></figure><h4 id="æ›´æ–°Ubuntuæºåœ°å€"><a href="#æ›´æ–°Ubuntuæºåœ°å€" class="headerlink" title="æ›´æ–°Ubuntuæºåœ°å€"></a>æ›´æ–°Ubuntuæºåœ°å€</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span> echo "deb http://archive.ubuntu.com/ubuntu trusty main universe" &gt; /etc/apt/sources.list</span><br><span class="line"></span><br><span class="line">RUN apt-get -y update</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…python-software-properties"><a href="#å®‰è£…python-software-properties" class="headerlink" title="å®‰è£…python-software-properties"></a>å®‰è£…python-software-properties</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span> DEBIAN_FRONTEND=noninteractive apt-get install -y -q python-software-properties software-properties-common</span><br></pre></td></tr></table></figure><h5 id="å®‰è£…Oracle-Java-8"><a href="#å®‰è£…Oracle-Java-8" class="headerlink" title="å®‰è£…Oracle Java 8"></a>å®‰è£…Oracle Java 8</h5><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> JAVA_VER <span class="number">8</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_HOME /usr/lib/jvm/java-<span class="number">8</span>-oracle</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span> echo 'deb http://ppa.launchpad.net/webupd8team/java/ubuntu trusty main' &gt;&gt; /etc/apt/sources.list &amp;&amp; \</span><br><span class="line">    echo 'deb-src http://ppa.launchpad.net/webupd8team/java/ubuntu trusty main' &gt;&gt; /etc/apt/sources.list &amp;&amp; \</span><br><span class="line">    apt-key adv --keyserver keyserver.ubuntu.com --recv-keys C2518248EEA14886 &amp;&amp; \</span><br><span class="line">    apt-get update &amp;&amp; \</span><br><span class="line">    echo oracle-java$&#123;JAVA_VER&#125;-installer shared/accepted-oracle-license-v1-1 select true | sudo /usr/bin/debconf-set-selections &amp;&amp; \</span><br><span class="line">    apt-get install -y --force-yes --no-install-recommends oracle-java$&#123;JAVA_VER&#125;-installer oracle-java$&#123;JAVA_VER&#125;-set-default &amp;&amp; \</span><br><span class="line">    apt-get clean &amp;&amp; \</span><br><span class="line">    rm -rf /var/cache/oracle-jdk$&#123;JAVA_VER&#125;-installer</span><br></pre></td></tr></table></figure><h4 id="è®¾ç½®Oracle-Javaä¸ºé»˜è®¤"><a href="#è®¾ç½®Oracle-Javaä¸ºé»˜è®¤" class="headerlink" title="è®¾ç½®Oracle Javaä¸ºé»˜è®¤"></a>è®¾ç½®Oracle Javaä¸ºé»˜è®¤</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span> update-java-alternatives -s java-8-oracle</span><br><span class="line"></span><br><span class="line">RUN echo "export JAVA_HOME=/usr/lib/jvm/java-8-oracle" &gt;&gt; ~/.bashrc</span><br></pre></td></tr></table></figure><h4 id="æ¸…é™¤APT"><a href="#æ¸…é™¤APT" class="headerlink" title="æ¸…é™¤APT"></a>æ¸…é™¤APT</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span> apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*</span><br></pre></td></tr></table></figure><h5 id="ä½¿ç”¨åˆå§‹åŒ–ç³»ç»Ÿ"><a href="#ä½¿ç”¨åˆå§‹åŒ–ç³»ç»Ÿ" class="headerlink" title="ä½¿ç”¨åˆå§‹åŒ–ç³»ç»Ÿ"></a>ä½¿ç”¨åˆå§‹åŒ–ç³»ç»Ÿ</h5><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CMD</span> ["/sbin/my_init"]</span><br></pre></td></tr></table></figure><h3 id="æ„å»ºé•œåƒ"><a href="#æ„å»ºé•œåƒ" class="headerlink" title="æ„å»ºé•œåƒ"></a>æ„å»ºé•œåƒ</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -f Dockerfile -t demo/oracle-java:<span class="number">8</span> .</span><br></pre></td></tr></table></figure><blockquote><p><code>-f</code>: æŒ‡å®šDockerfile</p><p><code>-t</code>: æŒ‡å®šé•œåƒåç§°ã€‚<code>demo/oracle-java</code>ä¸ºåç§°ï¼Œå†’å·åé¢çš„ <code>8</code> ä¸ºæ ‡ç­¾æˆ–ç‰ˆæœ¬</p><p><code>.</code>: æŒ‡å®šä¸ºå½“å‰ç›®å½•ã€‚å½“å‰ç›®å½•çš„æ–‡ä»¶å’Œç›®å½•å°†ä½œä¸ºæ„å»ºå·¥ä»¶å‘é€åˆ°Dockerå®ˆæŠ¤ç¨‹åºä¸­å»ã€‚</p></blockquote><h3 id="æµ‹è¯•é•œåƒ"><a href="#æµ‹è¯•é•œåƒ" class="headerlink" title="æµ‹è¯•é•œåƒ"></a>æµ‹è¯•é•œåƒ</h3><p>åœ¨å‰é¢çš„ç›®å½•ä¸­ï¼Œæ–°å¢ä¸€ä¸ªjavaæ–‡ä»¶ <code>Main.java</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Hello, World"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --rm -v <span class="variable">$PWD:</span>/app -w /app demo/oracle-java:<span class="number">8</span> javac Main.java</span><br></pre></td></tr></table></figure><h4 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --rm -v <span class="variable">$PWD:</span>/app -w /app demo/oracle-java:<span class="number">8</span> java Main</span><br></pre></td></tr></table></figure><p>å‡ºç° <code>Hello, World</code> åˆ™è¡¨ç¤ºæˆåŠŸã€‚</p><p>å¦‚æœä½ æƒ³ä½¿ç”¨å®˜æ–¹çš„ OpenJDK æ¥è¿è¡Œä½ çš„ä»£ç ï¼Œå¹¶ä¸éœ€è¦é‡æ–°ç¼–å†™ä¸€ä¸ªDockerfileï¼Œåªéœ€è¦æŒ‡å®šä¸€ä¸‹å³å¯ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --rm -v <span class="variable">$PWD:</span>/app -w /app java:<span class="number">8</span> javac Main.java</span><br><span class="line"></span><br><span class="line">$ docker run --rm -v <span class="variable">$PWD:</span>/app -w /app java:<span class="number">8</span> java Main</span><br></pre></td></tr></table></figure><h2 id="ä¸ºMavenå·¥ç¨‹ç¼–å†™Dockerfile"><a href="#ä¸ºMavenå·¥ç¨‹ç¼–å†™Dockerfile" class="headerlink" title="ä¸ºMavenå·¥ç¨‹ç¼–å†™Dockerfile"></a>ä¸ºMavenå·¥ç¨‹ç¼–å†™Dockerfile</h2><p>å¦‚æœæ‚¨å°†OpenJDKä¸Mavenä¸€èµ·ä½¿ç”¨ï¼Œåˆ™ä¸ä¸€å®šéœ€è¦ç¼–å†™Dockerfileï¼Œå› ä¸ºæ‚¨å¯ä»¥ä½¿ç”¨å®˜æ–¹Docker Hubå­˜å‚¨åº“çš„Mavenç‰ˆæœ¬ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ‚¨å°†Oracle JDKä¸Mavenä¸€èµ·ä½¿ç”¨ï¼Œåˆ™éœ€è¦ç¼–å†™è‡ªå·±çš„Dockerfileã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨ä¸Šé¢æ„å»ºå¥½çš„ <code>demo/oracle-jdk:8</code> é•œåƒä½œä¸ºæˆ‘ä»¬è¿™ä¸€æ­¥çš„åŸºç¡€é•œåƒã€‚</p><h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Dockerfile</span></span><br><span class="line"><span class="keyword">FROM</span> demo/oracle-java:<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> MAVEN_VERSION <span class="number">3.5</span>.<span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span> mkdir -p /usr/share/maven \</span><br><span class="line">  &amp;&amp; curl -fsSL http://apache.osuosl.org/maven/maven-3/$MAVEN_VERSION/binaries/apache-maven-$MAVEN_VERSION-bin.tar.gz \</span><br><span class="line">    | tar -xzC /usr/share/maven --strip-components=1 \</span><br><span class="line">  &amp;&amp; ln -s /usr/share/maven/bin/mvn /usr/bin/mvn</span><br><span class="line"></span><br><span class="line">ENV MAVEN_HOME /usr/share/maven</span><br><span class="line"></span><br><span class="line">VOLUME /root/.m2</span><br><span class="line"></span><br><span class="line">CMD ["mvn"]</span><br></pre></td></tr></table></figure><h3 id="æ„å»ºDockeré•œåƒ"><a href="#æ„å»ºDockeré•œåƒ" class="headerlink" title="æ„å»ºDockeré•œåƒ"></a>æ„å»ºDockeré•œåƒ</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -f Dockerfile -t demo/maven:<span class="number">3.5</span>-jdk-<span class="number">8</span> .</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm -v <span class="string">"<span class="variable">$PWD</span>"</span>:/app -w /app demo/maven:<span class="number">3.5</span>-jdk-<span class="number">8</span> mvn archetype:generate -DgroupId=com.mycompany.app -DartifactId=my-app -DarchetypeArtifactId=maven-archetype-quickstart -Dinte</span><br></pre></td></tr></table></figure><p>å½“å‰ç›®å½•ä¸‹å°†ä¼šåˆ›å»ºä¸€ä¸ª my-app ç›®å½•ï¼Œé‡Œé¢ä¼šæœ‰ä¸€ä¸ªæˆ‘ä»¬åˆ›å»ºçš„mavenå·¥ç¨‹</p><h3 id="æ„å»ºMavenå·¥ç¨‹"><a href="#æ„å»ºMavenå·¥ç¨‹" class="headerlink" title="æ„å»ºMavenå·¥ç¨‹"></a>æ„å»ºMavenå·¥ç¨‹</h3><p>è¿›å…¥å·¥ç¨‹ç›®å½•:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cd  my-app</span><br></pre></td></tr></table></figure><p>æ„å»ºå·¥ç¨‹:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm -v <span class="string">"<span class="variable">$PWD</span>"</span>:/app -w /app demo/maven:<span class="number">3.5</span>-jdk-<span class="number">8</span> mvn package</span><br></pre></td></tr></table></figure><p>æµ‹è¯•JARåŒ…:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm -v <span class="string">"<span class="variable">$PWD</span>"</span>:/app -w /app demo/maven:<span class="number">3.5</span>-jdk-<span class="number">8</span> java -cp target/my-app-<span class="number">1.0</span>-SNAPSHOT.jar com.mycompany.app.App</span><br></pre></td></tr></table></figure><p>æ­£ç¡®è¾“å‡º:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello World!</span><br></pre></td></tr></table></figure><h2 id="ä¸ºSpringMVCåº”ç”¨ç¼–å†™Dockerfile"><a href="#ä¸ºSpringMVCåº”ç”¨ç¼–å†™Dockerfile" class="headerlink" title="ä¸ºSpringMVCåº”ç”¨ç¼–å†™Dockerfile"></a>ä¸ºSpringMVCåº”ç”¨ç¼–å†™Dockerfile</h2><p>åŸºäºSpringçš„åº”ç”¨ç¨‹åºçš„DockeråŒ–æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><ul><li>ä½¿ç”¨å·²ç»å­˜åœ¨çš„Maven-baseé•œåƒä½œä¸ºåŸºç¡€é•œåƒï¼Œå¹¶ä¸”å®‰è£…Tomcatï¼Œè¿è¡Œwebç¨‹åºã€‚</li><li>ä½¿ç”¨å·²ç»å­˜åœ¨çš„Maven-baseé•œåƒæ¥ç¼–è¯‘å’Œæ‰“åŒ…åº”ç”¨ç¨‹åºã€‚ç„¶åä½¿ç”¨å¦ä¸€ä¸ªTomcat-base Dockerå®¹å™¨æ¥éƒ¨ç½²è¿™ä¸ªåº”ç”¨ã€‚</li></ul><p>ä¸‹é¢æˆ‘ä»¬æ¥åˆ†åˆ«ä»‹ç»ä¸€ä¸‹è¿™ä¸¤ç§æ–¹æ³•.</p><h3 id="åŸºäºMave-baseé•œåƒå®‰è£…Tomcat"><a href="#åŸºäºMave-baseé•œåƒå®‰è£…Tomcat" class="headerlink" title="åŸºäºMave-baseé•œåƒå®‰è£…Tomcat"></a>åŸºäºMave-baseé•œåƒå®‰è£…Tomcat</h3><p>æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ŒåŒæ—¶æ–°å»ºä¸€ä¸ªDockerfileæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Dockerfile</span></span><br><span class="line"><span class="keyword">FROM</span> demo/maven:<span class="number">3.5</span>-jdk-<span class="number">8</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> Wangwei &lt;w7years@gmail.com&gt;</span><br><span class="line"><span class="keyword">RUN</span> apt-get update &amp;&amp; \</span><br><span class="line">    apt-get install -yq --no-install-recommends wget pwgen ca-certificates &amp;&amp; \</span><br><span class="line">    apt-get clean &amp;&amp; \</span><br><span class="line">    rm -rf /var/lib/apt/lists/*</span><br><span class="line">ENV TOMCAT_MAJOR_VERSION 8</span><br><span class="line">ENV TOMCAT_MINOR_VERSION 8.5.33</span><br><span class="line">ENV CATALINA_HOME /tomcat</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…Tomcat"><a href="#å®‰è£…Tomcat" class="headerlink" title="å®‰è£…Tomcat"></a>å®‰è£…Tomcat</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span> wget -q https://archive.apache.org/dist/tomcat/tomcat-$&#123;TOMCAT_MAJOR_VERSION&#125;/v$&#123;TOMCAT_MINOR_VERSION&#125;/bin/apache-tomcat-$&#123;TOMCAT_MINOR_VERSION&#125;.tar.gz &amp;&amp; \</span><br><span class="line">	wget -qO- https://archive.apache.org/dist/tomcat/tomcat-$&#123;TOMCAT_MAJOR_VERSION&#125;/v$&#123;TOMCAT_MINOR_VERSION&#125;/bin/apache-tomcat-$&#123;TOMCAT_MINOR_VERSION&#125;.tar.gz.md5 | md5sum -c - &amp;&amp; \</span><br><span class="line">	tar zxf apache-tomcat-*.tar.gz &amp;&amp; \</span><br><span class="line"> 	rm apache-tomcat-*.tar.gz &amp;&amp; \</span><br><span class="line"> 	mv apache-tomcat* tomcat</span><br><span class="line"></span><br><span class="line">ADD create_tomcat_admin_user.sh /create_tomcat_admin_user.sh</span><br><span class="line">RUN mkdir /etc/service/tomcat</span><br><span class="line">ADD run.sh /etc/service/tomcat/run</span><br><span class="line">RUN chmod +x /*.sh</span><br><span class="line">RUN chmod +x /etc/service/tomcat/run</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨baseimage-dockerçš„initç³»ç»Ÿ"><a href="#ä½¿ç”¨baseimage-dockerçš„initç³»ç»Ÿ" class="headerlink" title="ä½¿ç”¨baseimage-dockerçš„initç³»ç»Ÿ"></a>ä½¿ç”¨baseimage-dockerçš„initç³»ç»Ÿ</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CMD</span> ["/sbin/my_init"]</span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºTomcat-ç®¡ç†å‘˜"><a href="#åˆ›å»ºTomcat-ç®¡ç†å‘˜" class="headerlink" title="åˆ›å»ºTomcat ç®¡ç†å‘˜"></a>åˆ›å»ºTomcat ç®¡ç†å‘˜</h4><p>åœ¨ç›¸åŒçš„ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª <code>create_tomcat_admin_user.sh</code> æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">!/bin/bash</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f /.tomcat_admin_created ]; then</span><br><span class="line">    echo <span class="string">"Tomcat 'admin' user already created"</span></span><br><span class="line">    <span class="keyword">exit</span> <span class="number">0</span></span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h4 id="ç”Ÿæˆå¯†ç "><a href="#ç”Ÿæˆå¯†ç " class="headerlink" title="ç”Ÿæˆå¯†ç "></a>ç”Ÿæˆå¯†ç </h4><p>æ·»åŠ ä»¥ä¸‹è„šæœ¬ç”¨äºç”Ÿæˆå¯†ç ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">PASS=$&#123;TOMCAT_PASS:-$(pwgen -s <span class="number">12</span> <span class="number">1</span>)&#125;</span><br><span class="line">_word=$( [ $&#123;TOMCAT_PASS&#125; ] &amp;&amp; echo <span class="string">"preset"</span> || echo <span class="string">"random"</span> )</span><br><span class="line"></span><br><span class="line">echo <span class="string">"=&gt; Creating an admin user with a $&#123;_word&#125; password in Tomcat"</span></span><br><span class="line">sed -i -r <span class="string">'s/&lt;\/tomcat-users&gt;//'</span> $&#123;CATALINA_HOME&#125;/conf/tomcat-users.xml</span><br><span class="line">echo <span class="string">'&lt;role rolename="manager-gui"/&gt;'</span> &gt;&gt; $&#123;CATALINA_HOME&#125;/conf/tomcat-users.xml</span><br><span class="line">echo <span class="string">'&lt;role rolename="manager-script"/&gt;'</span> &gt;&gt; $&#123;CATALINA_HOME&#125;/conf/tomcat-users.xml</span><br><span class="line">echo <span class="string">'&lt;role rolename="manager-jmx"/&gt;'</span> &gt;&gt; $&#123;CATALINA_HOME&#125;/conf/tomcat-users.xml</span><br><span class="line">echo <span class="string">'&lt;role rolename="admin-gui"/&gt;'</span> &gt;&gt; $&#123;CATALINA_HOME&#125;/conf/tomcat-users.xml</span><br><span class="line">echo <span class="string">'&lt;role rolename="admin-script"/&gt;'</span> &gt;&gt; $&#123;CATALINA_HOME&#125;/conf/tomcat-users.xml</span><br><span class="line">echo <span class="string">"&lt;user username=\"</span>admin\<span class="string">" password=\"</span>$&#123;PASS&#125;\<span class="string">" roles=\"</span>manager-gui,manager-script,manager-jmx,admin-gui, admin-script\<span class="string">"/&gt;"</span> &gt;&gt; $&#123;CATALINA_HOME&#125;/conf/tomcat-users.xml</span><br><span class="line">echo <span class="string">'&lt;/tomcat-users&gt;'</span> &gt;&gt; $&#123;CATALINA_HOME&#125;/conf/tomcat-users.xml</span><br><span class="line">echo <span class="string">"=&gt; Done!"</span></span><br><span class="line">touch /.tomcat_admin_created</span><br><span class="line"></span><br><span class="line">echo <span class="string">"========================================================================"</span></span><br><span class="line">echo <span class="string">"You can now configure to this Tomcat server using:"</span></span><br><span class="line">echo <span class="string">""</span></span><br><span class="line">echo <span class="string">"    admin:$&#123;PASS&#125;"</span></span><br><span class="line">echo <span class="string">""</span></span><br><span class="line">echo <span class="string">"========================================================================"</span></span><br></pre></td></tr></table></figure><p><code>create_tomcat_admin_user.sh</code> ç”¨äºåˆ›å»ºTomcatç®¡ç†å‘˜ã€‚å¦å¤–åœ¨åˆ›å»ºä¸€ä¸ª <code>run.sh</code> æ–‡ä»¶ï¼Œç”¨äºæ‰§è¡Œ <code>create_tomcat_admin_user.sh</code> å¹¶reload Tomcat ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">!/bin/bash</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -f /.tomcat_admin_created ]; then</span><br><span class="line">    /create_tomcat_admin_user.sh</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">exec $&#123;CATALINA_HOME&#125;/bin/catalina.sh run</span><br></pre></td></tr></table></figure><h4 id="æ„å»ºDockeré•œåƒ-1"><a href="#æ„å»ºDockeré•œåƒ-1" class="headerlink" title="æ„å»ºDockeré•œåƒ"></a>æ„å»ºDockeré•œåƒ</h4><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ„å»ºdockeré•œåƒï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -f Dockerfile -t demo/spring:maven-<span class="number">3.5</span>-jdk-<span class="number">8</span> .</span><br></pre></td></tr></table></figure><p>cloneæµ‹è¯•å·¥ç¨‹</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone  https://github.com/atifsaddique211f/spring-maven-sample.git</span><br></pre></td></tr></table></figure><p>æ„å»ºå¹¶æ‰“åŒ…å·¥ç¨‹</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd spring-maven-sample</span><br><span class="line">$ docker run -it --rm -v <span class="string">"<span class="variable">$PWD</span>"</span>:/app -w /app demo/spring:maven-<span class="number">3.5</span>-jdk-<span class="number">8</span> mvn clean install</span><br></pre></td></tr></table></figure><p>è¯¥æ­¥éª¤å°†ä¼šç”Ÿæˆä¸€ä¸ªwaråŒ…ï¼š<code>target/springwebapp.war</code></p><p>copyè¿™ä¸ªwaråŒ…åˆ°Tomcat webapps ç›®å½•ä¸‹</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it -d --name spring -p <span class="number">8080</span>:<span class="number">8080</span> -v <span class="string">"<span class="variable">$PWD</span>"</span>:/app demo/spring:maven-<span class="number">3.5</span>-jdk-<span class="number">8</span> bash -c <span class="string">"cp /app/target/springwebapp.war /tomcat/webapps/ &amp; /tomcat/bin/catalina.sh run"</span></span><br></pre></td></tr></table></figure><p>è¿è¡ŒæˆåŠŸï¼Œè®¿é—®ï¼š<a href="http://localhost:8080/springwebapp/car/add" target="_blank" rel="noopener">http://localhost:8080/springwebapp/car/add</a></p><p>åœæ­¢Spring</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker rm -vf spring</span><br></pre></td></tr></table></figure><h3 id="åœ¨ä¸åŒçš„Tomcaté•œåƒä¸­è¿è¡ŒSpring-Appç¨‹åº"><a href="#åœ¨ä¸åŒçš„Tomcaté•œåƒä¸­è¿è¡ŒSpring-Appç¨‹åº" class="headerlink" title="åœ¨ä¸åŒçš„Tomcaté•œåƒä¸­è¿è¡ŒSpring Appç¨‹åº"></a>åœ¨ä¸åŒçš„Tomcaté•œåƒä¸­è¿è¡ŒSpring Appç¨‹åº</h3><p>clone springå·¥ç¨‹ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone  https://github.com/atifsaddique211f/spring-maven-sample.git</span><br></pre></td></tr></table></figure><p>åˆ›å»ºDockerfile</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Dockerfile</span></span><br><span class="line">FROM tomcat:<span class="number">8</span></span><br><span class="line"></span><br><span class="line">ADD target/*.war /usr/local/tomcat/webapps/</span><br></pre></td></tr></table></figure><p>æ„å»ºå¹¶æ‰“åŒ…å·¥ç¨‹</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm -v <span class="string">"<span class="variable">$PWD</span>"</span>:/app -w /app demo/maven:<span class="number">3.5</span>-jdk-<span class="number">8</span> mvn clean install</span><br></pre></td></tr></table></figure><p>æ„å»ºDockerfile</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -f Dockerfile -t demo/tomcat:<span class="number">8</span> .</span><br></pre></td></tr></table></figure><p>è¿è¡ŒTomcat</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --rm -p <span class="number">8080</span>:<span class="number">8080</span> demo/tomcat:<span class="number">8</span></span><br></pre></td></tr></table></figure><p><code>Ctrl + C</code> åœæ­¢åº”ç”¨ç¨‹åº</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><p><a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/builder/</a></p></li><li><p><a href="https://github.com/miguno/java-docker-build-tutorial" target="_blank" rel="noopener">https://github.com/miguno/java-docker-build-tutorial</a></p></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Dockerå¸¸ç”¨å‘½ä»¤æ•´ç†]]></title>
      <url>/posts/docker-common-commands.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>æ”¶é›†æ•´ç†å¸¸ç”¨çš„Dockerå‘½ä»¤ã€‚</p><a id="more"></a><h2 id="å®¹å™¨ç±»"><a href="#å®¹å™¨ç±»" class="headerlink" title="å®¹å™¨ç±»"></a>å®¹å™¨ç±»</h2><h3 id="æŸ¥çœ‹DockeråŸºç¡€ä¿¡æ¯"><a href="#æŸ¥çœ‹DockeråŸºç¡€ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹DockeråŸºç¡€ä¿¡æ¯"></a>æŸ¥çœ‹DockeråŸºç¡€ä¿¡æ¯</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹dockerç‰ˆæœ¬</span></span><br><span class="line">$ docker version</span><br><span class="line"><span class="comment"># æ˜¾ç¤ºdockerç³»ç»Ÿçš„ä¿¡æ¯</span></span><br><span class="line">$ docker info</span><br></pre></td></tr></table></figure><h3 id="å®¹å™¨æ“ä½œ"><a href="#å®¹å™¨æ“ä½œ" class="headerlink" title="å®¹å™¨æ“ä½œ"></a>å®¹å™¨æ“ä½œ</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢è¿è¡Œä¸­çš„å®¹å™¨</span></span><br><span class="line">$ docker ps </span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨</span></span><br><span class="line">$ docker ps -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨|åœæ­¢|é‡å¯|æ€æ­»å®¹å™¨ anyesu-container</span></span><br><span class="line">$ docker start | stop | restart | kill anyesu-container</span><br><span class="line"></span><br><span class="line"><span class="comment"># - docker rm [OPTIONS] CONTAINER [CONTAINER...]</span></span><br><span class="line"><span class="comment"># åˆ é™¤Idä¸ºc6e7471292e0çš„å®¹å™¨</span></span><br><span class="line">$ docker rm c6e7471292e0</span><br><span class="line"></span><br><span class="line"><span class="comment"># - docker inspect [OPTIONS] NAME|ID [NAME|ID...]</span></span><br><span class="line"><span class="comment"># æ£€è§†Idä¸º97763bd57c69çš„å®¹å™¨</span></span><br><span class="line">$ docker inspect <span class="number">97763</span>bd57c69</span><br><span class="line"></span><br><span class="line"><span class="comment"># - docker top CONTAINER [ps OPTIONS]</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å®¹å™¨ä¸­æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹</span></span><br><span class="line">$ docker top <span class="number">97763</span>bd57c69</span><br><span class="line"></span><br><span class="line"><span class="comment"># - docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]</span></span><br><span class="line"><span class="comment"># ä¿å­˜å®¹å™¨ä¸ºé•œåƒ</span></span><br><span class="line">$ docker commit tomcat wangwei01/tomcat:<span class="number">1.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¹æ®Dockerfile æ„å»º</span></span><br><span class="line">$ docker build -t [image_name] [Dockerfile_path]</span><br></pre></td></tr></table></figure><h3 id="äº¤äº’å¼è¿›å…¥å®¹å™¨"><a href="#äº¤äº’å¼è¿›å…¥å®¹å™¨" class="headerlink" title="äº¤äº’å¼è¿›å…¥å®¹å™¨"></a>äº¤äº’å¼è¿›å…¥å®¹å™¨</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker exec -it &#123;&#123;containerName or containerID&#125;&#125; bash</span><br><span class="line">$ docker exec -i  &#123;&#123;containerName or containerID&#125;&#125; bash</span><br><span class="line">$ docker exec -t  &#123;&#123;containerName or containerID&#125;&#125; bash</span><br><span class="line">$ docker exec -d  &#123;&#123;containerName or containerID&#125;&#125; bash</span><br></pre></td></tr></table></figure><blockquote><ul><li>åªç”¨ <code>-i</code> å‚æ•°ï¼Œç”±äºæ²¡æœ‰åˆ†é…ä¼ªç»ˆç«¯ï¼Œçœ‹èµ·æ¥åƒpipeæ‰§è¡Œä¸€æ ·ã€‚ä½†æ˜¯æ‰§è¡Œç»“æœã€å‘½ä»¤è¿”å›å€¼éƒ½å¯ä»¥æ­£ç¡®è·å–</li><li>åªç”¨ <code>-t</code> å‚æ•°ï¼Œåˆ™å¯ä»¥çœ‹åˆ°ä¸€ä¸ª console çª—å£ï¼Œä½†æ˜¯æ‰§è¡Œå‘½ä»¤ä¼šå‘ç°ç”±äºæ²¡æœ‰è·å¾—stdinçš„è¾“å‡ºï¼Œæ— æ³•çœ‹åˆ°å‘½ä»¤æ‰§è¡Œæƒ…å†µ</li><li>ä½¿ç”¨ <code>-it</code> æ—¶ï¼Œåˆ™å’Œæˆ‘ä»¬å¹³å¸¸æ“ä½œ console ç•Œé¢ç±»ä¼¼ï¼Œè€Œä¸”ä¹Ÿ<code>ä¸ä¼šåƒattachæ–¹å¼å› ä¸ºé€€å‡ºï¼Œå¯¼è‡´æ•´ä¸ªå®¹å™¨é€€å‡º</code></li><li>ä½¿ç”¨ <code>-d</code> å‚æ•°ï¼Œåœ¨åå°æ‰§è¡Œä¸€ä¸ªè¿›ç¨‹ã€‚å¦‚æœä¸€ä¸ªå‘½ä»¤éœ€è¦é•¿æ—¶é—´è¿›ç¨‹ï¼Œä¼šå¾ˆå¿«è¿”å›</li></ul></blockquote><h3 id="Docker-run"><a href="#Docker-run" class="headerlink" title="Docker run"></a>Docker run</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</span><br></pre></td></tr></table></figure><h4 id="runå‘½ä»¤é€‰é¡¹"><a href="#runå‘½ä»¤é€‰é¡¹" class="headerlink" title="runå‘½ä»¤é€‰é¡¹"></a>runå‘½ä»¤é€‰é¡¹</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">Options:</span><br><span class="line">      --add-host list                  Add a custom host-to-IP mapping (host:ip)</span><br><span class="line">  -a, --attach list                    Attach to STDIN, STDOUT or STDERR</span><br><span class="line">      --blkio-weight uint16            Block IO (relative weight), between <span class="number">10</span> and <span class="number">1000</span>, or <span class="number">0</span> to disable (default <span class="number">0</span>)</span><br><span class="line">      --blkio-weight-device list       Block IO weight (relative device weight) (default [])</span><br><span class="line">      --cap-add list                   Add Linux capabilities</span><br><span class="line">      --cap-drop list                  Drop Linux capabilities</span><br><span class="line">      --cgroup-parent string           Optional parent cgroup <span class="keyword">for</span> the container</span><br><span class="line">      --cidfile string                 Write the container ID to the file</span><br><span class="line">      --cpu-period int                 Limit CPU CFS (Completely Fair Scheduler) period</span><br><span class="line">      --cpu-quota int                  Limit CPU CFS (Completely Fair Scheduler) quota</span><br><span class="line">      --cpu-rt-period int              Limit CPU real-time period <span class="keyword">in</span> microseconds</span><br><span class="line">      --cpu-rt-runtime int             Limit CPU real-time runtime <span class="keyword">in</span> microseconds</span><br><span class="line">  -c, --cpu-shares int                 CPU shares (relative weight)</span><br><span class="line">      --cpus decimal                   Number of CPUs</span><br><span class="line">      --cpuset-cpus string             CPUs <span class="keyword">in</span> which to allow execution (<span class="number">0</span>-<span class="number">3</span>, <span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">      --cpuset-mems string             MEMs <span class="keyword">in</span> which to allow execution (<span class="number">0</span>-<span class="number">3</span>, <span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">  -d, --detach                         Run container <span class="keyword">in</span> background and print container ID</span><br><span class="line">      --detach-keys string             Override the key sequence <span class="keyword">for</span> detaching a container</span><br><span class="line">      --device list                    Add a host device to the container</span><br><span class="line">      --device-cgroup-rule list        Add a rule to the cgroup allowed devices list</span><br><span class="line">      --device-read-bps list           Limit read rate (bytes per second) from a device (default [])</span><br><span class="line">      --device-read-iops list          Limit read rate (IO per second) from a device (default [])</span><br><span class="line">      --device-write-bps list          Limit write rate (bytes per second) to a device (default [])</span><br><span class="line">      --device-write-iops list         Limit write rate (IO per second) to a device (default [])</span><br><span class="line">      --disable-content-trust          Skip image verification (default true)</span><br><span class="line">      --dns list                       Set custom DNS servers</span><br><span class="line">      --dns-option list                Set DNS options</span><br><span class="line">      --dns-search list                Set custom DNS search domains</span><br><span class="line">      --entrypoint string              Overwrite the default ENTRYPOINT of the image</span><br><span class="line">  -e, --env list                       Set environment variables</span><br><span class="line">      --env-file list                  Read <span class="keyword">in</span> a file of environment variables</span><br><span class="line">      --expose list                    Expose a port or a range of ports</span><br><span class="line">      --group-add list                 Add additional groups to join</span><br><span class="line">      --health-cmd string              Command to run to check health</span><br><span class="line">      --health-interval duration       Time between running the check (ms|s|m|h) (default <span class="number">0</span>s)</span><br><span class="line">      --health-retries int             Consecutive failures needed to report unhealthy</span><br><span class="line">      --health-start-period duration   Start period <span class="keyword">for</span> the container to initialize before starting health-retries countdown (ms|s|m|h) (default <span class="number">0</span>s)</span><br><span class="line">      --health-timeout duration        Maximum time to allow one check to run (ms|s|m|h) (default <span class="number">0</span>s)</span><br><span class="line">      --help                           Print usage</span><br><span class="line">  -h, --hostname string                Container host name</span><br><span class="line">      --init                           Run an init inside the container that forwards signals and reaps processes</span><br><span class="line">  -i, --interactive                    Keep STDIN open even <span class="keyword">if</span> not attached</span><br><span class="line">      --ip string                      IPv4 address (e.g., <span class="number">172.30</span>.<span class="number">100.104</span>)</span><br><span class="line">      --ip6 string                     IPv6 address (e.g., <span class="number">2001</span>:db8::<span class="number">33</span>)</span><br><span class="line">      --ipc string                     IPC mode to use</span><br><span class="line">      --isolation string               Container isolation technology</span><br><span class="line">      --kernel-memory bytes            Kernel memory limit</span><br><span class="line">  -l, --label list                     Set meta <span class="keyword">data</span> on a container</span><br><span class="line">      --label-file list                Read <span class="keyword">in</span> a line delimited file of labels</span><br><span class="line">      --link list                      Add link to another container</span><br><span class="line">      --link-local-ip list             Container IPv4/IPv6 link-local addresses</span><br><span class="line">      --log-driver string              Logging driver <span class="keyword">for</span> the container</span><br><span class="line">      --log-opt list                   Log driver options</span><br><span class="line">      --mac-address string             Container MAC address (e.g., <span class="number">92</span>:d0:c6:<span class="number">0</span>a:<span class="number">29</span>:<span class="number">33</span>)</span><br><span class="line">  -m, --memory bytes                   Memory limit</span><br><span class="line">      --memory-reservation bytes       Memory soft limit</span><br><span class="line">      --memory-swap bytes              Swap limit equal to memory plus swap: <span class="string">'-1'</span> to enable unlimited swap</span><br><span class="line">      --memory-swappiness int          Tune container memory swappiness (<span class="number">0</span> to <span class="number">100</span>) (default -<span class="number">1</span>)</span><br><span class="line">      --mount mount                    Attach a filesystem mount to the container</span><br><span class="line">      --name string                    Assign a name to the container</span><br><span class="line">      --network string                 Connect a container to a network (default <span class="string">"default"</span>)</span><br><span class="line">      --network-alias list             Add network-scoped alias <span class="keyword">for</span> the container</span><br><span class="line">      --no-healthcheck                 Disable any container-specified HEALTHCHECK</span><br><span class="line">      --oom-kill-disable               Disable OOM Killer</span><br><span class="line">      --oom-score-adj int              Tune host<span class="string">'s OOM preferences (-1000 to 1000)</span></span><br><span class="line"><span class="string">      --pid string                     PID namespace to use</span></span><br><span class="line"><span class="string">      --pids-limit int                 Tune container pids limit (set -1 for unlimited)</span></span><br><span class="line"><span class="string">      --privileged                     Give extended privileges to this container</span></span><br><span class="line"><span class="string">  -p, --publish list                   Publish a container'</span>s port(s) to the host</span><br><span class="line">  -P, --publish-all                    Publish all exposed ports to random ports</span><br><span class="line">      --read-only                      Mount the container<span class="string">'s root filesystem as read only</span></span><br><span class="line"><span class="string">      --restart string                 Restart policy to apply when a container exits (default "no")</span></span><br><span class="line"><span class="string">      --rm                             Automatically remove the container when it exits</span></span><br><span class="line"><span class="string">      --runtime string                 Runtime to use for this container</span></span><br><span class="line"><span class="string">      --security-opt list              Security Options</span></span><br><span class="line"><span class="string">      --shm-size bytes                 Size of /dev/shm</span></span><br><span class="line"><span class="string">      --sig-proxy                      Proxy received signals to the process (default true)</span></span><br><span class="line"><span class="string">      --stop-signal string             Signal to stop a container (default "SIGTERM")</span></span><br><span class="line"><span class="string">      --stop-timeout int               Timeout (in seconds) to stop a container</span></span><br><span class="line"><span class="string">      --storage-opt list               Storage driver options for the container</span></span><br><span class="line"><span class="string">      --sysctl map                     Sysctl options (default map[])</span></span><br><span class="line"><span class="string">      --tmpfs list                     Mount a tmpfs directory</span></span><br><span class="line"><span class="string">  -t, --tty                            Allocate a pseudo-TTY</span></span><br><span class="line"><span class="string">      --ulimit ulimit                  Ulimit options (default [])</span></span><br><span class="line"><span class="string">  -u, --user string                    Username or UID (format: &lt;name|uid&gt;[:&lt;group|gid&gt;])</span></span><br><span class="line"><span class="string">      --userns string                  User namespace to use</span></span><br><span class="line"><span class="string">      --uts string                     UTS namespace to use</span></span><br><span class="line"><span class="string">  -v, --volume list                    Bind mount a volume</span></span><br><span class="line"><span class="string">      --volume-driver string           Optional volume driver for the container</span></span><br><span class="line"><span class="string">      --volumes-from list              Mount volumes from the specified container(s)</span></span><br><span class="line"><span class="string">  -w, --workdir string                 Working directory inside the container</span></span><br></pre></td></tr></table></figure><h2 id="é•œåƒç±»"><a href="#é•œåƒç±»" class="headerlink" title="é•œåƒç±»"></a>é•œåƒç±»</h2><h3 id="è¿œç¨‹é•œåƒä»“åº“"><a href="#è¿œç¨‹é•œåƒä»“åº“" class="headerlink" title="è¿œç¨‹é•œåƒä»“åº“"></a>è¿œç¨‹é•œåƒä»“åº“</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># - docker search [OPTIONS] TERM</span></span><br><span class="line"><span class="comment"># æœç´¢å¤„æ”¶è—æ•°ä¸å°äº3çš„alpineé•œåƒ</span></span><br><span class="line">$ docker search -f=stars=<span class="number">3</span> alpine</span><br><span class="line"></span><br><span class="line"><span class="comment"># - docker pull [OPTIONS] NAME[:TAG|@DIGEST]</span></span><br><span class="line"><span class="comment"># æ‹‰å–ubuntuæœ€æ–°çš„é•œåƒ</span></span><br><span class="line">$ docker pull ubuntu:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># - docker push NAME[:TAG]</span></span><br><span class="line"><span class="comment"># æ¨é€æœ¬åœ°é•œåƒåˆ°è¿œç¨‹ä»“åº“</span></span><br><span class="line">$ docker push alpine:<span class="number">1.1</span></span><br></pre></td></tr></table></figure><h3 id="æœ¬åœ°é•œåƒ"><a href="#æœ¬åœ°é•œåƒ" class="headerlink" title="æœ¬åœ°é•œåƒ"></a>æœ¬åœ°é•œåƒ</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºæœ¬åœ°æ‰€æœ‰é•œåƒ</span></span><br><span class="line">$ docker images -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ¬åœ°é•œåƒåä¸º java çš„æ‰€æœ‰é•œåƒ</span></span><br><span class="line">$ docker images java </span><br><span class="line"></span><br><span class="line"><span class="comment"># - docker inspect [OPTIONS] NAME|ID [NAME|ID...]</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹é•œåƒè¯¦æƒ…</span></span><br><span class="line">$ docker inspect java</span><br><span class="line"></span><br><span class="line"><span class="comment"># - docker tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]</span></span><br><span class="line"><span class="comment"># ä¿®æ”¹é•œåƒTag</span></span><br><span class="line">$ docker tag java java:<span class="number">9</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - docker rmi [OPTIONS] IMAGE [IMAGE...]</span></span><br><span class="line"><span class="comment"># æœ¬åœ°ç§»é™¤åä¸º hello-world çš„é•œåƒ</span></span><br><span class="line">$ docker rmi hello-world</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç§»é™¤æœ¬åœ°å…¨éƒ¨é•œåƒ</span></span><br><span class="line">$ docker rmi `docker images -a -q`</span><br><span class="line"></span><br><span class="line"><span class="comment"># - docker save [OPTIONS] IMAGE [IMAGE...] </span></span><br><span class="line"><span class="comment"># æŒ‡å®šé•œåƒä¿å­˜æˆ tar å½’æ¡£æ–‡ä»¶</span></span><br><span class="line"><span class="comment"># å°†é•œåƒ tomcat:8 ä¿å­˜ä¸º tomcat.tar æ–‡ä»¶</span></span><br><span class="line">$ docker save -o tomcat.tar wangwei01/tomcat:<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - docker load </span></span><br><span class="line"><span class="comment"># å°† ubuntu14.04.tar æ–‡ä»¶è½½å…¥é•œåƒä¸­</span></span><br><span class="line">$ docker load -i ubuntu14.<span class="number">04</span>.tar</span><br><span class="line">$ docker load &lt; /home/save.tar</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://docs.docker.com/" target="_blank" rel="noopener">https://docs.docker.com/</a></li></ul>]]></content>
      
        <categories>
            
            <category> coding </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ä¸ªäººåšå®¢æ­å»ºç³»åˆ—æŒ‡å—]]></title>
      <url>/posts/personal-blog-building-guide.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h1><p>æœ¬ç³»åˆ—æ–‡ç« ä¸»è¦ç”¨æ¥è®°å½•è‡ªå·±æ­å»ºåšå®¢çš„è¿‡ç¨‹ï¼Œåˆ†äº«å‡ºæ¥ç»™éœ€è¦çš„æœ‹å‹ã€‚æœ‰å‡ ç‚¹è¯´æ˜éœ€è¦æ³¨æ„ï¼š</p><ul><li>å¦‚æœä½ æ˜¯å¼€å‘è€…æˆ–è€…è¯´æ˜¯å¯¹ç¼–ç¨‹ç†Ÿæ‚‰çš„æœ‹å‹ï¼Œå¯ä»¥ç›´æ¥å¿½ç•¥æ­¤å£°æ˜ï¼›</li><li>å¦‚æœæ˜¯éå¼€å‘è€…æˆ–æ˜¯å¯¹<strong>å‘½ä»¤è¡Œ</strong>æ¯«æ— æ¦‚å¿µï¼Œä½†æ˜¯åˆæƒ³æ­å»ºè‡ªå·±åšå®¢çš„æœ‹å‹ï¼Œåœ¨ä¾ç…§æ­¤ç³»åˆ—æ–‡ç« æ­å»ºåšå®¢æ—¶ï¼ŒåŠ¡å¿…ä¿è¯ä¸€ç‚¹ï¼š<strong>ä¸è¦ä¸€ä¸Šæ¥å°±é—®è¿™äº›å‘½ä»¤è¡Œæ˜¯å¹²ä»€ä¹ˆçš„ï¼Œè¯·å…ˆç›´æ¥æŒ‰ç…§æ–‡ç« çš„å¼•å¯¼ä¸€æ­¥ä¸€æ­¥å»æ‰§è¡Œï¼Œç›´åˆ°æŠŠç›®æ ‡è¾¾æˆï¼Œå»ºç«‹èµ·æˆå°±æ„Ÿã€‚ä¹‹åï¼Œå†å›è¿‡å¤´å»Googleä¸€ä¸‹è¿™äº›å‘½ä»¤è¡Œæ˜¯å¹²ä»€ä¹ˆçš„ï¼Œå…ˆæ¨¡ä»¿å†æ·±ç©¶ï¼Œæ‰æ˜¯æ­£ç¡®çš„å­¦ä¹ æ–¹å¼ï¼Œå¦åˆ™å¾ˆå®¹æ˜“ä»å…¥é—¨åˆ°æ”¾å¼ƒ</strong>ã€‚</li><li>æ­¤æ–‡ç« åªé€‚ç”¨äº<strong>Macç¯å¢ƒ</strong>ã€‚</li><li>è™½è¯´ç½‘ä¸Šçš„æœ‰äº†å¾ˆå¤šå…³äºå¦‚ä½•é€šè¿‡Hexoæ­å»ºåšå®¢çš„æŒ‡å—ï¼Œä½†æˆ‘è¿˜æ˜¯æƒ³ç”¨æ›´åŠ æ¸…æ™°æ˜äº†çš„æ–¹å¼å†åšä¸€éæ¢³ç†ï¼Œå¸Œæœ›æˆ‘çš„æ–‡ç« èƒ½å¤Ÿç»™ä½ ç®€å•ã€æ¸…æ™°çš„æ„Ÿè§‰ã€‚</li></ul><a id="more"></a><h1 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h1><ul><li><p>å‘½ä»¤è¡Œå·¥å…·<strong>terminal</strong>ç†Ÿæ‚‰</p><p><img src="https://img.i7years.com/terminal_1.png" alt="WX20170604-145706@2x"></p></li><li><p>å‰å¾€<a href="https://github.com/" target="_blank" rel="noopener">GitHub</a>æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œåé¢æœ‰ç”¨</p></li><li><p>æ‰“å¼€Terminalï¼Œä¸‹é¢çš„å‘½ä»¤ï¼Œå®‰è£…åç»­è¦ç”¨åˆ°å„ç§å·¥å…·åŠç¯å¢ƒã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ bash &lt;(curl -s https://raw.githubusercontent.com/monfresh/laptop/master/laptop)</span><br></pre></td></tr></table></figure><p>æ¼”ç¤ºè§†é¢‘ï¼š<a href="https://monfresh.wistia.com/medias/k8zxt0vj7w" target="_blank" rel="noopener">https://monfresh.wistia.com/medias/k8zxt0vj7w</a></p><p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://github.com/monfresh/laptop" target="_blank" rel="noopener">https://github.com/monfresh/laptop</a></p></li></ul><h1 id="æŒ‡å—"><a href="#æŒ‡å—" class="headerlink" title="æŒ‡å—"></a>æŒ‡å—</h1><ol><li>å¦‚ä½•åœ¨è‡ªå·±ç”µè„‘ä¸Šæ­å»ºå¥½åšå®¢ï¼Œå»ºç«‹èµ·åˆæ­¥çš„æˆå°±æ„Ÿã€‚<a href="https://wangwei.one/posts/c5e43a28.html">https://wangwei.one/posts/c5e43a28.html</a></li><li>å¦‚ä½•å°†è‡ªå·±çš„åšå®¢æ”¾åˆ°ç½‘ä¸Šï¼Œè®©åˆ«äººä¹Ÿèƒ½çœ‹åˆ°ã€‚<a href="https://wangwei.one/posts/f5f2d6f0.html">https://wangwei.one/posts/f5f2d6f0.html</a></li><li>ä¿®æ”¹åšå®¢çš„åç§°ã€logoã€icoã€sloganã€ä¸»é¢˜ç­‰é…ç½®ã€‚<a href="https://wangwei.one/posts/b8ec75a2.html">https://wangwei.one/posts/b8ec75a2.html</a></li></ol>]]></content>
      
        <categories>
            
            <category> tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ä¸ªäººåšå®¢æ­å»ºæŒ‡å—ï¼ˆä¸‰ï¼‰]]></title>
      <url>/posts/personal-blog-building-guide-3.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><blockquote><p>æœ¬ç¯‡æ–‡ç« ä»‹ç»Hexoåšå®¢çš„ä¸€äº›ä¸»é¢˜æ›´æ¢ã€åŸºæœ¬é…ç½®ä»¥åŠä¸€äº›å¥½ç”¨çš„æ’ä»¶å®‰è£…</p></blockquote><a id="more"></a><h1 id="ä¸»é¢˜æ›´æ¢"><a href="#ä¸»é¢˜æ›´æ¢" class="headerlink" title="ä¸»é¢˜æ›´æ¢"></a>ä¸»é¢˜æ›´æ¢</h1><blockquote><ul><li>è¿™é‡Œä»¥ç›®å‰æˆ‘æ¯”è¾ƒå–œæ¬¢çš„ä¸»é¢˜<a href="https://github.com/iissnan/hexo-theme-next" target="_blank" rel="noopener">NexT</a>ä¸ºä¾‹ã€‚æ›´å¤šä¸»é¢˜ï¼š<a href="https://hexo.io/themes/" target="_blank" rel="noopener">https://hexo.io/themes/</a></li><li>NexTå®˜æ–¹æ–‡æ¡£ï¼š<a href="http://theme-next.iissnan.com/getting-started.html" target="_blank" rel="noopener">http://theme-next.iissnan.com/getting-started.html</a></li><li>NexTå›¾æ ‡åº“ï¼š<a href="http://fontawesome.io/icons/" target="_blank" rel="noopener">http://fontawesome.io/icons/</a></li></ul></blockquote><h2 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥åšå®¢æ ¹ç›®å½•</span></span><br><span class="line">$ cd myBlog</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ–°ä¸»é¢˜æ–‡ä»¶å¤¹</span></span><br><span class="line">$ mkdir themes/next</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½</span></span><br><span class="line">$ git clone https://github.com/iissnan/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><ul><li>ä¿®æ”¹ä¸»é…ç½®æ–‡ä»¶<code>_config.yml</code>ä¸­çš„<code>theme</code>ï¼Œè®¾ç½®ä¸º<code>next</code>ï¼›</li><li>æ‰§è¡Œ<code>hexo clean &amp;&amp; hexo g &amp;&amp; hexo s</code>æŸ¥çœ‹æ•ˆæœï¼›</li></ul><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><blockquote><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://github.com/iissnan/hexo-theme-next" target="_blank" rel="noopener">https://github.com/iissnan/hexo-theme-next</a></p></blockquote><h3 id="ç½‘ç«™icoè®¾ç½®"><a href="#ç½‘ç«™icoè®¾ç½®" class="headerlink" title="ç½‘ç«™icoè®¾ç½®"></a>ç½‘ç«™icoè®¾ç½®</h3><ul><li>ä¸‹è½½iconèµ„æºï¼š<a href="https://www.flaticon.com" target="_blank" rel="noopener">https://www.flaticon.com</a></li><li>å°†ä¸‹è½½åˆ°çš„pngè½¬åŒ–ä¸º <code>16 x 16</code>ã€<code>32 x 32</code>ã€<code>180 x 180</code>ä¸‰ä¸ªç‰ˆæœ¬</li><li>å°†è½¬åŒ–åçš„pngä»¥åŠä¸‹è½½çš„svgæ–‡ä»¶æ”¾åˆ°<code>myBlog/source/</code>ç›®å½•ä¸‹</li><li>ä¿®æ”¹<code>next/_config.yml</code>ä¸­<code>favicon</code>é¡¹çš„å›¾ç‰‡è·¯åŠ²é…ç½®<ul><li>åˆ é™¤<code>/images</code>å‰ç¼€</li><li>æ›´æ–°å›¾ç‰‡åç§°</li></ul></li><li>æ‰§è¡Œ<code>hexo clean &amp;&amp; hexo g &amp;&amp; hexo s</code>æŸ¥çœ‹æ•ˆæœ</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Site Information Settings</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># To get or check favicons visit: https://realfavicongenerator.net</span></span><br><span class="line"><span class="comment"># Put your favicons into `hexo-site/source/` (recommend) or `hexo-site/themes/next/source/images/` directory.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Default NexT favicons placed in `hexo-site/themes/next/source/images/` directory.</span></span><br><span class="line"><span class="comment"># And if you want to place your icons in `hexo-site/source/` root directory, you must remove `/images` prefix from pathes.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># For example, you put your favicons into `hexo-site/source/images` directory.</span></span><br><span class="line"><span class="comment"># Then need to rename &amp; redefine they on any other names, otherwise icons from Next will rewrite your custom icons in Hexo.</span></span><br><span class="line"><span class="attr">favicon:</span></span><br><span class="line"><span class="attr">  small:</span> <span class="string">/favicon-16x16-code.png</span></span><br><span class="line"><span class="attr">  medium:</span> <span class="string">/favicon-32x32-code.png</span></span><br><span class="line"><span class="attr">  apple_touch_icon:</span> <span class="string">/favicon-180x180-code.png</span></span><br><span class="line"><span class="attr">  safari_pinned_tab:</span> <span class="string">/logo.svg</span></span><br><span class="line">  <span class="comment">#android_manifest: /images/manifest.json</span></span><br><span class="line">  <span class="comment">#ms_browserconfig: /images/browserconfig.xml</span></span><br></pre></td></tr></table></figure><h3 id="èœå•è®¾ç½®"><a href="#èœå•è®¾ç½®" class="headerlink" title="èœå•è®¾ç½®"></a>èœå•è®¾ç½®</h3><h4 id="åˆ›å»ºTagsé¡µé¢"><a href="#åˆ›å»ºTagsé¡µé¢" class="headerlink" title="åˆ›å»ºTagsé¡µé¢"></a>åˆ›å»ºTagsé¡µé¢</h4><ul><li><p>æ–°å»ºåä¸º<code>tags</code>çš„é¡µé¢</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new page <span class="string">"tags"</span></span><br></pre></td></tr></table></figure></li><li><p>è®¾ç½®é¡µé¢ç±»å‹ä¸º<code>tags</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">title:</span> <span class="string">All</span> <span class="string">tags</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2014</span><span class="bullet">-12</span><span class="bullet">-22</span> <span class="number">12</span><span class="string">:39:04</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">"tags"</span></span><br></pre></td></tr></table></figure></li><li><p>æ·»åŠ <code>tags</code>åˆ°ä¸»é¢˜é…ç½®<code>_config.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line"><span class="attr">  home:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">  archives:</span> <span class="string">/archives</span></span><br><span class="line"><span class="attr">  tags:</span> <span class="string">/tags</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="åˆ›å»ºCategoriesé¡µé¢"><a href="#åˆ›å»ºCategoriesé¡µé¢" class="headerlink" title="åˆ›å»ºCategoriesé¡µé¢"></a>åˆ›å»ºCategoriesé¡µé¢</h4><ul><li><p>æ–°å»ºåä¸º<code>categories</code>çš„é¡µé¢</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new page &quot;categories&quot;</span><br></pre></td></tr></table></figure></li><li><p>è®¾ç½®é¡µé¢ç±»å‹ä¸º<code>categories</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">title:</span> <span class="string">All</span> <span class="string">categories</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2014</span><span class="bullet">-12</span><span class="bullet">-22</span> <span class="number">12</span><span class="string">:39:04</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">"categories"</span></span><br></pre></td></tr></table></figure></li><li><p>æ·»åŠ <code>categories</code>åˆ°ä¸»é¢˜é…ç½®<code>_config.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line"><span class="attr">  home:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">  archives:</span> <span class="string">/archives</span></span><br><span class="line"><span class="attr">  categories:</span> <span class="string">/categories</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="é…ç½®èœå•"><a href="#é…ç½®èœå•" class="headerlink" title="é…ç½®èœå•"></a>é…ç½®èœå•</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Menu Settings</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># When running the site in a subdirectory (e.g. domain.tld/blog), remove the leading slash from link value (/archives -&gt; archives).</span></span><br><span class="line"><span class="comment"># Usage: `Key: /link/ || icon`</span></span><br><span class="line"><span class="comment"># Key is the name of menu item. If translate for this menu will find in languages - this translate will be loaded; if not - Key name will be used. Key is case-senstive.</span></span><br><span class="line"><span class="comment"># Value before `||` delimeter is the target link.</span></span><br><span class="line"><span class="comment"># Value after `||` delimeter is the name of FontAwesome icon. If icon (with or without delimeter) is not specified, question icon will be loaded.</span></span><br><span class="line"><span class="attr">menu:</span></span><br><span class="line"><span class="attr">  home:</span> <span class="string">/</span> <span class="string">||</span> <span class="string">home</span></span><br><span class="line"><span class="attr">  tags:</span> <span class="string">/tags/</span> <span class="string">||</span> <span class="string">tags</span></span><br><span class="line"><span class="attr">  categories:</span> <span class="string">/categories/</span> <span class="string">||</span> <span class="string">th</span></span><br><span class="line"><span class="attr">  archives:</span> <span class="string">/archives/</span> <span class="string">||</span> <span class="string">archive</span></span><br><span class="line"><span class="attr">  about:</span> <span class="string">/about/</span> <span class="string">||</span> <span class="string">user</span></span><br><span class="line">  <span class="comment">#schedule: /schedule/ || calendar</span></span><br><span class="line"><span class="comment">#  sitemap: /sitemap.xml || sitemap</span></span><br><span class="line"><span class="comment">#  commonweal: /404/ || heartbeat</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable/Disable menu icons.</span></span><br><span class="line"><span class="attr">menu_icons:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="ä¾§è¾¹æ è®¾ç½®"><a href="#ä¾§è¾¹æ è®¾ç½®" class="headerlink" title="ä¾§è¾¹æ è®¾ç½®"></a>ä¾§è¾¹æ è®¾ç½®</h3><h4 id="è®¾ç½®ç¤¾äº¤é“¾æ¥"><a href="#è®¾ç½®ç¤¾äº¤é“¾æ¥" class="headerlink" title="è®¾ç½®ç¤¾äº¤é“¾æ¥"></a>è®¾ç½®ç¤¾äº¤é“¾æ¥</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Sidebar Settings</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Social Links.</span></span><br><span class="line"><span class="comment"># Usage: `Key: permalink || icon`</span></span><br><span class="line"><span class="comment"># Key is the link label showing to end users.</span></span><br><span class="line"><span class="comment"># Value before `||` delimeter is the target permalink.</span></span><br><span class="line"><span class="comment"># Value after `||` delimeter is the name of FontAwesome icon. If icon (with or without delimeter) is not specified, globe icon will be loaded.</span></span><br><span class="line"><span class="attr">social:</span></span><br><span class="line"><span class="attr">  GitHub:</span> <span class="attr">https://github.com/wangweiX</span> <span class="string">||</span> <span class="string">github</span></span><br><span class="line"><span class="attr">  StackOverflow:</span> <span class="attr">https://stackoverflow.com/users/8892704/wangwei</span> <span class="string">||</span> <span class="string">stack-overflow</span></span><br><span class="line"><span class="attr">  Weibo:</span> <span class="attr">http://weibo.com/wangweijava</span> <span class="string">||</span> <span class="string">weibo</span></span><br><span class="line"><span class="attr">  Twitter:</span> <span class="attr">https://twitter.com/wangwei_hz</span> <span class="string">||</span> <span class="string">twitter</span></span><br><span class="line"><span class="attr">  Douban:</span> <span class="attr">https://www.douban.com/people/wwxzwj</span> <span class="string">||</span> <span class="string">film</span></span><br><span class="line"><span class="attr">  Linkedin:</span> <span class="attr">http://www.linkedin.com/in/wangweix/</span> <span class="string">||</span> <span class="string">linkedin</span></span><br><span class="line"><span class="attr">  Podcast:</span> <span class="attr">http://www.ximalaya.com/53432374/profile</span> <span class="string">||</span> <span class="string">podcast</span></span><br><span class="line"><span class="attr">  E-Mail:</span> <span class="attr">mailto:w7years@gmail.com</span> <span class="string">||</span> <span class="string">envelope</span></span><br><span class="line">  <span class="comment"># çŸ¥ä¹: https://www.zhihu.com/people/Ww-1991</span></span><br><span class="line">  <span class="comment"># ç®€ä¹¦: http://www.jianshu.com/users/a04d5c200045/timeline</span></span><br><span class="line">  <span class="comment"># Google: https://plus.google.com/yourname || google</span></span><br><span class="line">  <span class="comment"># VK Group: https://vk.com/yourname || vk</span></span><br><span class="line">  <span class="comment"># Instagram: https://instagram.com/yourname || instagram</span></span><br><span class="line">  <span class="comment"># Skype: skype:yourname?call|chat || skype</span></span><br><span class="line">  <span class="comment"># YouTube: https://youtube.com/yourname || youtube</span></span><br><span class="line">  <span class="comment"># FB Page: https://www.facebook.com/wangwei1991 || facebook</span></span><br><span class="line"></span><br><span class="line"><span class="attr">social_icons:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  icons_only:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">  transition:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><h4 id="è®¾ç½®å‹æƒ…é“¾æ¥"><a href="#è®¾ç½®å‹æƒ…é“¾æ¥" class="headerlink" title="è®¾ç½®å‹æƒ…é“¾æ¥"></a>è®¾ç½®å‹æƒ…é“¾æ¥</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Blog rolls</span></span><br><span class="line"><span class="attr">links_icon:</span> <span class="string">link</span></span><br><span class="line"><span class="attr">links_title:</span> <span class="string">Links</span></span><br><span class="line"><span class="comment">#links_layout: block</span></span><br><span class="line"><span class="comment">#links_layout: inline</span></span><br><span class="line"><span class="attr">links:</span></span><br><span class="line"><span class="attr">  howtodoinjava:</span> <span class="attr">https://howtodoinjava.com/</span></span><br><span class="line">  <span class="string">ç¾å›¢ç‚¹è¯„:</span> <span class="attr">https://tech.meituan.com/</span></span><br><span class="line">  <span class="string">é˜®ä¸€å³°:</span> <span class="attr">http://www.ruanyifeng.com/blog/</span></span><br></pre></td></tr></table></figure><h4 id="è®¾ç½®ä¾§è¾¹æ å¤´åƒ"><a href="#è®¾ç½®ä¾§è¾¹æ å¤´åƒ" class="headerlink" title="è®¾ç½®ä¾§è¾¹æ å¤´åƒ"></a>è®¾ç½®ä¾§è¾¹æ å¤´åƒ</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sidebar Avatar</span></span><br><span class="line"><span class="comment"># in theme directory(source/images): /images/avatar.gif</span></span><br><span class="line"><span class="comment"># in site  directory(source/uploads): /uploads/avatar.gif</span></span><br><span class="line"><span class="attr">avatar:</span> <span class="attr">https://img.i7years.com/my7year-8.jpg</span></span><br></pre></td></tr></table></figure><h4 id="è®¾ç½®å¾®ä¿¡è®¢é˜…-amp-æ‰“èµ"><a href="#è®¾ç½®å¾®ä¿¡è®¢é˜…-amp-æ‰“èµ" class="headerlink" title="è®¾ç½®å¾®ä¿¡è®¢é˜…&amp;æ‰“èµ"></a>è®¾ç½®å¾®ä¿¡è®¢é˜…&amp;æ‰“èµ</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Wechat Subscriber</span></span><br><span class="line"><span class="attr">wechat_subscriber:</span></span><br><span class="line"><span class="attr">  enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  qcode:</span> <span class="attr">https://img.i7years.com/my7year-8.jpg</span></span><br><span class="line"><span class="attr">  description:</span> <span class="string">äº’ç›¸å­¦ä¹ </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Reward</span></span><br><span class="line"><span class="attr">reward_comment:</span> <span class="string">è¯·æˆ‘å–æ¯å’–å•¡å§~</span></span><br><span class="line"><span class="attr">wechatpay:</span> <span class="attr">https://img.i7years.com/pay2Wechat.png</span></span><br><span class="line"><span class="attr">alipay:</span> <span class="attr">https://img.i7years.com/pay2Alipay.png</span></span><br><span class="line"><span class="attr">bitcoin:</span> <span class="attr">https://img.i7years.com/wallet/rec_bitcoin.png</span></span><br></pre></td></tr></table></figure><h3 id="ç¬¬ä¸‰æ–¹æ’ä»¶é…ç½®"><a href="#ç¬¬ä¸‰æ–¹æ’ä»¶é…ç½®" class="headerlink" title="ç¬¬ä¸‰æ–¹æ’ä»¶é…ç½®"></a>ç¬¬ä¸‰æ–¹æ’ä»¶é…ç½®</h3><h4 id="ç«™å†…æœç´¢"><a href="#ç«™å†…æœç´¢" class="headerlink" title="ç«™å†…æœç´¢"></a>ç«™å†…æœç´¢</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-generator-search --save</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Local search</span></span><br><span class="line"><span class="comment"># Dependencies: https://github.com/flashlab/hexo-generator-search</span></span><br><span class="line"><span class="attr">local_search:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># if auto, trigger search by changing input</span></span><br><span class="line">  <span class="comment"># if manual, trigger search by pressing enter key or search button</span></span><br><span class="line"><span class="attr">  trigger:</span> <span class="string">auto</span></span><br><span class="line">  <span class="comment"># show top n results per article, show all results by setting to -1</span></span><br><span class="line"><span class="attr">  top_n_per_article:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="ç«™ç‚¹PV-UVç»Ÿè®¡"><a href="#ç«™ç‚¹PV-UVç»Ÿè®¡" class="headerlink" title="ç«™ç‚¹PV/UVç»Ÿè®¡"></a>ç«™ç‚¹PV/UVç»Ÿè®¡</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Show PV/UV of the website/page with busuanzi.</span></span><br><span class="line"><span class="comment"># Get more information on http://ibruce.info/2015/04/04/busuanzi/</span></span><br><span class="line"><span class="attr">busuanzi_count:</span></span><br><span class="line">  <span class="comment"># count values only if the other configs are false</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># custom uv span for the whole site</span></span><br><span class="line"><span class="attr">  site_uv:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  site_uv_header:</span> <span class="string">æœ¬ç«™è®¿å®¢æ•°</span></span><br><span class="line"><span class="attr">  site_uv_footer:</span> <span class="string">äººæ¬¡</span></span><br><span class="line">  <span class="comment"># custom pv span for the whole site</span></span><br><span class="line"><span class="attr">  site_pv:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  site_pv_header:</span> <span class="string">æœ¬ç«™æ€»è®¿é—®é‡</span></span><br><span class="line"><span class="attr">  site_pv_footer:</span> <span class="string">æ¬¡</span></span><br><span class="line">  <span class="comment"># custom pv span for one page only</span></span><br><span class="line"><span class="attr">  page_pv:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  page_pv_header:</span> <span class="string">æœ¬æ–‡æ€»é˜…è¯»é‡</span></span><br><span class="line"><span class="attr">  page_pv_footer:</span> <span class="string">æ¬¡</span></span><br></pre></td></tr></table></figure><h4 id="åˆ†äº«æ’ä»¶"><a href="#åˆ†äº«æ’ä»¶" class="headerlink" title="åˆ†äº«æ’ä»¶"></a>åˆ†äº«æ’ä»¶</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Share</span></span><br><span class="line"><span class="comment">#duoshuo_share: true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># NeedMoreShare2</span></span><br><span class="line"><span class="comment"># This plugin is a pure javascript sharing lib which is useful in China.</span></span><br><span class="line"><span class="comment"># See: https://github.com/revir/need-more-share2</span></span><br><span class="line"><span class="comment"># Also see: https://github.com/DzmVasileusky/needShareButton</span></span><br><span class="line"><span class="comment"># iconStyle: default | box</span></span><br><span class="line"><span class="comment"># boxForm: horizontal | vertical</span></span><br><span class="line"><span class="comment"># position: top / middle / bottom + Left / Center / Right</span></span><br><span class="line"><span class="comment"># networks: Weibo,Wechat,Douban,QQZone,Twitter,Linkedin,Mailto,Reddit,</span></span><br><span class="line"><span class="comment">#           Delicious,StumbleUpon,Pinterest,Facebook,GooglePlus,Slashdot,</span></span><br><span class="line"><span class="comment">#           Technorati,Posterous,Tumblr,GoogleBookmarks,Newsvine,</span></span><br><span class="line"><span class="comment">#           Evernote,Friendfeed,Vkontakte,Odnoklassniki,Mailru</span></span><br><span class="line"><span class="attr">needmoreshare2:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  postbottom:</span></span><br><span class="line"><span class="attr">    enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    options:</span></span><br><span class="line"><span class="attr">      iconStyle:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">      boxForm:</span> <span class="string">horizontal</span></span><br><span class="line"><span class="attr">      position:</span> <span class="string">bottomCenter</span></span><br><span class="line"><span class="attr">      networks:</span> <span class="string">Mailto,Wechat,Weibo,QQZone,Twitter,Facebook,Linkedin,Evernote,Douban,GooglePlus,Reddit</span></span><br><span class="line"><span class="attr">  float:</span></span><br><span class="line"><span class="attr">    enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    options:</span></span><br><span class="line"><span class="attr">      iconStyle:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">      boxForm:</span> <span class="string">horizontal</span></span><br><span class="line"><span class="attr">      position:</span> <span class="string">middleRight</span></span><br><span class="line"><span class="attr">      networks:</span> <span class="string">Mailto,Wechat,Weibo,QQZone,Twitter,Facebook,Linkedin,Evernote,Douban,GooglePlus,Reddit</span></span><br></pre></td></tr></table></figure><h4 id="è¯„è®ºæ’ä»¶"><a href="#è¯„è®ºæ’ä»¶" class="headerlink" title="è¯„è®ºæ’ä»¶"></a>è¯„è®ºæ’ä»¶</h4><h5 id="disqus"><a href="#disqus" class="headerlink" title="disqus"></a>disqus</h5><ol><li><p>æ³¨å†Œè´¦å·ï¼š<a href="https://disqus.com/" target="_blank" rel="noopener">https://disqus.com/</a></p></li><li><p>æ·»åŠ ç«™ç‚¹â€”â€”&gt; è·å–<code>shortname</code>ï¼Œè¯·å‚è€ƒï¼š<a href="http://www.jianshu.com/p/c4f65ebe23ad" target="_blank" rel="noopener">http://www.jianshu.com/p/c4f65ebe23ad</a></p></li><li><p>ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶<code>_config.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Disqus</span></span><br><span class="line"><span class="attr">disqus:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  shortname:</span> <span class="string">xxxxxx</span></span><br><span class="line"><span class="attr">  count:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li><li><p>æ³¨æ„ï¼šdisquséœ€è¦ç¿»å¢™æ‰èƒ½ä½¿ç”¨ï¼Œè§£å†³æ–¹æ¡ˆï¼š<a href="https://github.com/ciqulover/disqus-proxy" target="_blank" rel="noopener">https://github.com/ciqulover/disqus-proxy</a></p></li></ol><h5 id="gitment"><a href="#gitment" class="headerlink" title="gitment"></a>gitment</h5><ol><li><p>å®‰è£…æ’ä»¶<a href="https://github.com/imsun/gitment" target="_blank" rel="noopener">gitment</a></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save gitment</span><br></pre></td></tr></table></figure></li><li><p>æ³¨å†ŒOAuth Application</p><p><a href="https://github.com/settings/applications/new" target="_blank" rel="noopener">ç‚¹å‡»æ­¤å¤„</a> æ¥æ³¨å†Œä¸€ä¸ªæ–°çš„ OAuth Applicationã€‚å…¶ä»–å†…å®¹å¯ä»¥éšæ„å¡«å†™ï¼Œä½†è¦ç¡®ä¿å¡«å…¥æ­£ç¡®çš„ callback URLï¼ˆä¸€èˆ¬æ˜¯è¯„è®ºé¡µé¢å¯¹åº”çš„åŸŸåï¼Œå¦‚ <code>https://imsun.net</code>ï¼‰ã€‚</p><p>ä½ ä¼šå¾—åˆ°ä¸€ä¸ª client ID å’Œä¸€ä¸ª client secretï¼Œè¿™ä¸ªå°†è¢«ç”¨äºä¹‹åçš„ç”¨æˆ·ç™»å½•ã€‚</p></li><li><p>ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶<code>_config.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Gitment</span></span><br><span class="line"><span class="comment"># Introduction: https://imsun.net/posts/gitment-introduction/</span></span><br><span class="line"><span class="comment"># You can get your Github ID from https://api.github.com/users/&lt;Github username&gt;</span></span><br><span class="line"><span class="attr">gitment:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  mint:</span> <span class="literal">true</span> <span class="comment"># RECOMMEND, A mint on Gitment, to support count, language and proxy_gateway</span></span><br><span class="line"><span class="attr">  count:</span> <span class="literal">true</span> <span class="comment"># Show comments count in post meta area</span></span><br><span class="line"><span class="attr">  lazy:</span> <span class="literal">false</span> <span class="comment"># Comments lazy loading with a button</span></span><br><span class="line"><span class="attr">  cleanly:</span> <span class="literal">false</span> <span class="comment"># Hide 'Powered by ...' on footer, and more</span></span><br><span class="line"><span class="attr">  language:</span> <span class="comment"># Force language, or auto switch by theme</span></span><br><span class="line"><span class="attr">  github_user:</span> <span class="string">xxx</span></span><br><span class="line"><span class="attr">  github_repo:</span> <span class="string">xxx</span></span><br><span class="line"><span class="attr">  client_id:</span> <span class="string">xx</span></span><br><span class="line"><span class="attr">  client_secret:</span> <span class="string">xxx</span></span><br><span class="line"><span class="attr">  proxy_gateway:</span> <span class="comment"># Address of api proxy, See: https://github.com/aimingoo/intersect</span></span><br><span class="line"><span class="attr">  redirect_protocol:</span> <span class="comment"># Protocol of redirect_uri with force_redirect_protocol when mint enabled</span></span><br></pre></td></tr></table></figure></li><li><p>åˆå§‹åŒ–è¯„è®º</p><p>é¡µé¢å‘å¸ƒåï¼Œä½ éœ€è¦è®¿é—®é¡µé¢å¹¶ä½¿ç”¨ä½ çš„ GitHub è´¦å·ç™»å½•ï¼ˆè¯·ç¡®ä¿ä½ çš„è´¦å·æ˜¯ç¬¬ä¸‰æ­¥æ‰€å¡« repo çš„ ownerï¼‰ï¼Œç‚¹å‡»åˆå§‹åŒ–æŒ‰é’®ã€‚</p><p>ä¹‹åå…¶ä»–ç”¨æˆ·å³å¯åœ¨è¯¥é¡µé¢å‘è¡¨è¯„è®ºã€‚</p><p>â€‹</p></li></ol><h4 id="ç»Ÿè®¡åˆ†æ"><a href="#ç»Ÿè®¡åˆ†æ" class="headerlink" title="ç»Ÿè®¡åˆ†æ"></a>ç»Ÿè®¡åˆ†æ</h4><h5 id="Googleç»Ÿè®¡"><a href="#Googleç»Ÿè®¡" class="headerlink" title="Googleç»Ÿè®¡"></a>Googleç»Ÿè®¡</h5><ol><li><p>æ³¨å†Œè´¦å·ï¼š<a href="https://analytics.google.com" target="_blank" rel="noopener">https://analytics.google.com</a></p></li><li><p>æ–°å¢è´¦å·ä¿¡æ¯åŠç½‘ç«™ä¿¡æ¯ï¼Œè·å– Google Analytics IDï¼Œå½¢å¦‚ï¼šUA-xxxxxxxxx-1</p></li><li><p>ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®Google Analytics ID</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Google Analytics</span></span><br><span class="line"><span class="attr">google_analytics:</span> <span class="string">UA-xxxxxxxxx-1</span></span><br></pre></td></tr></table></figure></li></ol><h5 id="tencentç»Ÿè®¡"><a href="#tencentç»Ÿè®¡" class="headerlink" title="tencentç»Ÿè®¡"></a>tencentç»Ÿè®¡</h5><ol><li><p>æ³¨å†Œè´¦å·ï¼š<a href="http://mta.qq.com/" target="_blank" rel="noopener">http://mta.qq.com/</a></p></li><li><p>åˆ›å»ºH5åº”ç”¨ï¼Œè·å¾—AppId</p></li><li><p>ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®Tencent MTA ID</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Tencent MTA ID</span></span><br><span class="line"><span class="attr">tencent_mta:</span></span><br></pre></td></tr></table></figure></li></ol><h5 id="cnzz-ç»Ÿè®¡"><a href="#cnzz-ç»Ÿè®¡" class="headerlink" title="cnzz ç»Ÿè®¡"></a>cnzz ç»Ÿè®¡</h5><ol><li><p>æ³¨å†Œè´¦å·ï¼š<a href="http://www.umeng.com/" target="_blank" rel="noopener">http://www.umeng.com/</a></p></li><li><p>æ·»åŠ ç«™ç‚¹ï¼š<a href="http://web.umeng.com/main.php?c=site&amp;a=show" target="_blank" rel="noopener">http://web.umeng.com/main.php?c=site&amp;a=show</a></p></li><li><p>è·å–ç»Ÿè®¡ä»£ç ä¸­çš„ç«™ç‚¹ID</p></li><li><p>ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®cnzz_siteid</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CNZZ count</span></span><br><span class="line"><span class="comment">#cnzz_siteid:</span></span><br></pre></td></tr></table></figure><p>â€‹</p></li></ol><h5 id="baidu-ç»Ÿè®¡"><a href="#baidu-ç»Ÿè®¡" class="headerlink" title="baidu ç»Ÿè®¡"></a>baidu ç»Ÿè®¡</h5><ol><li><p>æ³¨å†Œè´¦å·ï¼š<a href="https://tongji.baidu.com/web/welcome/login" target="_blank" rel="noopener">https://tongji.baidu.com/web/welcome/login</a></p></li><li><p>æ·»åŠ ç«™ç‚¹</p></li><li><p>è·å–ç»Ÿè®¡ä»£ç ä¸­çš„ç«™ç‚¹ID</p></li><li><p>ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®Baidu Analytics ID</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Baidu Analytics ID</span></span><br><span class="line"><span class="attr">baidu_analytics:</span> <span class="string">xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span></span><br></pre></td></tr></table></figure><p>â€‹</p></li></ol><h4 id="SEOä¼˜åŒ–"><a href="#SEOä¼˜åŒ–" class="headerlink" title="SEOä¼˜åŒ–"></a>SEOä¼˜åŒ–</h4><h5 id="å®‰è£…ç«™ç‚¹åœ°å›¾"><a href="#å®‰è£…ç«™ç‚¹åœ°å›¾" class="headerlink" title="å®‰è£…ç«™ç‚¹åœ°å›¾"></a>å®‰è£…ç«™ç‚¹åœ°å›¾</h5><ol><li><p>ç«™ç‚¹åœ°å›¾</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># google</span></span><br><span class="line">$ npm install hexo-generator-sitemap --save</span><br><span class="line"></span><br><span class="line"><span class="comment"># baidu</span></span><br><span class="line">$ npm install hexo-generator-baidu-sitemap --save</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹ç«™ç‚¹é…ç½®</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è‡ªåŠ¨ç”Ÿæˆsitemap</span></span><br><span class="line">sitemap:</span><br><span class="line">  path: sitemap.xml</span><br><span class="line">baidusitemap:</span><br><span class="line">  path: baidusitemap.xml</span><br></pre></td></tr></table></figure><p>â€‹</p></li></ol><h5 id="Google"><a href="#Google" class="headerlink" title="Google"></a>Google</h5><ol><li><p>ä½¿ç”¨Googleè´¦å·ç™»å½•ï¼š<a href="https://www.google.com/webmasters" target="_blank" rel="noopener">https://www.google.com/webmasters</a></p></li><li><p>æ·»åŠ å±æ€§ â€”â€”&gt; è¾“å…¥ç½‘ç«™åœ°å€</p></li><li><p>googleéªŒè¯ç½‘é¡µæ‰€æœ‰æƒï¼Œé€‰æ‹©HTML TagéªŒè¯æ–¹å¼ï¼Œè·å–<code>content</code>çš„å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta name=&quot;google-site-verification&quot; content=&quot;XXXXXXXXXXXXXXXXXXXXXXX&quot; /&gt;</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹ä¸»é¢˜é…ç½®ï¼Œè®¾ç½®<code>google_site_verification</code>ï¼Œæ„å»ºç«™ç‚¹å¹¶å‘å¸ƒ</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Google Webmaster tools verification setting</span></span><br><span class="line"><span class="comment"># See: https://www.google.com/webmasters/</span></span><br><span class="line"><span class="attr">google_site_verification:</span> <span class="string">XXXXXXXXXXXXXXXXXXXXXXX</span></span><br></pre></td></tr></table></figure></li><li><p>éªŒè¯é€šè¿‡ï¼Œè¿›å…¥æ§åˆ¶å°â€”â€”&gt; æŠ“å– â€”â€”&gt; ç«™ç‚¹åœ°å›¾ â€”â€”æäº¤ç«™ç‚¹ç½‘å€ sitemap.xml</p></li></ol><h5 id="ç™¾åº¦"><a href="#ç™¾åº¦" class="headerlink" title="ç™¾åº¦"></a>ç™¾åº¦</h5><ol><li><p>æ³¨å†Œç™¾åº¦èµ„æºå¹³å°è´¦å·ï¼š<a href="http://ziyuan.baidu.com/" target="_blank" rel="noopener">http://ziyuan.baidu.com/</a></p></li><li><p>ç½‘ç«™æ”¯æŒ â€”&gt; æ•°æ®å¼•å…¥ â€”&gt; MIPå¼•å…¥ â€”&gt; æ•°æ®æäº¤ï¼Œè·å–<code>token</code></p><p><img src="https://img.i7years.com/blog/hexo_setting_1.png" alt="hexo_setting_1"></p></li><li><p>åˆ°Hexoæ ¹ç›®å½•ä¸‹ï¼Œå®‰è£…æ’ä»¶ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-baidu-url-submit --save</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶<code>_config.yml</code>ï¼Œå¼€å¯ç™¾åº¦è‡ªåŠ¨æ¨é€ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Enable baidu push so that the blog will push the url to baidu automatically which is very helpful for SEO</span><br><span class="line">baidu_push: true</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹hexoä¸»é…ç½®æ–‡ä»¶<code>_config.yml</code>ï¼Œåœ¨æ–‡æœ«æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">baidu_url_submit:</span></span><br><span class="line"><span class="attr">  count:</span> <span class="number">1</span> <span class="comment">## æäº¤æœ€æ–°çš„ä¸€ä¸ªé“¾æ¥</span></span><br><span class="line"><span class="attr">  host:</span> <span class="string">www.hui-wang.info</span> <span class="comment">## åœ¨ç™¾åº¦ç«™é•¿å¹³å°ä¸­æ³¨å†Œçš„åŸŸå</span></span><br><span class="line"><span class="attr">  token:</span> <span class="string">your_token</span> <span class="comment">## è¯·æ³¨æ„è¿™æ˜¯æ‚¨çš„ç§˜é’¥ï¼Œ æ‰€ä»¥è¯·ä¸è¦æŠŠåšå®¢æºä»£ç å‘å¸ƒåœ¨å…¬ä¼—ä»“åº“é‡Œ!</span></span><br><span class="line"><span class="attr">  path:</span> <span class="string">baidu_urls.txt</span> <span class="comment">## æ–‡æœ¬æ–‡æ¡£çš„åœ°å€ï¼Œ æ–°é“¾æ¥ä¼šä¿å­˜åœ¨æ­¤æ–‡æœ¬æ–‡æ¡£é‡Œ</span></span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹hexoä¸»é…ç½®æ–‡ä»¶<code>_config.yml</code>ï¼Œä¿®æ”¹<code>deploy</code>é¡¹é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/deployment.html</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line"><span class="attr">- type:</span> <span class="string">git</span></span><br><span class="line"><span class="attr">  repo:</span> <span class="string">git@github.com:wangweiX/tech.github.io.git</span></span><br><span class="line"><span class="attr">  branch:</span> <span class="string">master</span></span><br><span class="line"><span class="attr">- type:</span> <span class="string">baidu_url_submitter</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="å…¶ä»–æ’ä»¶é…ç½®"><a href="#å…¶ä»–æ’ä»¶é…ç½®" class="headerlink" title="å…¶ä»–æ’ä»¶é…ç½®"></a>å…¶ä»–æ’ä»¶é…ç½®</h4><h5 id="æ–‡ä»¶å‹ç¼©"><a href="#æ–‡ä»¶å‹ç¼©" class="headerlink" title="æ–‡ä»¶å‹ç¼©"></a>æ–‡ä»¶å‹ç¼©</h5><ol><li><p>å®‰è£…æ’ä»¶<a href="https://github.com/chenzhutian/hexo-all-minifier" target="_blank" rel="noopener">hexo-all-minifier</a></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-all-minifier --save</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹hexoé…ç½®æ–‡ä»¶<code>_config.yml</code>ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">all_minifier:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li></ol><h5 id="æ–‡ç« è·¯å¾„ä¼˜åŒ–"><a href="#æ–‡ç« è·¯å¾„ä¼˜åŒ–" class="headerlink" title="æ–‡ç« è·¯å¾„ä¼˜åŒ–"></a>æ–‡ç« è·¯å¾„ä¼˜åŒ–</h5><ol><li><p>å®‰è£…æ’ä»¶<a href="https://github.com/rozbo/hexo-abbrlink" target="_blank" rel="noopener">hexo-abbrlink</a></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-abbrlink --save</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹hexoé…ç½®æ–‡ä»¶<code>_config.yml</code>ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># abbrlink config</span></span><br><span class="line"><span class="attr">abbrlink:</span></span><br><span class="line"><span class="attr">  alg:</span> <span class="string">crc32</span>  <span class="comment">#support crc16(default) and crc32</span></span><br><span class="line"><span class="attr">  rep:</span> <span class="string">hex</span>    <span class="comment">#support dec(default) and hex</span></span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹hexoé…ç½®æ–‡ä»¶<code>_config.yml</code>ï¼Œæ›´æ–°<code>permalink</code>ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">permalink:</span> <span class="string">posts/:abbrlink.html</span></span><br></pre></td></tr></table></figure></li></ol><h5 id="å­—æ•°ç»Ÿè®¡"><a href="#å­—æ•°ç»Ÿè®¡" class="headerlink" title="å­—æ•°ç»Ÿè®¡"></a>å­—æ•°ç»Ÿè®¡</h5><ol><li><p>å®‰è£…æ’ä»¶</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># # Node ç‰ˆæœ¬7.6.0ä¹‹å</span></span><br><span class="line">npm i --save hexo-wordcount</span><br><span class="line"></span><br><span class="line"><span class="comment"># Node ç‰ˆæœ¬7.6.0ä¹‹å‰,è¯·å®‰è£… 2.x ç‰ˆæœ¬ (Node.js v7.6.0 and previous)</span></span><br><span class="line">npm install hexo-wordcount@<span class="number">2</span> --save</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹NexTé…ç½®æ–‡ä»¶<code>_config.yml</code>ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Post wordcount display settings</span></span><br><span class="line"><span class="comment"># Dependencies: https://github.com/willin/hexo-wordcount</span></span><br><span class="line"><span class="attr">post_wordcount:</span></span><br><span class="line"><span class="attr">  item_text:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  wordcount:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  min2read:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  totalcount:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  separated_meta:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li></ol><h5 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h5><ul><li>UMLï¼š<a href="https://github.com/bubkoo/hexo-filter-sequence" target="_blank" rel="noopener">https://github.com/bubkoo/hexo-filter-sequence</a></li><li>Flowchatï¼š<a href="https://github.com/bubkoo/hexo-filter-flowchart" target="_blank" rel="noopener">https://github.com/bubkoo/hexo-filter-flowchart</a></li></ul><h5 id="å…¶ä»–æ’ä»¶"><a href="#å…¶ä»–æ’ä»¶" class="headerlink" title="å…¶ä»–æ’ä»¶"></a>å…¶ä»–æ’ä»¶</h5><blockquote><p>å®˜æ–¹ï¼š<a href="https://github.com/hexojs/hexo/wiki/Plugins" target="_blank" rel="noopener">https://github.com/hexojs/hexo/wiki/Plugins</a></p></blockquote><ul><li>è±†ç“£ï¼š<a href="https://github.com/mythsman/hexo-douban" target="_blank" rel="noopener">https://github.com/mythsman/hexo-douban</a></li><li>éŸ³ä¹ï¼š<a href="https://github.com/MoePlayer/hexo-tag-aplayer" target="_blank" rel="noopener">https://github.com/MoePlayer/hexo-tag-aplayer</a></li><li>disqusä»£ç†ï¼š<a href="https://github.com/ciqulover/disqus-proxy" target="_blank" rel="noopener">https://github.com/ciqulover/disqus-proxy</a></li><li>è·¯å¾„è·³è½¬ï¼š<a href="https://github.com/hexojs/hexo-generator-alias" target="_blank" rel="noopener">https://github.com/hexojs/hexo-generator-alias</a></li><li>å¯¼èˆªç›®å½•ç”Ÿæˆï¼š<a href="https://github.com/bubkoo/hexo-toc" target="_blank" rel="noopener">https://github.com/bubkoo/hexo-toc</a></li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://segmentfault.com/a/1190000009009697" target="_blank" rel="noopener">https://segmentfault.com/a/1190000009009697</a></li></ul>]]></content>
      
        <categories>
            
            <category> tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ä¸ªäººåšå®¢æ­å»ºæŒ‡å—ï¼ˆäºŒï¼‰]]></title>
      <url>/posts/personal-blog-building-guide-2.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>åœ¨ <a href="http://t.cn/RSSaqp7" target="_blank" rel="noopener">ä¸Šç¯‡</a> æ–‡ç« ä¸­æˆ‘ä»¬å­¦ä¼šäº†</p><ul><li>å¦‚ä½•åœ¨è‡ªå·±çš„ç”µè„‘æ­å»ºåšå®¢</li><li>å¦‚ä½•ä½¿ç”¨Markdownè¯­æ³•å†™åšæ–‡</li></ul><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å­¦ä¹ å¦‚ä½•è®©åˆ«äººä¹Ÿèƒ½è®¿é—®ä½ çš„åšå®¢ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬å°†åšå®¢æ”¾åˆ°ä¸€ä¸ªå…¨ä¸–ç•Œäººæ°‘éƒ½èƒ½è®¿é—®çš„åœ°æ–¹å»â€”â€”<a href="https://github.com/" target="_blank" rel="noopener">GitHub</a>ã€‚</p><a id="more"></a><p><img src="https://img.i7years.com/bolg/hexo_public.png" alt="Untitled"></p><blockquote><p>æ³¨æ„ï¼šåœ¨è¿›è¡Œä¸‹é¢çš„æ­¥éª¤å‰ï¼Œè¯·ç¡®ä¿ä½ å·²ç»æŒ‰ç…§ <a href="http://t.cn/RSSaUQt" target="_blank" rel="noopener">http://t.cn/RSSaUQt</a> å®‰è£…å¥½äº†ç¯å¢ƒã€‚å¦åˆ™ï¼Œä½ å°†æ— æ³•å®Œæˆåç»­çš„æ­¥éª¤ã€‚</p></blockquote><h2 id="äº†è§£GitHub-Pages"><a href="#äº†è§£GitHub-Pages" class="headerlink" title="äº†è§£GitHub Pages"></a>äº†è§£GitHub Pages</h2><blockquote><p>GitHub Pages is a static site hosting service.ï¼ˆé™æ€ç«™ç‚¹æ‰˜ç®¡æœåŠ¡ï¼‰</p><p>GitHub Pages is designed to host your personal, organization, or project pages directly from a GitHub repository.</p><p>è¯¦è§ï¼š</p><ul><li><a href="http://t.cn/RI9hsVm" target="_blank" rel="noopener">http://t.cn/RI9hsVm</a></li><li><a href="http://t.cn/zjkgDLe" target="_blank" rel="noopener">http://t.cn/zjkgDLe</a></li></ul></blockquote><h2 id="åˆ›å»ºGitHubä»“åº“"><a href="#åˆ›å»ºGitHubä»“åº“" class="headerlink" title="åˆ›å»ºGitHubä»“åº“"></a>åˆ›å»ºGitHubä»“åº“</h2><blockquote><p>åˆ›å»ºGitHugä»“åº“ï¼Œç”¨äºå­˜æ”¾è‡ªå·±ç”µè„‘ä¸Šçš„åšå®¢ç«™ç‚¹æ–‡ä»¶ï¼Œä¾›ä»–äººè®¿é—®ã€‚</p></blockquote><h5 id="ç™»å½•GitHub"><a href="#ç™»å½•GitHub" class="headerlink" title="ç™»å½•GitHub"></a>ç™»å½•GitHub</h5><ul><li>è´¦å·å‡†å¤‡ï¼Œè§ <a href="http://t.cn/RSSaUQt" target="_blank" rel="noopener">http://t.cn/RSSaUQt</a></li><li>ç™»å½•åœ°å€ï¼š<a href="https://github.com" target="_blank" rel="noopener">https://github.com</a></li></ul><h5 id="åˆ›å»ºGitHub-Pagesä»“åº“"><a href="#åˆ›å»ºGitHub-Pagesä»“åº“" class="headerlink" title="åˆ›å»ºGitHub Pagesä»“åº“"></a>åˆ›å»ºGitHub Pagesä»“åº“</h5><ul><li><p>è®¿é—® <a href="https://github.com/new" target="_blank" rel="noopener">https://github.com/new</a></p><p><img src="https://img.i7years.com/blog/newGitHug.png" alt="newGitHug"></p></li></ul><ul><li><p>åˆ›å»ºä»“åº“(Repository name)</p><p><strong>æ³¨æ„</strong>ï¼šRepository name çš„å‘½åæ ¼å¼ï¼š<code>username.github.io</code>ï¼Œå…¶ä¸­usernameä¸ºä½ çš„githubç™»å½•çš„ç”¨æˆ·åã€‚ä¾‹å¦‚ï¼šæˆ‘çš„githubçš„ç™»å½•åä¸ºBorderTravelerXï¼Œé‚£ä¹ˆæˆ‘çš„GitHub Pagesä»“åº“åç§°ä¸º<code>BorderTravelerX.github.io</code>ï¼Œå¦‚å›¾ï¼ˆ*ä¸ºå¿…å¡«ï¼‰ï¼š</p><p><img src="https://img.i7years.com/bolg/createRep.png" alt=""></p></li><li><p>è·å–GitHub Pagesä»“åº“åœ°å€ï¼Œåé¢æœ‰ç”¨ã€‚</p><blockquote><p>åœ°å€å½¢å¼ï¼š<a href="mailto:`git@github.com" target="_blank" rel="noopener">`git@github.com</a>:usernam/username.github.io.git`</p></blockquote><p><img src="https://img.i7years.com/bolg/copyadress.png" alt="copyadress"></p></li></ul><p>â€‹</p><h5 id="æ·»åŠ SSHå…¬é’¥"><a href="#æ·»åŠ SSHå…¬é’¥" class="headerlink" title="æ·»åŠ SSHå…¬é’¥"></a>æ·»åŠ SSHå…¬é’¥</h5><ul><li><p>æŸ¥è¯¢æœ¬åœ°sshå…¬é’¥</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat  ~/.ssh/id_rsa.pub    <span class="comment"># æŸ¥è¯¢ç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„</span></span><br><span class="line">$ ssh-rsa AAAAB3NzaC1yc2EA4RKxvgPztikVj/YaBXR+AiZPDCpJGh752kw3NMH+lrNhAR5ld919lC4RKxvgPztikip3tbKdFuBgL0CT15JqNB7VIN+kGEN7ggczSAF12PncUVj/YaBXR+AiZPDCpJGhuBK6B3MDIwRpZZWtKcaStJ2Y4CwbsTGFy0WRdyeCWXfXZbyvLw3gMJy9XvB01uPpLcrrm79nDKFkqz5h2DTj7f7h294FtR9XQJH5HoO9bDZdMiEckkBBHaPz4cV8kvjqFxy== wangwei@gmail.com  		    <span class="comment"># è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹å…¬é’¥</span></span><br></pre></td></tr></table></figure></li><li><p>ç™»å½•Github â€”â€”&gt; ç‚¹å‡»å¤´åƒ â€”â€”&gt; Setting â€”â€”&gt; SSH and GPG keys â€”â€”&gt; New SSH Key â€”â€”&gt; å°†ä¸Šä¸€æ­¥æŸ¥è¯¢åˆ°çš„å…¬é’¥å¤åˆ¶åˆ°Keyæ–‡æœ¬æ¡†ä¸­ï¼Œå¹¶å¡«å¥½Title(æ ‡é¢˜ï¼ŒæŒ‰ç…§è‡ªå·±å–œå¥½)â€”â€”&gt; Add SSH Key</p><p><img src="https://img.i7years.com/blog/sshkey.png" alt="sshkey"></p></li></ul><h2 id="ä¸Šä¼ åšå®¢æ–‡ä»¶"><a href="#ä¸Šä¼ åšå®¢æ–‡ä»¶" class="headerlink" title="ä¸Šä¼ åšå®¢æ–‡ä»¶"></a>ä¸Šä¼ åšå®¢æ–‡ä»¶</h2><ol><li>ä¿®æ”¹<code>hexo</code>é…ç½®<code>_config.yml</code>æ–‡ä»¶</li></ol><ul><li><p>æ‰“å¼€ <code>myBlog</code>æ–‡ä»¶å¤¹ä¸‹çš„<code>_config.yml</code>æ–‡ä»¶ã€‚</p><blockquote><p>myBlog ä¸ºä½ çš„hexoç›®å½•åœ°å€</p></blockquote></li><li><p>é…ç½®<code>deploy</code>é¡¹ï¼Œæ›¿æ¢ <code>repo</code>ä¸ºä½ çš„å®é™…ä»“åº“åœ°å€ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">...</span></span><br><span class="line"></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line"><span class="attr">- type:</span> <span class="string">git</span></span><br><span class="line"><span class="attr">  repo:</span> <span class="string">git@github.com:usernam/username.github.io.git</span></span><br><span class="line"><span class="attr">  branch:</span> <span class="string">master</span></span><br><span class="line">  </span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure></li></ul><ol start="2"><li><p>å®‰è£…gitæ’ä»¶</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure></li><li><p>ä¸Šä¼ åšå®¢æ–‡ä»¶</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ cd myBlog							<span class="comment"># è¿›å…¥åšå®¢ç›®å½•</span></span><br><span class="line">$ hexo clean &amp;&amp; hexo g &amp;&amp; hexo d	  <span class="comment"># é‡æ–°ç”Ÿæˆåšå®¢æ–‡ä»¶å¹¶ä¸Šä¼ è‡³GitHub</span></span><br><span class="line"></span><br><span class="line">ç­‰å¾…å‡ºç°å¦‚ä¸‹ä¿¡æ¯ï¼Œè¯´æ˜ä¸Šä¼ æˆåŠŸ</span><br><span class="line">INFO  Deploying: git</span><br><span class="line">INFO  Clearing .deploy_git folder...</span><br><span class="line">INFO  Copying files from public folder...</span><br><span class="line">[master <span class="number">8</span>af93cc] Site updated: <span class="number">2017</span>-<span class="number">06</span>-<span class="number">08</span> <span class="number">18</span>:<span class="number">14</span>:<span class="number">59</span></span><br><span class="line"> <span class="number">11</span> files changed, <span class="number">95</span> insertions(+), <span class="number">87</span> deletions(-)</span><br><span class="line"> rewrite content.json (<span class="number">88</span>%)</span><br><span class="line"> rewrite index.html (<span class="number">61</span>%)</span><br><span class="line"> rewrite <span class="string">"\344\270\252\344\272\272\345\215\232\345\256\242\346\220\255\345\273\272\346\214\207\345\215\227\357\274\210\344\272\214\357\274\211.html"</span> (<span class="number">95</span>%)</span><br><span class="line">To https://github.com/BorderTravelerX/bordertravelerx.github.io.git</span><br><span class="line"> + c9d2efe...<span class="number">8</span>af93cc HEAD -&gt; master (forced update)</span><br><span class="line">Branch master set up to track remote branch master from https://github.com/BorderTravelerX/bordertravelerx.github.io.git.</span><br><span class="line">INFO  Deploy done: git</span><br></pre></td></tr></table></figure></li><li><p>æµè§ˆå™¨è®¿é—®æ–°çš„åšå®¢åœ°å€ï¼šusername.github.ioï¼Œå¦‚æœèƒ½çœ‹åˆ°å’Œä½ æœ¬åœ°ä¸€æ ·çš„é¡µé¢ï¼Œæ­å–œä½ ï¼Œä¸Šä¼ æˆåŠŸã€‚</p><blockquote><p>æ³¨æ„ï¼šusername.github.io ä¸ºä½ çš„å®é™…ä»“åº“åœ°å€</p></blockquote></li></ol><h2 id="åŒæ­¥Githubä»“åº“"><a href="#åŒæ­¥Githubä»“åº“" class="headerlink" title="åŒæ­¥Githubä»“åº“"></a>åŒæ­¥Githubä»“åº“</h2><p>å¦‚æœä½ çš„åšå®¢æœ€ç»ˆæ˜¯éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šçš„ï¼Œå¹¶ä¸”å¸Œæœ› <code>username.github.io</code> ä»“åº“æœ‰ä»£ç æ›´æ–°æ—¶ï¼ŒæœåŠ¡å™¨ä¸Šä¼šè‡ªåŠ¨æ‰§è¡Œ<code>git pull</code> å‘½ä»¤æ¥åŒæ­¥ä»£ç ã€‚è¯·å‚è€ƒï¼š</p><ul><li><a href="https://github.com/olipo186/Git-Auto-Deploy" target="_blank" rel="noopener">https://github.com/olipo186/Git-Auto-Deploy</a></li></ul>]]></content>
      
        <categories>
            
            <category> tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ä¸ªäººåšå®¢æ­å»ºæŒ‡å—ï¼ˆä¸€ï¼‰]]></title>
      <url>/posts/personal-blog-building-guide-1.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><blockquote><p>æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•åœ¨è‡ªå·±çš„ç”µè„‘ä¸Šæ­å»ºåšå®¢ç³»ç»Ÿï¼Œå…ˆå»ºç«‹å°å°çš„æˆå°±æ„Ÿ</p><p>ç³»åˆ—æ–‡ç« ï¼š<a href="http://t.cn/RSSaUQt" target="_blank" rel="noopener">http://t.cn/RSSaUQt</a></p></blockquote><a id="more"></a><h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><h3 id="å®‰è£…node-js"><a href="#å®‰è£…node-js" class="headerlink" title="å®‰è£…node.js"></a>å®‰è£…node.js</h3><blockquote><p>å®˜ç½‘åœ°å€ï¼š<a href="https://nodejs.org/en/" target="_blank" rel="noopener">https://nodejs.org/en/</a></p></blockquote><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install node</span><br></pre></td></tr></table></figure><h4 id="æ£€æµ‹"><a href="#æ£€æµ‹" class="headerlink" title="æ£€æµ‹"></a>æ£€æµ‹</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ node -v</span><br><span class="line">v6.<span class="number">10.0</span></span><br><span class="line"></span><br><span class="line">$ npm -v</span><br><span class="line"><span class="number">3.10</span>.<span class="number">10</span></span><br></pre></td></tr></table></figure><h4 id="åˆ‡æ¢é•œåƒæº"><a href="#åˆ‡æ¢é•œåƒæº" class="headerlink" title="åˆ‡æ¢é•œåƒæº"></a>åˆ‡æ¢é•œåƒæº</h4><blockquote><p>ç”±äºæŸäº›åŸå› ï¼Œç›´æ¥ä»å®˜ç½‘å®‰è£…æ¨¡å—æ¯”è¾ƒæ…¢ï¼Œç»å¸¸æ€§åœ°å®‰è£…å¤±è´¥ï¼Œæœ€å¥½åˆ‡æ¢åˆ°å›½å†…çš„<a href="http://npm.taobao.org/" target="_blank" rel="noopener">æ·˜å®é•œåƒæº</a>æ¥ï¼Œ</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…hexo"><a href="#å®‰è£…hexo" class="headerlink" title="å®‰è£…hexo"></a>å®‰è£…hexo</h3><blockquote><p>æ­å»ºåšå®¢çš„æ ¸å¿ƒæ¡†æ¶ï¼Œé€šè¿‡å®ƒå°±å¯ä»¥è®©æˆ‘ä»¬åœ¨ä¸éœ€è¦ç¼–ç çš„æƒ…å†µä¸‹æ­å»ºå¥½è‡ªå·±çš„åšå®¢ï¼Œå®˜ç½‘åœ°å€ï¼š<a href="https://hexo.io/" target="_blank" rel="noopener">https://hexo.io/</a></p></blockquote><h4 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo npm install hexo-cli -g</span><br></pre></td></tr></table></figure><h4 id="æ£€æµ‹-1"><a href="#æ£€æµ‹-1" class="headerlink" title="æ£€æµ‹"></a>æ£€æµ‹</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ hexo -v</span><br><span class="line">os: Darwin <span class="number">16.6</span>.<span class="number">0</span> darwin x64</span><br><span class="line">http_parser: <span class="number">2.7</span>.<span class="number">0</span></span><br><span class="line">node: <span class="number">6.10</span>.<span class="number">0</span></span><br><span class="line">v8: <span class="number">5.1</span>.<span class="number">281.93</span></span><br><span class="line">uv: <span class="number">1.9</span>.<span class="number">1</span></span><br><span class="line">zlib: <span class="number">1.2</span>.<span class="number">8</span></span><br><span class="line">ares: <span class="number">1.10</span>.<span class="number">1</span>-DEV</span><br><span class="line">icu: <span class="number">58.2</span></span><br><span class="line">modules: <span class="number">48</span></span><br><span class="line">openssl: <span class="number">1.0</span>.<span class="number">2</span>k</span><br></pre></td></tr></table></figure><h2 id="æ­å»ºåšå®¢"><a href="#æ­å»ºåšå®¢" class="headerlink" title="æ­å»ºåšå®¢"></a>æ­å»ºåšå®¢</h2><h3 id="åˆ›å»ºåšå®¢ç›®å½•"><a href="#åˆ›å»ºåšå®¢ç›®å½•" class="headerlink" title="åˆ›å»ºåšå®¢ç›®å½•"></a>åˆ›å»ºåšå®¢ç›®å½•</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ hexo init myBlog  <span class="comment"># myBlog ä¸ºåšå®¢ç›®å½•åç§°ï¼Œåç§°å¯ä¾æ®è‡ªå·±å–œå¥½è‡ªè¡Œå®šä¹‰</span></span><br><span class="line">$ cd myBlog         <span class="comment"># è¿›å…¥åˆ° myBlog ç›®å½•</span></span><br><span class="line">$ npm install       <span class="comment"># å®‰è£…æ¨¡å—</span></span><br></pre></td></tr></table></figure><h3 id="ç”Ÿæˆé»˜è®¤ç½‘é¡µ"><a href="#ç”Ÿæˆé»˜è®¤ç½‘é¡µ" class="headerlink" title="ç”Ÿæˆé»˜è®¤ç½‘é¡µ"></a>ç”Ÿæˆé»˜è®¤ç½‘é¡µ</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo clean &amp;&amp; hexo g</span><br></pre></td></tr></table></figure><h3 id="æµè§ˆå™¨è®¿é—®"><a href="#æµè§ˆå™¨è®¿é—®" class="headerlink" title="æµè§ˆå™¨è®¿é—®"></a>æµè§ˆå™¨è®¿é—®</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ hexo s</span><br><span class="line"></span><br><span class="line">INFO  Hexo is running at http://localhost:<span class="number">4000</span>/. Press Ctrl+C to stop.</span><br></pre></td></tr></table></figure><blockquote><p>æµè§ˆå™¨è®¿é—® <a href="http://localhost:4000/" target="_blank" rel="noopener">http://localhost:4000/</a></p></blockquote><p>å¦‚è‹¥çœ‹åˆ°å¦‚ä¸‹æ•ˆæœï¼Œæ­å–œæ­å»ºæˆåŠŸï¼</p><p><img src="https://img.i7years.com/hexo-default.PNG" alt=""></p><h3 id="å‘è¡¨ä½ çš„ç¬¬ä¸€ç¯‡æ–‡ç« "><a href="#å‘è¡¨ä½ çš„ç¬¬ä¸€ç¯‡æ–‡ç« " class="headerlink" title="å‘è¡¨ä½ çš„ç¬¬ä¸€ç¯‡æ–‡ç« "></a>å‘è¡¨ä½ çš„ç¬¬ä¸€ç¯‡æ–‡ç« </h3><h4 id="åˆ›å»ºåšæ–‡"><a href="#åˆ›å»ºåšæ–‡" class="headerlink" title="åˆ›å»ºåšæ–‡"></a>åˆ›å»ºåšæ–‡</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd myBlog 				 <span class="comment"># è¿›å…¥çš„ä¹‹å‰åˆ›å»ºçš„åšå®¢ç›®å½•ä¸‹</span></span><br><span class="line">$ hexo new <span class="string">"æˆ‘çš„ç¬¬ä¸€ç¯‡åšæ–‡"</span>	<span class="comment"># åˆ›å»ºåšæ–‡</span></span><br></pre></td></tr></table></figure><h4 id="ç¼–è¾‘åšæ–‡å†…å®¹"><a href="#ç¼–è¾‘åšæ–‡å†…å®¹" class="headerlink" title="ç¼–è¾‘åšæ–‡å†…å®¹"></a>ç¼–è¾‘åšæ–‡å†…å®¹</h4><ul><li><p>å­¦ä¹ å‰ç½®æŠ€èƒ½â€”â€”<strong>Markdownè¯­æ³•</strong></p><blockquote><ul><li>Markdown æ˜¯ä¸€ç§<em>ä¹¦å†™</em>çš„æ ¼å¼ï¼Œç”¨Markdownç¼–è¾‘æ–‡æ¡£ï¼Œä¸ä»…ç®€å•ï¼Œè€Œä¸”æ’ç‰ˆæ¸…æ™°æ˜äº†</li><li>Markdown è¯­æ³•å­¦ä¹ åœ°å€ï¼Œæ¨èï¼š<a href="https://maxiang.io/" target="_blank" rel="noopener">https://maxiang.io/</a></li><li>Markdown æ–‡æ¡£ç¼–è¾‘å™¨ï¼Œæ¨èï¼š<a href="http://typora.io" target="_blank" rel="noopener">http://typora.io</a></li></ul></blockquote></li><li><p>ä½¿ç”¨ typora æ‰“å¼€ä¸Šä¸€æ­¥åˆ›å»ºæ–‡æ¡£ <code>æˆ‘çš„ç¬¬ä¸€ç¯‡åšæ–‡.md</code>ï¼Œç›®å½•åœ°å€ï¼š <code>myBlog/source/_posts</code></p></li><li><p>æŒ‰ç…§ä½ æŒæ¡çš„Markdownè¯­æ³•ï¼Œå¼€å§‹å†™æ–‡æ¡£å§</p></li></ul><h4 id="å‘å¸ƒ"><a href="#å‘å¸ƒ" class="headerlink" title="å‘å¸ƒ"></a>å‘å¸ƒ</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cd myBlog</span><br><span class="line">$ hexo clean &amp;&amp; hexo g  <span class="comment"># é‡æ–°æ„å»ºï¼Œç”Ÿæˆé™æ€æ–‡ä»¶</span></span><br><span class="line">$ hexo s                <span class="comment"># å¯åŠ¨åšå®¢æœåŠ¡</span></span><br></pre></td></tr></table></figure><blockquote><p>å†æ¬¡è®¿é—® <a href="http://localhost:4000/" target="_blank" rel="noopener">http://localhost:4000/</a></p></blockquote><h2 id="hexo-å¸¸ç”¨å‘½ä»¤å­¦ä¹ "><a href="#hexo-å¸¸ç”¨å‘½ä»¤å­¦ä¹ " class="headerlink" title="hexo å¸¸ç”¨å‘½ä»¤å­¦ä¹ "></a>hexo å¸¸ç”¨å‘½ä»¤å­¦ä¹ </h2><blockquote><p>è¯¦è§ï¼š<a href="http://t.cn/R5x40qE" target="_blank" rel="noopener">http://t.cn/R5x40qE</a></p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ hexo init [folder]    <span class="comment"># æ–°å»ºä¸€ä¸ªç½‘ç«™</span></span><br><span class="line">$ hexo clean            <span class="comment"># åˆ é™¤æœ¬åœ°é™æ€æ–‡ä»¶</span></span><br><span class="line">$ hexo g            	<span class="comment"># ç”Ÿæˆé™æ€æ–‡ä»¶</span></span><br><span class="line">$ hexo s            	<span class="comment"># æœ¬æœºè¿è¡Œåšå®¢ç³»ç»Ÿ</span></span><br></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[å…³äºå†™ä½œ]]></title>
      <url>/posts/why-we-need-writing.html</url>
      <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="å…³äºå†™ä½œ"><a href="#å…³äºå†™ä½œ" class="headerlink" title="å…³äºå†™ä½œ"></a>å…³äºå†™ä½œ</h1><p>çŸ¥ä¹ä¸Šæœ‰è¿™æ ·ä¸€ä¸ªé—®ç­”ï¼š</p><blockquote><p>å“ªä¸ªç¬é—´è®©ä½ çªç„¶è§‰å¾—è¯»ä¹¦çœŸæœ‰ç”¨ï¼Ÿ</p><blockquote><p>å¼€å§‹çœŸå®åœ°æ„Ÿå—åˆ°è¾“å‡ºçš„æ¯ä¸€å¥è¯éƒ½åœ¨æš´éœ²è¾“å…¥çš„æ—¶å€™</p></blockquote></blockquote><a id="more"></a><p>å¯¹è¿™å¥å›ç­”ï¼Œæˆ‘æ„ŸåŒèº«å—ï¼Œå¯ä»¥è¯´è¿™æ˜¯æˆ‘çš„çœŸå®å†™ç…§ï¼Œæ¯å½“æƒ³è¦å»ç»™åˆ«äººè®²è¿°ä¸€ä¸ªè§‚ç‚¹çš„æ—¶å€™ï¼Œè¦ä¹ˆè¯´å‡ºå»çš„è¯ä¸èƒ½å‡†ç¡®è¡¨è¾¾è‡ªå·±çš„æ„æ€ï¼Œè¦ä¹ˆå°±æ˜¯è¯´ç€è¯´ç€å°±å¡å£³äº†ï¼Œæœ€åä¸å¾—ä¸ä»¥â€åæ­£å°±æ˜¯é‚£æ ·â€æ¥è‰è‰æ”¶åœºï¼Œè¿™ç§å°´å°¬çš„åœºé¢ä¸çŸ¥é‡åˆ°äº†å¤šå°‘å›ã€‚</p><p>é™¤äº†<strong>è¾“å…¥</strong>ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†â€”â€”<strong>å¤„ç†</strong>ï¼Œä¹Ÿå°±æ˜¯æ€è€ƒã€‚</p><p><strong>å†™ä½œï¼Œæ˜¯è¾“å…¥å¤„ç†åçš„è¾“å‡º</strong>ï¼Œæ˜¯é”»ç‚¼è¾“å…¥è´¨é‡åŠå¤„ç†è´¨é‡æœ€ç›´æ¥æœ€æœ‰æ•ˆçš„æ–¹å¼ï¼Œæ²¡æœ‰ä¹‹ä¸€ã€‚</p><p>å…¬ä¼—å·ã€æˆ‘çš„ä¸ƒå¹´ã€ï¼Œè¿™é‡Œå°†ç”¨æ¥è®°å½•è‡ªå·±æˆé•¿è¿‡ç¨‹ä¸­çš„æ‰€æ€æ‰€æƒ³ï¼Œå†…å®¹ä¸»è¦æ¶‰åŠä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><ul><li>æœ‰å…³ä¸€æœ¬å¥½ä¹¦æˆ–è€…ä¸€ç¯‡å¥½æ–‡çš„é˜…è¯»æ€è€ƒç¬”è®°ï¼›</li><li>è‡ªå·±å­¦åˆ°æ–°çŸ¥è¯†ã€æ–°è§‚å¿µã€æ–°æ–¹æ³•è®ºåŠäº²èº«è·µè¡Œçš„ä¸€äº›æ„Ÿæ‚Ÿï¼›</li><li>å¯¹æ—¥å¸¸ç”Ÿæ´»ä¸­æ‰€è§‚å¯Ÿåˆ°çš„è¡¨è±¡åŠèƒŒåé€»è¾‘ä¸åŸå› çš„æ€è€ƒï¼›</li></ul><p>åŒæ—¶ï¼Œå¸Œæœ›é€šè¿‡å†™ä½œæ¥è¾¾åˆ°ä»¥ä¸‹å‡ ä¸ªç›®çš„ï¼š</p><ul><li><p><strong>å€’é€¼è‡ªå·±çš„è¾“å…¥è´¨é‡ä»¥åŠæ€è€ƒè´¨é‡</strong>ã€‚è€Œæˆ‘è‡ªå·±åœ¨ç‹¬ç«‹æ€è€ƒã€æ·±å…¥æ€è€ƒæ–¹é¢æ˜¯éå¸¸éå¸¸éå¸¸æ¬ ç¼ºçš„ä¸€ä¸ªäººï¼Œè¿‡å»å¸¸å¸¸è¡¨ç°ä¸ºï¼Œçœ‹å®Œä¸€ç¯‡å¥½æ–‡ç« ï¼Œå¿ƒæƒ³ï¼šâ€å“‡ï¼å†™çš„ä¸é”™ï¼æœ‰é“ç†ï¼â€ ç„¶åç‚¹å‡»â€åˆ†äº«åˆ°æœ‹å‹åœˆâ€æˆ–è€…â€ä¿å­˜åˆ°å°è±¡ç¬”è®°â€ï¼Œåˆå¦‚ï¼Œåœ¨çœ‹ä¸€æœ¬ä¹¦çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¼šå»æ‘˜å½•ä¹¦ä¸­è§‰å¾—æœ‰é“ç†çš„å¥å­å’Œæ®µè½ï¼Œè¡¨ç¤ºè‡ªå·±å·²ç»â€è®¤çœŸâ€åœ°çœ‹è¿‡è¿™æœ¬ä¹¦äº†ã€‚ä½†æ˜¯æå°‘ä¼šä¸»åŠ¨å»æ€è€ƒä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p><blockquote><p>ä½œè€…ä¸»è¦è®²äº†äº›ä»€ä¹ˆï¼Ÿä½œè€…çš„è§‚ç‚¹æ˜¯å¦æœ‰é“ç†ï¼Ÿå“ªäº›è§‚ç‚¹ä¸åŒæ„ï¼Œä½ çš„åŸå› æˆ–è®ºæ®æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>ä½œè€…æ˜¯å¦‚ä½•è®ºè¯è‡ªå·±çš„è§‚ç‚¹çš„ï¼Ÿè®ºè¯çš„æ€è·¯åˆæ˜¯å¦‚ä½•ï¼Ÿ</p><p>è®ºè¯çš„è¿‡ç¨‹ä¸­ç”¨åˆ°äº†å“ªäº›ç´ æï¼Ÿè¿™äº›ç´ æè¿˜å¯ä»¥ç”¨åˆ°å…¶å®ƒä»€ä¹ˆåœ°æ–¹å»ï¼Ÿ</p><p>ä»ä¸­æˆ‘èƒ½å­¦åˆ°äº›ä»€ä¹ˆï¼Ÿå¦‚ä½•èƒ½è·Ÿæˆ‘å·²æœ‰çš„çŸ¥è¯†ç»“åˆèµ·æ¥ï¼Ÿ</p><p>å¦‚ä½•å°†æ–‡ä¸­çš„è§‚ç‚¹å’Œé“ç†å†…åŒ–åˆ°è‡ªå·±çš„è¡ŒåŠ¨ä¸­æ¥ï¼Œè¿›è€Œå»æ”¹å˜è‡ªå·±çš„ç”Ÿæ´»ï¼Ÿ</p></blockquote><p>â€‹</p><p>åœ¨æ¥ä¸‹æ¥çš„å‡ å¹´é‡Œï¼Œæˆ‘å°†ä¼šç³»ç»Ÿæ€§åœ°å­¦ä¹ æ¦‚ç‡è®ºä¸æ•°ç†ç»Ÿè®¡ã€å†å²æ–¹æ³•è®ºã€é€»è¾‘å­¦ã€å¿ƒç†å­¦(å°¤å…¶æ˜¯è®¤çŸ¥å¿ƒç† å­¦)ã€ç»æµå­¦ç­‰çŸ¥è¯†ï¼Œç»™è‡ªå·±çš„æ“ä½œç³»ç»Ÿåšå‡ æ¬¡é‡å¤§çš„å‡çº§ï¼Œä¸ºè‡ªå·±å»ºç«‹ä¸€ä¸ªå®Œæ•´çš„çŸ¥è¯†ä½“ç³»æ¡†æ¶ï¼Œå»å¸®åŠ©è‡ªå·±çªç ´æ€è€ƒè´¨é‡ä¸Šçš„å±€é™ã€‚ä¸€ä¸ªäººçš„æ€è€ƒè´¨é‡å‡ ä¹å†³å®šç€ä»–çš„ç”Ÿæ´»è´¨é‡ï¼Œæ€è€ƒå†³å®šé€‰æ‹©ï¼Œé€‰æ‹©å†³å®šå‘½è¿ã€‚åªæœ‰æ€è€ƒä¸Šçš„è¿›æ­¥ï¼Œæ‰æ˜¯æ ¹æœ¬ä¸Šçš„è¿›æ­¥ã€‚â€‹</p></li><li><p><strong>æ›´åŠ æ¸…é†’åœ°è®¤è¯†è‡ªå·±</strong>ã€‚å†™ä½œæ˜¯ä¸€ä¸ªä¸æ–­æ¢ç´¢è‡ªå·±ï¼Œä¸æ–­ä¸è‡ªå·±å¯¹è¯çš„è¿‡ç¨‹ï¼Œé€šè¿‡å†™ä½œå»å‘æ˜å†…å¿ƒæœ€çœŸå®çš„æƒ³æ³•ï¼Œå»äº†è§£è‡ªå·±çœŸæ­£çš„åˆšéœ€æ˜¯ä»€ä¹ˆï¼ŒçŸ¥é“ä»€ä¹ˆæ˜¯å¥½çš„ï¼Œä»€ä¹ˆæ˜¯æ›´å¥½çš„ï¼Œä»€ä¹ˆæ˜¯æ˜¯æœ€å¥½çš„ï¼ŒçŸ¥é“ä»€ä¹ˆäº‹æƒ…ç»å¯¹ä¸èƒ½åšï¼Œä»€ä¹ˆäº‹æƒ…ä¸€å®šè¦åšåˆ°åº•ï¼Œè®©è‡ªå·±åœ¨é¢ä¸´ç”Ÿæ´»ä¸­å„ç§å„æ ·çš„é€‰æ‹©æ—¶ï¼Œèƒ½å¤Ÿè‡ªç„¶è€Œç„¶åœ°åšå‡ºç¬¦åˆè‡ªå·±<strong>ä»·å€¼è§‚</strong>çš„é€‰æ‹©ï¼Œè€Œä¸è‡³äºèµ°ä¸Šè¿å¿ƒçš„å²”è·¯ã€‚</p></li></ul><ul><li><strong>æå‡è‡ªå·±çš„è¡¨è¾¾èƒ½åŠ›ä¸æ²Ÿé€šèƒ½åŠ›</strong>ã€‚å†™ä½œå¹¶ä¸åªæ˜¯ä½œè€…çš„å•å‘è¾“å‡ºï¼Œ æ›´å¤šçš„æ˜¯ä½œè€…ä¸è¯»è€…ä¹‹é—´åŒå‘æ²Ÿé€šçš„è¿‡ç¨‹ï¼Œä½œè€…éœ€è¦ç«™åœ¨è¯»è€…çš„è§’åº¦å»å®¡è§†è‡ªå·±çš„æ–‡ç« ï¼Œåæ€è‡ªå·±æœ‰æ²¡æœ‰å°†è‡ªå·±çš„è§‚ç‚¹æ¸…æ™°åœ°è¡¨è¾¾ç»™å¯¹æ–¹ï¼Œè€Œå¯¹æ–¹æ˜¯ä¸æ˜¯èƒ½å¤Ÿæ¸…æ¥šä¸”æ­£ç¡®åœ°ç†è§£è‡ªå·±æ‰€è¡¨è¾¾çš„æ„æ€ã€‚åœ¨è¡¨è¾¾èƒ½åŠ›å’Œæ²Ÿé€šèƒ½åŠ›æ–¹é¢æˆ‘ä¹Ÿæ˜¯éå¸¸æ¬ ç¼ºçš„ä¸€ä¸ªäººï¼Œå¸Œæœ›é€šè¿‡æŒç»­ä¸æ–­çš„å†™ä½œæ¥æå‡è‡ªå·±çš„è¯­è¨€ç»„ç»‡èƒ½åŠ›ï¼Œè®©è‡ªå·±çš„æƒ³æ³•å’Œè§‚ç‚¹èƒ½å¤Ÿæ¸…æ™°ä¸”æ­£ç¡®åœ°è¡¨è¾¾å‡ºæ¥ã€‚åŒæ—¶ï¼Œé€šè¿‡æˆ‘çš„æ–‡ç« å¯ä»¥è®©èº«è¾¹çš„æœ‹å‹ã€åŒäº‹ä»¥åŠå®¶äººæ›´å¥½åœ°äº†è§£æˆ‘ã€‚</li></ul><ul><li><strong>æ›´å¥½åœ°æ¶ˆåŒ–æ‰€å­¦çš„ä¸œè¥¿</strong>ã€‚é€šè¿‡å†™ä½œå¯ä»¥æ¢³ç†è‡ªå·±çš„çŸ¥è¯†ä½“ç³»ï¼Œå°†å„ä¸ªçŸ¥è¯†ç‚¹ä¸²è”èµ·æ¥ï¼Œæœ‰åŠ©äºå¤§è„‘å†…éƒ¨å½¢æˆæ›´åŠ ç¨³å›ºçš„è®°å¿†ç»„å—ï¼Œä¾¿äºæˆ‘æ›´å¥½åœ°ç†è§£æ‰€å­¦çš„ä¸œè¥¿ã€‚å¦å¤–ï¼Œæˆ‘ä¹Ÿå¾ˆä¹æ„å°†è‡ªå·±æ‰€å­¦åˆ°çŸ¥è¯†ã€è§‚ç‚¹å’ŒæŠ€èƒ½æ•´ç†åˆ†äº«å‡ºæ¥ï¼Œä¸€æ–¹é¢å› ä¸º<strong>æ•™æ˜¯æœ€å¥½çš„å­¦ä¹ æ–¹æ³•</strong>ï¼Œå¦ä¸€æ–¹é¢é€šè¿‡å¤§å®¶çš„åé¦ˆå¯ä»¥å‘ç°è‡ªèº«æ€ç»´ä¸Šçš„å±€é™å’Œè®¤çŸ¥çš„ä¸è¶³ï¼Œè¿™ä¸€ç‚¹å°¤ä¸ºé‡è¦ï¼Œæœ€æ€•çš„å°±æ˜¯ï¼Œä¸çŸ¥é“è‡ªå·±ä¸çŸ¥é“ã€‚</li></ul><p>åƒé‡Œä¹‹è¡Œå§‹äºè¶³ä¸‹ã€‚åœ¨ä»Šåçš„å²æœˆé‡Œï¼Œæˆ‘æ„¿å€¾æ³¨æˆ‘å¤§éƒ¨åˆ†é—²æš‡æ—¶é—´åœ¨è‡ªå·±çš„ä¸€äº©ä¸‰åˆ†åœ°ä¸Šè¾›å‹¤åœ°è€•ä½œï¼Œä»¥<strong>æŒç»­å­¦ä¹ ã€ä¸æ–­ç§¯ç´¯</strong>ä¸ºå®—æ—¨ï¼Œä»¥è¾“å‡ºå¸¦åŠ¨è¾“å…¥ï¼Œä»¥è¡ŒåŠ¨é©±åŠ¨æ¢¦æƒ³ï¼Œç§å‡ºè‡ªå·±æƒ³è¦çš„ç¡•æœã€‚</p>]]></content>
      
        <categories>
            
            <category> writing </category>
            
        </categories>
        
        
        <tags>
            
            <tag> å†™ä½œ </tag>
            
        </tags>
        
    </entry>
    
  
  
</search>
