<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>维新工坊 - 与时间做朋友</title><meta name="author" content="Wang Wei"><meta name="copyright" content="Wang Wei"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta property="og:type" content="website">
<meta property="og:title" content="维新工坊">
<meta property="og:url" content="https://wangwei.one/page/5/index.html">
<meta property="og:site_name" content="维新工坊">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://wangwei.one/images/avatar.png">
<meta property="article:author" content="Wang Wei">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wangwei.one/images/avatar.png"><link rel="shortcut icon" href="/images/favicon-180x180.png"><link rel="canonical" href="https://wangwei.one/page/5/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//s4.cnzz.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-112239883-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-112239883-1');
</script><script async="async" data-pjax="data-pjax" src="https://s4.cnzz.com/z_stat.php?id=1270083794&amp;web_id=1270083794"></script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '维新工坊',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2022-03-11 14:31:04'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/lib/css/particles-style.min.css"><meta name="generator" content="Hexo 6.0.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">74</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">39</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">4</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-th"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/books/"><i class="fa-fw fas fa-book"></i><span> 阅读</span></a></div><div class="menus_item"><a class="site-page" href="/movies/"><i class="fa-fw fas fa-film"></i><span> 电影</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-user"></i><span> 关于</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('/images/banner/index.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">维新工坊</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-th"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/books/"><i class="fa-fw fas fa-book"></i><span> 阅读</span></a></div><div class="menus_item"><a class="site-page" href="/movies/"><i class="fa-fw fas fa-film"></i><span> 电影</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-user"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">维新工坊</h1><div id="site-subtitle"><span id="subtitle"></span></div><div id="site_social_icons"><a class="social-icon" href="https://github.com/wangweiX" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:dzd5ZWFyc0BnbWFpbC5jb20NCg==" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/posts/netty-channel-source-analyse.html" title="Netty Channel 源码分析"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Netty Channel 源码分析"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/netty-channel-source-analyse.html" title="Netty Channel 源码分析">Netty Channel 源码分析</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2017-04-23T06:47:12.000Z" title="Created 2017-04-23 14:47:12">2017-04-23</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/coding/">coding</a></span></div><div class="content">



前面，我们大致了解了 Netty 中的几个核心组件。今天我们就来先来介绍 Netty 的网络通信组件，用于执行网络 I/O 操作 —— Channel。



Netty 版本：4.1.30

概述数据在网络中总是以字节的形式进行流通。我们在进行网络编程时选用何种传输方式编码（OIO、NIO 等）决定了这些字节的传输方式。
在没有 Netty 之前，为了提升系统的并发能力，从 OIO 切换到 NIO 时，需要对代码进行大量的重构，因为相应的 Java NIO 与 IO API 大不相同。而 Netty 在这些 Java 原生 API 的基础上做了一层封装，对用户提供了高度抽象而又统一的 API，从而让传输方式的切换不在变得困难，只需要直接使用即可，而不需要对整个代码进行重构。
Netty Channel UMLnetty channel 族如下：

整个族群中，AbstractChannel 是最为关键的一个抽象类，从它继承出了 AbstractNioChannel、AbstractOioChannel、AbstractEpollChannel、LocalChannel、Emb ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/posts/netty-core-assembly-intro.html" title="Netty 核心组件介绍"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Netty 核心组件介绍"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/netty-core-assembly-intro.html" title="Netty 核心组件介绍">Netty 核心组件介绍</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2017-04-09T14:27:12.000Z" title="Created 2017-04-09 22:27:12">2017-04-09</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/coding/">coding</a></span></div><div class="content">



前面，我们学习了 Netty 的基本 原理和架构 ，今天我们来大致了解一下 Netty 中的各个组件。


同我们 前面 学习 IO 与 NIO 一样的套路，我们先通过 echo 服务 demo 来学习 netty 的使用。

开发环境
JDK &gt;= 8
Netty 4.1.29.Final

编写 Echo Server 代码Netty 服务端的开发主要有以下两个步骤：

至少有一个 ChannelHandler —— 这个主要用于处理从 client 端接受到的信息，是主要的业务逻辑处理类。
Bootstrapping ——  用于配置服务的启动代码。最简单的就是，监听一个端口。

实现 EchoServerHandler 逻辑服务端用于处理入站的网络请求，因此我们需要实现接口类 ChannelInboundHandler，它里面定义了用于
处理入站请求的一些接口。由于我们这个例子比较简单，只需要用到它的几个方法即可，因此我们的实现类只需要继承子类 ChannelInboundHandlerAdapter 即可，它默认实现了 ChannelInboundHandler ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/posts/netty-base-theory-intro.html" title="Netty 基本原理介绍"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Netty 基本原理介绍"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/netty-base-theory-intro.html" title="Netty 基本原理介绍">Netty 基本原理介绍</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2017-04-02T13:45:12.000Z" title="Created 2017-04-02 21:45:12">2017-04-02</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/coding/">coding</a></span></div><div class="content">



此前，我们学习了 Java NIO API 的使用，也学习了几种常见的 IO 模型 以及传统阻塞 I/O 服务模型和 Reactor 线程模型 。你体会到直接去使用 Java NIO API 去进行网络编程会非常麻烦，除了要对 Java NIO API 掌握的非常熟练之外，还需要掌握多线程等其他技术。不过这些问题，Netty 都可以帮我们解决。


Netty 是一个 NIO 客户端服务器框架，可以快速轻松地开发协议服务器和客户端等网络应用程序。 它极大地简化了 TCP 和 UDP 套接字服务器等网络编程的复杂度。
『快速而又简单』并不意味着最终的应用程序会受到可维护性或性能问题的影响。 Netty 经过精心设计，具有丰富的协议，如 FTP，SMTP，HTTP 以及各种二进制和基于文本的传统协议。 因此，Netty 成功地找到了一种在不妥协的情况下实现易于开发，性能，稳定性和灵活性的方法。
服务端 IO 编程传统的 BIO 编程网络编程的基本模型是 Client/Server 模型，也就是两个进程之间进行相互通信，其中服务端提供位置信息（绑定的 IP 地址和监听端口），客户端通 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/posts/good-tool-list.html" title="好用的工具清单"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="好用的工具清单"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/good-tool-list.html" title="好用的工具清单">好用的工具清单</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2016-12-02T08:02:36.000Z" title="Created 2016-12-02 16:02:36">2016-12-02</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/tools/">tools</a></span></div><div class="content">



发现好东西，遇见好…… 分享自己日常工作与生活中经常使用的工具、app 以及网站。


实体物件


一级
二级
类目



电子产品
苹果
 MacBook ProiPhoneiPad ProApple WatchiMac Pro



阅读
 Kindle Oasis


应用程序


一级
二级
类目



制图
流程图 / UML / 原型 
OmniGraffleStarUMLAxure RP 9


 图片处理
截图拼接 
Tailor


 个人管理
时间管理 
aTimelogger2



 任务管理 
OmniFocusThings



 精力管理
冥想：Insight Timer 专注：Forest 睡眠：SleepTown



 运动健身 
Keep


 团队协作
项目管理 
OmniPlan



 文档协作 
TeambitionTower石墨文档


记录
写作 
TyporaOmniOutlinerevernoteBearMindNode讯飞语录


阅读
电子书籍管理
 iBookscalibre


 安全
账号密码安全 
authy1 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/posts/java-8-new-feature-base-intro.html" title="Java8 新特性介绍"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java8 新特性介绍"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/java-8-new-feature-base-intro.html" title="Java8 新特性介绍">Java8 新特性介绍</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2016-07-01T14:00:00.000Z" title="Created 2016-07-01 22:00:00">2016-07-01</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/coding/">coding</a></span></div><div class="content">



Java 8 于 2014 年 3 月份发布，新版本增添很多不错的特性，本篇文章我们一起纵览一下这些新特性，后面的文章我们将会一一详细讨论。


Java8 介绍促使 Java 做出重大改变的动力主要来源于：

代码可读性
多核运行

代码可读性Java 代码非常的啰嗦冗长，导致了代码可读性的下降，换句话说，需要很多额外的代码来解释一段很小的内容。例如，现在有个需求，要按照发票金额的数量倒序排序发票列表。在 Java 8 之前，你可能需要这么处理：
12345Collections.sort(invoices, new Comparator&lt;Invoice&gt;() {    public int compare(Invoice inv1, Invoice inv2) {    	return Double.compare(inv2.getAmount(), inv1.getAmount());   }});

而在 Java8 中，你只需要这样即可：
1invoices.sort(comparingDouble(Invoice::getAmount).reversed ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/posts/jvm-gc-concurrent-mark-sweep-cms.html" title="Concurrent Mark Sweep(CMS)"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Concurrent Mark Sweep(CMS)"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/jvm-gc-concurrent-mark-sweep-cms.html" title="Concurrent Mark Sweep(CMS)">Concurrent Mark Sweep(CMS)</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2016-06-20T02:11:01.000Z" title="Created 2016-06-20 10:11:01">2016-06-20</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/coding/">coding</a></span></div><div class="content">



前面 我们介绍了 Serial GC 与 Parallel GC 的使用与配置，今天我们来介绍 Concurrent Mark Sweep（CMS） 收集器。


概述CMS (Concurrent Mark and Sweep 并发 - 标记 - 清除)，是一款基于并发、使用 mark-sweep (标记 - 清理) 算法的垃圾回收算法，只针对老年代进行垃圾回收。CMS 收集器工作时，尽可能让 GC 线程和用户线程并发执行，以达到降低 STW 时间的目的。
CMS 收集器的主要目的：减少老年代垃圾收集的停顿时间。主要通过两种手段来达成此目的：

不对老年代进行整理，而是使用空闲列表 (free-list) 来管理内存空间的回收。
在 mark-sweep 阶段采用并发方式与用户线程一起执行。

启动参数：
1XX:+UseConcMarkSweepGC



控制参数
-XX:+UseConcMarkSweepGC：新生代使用并行收集器，老年代使用 CMS + 串行收集器。

-XX:+ParallelCMSThreads：设定 CMS 的线程数量。

-XX:+CMSIni ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/posts/jvm-gc-serial-and-parallel.html" title="Serial GC 与 Parallel GC"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Serial GC 与 Parallel GC"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/jvm-gc-serial-and-parallel.html" title="Serial GC 与 Parallel GC">Serial GC 与 Parallel GC</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2016-06-17T13:19:09.000Z" title="Created 2016-06-17 21:19:09">2016-06-17</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/coding/">coding</a></span></div><div class="content">



前面 我们学习了 JVM 中几种常用的 GC 算法，今天我们来学习一下 JVM 中实现这些算法的垃圾收集器。大多数 JVM 都需要使用两种不同的 GC 算法 —— 一种用来清理年轻代，另一种用来清理老年代。


分类我们可以从以下几个不同的角度来对 GC 收集器进行分类：

按线程数分，可以分为串行垃圾回收器和并行垃圾回收器。
串行垃圾回收器一次只使用一个线程进行垃圾回收；
并行垃圾回收器一次将开启多个线程同时进行垃圾回收。在并行能力较强的 CPU 上，使用并行垃圾回收器可以缩短 GC 的停顿时间。


按照工作模式分，可以分为并发式垃圾回收器和独占式垃圾回收器。
并发式垃圾回收器与应用程序线程交替工作，以尽可能减少应用程序的停顿时间；
独占式垃圾回收器 (Stop the world) 一旦运行，就停止应用程序中的其他所有线程，直到垃圾回收过程完全结束。


按碎片处理方式可分为压缩式垃圾回收器和非压缩式垃圾回收器。
压缩式垃圾回收器会在回收完成后，对存活对象进行压缩整理，消除回收后的碎片；
非压缩式的垃圾回收器不进行这步操作。


按工作的内存区间，又可分为新生代垃圾回收器 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/posts/jvm-gc-arithmetic-intro.html" title="GC 算法介绍"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="GC 算法介绍"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/jvm-gc-arithmetic-intro.html" title="GC 算法介绍">GC 算法介绍</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2016-06-14T05:29:12.000Z" title="Created 2016-06-14 13:29:12">2016-06-14</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/coding/">coding</a></span></div><div class="content">



前面我们了解了 Java7 与 Java8 的内存模型，接下里我们要学习 JVM 是如何回收对象所占用的内存的，本文先为你介绍三种常用的 GC 算法。


概述常用的 GC 算法主要有三种：标记-清除算法、标记-整理算法、复制算法。还有一种分代收集算法，这种算法无非就是对内存的不同区域使用前面三种不同的算法。
这三种 GC 算法总体而言，都专注于干两件事情：

标记所有存活的对象。在垃圾收集中有一个叫做 标记 (Marking) 的过程专门干这件事。
清除所有死对象。这三种算法的区别就在于清理死对象的实现方式上。

标记可达对象 (Marking Reachable Objects)现代 JVM 中所有的 GC 算法，第一步都是找出所有存活的对象，如图所示：

GC Roots前面 讲了 GC 中 根 (GC Roots) 的概念：

指的是指向对象指针的” 起点”。

可作为 GC Roots 的节点主要在全局性的引用（例如常量或类静态属性）与执行上下文（例如栈帧中的本地变量表）中，主要包括：

在虚拟机栈（栈帧中的本地变量表）中应用的对象，譬如各个线程被调用的方法堆栈中使用 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/posts/jvm-gc-base-concept.html" title="GC 基本概念"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="GC 基本概念"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/jvm-gc-base-concept.html" title="GC 基本概念">GC 基本概念</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2016-06-12T05:29:12.000Z" title="Created 2016-06-12 13:29:12">2016-06-12</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/coding/">coding</a></span></div><div class="content">



在了解 GC 算法 之前，我们需要先来了解一些与算法有关的基本概念。


目录
GC 的定义
对象 / 头 / 域
指针
 mutator
 堆
活动对象 / 非活动对象
分配 (allocation)
 分块 (chunk)
 根 (root)
 吞吐量 (throughput)
 最大暂停时间
堆使用效率
访问局部性

GC 的定义GC 是 Garbage Collection 的简称，也就是垃圾收集
Garbage Collector：垃圾收集器
Minor GC：小型 GC
Major GC：大型 GC
Full GC：完全 GC（为了清晰起见，一般直接译为 Full GC）
对象 / 头 / 域对象在 GC 的世界中，对象表示的是 “通过应用程序利用的数据的集合”。对象配置在内存空间里。GC 根据情况将配置好的对象进行移动或销毁操作。因此，对象是 GC 的基本单位。
对象由头（header）和域（field）构成。在对象内部，头之后存在 1 个及 1 个以上的域。如图 1.1 所示：

头用于保存对象本身信息，主要含有以下信息：

对象的大小
对象的种类

域对象使用 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/posts/java8-jvm-metaSpace.html" title="Java8 MetaSpace 介绍"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java8 MetaSpace 介绍"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/java8-jvm-metaSpace.html" title="Java8 MetaSpace 介绍">Java8 MetaSpace 介绍</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2016-06-11T04:23:19.000Z" title="Created 2016-06-11 12:23:19">2016-06-11</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/coding/">coding</a></span></div><div class="content">



前面 我们学习了 Java7 的内存模型，重点了解了它的 Runtime Data Area，今天我们要来学习一下 Java8 HotSpot (TM) VM 内存模型，看看它与 Java7 VM 存在哪些差异。


与 Java7 相比较，Java8 VM 的一个重大更新：完全移除永久代（PermGen），取而代之的为元空间（Metaspace）。
![Java8 VM MetaSpace](https://img.i7years.com/blog/Java8 VM MetaSpace.png)
为什么要移除 PermGen
来源：http://openjdk.java.net/jeps/122

Jon Masamitsu 对此的解释如下：

A goal for removing perm gen was so that users do not have to think about correctly sizing it.
Set MetaspaceSize to a value larger than the default, if you know that yo ...</div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/4/#content-inner"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/#content-inner">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/#content-inner">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/#content-inner">8</a><a class="extend next" rel="next" href="/page/6/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Wang Wei</div><div class="author-info__description"></div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">74</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">39</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">4</div></a></div></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/wangweiX" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:dzd5ZWFyc0BnbWFpbC5jb20NCg==" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/spring-cloud-eureka-source-code-analysis.html" title="SpringCloud 之 Eureka 源码分析"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringCloud 之 Eureka 源码分析"/></a><div class="content"><a class="title" href="/posts/spring-cloud-eureka-source-code-analysis.html" title="SpringCloud 之 Eureka 源码分析">SpringCloud 之 Eureka 源码分析</a><time datetime="2021-03-31T16:00:00.000Z" title="Created 2021-04-01 00:00:00">2021-04-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/jvm-gc-garbage-first.html" title="Garbage-First(G1)"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Garbage-First(G1)"/></a><div class="content"><a class="title" href="/posts/jvm-gc-garbage-first.html" title="Garbage-First(G1)">Garbage-First(G1)</a><time datetime="2020-01-01T10:19:03.000Z" title="Created 2020-01-01 18:19:03">2020-01-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/netflix-guide.html" title="输入「神秘代码」解锁「隐藏类目」"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="输入「神秘代码」解锁「隐藏类目」"/></a><div class="content"><a class="title" href="/posts/netflix-guide.html" title="输入「神秘代码」解锁「隐藏类目」">输入「神秘代码」解锁「隐藏类目」</a><time datetime="2019-04-17T00:12:00.000Z" title="Created 2019-04-17 08:12:00">2019-04-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/How-to-change-icloud-region.html" title="数据移民漂流记 —— 如何进行 iCloud 转区操作"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数据移民漂流记 —— 如何进行 iCloud 转区操作"/></a><div class="content"><a class="title" href="/posts/How-to-change-icloud-region.html" title="数据移民漂流记 —— 如何进行 iCloud 转区操作">数据移民漂流记 —— 如何进行 iCloud 转区操作</a><time datetime="2019-04-13T13:48:43.000Z" title="Created 2019-04-13 21:48:43">2019-04-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/How-to-register-and-use-the-Google-Voice.html" title="数据移民漂流记 —— 如何拥有属于自己的美国电话号码"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数据移民漂流记 —— 如何拥有属于自己的美国电话号码"/></a><div class="content"><a class="title" href="/posts/How-to-register-and-use-the-Google-Voice.html" title="数据移民漂流记 —— 如何拥有属于自己的美国电话号码">数据移民漂流记 —— 如何拥有属于自己的美国电话号码</a><time datetime="2019-04-12T13:48:43.000Z" title="Created 2019-04-12 21:48:43">2019-04-12</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>Categories</span>
            
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/blockchain/"><span class="card-category-list-name">blockchain</span><span class="card-category-list-count">13</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/coding/"><span class="card-category-list-name">coding</span><span class="card-category-list-count">47</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/tools/"><span class="card-category-list-name">tools</span><span class="card-category-list-count">13</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/writing/"><span class="card-category-list-name">writing</span><span class="card-category-list-count">1</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>Tags</span></div><div class="card-tag-cloud"><a href="/tags/AlgoDS/" style="font-size: 1.46em; color: #99a7bb">AlgoDS</a> <a href="/tags/Design-Patterns/" style="font-size: 1.19em; color: #999da1">Design Patterns</a> <a href="/tags/DevOps/" style="font-size: 1.1em; color: #999">DevOps</a> <a href="/tags/Docker/" style="font-size: 1.14em; color: #999b9d">Docker</a> <a href="/tags/Elliptic-Curve/" style="font-size: 1.1em; color: #999">Elliptic Curve</a> <a href="/tags/Eureka/" style="font-size: 1.1em; color: #999">Eureka</a> <a href="/tags/GC/" style="font-size: 1.28em; color: #99a0aa">GC</a> <a href="/tags/IO/" style="font-size: 1.14em; color: #999b9d">IO</a> <a href="/tags/JVM/" style="font-size: 1.32em; color: #99a2ae">JVM</a> <a href="/tags/Java11/" style="font-size: 1.1em; color: #999">Java11</a> <a href="/tags/Java8/" style="font-size: 1.14em; color: #999b9d">Java8</a> <a href="/tags/JavaScript/" style="font-size: 1.1em; color: #999">JavaScript</a> <a href="/tags/Kindle/" style="font-size: 1.1em; color: #999">Kindle</a> <a href="/tags/LRU/" style="font-size: 1.1em; color: #999">LRU</a> <a href="/tags/LeetCode/" style="font-size: 1.32em; color: #99a2ae">LeetCode</a> <a href="/tags/Linux/" style="font-size: 1.1em; color: #999">Linux</a> <a href="/tags/Mac/" style="font-size: 1.1em; color: #999">Mac</a> <a href="/tags/Merkle-Tree/" style="font-size: 1.1em; color: #999">Merkle Tree</a> <a href="/tags/NIO/" style="font-size: 1.41em; color: #99a5b7">NIO</a> <a href="/tags/Netflix/" style="font-size: 1.1em; color: #999">Netflix</a> <a href="/tags/Netty/" style="font-size: 1.37em; color: #99a4b2">Netty</a> <a href="/tags/NodeJs/" style="font-size: 1.1em; color: #999">NodeJs</a> <a href="/tags/RocksDB/" style="font-size: 1.1em; color: #999">RocksDB</a> <a href="/tags/SPV/" style="font-size: 1.1em; color: #999">SPV</a> <a href="/tags/SpringCloud/" style="font-size: 1.1em; color: #999">SpringCloud</a> <a href="/tags/Token/" style="font-size: 1.1em; color: #999">Token</a> <a href="/tags/Tool/" style="font-size: 1.1em; color: #999">Tool</a> <a href="/tags/UTXO/" style="font-size: 1.14em; color: #999b9d">UTXO</a> <a href="/tags/bitcoin/" style="font-size: 1.32em; color: #99a2ae">bitcoin</a> <a href="/tags/bitcoin-script/" style="font-size: 1.1em; color: #999">bitcoin-script</a> <a href="/tags/blockchain/" style="font-size: 1.5em; color: #99a9bf">blockchain</a> <a href="/tags/c/" style="font-size: 1.1em; color: #999">c++</a> <a href="/tags/eos/" style="font-size: 1.28em; color: #99a0aa">eos</a> <a href="/tags/freedom/" style="font-size: 1.23em; color: #999ea6">freedom</a> <a href="/tags/hexo/" style="font-size: 1.23em; color: #999ea6">hexo</a> <a href="/tags/pow/" style="font-size: 1.1em; color: #999">pow</a> <a href="/tags/smart-contract/" style="font-size: 1.1em; color: #999">smart contract</a> <a href="/tags/%E5%86%99%E4%BD%9C/" style="font-size: 1.1em; color: #999">写作</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 1.1em; color: #999">工具</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>Archives</span><a class="card-more-btn" href="/archives/" title="More">
    <i class="fas fa-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/04/"><span class="card-archive-list-date">April 2021</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/01/"><span class="card-archive-list-date">January 2020</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2019/04/"><span class="card-archive-list-date">April 2019</span><span class="card-archive-list-count">5</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2019/02/"><span class="card-archive-list-date">February 2019</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2019/01/"><span class="card-archive-list-date">January 2019</span><span class="card-archive-list-count">9</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2018/10/"><span class="card-archive-list-date">October 2018</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2018/09/"><span class="card-archive-list-date">September 2018</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2018/05/"><span class="card-archive-list-date">May 2018</span><span class="card-archive-list-count">1</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>Info</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">Article :</div><div class="item-count">74</div></div><div class="webinfo-item"><div class="item-name">Run time :</div><div class="item-count" id="runtimeshow" data-publishDate="2014-12-11T16:00:00.000Z"></div></div><div class="webinfo-item"><div class="item-name">Total Count :</div><div class="item-count">152.1k</div></div><div class="webinfo-item"><div class="item-name">UV :</div><div class="item-count" id="busuanzi_value_site_uv"></div></div><div class="webinfo-item"><div class="item-name">PV :</div><div class="item-count" id="busuanzi_value_site_pv"></div></div><div class="webinfo-item"><div class="item-name">Last Push :</div><div class="item-count" id="last-push-date" data-lastPushDate="2022-03-11T06:31:00.878Z"></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2014 - 2022 By Wang Wei</div><div class="footer_custom_text">Stay Hungry, Stay Foolish</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>function subtitleType () {
  getScript('https://sdk.jinrishici.com/v2/browser/jinrishici.js').then(() => {
    jinrishici.load(result =>{
      if (true) {
        const sub = []
        const content = result.data.content
        sub.unshift(content)
        window.typed = new Typed('#subtitle', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('subtitle').innerHTML = result.data.content
      }
    })
  })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.jsdelivr.net/npm/typed.js/lib/typed.min.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div><div id="particles-js"></div><script src="/lib/js/particles.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: true,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', 'UA-112239883-1', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>